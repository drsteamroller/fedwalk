
config sql-report dataset

    edit "fch-Global-Traffic-Timeline"
        set description "Global traffic time line"
        set log-type traffic
        set dev-type FortiCache
        set query "select $flex_timescale(timestamp) as hodex, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, sum(coalesce(resplength,0)) as bandwidth from $log where $filter and subtype='http-transaction' group by timestamp having sum(coalesce(resplength, 0))>0 order by timestamp desc)### t group by hodex order by hodex"
        set protected enable
    next

    edit "fch-Global-Request-Timeline"
        set description "Global request time line"
        set log-type traffic
        set dev-type FortiCache
        set query "select $flex_timescale(timestamp) as hodex, sum(request) as request from ###(select $flex_timestamp as timestamp, count(*) as request from $log where $filter and subtype='http-transaction' group by timestamp order by timestamp desc)### t group by hodex order by hodex"
        set protected enable
    next

    edit "fch-Top-Websites-by-Bandwidth"
        set description "Top websites by bandwidth"
        set log-type traffic
        set dev-type FortiCache
        set query "select root_domain(hostname) as host, sum(coalesce(resplength,0)) as bandwidth from $log where $filter and hostname is not null and subtype='http-transaction' group by host having sum(coalesce(resplength, 0))>0 order by bandwidth desc"
        set protected enable
    next

    edit "fch-Global-Bandwidth-Savings"
        set description "Global bandwidth savings"
        set log-type traffic
        set dev-type FortiCache
        set query "select sum(cache_len) as cache_len, sum(total_len) as total_len, cast(sum(cache_len)*100.0/sum(total_len) as decimal(18,2)) as savings from (###(select sum(case when resptype is not null then resplength else 0 end) as total_len, sum(case when resptype='cached' then resplength else 0 end) as cache_len from $log where $filter and subtype='http-transaction')###) t having sum(total_len)>0"
        set protected enable
    next

    edit "fch-Top-Websites-by-Bandwidth-Savings"
        set description "Fetch the top websites by bandwidth savings"
        set log-type traffic
        set dev-type FortiCache
        set query "select host, sum(cache_len) as cache_len, sum(cache_len+normal_len) as total_len, cast(sum(cache_len)*100.0/sum(cache_len+normal_len) as decimal(18,2)) as savings from (###(select root_domain(hostname) as host, sum(case when resptype='cached' then resplength else 0 end) as cache_len, sum(case when resptype in ('normal', 'generated') then resplength else 0 end) as normal_len from $log where $filter and hostname is not null and subtype='http-transaction' group by host)###) t where cache_len>0 and normal_len>0 group by host order by savings desc"
        set protected enable
    next

    edit "fch-Global-Cache-Rate"
        set description "Global cache rate"
        set log-type traffic
        set dev-type FortiCache
        set query "select sum(cache_objs) as cache_num, sum(total_objs) as total_num, cast(sum(cache_objs)*100.0/sum(total_objs) as decimal(18,2)) as cache_rate from (###(select sum(case when resptype='cached' then 1 else 0 end) as cache_objs, count(*) as total_objs from $log where $filter and subtype='http-transaction')###) t having sum(total_objs)>0"
        set protected enable
    next

    edit "fch-Top-Websites-by-Cache-Rate"
        set description "Fetch the top websites by cache rate"
        set log-type traffic
        set dev-type FortiCache
        set query "select host, cast(sum(cache_num)*100.0/sum(cache_num+normal_num) as decimal(18,2)) as cache_rate from (###(select root_domain(hostname) as host, sum(case when resptype='cached' then 1 else 0 end) as cache_num, sum(case when resptype in ('normal', 'generated') then 1 else 0 end) as normal_num from $log where $filter and hostname is not null and subtype='http-transaction' group by host)###) t where cache_num>0 and normal_num>0 group by host order by cache_rate desc"
        set protected enable
    next

    edit "fch-Top-Websites-by-Response-Time-Improvement"
        set description "Fetch the top websites by response time improvement"
        set log-type traffic
        set dev-type FortiCache
        set query "select host, cast(sum(normal_time - cache_time)*100.0/sum(normal_time) as decimal(18,2)) as improvement from (###(select root_domain(hostname) as host, sum(case when resptype='cached' then respfinishtime-reqtime else 0 end) as cache_time, sum(case when resptype in ('normal', 'generated') then respfinishtime-reqtime else 0 end) as normal_time from $log where $filter and hostname is not null and subtype='http-transaction' group by host)###) t where normal_time>0 and cache_time>0 and normal_time>cache_time group by host order by improvement desc"
        set protected enable
    next

    edit "fch-Top-Web-Users-By-Bandwidth"
        set description "fk Top Web Users By Bandwidth"
        set log-type traffic
        set dev-type FortiCache
        set query "select coalesce(nullifna(`user`),  ipstr(`srcip`)) as user_src, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out from $log where $filter group by user_src having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc"
        set protected enable
    next

    edit "fch-traffic-bandwidth-timeline"
        set description "fk traffic bandwidth timeline"
        set log-type traffic
        set dev-type FortiCache
        set query "select $flex_timescale(timestamp) as hodex, sum(traffic_out) as traffic_out, sum(traffic_in) as traffic_in from ###(select $flex_timestamp as timestamp, sum(coalesce(sentbyte, 0)) as traffic_out, sum(coalesce(rcvdbyte, 0)) as traffic_in from $log where $filter group by timestamp having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by timestamp desc)### t group by hodex order by hodex"
        set protected enable
    next

    edit "fch-utm-Top-Virus"
        set description "fk utm Top Virus"
        set log-type traffic
        set dev-type FortiCache
        set query "select virus, max(virusid) as virusid, (case when virus like 'Riskware%' then 'Spyware' when virus like 'Adware%' then 'Adware' else 'Virus' end) as malware_type, count(*) as totalnum from $log-virus where $filter and nullifna(virus) is not null group by virus order by totalnum desc"
        set protected enable
    next

    edit "fch-webfilter-Categories-By-Bandwidth"
        set description "fk utm Top Virus"
        set log-type webfilter
        set dev-type FortiCache
        set query "select catdesc, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log-webfilter where $filter and catdesc is not null group by catdesc order by bandwidth desc"
        set protected enable
    next

    edit "fch-webfilter-Top-Allowed-Web-Categories"
        set description "fk webfilter Top Allowed Web Categories"
        set log-type webfilter
        set dev-type FortiCache
        set query "select catdesc, sum(requests) as requests from ###(select hostname as domain, catdesc, action, count(*) as requests from $log where $filter and catdesc is not null group by domain, catdesc, action order by requests desc)### t where action!='blocked' group by catdesc order by requests desc"
        set protected enable
    next

    edit "fch-webfilter-Top-Allowed-Web-Sites-by-Bandwidth"
        set description "fk webfilter Top Allowed Web Sites by Bandwidth"
        set log-type webfilter
        set dev-type FortiCache
        set query "select domain, string_agg(distinct catdesc, ', ') as agg_catdesc, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from ###(select coalesce(nullifna(hostname), ipstr(`srcip`)) as domain, catdesc, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out from $log where $filter and action!='blocked' group by domain, catdesc having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc)### t group by domain order by bandwidth desc"
        set protected enable
    next

    edit "fch-webfilter-Top-Allowed-Web-Sites-By-Requests"
        set description "fk webfilter Top Allowed Web Sites By Requests"
        set log-type webfilter
        set dev-type FortiCache
        set query "select domain, string_agg(distinct catdesc, ', ') as agg_catdesc, sum(requests) as requests from ###(select hostname as domain, catdesc, action, count(*) as requests from $log where $filter and catdesc is not null group by domain, catdesc, action order by requests desc)### t where action!='blocked' and domain is not null group by domain order by requests desc"
        set protected enable
    next

    edit "fch-webfilter-Top-Blocked-Web-Categories"
        set description "fk webfilter Top Blocked Web Categories"
        set log-type webfilter
        set dev-type FortiCache
        set query "select catdesc, sum(requests) as requests from ###(select hostname as domain, catdesc, action, count(*) as requests from $log where $filter and catdesc is not null group by domain, catdesc, action order by requests desc)### t where action='blocked' group by catdesc order by requests desc"
        set protected enable
    next

    edit "fch-webfilter-Top-Blocked-Web-Sites-By-Requests"
        set description "fk webfilter Top Blocked Web Sites By Requests"
        set log-type webfilter
        set dev-type FortiCache
        set query "select domain, catdesc, sum(requests) as requests from ###(select hostname as domain, catdesc, action, count(*) as requests from $log where $filter and catdesc is not null group by domain, catdesc, action order by requests desc)### t where domain is not null and action='blocked' group by domain, catdesc order by requests desc"
        set protected enable
    next

    edit "fch-webfilter-Top-Web-Users-By-Allowed-Requests"
        set description "fk webfilter Top Web Users By Allowed Requests"
        set log-type webfilter
        set dev-type FortiCache
        set query "select user_src, sum(requests) as requests from ###(select coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, action, count(*) as requests from $log-webfilter where $filter and coalesce(nullifna(`user`), ipstr(`srcip`)) is not null group by user_src, action /*SkipSTART*/order by requests desc/*SkipEND*/)### t where action!='blocked' group by user_src order by requests desc"
        set protected enable
    next

    edit "fch-webfilter-Top-Web-Users-By-Blocked-Requests"
        set description "fk webfilter Top Web Users By Blocked Requests"
        set log-type webfilter
        set dev-type FortiCache
        set query "select user_src, sum(requests) as requests from ###(select coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, action, count(*) as requests from $log-webfilter where $filter and coalesce(nullifna(`user`), ipstr(`srcip`)) is not null group by user_src, action /*SkipSTART*/order by requests desc/*SkipEND*/)### t where action='blocked' group by user_src order by requests desc"
        set protected enable
    next

    edit "fch-webfilter-Web-Activity-Summary-By-Requests"
        set description "fk webfilter Top Web Activity Summary By Requests"
        set log-type webfilter
        set dev-type FortiCache
        set query "select $flex_timescale(timestamp) as hodex, sum(allowed_request) as allowed_request, sum(blocked_request) as blocked_request from ###(select $flex_timestamp as timestamp, sum(case when action!='blocked' then 1 else 0 end) as allowed_request, sum(case when action='blocked' then 1 else 0 end) as blocked_request from $log-webfilter where $filter group by timestamp order by timestamp desc)### t group by hodex order by hodex"
        set protected enable
    next
end


config sql-report chart

    edit "fch-Traffic-Timeline"
        set disp-name "Traffic timeline"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Traffic timeline"
        set dataset "fch-Global-Traffic-Timeline"
        set chart-type area
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "bandwidth"
                set column-graph-type line-up
                set column-attr bandwidth
                set legend "Global Traffic"
            next
        end
        set protected enable
    next

    edit "fch-Request-Timeline"
        set disp-name "Request timeline"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Request timeline"
        set dataset "fch-Global-Request-Timeline"
        set chart-type area
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "request"
                set column-graph-type line-up
                set column-attr count
                set legend "Requests"
            next
        end
        set protected enable
    next

    edit "fch-Top20-Websites-by-Bandwidth"
        set disp-name "Top Websites by Bandwidth Pie Chart"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 20 websites by bandwidth pie chart"
        set dataset "fch-Top-Websites-by-Bandwidth"
        set chart-type pie
        config table-columns
            edit 1
                set header "Websites"
                set data-binding "host"
                set data-top 20
            next
            edit 2
                set header "Bytes"
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next

    edit "fch-Global-Bandwidth-Savings"
        set disp-name "Global Bandwidth Savings"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Global bandwidth savings"
        set dataset "fch-Global-Bandwidth-Savings"
        set chart-type table
        config table-columns
            edit 1
                set header "Cached Bandwidth"
                set data-binding "cache_len"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 2
                set data-binding "cache_len"
                set column-attr bandwidth
            next
            edit 3
                set header "Total Bandwidth"
                set data-binding "total_len"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 4
                set data-binding "total_len"
                set column-attr bandwidth
            next
            edit 5
                set header "Bandwidth Savings"
                set data-binding "savings"
                set column-attr percent
                set column-width 20
            next
        end
        set protected enable
    next

    edit "fch-Top20-Websites-by-Bandwidth-Savings"
        set disp-name "Top 20 Websites by Bandwidth Savings"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 20 websites by bandwidth savings"
        set dataset "fch-Top-Websites-by-Bandwidth-Savings"
        set chart-type table
        config table-columns
            edit 1
                set header "Hostname"
                set data-binding "host"
                set data-top 20
                set column-width 25
            next
            edit 2
                set header "Cached Traffic"
                set data-binding "cache_len"
                set column-span 2
                set column-graph-type bar
                set column-width 30
            next
            edit 3
                set data-binding "cache_len"
                set column-attr bandwidth
            next
            edit 4
                set header "Total Traffic"
                set data-binding "total_len"
                set column-span 2
                set column-graph-type bar
                set column-width 30
            next
            edit 5
                set data-binding "total_len"
                set column-attr bandwidth
            next
            edit 6
                set header "Traffic Savings"
                set data-binding "savings"
                set column-attr percent
                set column-width 15
            next
        end
        set protected enable
    next

    edit "fch-Global-Cache-Rate"
        set disp-name "Global Cache Rate"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Global cache rate"
        set dataset "fch-Global-Cache-Rate"
        set chart-type table
        config table-columns
            edit 1
                set header "Cached Number"
                set data-binding "cache_num"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 2
                set data-binding "cache_num"
                set column-attr count
            next
            edit 3
                set header "Total Number"
                set data-binding "total_num"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 4
                set data-binding "total_num"
                set column-attr count
            next
            edit 5
                set header "Cached Rate"
                set data-binding "cache_rate"
                set column-attr percent
                set column-width 20
            next
        end
        set protected enable
    next

    edit "fch-Top20-Websites-by-Cache-Rate"
        set disp-name "Top 20 Websites by Cache Rate"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 20 websites by cache rate"
        set dataset "fch-Top-Websites-by-Cache-Rate"
        set chart-type table
        config table-columns
            edit 1
                set header "Hostname"
                set data-binding "host"
                set data-top 20
                set column-width 40
            next
            edit 2
                set header "Cached Rate"
                set data-binding "cache_rate"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "cache_rate"
                set column-attr percent
            next
        end
        set protected enable
    next

    edit "fch-Top20-Websites-by-Response-Time-Improvement"
        set disp-name "Top 20 Websites by Response Time Improvement"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 20 websites by response time improvement"
        set dataset "fch-Top-Websites-by-Response-Time-Improvement"
        set chart-type table
        config table-columns
            edit 1
                set header "Hostname"
                set data-binding "host"
                set data-top 20
                set column-width 40
            next
            edit 2
                set header "Improvement"
                set data-binding "improvement"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "improvement"
                set column-attr percent
            next
        end
        set protected enable
    next

    edit "fch-Bandwidth-Summary"
        set disp-name "Bandwidth Summary"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Traffic bandwidth usage summary"
        set dataset "fch-traffic-bandwidth-timeline"
        set chart-type area
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
            next
            edit 2
                set legend "Sent"
                set data-binding "traffic_out"
                set column-graph-type line-up
                set column-attr bandwidth
            next
            edit 3
                set legend "Received"
                set data-binding "traffic_in"
                set column-graph-type line-up
                set column-attr bandwidth
                
            next
        end
        set protected enable
    next

    edit "fch-Top-20-Allowed-Web-Categories"
        set disp-name "Top 20 Allowed Web Categories"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 20 allowed web filtering categories"
        set dataset "fch-webfilter-Top-Allowed-Web-Categories"
        set chart-type table
        config table-columns
            edit 1
                set header "Category"
                set data-binding "catdesc"
                set data-top 20
                set column-attr web-cat
            next
            edit 2
                set header "Requests"
                set data-binding "requests"
                set column-graph-type bar
                set column-span 2
            next
            edit 3
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fch-Top-20-Application-Categories-by-Bandwidth"
        set disp-name "Top 20 Application Categories by Bandwidth"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 20 application categories by bandwidth usage"
        set dataset "fch-webfilter-Categories-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Category"
                set data-binding "catdesc"
                set data-top 20
                set column-attr web-cat
            next
            edit 2
                set header "Bytes"
                set data-binding "bandwidth"
                set column-graph-type bar
                set column-span 2
            next
            edit 3
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next

    edit "fch-Top-20-Web-Users-by-Bandwidth"
        set disp-name "Top 20 Web Users by Bandwidth"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 20 web users by bandwidth"
        set dataset "fch-Top-Web-Users-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set data-top 10
                set column-attr user
            next
            edit 2
                set header "Bytes"
                set data-binding "bandwidth"
                set column-graph-type bar
                set column-span 2
            next
            edit 3
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
            edit 4
                set header "Bytes_in"
                set data-binding "traffic_in"
            next
            edit 5
                set header "Bytes_out"
                set data-binding "traffic_out"
            next
        end
        set protected enable
    next

    edit "fch-Top-20-Blocked-Web-Categories"
        set disp-name "Top 20 Blocked Web Categories"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 20 blocked web filter categories"
        set dataset "fch-webfilter-Top-Blocked-Web-Categories"
        set chart-type table
        config table-columns
            edit 1
                set header "Category"
                set data-binding "catdesc"
                set data-top 20
                set column-attr web-cat
            next
            edit 2
                set header "Requests"
                set data-binding "requests"
                set column-graph-type bar
                set column-span 2
            next
            edit 3
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fch-Top-20-Blocked-Websites"
        set disp-name "Top 20 Blocked Websites"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 20 Blocked websites by number of requests"
        set dataset "fch-webfilter-Top-Blocked-Web-Sites-By-Requests"
        set chart-type table
        config table-columns
            edit 1
                set header "Website"
                set data-binding "domain"
                set data-top 20
                set column-attr obf-url
            next
            edit 2
                set header "Category"
                set data-binding "catdesc"
                set column-attr web-cat
            next
            edit 3
                set header "Requests"
                set data-binding "requests"
                set column-graph-type bar
                set column-span 2
            next
            edit 4
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fch-Top-20-Viruses"
        set disp-name "Top 20 Viruses"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 20 viruses detected"
        set dataset "fch-utm-Top-Virus"
        set chart-type table
        config table-columns
            edit 1
                set header "Virus Name"
                set data-binding "virusid"
                set column-attr url
                set column-span 2
                set data-top 20
            next
            edit 2
                set data-binding "virus"
                set column-attr virus
            next
            edit 3
                set header "Malware Type"
                set data-binding "malware_type"
            next
            edit 4
                set header "Occurrences"
                set data-binding "totalnum"
                set column-graph-type bar
                set column-span 2
            next
            edit 5
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fch-Top-50-Allowed-Websites"
        set disp-name "Top 50 Allowed Websites"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 50 allowed websites by number of requests"
        set dataset "fch-webfilter-Top-Allowed-Web-Sites-By-Requests"
        set chart-type table
        config table-columns
            edit 1
                set header "Website"
                set data-binding "domain"
                set data-top 50
            next
            edit 2
                set header "Category"
                set data-binding "agg_catdesc"
                set column-attr web-cat
            next
            edit 3
                set header "Requests"
                set data-binding "requests"
                set column-graph-type bar
                set column-span 2
            next
            edit 4
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fch-Top-50-Websites-and-Category-by-Bandwidth"
        set disp-name "Top 50 Websites and Category by Bandwidth"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 50 websites and web filtering categories by bandwidth usage"
        set dataset "fch-webfilter-Top-Allowed-Web-Sites-by-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Website"
                set data-binding "domain"
                set data-top 50
            next
            edit 2
                set header "Category"
                set data-binding "agg_catdesc"
                set column-attr web-cat
            next
            edit 3
                set header "Bytes"
                set data-binding "bandwidth"
                set column-graph-type bar
                set column-span 2
            next
            edit 4
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next

   edit "fch-Top-Blocked-Categories-by-Donut-Chart"
        set disp-name "Top 10 Blocked Categories"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 10 Blocked Categories by donut chart"
        set dataset "fch-webfilter-Top-Blocked-Web-Categories"
        set chart-type donut
        config table-columns
            edit 1
                set header "Categories"
                set data-binding "catdesc"
                set data-top 10
            next
            edit 2
                set header "Requests"
                set data-type aggregate
                set data-binding "requests"
                set column-attr percent
            next
        end
        set protected enable
    next

    edit "fch-Top-Blocked-Websites-and-Categories"
        set disp-name "Top 50 Blocked Websites and Categories"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 50 blocked web filtering websites and categories by number of requests"
        set dataset "fch-webfilter-Top-Blocked-Web-Sites-By-Requests"
        set chart-type table
        config table-columns
            edit 1
                set header "Website"
                set data-binding "domain"
                set data-top 50
                set column-attr obf-url
            next
            edit 2
                set header "Category"
                set data-binding "catdesc"
                set column-attr web-cat
            next
            edit 3
                set header "Requests"
                set data-binding "requests"
                set column-graph-type bar
                set column-span 2
            next
            edit 4
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next

   edit "fch-Top-Categories-by-request-Donut-Chart"
        set disp-name "Top 10 Web Categories by request"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 10 categories by request donut chart"
        set dataset "fch-webfilter-Top-Allowed-Web-Categories"
        set chart-type donut
        config table-columns
            edit 1
                set header "Categories"
                set data-binding "catdesc"
                set data-top 10
            next
            edit 2
                set header "Requests"
                set data-type aggregate
                set data-binding "requests"
                set column-attr percent
            next
        end
        set protected enable
    next

    edit "fch-Top-Web-Users-by-Allowed-Requests"
        set disp-name "Top 20 Web Users by Allowed Requests"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 20 web users by number of allowed requests"
        set dataset "fch-webfilter-Top-Web-Users-By-Allowed-Requests"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set column-attr user
                set data-top 20
            next
            edit 2
                set header "Requests"
                set data-binding "requests"
                set column-graph-type bar
                set column-span 2
            next
            edit 3
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fch-Top-Web-Users-by-Blocked-Requests"
        set disp-name "Top 20 Web Users by Blocked Requests"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 20 web users by number of blocked requests"
        set dataset "fch-webfilter-Top-Web-Users-By-Blocked-Requests"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set column-attr user
                set data-top 20
            next
            edit 2
                set header "Requests"
                set data-binding "requests"
                set column-graph-type bar
                set column-span 2
            next
            edit 3
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next

   edit "fch-Top-Websites-by-Bandwidth-Donut-Chart"
        set disp-name "Top 10 Websites by Bandwidth"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 10 Websites by Bandwidth Donut Chart"
        set dataset "fch-webfilter-Top-Allowed-Web-Sites-by-Bandwidth"
        set chart-type donut
        config table-columns
            edit 1
                set header "Website"
                set data-binding "domain"
                set data-top 10
            next
            edit 2
                set header "Bytes"
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr percent
            next
        end
        set protected enable
    next

    edit "fch-Web-Activity-Summary"
        set disp-name "Web Activity Summary"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Web activity summary by number of requests"
        set dataset "fch-webfilter-Web-Activity-Summary-By-Requests"
        set chart-type line
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
            next
            edit 2
                set legend "Allowed Requests"
                set data-binding "allowed_request"
                set column-graph-type line-up
            next
            edit 3
                set legend "Blocked Requests"
                set data-binding "blocked_request"
                set column-graph-type line-up
                
            next
        end
        set protected enable
    next

end


config sql-report layout
    edit 1000050001
        set is-template enable
        set dev-type FortiCache
        set category "FortiCache"
        set title "Template - FortiCache Default Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Global bandwidth savings, cache rate, traffic and request timeline. Top 20 websites by bandwidth, bandwidth savings, cache rate, response time improvement."
        set body "<fazchart mkey=\"fch-Global-Bandwidth-Savings\" title=\"Global Bandwidth Savings\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fch-Global-Cache-Rate\" title=\"Global Cache Rate\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fch-Traffic-Timeline\" title=\"Traffic Timeline\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fch-Request-Timeline\" title=\"Request Timeline\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fch-Top20-Websites-by-Bandwidth\" title=\"Top 20 Websites by Bandwidth Pie Chart\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fch-Top20-Websites-by-Bandwidth-Savings\" title=\"Top 20 Websites by Bandwidth Savings\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fch-Top20-Websites-by-Cache-Rate\" title=\"Top 20 Websites by Cache Rate\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fch-Top20-Websites-by-Response-Time-Improvement\" title=\"Top 20 Websites by Response Time Improvement\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90103
                next
            end
        set protected enable
    next

    edit 1000050002
        set is-template enable
        set dev-type FortiCache
        set category "FortiCache"
        set title "Template - FortiCache Web Usage Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set body "<h1>Web Usage Summary</h1><fazchart mkey=\"fch-Web-Activity-Summary\" title=\"Request Summary\" width=\"100%\"></fazchart><fazchart mkey=\"fch-Bandwidth-Summary\" title=\"Bandwidth Summary\" width=\"100%\"></fazchart><hr /><h1>Web Activity</h1><fazchart mkey=\"fch-Top-Web-Users-by-Allowed-Requests\" title=\"Top 20 Most Active Users\" width=\"100%\"></fazchart><fazchart mkey=\"fch-Top-Categories-by-request-Donut-Chart\" title=\"Top Categories by Request\" width=\"100%\"></fazchart><fazchart mkey=\"fch-Top-20-Allowed-Web-Categories\" title=\"Top 20 Allowed Web Categories\" width=\"100%\"></fazchart><fazchart mkey=\"fch-Top-50-Allowed-Websites\" title=\"Top 50 Most Visited Websites\" width=\"100%\"></fazchart><hr /><h1>Internet Bandwidth Usage</h1><fazchart mkey=\"fch-Top-20-Web-Users-by-Bandwidth\" title=\"Top 20 Bandwidth Users\" width=\"100%\"></fazchart><fazchart mkey=\"fch-Top-20-Application-Categories-by-Bandwidth\" title=\"Top 20 Categories By Bandwidth\" width=\"100%\"></fazchart><fazchart mkey=\"fch-Top-Websites-by-Bandwidth-Donut-Chart\" title=\"Top Websites by Bandwidth\" width=\"100%\"></fazchart><fazchart mkey=\"fch-Top-50-Websites-and-Category-by-Bandwidth\" title=\"Top 50 Websites and Category by Bandwidth\" width=\"100%\"></fazchart><hr /><h1>Most Blocked</h1><fazchart mkey=\"fch-Top-Web-Users-by-Blocked-Requests\" title=\"Top 20 Most Block Users\" width=\"100%\"></fazchart><fazchart mkey=\"fch-Top-Blocked-Categories-by-Donut-Chart\" title=\"Top Blocked Categories\" width=\"100%\"></fazchart><fazchart mkey=\"fch-Top-20-Blocked-Web-Categories\" title=\"Top 20 Blocked Web Categories\" width=\"100%\"></fazchart><fazchart mkey=\"fch-Top-Blocked-Websites-and-Categories\" title=\"Top 50 Most Blocked Websites\" width=\"100%\"></fazchart><p>&nbsp;</p>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90103
                next
                edit 90200
                next
            end
        set protected enable
    next

    edit 1000050003
        set is-template enable
        set dev-type FortiCache
        set category "FortiCache"
        set title "Template - FortiCache Security Analysis"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set body "<h1>User Security Analysis</h1><fazchart mkey=\"fch-Top-20-Blocked-Websites\" title=\"Top Blocked Web Sites\" width=\"100%\"></fazchart><fazchart mkey=\"fch-Top-50-Allowed-Websites\" title=\"Top Allowed Web Sites\" width=\"100%\"></fazchart><fazchart mkey=\"fch-Top-20-Blocked-Web-Categories\" title=\"Top Blocked Web Categories\" width=\"100%\"></fazchart><fazchart mkey=\"fch-Top-20-Allowed-Web-Categories\" title=\"Top Allowed Web Categories\" width=\"100%\"></fazchart><fazchart mkey=\"fch-Top-20-Viruses\" title=\"Top Detected Viruses\" width=\"100%\"></fazchart><p>&nbsp;</p>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90103
                next
                edit 90203
                next
            end
        set protected enable
    next
end


config sql-report layout-folder
    edit 99999
        set folder-name "Default Templates"
        set protected enable
    next
    edit 90103
        set folder-name "FortiCache Reports Templates"
        set parent-id 99999
        set protected enable
    next

    edit 90200
        set folder-name "Application Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90203
        set folder-name "SOC Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90205
        set folder-name "Outbreak Alert Reports Templates"
        set parent-id 99999
        set protected enable
    next
end

config system connectors
    edit 1
        set uuid "5979abf1-a807-47fd-8aca-c03d3b27c124"
        set name "Local Connector"
        set description "Local Connector"
        set status enable
        set type LOCALHOST 
        set auth-type none
        config action
            edit 1
                set name "UPDATE_ASSET_AND_IDENTITY"
                set description "update asset and identity"
                set parameters "{}"
                set status enable
            next
            edit 2
                set name "GET_EVENTS"
                set description "get events"
                set parameters "{}"
                set status enable
            next
            edit 3
                set name "ATTACH_DATA_TO_INCIDENT"
                set description "attach data to incident"
                set parameters "{}"
                set status enable
            next
            edit 4
                set name "RUN_REPORT"
                set description "run report"
                set parameters "{}"
                set status enable
            next
            edit 5
                set name "GET_ENDPOINT_VULNERABILITIES"
                set description "get endpoint vulnerabilities"
                set parameters "{}"
                set status enable
            next
            edit 6
                set name "CREATE_INCIDENT"
                set description "create incident"
                set parameters "{}"
                set status enable
            next
            edit 7
                set name "UPDATE_INCIDENT"
                set description "update incident"
                set parameters "{}"
                set status enable
            next
        end
    next
    edit 2
        set uuid "d0f89488-b270-11ea-b3de-0242ac130004"
        set name "FortiGuard Connector"
        set description "FortiGuard Connector"
        set status enable
        set type FGD
        set auth-type none
        config action
            edit 1
                set name "GET_IOC_INFO"
                set description "get FortiGuard data for associated IOC"
                set parameters "{\"addr\":null}"
                set status enable
            next
            edit 2
                set name "GET_THREAT_INFO"
                set description "Lookup Fortiguard encyclopedia entry"
                set parameters "{\"threat-type\":null,\"threatID\":null}"
                set status enable
            next
            edit 3
                set name "INDICATOR_LOOKUP"
                set description "Indicator Lookup"
                set parameters "{\"indicator_type\":null,\"indicator_value\":null}"
                set status enable
            next
        end
    next
end
