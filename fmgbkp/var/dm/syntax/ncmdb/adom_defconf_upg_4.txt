
config sql-report dataset

    edit "fml-History-Top-Client-IP"
        set description "FortiMail history top client IP"
        set dev-type FortiMail
        set log-type history
        set query "select coalesce(ipstr(`client_ip`), client_name) as clientip, count(*) as totalnum from $log where $filter group by clientip having coalesce(ipstr(`client_ip`), client_name) is not null order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Local-User"
        set description "FortiMail history top local user"
        set dev-type FortiMail
        set log-type history
        set query "select local_user, count(*) as totalnum from (select (case when direction='in' then `to` when direction='out' then `from` else NULL end) as local_user from $log where $filter) t where local_user is not null group by local_user order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Remote-Address"
        set description "FortiMail history top remote address"
        set dev-type FortiMail
        set log-type history
        set query "select remote_addr, count(*) as totalnum from (select (case when direction='out' then `to` when direction='in' then `from` else NULL end) as remote_addr from $log where $filter) t where remote_addr is not null group by remote_addr order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Virus"
        set description "FortiMail history top virus"
        set dev-type FortiMail
        set log-type history
        set query "select virus, count(*) as totalnum from $log where $filter and virus is not null group by virus order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Client-MSISDN"
        set description "FortiMail history top client msisdn"
        set dev-type FortiMail
        set log-type history
        set query "select msisdn, count(*) as totalnum from $log where $filter and msisdn is not null group by msisdn order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Client-Endpoint"
        set description "FortiMail history top client endpoint"
        set dev-type FortiMail
        set log-type history
        set query "select endpoint, sum(totalnum) as totalnum from ###(select endpoint, `from`, virus, count(*) as totalnum from $log where $filter and endpoint is not null group by endpoint, `from`, virus order by totalnum desc)### t group by endpoint order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Sender"
        set description "FortiMail history top sender"
        set dev-type FortiMail
        set log-type history
        set query "select `from` as sender, sum(totalnum) as totalnum from ###(select `from`, virus, direction, count(*) as totalnum from $log where $filter and `from` is not null group by `from`, virus, direction order by totalnum desc)### t group by sender order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Sender-IP"
        set description "FortiMail history top sender IP"
        set dev-type FortiMail
        set log-type history
        set query "select coalesce(ipstr(`client_ip`), client_name) as sender_ip, count(*) as totalnum from $log where $filter and `from` is not null group by sender_ip having coalesce(ipstr(`client_ip`), client_name) is not null order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Local-Sender"
        set description "FortiMail history top local sender"
        set dev-type FortiMail
        set log-type history
        set query "select `from` as sender, sum(totalnum) as totalnum from ###(select `from`, virus, direction, count(*) as totalnum from $log where $filter and `from` is not null group by `from`, virus, direction order by totalnum desc)### t where direction='out' group by sender order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Remote-Sender"
        set description "FortiMail history top remote sender"
        set dev-type FortiMail
        set log-type history
        set query "select `from` as sender, sum(totalnum) as totalnum from ###(select `from`, virus, direction, count(*) as totalnum from $log where $filter and `from` is not null group by `from`, virus, direction order by totalnum desc)### t where direction not in ('out', 'unknown') group by sender order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Sender-MSISDN"
        set description "FortiMail history top sender msisdn"
        set dev-type FortiMail
        set log-type history
        set query "select msisdn, count(*) as totalnum from $log where $filter and msisdn is not null and `from` is not null group by msisdn order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Sender-Endpoint"
        set description "FortiMail history top sender endpoint"
        set dev-type FortiMail
        set log-type history
        set query "select endpoint, sum(totalnum) as totalnum from ###(select endpoint, `from`, virus, count(*) as totalnum from $log where $filter and endpoint is not null group by endpoint, `from`, virus order by totalnum desc)### t where `from` is not null group by endpoint order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Recipient"
        set description "FortiMail history top recipient"
        set dev-type FortiMail
        set log-type history
        set query "select `to` as recipient, sum(totalnum) as totalnum from ###(select `to`, virus, direction, count(*) as totalnum from $log where $filter and `to` is not null group by `to`, virus, direction order by totalnum desc)### t group by recipient order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Local-Recipient"
        set description "FortiMail history top local recipient"
        set dev-type FortiMail
        set log-type history
        set query "select `to` as recipient, sum(totalnum) as totalnum from ###(select `to`, virus, direction, count(*) as totalnum from $log where $filter and `to` is not null group by `to`, virus, direction order by totalnum desc)### t where direction='in' group by recipient order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Remote-Recipient"
        set description "FortiMail history top remote recipient"
        set dev-type FortiMail
        set log-type history
        set query "select `to` as recipient, sum(totalnum) as totalnum from ###(select `to`, virus, direction, count(*) as totalnum from $log where $filter and `to` is not null group by `to`, virus, direction order by totalnum desc)### t where direction!='in' group by recipient order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Mail-Dest-IP"
        set description "FortiMail history top mail dest IP"
        set dev-type FortiMail
        set log-type history
        set query "select dst_ip, sum(totalnum) as totalnum from ###(select dst_ip, virus, count(*) as totalnum from $log where $filter and dst_ip is not null group by dst_ip, virus order by totalnum desc)### t group by dst_ip order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Count-Total-Sent-Received"
        set description "FortiMail history count total sent received"
        set dev-type FortiMail
        set log-type history
        set query "select direction, count(*) as totalnum from $log where $filter and direction in ('in', 'out', 'in-out') group by direction order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Virus-Sender"
        set description "FortiMail history top virus sender"
        set dev-type FortiMail
        set log-type history
        set query "select `from` as virus_sender, sum(totalnum) as totalnum from ###(select `from`, virus, direction, count(*) as totalnum from $log where $filter and `from` is not null group by `from`, virus, direction order by totalnum desc)### t where virus is not null group by virus_sender order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Virus-IP"
        set description "FortiMail history top virus IP"
        set dev-type FortiMail
        set log-type history
        set query "select coalesce(ipstr(`client_ip`), client_name) as virus_ip, count(*) as totalnum from $log where $filter and virus is not null group by virus_ip having coalesce(ipstr(`client_ip`), client_name) is not null order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Local-Virus-Sender"
        set description "FortiMail history top local virus sender"
        set dev-type FortiMail
        set log-type history
        set query "select `from` as virus_sender, sum(totalnum) as totalnum from ###(select `from`, virus, direction, count(*) as totalnum from $log where $filter and `from` is not null group by `from`, virus, direction order by totalnum desc)### t where virus is not null and direction='out' group by virus_sender order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Remote-Virus-Sender"
        set description "FortiMail history top remote virus sender"
        set dev-type FortiMail
        set log-type history
        set query "select `from` as virus_sender, sum(totalnum) as totalnum from ###(select `from`, virus, direction, count(*) as totalnum from $log where $filter and `from` is not null group by `from`, virus, direction order by totalnum desc)### t where virus is not null and direction not in ('out', 'unknown') group by virus_sender order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Virus-MSISDN"
        set description "FortiMail history top virus msisdn"
        set dev-type FortiMail
        set log-type history
        set query "select msisdn, count(*) as totalnum from $log where $filter and virus is not null and msisdn is not null group by msisdn order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Virus-Endpoint"
        set description "FortiMail history top virus endpoint"
        set dev-type FortiMail
        set log-type history
        set query "select endpoint, sum(totalnum) as totalnum from ###(select endpoint, `from`, virus, count(*) as totalnum from $log where $filter and endpoint is not null group by endpoint, `from`, virus order by totalnum desc)### t where virus is not null group by endpoint order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Virus-Recipient"
        set description "FortiMail history top virus recipient"
        set dev-type FortiMail
        set log-type history
        set query "select `to` as recipient, sum(totalnum) as totalnum from ###(select `to`, virus, direction, count(*) as totalnum from $log where $filter and `to` is not null group by `to`, virus, direction order by totalnum desc)### t where virus is not null group by recipient order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Local-Virus-Recipient"
        set description "FortiMail history top local virus recipient"
        set dev-type FortiMail
        set log-type history
        set query "select `to` as recipient, sum(totalnum) as totalnum from ###(select `to`, virus, direction, count(*) as totalnum from $log where $filter and `to` is not null group by `to`, virus, direction order by totalnum desc)### t where virus is not null and direction='in' group by recipient order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Remote-Virus-Recipient"
        set description "FortiMail history top remote virus recipient"
        set dev-type FortiMail
        set log-type history
        set query "select `to` as recipient, sum(totalnum) as totalnum from ###(select `to`, virus, direction, count(*) as totalnum from $log where $filter and `to` is not null group by `to`, virus, direction order by totalnum desc)### t where virus is not null and direction!='in' group by recipient order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Virus-Dest-IP"
        set description "FortiMail history top virus dest IP"
        set dev-type FortiMail
        set log-type history
        set query "select dst_ip, sum(totalnum) as totalnum from ###(select dst_ip, virus, count(*) as totalnum from $log where $filter and dst_ip is not null group by dst_ip, virus order by totalnum desc)### t where virus is not null group by dst_ip order by totalnum desc"
        set protected enable
    next
    edit "fml-Active-EmailAddress-Summary"
        set description "FortiMail active email address summary"
        set dev-type FortiMail
        set log-type history
        set query "select email_domain(`from`) as domain_name, count(*) as totalnum from $log where $filter and nullif(email_domain(`from`), '') is not null group by domain_name order by totalnum desc"
        set protected enable
    next
    edit "fml-Average-Size-by-Hour"
        set description "FortiMail average size by hour"
        set dev-type FortiMail
        set log-type history
        set query "select hourstamp as timeperiod, cast(sum(msg_total_len)/sum(msg_count) as
        decimal(18,2)) as avg_size from ###(select $hour_of_day as hourstamp,
        sum(coalesce(message_length, 0)) as msg_total_len, count(*) as msg_count
        from $log where $filter group by hourstamp order by msg_total_len desc)### t group
        by timeperiod order by timeperiod"
        set protected enable
    next
    edit "fml-Messages-per-Hour"
        set description "FortiMail messages per hour"
        set dev-type FortiMail
        set log-type history
        set query "select $hour_of_day as timeperiod, count(*) as totalnum from $log where $filter and disposition='Accept' group by timeperiod order by timeperiod"
        set protected enable
    next
    edit "fml-Total-Size-by-Hour"
        set description "FortiMail total size by hour"
        set dev-type FortiMail
        set log-type history
        set query "select $hour_of_day as timeperiod, sum(coalesce(message_length, 0)) as tsize
        from $log where $filter group by timeperiod having
        sum(coalesce(message_length, 0))>0 order by timeperiod"
        set protected enable
    next
    edit "fml-Connections-per-Hour"
        set description "FortiMail connections per hour"
        set dev-type FortiMail
        set log-type history
        set query "select $hour_of_day as timeperiod, count(*) as totalnum from $log where $filter group by timeperiod order by timeperiod"
        set protected enable
    next

    edit "fml-history-Average-Size-of-Mails"
        set description "FortiMail history average size of mails"
        set dev-type FortiMail
        set log-type history
        set query "select $flex_timescale(timestamp) as timescale, ceil(case when sum(total_in)>0 then sum(size_in)/sum(total_in) else 0 end) as avg_size_in, ceil(case when sum(total_out)>0 then sum(size_out)/sum(total_out) else 0 end) as avg_size_out from (###(select $flex_timestamp as timestamp, sum(coalesce(message_length,0)) as size_in, 0 as size_out, count(*) as total_in, 0 as total_out from $log where $filter and direction='in' group by timestamp order by timestamp desc)### union all ###(select $flex_timestamp as timestamp, 0 as size_in, sum(coalesce(message_length,0)) as size_out, 0 as total_in, count(*) as total_out from $log where $filter and direction='out' group by timestamp order by timestamp desc)###) t group by timescale order by timescale"
        set protected enable
    next

    edit "fml-history-Total-Size-of-Mails"
        set description "FortiMail history total size of mails"
        set dev-type FortiMail
        set log-type history
        set query "select $flex_timescale(timestamp) as timescale, sum(size_in) as size_in, sum(size_out) as size_out from ###(select $flex_timestamp as timestamp, sum(case when direction='in' then coalesce(message_length,0) else 0 end) as size_in, sum(case when direction='out' then coalesce(message_length,0) else 0 end) as size_out from $log where $filter group by timestamp order by timestamp desc)### t group by timescale order by timescale"
        set protected enable
    next

    edit "fml-history-Number-of-Mail-Connections"
        set description "FortiMail history number of mail connections"
        set dev-type FortiMail
        set log-type history
        set query "select $flex_timescale(timestamp) as timescale, sum(con_in) as con_in, sum(con_out) as con_out from ###(select $flex_timestamp as timestamp, sum(case when direction='in' then 1 else 0 end) as con_in, sum(case when direction='out' then 1 else 0 end) as con_out from $log where $filter group by timestamp order by timestamp desc)### t group by timescale order by timescale"
        set protected enable
    next

    edit "fml-history-Number-of-Mails"
        set description "FortiMail history number of mails"
        set dev-type FortiMail
        set log-type history
        set query "select $flex_timescale(timestamp) as timescale, sum(count_in) as count_in, sum(count_out) as count_out from ###(select $flex_timestamp as timestamp, sum(case when direction='in' and disposition='Accept' then 1 else 0 end) as count_in, sum(case when direction='out' and disposition='Accept' then 1 else 0 end) as count_out from $log where $filter group by timestamp order by timestamp desc)### t group by timescale order by timescale"
        set protected enable
    next

    edit "fml-history-Total-Message-Delay"
        set description "FortiMail history total message delay"
        set dev-type FortiMail
        set log-type event
        set query "select $flex_timescale(timestamp) as hod, sum(delay) as total_delay from ###(select timestamp, sum(delay) as delay from (select $flex_timestamp as timestamp, extract_epoch(substring((regexp_matches(msg, 'delay=[0-9]{2}:[0-9]{2}:[0-9]{2}'))[1] from 7 for 8)) as delay from $log where $filter and msg like '% delay=%:%:%') t group by timestamp order by timestamp desc)### t group by hod having sum(delay)>0 order by hod"
        set protected enable
    next

    edit "fml-history-Total-Message-Transmission-Delay"
        set description "FortiMail history total message transmission delay"
        set dev-type FortiMail
        set log-type event
        set query "select $flex_timescale(timestamp) as hod, sum(delay) as total_delay from ###(select timestamp, sum(delay) as delay from (select $flex_timestamp as timestamp, extract_epoch(substring(msg, string_position('xdelay=', msg)+length('xdelay='), length('hh:mm:ss'))) as delay from $log where $filter and msg like '%xdelay=%:%:%') t group by timestamp order by timestamp desc)### t group by hod order by hod"
        set protected enable
    next

    edit "fml-history-Top-IP-Policy"
        set description "FortiMail history top IP policy"
        set dev-type FortiMail
        set log-type history
        set query "select split_part(polid, ':', 2) as acl, count(*) as totalnum from $log where $filter group by acl order by totalnum desc"
        set protected enable
    next

    edit "fml-history-Top-Recipient-Policy"
        set description "FortiMail history top recipient policy"
        set dev-type FortiMail
        set log-type history
        set query "select split_part(polid, ':', 3) as acl, count(*) as totalnum from $log where $filter group by acl order by totalnum desc"
        set protected enable
    next

    edit "fml-history-Top-Access-List"
        set description "FortiMail history top access list"
        set dev-type FortiMail
        set log-type history
        set query "select split_part(polid, ':', 1) as acl, count(*) as totalnum from $log where $filter group by acl order by totalnum desc"
        set protected enable
    next

    edit "fml-history-Top-Spammed-Domains"
        set description "FortiMail history top spammed domains"
        set dev-type FortiMail
        set log-type history
        set query "select email_domain(`to`) as dst_domain, classifier, count(*) as totalnum from $log where $filter and disposition!='Accept' and email_domain(`to`) is not null group by dst_domain, classifier order by totalnum desc"
        set protected enable
    next

    edit "fml-history-Top-Spammed-Users"
        set description "FortiMail history top spammed users"
        set dev-type FortiMail
        set log-type history
        set query "select email_domain(`to`) as dst_domain, email_user(`to`) as dst_user, count(*) as totalnum from $log where $filter and disposition!='Accept' and `to` is not null group by dst_domain, dst_user order by totalnum desc"
        set protected enable
   next

    edit "fml-history-Top-Classifiers-By-Hour"
        set description "FortiMail history top classifiers by hour"
        set dev-type FortiMail
        set log-type history
        set query "select $hour_of_day as hodex, classifier, count(*) as totalnum from $log where $filter group by hodex, classifier order by hodex"
        set protected enable
    next

    edit "fml-history-Top-Disposition-Classifiers"
        set description "FortiMail history top disposition classifiers"
        set dev-type FortiMail
        set log-type history
        set query "select disposition, classifier, count(*) as totalnum from $log where $filter group by disposition, classifier order by totalnum desc"
        set protected enable
    next

    edit "fml-history-Top-Subjects"
        set description "FortiMail history top subjects"
        set dev-type FortiMail
        set log-type history
        set query "select disposition, subject, count(*) as totalnum from $log where $filter and subject is not null group by disposition, subject order by disposition asc, totalnum desc"
        set protected enable
    next

    edit "fml-Total-Counts-Inbound"
        set description "Total Inbound Messages"
        set dev-type FortiMail
        set log-type history
        set query "select sum(totalnum) as totalnum from ###(select count(*) as totalnum, sum(case when virus is not null then 1 else 0 end) as total_malware, sum(case when classifier!='Not Spam' then 1 else 0 end) as total_threat from $log where $filter and direction='in')### t"
        set protected enable
    next
    edit "fml-Total-Malware-Inbound"
        set description "Total Malware Inbound"
        set dev-type FortiMail
        set log-type history
        set query "select sum(total_malware) as totalnum from ###(select count(*) as totalnum, sum(case when virus is not null then 1 else 0 end) as total_malware, sum(case when classifier!='Not Spam' then 1 else 0 end) as total_threat from $log where $filter and direction='in')### t"
        set protected enable
    next
    edit "fml-Total-Classified-Inbound"
        set description "Total Threats Identified"
        set dev-type FortiMail
        set log-type history
        set query "select sum(total_threat) as totalnum from ###(select count(*) as totalnum, sum(case when virus is not null then 1 else 0 end) as total_malware, sum(case when classifier!='Not Spam' then 1 else 0 end) as total_threat from $log where $filter and direction='in')### t"
        set protected enable
    next
    edit "fml-Percentage-of-Unwanted-Mails"
        set description "Percentage of Unwanted/Bulk/Spam Mails"
        set dev-type FortiMail
        set log-type history
        set query "select cast((case when sum(totalnum) > 0 then round(sum(total_threat)*100/sum(totalnum)) else 0 end) as decimal(18, 2)) as percentage_hits from ###(select count(*) as totalnum, sum(case when virus is not null then 1 else 0 end) as total_malware, sum(case when classifier!='Not Spam' then 1 else 0 end) as total_threat from $log where $filter and direction='in')### t"
        set protected enable
    next
    edit "fml-Percentage-of-Known-Malware"
        set description "Percentage of Known Malware"
        set dev-type FortiMail
        set log-type history
        set query "select cast((case when sum(totalnum) > 0 then round(sum(total_malware)*100/sum(totalnum)) else 0 end) as decimal(18, 2)) as percentage_hits from ###(select count(*) as totalnum, sum(case when virus is not null then 1 else 0 end) as total_malware, sum(case when classifier!='Not Spam' then 1 else 0 end) as total_threat from $log where $filter and direction='in')### t"
        set protected enable
    next
    edit "fml-Impersonation-Analysis-Total-Count"
        set description "Total Impersonation Analysis Identified"
        set dev-type FortiMail
        set log-type history
        set query "select count(*) as totalnum from $log where $filter and classifier='Impersonation Analysis'"
        set protected enable
    next
    edit "fml-Messages-Malware-Inbound"
        set description "Total Malware Identified by Anti-Malware Tools"
        set dev-type FortiMail
        set log-type history
        set query "select classifier, count(*) as totalnum from $log where $filter and virus is not null and classifier in ('Virus Signature','FortiSandbox File', 'FortiSandbox URL', 'FortiSandbox NoResult','FortiGuard Outbreak','FortiGuard WebFilter') and direction='in' group by classifier order by totalnum desc"
        set protected enable
    next
    edit "fml-Messages-AntiVirus-Inbound-with-Details"
        set description "Identified Known Viruses"
        set dev-type FortiMail
        set log-type history
        set query "select hfrom as mailfrom, subject as mail_subject, regexp_replace(virus,'^.*:', '') as virus_type, count(*) as totalnum from $log where $filter and classifier not in ('FortiSandbox File', 'FortiSandbox URL', 'FortiSandbox NoResult') and virus is not null and virus not like ('%uri%') and virus not like ('%Unknown%') group by mailfrom, subject, virus order by totalnum desc"
        set protected enable
    next
    edit "fml-Messages-FSA-Inbound-Only-URI"
        set description "FortiSandbox Scanned URI"
        set dev-type FortiMail
        set log-type virus
        set query "select split_part(msg, ' ', 2) as uri, count(*) as total_number from $log where $filter and msg like ('Uri% has been sent to FortiSandbox%') group by uri order by total_number desc"
        set protected enable
    next
    edit "fml-Impersonation-Analysis-Senders"
        set description "Impersonation Analysis Senders"
        set dev-type FortiMail
        set log-type history
        set query "select `classifier`, `from` as sender, count(*) as totalnum from $log where $filter and classifier='Impersonation Analysis' group by `classifier`, sender order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Number-of-Incoming-Mails"
        set description "Number of Incoming Mails"
        set dev-type FortiMail
        set log-type history
        set query "select sum(totalnum) as totalnum from ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where direction='in'"
        set protected enable
    next
    edit "fml-domain-Number-of-Outgoing-Mails"
        set description "Number of Outgoing Mails"
        set dev-type FortiMail
        set log-type history
        set query "select sum(totalnum) as totalnum from ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where direction='out'"
        set protected enable
    next
    edit "fml-domain-Total-Spam-Mail"
        set description "FortiMail Total Spam Mail"
        set dev-type FortiMail
        set log-type history
        set query "select sum(totalnum) as totalnum from ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where is_spam order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Total-Mail-with-Virus"
        set description "FortiMail Total Mail with Virus"
        set dev-type FortiMail
        set log-type history
        set query "select sum(totalnum) as totalnum from ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where virus is not null order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Total-Mail-Sender"
        set description "FortiMail Total Mail Sender Domain"
        set dev-type FortiMail
        set log-type history
        set query "select count(distinct sender) as totalnum from ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t "
        set protected enable
    next
    edit "fml-domain-Total-Mail-Recipient"
        set description "FortiMail Total Mail Recipient"
        set dev-type FortiMail
        set log-type history
        set query "select count(distinct `to`) as totalnum from ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t "
        set protected enable
    next
    edit "fml-domain-Top-Virus"
        set description "Fortimail Top Virus by Count"
        set dev-type FortiMail
        set log-type history
        set query "select virus_s as virus, sum(totalnum) as totalnum from (select unnest(string_to_array(virus, ',')) as virus_s, sum(totalnum) as totalnum from ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where virus is not null group by virus_s) t group by virus order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Virus-Category"
        set description "FortiMail Virus Category"
        set dev-type FortiMail
        set log-type history
        set query "select virus, string_agg(distinct classifier::text, ',') as classifier_agg, sum(totalnum) as totalnum from (select unnest(string_to_array(virus, ',')) as virus, classifier, sum(totalnum) as totalnum from ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where virus is not null and direction='in' and classifier is not null group by virus, classifier) t group by virus order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Top-Virus-Sender-with-Aggregation"
        set description "Fortimail Top Virus Sender Domain with Virus"
        set dev-type FortiMail
        set log-type history
        set query "select sender, string_agg(distinct virus, ',') as virus_agg, sum(totalnum) as totalnum from (select sender, unnest(string_to_array(virus, ',')) as virus, sum(totalnum) as totalnum from ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where virus is not null and direction='in' group by sender, virus) t group by sender order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Top-Spam-Sender-with-Category"
        set description "Fortimail Top Spam Sender With Category"
        set dev-type FortiMail
        set log-type history
        set query "select sender, classifier, sum(totalnum) as totalnum from ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where is_spam and direction='in' group by sender, classifier order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Top-Sender-Domain"
        set description "FortiMail Top Sender Domain by Mail Count"
        set dev-type FortiMail
        set log-type history
        set query "select sender as src_domain, sum(totalnum) as totalnum from ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where direction='in' group by src_domain order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Top-Country-Sender"
        set description "FortiMail Top Country Sender"
        set dev-type FortiMail
        set log-type history
        set query "select client_cc as country_cc, sum(totalnum) as totalnum from ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where client_cc is not null and direction='in' group by country_cc order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Top-Spam-Subject"
        set description "FortiMail Top Spam Subject by Mail Count"
        set dev-type FortiMail
        set log-type history
        set query "select spam_subject as subject, sum(totalnum) as totalnum from ###(select domain, spam_subject, totalnum from (select *, row_number() OVER (PARTITION BY domain ORDER BY totalnum DESC) AS domain_rank from (select domain, spam_subject, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query where spam_subject is not null group by domain, spam_subject ) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, spam_subject, totalnum from (select *, row_number() OVER (PARTITION BY domain ORDER BY totalnum DESC) AS domain_rank from (select domain, spam_subject, sum(totalnum) as totalnum from ###LOG### group by domain, spam_subject) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t group by subject order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Mail-Category"
        set description "FortiMail Top Category by Mail Count"
        set dev-type FortiMail
        set log-type history
        set query "select classifier, sum(totalnum) as totalnum from  ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where classifier is not null group by classifier order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Spam-Category"
        set description "FortiMail Top Spam Category"
        set dev-type FortiMail
        set log-type history
        set query "select classifier, sum(totalnum) as totalnum from  ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where is_spam and direction='in' group by classifier order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Top-Spammed-Users-with-Category"
        set description "FortiMail Top Spammed User with Category"
        set dev-type FortiMail
        set log-type history
        set query " select recipient, classifier, totalnum, sum(totalnum) over (partition by recipient) as total_num from (select `to` as recipient, classifier, sum(totalnum) as totalnum from  ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where is_spam and direction='in' group by recipient, classifier order by totalnum desc) t order by total_num desc"
        set protected enable
    next
    edit "fml-domain-Top-Spammed-Category-with-Users"
        set description "FortiMail Top Spam Category with User"
        set dev-type FortiMail
        set log-type history
        set query " select classifier, recipient, totalnum, sum(totalnum) over (partition by classifier) as total_num from (select `to` as recipient, classifier, sum(totalnum) as totalnum from  ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where is_spam and direction='in' group by recipient, classifier order by totalnum desc) t order by total_num desc"
        set protected enable
    next
    edit "fml-domain-Top-Virus-Recipient-with-Aggregation"
        set description "FortiMail top virus recipient by Count"
        set dev-type FortiMail
        set log-type history
        set query "select recipient, string_agg(distinct virus, ',') as virus_agg, sum(totalnum) as totalnum from (select `to` as recipient, unnest(string_to_array(virus, ',')) as virus, sum(totalnum) as totalnum from ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where virus is not null and direction='in' group by recipient, virus) t group by recipient order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Top-Spam-Recipient"
        set description "FortiMail Top Spam Recipient"
        set dev-type FortiMail
        set log-type history
        set query "select `to` as recipient, sum(totalnum) as totalnum from  ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where is_spam and direction='in' group by recipient order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Top-Recipient-Domain"
        set description "FortiMail Top Recipient Domain"
        set dev-type FortiMail
        set log-type history
        set query "select email_domain(`to`) as dst_domain, sum(totalnum) as totalnum from  ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where direction='out' group by dst_domain order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Top-Local-User"
        set description "Fortimail Domain Top Local User"
        set dev-type FortiMail
        set log-type history
        set query "select `to` as recipient, sum(totalnum) as totalnum from ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where direction='in' group by recipient order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Top-Virus-Recipient"
        set description "FortiMail Top Virus Recipient"
        set dev-type FortiMail
        set log-type history
        set query "select `to` as recipient, sum(totalnum) as totalnum from ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where virus is not null and direction='in' group by recipient order by totalnum desc"
        set protected enable
    next
end

config sql-report chart
    edit "fml-History-Top10-Client-IP"
        set disp-name "Top History Client IP"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 client IP in FortiMail history"
        set dataset "fml-History-Top-Client-IP"
        set chart-type table
        config table-columns
            edit 1
                set header "Client IP"
                set data-binding "clientip"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Local-User"
        set disp-name "Top History Local User"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 local users in FortiMail history"
        set dataset "fml-History-Top-Local-User"
        set chart-type table
        config table-columns
            edit 1
                set header "Local User"
                set data-binding "local_user"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Remote-Address"
        set disp-name "Top History Remote Address"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 remote address in FortiMail history"
        set dataset "fml-History-Top-Remote-Address"
        set chart-type table
        config table-columns
            edit 1
                set header "Remote Address"
                set data-binding "remote_addr"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Virus"
        set disp-name "Top History Virus"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 viruses in FortiMail history"
        set dataset "fml-History-Top-Virus"
        set chart-type table
        config table-columns
            edit 1
                set header "Virus"
                set data-binding "virus"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Client-MSISDN"
        set disp-name "Top History Client MSISDN"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 clients MSISDN in FortiMail history"
        set dataset "fml-History-Top-Client-MSISDN"
        set chart-type table
        config table-columns
            edit 1
                set header "MSISDN"
                set data-binding "msisdn"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Client-Endpoint"
        set disp-name "Top History Client Endpoint"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 clients endpoint in FortiMail history"
        set dataset "fml-History-Top-Client-Endpoint"
        set chart-type table
        config table-columns
            edit 1
                set header "Endpoint"
                set data-binding "endpoint"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Sender"
        set disp-name "Top History Sender"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 senders in FortiMail history"
        set dataset "fml-History-Top-Sender"
        set chart-type table
        config table-columns
            edit 1
                set header "Sender"
                set data-binding "sender"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Sender-IP"
        set disp-name "Top History Sender IP"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 sender IP in FortiMail history"
        set dataset "fml-History-Top-Sender-IP"
        set chart-type table
        config table-columns
            edit 1
                set header "Sender IP"
                set data-binding "sender_ip"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Local-Sender"
        set disp-name "Top History Local Sender"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 local senders in FortiMail history"
        set dataset "fml-History-Top-Local-Sender"
        set chart-type table
        config table-columns
            edit 1
                set header "Sender"
                set data-binding "sender"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Remote-Sender"
        set disp-name "Top History Remote Sender"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 remote senders in FortiMail history"
        set dataset "fml-History-Top-Remote-Sender"
        set chart-type table
        config table-columns
            edit 1
                set header "Sender"
                set data-binding "sender"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Sender-MSISDN"
        set disp-name "Top History Sender MSISDN"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 senders MSISDN in FortiMail history"
        set dataset "fml-History-Top-Sender-MSISDN"
        set chart-type table
        config table-columns
            edit 1
                set header "MSISDN"
                set data-binding "msisdn"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Sender-Endpoint"
        set disp-name "Top History Sender Endpoint"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 senders Endpoint in FortiMail history"
        set dataset "fml-History-Top-Sender-Endpoint"
        set chart-type table
        config table-columns
            edit 1
                set header "Endpoint"
                set data-binding "endpoint"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Recipient"
        set disp-name "Top History Recipient"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 recipients in FortiMail history"
        set dataset "fml-History-Top-Recipient"
        set chart-type table
        config table-columns
            edit 1
                set header "Recipient"
                set data-binding "recipient"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Local-Recipient"
        set disp-name "Top History Local Recipient"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 local recipients in FortiMail history"
        set dataset "fml-History-Top-Local-Recipient"
        set chart-type table
        config table-columns
            edit 1
                set header "Recipient"
                set data-binding "recipient"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Remote-Recipient"
        set disp-name "Top History Remote Recipient"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 remote recipients in FortiMail history"
        set dataset "fml-History-Top-Remote-Recipient"
        set chart-type table
        config table-columns
            edit 1
                set header "Recipient"
                set data-binding "recipient"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Mail-Dest-IP"
        set disp-name "Top History Mail Dest IP"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 mail destination IP in FortiMail history"
        set dataset "fml-History-Top-Mail-Dest-IP"
        set chart-type table
        config table-columns
            edit 1
                set header "Destination IP"
                set data-binding "dst_ip"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Count-Total-Sent-Received"
        set disp-name "Top History Total Sent Received"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 total sent received in FortiMail history"
        set dataset "fml-History-Count-Total-Sent-Received"
        set chart-type table
        config table-columns
            edit 1
                set header "Direction"
                set data-binding "direction"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Virus-Sender"
        set disp-name "Top History Virus Sender"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 virus senders in FortiMail history"
        set dataset "fml-History-Top-Virus-Sender"
        set chart-type table
        config table-columns
            edit 1
                set header "Sender Virus"
                set data-binding "virus_sender"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Virus-IP"
        set disp-name "Top History Virus IP"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 virus IP in FortiMail history"
        set dataset "fml-History-Top-Virus-IP"
        set chart-type table
        config table-columns
            edit 1
                set header "Virus IP"
                set data-binding "virus_ip"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Local-Virus-Sender"
        set disp-name "Top History Local Virus Sender"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 local virus senders in FortiMail history"
        set dataset "fml-History-Top-Local-Virus-Sender"
        set chart-type table
        config table-columns
            edit 1
                set header "Sender Virus"
                set data-binding "virus_sender"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Remote-Virus-Sender"
        set disp-name "Top History Remote Virus Sender"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 remote virus senders in FortiMail history"
        set dataset "fml-History-Top-Remote-Virus-Sender"
        set chart-type table
        config table-columns
            edit 1
                set header "Sender Virus"
                set data-binding "virus_sender"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Virus-MSISDN"
        set disp-name "Top History Virus MSISDN"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 viruses MSISDN in FortiMail history"
        set dataset "fml-History-Top-Virus-MSISDN"
        set chart-type table
        config table-columns
            edit 1
                set header "MSISDN"
                set data-binding "msisdn"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Virus-Endpoint"
        set disp-name "Top History Virus Endpoint"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 viruses endpoint in FortiMail history"
        set dataset "fml-History-Top-Virus-Endpoint"
        set chart-type table
        config table-columns
            edit 1
                set header "Endpoint"
                set data-binding "endpoint"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Virus-Recipient"
        set disp-name "Top History Virus Recipient"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 virus recipients in FortiMail history"
        set dataset "fml-History-Top-Virus-Recipient"
        set chart-type table
        config table-columns
            edit 1
                set header "Recipient"
                set data-binding "recipient"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Local-Virus-Recipient"
        set disp-name "Top History Local Virus Recipient"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 local virus recipients in FortiMail history"
        set dataset "fml-History-Top-Local-Virus-Recipient"
        set chart-type table
        config table-columns
            edit 1
                set header "Recipient"
                set data-binding "recipient"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Remote-Virus-Recipient"
        set disp-name "Top History Remote Virus Recipient"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 remote virus recipients in FortiMail history"
        set dataset "fml-History-Top-Remote-Virus-Recipient"
        set chart-type table
        config table-columns
            edit 1
                set header "Recipient"
                set data-binding "recipient"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Virus-Dest-IP"
        set disp-name "Top History Virus Dest IP"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 virus destination IP in FortiMail history"
        set dataset "fml-History-Top-Virus-Dest-IP"
        set chart-type table
        config table-columns
            edit 1
                set header "Destination IP"
                set data-binding "dst_ip"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Total-Active-EmailAddress"
        set disp-name "Top History Total Active EmailAddress"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 total active email address per domain"
        set dataset "fml-Active-EmailAddress-Summary"
        set chart-type table
            config table-columns
                edit 1
                    set header "Domain"
                    set data-binding "domain_name"
                    set data-top 10
                    set column-width 40
                next
                edit 2
                    set header "Total"
                    set data-type aggregate
                    set data-binding "totalnum"
                    set column-attr count
                    set column-width 30
                next
            end
        set protected enable
    next

    edit "fml-History-Average-Size-by-Hour"
        set disp-name "History Average Size by Hour"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Average size of messages per hour in FortiMail history"
        set dataset "fml-Average-Size-by-Hour"
        set chart-type table
        config table-columns
            edit 1
                set header "Hour"
                set data-binding "timeperiod"
                set data-top 25
                set column-width 40
            next
            edit 2
                set header "Size (Bytes)"
                set data-binding "avg_size"
                set column-graph-type bar
                set column-width 60
                set column-span 2
            next
            edit 3
                set data-binding "avg_size"
                set column-attr bandwidth
            next
        end
        set protected enable
    next

    edit "fml-History-Messages-per-Hour"
        set disp-name "History Messages per Hour"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Number of mails per hour in FortiMail history"
        set dataset "fml-Messages-per-Hour"
        set chart-type table
        config table-columns
            edit 1
                set header "Hour"
                set data-binding "timeperiod"
                set data-top 25
                set column-width 40
            next
            edit 2
                set header "Messages"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fml-History-Total-Size-by-Hour"
        set disp-name "History Total Size by Hour"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Total size of exchanged mails per hour in FortiMail history"
        set dataset "fml-Total-Size-by-Hour"
        set chart-type table
        config table-columns
            edit 1
                set header "Hour"
                set data-binding "timeperiod"
                set data-top 25
                set column-width 40
            next
            edit 2
                set header "Size"
                set data-binding "tsize"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "tsize"
                set column-attr bandwidth
            next
        end
        set protected enable
    next

    edit "fml-History-Connections-per-Hour"
        set disp-name "History Connections per Hour"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Number of connections per hour in FortiMail history"
        set dataset "fml-Connections-per-Hour"
        set chart-type table
        config table-columns
            edit 1
                set header "Hour"
                set data-binding "timeperiod"
                set data-top 25
                set column-width 40
            next
            edit 2
                set header "Connections"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fml-Average-Size-of-Mails"
        set disp-name "Average Size of Mails"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Average size of mails in FortiMail history"
        set dataset "fml-history-Average-Size-of-Mails"
        set chart-type area
        config table-columns
            edit 1
                set header "Time"
                set data-binding "timescale"
                set column-attr time
                set data-top 20
            next
            edit 2
                set data-binding "avg_size_in"
                set column-attr bandwidth
                set column-graph-type line-up
                set legend "Size In"
            next
            edit 3
                set data-binding "avg_size_out"
                set column-attr bandwidth
                set column-graph-type line-down
                set legend "Size Out"
            next
        end
        set protected enable
    next

    edit "fml-Total-Size-of-Mails"
        set disp-name "Total Size of Mails"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Total size of mails in FortiMail history"
        set dataset "fml-history-Total-Size-of-Mails"
        set chart-type area
        config table-columns
            edit 1
                set header "Time"
                set data-binding "timescale"
                set column-attr time
                set data-top 20
            next
            edit 2
                set data-binding "size_in"
                set column-attr bandwidth
                set column-graph-type line-up
                set legend "Size In"
            next
            edit 3
                set data-binding "size_out"
                set column-attr bandwidth
                set column-graph-type line-down
                set legend "Size Out"
            next
        end
        set protected enable
    next

    edit "fml-Number-of-Mail-Connections"
        set disp-name "Number of Mail Connections"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Number of mail connections in FortiMail history"
        set dataset "fml-history-Number-of-Mail-Connections"
        set chart-type area
        config table-columns
            edit 1
                set header "Time"
                set data-binding "timescale"
                set column-attr time
                set data-top 20
            next
            edit 2
                set data-binding "con_in"
                set column-attr count
                set column-graph-type line-up
                set legend "Connections In"
            next
            edit 3
                set data-binding "con_out"
                set column-attr count
                set column-graph-type line-down
                set legend "Connections Out"
            next
        end
        set protected enable
    next

    edit "fml-Number-of-Mails"
        set disp-name "Number of Mails"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Number of mails in FortiMail history"
        set dataset "fml-history-Number-of-Mails"
        set chart-type area
        config table-columns
            edit 1
                set header "Time"
                set data-binding "timescale"
                set column-attr time
                set data-top 20
            next
            edit 2
                set data-binding "count_in"
                set column-attr count
                set column-graph-type line-up
                set legend "Mails In"
            next
            edit 3
                set data-binding "count_out"
                set column-attr count
                set column-graph-type line-down
                set legend "Mails Out"
            next
        end
        set protected enable
    next

    edit "fml-Total-Message-Delay"
        set disp-name "Total Message Delay"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Total message delay in FortiMail history"
        set dataset "fml-history-Total-Message-Delay"
        set chart-type area
        config table-columns
            edit 1
                set header "Time"
                set data-binding "hod"
                set column-attr time
                set data-top 20
            next
            edit 2
                set data-binding "total_delay"
                set column-attr timespan
                set column-graph-type line-up
                set legend "Delay"
            next
        end
        set protected enable
    next

    edit "fml-Total-Message-Transmission-Delay"
        set disp-name "Total Message TransmissionDelay"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Total message transmissionDelay in FortiMail history"
        set dataset "fml-history-Total-Message-Transmission-Delay"
        set chart-type area
        config table-columns
            edit 1
                set header "Time"
                set data-binding "hod"
                set column-attr time
                set data-top 20
            next
            edit 2
                set data-binding "total_delay"
                set column-attr timespan
                set column-graph-type line-up
                set legend "Delay"
            next
        end
        set protected enable
    next

    edit "fml-Top-IP-Policy"
        set disp-name "Top 20 IP Policy"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 20 IP policy in FortiMail history"
        set dataset "fml-history-Top-IP-Policy"
        set chart-type table
        config table-columns
            edit 1
                set header "Policy"
                set data-binding "acl"
                set data-top 20
                set column-width 40
            next
            edit 2
                set header "Total"
                set data-binding "totalnum"
                set column-graph-type bar
                set column-span 2
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fml-Top-Recipient-Policy"
        set disp-name "Top 20 Recipient Policy"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 20 recipient policy in FortiMail history"
        set dataset "fml-history-Top-Recipient-Policy"
        set chart-type table
        config table-columns
            edit 1
                set header "Recipient Policy"
                set data-binding "acl"
                set data-top 20
                set column-width 40
            next
            edit 2
                set header "Total"
                set data-binding "totalnum"
                set column-graph-type bar
                set column-span 2
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fml-Top-Access-List"
        set disp-name "Top 20 Access List"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 20 access list in FortiMail history"
        set dataset "fml-history-Top-Access-List"
        set chart-type table
        config table-columns
            edit 1
                set header "Access List"
                set data-binding "acl"
                set data-top 20
                set column-width 40
            next
            edit 2
                set header "Total"
                set data-binding "totalnum"
                set column-graph-type bar
                set column-span 2
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fml-Top-Spammed-Domains"
        set disp-name "Top Spammed Domains"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top spammed domains in FortiMail history"
        set dataset "fml-history-Top-Spammed-Domains"
        set order-by "totalnum"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "Domain"
                set data-binding "dst_domain"
                set data-top 6
            next
            edit 2
                set data-type drilldown
                set data-binding "classifier"
                set data-top 3
            next
            edit 3
                set header "Total"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
        set protected enable
    next

    edit "fml-Top-Spammed-Users"
        set disp-name "Top Spammed Users"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top spammed users in FortiMail history"
        set dataset "fml-history-Top-Spammed-Users"
        set order-by "totalnum"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "Domain"
                set data-binding "dst_domain"
                set data-top 6
            next
            edit 2
                set data-type drilldown
                set data-binding "dst_user"
                set data-top 3
            next
            edit 3
                set header "Total"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
        set protected enable
    next

    edit "fml-Top-Classifiers-By-Hour"
        set disp-name "Top Classifiers by Hour"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top classifiers by hour in FortiMail history"
        set dataset "fml-history-Top-Classifiers-By-Hour"
        set order-by "totalnum"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "Hour"
                set data-binding "hodex"
                set data-top 24
            next
            edit 2
                set data-type drilldown
                set data-binding "classifier"
                set data-top 3
            next
            edit 3
                set header "Total"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
        set protected enable
    next

    edit "fml-Top-Disposition-Classifiers"
        set disp-name "Top Disposition Classifiers"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top disposition  classifiers in FortiMail history"
        set dataset "fml-history-Top-Disposition-Classifiers"
        set order-by "totalnum"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "Disposition"
                set data-binding "disposition"
                set data-top 6
            next
            edit 2
                set data-type drilldown
                set data-binding "classifier"
                set data-top 3
            next
            edit 3
                set header "Total"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
        set protected enable
    next

    edit "fml-Top-Subjects"
        set disp-name "Top 20 Subjects"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 20 subjects in FortiMail history"
        set dataset "fml-history-Top-Subjects"
        set chart-type table
        config table-columns
            edit 1
                set header "Disposition"
                set data-binding "disposition"
                set data-top 20
            next
            edit 2
                set header "Subjects"
                set data-type drilldown
                set data-binding "subject"
            next
            edit 3
                set header "Total"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fml-Top-Disposition-Classifiers-Pie"
        set disp-name "Top Disposition Classifiers - Pie Chart"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top disposition classifiers in FortiMail history"
        set dataset "fml-history-Top-Disposition-Classifiers"
        set chart-type pie
        config table-columns
            edit 1
                set header "Classifier"
                set data-binding "classifier"
                set data-top 5
            next
            edit 2
                set header "Count"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
        set protected enable
    next
    edit "fml-Messages-Malware-Inbound"
        set disp-name "Total Malware Identified by Anti-Malware Tools"
        set description "Total Malware Identified by Anti-Malware Tools"
        set category "FortiMail"
        set dev-type FortiMail
        set dataset "fml-Messages-Malware-Inbound"
        set chart-type pie
        config table-columns
            edit 1
                set header "Malware Tools"
                set data-binding "classifier"
                set data-top 5
            next
            edit 2
                set header "Count"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
        set protected enable
    next
    edit "fml-Messages-AntiVirus-Inbound-with-Details"
        set disp-name "Identified Known Viruses"
        set description "Identified Known Viruses"
        set category "FortiMail"
        set dev-type FortiMail
        set dataset "fml-Messages-AntiVirus-Inbound-with-Details"
        set chart-type table
        config table-columns
            edit 1
                set header "Sender"
                set data-binding "mailfrom"
                set data-top 10
            next
            edit 2
                set header "Mail Subject"
                set data-binding "mail_subject"
            next
            edit 3
                set header "Virus"
                set data-binding "virus_type"
            next
            edit 4
                set header "Total Number"
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-Messages-FSA-Inbound-Only-URI"
        set disp-name "FortiSandbox Scanned URI"
        set description "FortiSandbox Scanned URI"
        set category "FortiMail"
        set dev-type FortiMail
        set dataset "fml-Messages-FSA-Inbound-Only-URI"
        set chart-type table
        config table-columns
            edit 1
                set header "URL"
                set data-binding "uri"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "total_number"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "total_number"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-Impersonation-Analysis-Senders"
        set disp-name "Impersonation Analysis Senders"
        set description "Impersonation Analysis Senders"
        set category "FortiMail"
        set dev-type FortiMail
        set dataset "fml-Impersonation-Analysis-Senders"
        set chart-type table
        config table-columns
            edit 1
                set header "Classifier"
                set data-binding "classifier"
                set data-top 10
            next
            edit 2
                set header "From"
                set data-binding "sender"
            next
            edit 3
                set header "Count"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
            next
            edit 4
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-domain-Mail-Category"
        set disp-name "FortiMail Top Category by Mail Count"
        set description "FortiMail Top Category by Mail Count"
        set category "FortiMail"
        set dev-type FortiMail
        set dataset "fml-domain-Mail-Category"
        set chart-type donut
        set chart-style "{\"legend-format\":\"${name} (${val})\", \"legend-font-size\": \"9px\", \"show-value\": \"enable\", \"legend-position\":\"right\", \"inner-content\":\"summary\", \"show-header\": \"enable\", \"legend-columns\":\"2\"}"
        set include-other disable
        config table-columns
            edit 1
                set header ""
                set data-binding "classifier"
                set data-top 10
            next
            edit 2
                set header "Mails"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-domain-Top-Virus-Count"
        set disp-name "FortiMail Top Virus by Count"
        set description "FortiMail Top Virus by Count"
        set category "FortiMail"
        set dev-type FortiMail
        set dataset "fml-domain-Top-Virus"
        set chart-type donut
        set chart-style "{\"legend-format\":\"${name} (${val})\", \"legend-font-size\": \"9px\", \"show-value\": \"enable\", \"legend-position\":\"right\", \"inner-content\":\"summary\", \"show-header\": \"enable\", \"legend-columns\":\"2\"}"
        set include-other disable
        config table-columns
            edit 1
                set header ""
                set data-binding "virus"
                set data-top 10
            next
            edit 2
                set header "Virus"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-domain-Top-Local-User-Count"
        set disp-name "FortiMail Top Recipient by Mail Count"
        set description "FortiMail Top Recipient by Mail Count"
        set category "FortiMail"
        set dev-type FortiMail
        set dataset "fml-domain-Top-Local-User"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\", \"height\":\"300\", \"fixed-bar-width\":\"20px\", \"y-label\": \"flat\", \"bar-color\": \"#4e79a7\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "Recipient"
                set data-binding "recipient"
                set data-top 10
            next
            edit 2
                set header "Total Number"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-domain-Top-Virus-Recipient"
        set disp-name "FortiMail Top Virus Recipient"
        set category "FortiMail"
        set dev-type FortiMail
        set description "FortiMail Top Virus Recipient"
        set dataset "fml-domain-Top-Virus-Recipient"
        set chart-type donut
        set chart-style "{\"legend-format\":\"${name} (${val})\", \"legend-font-size\": \"9px\", \"show-value\": \"enable\", \"legend-position\":\"right\", \"inner-content\":\"summary\", \"show-header\": \"enable\", \"legend-columns\":\"1\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "Recipient"
                set data-binding "recipient"
                set data-top 10
            next
            edit 2
                set header "Recipients"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-domain-Top-Spam-Recipient"
        set disp-name "FortiMail Top Spam Recipient"
        set category "FortiMail"
        set dev-type FortiMail
        set description "FortiMail Top Spam Recipient"
        set dataset "fml-domain-Top-Spam-Recipient"
        set chart-type donut
        set chart-style "{\"legend-format\":\"${name} (${val})\", \"legend-font-size\": \"9px\", \"show-value\": \"enable\", \"legend-position\":\"right\", \"inner-content\":\"summary\", \"show-header\": \"enable\", \"legend-columns\":\"1\"}"
        set include-other disable
        config table-columns
            edit 1
                set header ""
                set data-binding "recipient"
                set data-top 10
            next
            edit 2
                set header "Recipients"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-domain-Top-Spam-Subject"
        set disp-name "FortiMail Top Spam Subject by Mail Count"
        set category "FortiMail"
        set dev-type FortiMail
        set description "FortiMail Top Spam Subject by Mail Count"
        set dataset "fml-domain-Top-Spam-Subject"
        set chart-type donut
        set chart-style "{\"legend-format\":\"${name} (${val})\", \"legend-font-size\": \"9px\", \"show-value\": \"enable\", \"legend-position\":\"right\", \"inner-content\":\"summary\", \"show-header\": \"enable\", \"legend-columns\":\"2\"}"
        set include-other disable
        config table-columns
            edit 1
                set header ""
                set data-binding "subject"
                set data-top 10
            next
            edit 2
                set header "Subjects"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-domain-Top-Sender-Domain"
        set disp-name "FortiMail Top Sender Domain by Mail Count"
        set category "FortiMail"
        set dev-type FortiMail
        set description "FortiMail Top Sender Domain by Mail Count"
        set dataset "fml-domain-Top-Sender-Domain"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\", \"show-header\": \"enable\",  \"fixed-bar-width\":\"20px\",\"legend-position\":\"top\", \"height\":\"540\", \"bar-color\": \"bubble-ring\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "Domain"
                set data-binding "src_domain"
                set data-top 10
            next
            edit 2
                set header "Sender"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fml-domain-Top-Recipient-Domain"
        set disp-name "FortiMail Top Recipient Domain"
        set category "FortiMail"
        set dev-type FortiMail
        set description "FortiMail Top Recipient Domain"
        set dataset "fml-domain-Top-Recipient-Domain"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\", \"show-header\": \"enable\",  \"fixed-bar-width\":\"20px\",\"legend-position\":\"top\", \"height\":\"540\", \"bar-color\": \"bubble-ring\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "Domain"
                set data-binding "dst_domain"
                set data-top 10
            next
            edit 2
                set header "Destination"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-domain-Spam-Category"
        set disp-name "FortiMail Top Spam Category"
        set description "FortiMail Top Spam Category"
        set category "FortiMail"
        set dev-type FortiMail
        set dataset "fml-domain-Spam-Category"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\", \"fixed-bar-width\":\"20px\", \"height\":\"440\", \"bar-color\": \"bubble-ring\", \"y-tick-max-len\": \"30\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "Category"
                set data-binding "classifier"
                set data-top 10
            next
            edit 2
                set header "Mails"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-domain-Top-Spammed-Users-with-Category-Table"
        set disp-name "FortiMail Top Spammed User with Category Table"
        set category "FortiMail"
        set dev-type FortiMail
        set description "FortiMail Top Spammed User with Category Table"
        set dataset "fml-domain-Top-Spammed-Users-with-Category"
        set chart-type table
        set chart-style "{\"table-scheme\": \"dark\", \"table-subtotal-bg-color\":\" \"}"
        set include-other enable
        config table-columns
            edit 1
                set header "Recipient"
                set data-binding "recipient"
                set column-width 32
                set data-top 5
            next
            edit 2
                set header "Category"
                set data-binding "classifier"
                set data-type drilldown
                set column-width 32
                set data-top 3
            next
            edit 3
                set header "Total Number"
                set data-binding "totalnum"
                set data-type aggregate
                set column-width 20
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-domain-Top-Spammed-Category-with-Users"
        set disp-name "FortiMail Top Spam Category with User"
        set category "FortiMail"
        set dev-type FortiMail
        set description "FortiMail Top Spam Category with User"
        set dataset "fml-domain-Top-Spammed-Category-with-Users"
        set chart-type bubble-ring
        set chart-style "{\"show-value\":\"enable\" }"
        set include-other disable
        config table-columns
            edit 1
                set header "Category"
                set data-binding "classifier"
                set data-top 10
            next
            edit 2
                set header "Recipient"
                set data-type drilldown
                set data-binding "recipient"
                set data-top 5
            next
            edit 3
                set header "Total Number"
                set data-binding "totalnum"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-domain-Top-Spam-Sender-with-Category"
        set disp-name "Fortimail Top Spam Sender With Category"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Fortimail Top Spam Sender With Category"
        set dataset "fml-domain-Top-Spam-Sender-with-Category"
        set chart-type table
        set chart-style "{\"table-scheme\": \"dark\", \"table-subtotal-bg-color\":\" \"}"
        set include-other enable
        config table-columns
            edit 1
                set header "Sender"
                set data-binding "sender"
                set column-width 32
                set data-top 5
            next
            edit 2
                set header "Category"
                set data-binding "classifier"
                set data-type drilldown
                set column-width 32
                set data-top 3
            next
            edit 3
                set header "Total Number"
                set data-binding "totalnum"
                set data-type aggregate
                set column-attr count
                set column-width 20
            next
        end
        set protected enable
    next
    edit "fml-domain-Virus-Category"
        set disp-name "FortiMail Virus Category"
        set category "FortiMail"
        set dev-type FortiMail
        set description "FortiMail Virus Category"
        set dataset "fml-domain-Virus-Category"
        set chart-type table
        set chart-style "{\"table-scheme\": \"dark\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "Virus"
                set data-binding "virus"
                set column-width 35
                set data-top 10
            next
            edit 2
                set header "Category"
                set data-binding "classifier_agg"
                set data-type raw
                set column-width 35
                set data-top 5
            next
            edit 3
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 30
            next
            edit 4
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-domain-Top-Virus-Sender-with-Aggregation"
        set disp-name "FortiMail Top Virus Sender Domain"
        set category "FortiMail"
        set dev-type FortiMail
        set description "FortiMail Top Virus Sender Domain"
        set dataset "fml-domain-Top-Virus-Sender-with-Aggregation"
        set chart-style "{\"table-scheme\": \"dark\"}"
        set chart-type table
        config table-columns
            edit 1
                set header "Sender"
                set data-binding "sender"
                set data-top 10
                set column-width 20
            next
            edit 2
                set header "Viruses"
                set data-binding "virus_agg"
                set column-style "{\"max-text-length\":256}"
                set column-width 50
            next
            edit 3
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 30
            next
            edit 4
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-domain-Top-Virus-Recipient-with-Aggregation"
        set disp-name "FortiMail Top Virus Recipient by Mail Count"
        set category "FortiMail"
        set dev-type FortiMail
        set description "FortiMail Top Virus Recipient by Mail Count"
        set dataset "fml-domain-Top-Virus-Recipient-with-Aggregation"
        set chart-type table
        set chart-style "{\"table-scheme\": \"dark\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "Recipient"
                set data-binding "recipient"
                set data-top 10
                set column-width 20
            next
            edit 2
                set header "Viruses"
                set data-binding "virus_agg"
                set column-style "{\"max-text-length\":256}"
                set column-width 50
            next
            edit 3
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 30
            next
            edit 4
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-domain-Top-Country-Sender"
        set disp-name "FortiMail Top Country Sender"
        set description "FortiMail Top Country Sender"
        set category "FortiMail"
        set dev-type FortiMail
        set dataset "fml-domain-Top-Country-Sender"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\", \"show-header\": \"enable\", \"height\":\"300\", \"fixed-bar-width\":\"20px\",  \"y-label\": \"flat\", \"bar-color\": \"bubble-ring\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "Country"
                set data-binding "country_cc"
                set column-attr country-code
                set data-top 10
            next
            edit 2
                set header "Senders"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
end

config sql-report macro
    edit "fml-Total-Counts-Inbound"
        set disp-name "Total Inbound Messages"
        set description "Total Inbound Messages"
        set dev-type FortiMail
        set dataset "fml-Total-Counts-Inbound"
        set data-binding "totalnum"
        set data-attr count
        set protected enable
    next
    edit "fml-Total-Malware-Inbound"
        set disp-name "Total Malware Identified"
        set description "Total Malware Identified"
        set dev-type FortiMail
        set dataset "fml-Total-Malware-Inbound"
        set data-binding "totalnum"
        set data-attr count
        set protected enable
    next
    edit "fml-Total-Classified-Inbound"
        set disp-name "Total Threats Identified"
        set description "Total Threats Identified"
        set dev-type FortiMail
        set dataset "fml-Total-Classified-Inbound"
        set data-binding "totalnum"
        set data-attr count
        set protected enable
    next
    edit "fml-Percentage-of-Unwanted-Mails"
        set disp-name "Percentage of Unwanted-Bulk-Spam Mails"
        set description "Percentage of Unwanted-Bulk-Spam Mails"
        set dev-type FortiMail
        set dataset "fml-Percentage-of-Unwanted-Mails"
        set data-binding "percentage_hits"
        set protected enable
    next
    edit "fml-Percentage-of-Known-Malware"
        set disp-name "Percentage of Known Malware"
        set description "Percentage of Known Malware"
        set dev-type FortiMail
        set dataset "fml-Percentage-of-Known-Malware"
        set data-binding "percentage_hits"
        set protected enable
    next
    edit "fml-Impersonation-Analysis-Total-Count"
        set disp-name "Total Impersonation Analysis Identified"
        set description "Total Impersonation Analysis Identified"
        set dev-type FortiMail
        set dataset "fml-Impersonation-Analysis-Total-Count"
        set data-binding "totalnum"
        set data-attr count
        set protected enable
    next
    edit "fml-domain-Number-of-Incoming-Mails"
        set disp-name "Number of Incoming Mails"
        set description "Number of Incoming Mails"
        set dev-type FortiMail
        set dataset "fml-domain-Number-of-Incoming-Mails"
        set data-binding "totalnum"
        set data-attr count
        set protected enable
    next
    edit "fml-domain-Number-of-Outgoing-Mails"
        set disp-name "Number of Outgoing Mails"
        set description "Number of Outgoing Mails"
        set dev-type FortiMail
        set dataset "fml-domain-Number-of-Outgoing-Mails"
        set data-binding "totalnum"
        set data-attr count
        set protected enable
    next
    edit "fml-domain-Total-Spam-Mail"
        set disp-name "FortiMail Total Spam Mail"
        set description "FortiMail Total Spam Mail"
        set dev-type FortiMail
        set dataset "fml-domain-Total-Spam-Mail"
        set data-binding "totalnum"
        set data-attr count
        set protected enable
    next
    edit "fml-domain-Total-Mail-with-Virus"
        set disp-name "FortiMail Total Mail with Virus"
        set description "FortiMail Total Mail with Virus"
        set dev-type FortiMail
        set dataset "fml-domain-Total-Mail-with-Virus"
        set data-binding "totalnum"
        set data-attr count
        set protected enable
    next

    edit "fml-domain-Total-Mail-Sender"
        set disp-name "FortiMail Total Mail Sender Domain"
        set description "FortiMail Total Mail Sender Domain"
        set dev-type FortiMail
        set dataset "fml-domain-Total-Mail-Sender"
        set data-binding "totalnum"
        set data-attr count
        set protected enable
    next

    edit "fml-domain-Total-Mail-Recipient"
        set disp-name "FortiMail Total Mail Recipient"
        set description "FortiMail Total Mail Recipient"
        set dev-type FortiMail
        set dataset "fml-domain-Total-Mail-Recipient"
        set data-binding "totalnum"
        set data-attr count
        set protected enable
    next
end


config sql-report layout
    edit 1000050001
        set is-template enable
        set dev-type FortiMail
        set category "FortiMail"
        set title "Template - FortiMail Default Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Top 10 client IP, senders, virus senders, local users, recipients and virus recipients"
        set body "<fazchart mkey=\"fml-History-Top10-Client-IP\" title=\"Top 10 Client IP\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-History-Top10-Sender\" title=\"Top 10 Senders\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-History-Top10-Virus-Sender\" title=\"Top 10 Virus Senders\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-History-Top10-Local-User\" title=\"Top 10 Local Users\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-History-Top10-Recipient\" title=\"Top 10 Recipients\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-History-Top10-Virus-Recipient\" title=\"Top 10 Virus Recipients\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90102
                next
            end
        set protected enable
    next
    edit 1000050002
        set is-template enable
        set dev-type FortiMail
        set category "FortiMail"
        set title "Template - FortiMail Analysis Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Statistics for Avg and Total mail size, number of mails and connections, delays, ip policies, recipient policies, top access list. Incoming filters for top spammed domains and users, classifiers by hour and disposition, and top subjects."
        set body "<h1>Statistics</h1><p></p><fazchart mkey=\"fml-Average-Size-of-Mails\" title=\"Average Size of Mails\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-Total-Size-of-Mails\" title=\"Total Size of Mails\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-Number-of-Mail-Connections\" title=\"Number of Mail Connections\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-Number-of-Mails\" title=\"Number of Mails\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-Total-Message-Delay\" title=\"Total Message Delay\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-Total-Message-Transmission-Delay\" title=\"Total Message Transmission Delay\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-Top-IP-Policy\" title=\"Top IP Policy\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-Top-Recipient-Policy\" title=\"Top Recipient Policy\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-Top-Access-List\" title=\"Top Access List\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Incoming Filtering</h1><p></p><fazchart mkey=\"fml-Top-Spammed-Domains\" title=\"Top Spammed Domains\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-Top-Spammed-Users\" title=\"Top Spammed Users\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-Top-Classifiers-By-Hour\" title=\"Top Classifiers By Hour\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-Top-Disposition-Classifiers\" title=\"Top Disposition Classifiers\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-Top-Subjects\" title=\"Top Subjects\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90102
                next
                edit 90203
                next
            end
        set protected enable
    next
    edit 1000050003
        set is-template enable
        set dev-type FortiMail
        set category "FortiMail"
        set title "Template - FortiMail Summary Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "FortiMail summary per domain."
        set body "<div style=\"height:5px\"></div><h2><span style=\"font-size:18px; font-family:Lato; color:black\"> MAIL SUMMARY</span></h2><table style=\"padding-top:5px; width:100%; height:15px\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\"><tr><td style=\"vertical-align:bottom; width:28px\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/incomingmails.png\" style=\"height:30px; width:25px\" /></td><td style=\"vertical-align:bottom\"><b><span style=\"font-size:24px\"><fazmacro mkey=\"fml-domain-Number-of-Incoming-Mails\"></fazmacro></span></b><span></span><span style=\"font-size:18px\">Incoming Mails</span></td><td style=\"vertical-align:bottom; width:28px\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/outgoingmails.png\" style=\"height:30px; width:25px\" /></td><td style=\"vertical-align:bottom\"><b><span style=\"font-size:24px\"><fazmacro mkey=\"fml-domain-Number-of-Outgoing-Mails\"></fazmacro></span></b><span style=\"font-size:18px; font-family:Lato\"> Outgoing Mails</span></td><td style=\"vertical-align:bottom; width:28px\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/virusmail.png\" style=\"height:25px; width:25px\" /></td><td style=\"vertical-align:bottom\"><b><span style=\"font-size:24px\"><fazmacro mkey=\"fml-domain-Total-Mail-with-Virus\"></fazmacro></span></b><span style=\"font-size:18px; font-family:Lato\"> Virus Mails</span></td></tr><tr><td style=\"height:15px\"></td></tr><tr><td style=\"vertical-align:bottom; width:28px\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/spammail.png\" style=\"height:25px; width:25px\" /></td><td style=\"vertical-align:bottom\"><b><span style=\"font-size:24px\"><fazmacro mkey=\"fml-domain-Total-Spam-Mail\"></fazmacro></span></b><span></span><span style=\"font-size:18px\">Spam Mails</span></td><td style=\"vertical-align:bottom; width:28px\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/sender_recipitant.png\" style=\"height:25px; width:25px\" /></td><td style=\"vertical-align:bottom\"><b><span style=\"font-size:24px\"><fazmacro mkey=\"fml-domain-Total-Mail-Sender\"></fazmacro></span></b><span style=\"font-size:18px; font-family:Lato\"> Senders</span></td><td style=\"vertical-align:bottom; width:28px\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/sender_recipitant.png\" style=\"height:25px; width:25px\" /></td><td style=\"vertical-align:bottom\"><b><span style=\"font-size:24px\"><fazmacro mkey=\"fml-domain-Total-Mail-Recipient\"></fazmacro></span></b><span style=\"font-size:18px; font-family:Lato\"> Recipients</span></td></tr></table><div style=\"height:25px;\"></div><div style=\"font-family: Lato;\"><fazchart width=\"1000px\" title=\"MAIL COUNT BY CATEGORY\" mkey=\"fml-domain-Mail-Category\"></fazchart></div><div style=\"height:25px\"></div><div style=\"font-family: Lato;\"><fazchart width=\"1000px\" title=\"TOP 10 MAIL VIRUS\" mkey=\"fml-domain-Top-Virus-Count\"></fazchart></div><div style=\"page-break-after: always\"></div><div style=\"height:5px\"></div><h2><span style=\"font-size:18px; font-family:Lato; color:black\"> MAIL SUMMARY</span></h2><div><fazchart width=\"1000px\" title=\"TOP 10 SENDER COUNTRY\" mkey=\"fml-domain-Top-Country-Sender\"></fazchart></div><div style=\"height:5px\"></div><div><fazchart width=\"1000px\" title=\"TOP 10 SPAM SUBJECT\" mkey=\"fml-domain-Top-Spam-Subject\"></fazchart></div><div style=\"page-break-after: always\"></div><div style=\"height:5px\"></div><h2><span style=\"font-size:18px; font-family:Lato; color:black\"> MAIL SUMMARY</span></h2><div><fazchart width=\"1000px\" title=\"TOP 10 MAIL RECIPIENT\" mkey=\"fml-domain-Top-Local-User-Count\"></fazchart></div><table style=\"width:100%\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\"><tr><td style=\"vertical-align:top\"><fazchart width=\"500px\" title=\"TOP 10 SPAM RECIPIENT\" mkey=\"fml-domain-Top-Spam-Recipient\"></fazchart></td><td style=\"vertical-align:top\"><fazchart width=\"500px\" title=\"TOP 10 VIRUS RECIPIENT\" mkey=\"fml-domain-Top-Virus-Recipient\"></fazchart></td></tr></table><div style=\"page-break-after: always\"></div><div style=\"height:5px\"></div><h2><span style=\"font-size:18px; font-family:Lato; color:black\"> MAIL SUMMARY</span></h2><table style=\"width:100%\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\"><tr><td style=\"vertical-align:top\"><fazchart width=\"500PX\" title=\"TOP 10 DESTINATION DOMAIN\" mkey=\"fml-domain-Top-Recipient-Domain\"></fazchart></td><td style=\"vertical-align:top\"><fazchart width=\"500px\" title=\"TOP 10 SENDER DOMAIN\" mkey=\"fml-domain-Top-Sender-Domain\"></fazchart></td></tr></table><p></p><div style=\"page-break-after: always\"></div><div style=\"height:5px\"></div><h2><span style=\"font-size:18px; font-family:Lato; color:black\"> SPAM SUMMARY</span></h2><table style=\"width:100%\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\"><tr><td style=\"vertical-align:top\"><fazchart width=\"350px\" title=\"SPAM MAIL CATEGORY\" mkey=\"fml-domain-Spam-Category\"></fazchart></td><td style=\"vertical-align:top\"><fazchart width=\"650px\" title=\"TOP 10 SPAM MAIL CATEGORY BY RECIPIENT\" mkey=\"fml-domain-Top-Spammed-Category-with-Users\"></fazchart></td></tr></table><div style=\"page-break-after: always\"></div><div style=\"height:5px\"></div><div style=\"page-break-inside: avoid;\"><h2><span style=\"font-size:18px; font-family:Lato; color:black\"> SPAM SUMMARY</span></h2><div><fazchart width=\"1000px\" title=\"TOP 5 SPAM SENDER DOMAIN BY CATEGORY\" mkey=\"fml-domain-Top-Spam-Sender-with-Category\"></fazchart><div style=\"height:20px\"></div><fazchart width=\"1000px\" title=\"TOP 5 SPAM MAIL RECIPIENT BY CATEGORY\" mkey=\"fml-domain-Top-Spammed-Users-with-Category-Table\"></fazchart></div></div><div style=\"page-break-after: always\"></div><div style=\"height:5px\"></div><h2><span style=\"font-size:18px; font-family:Lato; color:black\"> VIRUS SUMMARY</span></h2><div><fazchart width=\"1000px\" title=\"TOP 10 VIRUS MAIL RECIPIENT\" mkey=\"fml-domain-Top-Virus-Recipient-with-Aggregation\"></fazchart></div><div style=\"page-break-after: always\"></div><div style=\"height:5px\"></div><h2><span style=\"font-size:18px; font-family:Lato; color:black\"> VIRUS SUMMARY</span></h2><div><fazchart width=\"1000px\" title=\"TOP 10 MAIL VIRUS BY CATEGORY\" mkey=\"fml-domain-Virus-Category\"></fazchart></div><div style=\"page-break-after: always\"></div><div style=\"height:5px\"></div><h2><span style=\"font-size:18px; font-family:Lato; color:black\"> VIRUS SUMMARY</span></h2><div><fazchart width=\"1000px\" title=\"TOP 10 VIRUS SENDER DOMAIN\" mkey=\"fml-domain-Top-Virus-Sender-with-Aggregation\"></fazchart></div>"
            config header
                edit 1
                    set type graphic
                    set graphic "header_webusage_bg.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90102
                next
                edit 90203
                next
            end
        set report-tag "concise"
        set protected enable
    next
end

config sql-report layout-folder
    edit 99999
        set folder-name "Default Templates"
        set protected enable
    next
    edit 90102
        set folder-name "FortiMail Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90203
        set folder-name "SOC Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90205
        set folder-name "Outbreak Alert Reports Templates"
        set parent-id 99999
        set protected enable
    next
end

config sql-report schedule
    edit "1000050003"
         set is-template enable
         set description "FortiMail Summary Report"
         set include-coverpage disable
         set display-table-contents disable
         set output-format pdf
         set schedule-color "#5484ED"
         set resolve-hostname disable
         set device-list-type none
         set auto-hcache enable
         set orientation landscape
         set status disable
         set schedule-type every-n-weeks
         set schedule-frequency 1
         set schedule-valid-start 00:00 2022/04/01
         set time-period last-7-days
         set dev-type FortiMail
         set data-accuracy high
         config report-layout
             edit 1000050003
             next
         end
         config devices
            edit All_FortiMail
            next
         end
    next
end

config alert basic-handler
    edit 40000
        set name "Default-FML-Threat-Detection-By-Email"
        set description "Default FortiMail Handler to detect malicious and suspicious activities grouped by user's Email address"
        config rule
            edit 1
                set name "Malware detected in incoming email"
                set devtype FortiMail
                set severity critical
                set logtype "statistics"
                set extrainfo "Classifier: ${classifier}, From: ${from}, Server: ${client_name}(${client_ip})"
                set extrainfo-type custom
                set subject "Malware detected in incoming email"
                set groupby1 "to"
                set groupby2 "classifier"
                set eventstatus "open"
                set tags "Incoming,Email,Malware,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction==in and disposition!~quarantine and (classifier==\"Virus Signature\" or classifier==\"Fortiguard Outbreak\")"
            next
            edit 2
                set name "Malware detected in email"
                set devtype FortiMail
                set severity high
                set logtype "virus"
                set extrainfo "From: ${from}, Server: ${client_name}(${client_ip}), ${msg}"
                set extrainfo-type custom
                set subject "Malware detected in email"
                set groupby1 "to"
                set eventstatus "auto"
                set tags "Email,Malware,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "subtype==infected"
            next
            edit 3
                set name "Spam detected in incoming email"
                set devtype FortiMail
                set severity high
                set logtype "statistics"
                set extrainfo "Classifier: ${classifier}, From: ${from}, Server: ${client_name}(${client_ip})"
                set extrainfo-type custom
                set subject "Spam detected in incoming email"
                set groupby1 "to"
                set eventstatus "open"
                set tags "Incoming,Email,Spam,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction==in and disposition!~quarantine and disposition!~reject and ( classifier==\"Recipient Verification\" or classifier==\"Fortiguard Antispam\" or classifier==\"Fortiguard Antispam-ip\" or classifier==\"Image Spam\" )"
            next
            edit 4
                set name "Matched hash detected in email"
                set devtype FortiMail
                set severity medium
                set logtype "virus"
                set extrainfo "From: ${from}, Server: ${client_name}(${client_ip}), ${msg}"
                set extrainfo-type custom
                set subject "Matched hash detected in email"
                set groupby1 "to"
                set eventstatus "auto"
                set tags "Email,Risky,File,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 30
                set filter-expr "subtype==file-signature"
            next
            edit 5
                set name "Malicious URL detected in incoming email"
                set devtype FortiMail
                set severity high
                set logtype "statistics"
                set extrainfo "Classifier: ${classifier}, From: ${from}, Server: ${client_name}(${client_ip})"
                set extrainfo-type custom
                set subject "Malicious URL detected in incoming email"
                set groupby1 "to"
                set eventstatus "open"
                set tags "Incoming,Email,Risky,URL,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction==in and classifier==\"Fortiguard Webfilter\" and disposition!~quarantine"
            next
            edit 6
                set name "Suspicious URL detected in email"
                set devtype FortiMail
                set severity medium
                set logtype "spam"
                set extrainfo "From: ${from}, Server: ${client_name}(${client_ip}), ${msg}"
                set extrainfo-type custom
                set subject "Suspicious URL detected in email"
                set groupby1 "to"
                set eventstatus "auto"
                set tags "Email,Risky,URL,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "msg~\"Fortiguard-Webfilter\" and msg!~\"category: malicious website\" and msg!~\"category: spam URLs\" and msg!~\"category: phishing\""
            next
            edit 7
                set name "Malicious URL detected in email"
                set devtype FortiMail
                set severity high
                set logtype "spam"
                set extrainfo "From: ${from}, Server: ${client_name}(${client_ip}), ${msg}"
                set extrainfo-type custom
                set subject "Malicious URL detected in email"
                set groupby1 "to"
                set eventstatus "auto"
                set tags "Email,Risky,URL,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "msg~\"Fortiguard-Webfilter\" and (msg~\"category: malicious website\" or msg~\"category: spam URLs\" or msg~\"category: phishing\" )"
            next
            edit 8
                set name "Sandbox detected suspicious content in email"
                set devtype FortiMail
                set severity medium
                set logtype "virus"
                set extrainfo "From: ${from}, Server: ${client_name}(${client_ip}), ${msg}"
                set extrainfo-type custom
                set subject "Sandbox detected suspicious content in email"
                set groupby1 "to"
                set eventstatus "auto"
                set tags "Email,Risky,Sandbox,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "subtype==fortisandbox and (msg~\"rating=suspicious_medium\" or msg~\"rating=suspicious_high\" or msg~\"suspicious is found\" )"
            next
            edit 9
                set name "Outgoing email blocked by access control"
                set devtype FortiMail
                set severity medium
                set logtype "statistics"
                set extrainfo "Classifier: ${classifier}, From: ${from}, Server: ${client_name}(${client_ip})"
                set extrainfo-type custom
                set subject "Outgoing email blocked by access control"
                set groupby1 "to"
                set eventstatus "mitigated"
                set tags "Outgoing,Email,Access_Control,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction==out and classifier~\"Access Control\" and (disposition==discard or disposition==reject)"
            next
            edit 10
                set name "Oversize email detected"
                set devtype FortiMail
                set severity low
                set logtype "spam"
                set extrainfo "From: ${from}, Server: ${client_name}(${client_ip}), ${msg}"
                set extrainfo-type custom
                set subject "Oversize email detected"
                set groupby1 "to"
                set eventstatus "auto"
                set tags "Email,Risky,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "msg~\"max scan size\""
            next
            edit 11
                set name "Suspicious content detected in email"
                set devtype FortiMail
                set severity medium
                set logtype "virus"
                set extrainfo "From: ${from}, Server: ${client_name}(${client_ip}), ${msg}"
                set extrainfo-type custom
                set subject "Suspicious content detected in email"
                set groupby1 "to"
                set tags "Email,Risky,Malware,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "subtype==\"malware-outbreak\" and msg~\"suspicious content\""
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fml"
    next
    edit 40001
        set name "Default-FML-Compromised Host-Detection-IOC-By-Threat"
        set description "Default event handler to detect compromised hosts by IOC feature grouped by threat"
        config rule
            edit 1
                set name "User clicked the CnC malicious URL"
                set devtype FortiMail
                set severity critical
                set logtype "spam"
                set extrainfo "user:${to} clicked the CnC malicious URL:${tdurl}"
                set extrainfo-type custom
                set subject "Email filter CnC to $groupby1 detected"
                set groupby1 "to"
                set groupby2 "from"
                set eventstatus "open"
                set tags "Default,By_Threat,C&C,Email,Ioc_Rescan"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "tdtype~infected"
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fml"
    next
end

config system connectors
    edit 1
        set uuid "5979abf1-a807-47fd-8aca-c03d3b27c124"
        set name "Local Connector"
        set description "Local Connector"
        set status enable
        set type LOCALHOST 
        set auth-type none
        config action
            edit 1
                set name "UPDATE_ASSET_AND_IDENTITY"
                set description "update asset and identity"
                set parameters "{}"
                set status enable
            next
            edit 2
                set name "GET_EVENTS"
                set description "get events"
                set parameters "{}"
                set status enable
            next
            edit 3
                set name "ATTACH_DATA_TO_INCIDENT"
                set description "attach data to incident"
                set parameters "{}"
                set status enable
            next
            edit 4
                set name "RUN_REPORT"
                set description "run report"
                set parameters "{}"
                set status enable
            next
            edit 5
                set name "GET_ENDPOINT_VULNERABILITIES"
                set description "get endpoint vulnerabilities"
                set parameters "{}"
                set status enable
            next
            edit 6
                set name "CREATE_INCIDENT"
                set description "create incident"
                set parameters "{}"
                set status enable
            next
            edit 7
                set name "UPDATE_INCIDENT"
                set description "update incident"
                set parameters "{}"
                set status enable
            next
        end
    next
    edit 2
        set uuid "d0f89488-b270-11ea-b3de-0242ac130004"
        set name "FortiGuard Connector"
        set description "FortiGuard Connector"
        set status enable
        set type FGD
        set auth-type none
        config action
            edit 1
                set name "GET_IOC_INFO"
                set description "get FortiGuard data for associated IOC"
                set parameters "{\"addr\":null}"
                set status enable
            next
            edit 2
                set name "GET_THREAT_INFO"
                set description "Lookup Fortiguard encyclopedia entry"
                set parameters "{\"threat-type\":null,\"threatID\":null}"
                set status enable
            next
            edit 3
                set name "INDICATOR_LOOKUP"
                set description "Indicator Lookup"
                set parameters "{\"indicator_type\":null,\"indicator_value\":null}"
                set status enable
            next
        end
    next
end
