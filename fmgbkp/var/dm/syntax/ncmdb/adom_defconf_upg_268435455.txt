
config sql-report dataset
    edit "traffic-bandwidth-timeline"
        set description "Traffic bandwidth timeline"
        set log-type traffic
        set query "select $flex_timescale(timestamp) as hodex, sum(traffic_out) as traffic_out, sum(traffic_in) as traffic_in from ###(select timestamp, sum(bandwidth) as bandwidth, sum(traffic_out) as traffic_out, sum(traffic_in) as traffic_in from ###base(/*tag:rpt_base_t_bndwdth_sess*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, appcat, apprisk, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, count(*) as sessions, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in from $log-traffic where $filter and (logflag&(1|32)>0) group by timestamp, dvid, srcip, dstip, epid, euid, appcat, apprisk, user_src, service /*SkipSTART*/order by timestamp desc/*SkipEND*/)base### base_query group by timestamp order by bandwidth desc)### t where $filter-drilldown group by hodex having sum(traffic_out+traffic_in)>0 order by hodex"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "number-of-session-timeline"
        set description "Number of session timeline"
        set log-type traffic
        set query "select $flex_timescale(timestamp) as hodex, sum(sessions) as sessions from ###(select timestamp, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_bndwdth_sess*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, appcat, apprisk, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, count(*) as sessions, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in from $log-traffic where $filter and (logflag&(1|32)>0) group by timestamp, dvid, srcip, dstip, epid, euid, appcat, apprisk, user_src, service /*SkipSTART*/order by timestamp desc/*SkipEND*/)base### base_query group by timestamp order by sessions desc)### t where $filter-drilldown group by hodex order by hodex"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "Top-Users-By-Bandwidth"
        set description "Top users by bandwidth usage"
        set log-type traffic
        set query "select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, srcip, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out from $log where $filter and (logflag&1>0) and srcip is not null group by user_src, srcip having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "Top-App-By-Bandwidth"
        set description "Top applications by bandwidth usage"
        set log-type traffic
        set query "select app_group_name(app) as app_group, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###(select appid, app, appcat, apprisk, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(bandwidth) as bandwidth, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t group by appid, app, appcat, apprisk /*SkipSTART*/order by sessions desc, bandwidth desc/*SkipEND*/)### t group by app_group having sum(bandwidth)>0 order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
                edit "appcat"
                    set var-name "appcat"
                next
            end
        set protected enable
    next
    edit "Top-User-Source-By-Sessions"
        set description "Top user source by session count"
        set log-type traffic
        set query "select user_src, sum(sessions) as sessions from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, count(*) as sessions from $log where $filter and (logflag&1>0) group by user_src order by sessions desc)### t group by user_src order by sessions desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
                edit "app"
                    set var-name "app"
                next
                edit "service"
                    set var-name "service"
                next
            end
        set protected enable
    next
    edit "Top-User-By-Sessions"
        set description "Top user by session count"
        set log-type traffic
        set query "select user_src, sum(sessions) as sessions from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, count(*) as sessions from $log where $filter and (logflag&1>0) group by user_src order by sessions desc)### t group by user_src order by sessions desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
                edit "app"
                    set var-name "app"
                next
                edit "service"
                    set var-name "service"
                next
            end
        set protected enable
    next
    edit "Top-App-By-Sessions"
        set description "Top applications by session count"
        set log-type traffic
        set query "select app_group, sum(sessions) as sessions from ###(select app_group_name(app) as app_group, appcat, service, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by app_group, appcat, service order by bandwidth desc)### t group by app_group order by sessions desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
                edit "appcat"
                    set var-name "appcat"
                next
            end
        set protected enable
    next
    edit "Top-Destinations-By-Bandwidth"
        set description "Top destinations by bandwidth usage"
        set log-type traffic
        set query "select coalesce(nullifna(root_domain(hostname)), ipstr(dstip)) as domain, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out from $log where $filter and (logflag&1>0) and coalesce(nullifna(root_domain(hostname)), ipstr(`dstip`)) is not null group by domain having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "Top-Destinations-By-Sessions"
        set description "Top destinations by session count"
        set log-type traffic
        set query "select coalesce(nullifna(root_domain(hostname)), ipstr(dstip)) as domain, count(*) as sessions from $log where $filter and (logflag&1>0) group by domain order by sessions desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next

    edit "event-Top-DHCP-Summary"
        set description "Event top dhcp summary"
        set log-type event 
        set query "drop table if exists rpt_tmptbl_1;drop table if exists rpt_tmptbl_2;drop table if exists rpt_tmptbl_3;create temporary table rpt_tmptbl_1 as select devintf, mac from ###(select concat(interface, '.', devid) as devintf, mac from $log where $last3day_period $filter and logid_to_int(logid) = 26001 and dhcp_msg = 'Ack' group by devintf, mac)### t group by devintf, mac; create temporary table rpt_tmptbl_2 as select devintf, mac from ###(select concat(interface, '.', devid) as devintf, mac from $log where $filter and logid_to_int(logid) = 26001 and dhcp_msg = 'Ack' group by devintf, mac)### t group by devintf, mac; create temporary table rpt_tmptbl_3 as select distinct on (1) devintf, cast(used*100.0/total as decimal(18,2)) as percent_of_allocated_ip from ###(select distinct on (devintf) concat(interface, '.', devid) as devintf, used, total, itime from $log where $filter and logid_to_int(logid)=26003 and total>0 /*SkipSTART*/order by devintf, itime desc/*SkipEND*/)### t order by devintf, itime desc; select t1.devintf as interface, percent_of_allocated_ip, new_cli_count from rpt_tmptbl_3 t1 inner join (select devintf, count(mac) as new_cli_count from rpt_tmptbl_2 where not exists (select 1 from rpt_tmptbl_1 where rpt_tmptbl_2.mac=rpt_tmptbl_1.mac) group by devintf) t2 on t1.devintf=t2.devintf order by interface, percent_of_allocated_ip desc"
        set protected enable
    next

    edit "traffic-Top-WiFi-Client-By-Bandwidth"
        set description "Traffic top WiFi client by bandwidth usage"
        set log-type traffic 
        set query "select user_src, srcssid, devtype_new, hostname_mac, sum(bandwidth) as bandwidth from (select user_src, srcssid, get_devtype(srcswversion, osname, devtype) as devtype_new, hostname_mac, sum(bandwidth) as bandwidth from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, ap, srcintf, srcssid, srcssid as ssid, srcmac, srcmac as stamac, coalesce(nullifna(`srcname`), `srcmac`) as hostname_mac, max(srcswversion) as srcswversion, max(osname) as osname, max(osversion) as osversion, max(devtype) as devtype, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, count(*) as subtotal from $log-traffic where $filter and (logflag&1>0) and (srcssid is not null or dstssid is not null) group by user_src, ap, srcintf, srcssid, srcmac, hostname_mac /*SkipSTART*/order by bandwidth desc, subtotal desc/*SkipEND*/)### t group by user_src, srcssid, devtype_new, hostname_mac having sum(bandwidth)>0 union all select user_src, ssid as srcssid, null as devtype_new, stamac as hostname_mac, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, stamac, stamac as srcmac, ap, ssid, ssid as srcssid, user_src, sum(coalesce(sentdelta, 0)) as sentdelta, sum(coalesce(rcvddelta, 0)) as rcvddelta, sum(coalesce(sentdelta, 0)+coalesce(rcvddelta, 0)) as bandwidth from (select itime, stamac, ap, ssid, coalesce(`user`, ipstr(`srcip`)) as user_src, sentbyte-lag(coalesce(sentbyte, 0)) over (partition by stamac order by itime) as sentdelta, rcvdbyte-lag(coalesce(rcvdbyte, 0)) over (partition by stamac order by itime) as rcvddelta from $log-event where $filter and subtype='wireless' and stamac is not null and ssid is not null and action in ('sta-wl-bridge-traffic-stats', 'reassoc-req', 'assoc-req')) as t group by timestamp, stamac, ap, ssid, user_src /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t where user_src is not null group by user_src, ssid, devtype_new, stamac having sum(bandwidth)>0) t group by user_src, srcssid, devtype_new, hostname_mac order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next

    edit "Traffic-History-By-Active-User"
        set description "Traffic history by active user"
        set log-type traffic
        set query "select $flex_timescale(timestamp) as hodex, count(distinct(user_src)) as total_user from ###(select timestamp, user_src, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_bndwdth_sess*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, appcat, apprisk, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, count(*) as sessions, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in from $log-traffic where $filter and (logflag&(1|32)>0) group by timestamp, dvid, srcip, dstip, epid, euid, appcat, apprisk, user_src, service /*SkipSTART*/order by timestamp desc/*SkipEND*/)base### base_query group by timestamp, user_src order by sessions desc)### t where $filter-drilldown group by hodex order by hodex"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next

    edit "utm-Top-Allowed-Web-Sites-By-Request"
        set description "UTM top allowed web sites by request"
        set log-type traffic
        set query "select hostname, catdesc, count(*) as requests from $log where $filter and (logflag&1>0) and utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter') and hostname is not null and (utmaction not in ('block', 'blocked') or action!='deny') group by hostname, catdesc order by requests desc"
             config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "utm-Top-Blocked-Web-Sites-By-Request"
        set description "UTM top blocked web sites by request"
        set log-type traffic
        set query "select hostname, count(*) as requests from $log where $filter and (logflag&1>0) and utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter') and hostname is not null and (utmaction in ('block', 'blocked') or action='deny') group by hostname order by requests desc"
             config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "utm-Top-Web-Users-By-Request"
        set description "UTM top web users by request"
        set log-type traffic
        set query "select user_src, devtype_new, srcname, sum(requests) as requests from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, get_devtype(srcswversion, osname, devtype) as devtype_new, srcname, action, utmaction, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out, count(*) as requests from $log where $filter and (logflag&1>0) and utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter') group by user_src, devtype_new, srcname, action, utmaction order by requests desc)### t group by user_src, devtype_new, srcname order by requests desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "utm-Top-Allowed-Websites-By-Bandwidth"
        set description "UTM top allowed websites by bandwidth usage"
        set log-type traffic
        set query "select appid, hostname, catdesc, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out from $log where $filter and (logflag&1>0) and utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter') and hostname is not null group by appid, hostname, catdesc having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "utm-Top-Blocked-Web-Users"
        set description "UTM top blocked web users"
        set log-type traffic
        set query "select user_src, devtype_new, srcname, sum(requests) as requests from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, get_devtype(srcswversion, osname, devtype) as devtype_new, srcname, action, utmaction, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out, count(*) as requests from $log where $filter and (logflag&1>0) and utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter') group by user_src, devtype_new, srcname, action, utmaction order by requests desc)### t where (utmaction in ('block', 'blocked') or action='deny') group by user_src, devtype_new, srcname order by requests desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "utm-Top-Web-Users-By-Bandwidth"
        set description "UTM top web users by bandwidth usage"
        set log-type traffic
        set query "select user_src, devtype_new, srcname, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, get_devtype(srcswversion, osname, devtype) as devtype_new, srcname, action, utmaction, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out, count(*) as requests from $log where $filter and (logflag&1>0) and utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter') group by user_src, devtype_new, srcname, action, utmaction order by requests desc)### t group by user_src, devtype_new, srcname having sum(bandwidth)>0 order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "utm-Top-Video-Streaming-Websites-By-Bandwidth"
        set description "UTM top video streaming websites by bandwidth usage"
        set log-type traffic
        set query "select appid, hostname, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out from $log where $filter and (logflag&1>0) and catdesc in ('Streaming Media and Download') group by appid, hostname having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "default-Top-Email-Senders-By-Count"
        set description "Default top email senders by count"
        set log-type traffic
        set query "select user_src, sum(requests) as requests from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, count(*) as requests from $log where $filter and (logflag&1>0) group by user_src, service order by requests desc)### t where service in ('smtp', 'SMTP', '25/tcp', '587/tcp', 'smtps', 'SMTPS', '465/tcp') group by user_src order by requests desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "default-Email-Top-Receivers-By-Count"
        set description "Default email top receivers by count"
        set log-type traffic
        set query "select user_src, sum(requests) as requests from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, count(*) as requests from $log where $filter and (logflag&1>0) group by user_src, service order by requests desc)### t where service in ('pop3', 'POP3', '110/tcp', 'imap', 'IMAP', '143/tcp', 'imaps', 'IMAPS', '993/tcp', 'pop3s', 'POP3S', '995/tcp') group by user_src order by requests desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "default-Email-Top-Senders-By-Bandwidth"
        set description "Default email top senders by bandwidth usage"
        set log-type traffic
        set query "select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter and (logflag&1>0) and service in ('smtp', 'SMTP', '25/tcp', '587/tcp', 'smtps', 'SMTPS', '465/tcp') group by user_src having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "default-Email-Top-Receivers-By-Bandwidth"
        set description "Default email top receivers by bandwidth usage"
        set log-type traffic
        set query "select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter and (logflag&1>0) and service in ('pop3', 'POP3', '110/tcp', 'imap', 'IMAP', '143/tcp', 'imaps', 'IMAPS', '993/tcp', 'pop3s', 'POP3S', '995/tcp') group by user_src having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "utm-Top-Virus"
        set description "UTM top virus"
        set log-type virus
        set query "select virus, max(virusid_s) as virusid, (case when virus like 'Riskware%' then 'Spyware' when virus like 'Adware%' then 'Adware' else 'Virus' end) as malware_type, sum(totalnum) as totalnum from ###(select virus, virusid_to_str(virusid, eventtype) as virusid_s, count(*) as totalnum from $log where $filter and nullifna(virus) is not null group by virus, virusid_s /*SkipSTART*/order by totalnum desc/*SkipEND*/)### t group by virus, malware_type order by totalnum desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "utm-Top-Virus-User"
        set description "UTM top virus user"
        set log-type virus
        set query "select user_src, sum(totalnum) as totalnum from ###(select coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, eventtype, logver, virus, count(*) as totalnum from $log where $filter group by user_src, eventtype, logver, virus /*SkipSTART*/order by totalnum desc/*SkipEND*/)### t where nullifna(virus) is not null group by user_src order by totalnum desc" 
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "utm-Top-Attack-Source"
        set description "UTM top attack source"
        set log-type attack
        set query "select user_src, sum(totalnum) as totalnum from ###(select coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, eventtype, logver, count(*) as totalnum from $log where $filter group by user_src, eventtype, logver /*SkipSTART*/order by totalnum desc/*SkipEND*/)### t group by user_src order by totalnum desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "utm-Top-Attack-Dest"
        set description "UTM top attack dest"
        set log-type attack
        set query "select victim, count(*) as totalnum from (select (CASE WHEN direction='incoming' THEN srcip ELSE dstip END) as victim from $log where $filter) t where victim is not null group by victim order by totalnum desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "vpn-Top-Static-IPSEC-Tunnels-By-Bandwidth"
        set description "Top static IPsec tunnels by bandwidth usage"
        set log-type event
        set query "select vpn_name, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from (select devid, vd, remip, tunnelid, vpn_name, (case when min(s_time)=max(e_time) then max(max_traffic_in) else max(max_traffic_in)-min(min_traffic_in) end) as traffic_in, (case when min(s_time)=max(e_time) then max(max_traffic_out) else max(max_traffic_out)-min(min_traffic_out) end) as traffic_out, (case when min(s_time)=max(e_time) then max(max_traffic_in)+max(max_traffic_out) else max(max_traffic_in)-min(min_traffic_in)+max(max_traffic_out)-min(min_traffic_out) end) as bandwidth from ###(select devid, vd, remip, vpn_trim(vpntunnel) as vpn_name, tunnelid, tunnelip, max(coalesce(sentbyte, 0)) as max_traffic_out, max(coalesce(rcvdbyte, 0)) as max_traffic_in, max(coalesce(rcvdbyte, 0)+coalesce(sentbyte, 0)) as max_traffic, min(coalesce(sentbyte, 0)) as min_traffic_out, min(coalesce(rcvdbyte, 0)) as min_traffic_in, min(coalesce(dtime, 0)) as s_time, max(coalesce(dtime, 0)) as e_time from $log where $filter and subtype='vpn' and tunneltype like 'ipsec%' and nullifna(vpntunnel) is not null and action in ('tunnel-stats', 'tunnel-down', 'tunnel-up') and tunnelid is not null and tunnelid!=0 group by devid, vd, remip, vpn_name, tunnelid, tunnelip order by max_traffic desc)### t where (tunnelip is null or tunnelip='0.0.0.0') group by devid, vd, remip, vpn_name, tunnelid) tt group by vpn_name having sum(traffic_in+traffic_out)>0 order by bandwidth desc" 
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "vpn-Top-SSL-VPN-Tunnel-Users-By-Bandwidth"
        set description "Top SSL VPN tunnel users by bandwidth usage"
        set log-type event
        set query "select user_src, remip as remote_ip, from_dtime(min(s_time)) as start_time, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from (select devid, vd, remip, user_src, tunnelid, min(s_time) as s_time, max(e_time) as e_time, (case when min(s_time)=max(e_time) then max(max_traffic_in)+max(max_traffic_out) else max(max_traffic_in)-min(min_traffic_in)+max(max_traffic_out)-min(min_traffic_out) end) as bandwidth, (case when min(s_time)=max(e_time) then max(max_traffic_in) else max(max_traffic_in)-min(min_traffic_in) end) as traffic_in, (case when min(s_time)=max(e_time) then max(max_traffic_out) else max(max_traffic_out)-min(min_traffic_out) end) as traffic_out from ###(select devid, vd, remip, coalesce(nullifna(`user`), ipstr(`remip`)) as user_src, tunnelid, tunneltype, max(coalesce(duration,0)) as max_duration, min(coalesce(duration,0)) as min_duration, min(coalesce(dtime, 0)) as s_time, max(coalesce(dtime, 0)) as e_time, min(coalesce(sentbyte, 0)) as min_traffic_out, min(coalesce(rcvdbyte, 0)) as min_traffic_in, max(coalesce(sentbyte, 0)) as max_traffic_out, max(coalesce(rcvdbyte, 0)) as max_traffic_in, max(coalesce(rcvdbyte, 0)+coalesce(sentbyte, 0)) as max_traffic from $log where $filter and subtype='vpn' and tunneltype like 'ssl%' and action in ('tunnel-stats', 'tunnel-down', 'tunnel-up') and coalesce(nullifna(`user`), ipstr(`remip`)) is not null and tunnelid is not null group by devid, vd, user_src, remip, tunnelid, tunneltype order by max_traffic desc)### t where tunneltype='ssl-tunnel' group by devid, vd, user_src, remip, tunnelid) tt where bandwidth>0 group by user_src, remote_ip order by bandwidth desc"
        set protected enable
    next
    edit "vpn-Top-SSL-VPN-Web-Mode-Users-By-Bandwidth"
        set description "Top SSL VPN web mode users by bandwidth usage"
        set log-type event 
        set query "select user_src, remip as remote_ip, from_dtime(min(s_time)) as start_time, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from (select devid, vd, user_src, remip, tunnelid, min(s_time) as s_time, max(e_time) as e_time, (case when min(s_time)=max(e_time) then max(max_traffic_in)+max(max_traffic_out) else max(max_traffic_in)-min(min_traffic_in)+max(max_traffic_out)-min(min_traffic_out) end) as bandwidth, (case when min(s_time)=max(e_time) then max(max_traffic_in) else max(max_traffic_in)-min(min_traffic_in) end) as traffic_in, (case when min(s_time)=max(e_time) then max(max_traffic_out) else max(max_traffic_out)-min(min_traffic_out) end) as traffic_out from ###(select devid, vd, remip, coalesce(nullifna(`user`), ipstr(`remip`)) as user_src, tunnelid, tunneltype, max(coalesce(duration,0)) as max_duration, min(coalesce(duration,0)) as min_duration, min(coalesce(dtime, 0)) as s_time, max(coalesce(dtime, 0)) as e_time, min(coalesce(sentbyte, 0)) as min_traffic_out, min(coalesce(rcvdbyte, 0)) as min_traffic_in, max(coalesce(sentbyte, 0)) as max_traffic_out, max(coalesce(rcvdbyte, 0)) as max_traffic_in, max(coalesce(rcvdbyte, 0)+coalesce(sentbyte, 0)) as max_traffic from $log where $filter and subtype='vpn' and tunneltype like 'ssl%' and action in ('tunnel-stats', 'tunnel-down', 'tunnel-up') and coalesce(nullifna(`user`), ipstr(`remip`)) is not null and tunnelid is not null group by devid, vd, user_src, remip, tunnelid, tunneltype order by max_traffic desc)### t group by devid, vd, user_src, remip, tunnelid) tt where bandwidth>0 group by user_src, remote_ip order by bandwidth desc" 
        set protected enable
    next
    edit "vpn-Top-SSL-VPN-Web-Mode-Users-By-Duration"
        set description "Top SSL VPN web mode users by duration"
        set log-type event
        set query "select user_src, remip as remote_ip, from_dtime(min(s_time)) as start_time, sum(duration) as duration from (select devid, vd, user_src, remip, tunnelid, min(s_time) as s_time, (case when min(s_time)=max(e_time) then max(max_duration) else max(max_duration)-min(min_duration) end) as duration from ###(select devid, vd, remip, coalesce(nullifna(`user`), ipstr(`remip`)) as user_src, tunnelid, tunneltype, max(coalesce(duration,0)) as max_duration, min(coalesce(duration,0)) as min_duration, min(coalesce(dtime, 0)) as s_time, max(coalesce(dtime, 0)) as e_time, min(coalesce(sentbyte, 0)) as min_traffic_out, min(coalesce(rcvdbyte, 0)) as min_traffic_in, max(coalesce(sentbyte, 0)) as max_traffic_out, max(coalesce(rcvdbyte, 0)) as max_traffic_in, max(coalesce(rcvdbyte, 0)+coalesce(sentbyte, 0)) as max_traffic from $log where $filter and subtype='vpn' and tunneltype like 'ssl%' and action in ('tunnel-stats', 'tunnel-down', 'tunnel-up') and coalesce(nullifna(`user`), ipstr(`remip`)) is not null and tunnelid is not null group by devid, vd, user_src, remip, tunnelid, tunneltype order by max_traffic desc)### t where tunneltype='ssl-web' group by devid, vd, user_src, remip, tunnelid) tt group by user_src, remote_ip order by duration desc"
        set protected enable
    next
    edit "vpn-Top-SSL-VPN-Users-By-Bandwidth"
        set description "Top SSL VPN users by bandwidth usage"
        set log-type event
        set query "select user_src, remip as remote_ip, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from (select devid, vd, user_src, remip, tunnelid, (case when min(s_time)=max(e_time) then max(max_traffic_in) else max(max_traffic_in)-min(min_traffic_in) end) as traffic_in, (case when min(s_time)=max(e_time) then max(max_traffic_out) else max(max_traffic_out)-min(min_traffic_out) end) as traffic_out, (case when min(s_time)=max(e_time) then max(max_traffic_in)+max(max_traffic_out) else max(max_traffic_in)-min(min_traffic_in)+max(max_traffic_out)-min(min_traffic_out) end) as bandwidth from ###(select devid, vd, remip, coalesce(nullifna(`user`), ipstr(`remip`)) as user_src, tunnelid, tunneltype, max(coalesce(duration,0)) as max_duration, min(coalesce(duration,0)) as min_duration, min(coalesce(dtime, 0)) as s_time, max(coalesce(dtime, 0)) as e_time, min(coalesce(sentbyte, 0)) as min_traffic_out, min(coalesce(rcvdbyte, 0)) as min_traffic_in, max(coalesce(sentbyte, 0)) as max_traffic_out, max(coalesce(rcvdbyte, 0)) as max_traffic_in, max(coalesce(rcvdbyte, 0)+coalesce(sentbyte, 0)) as max_traffic from $log where $filter and subtype='vpn' and tunneltype like 'ssl%' and action in ('tunnel-stats', 'tunnel-down', 'tunnel-up') and coalesce(nullifna(`user`), ipstr(`remip`)) is not null and tunnelid is not null group by devid, vd, user_src, remip, tunnelid, tunneltype order by max_traffic desc)### t group by devid, vd, user_src, remip, tunnelid) tt group by user_src, remote_ip having sum(traffic_out+traffic_in)>0 order by bandwidth desc" 
        set protected enable
    next
    edit "vpn-Top-SSL-VPN-Users-By-Duration"
        set description "Top SSL VPN users by duration"
        set log-type event
        set query "select user_src, tunneltype, sum(duration) as duration, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from (select devid, vd, remip, user_src, tunneltype , tunnelid, (case when min(s_time)=max(e_time) then max(max_duration) else max(max_duration)-min(min_duration) end) as duration, (case when min(s_time)=max(e_time) then max(max_traffic_in) else max(max_traffic_in)-min(min_traffic_in) end) as traffic_in, (case when min(s_time)=max(e_time) then max(max_traffic_out) else max(max_traffic_out)-min(min_traffic_out) end) as traffic_out, (case when min(s_time)=max(e_time) then max(max_traffic_in)+max(max_traffic_out) else max(max_traffic_in)-min(min_traffic_in)+max(max_traffic_out)-min(min_traffic_out) end) as bandwidth from ###(select devid, vd, remip, coalesce(nullifna(`user`), ipstr(`remip`)) as user_src, tunnelid, tunneltype, max(coalesce(duration,0)) as max_duration, min(coalesce(duration,0)) as min_duration, min(coalesce(dtime, 0)) as s_time, max(coalesce(dtime, 0)) as e_time, min(coalesce(sentbyte, 0)) as min_traffic_out, min(coalesce(rcvdbyte, 0)) as min_traffic_in, max(coalesce(sentbyte, 0)) as max_traffic_out, max(coalesce(rcvdbyte, 0)) as max_traffic_in, max(coalesce(rcvdbyte, 0)+coalesce(sentbyte, 0)) as max_traffic from $log where $filter and subtype='vpn' and tunneltype like 'ssl%' and action in ('tunnel-stats', 'tunnel-down', 'tunnel-up') and coalesce(nullifna(`user`), ipstr(`remip`)) is not null and tunnelid is not null group by devid, vd, user_src, remip, tunnelid, tunneltype order by max_traffic desc)### t group by devid, vd, remip, user_src, tunnelid, tunneltype) tt where bandwidth>0 group by user_src, tunneltype order by duration desc" 
        set protected enable
    next
    edit "vpn-Top-Dial-Up-IPSEC-Tunnels-By-Bandwidth"
        set description "Top dial up IPsec tunnels by bandwidth usage"
        set log-type event
        set query "select vpn_name, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from (select devid, vd, tunnelid, remip, vpn_name, (case when min(s_time)=max(e_time) then max(max_traffic_in) else max(max_traffic_in)-min(min_traffic_in) end) as traffic_in, (case when min(s_time)=max(e_time) then max(max_traffic_out) else max(max_traffic_out)-min(min_traffic_out) end) as traffic_out, (case when min(s_time)=max(e_time) then max(max_traffic_in)+max(max_traffic_out) else max(max_traffic_in)-min(min_traffic_in)+max(max_traffic_out)-min(min_traffic_out) end) as bandwidth from ###(select devid, vd, remip, vpn_trim(vpntunnel) as vpn_name, tunnelid, tunnelip, max(coalesce(sentbyte, 0)) as max_traffic_out, max(coalesce(rcvdbyte, 0)) as max_traffic_in, max(coalesce(rcvdbyte, 0)+coalesce(sentbyte, 0)) as max_traffic, min(coalesce(sentbyte, 0)) as min_traffic_out, min(coalesce(rcvdbyte, 0)) as min_traffic_in, min(coalesce(dtime, 0)) as s_time, max(coalesce(dtime, 0)) as e_time from $log where $filter and subtype='vpn' and tunneltype like 'ipsec%' and nullifna(vpntunnel) is not null and action in ('tunnel-stats', 'tunnel-down', 'tunnel-up') and tunnelid is not null and tunnelid!=0 group by devid, vd, remip, vpn_name, tunnelid, tunnelip order by max_traffic desc)### t where not (tunnelip is null or tunnelip='0.0.0.0') group by devid, vd, remip, vpn_name, tunnelid) tt group by vpn_name having sum(traffic_out+traffic_in)>0 order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "vpn-Top-Dial-Up-IPSEC-Users-By-Bandwidth"
        set description "Top dial up IPsec users by bandwidth usage"
        set log-type event
        set query "select coalesce(xauthuser_agg, user_agg, ipstr(`remip`)) as user_src, remip, from_dtime(min(s_time)) as start_time, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from (select devid, vd, string_agg(distinct xauthuser_agg, ' ') as xauthuser_agg, string_agg(distinct user_agg, ' ') as user_agg, remip, tunnelid, min(s_time) as s_time, max(e_time) as e_time, (case when min(s_time)=max(e_time) then max(max_traffic_in)+max(max_traffic_out) else max(max_traffic_in)-min(min_traffic_in)+max(max_traffic_out)-min(min_traffic_out) end) as bandwidth, (case when min(s_time)=max(e_time) then max(max_traffic_in) else max(max_traffic_in)-min(min_traffic_in) end) as traffic_in, (case when min(s_time)=max(e_time) then max(max_traffic_out) else max(max_traffic_out)-min(min_traffic_out) end) as traffic_out from ###(select devid, vd, remip, nullifna(`xauthuser`) as xauthuser_agg, nullifna(`user`) as user_agg, tunnelid, min(coalesce(dtime, 0)) as s_time, max(coalesce(dtime, 0)) as e_time, max(coalesce(duration,0)) as max_duration, min(coalesce(duration,0)) as min_duration, min(coalesce(sentbyte, 0)) as min_traffic_out, min(coalesce(rcvdbyte, 0)) as min_traffic_in, max(coalesce(sentbyte, 0)) as max_traffic_out, max(coalesce(rcvdbyte, 0)) as max_traffic_in, max(coalesce(rcvdbyte, 0)+coalesce(sentbyte, 0)) as max_traffic from $log where $filter and subtype='vpn' and tunneltype like 'ipsec%' and not (tunnelip is null or tunnelip='0.0.0.0') and action in ('tunnel-stats', 'tunnel-down', 'tunnel-up') and tunnelid is not null and tunnelid!=0 group by devid, vd, remip, xauthuser_agg, user_agg, tunnelid order by max_traffic desc)### t group by devid, vd, remip, tunnelid) tt where bandwidth>0 group by user_src, remip order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "vpn-Top-Dial-Up-IPSEC-Users-By-Duration"
        set description "Top dial up IPsec users by duration"
        set log-type event 
        set query "select coalesce(xauthuser_agg, user_agg, ipstr(`remip`)) as user_src, from_dtime(min(s_time)) as start_time, sum(duration) as duration, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from (select devid, vd, remip, string_agg(distinct xauthuser_agg, ' ') as xauthuser_agg, string_agg(distinct user_agg, ' ') as user_agg, tunnelid, min(s_time) as s_time, max(e_time) as e_time, (case when min(s_time)=max(e_time) then max(max_duration) else max(max_duration)-min(min_duration) end) as duration, (case when min(s_time)=max(e_time) then max(max_traffic_in)+max(max_traffic_out) else  max(max_traffic_in)-min(min_traffic_in)+max(max_traffic_out)-min(min_traffic_out) end) as bandwidth, (case when min(s_time)=max(e_time) then max(max_traffic_in) else max(max_traffic_in)-min(min_traffic_in) end) as traffic_in, (case when min(s_time)=max(e_time) then max(max_traffic_out) else max(max_traffic_out)-min(min_traffic_out) end) as traffic_out from ###(select devid, vd, remip, nullifna(`xauthuser`) as xauthuser_agg, nullifna(`user`) as user_agg, tunnelid, min(coalesce(dtime, 0)) as s_time, max(coalesce(dtime, 0)) as e_time, max(coalesce(duration,0)) as max_duration, min(coalesce(duration,0)) as min_duration, min(coalesce(sentbyte, 0)) as min_traffic_out, min(coalesce(rcvdbyte, 0)) as min_traffic_in, max(coalesce(sentbyte, 0)) as max_traffic_out, max(coalesce(rcvdbyte, 0)) as max_traffic_in, max(coalesce(rcvdbyte, 0)+coalesce(sentbyte, 0)) as max_traffic from $log where $filter and subtype='vpn' and tunneltype like 'ipsec%' and not (tunnelip is null or tunnelip='0.0.0.0') and action in ('tunnel-stats', 'tunnel-down', 'tunnel-up') and tunnelid is not null and tunnelid!=0 group by devid, vd, remip, xauthuser_agg, user_agg, tunnelid order by max_traffic desc)### t group by devid, vd, remip, tunnelid) tt where bandwidth>0 group by user_src order by duration desc"
        set protected enable
    next
    edit "vpn-Top-Dial-Up-VPN-Users-By-Duration"
        set description "Top dial up VPN users by duration"
        set log-type event 
        set query "select coalesce(xauthuser_agg, user_agg, ipstr(`remip`)) as user_src, t_type as tunneltype, from_dtime(min(s_time)) as start_time, sum(duration) as duration, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from (select devid, vd, remip, string_agg(distinct xauthuser_agg, ' ') as xauthuser_agg, string_agg(distinct user_agg, ' ') as user_agg, t_type, tunnelid, min(s_time) as s_time, max(e_time) as e_time, (case when min(s_time)=max(e_time) then max(max_duration) else max(max_duration)-min(min_duration) end) as duration, (case when min(s_time)=max(e_time) then max(max_traffic_in)+max(max_traffic_out) else  max(max_traffic_in)-min(min_traffic_in)+max(max_traffic_out)-min(min_traffic_out) end) as bandwidth, (case when min(s_time)=max(e_time) then max(max_traffic_in) else max(max_traffic_in)-min(min_traffic_in) end) as traffic_in, (case when min(s_time)=max(e_time) then max(max_traffic_out) else max(max_traffic_out)-min(min_traffic_out) end) as traffic_out from ###(select devid, vd, remip, nullifna(`xauthuser`) as xauthuser_agg, nullifna(`user`) as user_agg, (case when tunneltype like 'ipsec%' then 'ipsec' else tunneltype end) as t_type, tunnelid, tunnelip, min(coalesce(dtime, 0)) as s_time, max(coalesce(dtime, 0)) as e_time, max(coalesce(duration,0)) as max_duration, min(coalesce(duration,0)) as min_duration, min(coalesce(sentbyte, 0)) as min_traffic_out, min(coalesce(rcvdbyte, 0)) as min_traffic_in, max(coalesce(sentbyte, 0)) as max_traffic_out, max(coalesce(rcvdbyte, 0)) as max_traffic_in, max(coalesce(rcvdbyte, 0)+coalesce(sentbyte, 0)) as max_traffic, sum((case when action='tunnel-up' then 1 else 0 end)) as tunnelup from $log where $filter and subtype='vpn' and (tunneltype like 'ipsec%' or tunneltype like 'ssl%') and action in ('tunnel-up', 'tunnel-stats', 'tunnel-down') and tunnelid is not null and tunnelid!=0 group by xauthuser_agg, user_agg, devid, vd, remip, t_type, tunnelid, tunnelip order by max_traffic desc)### t where (t_type like 'ssl%' or (t_type like 'ipsec%' and not (tunnelip is null or tunnelip='0.0.0.0'))) group by devid, vd, remip, t_type, tunnelid) tt where bandwidth>0 group by user_src, tunneltype order by duration desc" 
        set protected enable
    next
    edit "vpn-Traffic-Usage-Trend-VPN"
        set description "VPN traffic usage trend"
        set log-type event 
        set query "select hodex, sum(ssl_traffic_bandwidth) as ssl_bandwidth, sum(ipsec_traffic_bandwidth) as ipsec_bandwidth from (select $flex_timescale(timestamp) as hodex, devid, vd, remip, tunnelid, (case when t_type like 'ssl%' then (case when min(s_time)=max(e_time) then max(max_traffic_in)+max(max_traffic_out) else max(max_traffic_in)-min(min_traffic_in)+max(max_traffic_out)-min(min_traffic_out) end)  else 0 end) as ssl_traffic_bandwidth, (case when t_type like 'ipsec%' then (case when min(s_time)=max(e_time) then max(max_traffic_in)+max(max_traffic_out) else max(max_traffic_in)-min(min_traffic_in)+max(max_traffic_out)-min(min_traffic_out) end)  else 0 end) as ipsec_traffic_bandwidth, min(s_time) as s_time, max(e_time) as e_time from ###(select $flex_timestamp as timestamp, devid, vd, remip, tunnelid, (case when tunneltype like 'ipsec%' then 'ipsec' else tunneltype end) as t_type, (case when action='tunnel-up' then 1 else 0 end) as tunnelup, max(coalesce(sentbyte, 0)) as max_traffic_out, max(coalesce(rcvdbyte, 0)) as max_traffic_in, min(coalesce(sentbyte, 0)) as min_traffic_out, min(coalesce(rcvdbyte, 0)) as min_traffic_in, min(coalesce(dtime, 0)) as s_time, max(coalesce(dtime, 0)) as e_time, coalesce(nullifna(`xauthuser`), nullifna(`user`), ipstr(`remip`)) as f_user, tunneltype, action, count(*) as total_num  from $log where $filter and subtype='vpn' and (tunneltype like 'ipsec%' or tunneltype like 'ssl%') and action in ('tunnel-up','tunnel-stats', 'tunnel-down', 'ssl-login-fail', 'ipsec-login-fail') group by timestamp, devid, vd, remip, t_type, tunnelid, action, f_user, tunneltype /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where action in ('tunnel-up','tunnel-stats', 'tunnel-down') and tunnelid is not null and tunnelid!=0 group by hodex, devid, t_type, vd, remip, tunnelid) tt group by hodex order by hodex"
        set protected enable
    next
    edit "vpn-User-Login-history"
        set description "VPN user login history"
        set log-type event
        set query "select $flex_timescale(timestamp) as hodex, sum(tunnelup) as total_num from (select timestamp, devid, vd, remip, tunnelid, max(tunnelup) as tunnelup, max(traffic_in) as traffic_in, max(traffic_out) as traffic_out from ###(select $flex_timestamp as timestamp, devid, vd, remip, tunnelid, max((case when action='tunnel-up' then 1 else 0 end)) as tunnelup, max(coalesce(sentbyte, 0)) as traffic_out, max(coalesce(rcvdbyte, 0)) as traffic_in from $log where $filter and subtype='vpn' and (tunneltype like 'ipsec%' or tunneltype like 'ssl%') and action in ('tunnel-up', 'tunnel-stats', 'tunnel-down') and tunnelid is not null group by timestamp, devid, vd, remip, tunnelid /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t group by timestamp, devid, vd, remip, tunnelid having max(traffic_in)+max(traffic_out)>0) t group by hodex order by total_num desc"
        set protected enable
    next
    edit "vpn-Authenticated-Logins"
        set description "VPN authenticated logins"
        set log-type event
        set query "select coalesce(xauthuser_agg, user_agg, ipstr(`remip`)) as f_user, t_type as tunneltype, from_dtime(min(s_time)) as start_time, count(distinct tunnelid) as total_num, sum(duration) as duration from (select string_agg(distinct xauthuser_agg, ' ') as xauthuser_agg, string_agg(distinct user_agg, ' ') as user_agg, t_type, devid, vd, remip, tunnelid, min(s_time) as s_time, max(e_time) as e_time, (case when min(s_time)=max(e_time) then NULL else max(max_duration)-min(min_duration) end) as duration, (case when min(s_time)=max(e_time) then NULL else max(max_traffic_in)-min(min_traffic_in)+max(max_traffic_out)-min(min_traffic_out) end) as bandwidth, (case when min(s_time)=max(e_time) then NULL else max(max_traffic_in)-min(min_traffic_in) end) as traffic_in, (case when min(s_time)=max(e_time) then NULL else max(max_traffic_out)-min(min_traffic_out) end) as traffic_out, count(distinct tunnelid) as total_num from ###(select devid, vd, remip, nullifna(`xauthuser`) as xauthuser_agg, nullifna(`user`) as user_agg, (case when tunneltype like 'ipsec%' then 'ipsec' else tunneltype end) as t_type, tunnelid, tunnelip, min(coalesce(dtime, 0)) as s_time, max(coalesce(dtime, 0)) as e_time, max(coalesce(duration,0)) as max_duration, min(coalesce(duration,0)) as min_duration, min(coalesce(sentbyte, 0)) as min_traffic_out, min(coalesce(rcvdbyte, 0)) as min_traffic_in, max(coalesce(sentbyte, 0)) as max_traffic_out, max(coalesce(rcvdbyte, 0)) as max_traffic_in, max(coalesce(rcvdbyte, 0)+coalesce(sentbyte, 0)) as max_traffic, sum((case when action='tunnel-up' then 1 else 0 end)) as tunnelup from $log where $filter and subtype='vpn' and (tunneltype like 'ipsec%' or tunneltype like 'ssl%') and action in ('tunnel-up', 'tunnel-stats', 'tunnel-down') and tunnelid is not null and tunnelid!=0 group by xauthuser_agg, user_agg, devid, vd, remip, t_type, tunnelid, tunnelip order by max_traffic desc)### t group by t_type, devid, vd, remip, tunnelid) tt where bandwidth>0 group by f_user, tunneltype order by total_num desc"
        set protected enable
    next
    edit "vpn-Failed-Logins"
        set description "VPN failed logins"
        set log-type event 
        set query "select f_user, tunneltype, sum(total_num) as total_num from ###(select coalesce(nullifna(`xauthuser`), `user`) as f_user, tunneltype, count(*) as total_num from $log where $filter and subtype='vpn' and (tunneltype like 'ipsec%' or tunneltype like 'ssl%') and action in ('ssl-login-fail', 'ipsec-login-fail') and coalesce(nullifna(`xauthuser`), nullifna(`user`)) is not null group by f_user, tunneltype)### t group by f_user, tunneltype order by total_num desc"
        set protected enable
    next
    edit "vpn-Top-S2S-IPSEC-Tunnels-By-Bandwidth-and-Avail"
        set description "Top S2S IPsec tunnels by bandwidth usage and avail"
        set log-type event
        set query "select vpntunnel, tunneltype, sum(traffic_out) as traffic_out, sum(traffic_in) as traffic_in, sum(bandwidth) as bandwidth, sum(uptime) as uptime from (select vpntunnel, tunneltype, tunnelid, devid, vd, sum(sent_end-sent_beg) as traffic_out, sum(rcvd_end-rcvd_beg) as traffic_in, sum(sent_end-sent_beg+rcvd_end-rcvd_beg) as bandwidth, sum(duration_end-duration_beg) as uptime from ###(select tunnelid, tunneltype, vpntunnel, devid, vd, min(coalesce(sentbyte, 0)) as sent_beg, max(coalesce(sentbyte, 0)) as sent_end, min(coalesce(rcvdbyte, 0)) as rcvd_beg, max(coalesce(rcvdbyte, 0)) as rcvd_end, min(coalesce(duration, 0)) as duration_beg, max(coalesce(duration, 0)) as duration_end from $log where $filter and subtype='vpn' and action='tunnel-stats' and tunneltype like 'ipsec%' and (tunnelip is null or tunnelip='0.0.0.0') and nullifna(`user`) is null and tunnelid is not null and tunnelid!=0 group by tunnelid, tunneltype, vpntunnel, devid, vd /*SkipSTART*/order by tunnelid/*SkipEND*/)### t group by vpntunnel, tunneltype, tunnelid, devid, vd order by bandwidth desc) t where bandwidth>0 group by vpntunnel, tunneltype order by bandwidth desc"
        set protected enable
    next
    edit "vpn-Top-Dialup-IPSEC-Users-By-Bandwidth-and-Avail"
        set description "Top dialup IPsec users by bandwidth usage and avail"
        set log-type event
        set query "select user_src, remip, sum(traffic_out) as traffic_out, sum(traffic_in) as traffic_in, sum(bandwidth) as bandwidth, sum(uptime) as uptime from (select user_src, remip, tunnelid, devid, vd, sum(sent_end-sent_beg) as traffic_out, sum(rcvd_end-rcvd_beg) as traffic_in, sum(sent_end-sent_beg+rcvd_end-rcvd_beg) as bandwidth, sum(duration_end-duration_beg) as uptime from ###(select tunnelid, coalesce(nullifna(`xauthuser`), nullifna(`user`), ipstr(`remip`)) as user_src, remip, devid, vd, min(coalesce(sentbyte, 0)) as sent_beg, max(coalesce(sentbyte, 0)) as sent_end, min(coalesce(rcvdbyte, 0)) as rcvd_beg, max(coalesce(rcvdbyte, 0)) as rcvd_end, min(coalesce(duration, 0)) as duration_beg, max(coalesce(duration, 0)) as duration_end from $log where $filter and subtype='vpn' and action='tunnel-stats' and tunneltype like 'ipsec%' and not (tunnelip is null or tunnelip='0.0.0.0') and tunnelid is not null and tunnelid!=0 group by tunnelid, user_src, remip, devid, vd /*SkipSTART*/order by tunnelid/*SkipEND*/)### t group by user_src, remip, tunnelid, devid, vd order by bandwidth desc) t where bandwidth>0 group by user_src, remip order by bandwidth desc"
        set protected enable
    next
    edit "vpn-Top-SSL-Tunnel-Users-By-Bandwidth-and-Avail"
        set description "Top SSL tunnel users by bandwidth usage and avail"
        set log-type event
        set query "select user_src, remote_ip, sum(traffic_out) as traffic_out, sum(traffic_in) as traffic_in, sum(bandwidth) as bandwidth, sum(uptime) as uptime from (select user_src, remip as remote_ip, tunnelid, devid, vd, sum(sent_end-sent_beg) as traffic_out, sum(rcvd_end-rcvd_beg) as traffic_in, sum(sent_end-sent_beg+rcvd_end-rcvd_beg) as bandwidth, sum(duration_end-duration_beg) as uptime from ###(select tunnelid, tunneltype, coalesce(nullifna(`user`), ipstr(`remip`)) as user_src, remip, devid, vd, min(coalesce(sentbyte, 0)) as sent_beg, max(coalesce(sentbyte, 0)) as sent_end, min(coalesce(rcvdbyte, 0)) as rcvd_beg, max(coalesce(rcvdbyte, 0)) as rcvd_end, min(coalesce(duration, 0)) as duration_beg, max(coalesce(duration, 0)) as duration_end from $log where $filter and subtype='vpn' and action='tunnel-stats' and coalesce(nullifna(`user`), ipstr(`remip`)) is not null and tunnelid is not null group by tunnelid, tunneltype, user_src, remip, devid, vd /*SkipSTART*/order by tunnelid/*SkipEND*/)### t where tunneltype in ('ssl-tunnel', 'ssl') group by user_src, remote_ip, tunnelid, devid, vd order by bandwidth desc) t where bandwidth>0 group by user_src, remote_ip order by bandwidth desc"
        set protected enable
    next
    edit "vpn-Top-SSL-Web-Users-By-Bandwidth-and-Avail"
        set description "Top SSL web users by bandwidth usage and avail"
        set log-type event
        set query "select user_src, remote_ip, sum(traffic_out) as traffic_out, sum(traffic_in) as traffic_in, sum(bandwidth) as bandwidth, sum(uptime) as uptime from (select user_src, remip as remote_ip, tunnelid, devid, vd, sum(sent_end-sent_beg) as traffic_out, sum(rcvd_end-rcvd_beg) as traffic_in, sum(sent_end-sent_beg+rcvd_end-rcvd_beg) as bandwidth, sum(duration_end-duration_beg) as uptime from ###(select tunnelid, tunneltype, coalesce(nullifna(`user`), ipstr(`remip`)) as user_src, remip, devid, vd, min(coalesce(sentbyte, 0)) as sent_beg, max(coalesce(sentbyte, 0)) as sent_end, min(coalesce(rcvdbyte, 0)) as rcvd_beg, max(coalesce(rcvdbyte, 0)) as rcvd_end, min(coalesce(duration, 0)) as duration_beg, max(coalesce(duration, 0)) as duration_end from $log where $filter and subtype='vpn' and action='tunnel-stats' and coalesce(nullifna(`user`), ipstr(`remip`)) is not null and tunnelid is not null group by tunnelid, tunneltype, user_src, remip, devid, vd /*SkipSTART*/order by tunnelid/*SkipEND*/)### t where tunneltype='ssl-web' group by user_src, remote_ip, tunnelid, devid, vd having sum(sent_end-sent_beg+rcvd_end-rcvd_beg)>0 order by bandwidth desc) t where bandwidth>0 group by user_src, remote_ip order by bandwidth desc"
        set protected enable
    next

    edit "event-Admin-Login-Summary"
        set description "Event admin login summary"
         set log-type event
         set query "select f_user, ui, sum(login) as total_num, sum(login_duration) as total_duration, sum(config_change) as total_change from (select `user` as f_user, ui, (case when logid_to_int(logid)=32001 then 1 else 0 end) as login, (case when logid_to_int(logid)=32003 then duration else 0 end) as login_duration, (case when logid_to_int(logid)=32003 and state is not null then 1 else 0 end) as config_change from $log where $filter and nullifna(`user`) is not null and logid_to_int(logid) in (32001, 32003)) t group by f_user, ui having sum(login)+sum(config_change)>0 order by total_num desc"
         set protected enable
     next

     edit "event-Admin-Login-Summary-By-Date"
        set description "Event admin login summary by date"
         set log-type event
         set query "select $flex_timescale(timestamp) as dom, sum(total_num) as total_num, sum(total_change) as total_change from ###(select timestamp, sum(login) as total_num, sum(config_change) as total_change from (select $flex_timestamp as timestamp, (case when logid_to_int(logid)=32001 then 1 else 0 end) as login, (case when logid_to_int(logid)=32003 and state is not null then 1 else 0 end) as config_change from $log where $filter and logid_to_int(logid) in (32001, 32003)) t group by timestamp having sum(login)+sum(config_change)>0 /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t group by dom order by dom"
         set protected enable
     next

     edit "event-Admin-Failed-Login-Summary"
        set description "Event admin failed login summary"
         set log-type event
         set query "select `user` as f_user, ui, count(status) as total_failed from $log where $filter and nullifna(`user`) is not null and logid_to_int(logid) = 32002 group by ui, f_user order by total_failed desc"
         set protected enable
     next

     edit "event-System-Summary-By-Severity"
        set description "Event system summary by severity"
         set log-type event
         set query "select severity_tmp as severity, sum(count) as total_num from ###(select coalesce(nullifna(logdesc), msg) as msg_desc, (case when level in ('critical', 'alert', 'emergency') then 'Critical' when level='error' then 'High' when level='warning' then 'Medium' when level='notice' then 'Low' else 'Info' end) as severity_tmp, count(*) as count from $log where $filter and subtype='system' group by msg_desc, severity_tmp /*SkipSTART*/order by count desc/*SkipEND*/)### t group by severity order by total_num desc"
         set protected enable
     next

     edit "event-System-Summary-By-Date"
        set description "Event system summary by date"
         set log-type event
         set query "select $flex_timescale(timestamp) as dom, sum(critical) as critical, sum(high) as high, sum(medium) as medium from ###(select $flex_timestamp as timestamp, sum(case when level in ('critical', 'alert', 'emergency') then 1 else 0 end) as critical, sum(case when level = 'error' then 1 else 0 end) as high, sum(case when level = 'warning' then 1 else 0 end) as medium from $log where $filter and subtype='system' group by timestamp /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t group by dom order by dom"
         set protected enable
     next

     edit "event-System-Critical-Severity-Events"
        set description "Event system critical severity events"
         set log-type event
         set query "select msg_desc as msg, severity_tmp as severity, sum(count) as counts from ###(select coalesce(nullifna(logdesc), msg) as msg_desc, (case when level in ('critical', 'alert', 'emergency') then 'Critical' when level='error' then 'High' when level='warning' then 'Medium' when level='notice' then 'Low' else 'Info' end) as severity_tmp, count(*) as count from $log where $filter and subtype='system' group by msg_desc, severity_tmp /*SkipSTART*/order by count desc/*SkipEND*/)### t where severity_tmp='Critical' group by msg, severity_tmp order by counts desc"
         set protected enable
     next

     edit "event-System-High-Severity-Events"
        set description "Event system high severity events"
         set log-type event
         set query "select msg_desc as msg, severity_tmp as severity, sum(count) as counts from ###(select coalesce(nullifna(logdesc), msg) as msg_desc, (case when level in ('critical', 'alert', 'emergency') then 'Critical' when level='error' then 'High' when level='warning' then 'Medium' when level='notice' then 'Low' else 'Info' end) as severity_tmp, count(*) as count from $log where $filter and subtype='system' group by msg_desc, severity_tmp /*SkipSTART*/order by count desc/*SkipEND*/)### t where severity_tmp='High' group by msg, severity_tmp order by counts desc"
         set protected enable
     next

     edit "event-System-Medium-Severity-Events"
        set description "Event system medium severity events"
         set log-type event
         set query "select msg_desc as msg, severity_tmp as severity, sum(count) as counts from ###(select coalesce(nullifna(logdesc), msg) as msg_desc, (case when level in ('critical', 'alert', 'emergency') then 'Critical' when level='error' then 'High' when level='warning' then 'Medium' when level='notice' then 'Low' else 'Info' end) as severity_tmp, count(*) as count from $log where $filter and subtype='system' group by msg_desc, severity_tmp /*SkipSTART*/order by count desc/*SkipEND*/)### t where severity_tmp='Medium' group by msg, severity_tmp order by counts desc"
         set protected enable
     next


    edit "utm-drilldown-Top-Users-By-Bandwidth"
        set description "UTM drilldown top users by bandwidth usage"
        set log-type traffic
        set query "select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as dldn_user, count(*) as session, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(sentbyte, 0)) as traffic_out, sum(coalesce(rcvdbyte, 0)) as traffic_in from $log where $filter and (logflag&1>0) group by dldn_user having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set hidden enable
        set protected enable
    next
    edit "utm-drilldown-Traffic-Summary"
        set description "UTM drilldown traffic summary"
        set log-type traffic
        set query "select srcip, srcname from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, srcip, srcname, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter and (logflag&1>0) group by user_src, srcip, srcname order by bandwidth desc)### t where $filter-drilldown group by srcip, srcname"
            config variable
                edit "dldn_user"
                    set var-name "User (or Source IP)"
                    set var-expression "`user_src`"
                    set var-type string
                next
            end
        set hidden enable
        set protected enable
    next
    edit "utm-drilldown-Top-User-Destination"
        set description "UTM drilldown top user destination"
        set log-type traffic
        set query "select appid, app, dstip, sum(sessions) as sessions, sum(bandwidth) as bandwidth from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, appid, app, dstip, count(*) as sessions, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter and (logflag&1>0) and dstip is not null and nullifna(app) is not null group by user_src, appid, app, dstip having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc)### t where $filter-drilldown group by appid, app, dstip order by bandwidth desc"
            config variable
                edit "dldn_user"
                    set var-name "User (or Source IP)"
                    set var-expression "`user_src`"
                    set var-type string
                next
            end
        set hidden enable
        set protected enable
    next
    edit "utm-drilldown-Email-Senders-Summary"
        set description "UTM drilldown email senders summary"
        set log-type traffic
        set query "select sum(requests) as requests, sum(bandwidth) as bandwidth from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sender, count(*) as requests, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter and (logflag&1>0) and service in ('smtp', 'SMTP', '25/tcp', '587/tcp', 'smtps', 'SMTPS', '465/tcp') group by user_src, sender order by requests desc)### t where $filter-drilldown"
            config variable
                edit "dldn_user"
                    set var-name "User (or Source IP)"
                    set var-expression "`user_src`"
                    set var-type string
                next
            end
        set hidden enable
        set protected enable
    next
    edit "utm-drilldown-Email-Receivers-Summary"
        set description "UTM drilldown email receivers summary"
        set log-type traffic
        set query "select sum(requests) as requests, sum(bandwidth) as bandwidth from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, recipient, count(*) as requests, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter and (logflag&1>0) and recipient is not null and service in ('pop3', 'POP3', '110/tcp', 'imap', 'IMAP', '143/tcp', 'imaps', 'IMAPS', '993/tcp', 'pop3s', 'POP3S', '995/tcp') group by user_src, recipient order by requests desc)### t where $filter-drilldown"
            config variable
                edit "dldn_user"
                    set var-name "User (or Source IP)"
                    set var-expression "`user_src`"
                    set var-type string
                next
            end
        set hidden enable
        set protected enable
    next
    edit "utm-drilldown-Top-Email-Recipients"
        set description "UTM drilldown top email recipients"
        set log-type traffic
        set query "select recipient, sum(bandwidth) as bandwidth from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, recipient, count(*) as requests, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter and (logflag&1>0) and recipient is not null and service in ('pop3', 'POP3', '110/tcp', 'imap', 'IMAP', '143/tcp', 'imaps', 'IMAPS', '993/tcp', 'pop3s', 'POP3S', '995/tcp') group by user_src, recipient order by requests desc)### t where $filter-drilldown group by recipient having sum(bandwidth)>0 order by bandwidth desc"
            config variable
                edit "dldn_user"
                    set var-name "User (or Source IP)"
                    set var-expression "`user_src`"
                    set var-type string
                next
            end
        set hidden enable
        set protected enable
    next
    edit "utm-drilldown-Top-Email-Senders"
        set description "UTM drilldown top email senders"
        set log-type traffic
        set query "select sender, sum(bandwidth) as bandwidth from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sender, count(*) as requests, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter and (logflag&1>0) and service in ('smtp', 'SMTP', '25/tcp', '587/tcp', 'smtps', 'SMTPS', '465/tcp') group by user_src, sender order by requests desc)### t where $filter-drilldown and sender is not null group by sender having sum(bandwidth)>0 order by bandwidth desc"
            config variable
                edit "dldn_user"
                    set var-name "User (or Source IP)"
                    set var-expression "`user_src`"
                    set var-type string
                next
            end
        set hidden enable
        set protected enable
    next
    edit "utm-drilldown-Top-Allowed-Web-Sites-By-Bandwidth"
        set description "UTM drilldown top allowed web sites by bandwidth"
        set log-type traffic
        set query "select appid, hostname, sum(bandwidth) as bandwidth from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, appid, hostname, (case when utmaction in ('block', 'blocked') then 1 else 0 end) as blocked, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log-traffic where $filter and (logflag&1>0) and (countweb>0 or ((logver is null or logver<502000000) and (hostname is not null or utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter')))) and hostname is not null group by user_src, appid, hostname, blocked order by bandwidth desc)### t where $filter-drilldown and blocked=0 group by appid, hostname order by bandwidth desc"
             config variable
                edit "dldn_user"
                    set var-name "User (or Source IP)"
                    set var-expression "`user_src`"
                    set var-type string
                next
            end
        set hidden enable
        set protected enable
    next
    edit "utm-drilldown-Top-Blocked-Web-Sites-By-Request"
        set description "UTM drilldown top blocked web sites by request"
        set log-type webfilter
        set query "select appid, hostname, sum(requests) as requests from ###(select coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, 0 as appid, hostname, (case when action='blocked' then 1 else 0 end) as blocked, count(*) as requests from $log where $filter and hostname is not null group by user_src, appid, hostname, blocked order by requests desc)### t where $filter-drilldown and blocked=1 group by appid, hostname order by requests desc"
             config variable
                edit "dldn_user"
                    set var-name "User (or Source IP)"
                    set var-expression "`user_src`"
                    set var-type string
                next
            end
        set hidden enable
        set protected enable
    next
    edit "utm-drilldown-Top-Virus"
        set description "UTM drilldown top virus"
        set log-type virus
        set query "select virus, sum(totalnum) as totalnum from ###(select coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, virus, count(*) as totalnum from $log where $filter and nullifna(virus) is not null group by user_src, virus order by totalnum desc)### t where $filter-drilldown group by virus order by totalnum desc"
            config variable
                edit "dldn_user"
                    set var-name "User (or Source IP)"
                    set var-expression "`user_src`"
                    set var-type string
                next
            end
        set hidden enable
        set protected enable
    next
    edit "utm-drilldown-Top-Attacks-By-Name"
        set description "UTM drilldown top attacks by name"
        set log-type attack
        set query "select attack, sum(attack_count) as attack_count from ###(select coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, attack, count(*) as attack_count from $log where $filter and nullifna(attack) is not null group by user_src, attack order by attack_count desc)### t where $filter-drilldown group by attack order by attack_count desc"
            config variable
                edit "dldn_user"
                    set var-name "User (or Source IP)"
                    set var-expression "`user_src`"
                    set var-type string
                next
            end
        set hidden enable
        set protected enable
    next
    edit "utm-drilldown-Top-Vulnerability-By-Name"
        set description "UTM drilldown top vulnerability by name"
        set log-type netscan
        set query "select vuln, sum(totalnum) as totalnum from ###(select coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, vuln, count(*) as totalnum from $log where $filter and action='vuln-detection' and vuln is not null group by user_src, vuln order by totalnum desc)### t where $filter-drilldown group by vuln order by totalnum desc"
            config variable
                edit "dldn_user"
                    set var-name "User (or Source IP)"
                    set var-expression "`user_src`"
                    set var-type string
                next
                edit "severity"
                    set var-name "severity"
                next
                edit "vulncat"
                    set var-name "vulncat"
                next
            end
        set hidden enable
        set protected enable
    next
    edit "utm-drilldown-Top-App-By-Bandwidth"
        set description "UTM drilldown top applications by bandwidth usage"
        set log-type traffic
        set query "select appid, app, sum(bandwidth) as bandwidth from ###(select user_src, appid, app, appcat, apprisk, sum(bandwidth) as bandwidth, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t group by user_src, appid, app, appcat, apprisk /*SkipSTART*/order by sessions desc, bandwidth desc/*SkipEND*/)### t where $filter-drilldown group by appid, app having sum(bandwidth)>0 order by bandwidth desc"
            config variable
                edit "dldn_user"
                    set var-name "User (or Source IP)"
                    set var-expression "`user_src`"
                    set var-type string
                next
            end
        set hidden enable
        set protected enable
    next
    edit "utm-drilldown-Top-App-By-Sessions"
        set description "UTM drilldown top applications by session count"
        set log-type traffic
        set query "select appid, app, sum(sessions) as sessions from ###(select user_src, appid, app, appcat, apprisk, sum(bandwidth) as bandwidth, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t group by user_src, appid, app, appcat, apprisk /*SkipSTART*/order by sessions desc, bandwidth desc/*SkipEND*/)### t where $filter-drilldown group by appid, app order by sessions desc"
            config variable
                edit "dldn_user"
                    set var-name "User (or Source IP)"
                    set var-expression "`user_src`"
                    set var-type string
                next
            end
        set hidden enable
        set protected enable
    next

    edit "traffic-Top-Users-By-Bandwidth"
        set description "Traffic top users by bandwidth usage"
        set log-type traffic
        set query "select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter and (logflag&1>0) group by user_src having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next

    edit "reputation-Score-Summary-For-All-Users-Devices"
        set description "Reputation score summary for all users devices"
        set log-type traffic
        set query "select $flex_timescale(timestamp) as hodex, sum(scores) as scores from ###(select $flex_timestamp as timestamp, sum(crscore%65536) as scores, count(*) as totalnum from $log where $filter and (logflag&1>0) and crscore is not null group by timestamp having sum(crscore%65536)>0 order by timestamp desc)### t group by hodex order by hodex"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "reputation-Number-Of-Incidents-For-All-Users-Devices"
        set description "Reputation number of incidents for all users devices"
        set log-type traffic
        set query "select $flex_timescale(timestamp) as hodex, sum(scores) as scores, sum(totalnum) as totalnum from ###(select $flex_timestamp as timestamp, sum(crscore%65536) as scores, count(*) as totalnum from $log where $filter and (logflag&1>0) and crscore is not null group by timestamp having sum(crscore%65536)>0 order by timestamp desc)### t group by hodex order by hodex"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "reputation-Top-Users-By-Scores"
        set description "Reputation top users by scores"
        set log-type traffic
        set query "select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(crscore%65536) as scores from $log where $filter and (logflag&1>0) and crscore is not null group by user_src having sum(crscore%65536)>0 order by scores desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "reputation-Top-Devices-By-Scores"
        set description "Reputation top devices by scores"
        set log-type traffic
        set query "select max(get_devtype(srcswversion, osname, devtype)) as devtype_new, coalesce(nullifna(`srcname`),nullifna(`srcmac`), ipstr(`srcip`)) as dev_src,  sum(crscore%65536) as scores from $log where $filter and (logflag&1>0) and crscore is not null group by dev_src having sum(crscore%65536)>0 order by scores desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "reputation-Top-Users-With-Increased-Scores"
        set description "Reputation top users with increased scores"
        set log-type traffic
        set query "drop table if exists rpt_tmptbl_1; drop table if exists rpt_tmptbl_2; create temporary table rpt_tmptbl_1 as select f_user, sum(sum_rp_score) as sum_rp_score from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as f_user, sum(crscore%65536) as sum_rp_score from $log where $pre_period $filter and (logflag&1>0) and crscore is not null group by f_user having sum(crscore%65536)>0 order by sum_rp_score desc)### t group by f_user; create temporary table rpt_tmptbl_2 as select f_user, sum(sum_rp_score) as sum_rp_score from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as f_user, sum(crscore%65536) as sum_rp_score from $log where $filter and (logflag&1>0) and crscore is not null group by f_user having sum(crscore%65536)>0 order by sum_rp_score desc)### t group by f_user; select t1.f_user, sum(t1.sum_rp_score) as t1_sum_score, sum(t2.sum_rp_score) as t2_sum_score, (sum(t2.sum_rp_score)-sum(t1.sum_rp_score)) as delta from rpt_tmptbl_1 as t1 inner join rpt_tmptbl_2 as t2 on t1.f_user=t2.f_user where t2.sum_rp_score > t1.sum_rp_score group by t1.f_user order by delta desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "reputation-Top-Devices-With-Increased-Scores"
        set description "Reputation top devices with increased scores"
        set log-type traffic
        set query "drop table if exists rpt_tmptbl_1; drop table if exists rpt_tmptbl_2; create temporary table rpt_tmptbl_1 as select f_device, devtype_new, sum(sum_rp_score) as sum_rp_score from ###(select coalesce(nullifna(`srcname`),nullifna(`srcmac`), ipstr(`srcip`)) as f_device, get_devtype(srcswversion, osname, devtype) as devtype_new, sum(crscore%65536) as sum_rp_score from $log where $pre_period $filter and (logflag&1>0) and crscore is not null group by f_device, devtype_new having sum(crscore%65536)>0 order by sum_rp_score desc)### t group by f_device, devtype_new; create temporary table rpt_tmptbl_2 as select f_device, devtype_new, sum(sum_rp_score) as sum_rp_score from ###(select coalesce(nullifna(`srcname`),nullifna(`srcmac`), ipstr(`srcip`)) as f_device, get_devtype(srcswversion, osname, devtype) as devtype_new, sum(crscore%65536) as sum_rp_score from $log where $filter and (logflag&1>0) and crscore is not null group by f_device, devtype_new having sum(crscore%65536)>0 order by sum_rp_score desc)### t group by f_device, devtype_new; select t1.f_device, t1.devtype_new , sum(t1.sum_rp_score) as t1_sum_score, sum(t2.sum_rp_score) as t2_sum_score, (sum(t2.sum_rp_score)-sum(t1.sum_rp_score)) as delta from rpt_tmptbl_1 as t1 inner join rpt_tmptbl_2 as t2 on t1.f_device=t2.f_device and t1.devtype_new=t2.devtype_new where t2.sum_rp_score > t1.sum_rp_score group by t1.f_device, t1.devtype_new order by delta desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "threat-Attacks-By-Severity"
        set description "Threat attacks by severity"
         set log-type attack
         set query "select (case when severity='critical' then 'Critical' when severity='high' then 'High' when severity='medium' then 'Medium' when severity='low' then 'Low' when severity='info' then 'Info' end) as severity, count(*) as totalnum from $log where $filter group by severity order by totalnum desc"
         set protected enable
    next
    edit "threat-Top-Attacks-Detected"
        set description "Threat top attacks detected"
        set log-type attack
        set query "select attack, attackid, cve, severity, sum(attack_count) as attack_count from ###(select attack, attackid, t1.severity, cve, (case when t1.severity = 'critical' then 1 when t1.severity = 'high' then 2 when t1.severity = 'medium'  then 3 when t1.severity = 'low' then 4 else 5 end) as severity_level, count(*) as attack_count from $log t1 left join (select name, cve, vuln_type from ips_mdata) t2 on t1.attack=t2.name where $filter and nullifna(attack) is not null group by attack, attackid, t1.severity, severity_level, cve /*SkipSTART*/order by severity_level, attack_count desc/*SkipEND*/)### t group by attack, attackid, severity, severity_level, cve order by severity_level, attack_count desc"
        set protected enable
    next
    edit "threat-Top-Attacks-Blocked"
        set description "Threat top attacks blocked"
        set log-type attack
        set query "select attack, count(*) as attack_count from $log where $filter and nullifna(attack) is not null and action not in ('detected', 'pass_session') group  by attack order by attack_count desc"
        set protected enable
    next
    edit "threat-Intrusion-Timeline"
        set description "Threat intrusion timeline"
        set log-type attack
        set query "select $flex_timescale(timestamp) as hodex, sum(totalnum) as totalnum from ###(select $flex_timestamp as timestamp, count(*) as totalnum from $log where $filter group by timestamp /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t group by hodex order by hodex"
        set protected enable
    next
    edit "threat-Top-Virus-Source"
        set description "Threat top virus source"
        set log-type virus
        set query "select source, hostname, sum(totalnum) as totalnum from ###(select source, ipstr(`victim`) as hostname, sum(totalnum) as totalnum from ( select (CASE WHEN direction='incoming' THEN dstip ELSE srcip END) as source, (CASE WHEN direction='incoming' THEN srcip ELSE dstip END) as victim, count(*) as totalnum from $log where $filter and nullifna(virus) is not null group by source, victim ) t group by source, hostname /*SkipSTART*/order by totalnum desc/*SkipEND*/)### t group by source, hostname order by totalnum desc"
        set protected enable
    next
    edit "threat-Virus-Timeline"
        set description "Threat virus timeline"
        set log-type virus
        set query "select $flex_datetime(timestamp) as hodex, sum(totalnum) as totalnum from ###(select $flex_timestamp as timestamp, count(*) as totalnum from $log where $filter and nullifna(virus) is not null group by timestamp /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t group by hodex order by hodex"
        set protected enable
    next
    edit "threat-Top-Spyware-Victims"
        set description "Threat top spyware victims"
        set log-type virus
        set query "select user_src, sum(totalnum) as totalnum from ###(select coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, virus, count(*) as totalnum from $log where $filter group by user_src, virus /*SkipSTART*/order by totalnum desc/*SkipEND*/)### t where  virus like 'Riskware%' group by user_src order by totalnum desc"
        set protected enable
    next
    edit "threat-Top-Spyware-by-Name"
        set description "Threat top spyware by name"
        set log-type virus
        set query "select virus, max(virusid_s) as virusid, sum(totalnum) as totalnum from ###(select filename, analyticscksum, service, fsaverdict, dtype, coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, virus, virusid_to_str(virusid, eventtype) as virusid_s, count(*) as totalnum from $log where $filter group by filename, analyticscksum, service, fsaverdict, dtype, user_src, virus, virusid_s /*SkipSTART*/order by totalnum desc/*SkipEND*/)### t where virus like 'Riskware%' group by virus order by totalnum desc"
        set protected enable
    next
    edit "threat-Top-Spyware-Source"
        set description "Threat top spyware source"
        set log-type traffic
        set query "select srcip, hostname, sum(totalnum) as totalnum from ###(select srcip, hostname, virus, count(*) as totalnum from $log where $filter and (logflag&1>0) group by srcip, hostname, virus order by totalnum desc)### t where virus like 'Riskware%' group by srcip, hostname order by totalnum desc"
        set protected enable
    next
    edit "threat-Spyware-Timeline"
        set description "Threat spyware timeline"
        set log-type virus
        set query "select $flex_timescale(timestamp) as hodex, sum(totalnum) as totalnum from ###(select $flex_timestamp as timestamp, virus, count(*) as totalnum from $log where $filter group by timestamp, virus /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where virus like 'Riskware%' group by hodex order by hodex"
        set protected enable
    next
    edit "threat-Top-Adware-Victims"
        set description "Threat top adware victims"
        set log-type virus
        set query "select user_src, sum(totalnum) as totalnum from ###(select coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, virus, count(*) as totalnum from $log where $filter group by user_src, virus /*SkipSTART*/order by totalnum desc/*SkipEND*/)### t where virus like 'Adware%' group by user_src order by totalnum desc"
        set protected enable
    next
    edit "threat-Top-Adware-by-Name"
        set description "Threat top adware by name"
        set log-type virus
        set query "select virus, max(virusid_s) as virusid, sum(totalnum) as totalnum from ###(select filename, analyticscksum, service, fsaverdict, dtype, coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, virus, virusid_to_str(virusid, eventtype) as virusid_s, count(*) as totalnum from $log where $filter group by filename, analyticscksum, service, fsaverdict, dtype, user_src, virus, virusid_s /*SkipSTART*/order by totalnum desc/*SkipEND*/)### t where virus like 'Adware%' group by virus order by totalnum desc"
        set protected enable
    next
    edit "threat-Top-Adware-Source"
        set description "Threat top adware source"
        set log-type traffic
        set query "select srcip, hostname, sum(totalnum) as totalnum from ###(select srcip, hostname, virus, count(*) as totalnum from $log where $filter and (logflag&1>0) group by srcip, hostname, virus order by totalnum desc)### t where virus like 'Adware%' group by srcip, hostname order by totalnum desc"
        set protected enable
    next
    edit "threat-Adware-Timeline"
        set description "Threat adware timeline"
        set log-type virus
        set query "select $flex_timescale(timestamp) as hodex, sum(totalnum) as totalnum from ###(select $flex_timestamp as timestamp, virus, count(*) as totalnum from $log where $filter group by timestamp, virus /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where virus like 'Adware%' group by hodex order by hodex"
        set protected enable
    next

    edit "threat-Intrusions-Timeline-By-Severity"
        set description "Threat intrusions timeline by severity"
         set log-type attack
         set query "select $flex_timescale(timestamp) as timescale, sum(critical) as critical, sum(high) as high, sum(medium) as medium, sum(low) as low, sum(info) as info from ###(select $flex_timestamp as timestamp, sum(case when severity = 'critical' then 1 else 0 end) as critical, sum(case when severity = 'high' then 1 else 0 end) as high, sum(case when severity = 'medium' then 1 else 0 end) as medium, sum(case when severity in ('notice', 'low') then 1 else 0 end) as low, sum(case when severity = 'info' or severity = 'debug' then 1 else 0 end) as info from $log where $filter group by timestamp /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t group by timescale order by timescale"
         set protected enable
    next

    edit "threat-Top-Intrusions-By-Types"
        set description "Threat top intrusions by types"
         set log-type attack
        set query "select vuln_type, count(*) as totalnum from $log t1 left join (select name, cve, vuln_type from ips_mdata) t2 on t1.attack=t2.name where $filter and vuln_type is not null group by vuln_type order by totalnum desc"
         set protected enable
    next

    edit "threat-Critical-Severity-Intrusions"
        set description "Threat critical severity intrusions"
         set log-type attack
         set query "select attack, attackid, cve, vuln_type, count(*) as totalnum from $log t1 left join (select name, cve, vuln_type from ips_mdata) t2 on t1.attack=t2.name where $filter and t1.severity = 'critical' and nullifna(attack) is not null group by attack, attackid, cve, vuln_type order by totalnum desc"
         set protected enable
    next

    edit "threat-High-Severity-Intrusions"
        set description "Threat high severity intrusions"
         set log-type attack
        set query "select attack, attackid, vuln_type, cve, count(*) as totalnum from $log t1 left join (select name, cve, vuln_type from ips_mdata) t2 on t1.attack=t2.name where $filter and t1.severity='high' and nullifna(attack) is not null group by attack, attackid, vuln_type, cve order by totalnum desc"
         set protected enable
    next

    edit "threat-Medium-Severity-Intrusions"
        set description "Threat medium severity intrusions"
         set log-type attack
         set query "select attack, vuln_type, cve, count(*) as totalnum from $log t1 left join (select name, cve, vuln_type from ips_mdata) t2 on t1.attack=t2.name where $filter and t1.severity='medium' and nullifna(attack) is not null group by attack, vuln_type, cve order by totalnum desc"
         set protected enable
    next

    edit "threat-Top-Intrusion-Victims"
        set description "Threat top intrusion victims"
         set log-type attack
         set query "select victim, sum(cri_num) as critical, sum(high_num) as high, sum(med_num) as medium, sum(cri_num + high_num + med_num) as totalnum from ###(select (CASE WHEN direction='incoming' THEN srcip ELSE dstip END) as victim, sum((case when severity='critical' then 1 else 0 end)) as cri_num, sum(case when severity='high' then 1 else 0 end) as high_num, sum(case when severity='medium' then 1 else 0 end) as med_num from $log where $filter and severity in ('critical', 'high', 'medium') group by victim)### t group by victim order by totalnum desc"
         set protected enable
    next

    edit "threat-Top-Intrusion-Sources"
        set description "Threat top intrusion sources"
         set log-type attack
         set query "select source, sum(cri_num) as critical, sum(high_num) as high, sum(med_num) as medium, sum(cri_num + high_num + med_num) as totalnum from ###(select (CASE WHEN direction='incoming' THEN dstip ELSE srcip END) as source, sum(case when severity='critical' then 1 else 0 end) as cri_num, sum(case when severity='high' then 1 else 0 end) as high_num, sum(case when severity='medium' then 1 else 0 end) as med_num from $log where $filter and severity in ('critical', 'high', 'medium') group by source)### t group by source order by totalnum desc"
         set protected enable
    next

    edit "threat-Top-Monitored-Intrusions"
        set description "Threat top monitored intrusions"
        set log-type attack
        set query "select attack, attackid, (case when severity='critical' then 'Critical' when severity='high' then 'High' when severity='medium' then 'Medium' when severity='low' then 'Low' when severity='info' then 'Info' end) as severity_name, sum(totalnum) as totalnum, vuln_type, (case when severity='critical' then 0 when severity='high' then 1 when severity='medium' then 2 when severity='low' then 3 when severity='info' then 4 else 5 end) as severity_number from ###(select attack, attackid, t1.severity, count(*) as totalnum, vuln_type, action from $log t1 left join (select name, cve, vuln_type from ips_mdata) t2 on t1.attack=t2.name where $filter and nullifna(attack) is not null group by attack, attackid, t1.severity, vuln_type, action order by totalnum desc)### t where action in ('detected', 'pass_session') group by attack, attackid, severity, vuln_type order by severity_number, totalnum desc"
        set protected enable
    next

    edit "threat-Top-Blocked-Intrusions"
        set description "Threat top blocked intrusions"
        set log-type attack
        set query "select attack, attackid, (case when severity='critical' then 'Critical' when severity='high' then 'High' when severity='medium' then 'Medium' when severity='low' then 'Low' when severity='info' then 'Info' end) as severity_name, sum(totalnum) as totalnum, vuln_type, (case when severity='critical' then 0 when severity='high' then 1 when severity='medium' then 2 when severity='low' then 3 when severity='info' then 4 else 5 end) as severity_number from ###(select attack, attackid, t1.severity, count(*) as totalnum, vuln_type, action from $log t1 left join (select name, cve, vuln_type from ips_mdata) t2 on t1.attack=t2.name where $filter and nullifna(attack) is not null group by attack, attackid, t1.severity, vuln_type, action order by totalnum desc)### t where action not in ('detected', 'pass_session') group by attack, attackid, severity, vuln_type order by severity_number, totalnum desc"
        set protected enable
    next

    edit "threat-Attacks-Over-HTTP-HTTPs"
        set description "Threat attacks over HTTP HTTPs"
        set log-type attack
        set query "select attack, attackid, (case when severity='critical' then 'Critical' when  severity='high' then 'High' when severity='medium' then 'Medium' when severity='low' then 'Low' when severity='info' then 'Info' end) as severity, count(*) as totalnum, (case when severity='critical' then 0 when severity='high' then 1 when severity='medium' then 2 when severity='low' then 3 when severity='info' then 4 else 5 end) as severity_number from $log where $filter and severity in ('critical', 'high', 'medium') and upper(service) in ('HTTP', 'HTTPS') group by attack, attackid, severity, severity_number order by severity_number, totalnum desc"
        set protected enable
    next

    edit "default-AP-Detection-Summary-by-Status-OffWire"
        set description "Default access point detection summary by status off-wire"
        set log-type event
        set query "select (case apstatus when 1 then 'rogue' when 2 then 'accepted' when 3 then 'suppressed' else 'others' end) as ap_full_status, count(*) as totalnum from (select apstatus, bssid, ssid from ###(select apstatus, bssid, ssid, onwire, count(*) as subtotal from $log where $filter and apstatus is not null and apstatus!=0 and bssid is not null and logid_to_int(logid) in (43527, 43521, 43525, 43563, 43564, 43565, 43566, 43569, 43570, 43571, 43582, 43583, 43584, 43585) group by apstatus, bssid, ssid, onwire order by subtotal desc)### t where onwire='no' group by apstatus, bssid, ssid) t group by ap_full_status order by totalnum desc"
        set protected enable
    next
    edit "default-AP-Detection-Summary-by-Status-OnWire"
        set description "Default access point detection summary by status on-wire"
        set log-type event
        set query "select (case apstatus when 1 then 'rogue' when 2 then 'accepted' when 3 then 'suppressed' else 'others' end) as ap_full_status, count(*) as totalnum from (select apstatus, bssid, ssid from ###(select apstatus, bssid, ssid, onwire, count(*) as subtotal from $log where $filter and apstatus is not null and apstatus!=0 and bssid is not null and logid_to_int(logid) in (43527, 43521, 43525, 43563, 43564, 43565, 43566, 43569, 43570, 43571, 43582, 43583, 43584, 43585) group by apstatus, bssid, ssid, onwire order by subtotal desc)### t where onwire='yes' group by apstatus, bssid, ssid) t group by ap_full_status order by totalnum desc"
        set protected enable
    next
    edit "default-Managed-AP-Summary"
        set description "Default managed access point summary"
        set log-type event
        set query "select (case when (action like '%join%' and logid_to_int(logid) in (43522, 43551)) then 'Authorized' else 'Unauthorized' end) as ap_status, count(*) as totalnum from $log where $filter and logid_to_int(logid) in (43522, 43551) group by ap_status order by totalnum desc"
        set protected enable
    next
    edit "default-Unclassified-AP-Summary"
        set description "Default unclassified access point summary"
        set log-type event
        set query "select (case onwire when 'no' then 'off-wire' when 'yes' then 'on-wire' else 'others' end) as ap_status, count(*) as totalnum from ###(select onwire, ssid, bssid, count(*) as subtotal from $log where $filter and apstatus=0 and bssid is not null and logid_to_int(logid) in (43521, 43525, 43527, 43563, 43564, 43565, 43566, 43569, 43570, 43571, 43582, 43583, 43584, 43585) group by onwire, ssid, bssid order by subtotal desc)### t group by ap_status order by totalnum desc"
        set protected enable
    next
    edit "default-selected-AP-Details-OnWire"
        set description "Default selected access point details on-wire"
        set log-type event
        set query "select (case apstatus when 0 then 'unclassified' when 1 then 'rogue' when 2 then 'accepted' when 3 then 'suppressed' else 'others' end) as ap_full_status, devid, vd, ssid, bssid, manuf, rssi, channel, radioband, from_dtime(min(first_seen)) as first_seen, from_dtime(max(last_seen)) as last_seen, detectionmethod, itime, onwire as on_wire from ###(select apstatus, devid, vd, ssid, bssid, manuf, rssi, channel, radioband, min(dtime) as first_seen, max(dtime) as last_seen, detectionmethod, itime, onwire from $log where $filter and apstatus is not null and bssid is not null and logid_to_int(logid) in (43521, 43563, 43564, 43565, 43566, 43569, 43570, 43571) group by apstatus, devid, vd, ssid, bssid, manuf, rssi, channel, radioband, detectionmethod, itime, onwire order by itime desc)### t where onwire='yes' group by ap_full_status, devid, vd, ssid, bssid, manuf, rssi, channel, radioband, detectionmethod, itime, onwire, apstatus order by itime desc"
        set protected enable
    next
    edit "default-selected-AP-Details-OffWire"
        set description "Default selected access point details off-wire"
        set log-type event
        set query "select (case apstatus when 0 then 'unclassified' when 1 then 'rogue' when 2 then 'accepted' when 3 then 'suppressed' else 'others' end) as ap_full_status, devid, vd, ssid, bssid, manuf, rssi, channel, radioband, from_dtime(min(first_seen)) as first_seen, from_dtime(max(last_seen)) as last_seen, detectionmethod, itime, onwire as on_wire from ###(select apstatus, devid, vd, ssid, bssid, manuf, rssi, channel, radioband, min(dtime) as first_seen, max(dtime) as last_seen, detectionmethod, itime, onwire from $log where $filter and apstatus is not null and bssid is not null and logid_to_int(logid) in (43521, 43563, 43564, 43565, 43566, 43569, 43570, 43571) group by apstatus, devid, vd, ssid, bssid, manuf, rssi, channel, radioband, detectionmethod, itime, onwire order by itime desc)### t where onwire='no' group by ap_full_status, devid, vd, ssid, bssid, manuf, rssi, channel, radioband, detectionmethod, itime, onwire, apstatus order by itime desc"
        set protected enable
    next
    edit "event-Wireless-Client-Details"
        set description "Event wireless client details"
        set log-type event
        set query "drop table if exists rpt_tmptbl_1; create temporary table rpt_tmptbl_1 as select ip, lmac, sn, ssid, channel, radioband, min(first) as first, max(last) as last from ###(select ip, lower(mac) as lmac, sn, ssid, channel, radioband, min(dtime) as first, max(dtime) as last from $log-event where $filter and ip is not null and mac is not null and sn is not null and ssid is not null group by ip, lmac, sn, ssid, channel, radioband order by ip)### t group by ip, lmac, sn, ssid, channel, radioband; select user_src, ip, lmac, sn, ssid, channel, radioband, from_dtime(first) as first_seen, from_dtime(last) as last_seen, cast(volume as decimal(18,2)) as bandwidth from (select * from rpt_tmptbl_1 inner join (select user_src, srcip, sum(volume) as volume from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, srcip, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as volume from $log-traffic where $filter-time and (logflag&1>0) and srcip is not null group by user_src, srcip having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by volume desc)### t group by user_src, srcip order by user_src, srcip) t on rpt_tmptbl_1.ip = t.srcip) t order by volume desc"
        set protected enable
    next
    edit "event-Wireless-Accepted-Offwire"
        set description "Event wireless accepted off-wire"
        set log-type event
        set query "select 'accepted' as ap_full_status, devid, vd, ssid, bssid, manuf, channel, radioband, from_dtime(max(last_seen)) as last_seen, detectionmethod, snclosest, 'no' as on_wire from ###(select devid, vd, ssid, bssid, manuf, channel, radioband, detectionmethod, snclosest, onwire, logid, apstatus, max(dtime) as last_seen from $log where $filter and bssid is not null and logid_to_int(logid) in (43521, 43525, 43563, 43564, 43565, 43566, 43569, 43570, 43571) group by devid, vd, ssid, bssid, manuf, channel, radioband, detectionmethod, snclosest, onwire, logid, apstatus order by last_seen desc)### t where apstatus=2 and onwire='no' group by devid, vd, ssid, bssid, manuf, channel, radioband, detectionmethod, snclosest order by last_seen desc"
        set protected enable
    next
    edit "event-Wireless-Accepted-Onwire"
        set description "Event wireless accepted on-wire"
        set log-type event
        set query "select 'accepted' as ap_full_status, devid, vd, ssid, bssid, manuf, channel, radioband, from_dtime(max(last_seen)) as last_seen, detectionmethod, snclosest, 'yes' as on_wire from ###(select devid, vd, ssid, bssid, manuf, channel, radioband, detectionmethod, snclosest, onwire, apstatus, signal, max(dtime) as last_seen from $log where $filter and bssid is not null and logid_to_int(logid) in (43521, 43525, 43563, 43564, 43565, 43566, 43569, 43570, 43571) group by devid, vd, ssid, bssid, manuf, channel, radioband, detectionmethod, snclosest, onwire, apstatus, signal order by last_seen desc)### t where apstatus=2 and onwire='yes' group by devid, vd, ssid, bssid, manuf, channel, radioband, detectionmethod, snclosest order by last_seen desc"
        set protected enable
    next
    edit "event-Wireless-Rogue-Offwire"
        set description "Event wireless rogue off-wire"
        set log-type event
        set query "select 'rogue' as ap_full_status, devid, vd, ssid, bssid, manuf, channel, radioband, from_dtime(max(last_seen)) as last_seen, detectionmethod, snclosest, 'no' as on_wire from ###(select devid, vd, ssid, bssid, manuf, channel, radioband, detectionmethod, snclosest, onwire, logid, apstatus, max(dtime) as last_seen from $log where $filter and bssid is not null and logid_to_int(logid) in (43521, 43525, 43563, 43564, 43565, 43566, 43569, 43570, 43571) group by devid, vd, ssid, bssid, manuf, channel, radioband, detectionmethod, snclosest, onwire, logid, apstatus order by last_seen desc)### t where apstatus=1 and onwire='no' group by devid, vd, ssid, bssid, manuf, channel, radioband, detectionmethod, snclosest order by last_seen desc"
        set protected enable
    next
    edit "event-Wireless-Rogue-Onwire"
        set description "Event wireless rogue on-wire"
        set log-type event
        set query "select 'rogue' as ap_full_status, devid, vd, ssid, bssid, manuf, channel, radioband, from_dtime(max(last_seen)) as last_seen, detectionmethod, snclosest, 'yes' as on_wire from ###(select devid, vd, ssid, bssid, manuf, channel, radioband, detectionmethod, snclosest, onwire, apstatus, signal, max(dtime) as last_seen from $log where $filter and bssid is not null and logid_to_int(logid) in (43521, 43525, 43563, 43564, 43565, 43566, 43569, 43570, 43571) group by devid, vd, ssid, bssid, manuf, channel, radioband, detectionmethod, snclosest, onwire, apstatus, signal order by last_seen desc)### t where apstatus=1 and onwire='yes' group by devid, vd, ssid, bssid, manuf, channel, radioband, detectionmethod, snclosest order by last_seen desc"
        set protected enable
    next
    edit "event-Wireless-Suppressed-Offwire"
        set description "Event wireless suppressed off-wire"
        set log-type event
        set query "select 'suppressed' as ap_full_status, devid, vd, ssid, bssid, manuf, channel, radioband, from_dtime(max(last_seen)) as last_seen, detectionmethod, snclosest, 'no' as on_wire from ###(select devid, vd, ssid, bssid, manuf, channel, radioband, detectionmethod, snclosest, onwire, logid, apstatus, max(dtime) as last_seen from $log where $filter and bssid is not null and logid_to_int(logid) in (43521, 43525, 43563, 43564, 43565, 43566, 43569, 43570, 43571) group by devid, vd, ssid, bssid, manuf, channel, radioband, detectionmethod, snclosest, onwire, logid, apstatus order by last_seen desc)### t where apstatus=3 and onwire='no' group by devid, vd, ssid, bssid, manuf, channel, radioband, detectionmethod, snclosest order by last_seen desc"
        set protected enable
    next
    edit "event-Wireless-Suppressed-Onwire"
        set description "Event wireless suppressed on-wire"
        set log-type event
        set query "select 'suppressed' as ap_full_status, devid, vd, ssid, bssid, manuf, channel, radioband, from_dtime(max(last_seen)) as last_seen, detectionmethod, snclosest, 'yes' as on_wire from ###(select devid, vd, ssid, bssid, manuf, channel, radioband, detectionmethod, snclosest, onwire, apstatus, signal, max(dtime) as last_seen from $log where $filter and bssid is not null and logid_to_int(logid) in (43521, 43525, 43563, 43564, 43565, 43566, 43569, 43570, 43571) group by devid, vd, ssid, bssid, manuf, channel, radioband, detectionmethod, snclosest, onwire, apstatus, signal order by last_seen desc)### t where apstatus=3 and onwire='yes' group by devid, vd, ssid, bssid, manuf, channel, radioband, detectionmethod, snclosest order by last_seen desc"
        set protected enable
    next
    edit "event-Wireless-Unclassified-Offwire"
        set description "Event wireless unclassified off-wire"
        set log-type event
        set query "select 'unclassified' as ap_full_status, devid, vd, ssid, bssid, manuf, channel, radioband, from_dtime(max(last_seen)) as last_seen, detectionmethod, snclosest, 'no' as on_wire from ###(select devid, vd, ssid, bssid, manuf, channel, radioband, detectionmethod, snclosest, onwire, logid, apstatus, max(dtime) as last_seen from $log where $filter and bssid is not null and logid_to_int(logid) in (43521, 43525, 43563, 43564, 43565, 43566, 43569, 43570, 43571) group by devid, vd, ssid, bssid, manuf, channel, radioband, detectionmethod, snclosest, onwire, logid, apstatus order by last_seen desc)### t where apstatus=0 and onwire='no' group by devid, vd, ssid, bssid, manuf, channel, radioband, detectionmethod, snclosest order by last_seen desc"
        set protected enable
    next
    edit "event-Wireless-Unclassified-Onwire"
        set description "Event wireless unclassified on-wire"
        set log-type event
        set query "select 'unclassified' as ap_full_status, devid, vd, ssid, bssid, manuf, channel, radioband, from_dtime(max(last_seen)) as last_seen, detectionmethod, snclosest, 'yes' as on_wire from ###(select devid, vd, ssid, bssid, manuf, channel, radioband, detectionmethod, snclosest, onwire, apstatus, signal, max(dtime) as last_seen from $log where $filter and bssid is not null and logid_to_int(logid) in (43521, 43525, 43563, 43564, 43565, 43566, 43569, 43570, 43571) group by devid, vd, ssid, bssid, manuf, channel, radioband, detectionmethod, snclosest, onwire, apstatus, signal order by last_seen desc)### t where apstatus=0 and onwire='yes' group by devid, vd, ssid, bssid, manuf, channel, radioband, detectionmethod, snclosest order by last_seen desc"
        set protected enable
    next
    edit "default-Top-IPSEC-Vpn-Dial-Up-User-By-Bandwidth"
        set description "Default top IPsec VPN dial up user by bandwidth usage"
        set log-type event
        set query "select coalesce(xauthuser_agg, user_agg, ipstr(`remip`)) as user_src, from_dtime(min(s_time)) as start_time, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from (select devid, vd, string_agg(distinct xauthuser_agg, ' ') as xauthuser_agg, string_agg(distinct user_agg, ' ') as user_agg, remip, tunnelid, min(s_time) as s_time, max(e_time) as e_time, (case when min(s_time)=max(e_time) then max(max_traffic_in)+max(max_traffic_out) else max(max_traffic_in)-min(min_traffic_in)+max(max_traffic_out)-min(min_traffic_out) end) as bandwidth, (case when min(s_time)=max(e_time) then max(max_traffic_in) else max(max_traffic_in)-min(min_traffic_in) end) as traffic_in, (case when min(s_time)=max(e_time) then max(max_traffic_out) else max(max_traffic_out)-min(min_traffic_out) end) as traffic_out from ###(select devid, vd, remip, nullifna(`xauthuser`) as xauthuser_agg, nullifna(`user`) as user_agg, tunnelid, min(coalesce(dtime, 0)) as s_time, max(coalesce(dtime, 0)) as e_time, max(coalesce(duration,0)) as max_duration, min(coalesce(duration,0)) as min_duration, min(coalesce(sentbyte, 0)) as min_traffic_out, min(coalesce(rcvdbyte, 0)) as min_traffic_in, max(coalesce(sentbyte, 0)) as max_traffic_out, max(coalesce(rcvdbyte, 0)) as max_traffic_in, max(coalesce(rcvdbyte, 0)+coalesce(sentbyte, 0)) as max_traffic from $log where $filter and subtype='vpn' and tunneltype like 'ipsec%' and not (tunnelip is null or tunnelip='0.0.0.0') and action in ('tunnel-stats', 'tunnel-down', 'tunnel-up') and tunnelid is not null and tunnelid!=0 group by devid, vd, remip, xauthuser_agg, user_agg, tunnelid order by max_traffic desc)### t group by devid, vd, remip, tunnelid) tt group by user_src having sum(bandwidth)>0 order by bandwidth desc" 
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "default-Top-Dial-Up-User-Of-Vpn-Tunnel-By-Bandwidth"
        set description "Default top dial up user of VPN tunnel by bandwidth usage"
        set log-type traffic
        set query "select user_src, sum(bandwidth) as bandwidth from (select user_src, (case when min(s_time)=max(e_time) then max(max_traffic_in) else max(max_traffic_in)-min(min_traffic_in) end) as traffic_in, (case when min(s_time)=max(e_time) then max(max_traffic_out) else max(max_traffic_out)-min(min_traffic_out) end) as traffic_out, (case when min(s_time)=max(e_time) then max(max_traffic_in)+max(max_traffic_out) else max(max_traffic_in)-min(min_traffic_in)+max(max_traffic_out)-min(min_traffic_out) end) as bandwidth from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, max(coalesce(sentbyte, 0)) as max_traffic_out, max(coalesce(rcvdbyte, 0)) as max_traffic_in, min(coalesce(sentbyte, 0)) as min_traffic_out, min(coalesce(rcvdbyte, 0)) as min_traffic_in, min(coalesce(dtime, 0)) as s_time, max(coalesce(dtime, 0)) as e_time from $log where $filter and  (logflag&1>0)  and vpntype in ('ipsec-dynamic', 'sslvpn') group by user_src)### t group by user_src) tt group by user_src having sum(traffic_out+traffic_in)>0 order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "default-Top-Sources-Of-SSL-VPN-Tunnels-By-Bandwidth"
        set description "Default top sources of SSL VPN tunnels by bandwidth usage"
        set log-type event
        set query "select remip as remote_ip, sum(bandwidth) as bandwidth from (select devid, vd, remip, tunnelid, (case when min(s_time)=max(e_time) then max(max_traffic_in) else max(max_traffic_in)-min(min_traffic_in) end) as traffic_in, (case when min(s_time)=max(e_time) then max(max_traffic_out) else max(max_traffic_out)-min(min_traffic_out) end) as traffic_out, (case when min(s_time)=max(e_time) then max(max_traffic_in)+max(max_traffic_out) else max(max_traffic_in)-min(min_traffic_in)+max(max_traffic_out)-min(min_traffic_out) end) as bandwidth from ###(select $flex_timestamp as timestamp, devid, vd, remip, tunnelid, (case when tunneltype like 'ipsec%' then 'ipsec' else tunneltype end) as t_type, (case when action='tunnel-up' then 1 else 0 end) as tunnelup, max(coalesce(sentbyte, 0)) as max_traffic_out, max(coalesce(rcvdbyte, 0)) as max_traffic_in, min(coalesce(sentbyte, 0)) as min_traffic_out, min(coalesce(rcvdbyte, 0)) as min_traffic_in, min(coalesce(dtime, 0)) as s_time, max(coalesce(dtime, 0)) as e_time, coalesce(nullifna(`xauthuser`), nullifna(`user`), ipstr(`remip`)) as f_user, tunneltype, action, count(*) as total_num  from $log where $filter and subtype='vpn' and (tunneltype like 'ipsec%' or tunneltype like 'ssl%') and action in ('tunnel-up','tunnel-stats', 'tunnel-down', 'ssl-login-fail', 'ipsec-login-fail') group by timestamp, devid, vd, remip, t_type, tunnelid, action, f_user, tunneltype /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where t_type like 'ssl%' and action in ('tunnel-up','tunnel-stats', 'tunnel-down') and tunnelid is not null and tunnelid!=0 group by devid, vd, remip, tunnelid) t group by remote_ip having sum(traffic_in+traffic_out)>0 order by bandwidth desc"
        set protected enable
    next
    edit "vpn-Login-Connection-Count"
        set description "VPN Login Connection Count"
        set log-type event
        set query "select count(distinct tunnelid) as total_num from (select t_type, devid, vd, remip, tunnelid, (case when min(s_time)=max(e_time) then max(max_traffic_in)+max(max_traffic_out) else  max(max_traffic_in)-min(min_traffic_in)+max(max_traffic_out)-min(min_traffic_out) end) as bandwidth, sum(tunnelup) as total_num from ###(select devid, vd, remip, nullifna(`xauthuser`) as xauthuser_agg, nullifna(`user`) as user_agg, (case when tunneltype like 'ipsec%' then 'ipsec' else tunneltype end) as t_type, tunnelid, tunnelip, min(coalesce(dtime, 0)) as s_time, max(coalesce(dtime, 0)) as e_time, max(coalesce(duration,0)) as max_duration, min(coalesce(duration,0)) as min_duration, min(coalesce(sentbyte, 0)) as min_traffic_out, min(coalesce(rcvdbyte, 0)) as min_traffic_in, max(coalesce(sentbyte, 0)) as max_traffic_out, max(coalesce(rcvdbyte, 0)) as max_traffic_in, max(coalesce(rcvdbyte, 0)+coalesce(sentbyte, 0)) as max_traffic, sum((case when action='tunnel-up' then 1 else 0 end)) as tunnelup from $log where $filter and subtype='vpn' and (tunneltype like 'ipsec%' or tunneltype like 'ssl%') and action in ('tunnel-up', 'tunnel-stats', 'tunnel-down') and tunnelid is not null and tunnelid!=0 group by xauthuser_agg, user_agg, devid, vd, remip, t_type, tunnelid, tunnelip order by max_traffic desc)### t group by t_type, devid, vd, remip, tunnelid) t where bandwidth>0"
        set protected enable
    next
    edit "vpn-Login-User-Count"
        set description "VPN Login User Count"
        set log-type event
        set query "select count(distinct f_user) as num_user from (select coalesce(xauthuser_agg, user_agg, ipstr(`remip`)) as f_user from (select string_agg(distinct xauthuser_agg, ' ') as xauthuser_agg, string_agg(distinct user_agg, ' ') as user_agg, t_type, devid, vd, remip, tunnelid, (case when min(s_time)=max(e_time) then max(max_traffic_in)+max(max_traffic_out) else  max(max_traffic_in)-min(min_traffic_in)+max(max_traffic_out)-min(min_traffic_out) end) as bandwidth from ###(select devid, vd, remip, nullifna(`xauthuser`) as xauthuser_agg, nullifna(`user`) as user_agg, (case when tunneltype like 'ipsec%' then 'ipsec' else tunneltype end) as t_type, tunnelid, tunnelip, min(coalesce(dtime, 0)) as s_time, max(coalesce(dtime, 0)) as e_time, max(coalesce(duration,0)) as max_duration, min(coalesce(duration,0)) as min_duration, min(coalesce(sentbyte, 0)) as min_traffic_out, min(coalesce(rcvdbyte, 0)) as min_traffic_in, max(coalesce(sentbyte, 0)) as max_traffic_out, max(coalesce(rcvdbyte, 0)) as max_traffic_in, max(coalesce(rcvdbyte, 0)+coalesce(sentbyte, 0)) as max_traffic, sum((case when action='tunnel-up' then 1 else 0 end)) as tunnelup from $log where $filter and subtype='vpn' and (tunneltype like 'ipsec%' or tunneltype like 'ssl%') and action in ('tunnel-up', 'tunnel-stats', 'tunnel-down') and tunnelid is not null and tunnelid!=0 group by xauthuser_agg, user_agg, devid, vd, remip, t_type, tunnelid, tunnelip order by max_traffic desc)### t group by t_type, devid, vd, remip, tunnelid) t where bandwidth>0 group by f_user) t"
        set protected enable
    next
    edit "vpn-Total-Login-Attempt-Count"
        set description "VPN Login Attempt Count"
        set log-type event 
        set query "select sum(total_num) as total_num from ###(select coalesce(nullifna(`xauthuser`), nullifna(`user`), ipstr(`remip`)) as f_user, tunneltype, action, count(*) as total_num from $log where $filter and subtype='vpn' and (tunneltype like 'ipsec%' or tunneltype like 'ssl%') and action in ('ssl-login-fail', 'ipsec-login-fail', 'tunnel-up', 'tunnel-stats', 'tunnel-down') group by f_user, tunneltype, action order by total_num desc)### t"
        set protected enable
    next
    edit "vpn-Failed-Login-Attempt-Count"
        set description "VPN Failed Login Attempts"
        set log-type event 
        set query "select sum(total_num) as total_num from ###(select coalesce(nullifna(`xauthuser`), nullifna(`user`), ipstr(`remip`)) as f_user, tunneltype, action, count(*) as total_num from $log where $filter and subtype='vpn' and (tunneltype like 'ipsec%' or tunneltype like 'ssl%') and action in ('ssl-login-fail', 'ipsec-login-fail', 'tunnel-up', 'tunnel-stats', 'tunnel-down') group by f_user, tunneltype, action order by total_num desc)### t where action in ('ssl-login-fail', 'ipsec-login-fail')"
        set protected enable
    next
    edit "vpn-Login-Total-Bandwidth-Used"
        set description "VPN Login Total Bandwidth Used"
        set log-type event
        set query "select sum(bandwidth) as total_bandwidth from (select t_type, devid, vd, remip, tunnelid, (case when min(s_time)=max(e_time) then max(max_traffic_in)+max(max_traffic_out) else  max(max_traffic_in)-min(min_traffic_in)+max(max_traffic_out)-min(min_traffic_out) end) as bandwidth from ###(select devid, vd, remip, nullifna(`xauthuser`) as xauthuser_agg, nullifna(`user`) as user_agg, (case when tunneltype like 'ipsec%' then 'ipsec' else tunneltype end) as t_type, tunnelid, tunnelip, min(coalesce(dtime, 0)) as s_time, max(coalesce(dtime, 0)) as e_time, max(coalesce(duration,0)) as max_duration, min(coalesce(duration,0)) as min_duration, min(coalesce(sentbyte, 0)) as min_traffic_out, min(coalesce(rcvdbyte, 0)) as min_traffic_in, max(coalesce(sentbyte, 0)) as max_traffic_out, max(coalesce(rcvdbyte, 0)) as max_traffic_in, max(coalesce(rcvdbyte, 0)+coalesce(sentbyte, 0)) as max_traffic, sum((case when action='tunnel-up' then 1 else 0 end)) as tunnelup from $log where $filter and subtype='vpn' and (tunneltype like 'ipsec%' or tunneltype like 'ssl%') and action in ('tunnel-up', 'tunnel-stats', 'tunnel-down') and tunnelid is not null and tunnelid!=0 group by xauthuser_agg, user_agg, devid, vd, remip, t_type, tunnelid, tunnelip order by max_traffic desc)### t group by t_type, devid, vd, remip, tunnelid) tt where bandwidth>0" 
        set protected enable
    next
    edit "vpn-Login-User-Count-by-Type"
        set description "VPN Login User Count by VPN Type"
        set log-type event
        set query "select type_agg, count(distinct f_user) as num_user from (select coalesce(xauthuser_agg, user_agg, ipstr(`remip`)) as f_user, string_agg(distinct t_type, ' ') as type_agg from (select string_agg(distinct xauthuser_agg, ' ') as xauthuser_agg, string_agg(distinct user_agg, ' ') as user_agg, t_type, devid, vd, remip, tunnelid, (case when min(s_time)=max(e_time) then max(max_traffic_in)+max(max_traffic_out) else  max(max_traffic_in)-min(min_traffic_in)+max(max_traffic_out)-min(min_traffic_out) end) as bandwidth from ###(select devid, vd, remip, nullifna(`xauthuser`) as xauthuser_agg, nullifna(`user`) as user_agg, (case when tunneltype like 'ipsec%' then 'ipsec' else tunneltype end) as t_type, tunnelid, tunnelip, min(coalesce(dtime, 0)) as s_time, max(coalesce(dtime, 0)) as e_time, max(coalesce(duration,0)) as max_duration, min(coalesce(duration,0)) as min_duration, min(coalesce(sentbyte, 0)) as min_traffic_out, min(coalesce(rcvdbyte, 0)) as min_traffic_in, max(coalesce(sentbyte, 0)) as max_traffic_out, max(coalesce(rcvdbyte, 0)) as max_traffic_in, max(coalesce(rcvdbyte, 0)+coalesce(sentbyte, 0)) as max_traffic, sum((case when action='tunnel-up' then 1 else 0 end)) as tunnelup from $log where $filter and subtype='vpn' and (tunneltype like 'ipsec%' or tunneltype like 'ssl%') and action in ('tunnel-up', 'tunnel-stats', 'tunnel-down') and tunnelid is not null and tunnelid!=0 group by xauthuser_agg, user_agg, devid, vd, remip, t_type, tunnelid, tunnelip order by max_traffic desc)### t group by t_type, devid, vd, remip, tunnelid) tt where bandwidth>0 group by f_user) ttt group by type_agg order by num_user desc"
        set protected enable
    next
    edit "vpn-Login-Total-Bandwidth-by-Type"
        set description "VPN Login Total Bandwidth by VPN Type"
        set log-type event
        set query "select t_type, sum(bandwidth) as total_bandwidth from (select t_type, devid, vd, remip, tunnelid, (case when min(s_time)=max(e_time) then max(max_traffic_in)+max(max_traffic_out) else  max(max_traffic_in)-min(min_traffic_in)+max(max_traffic_out)-min(min_traffic_out) end) as bandwidth from ###(select devid, vd, remip, nullifna(`xauthuser`) as xauthuser_agg, nullifna(`user`) as user_agg, (case when tunneltype like 'ipsec%' then 'ipsec' else tunneltype end) as t_type, tunnelid, tunnelip, min(coalesce(dtime, 0)) as s_time, max(coalesce(dtime, 0)) as e_time, max(coalesce(duration,0)) as max_duration, min(coalesce(duration,0)) as min_duration, min(coalesce(sentbyte, 0)) as min_traffic_out, min(coalesce(rcvdbyte, 0)) as min_traffic_in, max(coalesce(sentbyte, 0)) as max_traffic_out, max(coalesce(rcvdbyte, 0)) as max_traffic_in, max(coalesce(rcvdbyte, 0)+coalesce(sentbyte, 0)) as max_traffic, sum((case when action='tunnel-up' then 1 else 0 end)) as tunnelup from $log where $filter and subtype='vpn' and (tunneltype like 'ipsec%' or tunneltype like 'ssl%') and action in ('tunnel-up', 'tunnel-stats', 'tunnel-down') and tunnelid is not null and tunnelid!=0 group by xauthuser_agg, user_agg, devid, vd, remip, t_type, tunnelid, tunnelip order by max_traffic desc)### t group by t_type, devid, vd, remip, tunnelid) tt where bandwidth>0 group by t_type order by total_bandwidth desc" 
        set protected enable
    next
    edit "vpn-Login-Attempt-by-Type"
        set description "VPN Login Attempts by VPN Type"
        set log-type event 
        set query "select (case when action like '%fail' then 'Failed' else 'Success' end) as type, sum(total_num) as total_num from ###(select coalesce(nullifna(`xauthuser`), nullifna(`user`), ipstr(`remip`)) as f_user, tunneltype, action, count(*) as total_num from $log where $filter and subtype='vpn' and (tunneltype like 'ipsec%' or tunneltype like 'ssl%') and action in ('ssl-login-fail', 'ipsec-login-fail', 'tunnel-up', 'tunnel-stats', 'tunnel-down') group by f_user, tunneltype, action order by total_num desc)### t group by type order by total_num desc"
        set protected enable
    next
    edit "vpn-Failed-Login-Timeline"
        set description "VPN Failed Login Timeline"
        set log-type event 
        set query "select $flex_timescale(timestamp) as hodex, sum(total_num) as total_num from ###(select $flex_timestamp as timestamp, devid, vd, remip, tunnelid, (case when tunneltype like 'ipsec%' then 'ipsec' else tunneltype end) as t_type, (case when action='tunnel-up' then 1 else 0 end) as tunnelup, max(coalesce(sentbyte, 0)) as max_traffic_out, max(coalesce(rcvdbyte, 0)) as max_traffic_in, min(coalesce(sentbyte, 0)) as min_traffic_out, min(coalesce(rcvdbyte, 0)) as min_traffic_in, min(coalesce(dtime, 0)) as s_time, max(coalesce(dtime, 0)) as e_time, coalesce(nullifna(`xauthuser`), nullifna(`user`), ipstr(`remip`)) as f_user, tunneltype, action, count(*) as total_num  from $log where $filter and subtype='vpn' and (tunneltype like 'ipsec%' or tunneltype like 'ssl%') and action in ('tunnel-up','tunnel-stats', 'tunnel-down', 'ssl-login-fail', 'ipsec-login-fail') group by timestamp, devid, vd, remip, t_type, tunnelid, action, f_user, tunneltype /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where action in ('ssl-login-fail', 'ipsec-login-fail') and f_user is not null group by hodex order by total_num desc"
        set protected enable
    next
    edit "vpn-Top-SSL-VPN-Tunnel-Users-By-Traffic-Directions"
        set description "Top SSL VPN Tunnel Users by Traffic Directions"
        set log-type event
        set query "select user_src, unnest(traffic_direction) as direction, unnest(traffic) as traffic from (select user_src, sum(bandwidth) as bandwidth, array['Received', 'Sent'] as traffic_direction, array[sum(traffic_in), sum(traffic_out)] as traffic from (select devid, vd, remip, user_src, tunnelid, min(s_time) as s_time, max(e_time) as e_time, (case when min(s_time)=max(e_time) then max(max_traffic_in)+max(max_traffic_out) else max(max_traffic_in)-min(min_traffic_in)+max(max_traffic_out)-min(min_traffic_out) end) as bandwidth, (case when min(s_time)=max(e_time) then max(max_traffic_in) else max(max_traffic_in)-min(min_traffic_in) end) as traffic_in, (case when min(s_time)=max(e_time) then max(max_traffic_out) else max(max_traffic_out)-min(min_traffic_out) end) as traffic_out from ###(select devid, vd, remip, coalesce(nullifna(`user`), ipstr(`remip`)) as user_src, tunnelid, tunneltype, max(coalesce(duration,0)) as max_duration, min(coalesce(duration,0)) as min_duration, min(coalesce(dtime, 0)) as s_time, max(coalesce(dtime, 0)) as e_time, min(coalesce(sentbyte, 0)) as min_traffic_out, min(coalesce(rcvdbyte, 0)) as min_traffic_in, max(coalesce(sentbyte, 0)) as max_traffic_out, max(coalesce(rcvdbyte, 0)) as max_traffic_in, max(coalesce(rcvdbyte, 0)+coalesce(sentbyte, 0)) as max_traffic from $log where $filter and subtype='vpn' and tunneltype like 'ssl%' and action in ('tunnel-stats', 'tunnel-down', 'tunnel-up') and coalesce(nullifna(`user`), ipstr(`remip`)) is not null and tunnelid is not null group by devid, vd, user_src, remip, tunnelid, tunneltype order by max_traffic desc)### t where tunneltype='ssl-tunnel' group by devid, vd, user_src, remip, tunnelid) tt where bandwidth>0 group by user_src) ttt order by bandwidth desc"
        set protected enable
    next
    edit "vpn-Top-SSL-VPN-Tunnel-Duration-By-Users"
        set description "Top SSL VPN Tunnel Duration by Users"
        set log-type event
        set query "select user_src, sum(duration) as duration, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from (select devid, vd, remip, user_src, tunnelid, (case when min(s_time)=max(e_time) then max(max_duration) else max(max_duration)-min(min_duration) end) as duration, (case when min(s_time)=max(e_time) then max(max_traffic_in) else max(max_traffic_in)-min(min_traffic_in) end) as traffic_in, (case when min(s_time)=max(e_time) then max(max_traffic_out) else max(max_traffic_out)-min(min_traffic_out) end) as traffic_out, (case when min(s_time)=max(e_time) then max(max_traffic_in)+max(max_traffic_out) else max(max_traffic_in)-min(min_traffic_in)+max(max_traffic_out)-min(min_traffic_out) end) as bandwidth from ###(select devid, vd, remip, coalesce(nullifna(`user`), ipstr(`remip`)) as user_src, tunnelid, tunneltype, max(coalesce(duration,0)) as max_duration, min(coalesce(duration,0)) as min_duration, min(coalesce(dtime, 0)) as s_time, max(coalesce(dtime, 0)) as e_time, min(coalesce(sentbyte, 0)) as min_traffic_out, min(coalesce(rcvdbyte, 0)) as min_traffic_in, max(coalesce(sentbyte, 0)) as max_traffic_out, max(coalesce(rcvdbyte, 0)) as max_traffic_in, max(coalesce(rcvdbyte, 0)+coalesce(sentbyte, 0)) as max_traffic from $log where $filter and subtype='vpn' and tunneltype like 'ssl%' and action in ('tunnel-stats', 'tunnel-down', 'tunnel-up') and coalesce(nullifna(`user`), ipstr(`remip`)) is not null and tunnelid is not null group by devid, vd, user_src, remip, tunnelid, tunneltype order by max_traffic desc)### t where tunneltype='ssl-tunnel' group by devid, vd, remip, user_src, tunnelid) tt where bandwidth>0 group by user_src order by duration desc" 
        set protected enable
    next
    edit "vpn-Top-SSL-VPN-Web-Mode-Users-By-Traffic-Directions"
        set description "Top SSL VPN Web Mode Users by Traffic Directions"
        set log-type event 
        set query "select user_src, unnest(traffic_direction) as direction, unnest(traffic) as traffic from (select user_src, sum(bandwidth) as bandwidth, array['Received', 'Sent'] as traffic_direction, array[sum(traffic_in), sum(traffic_out)] as traffic from (select devid, vd, user_src, remip, tunnelid, min(s_time) as s_time, max(e_time) as e_time, (case when min(s_time)=max(e_time) then max(max_traffic_in)+max(max_traffic_out) else max(max_traffic_in)-min(min_traffic_in)+max(max_traffic_out)-min(min_traffic_out) end) as bandwidth, (case when min(s_time)=max(e_time) then max(max_traffic_in) else max(max_traffic_in)-min(min_traffic_in) end) as traffic_in, (case when min(s_time)=max(e_time) then max(max_traffic_out) else max(max_traffic_out)-min(min_traffic_out) end) as traffic_out from ###(select devid, vd, remip, coalesce(nullifna(`user`), ipstr(`remip`)) as user_src, tunnelid, tunneltype, max(coalesce(duration,0)) as max_duration, min(coalesce(duration,0)) as min_duration, min(coalesce(dtime, 0)) as s_time, max(coalesce(dtime, 0)) as e_time, min(coalesce(sentbyte, 0)) as min_traffic_out, min(coalesce(rcvdbyte, 0)) as min_traffic_in, max(coalesce(sentbyte, 0)) as max_traffic_out, max(coalesce(rcvdbyte, 0)) as max_traffic_in, max(coalesce(rcvdbyte, 0)+coalesce(sentbyte, 0)) as max_traffic from $log where $filter and subtype='vpn' and tunneltype like 'ssl%' and action in ('tunnel-stats', 'tunnel-down', 'tunnel-up') and coalesce(nullifna(`user`), ipstr(`remip`)) is not null and tunnelid is not null group by devid, vd, user_src, remip, tunnelid, tunneltype order by max_traffic desc)### t where tunneltype='ssl-web' group by devid, vd, user_src, remip, tunnelid) tt where bandwidth>0 group by user_src) ttt order by bandwidth desc" 
        set protected enable
    next
    edit "vpn-Top-Static-IPsec-Tunnels-By-Traffic-Directions"
        set description "Top Static IPsec Tunnels by Traffic Directions"
        set log-type event
        set query "select vpn_name, unnest(traffic_direction) as direction, unnest(traffic) as traffic from (select vpn_name, sum(bandwidth) as bandwidth, array['Received', 'Sent'] as traffic_direction, array[sum(traffic_in), sum(traffic_out)] as traffic from (select devid, vd, remip, tunnelid, vpn_name, (case when min(s_time)=max(e_time) then max(max_traffic_in) else max(max_traffic_in)-min(min_traffic_in) end) as traffic_in, (case when min(s_time)=max(e_time) then max(max_traffic_out) else max(max_traffic_out)-min(min_traffic_out) end) as traffic_out, (case when min(s_time)=max(e_time) then max(max_traffic_in)+max(max_traffic_out) else max(max_traffic_in)-min(min_traffic_in)+max(max_traffic_out)-min(min_traffic_out) end) as bandwidth from ###(select devid, vd, remip, vpn_trim(vpntunnel) as vpn_name, tunnelid, tunnelip, max(coalesce(sentbyte, 0)) as max_traffic_out, max(coalesce(rcvdbyte, 0)) as max_traffic_in, max(coalesce(rcvdbyte, 0)+coalesce(sentbyte, 0)) as max_traffic, min(coalesce(sentbyte, 0)) as min_traffic_out, min(coalesce(rcvdbyte, 0)) as min_traffic_in, min(coalesce(dtime, 0)) as s_time, max(coalesce(dtime, 0)) as e_time from $log where $filter and subtype='vpn' and tunneltype like 'ipsec%' and nullifna(vpntunnel) is not null and action in ('tunnel-stats', 'tunnel-down', 'tunnel-up') and tunnelid is not null and tunnelid!=0 group by devid, vd, remip, vpn_name, tunnelid, tunnelip order by max_traffic desc)### t where (tunnelip is null or tunnelip='0.0.0.0') group by devid, vd, remip, vpn_name, tunnelid) tt group by vpn_name having sum(traffic_in+traffic_out)>0) ttt order by bandwidth desc" 
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "vpn-Top-Dial-Up-IPsec-Tunnels-By-Traffic-Directions"
        set description "Top Dial Up IPsec Tunnels by Traffic Directions"
        set log-type event
        set query "select vpn_name, unnest(traffic_direction) as direction, unnest(traffic) as traffic from (select vpn_name, sum(bandwidth) as bandwidth, array['Received', 'Sent'] as traffic_direction, array[sum(traffic_in), sum(traffic_out)] as traffic from (select devid, vd, tunnelid, remip, vpn_name, (case when min(s_time)=max(e_time) then max(max_traffic_in) else max(max_traffic_in)-min(min_traffic_in) end) as traffic_in, (case when min(s_time)=max(e_time) then max(max_traffic_out) else max(max_traffic_out)-min(min_traffic_out) end) as traffic_out, (case when min(s_time)=max(e_time) then max(max_traffic_in)+max(max_traffic_out) else max(max_traffic_in)-min(min_traffic_in)+max(max_traffic_out)-min(min_traffic_out) end) as bandwidth from ###(select devid, vd, remip, vpn_trim(vpntunnel) as vpn_name, tunnelid, tunnelip, max(coalesce(sentbyte, 0)) as max_traffic_out, max(coalesce(rcvdbyte, 0)) as max_traffic_in, max(coalesce(rcvdbyte, 0)+coalesce(sentbyte, 0)) as max_traffic, min(coalesce(sentbyte, 0)) as min_traffic_out, min(coalesce(rcvdbyte, 0)) as min_traffic_in, min(coalesce(dtime, 0)) as s_time, max(coalesce(dtime, 0)) as e_time from $log where $filter and subtype='vpn' and tunneltype like 'ipsec%' and nullifna(vpntunnel) is not null and action in ('tunnel-stats', 'tunnel-down', 'tunnel-up') and tunnelid is not null and tunnelid!=0 group by devid, vd, remip, vpn_name, tunnelid, tunnelip order by max_traffic desc)### t where not (tunnelip is null or tunnelip='0.0.0.0') group by devid, vd, remip, vpn_name, tunnelid) tt group by vpn_name having sum(traffic_out+traffic_in)>0) ttt order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "webfilter-Web-Activity-Summary-By-Requests"
        set description "Webfilter web activity summary by requests"
        set log-type webfilter
        set query "select $flex_timescale(timestamp) as hodex, sum(allowed_request) as allowed_request, sum(blocked_request) as blocked_request from ###(select $flex_timestamp as timestamp, sum(case when action!='blocked' then 1 else 0 end) as allowed_request, sum(case when action='blocked' then 1 else 0 end) as blocked_request from $log where $filter group by timestamp /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t group by hodex order by hodex"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "traffic-Browsing-Time-Summary"
        set description "Traffic browsing time summary"
        set log-type traffic
        set query "select $flex_timescale(timestamp) as hodex, cast(ebtr_value(ebtr_agg_flat(browsetime), null, $timespan)/60.0 as decimal(18, 2)) as browsetime from ###(select $flex_timestamp as timestamp, ebtr_agg_flat($browse_time) as browsetime from $log where $filter and (logflag&1>0) and $browse_time is not null group by timestamp /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t group by hodex order by hodex"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "webfilter-Top-Web-Users-By-Blocked-Requests"
        set description "Webfilter top web users by blocked requests"
        set log-type webfilter
        set query "select coalesce(f_user, euname, ipstr(`srcip`)) as user_src, coalesce(epname, ipstr(`srcip`)) as ep_src, sum(requests) as requests from (select dvid, f_user, srcip, ep_id, eu_id, sum(requests) as requests from ###(select dvid, coalesce(nullifna(`user`), nullifna(`unauthuser`)) as f_user, srcip, (case when epid<1024 then null else epid end) as ep_id, (case when euid<1024 then null else euid end) as eu_id, action, count(*) as requests from $log where $filter and coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) is not null group by dvid, f_user, srcip, ep_id, eu_id, action /*SkipSTART*/order by requests desc/*SkipEND*/)### t where action='blocked' group by dvid, f_user, srcip, ep_id, eu_id order by requests desc) t1 left join (select epid, euid, srcmac as epmac, dvid from $ADOM_EPEU_DEVMAP dm inner join devtable dt ON dm.devid=dt.devid and dm.vd=dt.vd) t2 on t1.ep_id=t2.epid and t1.eu_id=t2.euid and t1.dvid=t2.dvid left join $ADOM_ENDPOINT t3 on t1.ep_id=t3.epid and t2.epmac=t3.mac left join $ADOM_ENDUSER t4 on t1.eu_id=t4.euid group by user_src, ep_src order by requests desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "webfilter-Top-Web-Users-By-Allowed-Requests"
        set description "Webfilter top web users by allowed requests"
        set log-type webfilter
        set query "select coalesce(f_user, euname, ipstr(`srcip`)) as user_src, coalesce(epname, ipstr(`srcip`)) as ep_src, sum(requests) as requests from (select dvid, f_user, srcip, ep_id, eu_id, sum(requests) as requests from ###(select dvid, coalesce(nullifna(`user`), nullifna(`unauthuser`)) as f_user, srcip, (case when epid<1024 then null else epid end) as ep_id, (case when euid<1024 then null else euid end) as eu_id, action, count(*) as requests from $log where $filter and coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) is not null group by dvid, f_user, srcip, ep_id, eu_id, action /*SkipSTART*/order by requests desc/*SkipEND*/)### t where action!='blocked' group by dvid, f_user, srcip, ep_id, eu_id order by requests desc) t1 left join (select epid, euid, srcmac as epmac, dvid from $ADOM_EPEU_DEVMAP dm inner join devtable dt ON dm.devid=dt.devid and dm.vd=dt.vd) t2 on t1.ep_id=t2.epid and t1.eu_id=t2.euid and t1.dvid=t2.dvid left join $ADOM_ENDPOINT t3 on t1.ep_id=t3.epid and t2.epmac=t3.mac left join $ADOM_ENDUSER t4 on t1.eu_id=t4.euid group by user_src, ep_src order by requests desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "webfilter-Top-Web-Users-By-Bandwidth"
        set description "Webfilter top web users by bandwidth usage"
        set log-type webfilter
        set query "select coalesce(f_user, euname, ipstr(`srcip`)) as user_src, coalesce(epname, ipstr(`srcip`)) as ep_src, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from (select dvid, f_user, srcip, ep_id, eu_id, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from ###(select dvid, coalesce(nullifna(`user`), nullifna(`unauthuser`)) as f_user, srcip, (case when epid<1024 then null else epid end) as ep_id, (case when euid<1024 then null else euid end) as eu_id, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out from $log-traffic where $filter and (logflag&1>0) and (countweb>0 or ((logver is null or logver<502000000) and (hostname is not null or utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter')))) group by dvid, f_user, srcip, ep_id, eu_id having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t group by dvid, f_user, srcip, ep_id, eu_id order by bandwidth desc) t1 left join (select epid, euid, srcmac as epmac, dvid from $ADOM_EPEU_DEVMAP dm inner join devtable dt ON dm.devid=dt.devid and dm.vd=dt.vd) t2 on t1.ep_id=t2.epid and t1.eu_id=t2.euid and t1.dvid=t2.dvid left join $ADOM_ENDPOINT t3 on t1.ep_id=t3.epid and t2.epmac=t3.mac left join $ADOM_ENDUSER t4 on t1.eu_id=t4.euid group by user_src, ep_src order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "webfilter-Top-Blocked-Web-Sites-By-Requests"
        set description "Webfilter top blocked web sites by requests"
        set log-type webfilter
        set query "select domain, catdesc, sum(requests) as requests from ###(select hostname as domain, catdesc, action, count(*) as requests from $log where $filter and hostname is not null and catdesc is not null group by domain, catdesc, action /*SkipSTART*/order by requests desc/*SkipEND*/)### t where action='blocked' group by domain, catdesc order by requests desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "webfilter-Top-Allowed-Web-Sites-By-Requests"
        set description "Webfilter top allowed web sites by requests"
        set log-type webfilter
        set query "select domain, string_agg(distinct catdesc, ', ') as agg_catdesc, sum(requests) as requests from ###(select hostname as domain, catdesc, action, count(*) as requests from $log where $filter and hostname is not null and catdesc is not null group by domain, catdesc, action /*SkipSTART*/order by requests desc/*SkipEND*/)### t where action!='blocked' group by domain order by requests desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "webfilter-Top-Allowed-Web-Sites-by-Bandwidth"
        set description "Webfilter top allowed web sites by bandwidth usage"
        set log-type webfilter
        set query "select domain, string_agg(distinct catdesc, ', ') as agg_catdesc, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from ###(select coalesce(nullifna(hostname), ipstr(`dstip`)) as domain, catdesc, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out from $log-traffic where $filter and (logflag&1>0) and utmaction!='blocked' and (countweb>0 or ((logver is null or logver<502000000) and (hostname is not null or utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter')))) group by domain, catdesc having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t group by domain, catdesc order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "webfilter-Top-Video-Streaming-Websites-By-Bandwidth"
        set description "Webfilter top video streaming websites by bandwidth usage"
        set log-type webfilter
        set query "select domain, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from ###(select coalesce(nullifna(root_domain(hostname)), 'other') as domain, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out from $log-traffic where $filter and (logflag&1>0) and (countweb>0 or ((logver is null or logver<502000000) and (hostname is not null or utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter')))) and catdesc in ('Streaming Media and Download') group by domain having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t group by domain order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "webfilter-Top-Blocked-Web-Categories"
        set description "Webfilter top blocked web categories"
        set log-type webfilter
        set query "select catdesc, sum(requests) as requests from ###(select catdesc, action, count(*) as requests from $log-webfilter where $filter and catdesc is not null group by catdesc, action /*SkipSTART*/order by requests desc/*SkipEND*/)### t where action='blocked' group by catdesc order by requests desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "webfilter-Top-Allowed-Web-Categories"
        set description "Webfilter top allowed web categories"
        set log-type webfilter
        set query "select catdesc, sum(requests) as requests from ###(select catdesc, action, count(*) as requests from $log-webfilter where $filter and catdesc is not null group by catdesc, action /*SkipSTART*/order by requests desc/*SkipEND*/)### t where action!='blocked' group by catdesc order by requests desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "traffic-Top-Web-Users-By-Browsing-Time"
        set description "Traffic top web users by browsing time"
        set log-type traffic
        set query "select user_src, ebtr_value(ebtr_agg_flat(browsetime), null, $timespan) as browsetime, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from ###(select user_src, ebtr_agg_flat(browsetime) as browsetime, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from (select coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, ebtr_agg_flat($browse_time) as browsetime, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out from $log where $filter and $browse_time is not null group by user_src) t group by user_src /*SkipSTART*/order by ebtr_value(ebtr_agg_flat(browsetime), null, null) desc/*SkipEND*/)### t group by user_src order by browsetime desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "traffic-Top-Domains-By-Browsing-Time"
        set description "Traffic top domains by browsing time"
        set log-type traffic
        set query "select hostname, ebtr_value(ebtr_agg_flat(browsetime), null, $timespan) as browsetime, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from ###(select hostname, ebtr_agg_flat(browsetime) as browsetime, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from (select hostname, ebtr_agg_flat($browse_time) as browsetime, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out from $log where $filter and (logflag&1>0) and hostname is not null and $browse_time is not null group by hostname) t group by hostname /*SkipSTART*/order by ebtr_value(ebtr_agg_flat(browsetime), null, null) desc/*SkipEND*/)### t group by hostname order by browsetime desc" 
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "traffic-Top-Sites-By-Browsing-Time"
        set description "Traffic top sites by browsing time"
        set log-type traffic
        set query "select hostname, string_agg(distinct catdesc, ', ') as agg_catdesc, ebtr_value(ebtr_agg_flat(browsetime), null, $timespan) as browsetime, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from ###(select hostname, catdesc, ebtr_agg_flat(browsetime) as browsetime, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from (select hostname, catdesc, ebtr_agg_flat($browse_time) as browsetime, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out from $log where $filter and (logflag&1>0) and hostname is not null and $browse_time is not null group by hostname, catdesc) t group by hostname, catdesc /*SkipSTART*/order by ebtr_value(ebtr_agg_flat(browsetime), null, null) desc/*SkipEND*/)### t group by hostname order by browsetime desc" 
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next

    edit "traffic-Top-Category-By-Browsing-Time"
        set description "Traffic top category by browsing time"
        set log-type traffic
        set query "select catdesc, ebtr_value(ebtr_agg_flat(browsetime), null, $timespan) as browsetime, sum(bandwidth) as bandwidth from ###(select catdesc, ebtr_agg_flat(browsetime) as browsetime, sum(bandwidth) as bandwidth from (select catdesc, ebtr_agg_flat($browse_time) as browsetime, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter and (logflag&1>0) and catdesc is not null and $browse_time is not null group by catdesc) t group by catdesc /*SkipSTART*/order by ebtr_value(ebtr_agg_flat(browsetime), null, null) desc/*SkipEND*/)### t group by catdesc order by browsetime desc" 
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "webfilter-Categories-By-Bandwidth"
        set description "Webfilter categories by bandwidth usage"
        set log-type webfilter 
        set query "select catdesc, sum(bandwidth) as bandwidth from ###(select catdesc, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log-traffic where $filter and (logflag&1>0) and (countweb>0 or ((logver is null or logver<502000000) and (hostname is not null or utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter')))) and catdesc is not null group by catdesc /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t group by catdesc order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
    set protected enable
    next

    edit "traffic-Top-Destination-Countries-By-Browsing-Time"
        set description "Traffic top destination countries by browsing time"
        set log-type traffic
        set query "select dstcountry, ebtr_value(ebtr_agg_flat(browsetime), null, $timespan) as browsetime, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from ###(select dstcountry, ebtr_agg_flat(browsetime) as browsetime, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from (select dstcountry, ebtr_agg_flat($browse_time) as browsetime, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out from $log where $filter and (logflag&1>0) and $browse_time is not null group by dstcountry) t group by dstcountry /*SkipSTART*/order by ebtr_value(ebtr_agg_flat(browsetime), null, null) desc/*SkipEND*/)### t group by dstcountry order by browsetime desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "webfilter-Top-Search-Phrases"
        set description "Webfilter top search phrases"
        set log-type webfilter
        set query "select keyword, count(*) as requests from $log where $filter and keyword is not null group by keyword order by requests desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next

    edit "Estimated-Browsing-Time"
        set description "Estimated browsing time"
        set log-type traffic
        set query "select coalesce(f_user, euname, ipstr(`srcip`)) as user_src, coalesce(epname, ipstr(`srcip`)) as ep_src, ebtr_value(ebtr_agg_flat(browsetime), null, $timespan) as browsetime from (select dvid, f_user, srcip, ep_id, eu_id, ebtr_agg_flat(browsetime) as browsetime from ###(select dvid, f_user, srcip, ep_id, eu_id, ebtr_agg_flat(browsetime) as browsetime from (select dvid, coalesce(nullifna(`user`), nullifna(`unauthuser`)) as f_user, srcip, (case when epid<1024 then null else epid end) as ep_id, (case when euid<1024 then null else euid end) as eu_id, ebtr_agg_flat($browse_time) as browsetime from $log where $filter and (logflag&1>0) and $browse_time is not null group by dvid, f_user, srcip, ep_id, eu_id) t group by dvid, f_user, srcip, ep_id, eu_id order by ebtr_value(ebtr_agg_flat(browsetime), null, null) desc)### t group by dvid, f_user, srcip, ep_id, eu_id order by ebtr_value(ebtr_agg_flat(browsetime), null, null) desc) t1 left join (select epid, euid, srcmac as epmac, dvid from $ADOM_EPEU_DEVMAP dm inner join devtable dt ON dm.devid=dt.devid and dm.vd=dt.vd) t2 on t1.ep_id=t2.epid and t1.eu_id=t2.euid and t1.dvid=t2.dvid left join $ADOM_ENDPOINT t3 on t1.ep_id=t3.epid and t2.epmac=t3.mac left join $ADOM_ENDUSER t4 on t1.eu_id=t4.euid group by user_src, ep_src order by browsetime desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "wifi-Top-AP-By-Bandwidth"
        set description "Top access point by bandwidth usage"
        set log-type traffic
        set query "select ap_srcintf, sum(bandwidth) as bandwidth from (select coalesce(ap, srcintf) as ap_srcintf, sum(bandwidth) as bandwidth from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, ap, srcintf, srcssid, srcssid as ssid, srcmac, srcmac as stamac, coalesce(nullifna(`srcname`), `srcmac`) as hostname_mac, max(srcswversion) as srcswversion, max(osname) as osname, max(osversion) as osversion, max(devtype) as devtype, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, count(*) as subtotal from $log-traffic where $filter and (logflag&1>0) and (srcssid is not null or dstssid is not null) group by user_src, ap, srcintf, srcssid, srcmac, hostname_mac /*SkipSTART*/order by bandwidth desc, subtotal desc/*SkipEND*/)### t group by ap_srcintf having sum(bandwidth)>0 union all select ap as ap_srcintf, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, stamac, stamac as srcmac, ap, ssid, ssid as srcssid, user_src, sum(coalesce(sentdelta, 0)) as sentdelta, sum(coalesce(rcvddelta, 0)) as rcvddelta, sum(coalesce(sentdelta, 0)+coalesce(rcvddelta, 0)) as bandwidth from (select itime, stamac, ap, ssid, coalesce(`user`, ipstr(`srcip`)) as user_src, sentbyte-lag(coalesce(sentbyte, 0)) over (partition by stamac order by itime) as sentdelta, rcvdbyte-lag(coalesce(rcvdbyte, 0)) over (partition by stamac order by itime) as rcvddelta from $log-event where $filter and subtype='wireless' and stamac is not null and ssid is not null and action in ('sta-wl-bridge-traffic-stats', 'reassoc-req', 'assoc-req')) as t group by timestamp, stamac, ap, ssid, user_src /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t group by ap having sum(bandwidth)>0) t group by ap_srcintf order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "wifi-Top-AP-By-Client"
        set description "Top access point by client"
        set log-type traffic
        set query "select ap_srcintf as srcintf, count(distinct srcmac) as totalnum from (select coalesce(ap, srcintf) as ap_srcintf, srcmac from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, ap, srcintf, srcssid, srcssid as ssid, srcmac, srcmac as stamac, coalesce(nullifna(`srcname`), `srcmac`) as hostname_mac, max(srcswversion) as srcswversion, max(osname) as osname, max(osversion) as osversion, max(devtype) as devtype, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, count(*) as subtotal from $log-traffic where $filter and (logflag&1>0) and (srcssid is not null or dstssid is not null) group by user_src, ap, srcintf, srcssid, srcmac, hostname_mac /*SkipSTART*/order by bandwidth desc, subtotal desc/*SkipEND*/)### t where srcmac is not null group by ap_srcintf, srcmac union all (select ap as ap_srcintf, stamac as srcmac from ###(select $flex_timestamp as timestamp, stamac, stamac as srcmac, ap, ssid, ssid as srcssid, user_src, sum(coalesce(sentdelta, 0)) as sentdelta, sum(coalesce(rcvddelta, 0)) as rcvddelta, sum(coalesce(sentdelta, 0)+coalesce(rcvddelta, 0)) as bandwidth from (select itime, stamac, ap, ssid, coalesce(`user`, ipstr(`srcip`)) as user_src, sentbyte-lag(coalesce(sentbyte, 0)) over (partition by stamac order by itime) as sentdelta, rcvdbyte-lag(coalesce(rcvdbyte, 0)) over (partition by stamac order by itime) as rcvddelta from $log-event where $filter and subtype='wireless' and stamac is not null and ssid is not null and action in ('sta-wl-bridge-traffic-stats', 'reassoc-req', 'assoc-req')) as t group by timestamp, stamac, ap, ssid, user_src /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t where stamac is not null group by ap, stamac)) t group by srcintf order by totalnum desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "wifi-Top-SSID-By-Bandwidth"
        set description "Top SSIDs by bandwidth usage"
        set log-type traffic
        set query "select srcssid, sum(bandwidth) as bandwidth from (select srcssid, sum(bandwidth) as bandwidth from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, ap, srcintf, srcssid, srcssid as ssid, srcmac, srcmac as stamac, coalesce(nullifna(`srcname`), `srcmac`) as hostname_mac, max(srcswversion) as srcswversion, max(osname) as osname, max(osversion) as osversion, max(devtype) as devtype, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, count(*) as subtotal from $log-traffic where $filter and (logflag&1>0) and (srcssid is not null or dstssid is not null) group by user_src, ap, srcintf, srcssid, srcmac, hostname_mac /*SkipSTART*/order by bandwidth desc, subtotal desc/*SkipEND*/)### t where srcssid is not null group by srcssid having sum(bandwidth)>0 union all select ssid as srcssid, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, stamac, stamac as srcmac, ap, ssid, ssid as srcssid, user_src, sum(coalesce(sentdelta, 0)) as sentdelta, sum(coalesce(rcvddelta, 0)) as rcvddelta, sum(coalesce(sentdelta, 0)+coalesce(rcvddelta, 0)) as bandwidth from (select itime, stamac, ap, ssid, coalesce(`user`, ipstr(`srcip`)) as user_src, sentbyte-lag(coalesce(sentbyte, 0)) over (partition by stamac order by itime) as sentdelta, rcvdbyte-lag(coalesce(rcvdbyte, 0)) over (partition by stamac order by itime) as rcvddelta from $log-event where $filter and subtype='wireless' and stamac is not null and ssid is not null and action in ('sta-wl-bridge-traffic-stats', 'reassoc-req', 'assoc-req')) as t group by timestamp, stamac, ap, ssid, user_src /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t group by ssid having sum(bandwidth)>0) t group by srcssid order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "wifi-Top-SSID-By-Client"
        set description "Top SSIDs by client"
        set log-type traffic
        set query "select srcssid, count(distinct srcmac) as totalnum from (select srcssid, srcmac from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, ap, srcintf, srcssid, srcssid as ssid, srcmac, srcmac as stamac, coalesce(nullifna(`srcname`), `srcmac`) as hostname_mac, max(srcswversion) as srcswversion, max(osname) as osname, max(osversion) as osversion, max(devtype) as devtype, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, count(*) as subtotal from $log-traffic where $filter and (logflag&1>0) and (srcssid is not null or dstssid is not null) group by user_src, ap, srcintf, srcssid, srcmac, hostname_mac /*SkipSTART*/order by bandwidth desc, subtotal desc/*SkipEND*/)### t where srcmac is not null group by srcssid, srcmac union all select ssid as srcssid, stamac as srcmac from ###(select $flex_timestamp as timestamp, stamac, stamac as srcmac, ap, ssid, ssid as srcssid, user_src, sum(coalesce(sentdelta, 0)) as sentdelta, sum(coalesce(rcvddelta, 0)) as rcvddelta, sum(coalesce(sentdelta, 0)+coalesce(rcvddelta, 0)) as bandwidth from (select itime, stamac, ap, ssid, coalesce(`user`, ipstr(`srcip`)) as user_src, sentbyte-lag(coalesce(sentbyte, 0)) over (partition by stamac order by itime) as sentdelta, rcvdbyte-lag(coalesce(rcvdbyte, 0)) over (partition by stamac order by itime) as rcvddelta from $log-event where $filter and subtype='wireless' and stamac is not null and ssid is not null and action in ('sta-wl-bridge-traffic-stats', 'reassoc-req', 'assoc-req')) as t group by timestamp, stamac, ap, ssid, user_src /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t where stamac is not null group by ssid, stamac) t where srcssid is not null group by srcssid order by totalnum desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "wifi-Top-App-By-Bandwidth"
        set description "Top WiFi applications by bandwidth usage"
        set log-type traffic
        set query "select appid, app, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter and (logflag&1>0) and (srcssid is not null or dstssid is not null) and nullifna(app) is not null group by appid, app having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "wifi-Top-Client-By-Bandwidth"
        set description "Top WiFi client by bandwidth usage"
        set log-type traffic
        set query "select client, sum(bandwidth) as bandwidth from (select (coalesce(hostname_mac, 'unknown') || ' (' || get_devtype(srcswversion, osname, devtype) || ', ' || coalesce(osname, '') || (case when srcswversion is null then '' else ' ' || srcswversion end) || ')') as client, sum(bandwidth) as bandwidth from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, ap, srcintf, srcssid, srcssid as ssid, srcmac, srcmac as stamac, coalesce(nullifna(`srcname`), `srcmac`) as hostname_mac, max(srcswversion) as srcswversion, max(osname) as osname, max(osversion) as osversion, max(devtype) as devtype, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, count(*) as subtotal from $log-traffic where $filter and (logflag&1>0) and (srcssid is not null or dstssid is not null) group by user_src, ap, srcintf, srcssid, srcmac, hostname_mac /*SkipSTART*/order by bandwidth desc, subtotal desc/*SkipEND*/)### t group by client having sum(bandwidth)>0 union all select (coalesce(stamac, 'unknown')) as client, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, stamac, stamac as srcmac, ap, ssid, ssid as srcssid, user_src, sum(coalesce(sentdelta, 0)) as sentdelta, sum(coalesce(rcvddelta, 0)) as rcvddelta, sum(coalesce(sentdelta, 0)+coalesce(rcvddelta, 0)) as bandwidth from (select itime, stamac, ap, ssid, coalesce(`user`, ipstr(`srcip`)) as user_src, sentbyte-lag(coalesce(sentbyte, 0)) over (partition by stamac order by itime) as sentdelta, rcvdbyte-lag(coalesce(rcvdbyte, 0)) over (partition by stamac order by itime) as rcvddelta from $log-event where $filter and subtype='wireless' and stamac is not null and ssid is not null and action in ('sta-wl-bridge-traffic-stats', 'reassoc-req', 'assoc-req')) as t group by timestamp, stamac, ap, ssid, user_src /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t group by client having sum(bandwidth) > 0) t where client is not null group by client order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "wifi-Top-OS-By-Bandwidth"
        set description "Top WiFi os by bandwidth usage"
        set log-type traffic
        set query "select (coalesce(osname, 'unknown') || ' ' || coalesce(srcswversion, '')) as os, sum(bandwidth) as bandwidth from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, ap, srcintf, srcssid, srcssid as ssid, srcmac, srcmac as stamac, coalesce(nullifna(`srcname`), `srcmac`) as hostname_mac, max(srcswversion) as srcswversion, max(osname) as osname, max(osversion) as osversion, max(devtype) as devtype, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, count(*) as subtotal from $log-traffic where $filter and (logflag&1>0) and (srcssid is not null or dstssid is not null) group by user_src, ap, srcintf, srcssid, srcmac, hostname_mac /*SkipSTART*/order by bandwidth desc, subtotal desc/*SkipEND*/)### t group by os having sum(bandwidth)>0 order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "wifi-Top-OS-By-WiFi-Client"
        set description "Top WiFi os by WiFi client"
        set log-type traffic
        set query "select (coalesce(osname, 'unknown') || ' ' || coalesce(osversion, '')) as os, count(distinct srcmac) as totalnum from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, ap, srcintf, srcssid, srcssid as ssid, srcmac, srcmac as stamac, coalesce(nullifna(`srcname`), `srcmac`) as hostname_mac, max(srcswversion) as srcswversion, max(osname) as osname, max(osversion) as osversion, max(devtype) as devtype, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, count(*) as subtotal from $log-traffic where $filter and (logflag&1>0) and (srcssid is not null or dstssid is not null) group by user_src, ap, srcintf, srcssid, srcmac, hostname_mac /*SkipSTART*/order by bandwidth desc, subtotal desc/*SkipEND*/)### t where srcmac is not null group by os order by totalnum desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "wifi-WiFi-Client-Number-Timeline"
        set description "WiFi client Number Timeline"
        set log-type event
        set query "select $flex_timescale(timestamp) as hodex, count(distinct (case when radioband='5G' then stamac else NULL end)) as g5, count(distinct (case when radioband='2G' then stamac else NULL end)) as g2 from ###(select $flex_timestamp as timestamp, stamac, radioband from $log  where $filter and subtype='wireless' group by timestamp, stamac, radioband /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t group by hodex order by hodex"
        set protected enable
    next

    edit "wifi-Top-Device-By-Bandwidth"
        set description "Top WiFi device by bandwidth usage"
        set log-type traffic
        set query "select get_devtype(srcswversion, osname, devtype) as devtype_new, sum(bandwidth) as bandwidth from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, ap, srcintf, srcssid, srcssid as ssid, srcmac, srcmac as stamac, coalesce(nullifna(`srcname`), `srcmac`) as hostname_mac, max(srcswversion) as srcswversion, max(osname) as osname, max(osversion) as osversion, max(devtype) as devtype, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, count(*) as subtotal from $log-traffic where $filter and (logflag&1>0) and (srcssid is not null or dstssid is not null) group by user_src, ap, srcintf, srcssid, srcmac, hostname_mac /*SkipSTART*/order by bandwidth desc, subtotal desc/*SkipEND*/)### t where devtype is not null group by devtype_new having sum(bandwidth)>0 order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "wifi-Top-Device-By-Client"
        set description "Top WiFi device by client"
        set log-type traffic
        set query "select devtype_new, count(distinct srcmac) as totalnum from (select get_devtype(srcswversion, osname, devtype) as devtype_new, srcmac from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, ap, srcintf, srcssid, srcssid as ssid, srcmac, srcmac as stamac, coalesce(nullifna(`srcname`), `srcmac`) as hostname_mac, max(srcswversion) as srcswversion, max(osname) as osname, max(osversion) as osversion, max(devtype) as devtype, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, count(*) as subtotal from $log-traffic where $filter and (logflag&1>0) and (srcssid is not null or dstssid is not null) group by user_src, ap, srcintf, srcssid, srcmac, hostname_mac /*SkipSTART*/order by bandwidth desc, subtotal desc/*SkipEND*/)### t where srcmac is not null) t where devtype_new is not null group by devtype_new order by totalnum desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "wifi-Overall-Traffic"
        set description "WiFi overall traffic"
        set log-type traffic
        set query "select sum(bandwidth) as bandwidth from (select sum(bandwidth) as bandwidth from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, ap, srcintf, srcssid, srcssid as ssid, srcmac, srcmac as stamac, coalesce(nullifna(`srcname`), `srcmac`) as hostname_mac, max(srcswversion) as srcswversion, max(osname) as osname, max(osversion) as osversion, max(devtype) as devtype, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, count(*) as subtotal from $log-traffic where $filter and (logflag&1>0) and (srcssid is not null or dstssid is not null) group by user_src, ap, srcintf, srcssid, srcmac, hostname_mac /*SkipSTART*/order by bandwidth desc, subtotal desc/*SkipEND*/)### t group by srcssid union all select sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, stamac, stamac as srcmac, ap, ssid, ssid as srcssid, user_src, sum(coalesce(sentdelta, 0)) as sentdelta, sum(coalesce(rcvddelta, 0)) as rcvddelta, sum(coalesce(sentdelta, 0)+coalesce(rcvddelta, 0)) as bandwidth from (select itime, stamac, ap, ssid, coalesce(`user`, ipstr(`srcip`)) as user_src, sentbyte-lag(coalesce(sentbyte, 0)) over (partition by stamac order by itime) as sentdelta, rcvdbyte-lag(coalesce(rcvdbyte, 0)) over (partition by stamac order by itime) as rcvddelta from $log-event where $filter and subtype='wireless' and stamac is not null and ssid is not null and action in ('sta-wl-bridge-traffic-stats', 'reassoc-req', 'assoc-req')) as t group by timestamp, stamac, ap, ssid, user_src /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t) t"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "wifi-Num-Distinct-Client"
        set description "WiFi num distinct client"
        set log-type traffic
        set query "select count(distinct srcmac) as totalnum from (select srcmac from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, ap, srcintf, srcssid, srcssid as ssid, srcmac, srcmac as stamac, coalesce(nullifna(`srcname`), `srcmac`) as hostname_mac, max(srcswversion) as srcswversion, max(osname) as osname, max(osversion) as osversion, max(devtype) as devtype, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, count(*) as subtotal from $log-traffic where $filter and (logflag&1>0) and (srcssid is not null or dstssid is not null) group by user_src, ap, srcintf, srcssid, srcmac, hostname_mac /*SkipSTART*/order by bandwidth desc, subtotal desc/*SkipEND*/)### t where srcmac is not null group by srcmac union all select stamac as srcmac from ###(select $flex_timestamp as timestamp, stamac, stamac as srcmac, ap, ssid, ssid as srcssid, user_src, sum(coalesce(sentdelta, 0)) as sentdelta, sum(coalesce(rcvddelta, 0)) as rcvddelta, sum(coalesce(sentdelta, 0)+coalesce(rcvddelta, 0)) as bandwidth from (select itime, stamac, ap, ssid, coalesce(`user`, ipstr(`srcip`)) as user_src, sentbyte-lag(coalesce(sentbyte, 0)) over (partition by stamac order by itime) as sentdelta, rcvdbyte-lag(coalesce(rcvdbyte, 0)) over (partition by stamac order by itime) as rcvddelta from $log-event where $filter and subtype='wireless' and stamac is not null and ssid is not null and action in ('sta-wl-bridge-traffic-stats', 'reassoc-req', 'assoc-req')) as t group by timestamp, stamac, ap, ssid, user_src /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t where stamac is not null group by stamac) t"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next

    edit "Subnet-Top-Subnets-By-App-Bandwidth"
        set description "Top subnets by application bandwidth"
        set log-type traffic
        set query "select ip_subnet(`srcip`) as subnet, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out, count(*) as sessions from $log where $filter and (logflag&1>0) group by subnet having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc"
        set protected enable
    next
    edit "Subnet-Top-App-By-Bandwidth"
        set description "Top applications by bandwidth"
        set log-type traffic
        set query "select ip_subnet(`srcip`) as subnet, app_group_name(app) as app_group, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter and (logflag&1>0) and nullifna(app) is not null group by subnet, app_group having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc"
        set protected enable
    next
    edit "Subnet-Top-App-By-Sessions"
        set description "Top applications by sessions"
        set log-type traffic
        set query "select ip_subnet(`srcip`) as subnet, app_group_name(app) as app_group, count(*) as sessions from $log where $filter and (logflag&1>0) and nullifna(app) is not null group by subnet, app_group order by sessions desc"
        set protected enable
    next
    edit "Subnet-Top-Websites-And-Web-Category-By-Bandwidth"
        set description "Top websites and web category by bandwidth"
        set log-type traffic
        set query "select subnet, website, sum(bandwidth) as bandwidth from ###(select ip_subnet(`srcip`) as subnet, hostname as website, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log-traffic where $filter and hostname is not null and (logflag&1>0) and (countweb>0 or ((logver is null or logver<502000000) and (hostname is not null or utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter')))) group by subnet, website order by bandwidth desc)### t group by subnet, website order by bandwidth desc"
        set protected enable
    next
    edit "Subnet-Top-Websites-And-Web-Category-By-Sessions"
        set description "Top websites and web category by sessions"
        set log-type webfilter
        set query "select subnet, website, sum(hits) as hits from ###(select ip_subnet(`srcip`) as subnet, hostname as website, count(*) as hits from $log where $filter and hostname is not null group by subnet, website order by hits desc)### t group by subnet, website order by hits desc"
        set protected enable
    next
    edit "Subnet-Top-Users-By-Sessions"
        set description "Top users by sessions"
        set log-type traffic
        set query "select ip_subnet(`srcip`) as subnet, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, count(*) as sessions from $log where $filter and (logflag&1>0) group by subnet, user_src order by sessions desc"
        set protected enable
    next
    edit "Subnet-Top-Users-By-Bandwidth"
        set description "Top users by bandwidth"
        set log-type traffic
        set query "select ip_subnet(`srcip`) as subnet, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter and (logflag&1>0) and srcip is not null group by subnet, user_src having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc"
        set protected enable
    next

    edit "app-Top-Category-and-Applications-by-Bandwidth"
        set description "Top category and applications by bandwidth usage"
        set log-type traffic
        set query "select appcat, app, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter and (logflag&1>0) group by appcat, app having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc"
        set protected enable
    next
    edit "app-Top-Category-and-Applications-by-Session"
        set description "Top category and applications by session"
        set log-type traffic
        set query "select appcat, app, count(*) as sessions from $log where $filter and (logflag&1>0) group by appcat, app order by sessions desc"
        set protected enable
    next
    edit "app-Top-Allowed-Applications-by-Bandwidth"
        set description "Top allowed applications by bandwidth usage"
        set log-type traffic
        set query "select from_itime(itime) as timestamp, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, appcat, app, coalesce(root_domain(hostname), ipstr(dstip)) as destination, sum(coalesce(`sentbyte`, 0)+coalesce(`rcvdbyte`, 0)) as bandwidth from $log where $filter and (logflag&1>0) and action in ('accept', 'close', 'timeout') group by timestamp, user_src, appcat, app, destination order by bandwidth desc"
        set protected enable
    next
    edit "app-Top-Blocked-Applications-by-Session"
        set description "Top blocked applications by session"
        set log-type traffic
        set query "select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, appcat, app, count(*) as sessions from $log where $filter and (logflag&1>0) and action in ('deny', 'blocked', 'reset', 'dropped') group by user_src, appcat, app order by sessions desc"
        set protected enable
    next

    edit "app-Visibility-Control-Summary"
        set description "Severe and high risk applications"
        set log-type traffic
        set query "select appcat, count(distinct app) as total_num from ###(select appcat, app from $log where $filter and app is not null and appcat is not null and (logflag&1>0) group by appcat, app)### t group by appcat order by total_num desc"
         set protected enable
    next

    edit "apprisk-ctrl-Severe-High-Risk-Apps"
        set description "Severe and high risk applications"
        set log-type traffic
        set query "select appcat, count(distinct app) as total_num from ###(select appid, app, appcat, apprisk, sum(bandwidth) as bandwidth, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t group by appid, app, appcat, apprisk /*SkipSTART*/order by sessions desc, bandwidth desc/*SkipEND*/)### t where $filter-drilldown and nullifna(appcat) is not null and apprisk in ('critical', 'high') group by appcat order by total_num desc"
         set protected enable
    next

    edit "apprisk-ctrl-Total-High-Risk-Apps"
        set description "Total Severe and High Risk Applications"
        set log-type traffic
        set query "select count(distinct app) as total_num from ###(select appid, app, appcat, apprisk, sum(bandwidth) as bandwidth, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t group by appid, app, appcat, apprisk /*SkipSTART*/order by sessions desc, bandwidth desc/*SkipEND*/)### t where $filter-drilldown and apprisk in ('critical', 'high') order by total_num desc"
         set protected enable
    next

    edit "apprisk-ctrl-Total-Bandwidth"
        set description "Application Risk Total Bandwidth"
        set log-type traffic
        set query "select sum(bandwidth) as bandwidth from ###(select appid, app, appcat, apprisk, sum(bandwidth) as bandwidth, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t group by appid, app, appcat, apprisk /*SkipSTART*/order by sessions desc, bandwidth desc/*SkipEND*/)### t"
         set protected enable
    next

    edit "apprisk-ctrl-Total-Threats-Prevention"
        set description "Total Threat Prevention"
        set log-type app-ctrl
        set query "select count(distinct threats) as total_num from (###(select app as threats, count(*) as total_num from $log-app-ctrl where $filter and lower(appcat)='botnet' group by app order by total_num desc)### union all ###(select virus as threats, count(*) as total_num from $log-virus where $filter and nullifna(virus) is not null group by virus order by total_num desc)### union all ###(select  hostname as threats, count(*) as total_num from $log-webfilter where $filter and cat in (26, 61) group by hostname order by total_num desc)### union all ###(select  attack as threats, count(*) as total_num from $log-attack where $filter and severity in ('critical', 'high') group by attack order by total_num desc)###) t order by total_num desc"
         set protected enable
    next

    edit "apprisk-ctrl-Threats-Prevention"
        set description "Threat Prevention"
        set log-type app-ctrl
        set query "select threat_name, count(distinct threats) as total_num from (###(select cast('Malware & Botnet C&C' as char(32)) as threat_name, app as threats, count(*) as total_num from $log-app-ctrl where $filter and lower(appcat)='botnet' group by app order by total_num desc)### union all ###(select cast('Malware & Botnet C&C' as char(32)) as threat_name, virus as threats, count(*) as total_num from $log-virus where $filter and nullifna(virus) is not null group by virus order by total_num desc)### union all ###(select cast('Malicious & Phishing Sites' as char(32)) as threat_name, hostname as threats, count(*) as total_num from $log-webfilter where $filter and cat in (26, 61) group by hostname order by total_num desc)### union all ###(select cast('Critical & High Intrusion Attacks' as char(32)) as threat_name, attack as threats, count(*) as total_num from $log-attack where $filter and severity in ('critical', 'high') group by attack order by total_num desc)###) t group by threat_name order by total_num desc"
         set protected enable
    next
    edit "apprisk-ctrl-High-Risk-Application"
        set description "Application risk high risk application"
        set log-type traffic
        set query "select risk as d_risk, count(distinct user_src) as users, id, name, app_cat, technology, sum(bandwidth) as bandwidth, sum(sessions) as sessions from ###(select app, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, action, utmaction, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, count(*) as sessions from $log where $filter and (logflag&1>0) group by app, user_src, action, utmaction order by bandwidth desc)### t1 inner join app_mdata t2 on t1.app=t2.name where risk>='4' group by id, name, app_cat, technology, risk order by d_risk desc, sessions desc"
        set protected enable
    next
    edit "apprisk-ctrl-High-Risk-Application-by-Bandwidth"
        set description "High Risk Applications by Bandwidth"
        set log-type traffic
        set query "select risk as d_risk, count(distinct user_src) as users, id, name, app_cat, technology, sum(bandwidth) as bandwidth, sum(sessions) as sessions from ###(select app, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, action, utmaction, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, count(*) as sessions from $log where $filter and (logflag&1>0) group by app, user_src, action, utmaction order by bandwidth desc)### t1 inner join app_mdata t2 on t1.app=t2.name where risk>='4' group by id, name, app_cat, technology, risk order by d_risk desc, bandwidth desc"
        set protected enable
    next
    edit "apprisk-ctrl-High-Risk-Category-and-App-by-Bandwidth"
        set description "High Risk Applications and Categories by Bandwidth"
        set log-type traffic
        set query "select app_cat, name, bandwidth, sum(bandwidth) over (partition by app_cat) as sub_bandwidth from (select app_cat, name, sum(bandwidth) as bandwidth from ###(select app, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, action, utmaction, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, count(*) as sessions from $log where $filter and (logflag&1>0) group by app, user_src, action, utmaction order by bandwidth desc)### t1 inner join app_mdata t2 on t1.app=t2.name where risk>='4' group by app_cat, name order by bandwidth desc) t order by sub_bandwidth desc, app_cat"
        set protected enable
    next
    edit "apprisk-ctrl-High-Risk-Apps-Behavioral"
        set description "Application Behavioral Characteristics"
        set log-type traffic
        set query "select behavior, round(sum(total_num)*100/sum(sum(total_num)) over (),2) as percentage from (###(select timestamp, (case when lower(appcat)='botnet' then 'malicious' when lower(appcat)='remote.access' then 'tunneling' when lower(appcat) in ('storage.backup', 'video/audio') then 'bandwidth-consuming' when lower(appcat)='p2p' then 'peer-to-peer' when lower(appcat)='proxy' then 'proxy' end) as behavior, sum(sessions) as total_num from ###base(/*tag:rpt_base_t_bndwdth_sess*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, appcat, apprisk, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, count(*) as sessions, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in from $log-traffic where $filter and (logflag&(1|32)>0) group by timestamp, dvid, srcip, dstip, epid, euid, appcat, apprisk, user_src, service /*SkipSTART*/order by timestamp desc/*SkipEND*/)base### t where lower(appcat) in ('botnet', 'remote.access', 'storage.backup', 'video/audio', 'p2p', 'proxy') and apprisk in ('critical', 'high') group by timestamp, behavior order by total_num desc)### union all ###(select $flex_timestamp as timestamp, 'malicious' as behavior,  count(*) as total_num from $log-attack where $filter and (logflag&16>0) and severity in ('critical', 'high') group by timestamp, behavior order by total_num desc)###) t where $filter-drilldown group by behavior order by percentage desc"
         set protected enable
     next
    edit "apprisk-ctrl-High-Risk-Apps-Behavioral-Timeline"
        set description "Application Behavioral Timeline"
        set log-type traffic
        set query "select $flex_timescale(timestamp) as hodex, behavior, sum(total_num) as total_num from (###(select timestamp, (case when lower(appcat)='botnet' then 'malicious' when lower(appcat)='remote.access' then 'tunneling' when lower(appcat) in ('storage.backup', 'video/audio') then 'bandwidth-consuming' when lower(appcat)='p2p' then 'peer-to-peer' when lower(appcat)='proxy' then 'proxy' end) as behavior, sum(sessions) as total_num from ###base(/*tag:rpt_base_t_bndwdth_sess*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, appcat, apprisk, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, count(*) as sessions, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in from $log-traffic where $filter and (logflag&(1|32)>0) group by timestamp, dvid, srcip, dstip, epid, euid, appcat, apprisk, user_src, service /*SkipSTART*/order by timestamp desc/*SkipEND*/)base### t where lower(appcat) in ('botnet', 'remote.access', 'storage.backup', 'video/audio', 'p2p', 'proxy') and apprisk in ('critical', 'high') group by timestamp, behavior order by total_num desc)### union all ###(select $flex_timestamp as timestamp, 'malicious' as behavior,  count(*) as total_num from $log-attack where $filter and (logflag&16>0) and severity in ('critical', 'high') group by timestamp, behavior order by total_num desc)###) t where $filter-drilldown group by hodex, behavior order by total_num desc"
         set protected enable
     next
    edit "apprisk-ctrl-Key-Application-Crossing-The-Network"
        set description "Key Application Crossing The Network"
        set log-type traffic
        set query "select risk as d_risk, count(distinct user_src) as users, id, name, app_cat, technology, sum(bandwidth) as bandwidth, sum(sessions) as sessions from ###(select app, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, count(*) as sessions from $log where $filter and (logflag&1>0) group by app, user_src order by bandwidth desc)### t1 inner join app_mdata t2 on t1.app=t2.name group by id, app, app_cat, technology, risk order by bandwidth desc" 
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "apprisk-ctrl-Category-Breakdown-By-Bandwidth"
        set description "Category breakdown of all applications, sorted by bandwidth"
        set log-type traffic
        set query "select appcat, count(distinct app) as app_num, count(distinct user_src) as user_num, sum(bandwidth) as bandwidth, sum(sessions) as num_session from ###(select app, appcat, user_src, sum(bandwidth) as bandwidth, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t where nullifna(appcat) is not null and appcat not in ('Not.Scanned', 'unscanned', 'unknown') group by app, appcat, user_src order by bandwidth desc)### t where $filter-drilldown group by appcat order by bandwidth desc"
        set protected enable
    next
    edit "apprisk-ctrl-Top-Web-Applications-By-Bandwidth"
        set description "Top 25 Web Applications by Bandwidth"
        set log-type traffic
        set query "select risk as d_risk, id, name, technology, count(distinct user_src) as user_num, sum(bandwidth) as bandwidth, sum(num_session) as num_session from ###(select appid, user_src, sum(bandwidth) as bandwidth, sum(sessions) as num_session from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t where nullifna(app) is not null and service in ('80/tcp', '443/tcp', 'HTTP', 'HTTPS', 'http', 'https') group by appid, user_src order by bandwidth desc)### t1 inner join app_mdata t2 on t1.appid=t2.id group by d_risk, id, name, technology order by bandwidth desc"
        set protected enable
    next
    edit "apprisk-ctrl-Top-Web-Categories-Visited"
        set description "Top 25 Web Categories Visited"
        set log-type traffic
        set query "select catdesc, count(distinct f_user) as user_num, sum(sessions) as sessions, sum(bandwidth) as bandwidth from ###(select catdesc, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as f_user, count(*) as sessions, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log-traffic where $filter and catdesc is not null and (logflag&1>0) and (countweb>0 or ((logver is null or logver<502000000) and (hostname is not null or utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter')))) group by f_user, catdesc order by sessions desc)### t group by catdesc order by sessions desc"
        set protected enable
    next
    edit "apprisk-ctrl-Common-Virus-Botnet-Spyware"
        set description "Common virus disvocered, the botnet communictions and the spyware/adware"
        set log-type traffic
        set query "select virus_s as virus, (case when lower(appcat)='botnet' then 'Botnet C&C' else (case when virus_s like 'Riskware%' then 'Spyware' when virus_s like 'Adware%' then 'Adware' else 'Virus' end) end) as malware_type, appid, app, count(distinct dstip) as victims, count(distinct srcip) as source, sum(total_num) as total_num from (###(select app as virus_s, appcat, appid, app, dstip, srcip, count(*) as total_num from $log-traffic where $filter and (logflag&1>0) and lower(appcat)='botnet' group by virus_s, appcat, appid, dstip, srcip, app order by total_num desc)### union all ###(select unnest(string_to_array(virus, ',')) as virus_s, appcat, appid, app, dstip, srcip, count(*) as total_num from $log-traffic where $filter and (logflag&1>0) and virus is not null group by virus_s, appcat, appid, dstip, srcip, app order by total_num desc)### union all ###(select attack as virus_s, 'botnet' as appcat, 0 as appid, attack as app, dstip, srcip, count(*) as total_num from $log-attack where $filter and (logflag&16>0) group by virus_s, appcat, appid, dstip, srcip, app order by total_num desc)###) t group by virus, appid, app, malware_type order by total_num desc"
        set protected enable
    next
    edit "apprisk-ctrl-Zero-Day-Detected-On-Network"
        set description "Zero-day malware detected on the network"
        set log-type traffic
        set query "select virus_s, appid, app, count(distinct dstip) as victims, count(distinct srcip) as source, sum(total_num) as total_num from ###(select unnest(string_to_array(virus, ',')) as virus_s, appid, app, dstip, srcip, count(*) as total_num from $log where $filter and (logflag&1>0) and virus like '%PossibleThreat.SB%' group by virus_s, dstip, srcip, appid, app order by total_num desc)### t where virus_s like '%PossibleThreat.SB%' group by virus_s, appid, app  order by total_num desc"
        set protected enable
    next
    edit "apprisk-ctrl-Files-Analyzed-By-FortiCloud-Sandbox"
        set description "Files analyzed by FortiCloud Sandbox"
        set log-type virus
        set query "select $DAY_OF_MONTH as dom, count(*) as total_num from $log where $filter and nullifna(filename) is not null and logid_to_int(logid)=9233 group by dom order by dom"
        set protected enable
    next
    edit "apprisk-ctrl-Files-FortiCloud-Sandbox-Analyzed"
        set description "Files FortiCloud Sandbox Analyzed"
        set log-type virus
        set query "select $fv_line_timescale(timestamp) as dom, sum(total_num) as total_num from ###(select $flex_timestamp as timestamp, count(*) as total_num from $log where $filter and nullifna(filename) is not null and logid_to_int(logid)=9233 group by timestamp order by total_num desc)### t group by dom order by dom"
        set protected enable
    next
    edit "apprisk-ctrl-Malicious-Files-Detected-By-FortiCloud-Sandbox"
        set description "Files detected by FortiCloud Sandbox"
        set log-type virus
        set query "select filename, analyticscksum, count(distinct victim) as victims, count(distinct source) as source from ###(select filename, analyticscksum,(CASE WHEN direction='incoming' THEN dstip ELSE srcip END) as source, (CASE WHEN direction='incoming' THEN srcip ELSE dstip END) as victim, count(*) as totalnum from $log where $filter and filename is not null and logid_to_int(logid)=9233 and analyticscksum is not null group by filename, analyticscksum, source, victim order by totalnum desc)### t group by filename, analyticscksum order by victims desc, source desc"
        set protected enable
    next
    edit "apprisk-ctrl-File-Transferred-By-Application"
        set description "File transferred by applications on the network"
        set log-type app-ctrl
        set query "select appid, app, filename, cloudaction, max(filesize) as filesize from $log where $filter and filesize is not null and clouduser is not null and filename is not null group by cloudaction, appid, app, filename order by filesize desc"
        set protected enable
    next
    edit "apprisk-ctrl-Application-Vulnerability"
        set description "Application vulnerabilities discovered"
        set log-type attack
        set query "select attack, attackid, vuln_type, cve, severity_number, count(distinct (CASE WHEN direction='incoming' THEN srcip ELSE dstip END)) as victims, count(distinct (CASE WHEN direction='incoming' THEN dstip ELSE srcip END)) as sources, sum(totalnum) as totalnum from ###(select attack, attackid, (case when severity='critical' then 5 when severity='high' then 4 when severity='medium' then 3 when severity='low' then 2 when severity='info' then 1 else 0 end) as severity_number, direction, dstip, srcip, count(*) as totalnum from $log where $filter and nullifna(attack) is not null and severity is not null group by attack, attackid, severity, direction, dstip, srcip order by totalnum desc)### t1 left join (select name, cve, vuln_type from ips_mdata) t2 on t1.attack=t2.name group by attack, attackid, vuln_type, severity_number, cve order by severity_number desc, totalnum desc"
        set protected enable
    next

    edit "traffic-User-Detail"
        set description "Traffic user detail"
        set log-type traffic
        set query "select '<b>User: </b>' || string_agg(distinct coalesce(nullifna(`user`), 'Unknown'), ', ') || '<br/>' || '<b>Source IP: </b>' || string_agg(distinct coalesce(ipstr(srcip), 'Unknown'), ', ') || '<br/>' || '<b>Hostname (MAC): </b>' || string_agg(distinct coalesce(host_dev, 'Unknown'), ', ') || '<br/>' || '<b>Source Interface: </b>' || string_agg(distinct coalesce(nullifna(srcintf), 'Unknown'), ', ') || '<br/>' || '<b>Devices: </b>' || string_agg(distinct coalesce(devid, 'Unknown'), ', ') as user_detail from ###(select `user`, srcip, coalesce(nullifna(`srcname`),nullifna(`srcmac`)) as host_dev, srcintf, devid, count(*) as events from $log where $filter group by `user`, srcip, host_dev, srcintf, devid order by events desc)### t"
        set protected enable
    next
    edit "web-Detailed-Website-Browsing-Log"
        set description "Web detailed website browsing log"
        set log-type traffic
        set query "select from_dtime(dtime) as timestamp, catdesc, hostname as website, status, sum(bandwidth) as bandwidth from ###(select dtime, catdesc, hostname, cast(utmaction as text) as status, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log-traffic where $filter and hostname is not null and (logflag&1>0) and (countweb>0 or ((logver is null or logver<502000000) and (hostname is not null or utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter')))) group by dtime, catdesc, hostname, utmaction order by dtime desc)### t group by dtime, catdesc, website, status order by dtime desc"
        set protected enable
    next
    edit "web-Hourly-Category-and-Website-Hits-Action"
        set description "Web hourly category and website hits action"
        set log-type webfilter
        set query "select hod, website, sum(hits) as hits from ###(select $hour_of_day as hod, (hostname || ' (' || coalesce(`catdesc`, 'Unknown') || ')') as website , count(*) as hits from $log where $filter and hostname is not null group by hod, website order by hod, hits desc)### t group by hod, website order by hod, hits desc"
        set protected enable
    next
    edit "web-Top-Category-and-Websites-by-Bandwidth"
        set description "Web top category and websites by bandwidth usage"
        set log-type traffic
        set query "select website, catdesc, sum(bandwidth) as bandwidth from ###(select hostname as website, catdesc, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log-traffic where $filter and hostname is not null and (logflag&1>0) and (countweb>0 or ((logver is null or logver<502000000) and (hostname is not null or utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter')))) group by website, catdesc order by bandwidth desc)### t group by website, catdesc order by bandwidth desc"
        set protected enable
    next
    edit "web-Top-Category-and-Websites-by-Session"
        set description "Web top category and websites by session"
        set log-type webfilter
        set query "select website, catdesc, sum(sessions) as hits from ###(select hostname as website, catdesc, count(*) as sessions from $log where $filter and hostname is not null group by hostname, catdesc order by sessions desc)### t group by website, catdesc order by hits desc"
        set protected enable
    next
    edit "web-Top-Website-Sessions-by-Bandwidth"
        set description "Web top website sessions by bandwidth usage"
        set log-type traffic
        set query "select from_dtime(dtime) as timestamp, user_src, website, catdesc, cast(sum(dura)/60 as decimal(18, 2)) as dura, sum(bandwidth) as bandwidth from ###(select dtime, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, hostname as website, catdesc, sum(coalesce(duration, 0)) as dura, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter and hostname is not null and (logflag&1>0) and action in ('accept','close','timeout') group by dtime, user_src, website, catdesc having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc)### t group by dtime, user_src, website, catdesc order by bandwidth desc"
        set protected enable
    next
    edit "web-Top-User-Visted-Websites-by-Bandwidth"
        set description "Web top user visted websites by bandwidth usage"
        set log-type traffic
        set query "select website, catdesc, sum(bandwidth) as bandwidth from ###(select hostname as website, catdesc, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log-traffic where $filter and hostname is not null and (logflag&1>0) and (countweb>0 or ((logver is null or logver<502000000) and (hostname is not null or utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter')))) group by hostname, catdesc having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc)### t group by website, catdesc order by bandwidth desc"
        set protected enable
    next
    edit "web-Top-User-Visted-Websites-by-Session"
        set description "Web top user visted websites by session"
        set log-type webfilter
        set query "select website, catdesc, sum(sessions) as sessions from ###(select hostname as website, catdesc, count(*) as sessions from $log where $filter and hostname is not null group by hostname, catdesc order by sessions desc)### t where catdesc is not null group by website, catdesc order by sessions desc"
        set protected enable
    next







    edit "os-Detect-OS-Count"
        set description "Detected operation system count"
        set log-type traffic
        set query "select (coalesce(osname, 'Unknown')) as os, count(*) as totalnum from $log where $filter and (logflag&1>0) group by os order by totalnum desc"
        set protected enable
    next

    edit "drilldown-Top-App-By-Sessions"
        set description "Drilldown top applications by session count"
        set log-type traffic
        set query "select appid, app, sum(sessions) as sessions from ###(select appid, app, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, dstip, srcintf, dstintf, policyid, count(*) as sessions, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter-exclude-var and (logflag&1>0) group by appid, app, user_src, dstip, srcintf, dstintf, policyid order by sessions desc)### t where $filter-drilldown and nullifna(app) is not null group by appid, app order by sessions desc"
        set hidden enable
        set protected enable
    next
    edit "drilldown-Top-App-By-Bandwidth"
        set description "Drilldown top applications by bandwidth usage"
        set log-type traffic
        set query "select appid, app, sum(bandwidth) as bandwidth from ###(select appid, app, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, dstip, srcintf, dstintf, policyid, count(*) as sessions, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter-exclude-var and (logflag&1>0) group by appid, app, user_src, dstip, srcintf, dstintf, policyid order by sessions desc)### t where $filter-drilldown and nullifna(app) is not null group by appid, app having sum(bandwidth)>0 order by bandwidth desc"
        set hidden enable
        set protected enable
    next
    edit "drilldown-Top-Destination-By-Sessions"
        set description "Drilldown top destination by session count"
        set log-type traffic
        set query "select dstip, sum(sessions) as sessions from ###(select appid, app, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, dstip, srcintf, dstintf, policyid, count(*) as sessions, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter-exclude-var and (logflag&1>0) group by appid, app, user_src, dstip, srcintf, dstintf, policyid order by sessions desc)### t where $filter-drilldown and dstip is not null group by dstip order by sessions desc"
        set hidden enable
        set protected enable
    next
    edit "drilldown-Top-Destination-By-Bandwidth"
        set description "Drilldown top destination by bandwidth usage"
        set log-type traffic
        set query "select dstip, sum(bandwidth) as bandwidth from ###(select appid, app, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, dstip, srcintf, dstintf, policyid, count(*) as sessions, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter-exclude-var and (logflag&1>0) group by appid, app, user_src, dstip, srcintf, dstintf, policyid order by sessions desc)### t where $filter-drilldown and dstip is not null group by dstip having sum(bandwidth)>0 order by bandwidth desc"
        set hidden enable
        set protected enable
    next
    edit "drilldown-Top-User-By-Sessions"
        set description "Drilldown top user by session count"
        set log-type traffic
        set query "select user_src, sum(sessions) as sessions from ###(select appid, app, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, dstip, srcintf, dstintf, policyid, count(*) as sessions, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter-exclude-var and (logflag&1>0) group by appid, app, user_src, dstip, srcintf, dstintf, policyid order by sessions desc)### t where $filter-drilldown and user_src is not null group by user_src order by sessions desc"
        set hidden enable
        set protected enable
    next
    edit "drilldown-Top-User-By-Bandwidth"
        set description "Drilldown top user by bandwidth usage"
        set log-type traffic
        set query "select user_src, sum(bandwidth) as bandwidth from ###(select appid, app, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, dstip, srcintf, dstintf, policyid, count(*) as sessions, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter-exclude-var and (logflag&1>0) group by appid, app, user_src, dstip, srcintf, dstintf, policyid order by sessions desc)### t where $filter-drilldown and user_src is not null group by user_src having sum(bandwidth)>0 order by bandwidth desc"
        set hidden enable
        set protected enable
    next
    edit "drilldown-Top-Web-User-By-Visit"
        set description "Drilldown top web user by visit"
        set log-type traffic
        set query "select user_src, sum(requests) as visits from (###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, hostname, count(*) as requests from $log-traffic where $filter-exclude-var and (logflag&1>0) and utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter') and hostname is not null group by user_src, hostname order by requests desc)### union all ###(select coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, hostname, count(*) as requests from $log-webfilter where $filter-exclude-var and hostname is not null group by user_src, hostname order by requests desc)###) t where $filter-drilldown and user_src is not null group by user_src order by visits desc"
        set hidden enable
        set protected enable
    next
    edit "drilldown-Top-Website-By-Request"
        set description "Drilldown top website by request"
        set log-type traffic
        set query "select hostname, sum(requests) as visits from (###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, hostname, count(*) as requests from $log-traffic where $filter-exclude-var and (logflag&1>0) and utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter') and hostname is not null group by user_src, hostname order by requests desc)### union all ###(select coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, hostname, count(*) as requests from $log-webfilter where $filter-exclude-var and hostname is not null group by user_src, hostname order by requests desc)###) t where $filter-drilldown and hostname is not null group by hostname order by visits desc"
        set hidden enable
        set protected enable
    next
    edit "drilldown-Top-Email-Sender-By-Volume"
        set description "Drilldown top email sender by volume"
        set log-type traffic
        set query "select sender, sum(bandwidth) as volume from (###(select sender, recipient, count(*) as requests, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log-traffic where $filter-exclude-var and (logflag&1>0) and service in ('smtp', 'SMTP', '25/tcp', '587/tcp', 'smtps', 'SMTPS', '465/tcp') and utmevent in ('general-email-log', 'spamfilter') group by sender, recipient order by requests desc)### union all ###(select `from` as sender, `to` as recipient, count(*) as requests, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log-emailfilter where $filter-exclude-var and service in ('smtp', 'SMTP', '25/tcp', '587/tcp', 'smtps', 'SMTPS', '465/tcp') and eventtype is null group by `from`, `to` order by requests desc)###) t where $filter-drilldown and sender is not null group by sender having sum(bandwidth)>0 order by volume desc"
        set hidden enable
        set protected enable
    next
    edit "drilldown-Top-Email-Sender-By-Count"
        set description "Drilldown top email sender by count"
        set log-type traffic
        set query "select sender, sum(requests) as requests from (###(select sender, recipient, count(*) as requests, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log-traffic where $filter-exclude-var and (logflag&1>0) and service in ('smtp', 'SMTP', '25/tcp', '587/tcp', 'smtps', 'SMTPS', '465/tcp') and utmevent in ('general-email-log', 'spamfilter') group by sender, recipient order by requests desc)### union all ###(select `from` as sender, `to` as recipient, count(*) as requests, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log-emailfilter where $filter-exclude-var and service in ('smtp', 'SMTP', '25/tcp', '587/tcp', 'smtps', 'SMTPS', '465/tcp') and eventtype is null group by `from`, `to` order by requests desc)###) t where $filter-drilldown and sender is not null group by sender order by requests desc"
        set hidden enable
        set protected enable
    next
    edit "drilldown-Top-Email-Send-Recipient-By-Volume"
        set description "Drilldown top email send recipient by volume"
        set log-type traffic
        set query "select recipient, sum(bandwidth) as volume from (###(select sender, recipient, count(*) as requests, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log-traffic where $filter-exclude-var and (logflag&1>0) and service in ('smtp', 'SMTP', '25/tcp', '587/tcp', 'smtps', 'SMTPS', '465/tcp') and utmevent in ('general-email-log', 'spamfilter') group by sender, recipient order by requests desc)### union all ###(select `from` as sender, `to` as recipient, count(*) as requests, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log-emailfilter where $filter-exclude-var and service in ('smtp', 'SMTP', '25/tcp', '587/tcp', 'smtps', 'SMTPS', '465/tcp') and eventtype is null group by `from`, `to` order by requests desc)###) t where $filter-drilldown and recipient is not null group by recipient having sum(bandwidth)>0 order by volume desc"
        set hidden enable
        set protected enable
    next
    edit "drilldown-Top-Email-Send-Recipient-By-Count"
        set description "Drilldown top email send recipient by count"
        set log-type traffic
        set query "select recipient, sum(requests) as requests from (###(select sender, recipient, count(*) as requests, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log-traffic where $filter-exclude-var and (logflag&1>0) and service in ('smtp', 'SMTP', '25/tcp', '587/tcp', 'smtps', 'SMTPS', '465/tcp') and utmevent in ('general-email-log', 'spamfilter') group by sender, recipient order by requests desc)### union all ###(select `from` as sender, `to` as recipient, count(*) as requests, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log-emailfilter where $filter-exclude-var and service in ('smtp', 'SMTP', '25/tcp', '587/tcp', 'smtps', 'SMTPS', '465/tcp') and eventtype is null group by `from`, `to` order by requests desc)###) t where $filter-drilldown and recipient is not null group by recipient order by requests desc"
        set hidden enable
        set protected enable
    next
    edit "drilldown-Top-Email-Receiver-By-Volume"
        set description "Drilldown top email receiver by volume"
        set log-type traffic
        set query "select recipient, sum(bandwidth) as volume from (###(select recipient, sender, count(*) as requests, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter-exclude-var and (logflag&1>0) and service in ('pop3', 'POP3', '110/tcp', 'imap', 'IMAP', '143/tcp', 'imaps', 'IMAPS', '993/tcp', 'pop3s', 'POP3S', '995/tcp') and utmevent in ('general-email-log', 'spamfilter') group by recipient, sender order by requests desc)### union all ###(select `to` as recipient, `from` as sender, count(*) as requests, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log-emailfilter where $filter-exclude-var and service in ('pop3', 'POP3', '110/tcp', 'imap', 'IMAP', '143/tcp', 'imaps', 'IMAPS', '993/tcp', 'pop3s', 'POP3S', '995/tcp') and eventtype is null group by `to`, `from` order by requests desc)###) t where $filter-drilldown and recipient is not null group by recipient having sum(bandwidth)>0 order by volume desc"
        set hidden enable
        set protected enable
    next
    edit "drilldown-Top-Email-Receiver-By-Count"
        set description "Drilldown top email receiver by count"
        set log-type traffic
        set query "select recipient, sum(requests) as requests from (###(select recipient, sender, count(*) as requests, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter-exclude-var and (logflag&1>0) and service in ('pop3', 'POP3', '110/tcp', 'imap', 'IMAP', '143/tcp', 'imaps', 'IMAPS', '993/tcp', 'pop3s', 'POP3S', '995/tcp') and utmevent in ('general-email-log', 'spamfilter') group by recipient, sender order by requests desc)### union all ###(select `to` as recipient, `from` as sender, count(*) as requests, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log-emailfilter where $filter-exclude-var and service in ('pop3', 'POP3', '110/tcp', 'imap', 'IMAP', '143/tcp', 'imaps', 'IMAPS', '993/tcp', 'pop3s', 'POP3S', '995/tcp') and eventtype is null group by `to`, `from` order by requests desc)###) t where $filter-drilldown and recipient is not null group by recipient order by requests desc"
        set hidden enable
        set protected enable
    next
    edit "drilldown-Top-Email-Receive-Sender-By-Volume"
        set description "Drilldown top email receive sender by volume"
        set log-type traffic
        set query "select sender, sum(bandwidth) as volume from (###(select recipient, sender, count(*) as requests, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter-exclude-var and (logflag&1>0) and service in ('pop3', 'POP3', '110/tcp', 'imap', 'IMAP', '143/tcp', 'imaps', 'IMAPS', '993/tcp', 'pop3s', 'POP3S', '995/tcp') and utmevent in ('general-email-log', 'spamfilter') group by recipient, sender order by requests desc)### union all ###(select `to` as recipient, `from` as sender, count(*) as requests, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log-emailfilter where $filter-exclude-var and service in ('pop3', 'POP3', '110/tcp', 'imap', 'IMAP', '143/tcp', 'imaps', 'IMAPS', '993/tcp', 'pop3s', 'POP3S', '995/tcp') and eventtype is null group by `to`, `from` order by requests desc)###) t where $filter-drilldown and sender is not null group by sender having sum(bandwidth)>0 order by volume desc"
        set hidden enable
        set protected enable
    next
    edit "drilldown-Top-Email-Receive-Sender-By-Count"
        set description "Drilldown top email receive sender by count"
        set log-type traffic
        set query "select sender, sum(requests) as requests from (###(select recipient, sender, count(*) as requests, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter-exclude-var and (logflag&1>0) and service in ('pop3', 'POP3', '110/tcp', 'imap', 'IMAP', '143/tcp', 'imaps', 'IMAPS', '993/tcp', 'pop3s', 'POP3S', '995/tcp') and utmevent in ('general-email-log', 'spamfilter') group by recipient, sender order by requests desc)### union all ###(select `to` as recipient, `from` as sender, count(*) as requests, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log-emailfilter where $filter-exclude-var and service in ('pop3', 'POP3', '110/tcp', 'imap', 'IMAP', '143/tcp', 'imaps', 'IMAPS', '993/tcp', 'pop3s', 'POP3S', '995/tcp') and eventtype is null group by `to`, `from` order by requests desc)###) t where $filter-drilldown and sender is not null group by sender order by requests desc"
        set hidden enable
        set protected enable
    next
    edit "drilldown-Top-Attack-Dest"
        set description "Drilldown top attack dest"
        set log-type attack
        set query "select victim, sum(totalnum) as totalnum from ###(select (CASE WHEN direction='incoming' THEN dstip ELSE srcip END) as source, (CASE WHEN direction='incoming' THEN srcip ELSE dstip END) as victim, count(*) as totalnum from $log where $filter-exclude-var group by source, victim order by totalnum desc)### t where $filter-drilldown and victim is not null group by victim order by totalnum desc"
        set hidden enable
        set protected enable
    next
    edit "drilldown-Top-Attack-Source"
        set description "Drilldown top attack source"
        set log-type attack
        set query "select source, sum(totalnum) as totalnum from ###(select (CASE WHEN direction='incoming' THEN dstip ELSE srcip END) as source, (CASE WHEN direction='incoming' THEN srcip ELSE dstip END) as victim, count(*) as totalnum from $log where $filter-exclude-var group by source, victim order by totalnum desc)### t where $filter-drilldown and source is not null group by source order by totalnum desc"
        set hidden enable
        set protected enable
    next
    edit "drilldown-Top-Attack-List"
        set description "Drilldown top attack list"
        set log-type attack
        set query "select from_itime(itime) as timestamp, attack, source, victim from ###(select itime, attack, (CASE WHEN direction='incoming' THEN dstip ELSE srcip END) as source, (CASE WHEN direction='incoming' THEN srcip ELSE dstip END) as victim from $log where $filter-exclude-var order by itime desc)### t where $filter-drilldown order by timestamp desc"
        set hidden enable
        set protected enable
    next
    edit "drilldown-Virus-Detail"
        set description "Drilldown virus detail"
        set log-type virus
        set query "select from_itime(itime) as timestamp, virus, user_src, victim, hostname, recipient from ###(select itime, virus, coalesce(nullifna(`user`), ipstr((CASE WHEN direction='incoming' THEN dstip ELSE srcip END))) as user_src, (CASE WHEN direction='incoming' THEN srcip ELSE dstip END) as victim, cast(' ' as char) as hostname, cast(' ' as char) as recipient from $log where $filter and nullifna(virus) is not null order by itime desc)### t where $filter-drilldown order by timestamp desc"
        set hidden enable
        set protected enable
    next

    edit "user-drilldown-Top-Blocked-Web-Sites-By-Requests"
        set description "User drilldown top blocked web sites by requests"
        set log-type webfilter
        set query "select hostname, sum(requests) as requests from ###(select coalesce(nullifna(`user`), ipstr(`srcip`)) as usersrc, euid, hostname, catdesc, action, count(*) as requests from $log where $filter group by usersrc, euid, hostname, catdesc, action order by requests desc)### t where $filter-drilldown and action='blocked' and hostname is not null group by hostname order by requests desc"
            config variable
                edit "dldn_user"
                    set var-name "User (or Source IP)"
                    set var-expression "`user_src`"
                    set var-type string
                next
            end
        set hidden enable
        set protected enable
    next
    edit "user-drilldown-Top-Allowed-Web-Sites-By-Requests"
        set description "User drilldown top allowed web sites by requests"
        set log-type webfilter
        set query "select hostname, sum(requests) as requests from ###(select coalesce(nullifna(`user`), ipstr(`srcip`)) as usersrc, euid, hostname, catdesc, action, count(*) as requests from $log where $filter group by usersrc, euid, hostname, catdesc, action order by requests desc)### t where $filter-drilldown and action!='blocked' and hostname is not null group by hostname order by requests desc"
            config variable
                edit "dldn_user"
                    set var-name "User (or Source IP)"
                    set var-expression "`user_src`"
                    set var-type string
                next
            end
        set hidden enable
        set protected enable
    next
    edit "user-drilldown-Top-Blocked-Web-Categories"
        set description "User drilldown top blocked web categories"
        set log-type webfilter
        set query "select catdesc, sum(requests) as requests from ###(select coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, catdesc, action, count(*) as requests from $log where $filter and catdesc is not null group by user_src, catdesc, action order by requests desc)### t where $filter-drilldown and action='blocked' group by catdesc order by requests desc"
            config variable
                edit "dldn_user"
                    set var-name "User (or Source IP)"
                    set var-expression "`user_src`"
                    set var-type string
                next
            end
        set hidden enable
        set protected enable
    next
    edit "user-drilldown-Top-Allowed-Web-Categories"
        set description "User drilldown top allowed web categories"
        set log-type webfilter
        set query "select catdesc, sum(requests) as requests from ###(select coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, catdesc, action, count(*) as requests from $log where $filter and catdesc is not null group by user_src, catdesc, action order by requests desc)### t where $filter-drilldown and action!='blocked' group by catdesc order by requests desc"
            config variable
                edit "dldn_user"
                    set var-name "User (or Source IP)"
                    set var-expression "`user_src`"
                    set var-type string
                next
            end
        set hidden enable
        set protected enable
    next
    edit "user-drilldown-Top-Attacks-By-Name"
        set description "User drilldown top attacks by name"
        set log-type attack
        set query "select attack, sum(attack_count) as attack_count from ###(select coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, attack, (case when severity in ('critical', 'high') then 1 else 0 end) as high_severity, count(*) as attack_count from $log where $filter and nullifna(attack) is not null group by user_src, attack, high_severity order by attack_count desc)### t where $filter-drilldown group by attack order by attack_count desc"
            config variable
                edit "dldn_user"
                    set var-name "User (or Source IP)"
                    set var-expression "`user_src`"
                    set var-type string
                next
            end
        set hidden enable
        set protected enable
    next
    edit "user-drilldown-Top-Attacks-High-Severity"
        set description "User drilldown top attacks high severity"
        set log-type attack
        set query "select attack, sum(attack_count) as attack_count from ###(select coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, attack, (case when severity in ('critical', 'high') then 1 else 0 end) as high_severity, count(*) as attack_count from $log where $filter and nullifna(attack) is not null group by user_src, attack, high_severity order by attack_count desc)### t where $filter-drilldown and high_severity=1 group by attack order by attack_count desc"
            config variable
                edit "dldn_user"
                    set var-name "User (or Source IP)"
                    set var-expression "`user_src`"
                    set var-type string
                next
            end
        set hidden enable
        set protected enable
    next
    edit "user-drilldown-Top-Virus"
        set description "User drilldown top virus"
        set log-type virus 
        set query "select virus, max(virusid_s) as virusid, sum(totalnum) as totalnum from ###(select coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, virus, virusid_to_str(virusid, eventtype) as virusid_s, count(*) as totalnum from $log where $filter and nullifna(virus) is not null group by user_src, virus, virusid_s order by totalnum desc)### t where $filter-drilldown group by virus order by totalnum desc"
            config variable
                edit "dldn_user"
                    set var-name "User (or Source IP)"
                    set var-expression "`user_src`"
                    set var-type string
                next
            end
        set hidden enable
        set protected enable
    next
    edit "user-drilldown-Top-Virus-Receivers-Over-Email"
        set description "User drilldown top virus receivers over email"
        set log-type virus 
        set query "select receiver, sum(totalnum) as totalnum from ###(select coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, `to` as receiver, count(*) as totalnum from $log where $filter and subtype='infected' and (service in ('smtp', 'SMTP', '25/tcp', '587/tcp', 'smtps', 'SMTPS', '465/tcp') or service in ('pop3', 'POP3', '110/tcp', 'imap', 'IMAP', '143/tcp', 'imaps', 'IMAPS', '993/tcp', 'pop3s', 'POP3S', '995/tcp')) and nullifna(virus) is not null group by user_src, receiver order by totalnum desc)### t where $filter-drilldown group by receiver order by totalnum desc"
            config variable
                edit "dldn_user"
                    set var-name "User (or Source IP)"
                    set var-expression "`user_src`"
                    set var-type string
                next
            end
        set hidden enable
        set protected enable
    next
    edit "user-drilldown-Count-Spam-Activity-by-Hour-of-Day"
        set description "User drilldown count spam activity by hour of day"
        set log-type emailfilter
        set query "select $hour_of_day(timestamp) as hourstamp, sum(totalnum) as totalnum from ###(select $flex_timestamp as timestamp, coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, `from` as mf_sender, `to` as mf_receiver, action, eventtype, count(*) as totalnum from $log where $filter group by timestamp, user_src, mf_sender, mf_receiver, action, eventtype /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where $filter-drilldown and mf_receiver is not null and action in ('detected', 'blocked') group by hourstamp order by hourstamp"
            config variable
                edit "dldn_user"
                    set var-name "User (or Source IP)"
                    set var-expression "`user_src`"
                    set var-type string
                next
            end
        set hidden enable
        set protected enable
    next
    edit "user-drilldown-Top-Spam-Sources"
        set description "User drilldown top spam sources"
        set log-type emailfilter
        set query "select mf_sender, sum(totalnum) as totalnum from ###(select $flex_timestamp as timestamp, coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, `from` as mf_sender, `to` as mf_receiver, action, eventtype, count(*) as totalnum from $log where $filter group by timestamp, user_src, mf_sender, mf_receiver, action, eventtype /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where $filter-drilldown and mf_sender is not null and action in ('detected', 'blocked') group by mf_sender order by totalnum desc"
            config variable
                edit "dldn_user"
                    set var-name "User (or Source IP)"
                    set var-expression "`user_src`"
                    set var-type string
                next
            end
        set hidden enable
        set protected enable
    next

    edit "event-Usage-CPU"
        set description "Event usage CPU"
        set log-type event
        set query "select $hour_of_day(timestamp) as hourstamp, cast(sum(total_cpu)/sum(count) as decimal(6,2)) as cpu_avg_usage from ###(select $flex_timestamp as timestamp, devid, slot, sum(coalesce(trate, 0)) as total_trate, sum(coalesce(erate, 0)) as total_erate, sum(coalesce(orate, 0)) as total_orate, min(itime) as first_seen, max(itime) as last_seen, sum(coalesce(mem, 0)) as total_mem, max(coalesce(mem, 0)) as mem_peak, sum(coalesce(disk, 0)) as total_disk, max(coalesce(disk, 0)) as disk_peak, sum(coalesce(cpu, 0)) as total_cpu, max(coalesce(cpu, 0)) as cpu_peak, max(coalesce(trate, 0)+coalesce(erate, 0)+coalesce(orate, 0)) as lograte_peak, sum(coalesce(totalsession, 0)) as totalsession, max(coalesce(totalsession, 0)) as session_peak, sum(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)) as sent, sum(cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as recv, max(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)+cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as transmit_peak, sum(coalesce(setuprate, 0)) as cps, max(coalesce(setuprate, 0)) as cps_peak, count(*) as count from $log where $filter and subtype='system' and action='perf-stats' group by timestamp, devid, slot order by total_mem desc)### t group by hourstamp order by hourstamp"
        set protected enable
    next
    edit "event-Usage-Mem"
        set description "Event usage memory"
        set log-type event
        set query "select $hour_of_day(timestamp) as hourstamp, cast(sum(total_mem)/sum(count) as decimal(6,2)) as mem_avg_usage from ###(select $flex_timestamp as timestamp, devid, slot, sum(coalesce(trate, 0)) as total_trate, sum(coalesce(erate, 0)) as total_erate, sum(coalesce(orate, 0)) as total_orate, min(itime) as first_seen, max(itime) as last_seen, sum(coalesce(mem, 0)) as total_mem, max(coalesce(mem, 0)) as mem_peak, sum(coalesce(disk, 0)) as total_disk, max(coalesce(disk, 0)) as disk_peak, sum(coalesce(cpu, 0)) as total_cpu, max(coalesce(cpu, 0)) as cpu_peak, max(coalesce(trate, 0)+coalesce(erate, 0)+coalesce(orate, 0)) as lograte_peak, sum(coalesce(totalsession, 0)) as totalsession, max(coalesce(totalsession, 0)) as session_peak, sum(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)) as sent, sum(cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as recv, max(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)+cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as transmit_peak, sum(coalesce(setuprate, 0)) as cps, max(coalesce(setuprate, 0)) as cps_peak, count(*) as count from $log where $filter and subtype='system' and action='perf-stats' group by timestamp, devid, slot order by total_mem desc)### t group by hourstamp order by hourstamp"
        set protected enable
    next
    edit "event-Usage-Sessions"
        set description "Event usage sessions"
        set log-type event
        set query "select $hour_of_day(timestamp) as hourstamp, cast(sum(totalsession)/sum(count) as decimal(10,2)) as sess_avg_usage from ###(select $flex_timestamp as timestamp, devid, slot, sum(coalesce(trate, 0)) as total_trate, sum(coalesce(erate, 0)) as total_erate, sum(coalesce(orate, 0)) as total_orate, min(itime) as first_seen, max(itime) as last_seen, sum(coalesce(mem, 0)) as total_mem, max(coalesce(mem, 0)) as mem_peak, sum(coalesce(disk, 0)) as total_disk, max(coalesce(disk, 0)) as disk_peak, sum(coalesce(cpu, 0)) as total_cpu, max(coalesce(cpu, 0)) as cpu_peak, max(coalesce(trate, 0)+coalesce(erate, 0)+coalesce(orate, 0)) as lograte_peak, sum(coalesce(totalsession, 0)) as totalsession, max(coalesce(totalsession, 0)) as session_peak, sum(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)) as sent, sum(cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as recv, max(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)+cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as transmit_peak, sum(coalesce(setuprate, 0)) as cps, max(coalesce(setuprate, 0)) as cps_peak, count(*) as count from $log where $filter and subtype='system' and action='perf-stats' group by timestamp, devid, slot order by total_mem desc)### t group by hourstamp order by hourstamp"
        set protected enable
    next
    edit "event-Usage-CPU-Sessions"
        set description "Event usage CPU sessions"
        set log-type event
        set query "select $hour_of_day(timestamp) as hourstamp, cast(sum(totalsession)/sum(count) as decimal(10,2)) as sess_avg_usage, cast(sum(total_cpu)/sum(count) as decimal(6,2)) as cpu_avg_usage from ###(select $flex_timestamp as timestamp, devid, slot, sum(coalesce(trate, 0)) as total_trate, sum(coalesce(erate, 0)) as total_erate, sum(coalesce(orate, 0)) as total_orate, min(itime) as first_seen, max(itime) as last_seen, sum(coalesce(mem, 0)) as total_mem, max(coalesce(mem, 0)) as mem_peak, sum(coalesce(disk, 0)) as total_disk, max(coalesce(disk, 0)) as disk_peak, sum(coalesce(cpu, 0)) as total_cpu, max(coalesce(cpu, 0)) as cpu_peak, max(coalesce(trate, 0)+coalesce(erate, 0)+coalesce(orate, 0)) as lograte_peak, sum(coalesce(totalsession, 0)) as totalsession, max(coalesce(totalsession, 0)) as session_peak, sum(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)) as sent, sum(cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as recv, max(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)+cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as transmit_peak, sum(coalesce(setuprate, 0)) as cps, max(coalesce(setuprate, 0)) as cps_peak, count(*) as count from $log where $filter and subtype='system' and action='perf-stats' group by timestamp, devid, slot order by total_mem desc)### t group by hourstamp order by hourstamp"
        set protected enable
    next

    edit "bandwidth-app-Top-Users-By-Bandwidth"
        set description "Bandwidth application top users by bandwidth usage"
        set log-type traffic
        set query "select user_src, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###(select user_src, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(bandwidth) as bandwidth, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t group by user_src order by sessions desc, bandwidth desc)### t group by user_src having sum(bandwidth)>0 order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "bandwidth-app-Traffic-By-Active-User-Number"
        set description "Bandwidth application traffic by active user number"
        set log-type traffic
        set query "select $flex_timescale(timestamp) as hodex, count(distinct user_src) as total_user from ###(select $flex_timestamp as timestamp, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) AS sessions from $log where $filter and (logflag&(1|32)>0) group by timestamp, user_src order by sessions desc)### t group by hodex order by hodex"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "bandwidth-app-Top-Dest-By-Bandwidth-Sessions"
        set description "Bandwidth application top dest by bandwidth usage sessions"
        set log-type traffic
        set query "select coalesce(nullifna(root_domain(hostname)), ipstr(`dstip`)) as dst, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(bandwidth) as bandwidth, sum(sessions) as sessions from ###(select hostname, dstip, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(bandwidth) as bandwidth, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t group by hostname, dstip order by sessions desc, bandwidth desc)### t group by dst order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "bandwidth-app-Top-Policies-By-Bandwidth-Sessions"
        set description "Top policies by bandwidth and sessions"
        set log-type traffic
        set query "select coalesce(pol.name, cast(policyid as text)) as polid, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###(select policyid, poluuid, sum(coalesce(rcvddelta, rcvdbyte, 0) + coalesce(sentdelta, sentbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log where $filter and (logflag&(1|32)>0) group by policyid, poluuid order by bandwidth desc)### t1 left join $ADOMTBL_PLHD_POLINFO pol on t1.poluuid=pol.uuid group by polid order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "bandwidth-app-Traffic-Statistics"
        set description "Bandwidth application traffic statistics"
        set log-type traffic
        set query "drop table if exists rpt_tmptbl_1; create temporary table rpt_tmptbl_1(total_sessions varchar(255), total_bandwidth varchar(255), ave_session varchar(255), ave_bandwidth varchar(255), active_date varchar(255), total_users varchar(255), total_app varchar(255), total_dest varchar(255)); insert into rpt_tmptbl_1 (total_sessions, total_bandwidth, ave_session, ave_bandwidth) select format_numeric_no_decimal(sum(sessions)) as total_sessions, bandwidth_unit(sum(bandwidth)) as total_bandwidth, format_numeric_no_decimal(cast(sum(sessions)/$days_num as decimal(18, 0))) as ave_session, bandwidth_unit(cast(sum(bandwidth)/$days_num as decimal(18, 0))) as ave_bandwidth from ###(select appid, app, appcat, apprisk, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(bandwidth) as bandwidth, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t group by appid, app, appcat, apprisk /*SkipSTART*/order by sessions desc, bandwidth desc/*SkipEND*/)### t; update rpt_tmptbl_1 set active_date=t1.dom from (select dom, sum(sessions) as sessions from ###(select $DAY_OF_MONTH as dom, count(*) as sessions from $log where $filter and (logflag&(1|32)>0) group by dom order by sessions desc)### t group by dom order by sessions desc limit 1) as t1; update rpt_tmptbl_1 set total_users=t2.totalnum from (select format_numeric_no_decimal(count(distinct(user_src))) as totalnum from ###(select user_src, sum(sessions) as count from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t group by user_src order by count desc)### t) as t2; update rpt_tmptbl_1 set total_app=t3.totalnum from (select format_numeric_no_decimal(count(distinct(app_grp))) as totalnum from ###(select app_group_name(app) as app_grp, sum(sessions) as count from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t group by app_grp order by count desc)### t) as t3; update rpt_tmptbl_1 set total_dest=t4.totalnum from (select format_numeric_no_decimal(count(distinct(dstip))) as totalnum from ###(select dstip, sum(sessions) as count from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t where dstip is not null group by dstip order by count desc)### t ) as t4; select 'Total Sessions' as summary, total_sessions as stats from rpt_tmptbl_1 union all select 'Total Bytes Transferred' as summary, total_bandwidth as stats from rpt_tmptbl_1 union all select 'Most Active Date By Sessions' as summary, active_date as stats from rpt_tmptbl_1 union all select 'Total Users' as summary, total_users as stats from rpt_tmptbl_1 union all select 'Total Applications' as summary, total_app as stats from rpt_tmptbl_1 union all select 'Total Destinations' as summary, total_dest as stats from rpt_tmptbl_1 union all select 'Average Sessions Per Day' as summary, ave_session as stats from rpt_tmptbl_1 union all select 'Average Bytes Per Day' as summary, ave_bandwidth as stats from rpt_tmptbl_1"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "bandwidth-app-Detailed-Traffic-Statistics"
        set description "Detailed Bandwidth Application Traffic Statistics"
        set log-type traffic
        set query "select count(distinct app) as total_app, count(distinct appcat) as total_appcat, count(distinct user_src) as total_users, count(distinct epid) as total_endpoint, count(distinct dstip) as total_dest, sum(bandwidth) as total_bandwidth, sum(sessions) as total_sessions, cast(sum(sessions)/$days_num as decimal(18, 0)) as ave_session, cast(sum(bandwidth)/$days_num as decimal(18, 0)) as ave_bandwidth from ###(select app, appcat, epid, dstip, user_src, sum(bandwidth) as bandwidth, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t group by app, appcat, epid, dstip, user_src order by sessions desc, bandwidth desc)### t"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "bandwidth-app-App-Category-by-Avg-Bandwidth"
        set description "Application Category with Most Average Bandwidth Used"
        set log-type traffic
        set query "select appcat, cast(sum(bandwidth)/$days_num as decimal(18, 0)) as ave_bandwidth from ###(select app, appcat, user_src, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(bandwidth) as bandwidth, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t group by app, appcat, user_src /*SkipSTART*/order by bandwidth desc, sessions desc/*SkipEND*/)### t group by appcat order by ave_bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "bandwidth-app-Most-Active-Date-by-Sessions"
        set description "Most Active Date by Sessions"
        set log-type traffic
        set query "select dom as active_date, sum(sessions) as sessions from ###(select $DAY_OF_MONTH as dom, count(*) as sessions from $log where $filter and (logflag&1>0) group by dom order by sessions desc)### t group by active_date order by sessions desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "bandwidth-app-Top-App-Bandwidth-Usage"
        set description "Top Application by Bandwidth"
        set log-type traffic
        set query "select app, appcat, count(distinct user_src) as num_user, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(bandwidth) as bandwidth, sum(sessions) as sessions from ###(select app, appcat, user_src, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(bandwidth) as bandwidth, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t group by app, appcat, user_src /*SkipSTART*/order by bandwidth desc, sessions desc/*SkipEND*/)### t where $filter-drilldown group by app, appcat having sum(bandwidth) > 0 order by bandwidth desc, sessions desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "bandwidth-app-Bandwidth-Usage-Timeline"
        set description "Application Traffic Usage Timeline"
        set log-type traffic
        set query "select $flex_timescale(timestamp) as hodex, sum(traffic_out) as traffic_out, sum(traffic_in) as traffic_in from ###(select $flex_timestamp as timestamp, appid, app, appcat, apprisk, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, appid, app, appcat, apprisk /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where $filter-drilldown group by hodex having sum(bandwidth)>0 order by hodex"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next


    edit "App-Risk-Top-User-Source-By-Sessions"
        set description "Application risk top user source by session count"
        set log-type traffic
        set query "select srcip, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, count(*) as sessions from $log where $filter and (logflag&1>0) and srcip is not null group by srcip, user_src order by sessions desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "App-Risk-Reputation-Top-Users-By-Scores"
        set description "Application risk reputation top users by scores"
        set log-type traffic
        set query "select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(crscore%65536) as scores from $log where $filter and (logflag&1>0) and crscore is not null group by user_src having sum(crscore%65536)>0 order by scores desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
    set protected enable
    next
    edit "App-Risk-Reputation-Top-Devices-By-Scores"
        set description "Application risk reputation top devices by scores"
        set log-type traffic
        set query "select max(get_devtype(srcswversion, osname, devtype)) as devtype_new, coalesce(nullifna(`srcname`),nullifna(`srcmac`), ipstr(`srcip`)) as dev_src,  sum(crscore%65536) as scores from $log where $filter and (logflag&1>0) and crscore is not null group by dev_src having sum(crscore%65536)>0 order by scores desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
    set protected enable
    next
    edit "App-Risk-App-Usage-By-Category"
        set description "Application Risk Application Usage by Category"
        set log-type traffic
        set query "select appcat, app, sum(bandwidth) as bandwidth from ###(select app, appcat, user_src, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(bandwidth) as bandwidth, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t group by app, appcat, user_src /*SkipSTART*/order by bandwidth desc, sessions desc/*SkipEND*/)### t group by appcat, app order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
    set protected enable
    next
    edit "App-Risk-Application-Activity-APP"
        set description "Application risk application activity"
        set log-type traffic
        set query "select app_group, appcat, sum(bandwidth) as bandwidth, sum(sessions) as num_session from ###(select app_group_name(app) as app_group, appcat, service, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by app_group, appcat, service order by bandwidth desc)### t group by app_group, appcat order by bandwidth desc "
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
    set protected enable
    next
    edit "App-Risk-Applications-Running-Over-HTTP"
        set description "Application risk applications running over HTTP"
        set log-type traffic
        set query "select app_group, service, sum(sessions) as sessions, sum(bandwidth) as bandwidth from ###(select app_group_name(app) as app_group, appcat, service, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by app_group, appcat, service order by bandwidth desc)### t where service in ('80/tcp', '443/tcp', 'HTTP', 'HTTPS', 'http', 'https') group by app_group, service having sum(bandwidth)>0 order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
    set protected enable
    next
    edit "App-Risk-Web-Browsing-Summary-Category"
        set description "Application risk web browsing summary category"
        set log-type traffic
        set query "select catdesc, sum(num_sess) as num_sess, sum(bandwidth) as bandwidth from ###(select catdesc, count(*) as num_sess, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log-traffic where $filter and (logflag&1>0) and (countweb>0 or ((logver is null or logver<502000000) and (hostname is not null or utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter')))) and catdesc is not null group by catdesc order by num_sess desc)### t group by catdesc order by num_sess desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
    set protected enable
    next
    edit "App-Risk-Web-Browsing-Activity-Hostname-Category"
        set description "Application risk web browsing activity hostname category"
        set log-type webfilter
        set query "select domain, catdesc, sum(visits) as visits from ###(select coalesce(nullifna(hostname), ipstr(`dstip`)) as domain, catdesc, count(*) as visits from $log where $filter and catdesc is not null group by domain, catdesc order by visits desc)### t group by domain, catdesc order by visits desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
    set protected enable
    next
    edit "App-Risk-Top-Threat-Vectors"
        set description "Application risk top threat vectors"
        set log-type attack
        set query "select severity, sum(totalnum) as totalnum from ###(select attack, severity, ref, count(*) as totalnum from $log where $filter and nullifna(attack) is not null group by attack, severity, ref order by totalnum desc)### t group by severity order by totalnum desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
    set protected enable
    next
    edit "App-Risk-Top-Critical-Threat-Vectors"
        set description "Application risk top critical threat vectors"
        set log-type attack
        set query "select attack, severity, ref, sum(totalnum) as totalnum from ###(select attack, severity, ref, count(*) as totalnum from $log where $filter and nullifna(attack) is not null group by attack, severity, ref order by totalnum desc)### t where severity='critical' group by attack, severity, ref order by totalnum desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
    set protected enable
    next
    edit "App-Risk-Top-High-Threat-Vectors"
        set description "Application risk top high threat vectors"
        set log-type attack
        set query "select attack, severity, ref, sum(totalnum) as totalnum from ###(select attack, severity, ref, count(*) as totalnum from $log where $filter and nullifna(attack) is not null group by attack, severity, ref order by totalnum desc)### t where severity='high' group by attack, severity, ref order by totalnum desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
    set protected enable
    next
    edit "App-Risk-Top-Medium-Threat-Vectors"
        set description "Application risk top medium threat vectors"
        set log-type attack
        set query "select attack, severity, ref, sum(totalnum) as totalnum from ###(select attack, severity, ref, count(*) as totalnum from $log where $filter and nullifna(attack) is not null group by attack, severity, ref order by totalnum desc)### t where severity='medium' group by attack, severity, ref order by totalnum desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
    set protected enable
    next
    edit "App-Risk-Top-Low-Threat-Vectors"
        set description "Application risk top low threat vectors"
        set log-type attack
        set query "select attack, severity, ref, sum(totalnum) as totalnum from ###(select attack, severity, ref, count(*) as totalnum from $log where $filter and nullifna(attack) is not null group by attack, severity, ref order by totalnum desc)### t where severity='low' group by attack, severity, ref order by totalnum desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
    set protected enable
    next
    edit "App-Risk-Top-Info-Threat-Vectors"
        set description "Application risk top info threat vectors"
        set log-type attack
        set query "select attack, severity, ref, sum(totalnum) as totalnum from ###(select attack, severity, ref, count(*) as totalnum from $log where $filter and nullifna(attack) is not null group by attack, severity, ref order by totalnum desc)### t where severity='info' group by attack, severity, ref order by totalnum desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
    set protected enable
    next
    edit "App-Risk-DLP-UTM-Event"
        set description "Application risk DLP UTM event"
        set log-type dlp
        set query "select subtype::text as utmsubtype, count(*) as number from ###(select itime, hostname,`from` as sender, `to` as receiver, profile, action, service, subtype, srcip, dstip, severity, filename, direction, filesize, (case when severity='critical' then 'Critical Data Exfiltration' else (case when coalesce(nullifna(`user`), ipstr(`srcip`)) is not null then 'User Associated Data Loss' else NULL end) end) as data_loss from $log where $filter /*SkipSTART*/order by itime desc/*SkipEND*/)### t where $filter-drilldown and subtype is not null group by subtype order by number desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
    set protected enable
    next
    edit "App-Risk-Vulnerability-Discovered"
        set description "Application risk vulnerability discovered"
        set log-type netscan
        set query "select vuln, vulnref as ref, vulncat, severity, count(*) as totalnum from $log where $filter and vuln is not null group by vuln, vulnref, vulncat, severity order by totalnum desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "App-Risk-Virus-Discovered"
        set description "Application risk virus discovered"
        set log-type virus
        set query "select dom, sum(totalnum) as totalnum from ###(select $DAY_OF_MONTH as dom, count(*) as totalnum from $log where $filter and nullifna(virus) is not null group by dom order by totalnum desc)### t group by dom order by totalnum desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
    set protected enable
    next
    edit "App-Risk-Breakdown-Of-Risk-Applications"
        set description "Application risk breakdown of risk applications"
        set log-type traffic
        set query "select unnest(string_to_array(behavior, ',')) as d_behavior, count(*) as number from $log t1 inner join app_mdata t2 on t1.appid=t2.id where $filter and (logflag&1>0) group by d_behavior order by number desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
    set protected enable
    next
    edit "App-Risk-Number-Of-Applications-By-Risk-Behavior"
        set description "Application risk number of applications by risk behavior"
        set log-type traffic
        set query "select risk as d_risk, unnest(string_to_array(behavior, ',')) as f_behavior, count(*) as number from $log t1 inner join app_mdata t2 on t1.appid=t2.id where $filter and (logflag&1>0) group by risk, f_behavior order by risk desc, number desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
    set protected enable
    next
    edit "App-Risk-High-Risk-Application"
        set description "Application risk high risk application"
        set log-type traffic
        set query "select risk as d_risk, behavior as d_behavior, t2.id, t2.name, t2.app_cat, t2.technology, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, count(*) as sessions from $log t1 inner join app_mdata t2 on t1.appid=t2.id where $filter and (logflag&1>0) and behavior is not null group by t2.id order by risk desc, sessions desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
    set protected enable
    next

    edit "appctrl-Top-Blocked-SCCP-Callers"
        set description "Appctrl top blocked SCCP callers"
        set log-type app-ctrl
        set query "select caller, sum(totalnum) as totalnum from ###(select srcname as caller, app, count(*) as totalnum from $log where $filter and srcname is not null and lower(appcat)='voip' and action='block' group by caller, app order by totalnum desc)### t where app='sccp' group by caller order by totalnum desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "appctrl-Top-Blocked-SIP-Callers"
        set description "Appctrl top blocked SIP callers"
        set log-type app-ctrl
        set query "select caller, sum(totalnum) as totalnum from ###(select srcname as caller, app, count(*) as totalnum from $log where $filter and srcname is not null and lower(appcat)='voip' and action='block' group by caller, app order by totalnum desc)### t where app='sip' group by caller order by totalnum desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next

    edit "content-Count-Total-SCCP-Call-Registrations-by-Hour-of-Day"
        set description "Content count total SCCP call registrations by hour of day"
        set log-type content
        set query "select hourstamp, count(totalnum) as totalnum from ###(select $hour_of_day as hourstamp, proto, kind, status, sum(duration) as sccp_usage, count(*) as totalnum from $log-content where $filter group by hourstamp, proto, kind, status order by totalnum desc)### t where proto='sccp' and kind='register' group by hourstamp order by hourstamp"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "content-Count-Total-SCCP-Calls-Duration-by-Hour-of-Day"
        set description "Content count total SCCP calls duration by hour of day"
        set log-type content
        set query "select hourstamp, sum(sccp_usage) as sccp_usage from ###(select $hour_of_day as hourstamp, proto, kind, status, sum(duration) as sccp_usage, count(*) as totalnum from $log-content where $filter group by hourstamp, proto, kind, status order by totalnum desc)### t where proto='sccp' and kind='call-info' and status='end' group by hourstamp order by hourstamp"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "content-Count-Total-SCCP-Calls-per-Status"
        set description "Content count total SCCP calls per status"
        set log-type content
        set query "select status, count(totalnum) as totalnum from ###(select $hour_of_day as hourstamp, proto, kind, status, sum(duration) as sccp_usage, count(*) as totalnum from $log-content where $filter group by hourstamp, proto, kind, status order by totalnum desc)### t where proto='sccp' and kind='call-info' group by status order by totalnum desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "content-Count-Total-SIP-Call-Registrations-by-Hour-of-Day"
        set description "Content count total SIP call registrations by hour of day"
        set log-type content
        set query "select hourstamp, count(totalnum) as totalnum from ###(select $hour_of_day as hourstamp, proto, kind, status, sum(duration) as sccp_usage, count(*) as totalnum from $log-content where $filter group by hourstamp, proto, kind, status order by totalnum desc)### t where proto='sip' and kind='register' group by hourstamp order by hourstamp"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "content-Count-Total-SIP-Calls-per-Status"
        set description "Content count total SIP calls per status"
        set log-type content
        set query "select status, count(totalnum) as totalnum from ###(select $hour_of_day as hourstamp, proto, kind, status, sum(duration) as sccp_usage, count(*) as totalnum from $log-content where $filter group by hourstamp, proto, kind, status order by totalnum desc)### t where proto='sip' and kind='call' group by status order by totalnum desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "content-Dist-Total-SIP-Calls-by-Duration"
        set description "Content dist total SIP calls by duration"
        set log-type content
        set query "select (case when duration < 60 then 'LESS_ONE_MIN' when duration < 600 then 'LESS_TEN_MIN' when duration < 3600 then 'LESS_ONE_HOUR' when duration >= 3600 then 'MORE_ONE_HOUR' else 'unknown' end) as f_duration, count(*) as totalnum from $log where $filter and proto='sip' and kind='call' and status='end' group by f_duration order by totalnum desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next

    edit "Botnet-Activity-By-Sources"
        set description "Botnet activity by sources"
        set log-type traffic
        set query "select app, user_src, sum(events) as events from ((select app, user_src, sum(totalnum) as events from  ###(select app, appcat, apprisk, srcip, dstip, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, count(*) as totalnum from $log-traffic where $filter and (logflag&1>0) and appcat='Botnet' and nullifna(app) is not null group by app, appcat, apprisk, srcip, dstip, user_src order by totalnum desc)### t group by app, user_src order by events desc) union all (select attack, user_src, sum(totalnum) as events from ###(select attack, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, $flex_timestamp as timestamp, hostname, severity, crlevel, eventtype, service, dstip, srcip, count(*) as totalnum from $log-attack where $filter and (logflag&16>0) group by attack, user_src, timestamp, hostname, severity, crlevel, eventtype, service, dstip, srcip order by timestamp desc)### t group by attack, user_src order by events desc)) t group by app, user_src order by events desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "Botnet-Infected-Hosts"
        set description "Botnet infected hosts"
        set log-type traffic
        set query "select user_src, devtype_new, host_mac, sum(events) as events from (###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, get_devtype(srcswversion, osname, devtype) as devtype_new, coalesce(srcname, srcmac) as host_mac, count(*) as events from $log-traffic where $filter and (logflag&1>0) and appcat='Botnet' group by user_src, devtype_new, host_mac order by events desc)### union all ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, 'Unknown' as devtype_new, hostname as host_mac, count(*) as events from $log-attack where $filter and (logflag&16>0) group by user_src, devtype_new, host_mac order by events desc)###) t group by user_src, devtype_new, host_mac order by events desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "Detected-Botnet"
        set description "Detected botnet"
        set log-type traffic
        set query "select app, sum(events) as events from ((select app, sum(totalnum) as events from  ###(select app, appcat, apprisk, srcip, dstip, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, count(*) as totalnum from $log-traffic where $filter and (logflag&1>0) and appcat='Botnet' and nullifna(app) is not null group by app, appcat, apprisk, srcip, dstip, user_src order by totalnum desc)### t group by app order by events desc) union all (select attack, sum(totalnum) as events from ###(select attack, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, $flex_timestamp as timestamp, hostname, severity, crlevel, eventtype, service, dstip, srcip, count(*) as totalnum from $log-attack where $filter and (logflag&16>0) group by attack, user_src, timestamp, hostname, severity, crlevel, eventtype, service, dstip, srcip order by timestamp desc)### t group by attack order by events desc)) t group by app order by events desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "Botnet-Sources"
        set description "Botnet sources"
        set log-type traffic
        set query "select dstip, domain, sum(events) as events from ((select dstip, domain, sum(events) as events from ###(select dstip, root_domain(hostname) as domain, count(*) as events from $log-traffic where $filter and (logflag&1>0) and appcat='Botnet' and dstip is not null group by dstip, domain order by events desc)### t group by dstip, domain) union all (select dstip, root_domain(hostname) as domain, sum(totalnum) as events from ###(select attack, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, $flex_timestamp as timestamp, hostname, severity, crlevel, eventtype, service, dstip, srcip, count(*) as totalnum from $log-attack where $filter and (logflag&16>0) group by attack, user_src, timestamp, hostname, severity, crlevel, eventtype, service, dstip, srcip order by timestamp desc)### t group by dstip, domain)) t group by dstip, domain order by events desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "Botnet-Victims"
        set description "Botnet victims"
        set log-type traffic
        set query "select user_src, sum(events) as events from ((select user_src, sum(totalnum) as events from ###(select app, appcat, apprisk, srcip, dstip, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, count(*) as totalnum from $log-traffic where $filter and (logflag&1>0) and appcat='Botnet' and nullifna(app) is not null group by app, appcat, apprisk, srcip, dstip, user_src order by totalnum desc)### t group by user_src) union all (select user_src, sum(totalnum) as events from ###(select attack, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, $flex_timestamp as timestamp, hostname, severity, crlevel, eventtype, service, dstip, srcip, count(*) as totalnum from $log-attack where $filter and (logflag&16>0) group by attack, user_src, timestamp, hostname, severity, crlevel, eventtype, service, dstip, srcip order by timestamp desc)### t group by user_src)) t group by user_src order by events desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next

    edit "Botnet-Timeline"
        set description "Botnet timeline"
        set log-type traffic
        set query "select $flex_datetime(timestamp) as hodex, sum(events) as events from (###(select $flex_timestamp as timestamp, count(*) as events from $log-traffic where $filter and (logflag&1>0) and appcat='Botnet' group by timestamp order by timestamp desc)### union all ###(select $flex_timestamp as timestamp, count(*) as events from $log-dns where $filter and (botnetdomain is not null or botnetip is not null) group by timestamp order by timestamp)### union all ###(select $flex_timestamp as timestamp, count(*) as events from $log-attack where $filter and (logflag&16>0) group by timestamp order by timestamp)###) t group by hodex order by hodex"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next


    edit "Detailed-Application-Usage"
        set description "Detailed application usage"
        set log-type traffic
        set query "select appid, app, appcat, (case when (utmaction in ('block', 'blocked') or action='deny') then 'Blocked' else 'Allowed' end) as custaction, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth,count(*) as num_session from $log where $filter and (logflag&1>0) and nullifna(app) is not null and policyid != 0 group by appid,app, appcat,custaction order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next

    edit "Application-Session-History"
        set description "Application session history"
        set log-type traffic
        set query "select $flex_timescale(timestamp) as hodex, sum(counter) as counter from ###(select $flex_timestamp as timestamp, count(*) as counter from $log where $filter and (logflag&1>0) group by timestamp order by timestamp desc)### t group by hodex order by hodex"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next

    edit "App-Sessions-By-Category"
        set description "Application sessions by category"
        set log-type traffic
        set query "select appcat, count(*) as sessions from $log where $filter and (logflag&1>0) and nullifna(appcat) is not null group by appcat order by sessions desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next

    edit "Top-P2P-App-By-Sessions"
        set description "Top P2P applications by session count"
        set log-type traffic
        set query "select app_group, sum(sessions) as sessions from ###(select app_group_name(app) as app_group, appcat, service, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by app_group, appcat, service order by bandwidth desc)### t where lower(appcat)='p2p' group by app_group order by sessions desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
                edit "appcat"
                    set var-name "appcat"
                next
            end
        set protected enable
    next

    edit "Top-P2P-App-By-Bandwidth"
        set description "Top P2P applications by bandwidth usage"
        set log-type traffic
        set query "select app_group, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###(select app_group_name(app) as app_group, appcat, service, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by app_group, appcat, service order by bandwidth desc)### t where lower(appcat)='p2p' group by app_group having sum(bandwidth)>0 order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
                edit "appcat"
                    set var-name "appcat"
                next
            end
        set protected enable
    next

    edit "High-Risk-Application-By-Bandwidth"
        set description "High risk application by bandwidth usage"
        set log-type traffic
        set query "select t2.name, behavior as d_behavior, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log t1 inner join app_mdata t2 on t1.appid=t2.id where $filter and (logflag&1>0) and behavior is not null group by t2.name, behavior order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
    set protected enable
    next

    edit "High-Risk-Application-By-Sessions"
        set description "High risk application by session count"
        set log-type traffic
        set query "select t2.name, behavior as d_behavior, count(*) as sessions from $log t1 inner join app_mdata t2 on t1.appid=t2.id where $filter and (logflag&1>0) and behavior is not null group by t2.name, behavior order by sessions desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
    set protected enable
    next

    edit "Top-Web-Sites-by-Bandwidth"
        set description "Top web sites by bandwidth usage"
        set log-type webfilter
        set query "select domain, sum(bandwidth) as bandwidth from ###(select coalesce(nullifna(hostname), ipstr(`dstip`)) as domain, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log-traffic where $filter and (logflag&1>0) and (countweb>0 or ((logver is null or logver<502000000) and (hostname is not null or utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter')))) group by domain having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc)### t group by domain order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next

    edit "Top-Web-Sites-by-Sessions"
        set description "Top web sites by session count"
        set log-type webfilter
        set query "select domain, sum(sessions) as sessions from ###(select  coalesce(nullifna(hostname), ipstr(`dstip`)) as domain, count(*) as sessions from $log where $filter group by domain order by sessions desc)### t group by domain order by sessions desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next

    edit "Top-Web-Category-by-Bandwidth"
        set description "Top web category by bandwidth usage"
        set log-type webfilter
        set query "select catdesc, sum(bandwidth) as bandwidth from ###(select catdesc, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log-traffic where $filter and (logflag&1>0) and (countweb>0 or ((logver is null or logver<502000000) and (hostname is not null or utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter')))) and catdesc is not null group by catdesc having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc)### t group by catdesc order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next

    edit "Top-Web-Category-by-Sessions"
        set description "Top web category by session count"
        set log-type webfilter
        set query "select catdesc, sum(sessions) as sessions from ###(select catdesc, count(*) as sessions from $log where $filter group by catdesc order by sessions desc)### t group by catdesc order by sessions desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next

    edit "Total-Attack-Source"
        set description "Total attack source"
        set log-type attack
        set query "select count(*) as totalnum from $log where $filter"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next

    edit "Total-Number-of-Viruses"
        set description "Total number of viruses"
        set log-type virus
        set query "select sum(totalnum) as totalnum from ###(select count(*) as totalnum from $log where $filter and nullifna(virus) is not null order by totalnum desc)### t"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next

    edit "Total-Number-of-Botnet-Events"
        set description "Total number of botnet events"
        set log-type traffic
        set query "select sum(events) as events from (###(select count(*) as events from $log-traffic where $filter and (logflag&1>0) and lower(appcat)='botnet' and nullifna(app) is not null)### union all ###(select count(*) as events from $log-virus  where $filter and nullifna(virus) is not null)### union all ###(select count(*) as events from $log-attack where $filter and (logflag&16>0))###) t"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next

    edit "Botnet-and-Malware-Infections"
        set description "Botnet and Malware Infections"
        set log-type app-ctrl
        set query "select count(distinct malware) as events from (###(select app as malware from $log-app-ctrl where $filter and lower(appcat)='botnet' and nullifna(app) is not null group by app)### union all ###(select virus as malware from $log-virus where $filter and nullifna(virus) is not null group by virus)### union all ###(select attack as malware from $log-attack where $filter and (logflag&16>0) group by attack)###) t"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next

    edit "Total-Number-of-Botnet-Infections"
        set description "Total number of botnet infections"
        set log-type traffic
        set query "select count(distinct app) as app_num from ((select app from ###(select app, appcat, apprisk, srcip, dstip, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, count(*) as totalnum from $log-traffic where $filter and (logflag&1>0) and appcat='Botnet' and nullifna(app) is not null group by app, appcat, apprisk, srcip, dstip, user_src order by totalnum desc)### t where apprisk in ('critical', 'high') group by app) union all (select attack from ###(select attack, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, $flex_timestamp as timestamp, hostname, severity, crlevel, eventtype, service, dstip, srcip, count(*) as totalnum from $log-attack where $filter and (logflag&16>0) group by attack, user_src, timestamp, hostname, severity, crlevel, eventtype, service, dstip, srcip order by timestamp desc)### t group by attack)) t"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next

    edit "Total-Number-of-Evasive-Applications"
        set description "Total number of evasive applications"
        set log-type traffic
        set query "select count(distinct app) as number from (select distinct app from ###(select appid, app, appcat, apprisk, sum(bandwidth) as bandwidth, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t group by appid, app, appcat, apprisk /*SkipSTART*/order by sessions desc, bandwidth desc/*SkipEND*/)### t where $filter-drilldown) t1 inner join app_mdata t2 on t1.app=t2.name and behavior like '%Evasive%'"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next

    edit "Total-Number-of-P2P-Applications"
        set description "Total number of P2P applications"
        set log-type traffic
        set query "select count(distinct app) as number from ###(select appid, app, appcat, apprisk, sum(bandwidth) as bandwidth, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t group by appid, app, appcat, apprisk /*SkipSTART*/order by sessions desc, bandwidth desc/*SkipEND*/)### t where $filter-drilldown and appcat='P2P'"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next

    edit "Total-Number-of-Bandwidth-Consuming-Applications"
        set description "Total number of bandwidth consuming applications"
        set log-type traffic
        set query "select count(distinct app) as number from ###(select appid, app, appcat, apprisk, sum(bandwidth) as bandwidth, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t group by appid, app, appcat, apprisk /*SkipSTART*/order by sessions desc, bandwidth desc/*SkipEND*/)### t where $filter-drilldown and appcat in ('Video/Audio', 'Storage.Backup', 'Game', 'VoIP')"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next

    edit "security-App-Visibility-Control-Summary"
        set description "Application Visibolity and Control Summary"
        set log-type app-ctrl
        set query "select appcat, count(distinct app) as total_num from ###(select appcat, app from $log where $filter and app is not null and appcat is not null group by appcat, app)### t group by appcat order by total_num desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next

    edit "security-Data-Exfiltration-Summary"
        set description "Data Exfiltration Summary"
        set log-type dlp
        set query "select data_loss, count(*) as total_num from ###(select itime, hostname,`from` as sender, `to` as receiver, profile, action, service, subtype, srcip, dstip, severity, filename, direction, filesize, (case when severity='critical' then 'Critical Data Exfiltration' else (case when coalesce(nullifna(`user`), ipstr(`srcip`)) is not null then 'User Associated Data Loss' else NULL end) end) as data_loss from $log where $filter /*SkipSTART*/order by itime desc/*SkipEND*/)### t where $filter-drilldown and data_loss is not null group by data_loss order by total_num desc"
        set protected enable
    next
    edit "security-Endpoint-Protection"
        set description "Endpoint Protection"
        set log-type fct-traffic
        set query "select blocked_event, count(*) as total_num from (select (case utmevent when 'antivirus' then 'Malware Deteced and Blocked' when 'appfirewall' then 'Risk Application Blocked' when 'webfilter' then (case when coalesce(nullifna(`user`),  ipstr(`srcip`)) is not null then 'Web Sites Violation Blocked' else 'Non User Initiated Web Visits' end) else NULL end) as blocked_event from $log where $filter and utmaction in ('blocked', 'quarantined')) t where blocked_event is not null group by blocked_event order by total_num desc"
        set protected enable
    next

    edit "security-High-Risk-Application-In-Use"
        set description "High risk application in use"
        set log-type traffic
        set query "select d_risk, count(distinct f_user) as users, name, app_cat, technology, sum(bandwidth) as bandwidth, sum(sessions) as sessions from ###(select risk as d_risk, coalesce(nullifna(t1.`user`), nullifna(t1.`unauthuser`), ipstr(t1.`srcip`)) as f_user, t2.name, t2.app_cat, t2.technology, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth,  count(*) as sessions from $log t1 inner join app_mdata t2 on t1.appid=t2.id where $filter and risk>='4' and (logflag&1>0) group by f_user, t2.name, t2.app_cat, t2.technology, risk)### t group by d_risk, name, app_cat, technology order by d_risk desc, sessions desc" 
        set protected enable
    next
    edit "security-High-Risk-Application-By-Category"
        set description "High risk application by category"
        set log-type traffic
        set query "select app_cat, count(distinct app) as total_num from ###(select app_cat, app from $log t1 inner join app_mdata t2 on t1.appid=t2.id where $filter and risk>='4' and (logflag&1>0) group by app_cat, app)### t group by app_cat order by total_num desc"
        set protected enable
    next

    edit "security-Web-Applications-By-Bandwidth"
        set description "Top Web Applications by Bandwidth"
        set log-type traffic
        set query "select risk as d_risk, t2.name, t2.app_cat, t2.technology, count(distinct f_user) as users, sum(bandwidth) as bandwidth, sum(num_session) as sessions from ###(select appid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as f_user, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, count(*) as num_session from $log where $filter and (logflag&1>0) and nullifna(app) is not null and service in ('80/tcp', '443/tcp', 'HTTP', 'HTTPS', 'http', 'https') group by appid, f_user order by bandwidth desc)### t1 inner join app_mdata t2 on t1.appid=t2.id group by d_risk, t2.name, t2.app_cat, t2.technology order by d_risk desc, bandwidth desc"
        set protected enable
    next

    edit "security-Malware-Virus-Botnet-Spyware"
        set description "Malware: viruses, Bots, Spyware/Adware"
        set log-type traffic
         set query "select virus_s as virus, (case when lower(appcat)='botnet' then 'Botnet C&C' else (case when virus_s like 'Riskware%' then 'Spyware' when virus_s like 'Adware%' then 'Adware' else 'Virus' end) end) as malware_type, count(distinct dstip) as victims, count(distinct srcip) as source, sum(total_num) as total_num from (###(select app as virus_s, appcat, dstip, srcip, count(*) as total_num from $log-traffic where $filter and (logflag&1>0) and lower(appcat)='botnet' group by virus_s, appcat, dstip, srcip order by total_num desc)### union all ###(select unnest(string_to_array(virus, ',')) as virus_s, appcat, dstip, srcip, count(*) as total_num from $log-traffic where $filter and (logflag&1>0) and virus is not null group by virus_s, appcat, dstip, srcip order by total_num desc)### union all ###(select attack as virus_s, 'null' as appcat, dstip, srcip, count(*) as total_num from $log-attack where $filter and (logflag&16>0) group by virus_s, appcat, dstip, srcip order by total_num desc)###) t group by virus, malware_type order by total_num desc "
        set protected enable
    next
    edit "security-Malware-Virus-Botnet-Spyware-by-Count"
        set description "Malware: Viruses, Bots, Spyware/Adware by Count"
        set log-type traffic
         set query "select malware_type, virus, totalnum, sum(totalnum) over (partition by malware_type) as sub_totalnum from (select (case when lower(appcat)='botnet' then 'Botnet C&C' else (case when virus_s like 'Riskware%' then 'Spyware' when virus_s like 'Adware%' then 'Adware' else 'Virus' end) end) as malware_type, virus_s as virus, sum(total_num) as totalnum from (###(select app as virus_s, appcat, dstip, srcip, count(*) as total_num from $log-traffic where $filter and (logflag&1>0) and lower(appcat)='botnet' group by virus_s, appcat, dstip, srcip order by total_num desc)### union all ###(select unnest(string_to_array(virus, ',')) as virus_s, appcat, dstip, srcip, count(*) as total_num from $log-traffic where $filter and (logflag&1>0) and virus is not null group by virus_s, appcat, dstip, srcip order by total_num desc)### union all ###(select attack as virus_s, 'null' as appcat, dstip, srcip, count(*) as total_num from $log-attack where $filter and (logflag&16>0) group by virus_s, appcat, dstip, srcip order by total_num desc)###) t group by malware_type, virus order by totalnum desc ) t order by sub_totalnum desc, malware_type"
        set protected enable
    next
    edit "apprisk-Malware-Total-Count"
        set description "Total Count of Malware Programs"
        set log-type traffic
         set query "select count(distinct virus_s) as totalnum from (###(select app as virus_s, appcat, dstip, srcip, count(*) as total_num from $log-traffic where $filter and (logflag&1>0) and lower(appcat)='botnet' group by virus_s, appcat, dstip, srcip order by total_num desc)### union all ###(select unnest(string_to_array(virus, ',')) as virus_s, appcat, dstip, srcip, count(*) as total_num from $log-traffic where $filter and (logflag&1>0) and virus is not null group by virus_s, appcat, dstip, srcip order by total_num desc)### union all ###(select attack as virus_s, 'null' as appcat, dstip, srcip, count(*) as total_num from $log-attack where $filter and (logflag&16>0) group by virus_s, appcat, dstip, srcip order by total_num desc)###) t"
        set protected enable
    next
    edit "security-Victims-of-Malware"
        set description "Victims of Malware"
        set log-type virus
        set query "select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, virus as malware, count(*) as total_num from $log where $filter and virus is not null group by user_src, malware order by total_num desc"
        set protected enable
    next

    edit "security-Victims-of-Phishing-Site"
        set description "Victims of Phishing Site"
        set log-type webfilter
        set query "select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, url as phishing_site, count(*) as total_num from $log where $filter and cat in (26, 61) group by user_src, phishing_site order by total_num desc"
        set protected enable
    next

    edit "security-Malicious-Phishing-Site"
        set description "Malicious Phishing Site"
        set log-type webfilter
        set query "select phishing_site, count(distinct dstip) as victims, count(distinct srcip) as source, sum(total) as total_num from ###(select url as phishing_site, dstip, srcip, count(*) as total from $log where $filter and cat in (26, 61) group by phishing_site, dstip, srcip order by total desc)### t group by phishing_site order by total_num desc"
        set protected enable
    next

    edit "security-Malware-Virus-Spyware"
        set description "Malware: viruses, Spyware/Adware"
        set log-type virus
        set query "select virus, max(virusid_s) as virusid, malware_type, count(distinct victim) as victims, count(distinct source) as source, sum(total_num) as total_num from ###(select virus, virusid_to_str(virusid, eventtype) as virusid_s, (CASE WHEN direction='incoming' THEN dstip ELSE srcip END) as source, (CASE WHEN direction='incoming' THEN srcip ELSE dstip END) as victim, (case when virus like 'Riskware%' then 'Spyware' when virus like 'Adware%' then 'Adware' else 'Virus' end)  as malware_type, count(*) as total_num from $log where $filter and nullifna(virus) is not null group by virus, virusid_s, source, victim order by total_num desc)### t group by virus, malware_type order by total_num desc"
        set protected enable
    next

    edit "security-Malware-Botnet"
        set description "Malware: Botnet"
        set log-type appctrl
         set query "select app, appid, malware_type, count(distinct victim) as victims, count(distinct source) as source, sum(total_num) as total_num from (###(select app, appid, cast('Botnet C&C' as char(32)) as malware_type,(CASE WHEN direction='incoming' THEN dstip ELSE srcip END) as source, (CASE WHEN direction='incoming' THEN srcip ELSE dstip END) as victim, count(*) as total_num from $log-app-ctrl where $filter and lower(appcat)='botnet' and nullifna(app) is not null group by app, appid, malware_type, source, victim order by total_num desc)### union all ###(select attack, 0 as appid, cast('Botnet C&C' as char(32)) as malware_type, (CASE WHEN direction='incoming' THEN dstip ELSE srcip END) as source, (CASE WHEN direction='incoming' THEN srcip ELSE dstip END) as victim, count(*) as total_num from $log-attack where $filter and (logflag&16>0) group by attack, appid, malware_type, source, victim order by total_num desc)###) t group by app, appid, malware_type order by total_num desc" 
        set protected enable
    next

    edit "security-Files-Analyzed-By-FortiCloud-Sandbox"
        set description "Files analyzed by FortiCloud Sandbox"
        set log-type virus
        set query "select $day_of_week as dow, count(*) as total_num from $log where $filter and nullifna(filename) is not null and logid_to_int(logid)=9233 group by dow order by dow"
        set protected enable
    next

    edit "security-Zero-Day-Detected-On-Network"
        set description "Zero-day malware detected on the network"
        set log-type traffic
        set query "select virus_s, app, count(distinct dstip) as victims, count(distinct srcip) as source, sum(total_num) as total_num from ###(select unnest(string_to_array(virus, ',')) as virus_s, app, dstip, srcip, count(*) as total_num from $log where $filter and (logflag&1>0) and virus like '%PossibleThreat.SB%' group by virus_s, dstip, srcip, app)### t group by virus_s, app order by total_num desc"
        set protected enable
    next

    edit "security-Data-Loss-Incidents-By-Severity"
        set description "Data loss incidents summary by severity"
        set log-type dlp
        set query "select initcap(severity::text) as s_severity, count(*) as total_num from  ###(select itime, hostname,`from` as sender, `to` as receiver, profile, action, service, subtype, srcip, dstip, severity, filename, direction, filesize, (case when severity='critical' then 'Critical Data Exfiltration' else (case when coalesce(nullifna(`user`), ipstr(`srcip`)) is not null then 'User Associated Data Loss' else NULL end) end) as data_loss from $log where $filter /*SkipSTART*/order by itime desc/*SkipEND*/)### t where $filter-drilldown and severity is not null group by s_severity order by total_num desc"
        set protected enable
    next
    edit "security-Data-Loss-Files-By-Service"
        set description "Data Lass Files By Service"
        set log-type dlp
        set query "select filename, (case direction when 'incoming' then 'Download' when 'outgoing' then 'Upload' end) as action, max(filesize) as filesize, service from  ###(select itime, hostname,`from` as sender, `to` as receiver, profile, action, service, subtype, srcip, dstip, severity, filename, direction, filesize, (case when severity='critical' then 'Critical Data Exfiltration' else (case when coalesce(nullifna(`user`), ipstr(`srcip`)) is not null then 'User Associated Data Loss' else NULL end) end) as data_loss from $log where $filter /*SkipSTART*/order by itime desc/*SkipEND*/)### t where $filter-drilldown and filesize is not null group by filename, direction, service order by filesize desc"
        set protected enable
    next

    edit "security-Endpoint-Security-Events-Summary"
        set description "Endpoint Security Events summary"
        set log-type fct-traffic
        set query "select (case utmevent when 'antivirus' then 'Malware incidents' when 'webfilter' then 'Malicious/phishing websites' when 'appfirewall' then 'Risk applications' when 'dlp' then 'Data loss incidents' when 'netscan' then 'Vulnerability detected' else 'Others' end) as events, count(*) as total_num from $log where $filter and utmevent is not null group by events order by total_num desc"
        set protected enable
    next
    edit "security-Top-Endpoing-Running-High-Risk-Application"
        set description "Endpoints Running High Risk Application"
        set log-type fct-traffic
        set query "select coalesce(nullifna(`user`), ipstr(`srcip`), 'Unknown') as f_user, coalesce(nullifna(hostname), 'Unknown') as host_name, threat as app, t2.app_cat as appcat, risk as d_risk from $log t1 inner join app_mdata t2 on t1.threat=t2.name where $filter and utmevent='appfirewall' and risk>='4' group by f_user, host_name, t1.threat, t2.app_cat, t2.risk order by risk desc"
       set protected enable
    next
    edit "security-Top-Endpoints-Infected-With-Malware"
        set description "Endpoints Infected With Malware"
        set log-type fct-event
        set query "select coalesce(nullifna(`user`), ipstr(`deviceip`), 'Unknown') as f_user, coalesce(nullifna(hostname), 'Unknown') as host_name, virus, file from $log where $filter and subtype='av' and virus is not null group by f_user, host_name, virus, file"
        set protected enable
    next
    edit "security-Top-Endpoints-With-Web-Violateions"
        set description "Endpoints With Web Violations"
        set log-type fct-traffic
        set query "select f_user, host_name, remotename, sum(total_num) as total_num from ###(select coalesce(nullifna(`user`), ipstr(`srcip`)) as f_user, coalesce(nullifna(hostname), 'Unknown') as host_name, remotename, count(*) as total_num from $log where $filter and utmevent='webfilter' and remotename is not null and utmaction='blocked' group by f_user, host_name, remotename order by total_num desc)### t group by f_user, host_name, remotename order by total_num desc"
        set protected enable
    next
    edit "security-Top-Endpoints-With-Data-Loss-Incidents"
        set description "Endpoints With Data Loss Incidents"
        set log-type fct-event
        set query "select f_user, host_name, msg, sum(total_num) as total_num from ###(select coalesce(nullifna(`user`), ipstr(`deviceip`), 'Unknown') as f_user, coalesce(nullifna(hostname), 'Unknown') as host_name, msg, count(*) as total_num from $log where $filter and subtype='dlp' group by f_user, host_name, msg order by total_num desc)### t group by f_user, host_name, msg order by total_num desc"
        set protected enable
    next
    edit "dlp-email-activity-details"
        set description "Email DLP Violations Summary"
        set log-type dlp
        set query "select from_itime(itime) as timestamp, sender, receiver, regexp_replace(filename, '.*/', '') as filename, filesize, profile, action, direction from ###(select itime, hostname,`from` as sender, `to` as receiver, profile, action, service, subtype, srcip, dstip, severity, filename, direction, filesize, (case when severity='critical' then 'Critical Data Exfiltration' else (case when coalesce(nullifna(`user`), ipstr(`srcip`)) is not null then 'User Associated Data Loss' else NULL end) end) as data_loss from $log where $filter /*SkipSTART*/order by itime desc/*SkipEND*/)### t where $filter-drilldown and (service in ('smtp', 'SMTP', '25/tcp', '587/tcp', 'smtps', 'SMTPS', '465/tcp') or service in ('pop3', 'POP3', '110/tcp', 'imap', 'IMAP', '143/tcp', 'imaps', 'IMAPS', '993/tcp', 'pop3s', 'POP3S', '995/tcp')) order by timestamp desc"
        set protected enable
    next
        edit "dlp-email-violation-summary"
        set description "Email DLP Activity Summary"
        set log-type dlp
        set query "select profile, count(*) as total_num from ###(select itime, hostname,`from` as sender, `to` as receiver, profile, action, service, subtype, srcip, dstip, severity, filename, direction, filesize, (case when severity='critical' then 'Critical Data Exfiltration' else (case when coalesce(nullifna(`user`), ipstr(`srcip`)) is not null then 'User Associated Data Loss' else NULL end) end) as data_loss from $log where $filter /*SkipSTART*/order by itime desc/*SkipEND*/)### t where $filter-drilldown and (service in ('smtp', 'SMTP', '25/tcp', '587/tcp', 'smtps', 'SMTPS', '465/tcp') or service in ('pop3', 'POP3', '110/tcp', 'imap', 'IMAP', '143/tcp', 'imaps', 'IMAPS', '993/tcp', 'pop3s', 'POP3S', '995/tcp')) group by profile order by total_num desc"
        set protected enable
    next
    edit "dlp-web-activity-details"
        set description "Web DLP Violations Summary"
        set log-type dlp
        set query "select from_itime(itime) as timestamp, srcip, dstip, hostname, profile, filename, filesize, action, direction from ###(select itime, hostname,`from` as sender, `to` as receiver, profile, action, service, subtype, srcip, dstip, severity, filename, direction, filesize, (case when severity='critical' then 'Critical Data Exfiltration' else (case when coalesce(nullifna(`user`), ipstr(`srcip`)) is not null then 'User Associated Data Loss' else NULL end) end) as data_loss from $log where $filter /*SkipSTART*/order by itime desc/*SkipEND*/)### t where $filter-drilldown and lower(service) in ('http', 'https') order by timestamp desc"
        set protected enable
    next
    edit "dlp-web-violation-summary"
        set description "Web DLP Activity Summary"
        set log-type dlp
        set query "select profile, count(*) as total_num from ###(select itime, hostname,`from` as sender, `to` as receiver, profile, action, service, subtype, srcip, dstip, severity, filename, direction, filesize, (case when severity='critical' then 'Critical Data Exfiltration' else (case when coalesce(nullifna(`user`), ipstr(`srcip`)) is not null then 'User Associated Data Loss' else NULL end) end) as data_loss from $log where $filter /*SkipSTART*/order by itime desc/*SkipEND*/)### t where $filter-drilldown and lower(service) in ('http', 'https') group by profile order by total_num desc"
        set protected enable
    next
    edit "dlp-ftp-activity-details"
        set description "Web DLP Violations Summary"
        set log-type dlp
        set query "select from_itime(itime) as timestamp, srcip, dstip, filename, profile, filesize, action, direction from ###(select itime, hostname,`from` as sender, `to` as receiver, profile, action, service, subtype, srcip, dstip, severity, filename, direction, filesize, (case when severity='critical' then 'Critical Data Exfiltration' else (case when coalesce(nullifna(`user`), ipstr(`srcip`)) is not null then 'User Associated Data Loss' else NULL end) end) as data_loss from $log where $filter /*SkipSTART*/order by itime desc/*SkipEND*/)### t where $filter-drilldown and lower(service) in ('ftp', 'ftps') order by timestamp desc"
        set protected enable
    next
    edit "dlp-ftp-violation-summary"
        set description "FTP DLP Activity Summary"
        set log-type dlp
        set query "select profile, count(*) as total_num from ###(select itime, hostname,`from` as sender, `to` as receiver, profile, action, service, subtype, srcip, dstip, severity, filename, direction, filesize, (case when severity='critical' then 'Critical Data Exfiltration' else (case when coalesce(nullifna(`user`), ipstr(`srcip`)) is not null then 'User Associated Data Loss' else NULL end) end) as data_loss from $log where $filter /*SkipSTART*/order by itime desc/*SkipEND*/)### t where $filter-drilldown and lower(service) in ('ftp', 'ftps') group by profile order by total_num desc"
        set protected enable
    next
    edit "top-user-by-website-browsetime"
        set description "Top Users by website browsetime"
        set log-type traffic
        set query "select user_src, domain, ebtr_value(ebtr_agg_flat(browsetime), null, $timespan) as browsetime from ###(select user_src, domain, ebtr_agg_flat(browsetime) as browsetime from (select coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, coalesce(nullifna(hostname), ipstr(`dstip`)) as domain, ebtr_agg_flat($browse_time) as browsetime from $log where $filter and $browse_time is not null group by user_src, domain) t group by user_src, domain order by ebtr_value(ebtr_agg_flat(browsetime), null, null) desc)### t group by user_src, domain order by browsetime desc"
        set protected enable
    next



    edit "pci-dss-Compliance-Summary"
        set description "PCI DSS Compliance Summary"
        set log-type event
        set query "select status, num_reason as requirements, cast(num_reason*100.0/(sum(num_reason) over()) as decimal(18,2)) as percent from (select (case when fail_count>0 then 'Non-Compliant' else 'Compliant' end) as status, count(distinct reason) as num_reason from (select ftnt_pci_id, (sum(fail_count) over (partition by ftnt_pci_id)) as fail_count, reason from ###(select ftnt_pci_id, (case when result='fail' then 1 else 0 end) as fail_count, reason from $log t1 inner join pci_dss_mdata t2 on t1.reason=t2.ftnt_id where $filter and subtype='compliance-check' group by ftnt_pci_id, result, reason)### t) t group by status) t order by status"
        set protected enable
    next

    edit "pci-dss-Non-Compliant-Requirements-By-Severity"
        set description "PCI DSS Non-Compliant Requirements by Severity"
        set log-type event
        set query "with query as (select * from (select ftnt_pci_id, severity, (sum(fail_count) over (partition by ftnt_pci_id)) as fail_count, reason from ###(select ftnt_pci_id, t2.severity, (case when result='fail' then 1 else 0 end) as fail_count, reason from $log t1 inner join pci_dss_mdata t2 on t1.reason=t2.ftnt_id where $filter and subtype='compliance-check' group by ftnt_pci_id, t2.severity, result, reason order by fail_count desc)### t) t where fail_count>0) select t.severity, count(distinct t.reason) as requirements from (select distinct on (1) reason, severity from query order by reason, (case lower(severity) when 'high' then 4 when 'critical' then 3 when 'medium' then 2 when 'low' then 1 else 0 end) desc) t group by t.severity order by requirements desc"
      set protected enable
    next

    edit "pci-dss-Compliant-Requirements-By-Severity"
        set description "PCI DSS Compliant Requirements by Severity"
        set log-type event
        set query "with query as (select * from (select ftnt_pci_id, severity, (sum(fail_count) over (partition by ftnt_pci_id)) as fail_count, reason from ###(select ftnt_pci_id, t2.severity, (case when result='fail' then 1 else 0 end) as fail_count, reason from $log t1 inner join pci_dss_mdata t2 on t1.reason=t2.ftnt_id where $filter and subtype='compliance-check' group by ftnt_pci_id, t2.severity, result, reason order by fail_count desc)### t) t where fail_count=0) select t.severity, count(distinct t.reason) as requirements from (select distinct on (1) reason, severity from query order by reason, (case lower(severity) when 'high' then 4 when 'critical' then 3 when 'medium' then 2 when 'low' then 1 else 0 end) desc) t group by t.severity order by requirements desc"
        set protected enable
    next

    edit "pci-dss-Fortinet-Security-Best-Practice-Summary"
        set description "PCI DSS Fortinet Security Best Practice Summary"
        set log-type event
        set query "select status, num_reason as practices, cast(num_reason*100.0/(sum(num_reason) over()) as decimal(18,2)) as percent from (select (case when result='fail' then 'Failed' else 'Passed' end) as status, count(distinct reason) as num_reason from ###(select result, reason from $log where $filter and subtype='compliance-check' and result in ('fail','pass') group by result, reason)### t group by status) t order by status desc"
        set protected enable
    next

    edit "pci-dss-Failed-Fortinet-Security-Best-Practices-By-Severity"
        set description "PCI DSS Failed Fortinet Security Best Practices by Severity"
        set log-type event
        set query "select status, num_reason as practices, cast(num_reason*100.0/(sum(num_reason) over()) as decimal(18,2)) as percent from (select initcap(status) as status, count(distinct reason) as num_reason from ###(select status, reason, result from $log where $filter and subtype='compliance-check' group by status, reason, result)### t where result='fail' group by status) t order by status"
        set protected enable
    next

    edit "pci-dss-Passed-Fortinet-Security-Best-Practices-By-Severity"
        set description "PCI DSS Passed Fortinet Security Best Practices by Severity"
        set log-type event
        set query "select status, num_reason as practices, cast(num_reason*100.0/(sum(num_reason) over()) as decimal(18,2)) as percent from (select initcap(status) as status, count(distinct reason) as num_reason from ###(select status, reason, result from $log where $filter and subtype='compliance-check' group by status, reason, result)### t where result='pass' group by status) t order by status"
        set protected enable
    next

    edit "pci-dss-Requirements-Compliance-Details"
        set description "PCI DSS Requirements Compliance Details"
        set log-type event
        set query "select ftnt_pci_id, left(string_agg(distinct ftnt_id, ','), 120) as practice, (case when sum(fail_count)>0 then 'Non-Compliant' else 'Compliant' end) as compliance, pci_requirement from ###(select ftnt_pci_id, ftnt_id, (case when result='fail' then 1 else 0 end) as fail_count, pci_requirement from $log t1 inner join pci_dss_mdata t2 on t1.reason=t2.ftnt_id where $filter and subtype='compliance-check' group by ftnt_pci_id, ftnt_id, result, pci_requirement)### t group by ftnt_pci_id, pci_requirement order by ftnt_pci_id"
        set protected enable
    next

    edit "pci-dss-Fortinet-Security-Best-Practice-Details"
        set description "PCI DSS Fortinet Security Best Practice Details"
        set log-type event
        set query "select reason as ftnt_id, msg, initcap(status) as status, module from $log where $filter and subtype='compliance-check' group by reason, status, module, msg order by ftnt_id"
        set protected enable
    next


    edit "wifi-usage-by-hour-authenticated"
        set description "Wifi Usage by Hour - Authenticated"
        set log-type event
        set query "select hod, count(distinct stamac) as totalnum from ###(select $HOUR_OF_DAY as hod, stamac from $log where $filter and subtype='wireless' and action='client-authentication' group by hod, stamac)### t group by hod order by hod"
        set protected enable
    next

    edit "wifi-usage-authenticated-timeline"
        set description "Wifi Usage Timeline - Authenticated"
        set log-type event
        set query "select $flex_timescale(timestamp) as hodex, count(distinct stamac) as totalnum from ###(select $flex_timestamp as timestamp, stamac from $log where $filter and subtype='wireless' and action='client-authentication' group by timestamp, stamac order by timestamp desc)### t group by hodex order by hodex"
        set protected enable
    next

    edit "app-Top-User-by-Bandwidth"
        set description "Top 10 Applications Bandwidth by User Drilldown"
        set log-type traffic
        set query "select app, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(`sentbyte`, 0)+coalesce(`rcvdbyte`, 0)) as bandwidth from $log where $filter and (logflag&1>0) and nullifna(app) is not null group by app, user_src order by bandwidth desc"
        set protected enable
    next

    edit "app-Top-User-by-Sessions"
        set description "Top 10 Application Sessions by User Drilldown"
        set log-type traffic
        set query "select app, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, count(*) as sessions from $log where $filter and (logflag&1>0) and nullifna(app) is not null group by app, user_src order by sessions desc"
        set protected enable
    next

    edit "traffic-Interface-Bandwidth-Usage"
        set description "Interface Bandwidth Usage"
        set log-type traffic
        set query "with qry as (select dom as dom_s, devid as devid_s, vd as vd_s, srcintf, dstintf, total_sent, total_rcvd from ###(select $DAY_OF_MONTH as dom, devid, vd, srcintf, dstintf, sum(coalesce(sentbyte, 0)) as total_sent, sum(coalesce(rcvdbyte, 0)) as total_rcvd, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as total from $log where $filter and (logflag&1>0) and nullifna(srcintf) is not null and nullifna(dstintf) is not null group by dom, devid, vd, srcintf, dstintf having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by total desc)### t) select dom, unnest(array['download', 'upload']) as type, unnest(array[sum(download), sum(upload)]) as bandwidth from (select coalesce(t1.dom_s, t2.dom_s) as dom, coalesce(t1.devid_s, t2.devid_s) as devid, coalesce(t1.vd_s, t2.vd_s) as vd, coalesce(t1.srcintf, t2.dstintf) as intf, sum(coalesce(t1.total_sent, 0)+coalesce(t2.total_rcvd, 0)) as download, sum(coalesce(t2.total_sent, 0)+coalesce(t1.total_rcvd, 0)) as upload from qry t1 full join qry t2 on t1.dom_s=t2.dom_s and t1.srcintf=t2.dstintf group by dom, devid, vd, intf) t where $filter-drilldown group by dom order by dom"
        config variable
            edit "srcintf"
                set var-name "srcintf"
                set var-expression "intf"
                set var-type string
                set drilldown-flag enable
            next
        end
        set protected enable
    next

    edit "CTAP-SB-Files-Needing-Inspection-vs-Others"
        set description "Files Needing Inspection vs Others"
        set log-type virus
        set query "select (case when suffix in ('bat','cmd','exe','jar','msi','vbs','7z','zip','gzip','lzw','tar','rar','cab','doc','docx','xls','xlsx','ppt','pptx','pdf','swf','lnk','js') then 'Higher Risk File Types' else 'Excluded Files' end) as files, sum(total_num) as total_num from ###(select file_name_ext(filename) as suffix, count(*) as total_num from $log where $filter and dtype='fortisandbox' and nullifna(filename) is not null group by suffix order by total_num desc)### t group by files order by total_num desc"
        set protected enable
    next

    edit "CTAP-SB-Breakdown-of-File-Types"
        set description "Breakdown of File Types"
        set log-type virus
        set query "select (case when suffix in ('exe','msi','upx','vbs','bat','cmd','dll','ps1','jar') then 'Executable Files' when suffix in ('pdf') then 'Adobe PDF' when suffix in ('swf') then 'Adobe Flash' when suffix in ('doc','docx','rtf','dotx','docm','dotm','dot') then 'Microsoft Word' when suffix in ('xls','xlsx','xltx','xlsm','xlsb','xlam','xlt') then 'Microsoft Excel' when suffix in ('ppsx','ppt','pptx','potx','sldx','pptm','ppsm','potm','ppam','sldm','pps','pot') then 'Microsoft PowerPoint' when suffix in ('msg') then 'Microsoft Outlook' when suffix in ('htm','js','url','lnk') then 'Web Files' when suffix in ('cab','tgz','z','7z','tar','lzh','kgb','rar','zip','gz','xz','bz2') then 'Archive Files' when suffix in ('apk') then 'Android Files' else 'Others' end) as filetype, sum(total_num) as total_num from ###(select file_name_ext(filename) as suffix, count(*) as total_num from $log where $filter and dtype='fortisandbox' and nullifna(filename) is not null group by suffix order by total_num desc)### t group by filetype order by total_num desc"
       set protected enable
    next

    edit "CTAP-SB-Top-Sandbox-Malicious-Exes"
        set descriptio "Top Sandbox Malicious Exes"
        set log-type virus
        set query "select (case fsaverdict when 'malicious' then 5 when 'high risk' then 4 when 'medium risk' then 3 when 'low risk' then 2 else 1 end) as risk, filename, service, count(*) as total_num from $log where $filter and dtype='fortisandbox' and file_name_ext(filename)='exe' and fsaverdict not in ('clean','submission failed') group by filename, risk, service order by risk desc, total_num desc, filename"
        set protected enable
    next

    edit "CTAP-SB-Sources-of-Sandbox-Discovered-Malware"
        set description "Sources of Sandbox Discovered Malware"
        set log-type virus
        set query "select source, sum(total_num) as total_num from (select (CASE WHEN direction='incoming' THEN dstip ELSE srcip END) as source, count(*) as total_num from $log where $filter and dtype='fortisandbox' and nullifna(filename) is not null and fsaverdict not in ('clean','submission failed') group by source) t group by source order by total_num desc"
        set protected enable
    next

    edit "CTAP-apprisk-ctrl-Common-Virus-Botnet-Spyware"
        set description "Common Virus Botnet Spyware"
        set log-type app-ctrl
        set query "select malware as virus, (case when lower(appcat)='botnet' then 'Botnet C&C' else (case when malware like 'Riskware%' then 'Spyware' when malware like 'Adware%' then 'Adware' else 'Virus' end) end) as malware_type, appid, app, count(distinct victim) as victims, count(distinct source) as source, sum(total_num) as total_num from (###(select app as malware, appcat, appid, app, (CASE WHEN direction='incoming' THEN dstip ELSE srcip END) as source, (CASE WHEN direction='incoming' THEN srcip ELSE dstip END) as victim, count(*) as total_num from $log-app-ctrl where $filter and lower(appcat)='botnet' group by malware, appcat, appid, app, victim, source, app order by total_num desc)### union all ###(select virus as malware, 'null' as appcat, 0 as appid, service as app, (CASE WHEN direction='incoming' THEN dstip ELSE srcip END) as source, (CASE WHEN direction='incoming' THEN srcip ELSE dstip END) as victim, count(*) as total_num from $log-virus where $filter and virus is not null group by malware, appcat, app, appid, victim, source order by total_num desc)### union all ###(select attack as malware, 'null' as appcat, 0 as appid, service as app, (CASE WHEN direction='incoming' THEN dstip ELSE srcip END) as source, (CASE WHEN direction='incoming' THEN srcip ELSE dstip END) as victim, count(*) as total_num from $log-attack where $filter and (logflag&16>0) group by malware, appcat, app, appid, victim, source order by total_num desc)###) t group by malware, malware_type, app, appid order by total_num desc"
        set protected enable
    next

    edit "CTAP-App-Risk-Reputation-Top-Devices-By-Scores"
        set description "Reputation Top Devices By-Scores"
        set log-type traffic
        set query "select coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src, sum(crscore%65536) as scores from $log where $filter and (logflag&1>0) and crscore is not null group by dev_src having sum(crscore%65536)>0 order by scores desc"
        set protected enable
    next

    edit "CTAP-HTTP-SSL-Traffic-Ratio"
        set description "HTTP SSL Traffic Ratio"
        set log-type traffic
        set query "select (case when service in ('80/tcp', 'HTTP', 'http') then 'HTTP' else  'HTTPS' end) as service, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter and (logflag&1>0) and nullifna(app) is not null and service in ('80/tcp', '443/tcp', 'HTTP', 'HTTPS', 'http', 'https') group by service having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc"
        set protected enable
    next

    edit "CTAP-Top-Source-Countries"
        set description "Top Source Countries"
        set log-type traffic
        set query "select srccountry, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter and (logflag&1>0) and nullifna(srccountry) is not null and srccountry <> 'Reserved' group by srccountry having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc, srccountry"
        set protected enable
    next

    edit "CTAP-SaaS-Apps"
        set description "CTAP SaaS Apps"
        set log-type traffic
        set query "select app_group, sum(bandwidth) as bandwidth from ###(select app_group_name(app) as app_group, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out, count(*) as sessions from $log where $filter and (logflag&1>0) and nullifna(app) is not null group by app_group having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc)### t1 inner join app_mdata t2 on lower(t1.app_group)=lower(t2.name) where behavior like '%Cloud%' group by app_group order by bandwidth desc"
        set protected enable
    next

    edit "CTAP-IaaS-Apps"
        set description "CTAP IaaS Apps"
        set log-type traffic
        set query "select app_group, sum(bandwidth) as bandwidth from ###(select app_group_name(app) as app_group, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out, count(*) as sessions from $log where $filter and (logflag&1>0) and nullifna(app) is not null group by app_group having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc)### t1 inner join app_mdata t2 on lower(t1.app_group)=lower(t2.name) where app_cat='Cloud.IT' group by app_group order by bandwidth desc"
        set protected enable
    next

    edit "CTAP-RAS-Apps"
        set description "CTAP RAS Apps"
        set log-type traffic
        set query "select name as app_group, sum(bandwidth) as bandwidth from ###(select app_group_name(app) as app_group, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out, count(*) as sessions from $log where $filter and (logflag&1>0) and nullifna(app) is not null group by app_group having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc)### t1 inner join app_mdata t2 on lower(t1.app_group)=lower(t2.name) where app_cat='Remote.Access' group by name order by bandwidth desc"
        set protected enable
    next

    edit "CTAP-Proxy-Apps"
        set description "CTAP Proxy Apps"
        set log-type traffic
        set query "select name as app_group, sum(bandwidth) as bandwidth from ###(select app_group_name(app) as app_group, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out, count(*) as sessions from $log where $filter and (logflag&1>0) and nullifna(app) is not null group by app_group having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc)### t1 inner join app_mdata t2 on lower(t1.app_group)=lower(t2.name) where app_cat='Proxy' group by name order by bandwidth desc"
        set protected enable
    next

    edit "CTAP-Top-SocialMedia-App-By-Bandwidth"
        set description "Top SocialMedia Applications by Bandwidth Usage"
        set log-type traffic
        set query "select app_group, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###(select app_group_name(app) as app_group, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out, count(*) as sessions from $log where $filter and (logflag&1>0) and nullifna(app) is not null group by app_group having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc)### t1 inner join app_mdata t2 on lower(t1.app_group)=lower(t2.name) where app_cat='Social.Media' group by app_group order by bandwidth desc"
        set protected enable
    next

    edit "CTAP-Top-Streaming-App-By-Bandwidth"
        set description "Top Streaming applications by bandwidth usage"
        set log-type traffic
        set query "select app_group, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###(select app_group_name(app) as app_group, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out, count(*) as sessions from $log where $filter and (logflag&1>0) and nullifna(app) is not null group by app_group having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc)### t1 inner join app_mdata t2 on lower(t1.app_group)=lower(t2.name) where app_cat='Video/Audio' group by app_group order by bandwidth desc"
        set protected enable
    next

    edit "CTAP-Top-Game-App-By-Bandwidth"
        set description "Top Game applications by bandwidth usage"
        set log-type traffic
        set query "select app_group, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###(select app_group_name(app) as app_group, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out, count(*) as sessions from $log where $filter and (logflag&1>0) and nullifna(app) is not null group by app_group having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc)### t1 inner join app_mdata t2 on lower(t1.app_group)=lower(t2.name) where app_cat='Game' group by app_group order by bandwidth desc"
        set protected enable
    next

    edit "CTAP-Top-P2P-App-By-Bandwidth"
        set description "Top P2P applications by bandwidth usage"
        set log-type traffic
        set query "select app_group, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###(select app_group_name(app) as app_group, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out, count(*) as sessions from $log where $filter and (logflag&1>0) and nullifna(app) is not null group by app_group having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc)### t1 inner join app_mdata t2 on lower(t1.app_group)=lower(t2.name) where app_cat='P2P' group by app_group order by bandwidth desc"
        set protected enable
    next

    edit "CTAP-Average-Bandwidth-Hour"
        set description "Average Bandwidth Hour"
        set log-type traffic
        set query "select hourstamp, sum(bandwidth)/count(distinct daystamp) as bandwidth from ###(select to_char(from_dtime(dtime), 'HH24:00') as hourstamp, to_char(from_dtime(dtime), 'DD Mon') as daystamp, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter and (logflag&1>0) group by hourstamp, daystamp having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by hourstamp)### t group by hourstamp order by hourstamp"
        set protected enable
    next

    edit "CTAP-Top-Bandwidth-Hosts"
        set description "Top Bandwidth Hosts"
        set log-type traffic
        set query "select hostname, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log-traffic where $filter and hostname is not null and (logflag&1>0) group by hostname having  sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) > 0 order by bandwidth desc"
        set protected enable
    next

    edit "CTAP-Total-Malware-Botnet-Detected"
        set description "Total Malware Botnet Detected"
        set log-type virus
        set query "select count(distinct app) as totalnum from (###(select app from $log-app-ctrl where $filter and lower(appcat)='botnet' group by app)### union all ###(select virus as app from $log-virus where $filter and nullifna(virus) is not null group by virus)### union all ###(select attack from $log-attack where $filter and (logflag&16>0) group by attack)###) t"
        set protected enable
    next

    edit "CTAP-Total-High-Risk-Used"
        set description "Total High Risk Used"
        set log-type app-ctrl
        set query "select count(distinct app) as totalnum from ###(select app from $log where $filter and apprisk in ('critical', 'high') and nullifna(app) is not null group by app)### t"
        set protected enable
    next

    edit "CTAP-Total-Apps-Detected"
        set description "Total Apps Detected"
        set log-type app-ctrl
        set query "select count(distinct app) as totalnum from ###(select app from $log where $filter and nullifna(app) is not null group by app)### t"
        set protected enable
    next

    edit "CTAP-Top-Used-Application"
        set description "Top Used Application"
        set log-type app-ctrl
        set query "select app as appname, count(*) as total_num from $log where $filter and nullifna(app) is not null group by app order by total_num desc"
        set protected enable
    next

    edit "CTAP-App-Sessions-By-Category"
        set description "App Sessions By Category"
        set log-type traffic
        set query "select appcat, count(*) as sessions from $log where $filter and  (logflag&1>0) and nullifna(appcat) is not null and appcat not in ('Not.Scanned', 'unscanned') group by appcat order by sessions desc"
        set protected enable
    next

    edit "CTAP-Total-Websites-Visited"
        set description "Total-Websites-Visited"
        set log-type webfilter
        set query "select count(distinct domain) as totalnum from ###(select hostname as domain from $log where $filter and hostname is not null and action!='blocked' group by domain)### t"
        set protected enable
    next

    edit "CTAP-Total-Bandwidth"
        set description "Total Bandwidth"
        set log-type traffic
        set query "select sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as totalnum from $log where $filter and (logflag&1>0)"
        set protected enable
    next

    edit "CTAP-SB-Total-Number-of-Files-Detected"
        set description "Total Number of Files Detected"
        set log-type virus
        set query "select sum(total_num) as total_num from ###(select filename, fsaverdict, count(*) as total_num from $log where $filter and dtype='fortisandbox' group by filename, fsaverdict)### t where nullifna(filename) is not null"
        set protected enable
    next

    edit "CTAP-SB-Total-Number-of-Files-Could-be-Executed"
        set description "Total Number of Files Could be Executed"
        set log-type virus
        set query "select sum(total_num) as total_num from ###(select file_name_ext(filename) as suffix, count(*) as total_num from $log where $filter and dtype='fortisandbox' group by suffix order by total_num desc)### t where suffix in ('bat','cmd','exe','jar','msi','vbs','7z','zip','gzip','lzw','tar','rar','cab','doc','docx','xls','xlsx','ppt','pptx','pdf','swf','lnk','js')"
        set protected enable
    next

    edit "CTAP-SB-Total-Number-of-Exe-Files-Analyzed"
        set description "Total Number of Exe Files Analyzed"
        set log-type virus
        set query "select sum(total_num) as total_num from ###(select filename, fsaverdict, count(*) as total_num from $log where $filter and dtype='fortisandbox' group by filename, fsaverdict)### t where file_name_ext(filename)='exe'"
        set protected enable
    next

    edit "CTAP-SB-Malicious-Exes-Found"
        set description "Malicious Exes Found"
        set log-type virus
        set query "select sum(total_num) as total_num from ###(select filename, fsaverdict, count(*) as total_num from $log where $filter and dtype='fortisandbox' group by filename, fsaverdict)### t where file_name_ext(filename)='exe' and fsaverdict not in ('clean','submission failed')"
        set protected enable
    next

    edit "CTAP-Total-App-Vuln-Detected"
        set description "Total App Vuln Detected"
        set log-type attack
        set query "select count(distinct attack) as totalnum from ###(select attack from $log where $filter and nullifna(attack) is not null group by attack)### t"
        set protected enable
    next

    edit "CTAP-Total-Malware-Detected"
         set description "Total Malware Detected"
         set log-type virus
         set query "select count(distinct virus) as totalnum from ###(select virus from $log where $filter and virus is not null group by virus)### t"
         set protected enable
     next

     edit "CTAP-Total-Malicious-Websites-Detected"
         set description "Total Malicious Websites Detected"
         set log-type webfilter
         set query "select count(distinct hostname) as totalnum from ###(select hostname from $log-webfilter where $filter and hostname is not null and catdesc='Malicious Websites' group by hostname)### t"
         set protected enable
     next

     edit "CTAP-Total-Phishing-Websites-Detected"
         set description "Total Phishing Websites Detected"
         set log-type webfilter
         set query "select count(distinct hostname) as totalnum from ###(select hostname from $log-webfilter where $filter and hostname is not null and catdesc='Phishing' group by hostname)### t"
         set protected enable
     next

     edit "CTAP-Total-Proxy-Applications-Detected"
         set description "Total Proxy Applications Detected"
         set log-type app-ctrl
         set query "select count(distinct app) as totalnum from ###(select app from $log where $filter and nullifna(app) is not null and lower(appcat)='proxy' group by app)### t"
         set protected enable
     next

     edit "CTAP-Total-RAS-Applications-Detected"
         set description "Total RAS Applications Detected"
         set log-type app-ctrl
         set query "select count(distinct app) as totalnum from ###(select app from $log where $filter and nullifna(app) is not null and lower(appcat)='remote.access' group by app)### t"
         set protected enable
     next


    edit "saas-SaaS-Application-Percentage"
        set description "SaaS Application Percentage"
        set log-type traffic
        set query "with query as (select count(distinct case when is_saas=1 then app_s else NULL end) as total_saas, count(distinct(app_s, is_saas)) as total_app from ###(select app_s, (case when saas_s>=10 then 1 else 0 end) as is_saas from (select unnest(apps) as app_s, unnest(saasinfo) as saas_s from $log where $filter and apps is not null) t group by app_s, is_saas order by is_saas desc)### t) select (case when total_app>0 then cast(total_saas*100.0/total_app as decimal(10, 2)) else 0 end) as saas_perc from query"
        set protected enable
    next
    edit "saas-Unsanctioned-SaaS-Application-Percentage"
        set description "Unsanctioned SaaS Application Percentage"
        set log-type traffic
        set query "with query as (select count(distinct case when saas_cat=1 then app_s else NULL end) as total_unsanctioned, count(distinct(app_s, saas_cat)) as total_saas from ###(select app_s, saas_s%10 as saas_cat, sum(sentbyte+rcvdbyte) as bandwidth, count(*) as total_app from (select unnest(apps) as app_s, unnest(saasinfo) as saas_s, coalesce(sentbyte, 0) as sentbyte, coalesce(rcvdbyte, 0) as rcvdbyte from $log where $filter and apps is not null) t where saas_s>=10 group by app_s, saas_cat order by bandwidth desc)### t) select (case when total_saas>0 then cast(total_unsanctioned*100.0/total_saas as decimal(10, 2)) else 0 end) as unsanctioned_saas_perc from query"
        set protected enable
    next
    edit "saas-Application-Discovered"
        set description "All Applications Discovered on the Network"
        set log-type traffic
        set query "select (case is_saas when 1 then 'SaaS Apps' else 'Other Apps' end) as app_type, count(distinct app_s) as total_num from ###(select app_s, (case when saas_s>=10 then 1 else 0 end) as is_saas from (select unnest(apps) as app_s, unnest(saasinfo) as saas_s from $log where $filter and apps is not null) t group by app_s, is_saas order by is_saas desc)### t group by is_saas order by is_saas"
        set protected enable
    next
    edit "saas-SaaS-Application-by-Category"
        set description "Number of SaaS Applications by Category"
        set log-type traffic
        set query "select (case saas_cat when 0 then 'Sanctioned' else 'Unsanctioned' end) as saas_cat_str, count(distinct app_s) as num_saas_app from ###(select app_s, saas_s%10 as saas_cat, sum(sentbyte+rcvdbyte) as bandwidth, count(*) as total_app from (select unnest(apps) as app_s, unnest(saasinfo) as saas_s, coalesce(sentbyte, 0) as sentbyte, coalesce(rcvdbyte, 0) as rcvdbyte from $log where $filter and apps is not null) t where saas_s>=10 group by app_s, saas_cat order by bandwidth desc)### t where saas_cat in (0, 1) group by saas_cat order by saas_cat"
        set protected enable
    next
    edit "saas-SaaS-Application-by-Bandwidth"
        set description "Number of SaaS Applications by Bandwidth"
        set log-type traffic
        set query "select (case saas_cat when 0 then 'Sanctioned' else 'Tolerated' end) as saas_cat_str, sum(bandwidth) as bandwidth from ###(select app_s, saas_s%10 as saas_cat, sum(sentbyte+rcvdbyte) as bandwidth, count(*) as total_app from (select unnest(apps) as app_s, unnest(saasinfo) as saas_s, coalesce(sentbyte, 0) as sentbyte, coalesce(rcvdbyte, 0) as rcvdbyte from $log where $filter and apps is not null) t where saas_s>=10 group by app_s, saas_cat order by bandwidth desc)### t where saas_cat in (0, 2) group by saas_cat order by saas_cat"
        set hidden enable
        set protected enable
    next
    edit "saas-SaaS-Application-by-Session"
        set description "Number of SaaS Applications by Session"
        set log-type traffic
        set query "select (case saas_cat when 0 then 'Sanctioned' else 'Tolerated' end) as saas_cat_str, sum(total_app) as total_app from ###(select app_s, saas_s%10 as saas_cat, sum(sentbyte+rcvdbyte) as bandwidth, count(*) as total_app from (select unnest(apps) as app_s, unnest(saasinfo) as saas_s, coalesce(sentbyte, 0) as sentbyte, coalesce(rcvdbyte, 0) as rcvdbyte from $log where $filter and apps is not null) t where saas_s>=10 group by app_s, saas_cat order by bandwidth desc)### t where saas_cat in (0, 2) group by saas_cat order by saas_cat"
        set hidden enable
        set protected enable
    next
    edit "saas-SaaS-App-Users-vs-Others"
        set description "Number of Users of SaaS Apps vs Others"
        set log-type traffic
        set query "select (case is_saas when 0 then 'Other Apps' else 'SaaS Apps' end) as app_type, count(distinct saasuser) as total_user from ###(select saasuser, saas_s/10 as is_saas from (select coalesce(nullifna(`user`), nullifna(`clouduser`), nullifna(`unauthuser`), srcname, ipstr(`srcip`)) as saasuser, unnest(saasinfo) as saas_s from $log where $filter and apps is not null) t group by saasuser, is_saas)### t group by app_type"
        set protected enable
    next
    edit "saas-SaaS-App-Users"
        set description "Number of Users of SaaS Apps"
        set log-type traffic
        set query "select (case saas_cat when 0 then 'Sanctioned' when 1 then 'Unsanctioned' else 'Others' end) as app_type, count(distinct saasuser) as total_user from ###(select saasuser, saas_s%10 as saas_cat from (select coalesce(nullifna(`user`), nullifna(`clouduser`), nullifna(`unauthuser`), srcname, ipstr(`srcip`)) as saasuser, unnest(saasinfo) as saas_s from $log where $filter and apps is not null) t where saas_s>=10 group by saasuser, saas_cat)### t group by saas_cat order by saas_cat"
        set protected enable
    next
    edit "saas-Top-SaaS-User-by-Bandwidth-Session"
        set description "Top SaaS Users by Bandwidth and Session"
        set log-type traffic
        set query "select saasuser, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions, sum(session_block) as session_block, (sum(sessions)-sum(session_block)) as session_pass, count(distinct app_s) as total_app from ###(select saasuser, app_s, sum(sentbyte+rcvdbyte) as bandwidth, sum(rcvdbyte) as traffic_in, sum(sentbyte) as traffic_out, count(*) as sessions, sum(is_blocked) as session_block from (select coalesce(nullifna(`user`), nullifna(`clouduser`), nullifna(`unauthuser`), srcname, ipstr(`srcip`)) as saasuser, unnest(apps) as app_s, unnest(saasinfo) as saas_s, coalesce(sentbyte, 0) as sentbyte, coalesce(rcvdbyte, 0) as rcvdbyte, (CASE WHEN (logflag&2>0) THEN 1 ELSE 0 END) as is_blocked from $log where $filter and apps is not null) t where saas_s>=10 group by saasuser, app_s order by bandwidth desc)### t group by saasuser order by bandwidth desc"
        set protected enable
    next
    edit "saas-Top-Category-by-SaaS-Application-Usage"
        set description "Top Categories by SaaS Application Usage"
        set log-type traffic
        set query "select app_cat, (case saas_cat when 0 then 'Sanctioned' else 'Unsactioned' end) as saas_cat_str, count(distinct app_s) as total_app from ###(select app_s, saas_s%10 as saas_cat from (select unnest(apps) as app_s, unnest(saasinfo) as saas_s from $log where $filter and apps is not null) t where saas_s>=10 group by app_s, saas_cat)### t1 inner join app_mdata t2 on t1.app_s=t2.name where saas_cat in (0, 1) group by app_cat, saas_cat order by total_app desc"
        set protected enable
    next
    edit "saas-Top-SaaS-Category-by-Number-of-User"
        set description "Top SaaS Categories by Number of Users"
        set log-type traffic
        set query "select app_cat, (case saas_cat when 0 then 'Sanctioned' else 'Unsactioned' end) as saas_cat_str, count(distinct saasuser) as total_user from ###(select app_s, saas_s%10 as saas_cat, saasuser from (select unnest(apps) as app_s, unnest(saasinfo) as saas_s, coalesce(nullifna(`user`), nullifna(`clouduser`), nullifna(`unauthuser`), srcname, ipstr(`srcip`)) as saasuser from $log where $filter and apps is not null) t where saas_s>=10 group by app_s, saas_cat, saasuser order by saas_cat desc)### t1 inner join app_mdata t2 on t1.app_s=t2.name where saas_cat in (0, 1) group by app_cat, saas_cat order by total_user desc"
        set protected enable
    next
    edit "saas-Top-User-by-Number-of-SaaS-Application"
        set description "Top Users by Number of SaaS Applications"
        set log-type traffic
        set query "select saasuser, (case saas_cat when 0 then 'Sanctioned' else 'Unsactioned' end) as saas_cat_str, count(distinct app_s) as total_app from ###(select app_s, saas_s%10 as saas_cat, saasuser from (select unnest(apps) as app_s, unnest(saasinfo) as saas_s, coalesce(nullifna(`user`), nullifna(`clouduser`), nullifna(`unauthuser`), srcname, ipstr(`srcip`)) as saasuser from $log where $filter and apps is not null) t where saas_s>=10 group by app_s, saas_cat, saasuser order by saas_cat desc)### t where saas_cat in (0, 1) group by saasuser, saas_cat order by total_app desc"
        set protected enable
    next
    edit "saas-Top-SaaS-Application-by-Bandwidth-Session"
        set description "Top SaaS Applications by Sessions and Bandwidth"
        set log-type traffic
        set query "select t2.id as app_id, app_s, app_cat, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions, sum(session_block) as session_block, (sum(sessions)-sum(session_block)) as session_pass from ###(select app_s, sum(sentbyte+rcvdbyte) as bandwidth, sum(rcvdbyte) as traffic_in, sum(sentbyte) as traffic_out, count(*) as sessions, sum(is_blocked) as session_block from (select unnest(apps) as app_s, unnest(saasinfo) as saas_s, coalesce(sentbyte, 0) as sentbyte, coalesce(rcvdbyte, 0) as rcvdbyte, (CASE WHEN (logflag&2>0) THEN 1 ELSE 0 END) as is_blocked from $log where $filter and apps is not null) t where saas_s>=10 group by app_s)### t1 inner join app_mdata t2 on t1.app_s=t2.name group by app_id, app_s, app_cat order by bandwidth desc"
        set protected enable
    next
    edit "saas-Top-Tolerated-SaaS-Application-by-Bandwidth"
        set description "Top Tolerated SaaS Applications by Bandwidth"
        set log-type traffic
        set query "select app_s, sum(sentbyte+rcvdbyte) as bandwidth from (select unnest(apps) as app_s, unnest(saasinfo) as saas_s, coalesce(sentbyte, 0) as sentbyte, coalesce(rcvdbyte, 0) as rcvdbyte from $log where $filter and apps is not null) t where saas_s=12 group by app_s order by bandwidth desc"
        set hidden enable
        set protected enable
    next
    edit "saas-Top-User-by-Tolerated-SaaS-Application"
        set description "Top Users by Tolerated SaaS Applications"
        set log-type traffic
        set query "select saasuser, count(distinct app_s) as total_app from ###(select saasuser, app_s, sum(sentbyte+rcvdbyte) as bandwidth, sum(rcvdbyte) as traffic_in, sum(sentbyte) as traffic_out, count(*) as sessions, sum(is_blocked) as session_block from (select coalesce(nullifna(`user`), nullifna(`clouduser`), nullifna(`unauthuser`), srcname, ipstr(`srcip`)) as saasuser, unnest(apps) as app_s, unnest(saasinfo) as saas_s, coalesce(sentbyte, 0) as sentbyte, coalesce(rcvdbyte, 0) as rcvdbyte, (CASE WHEN (logflag&2>0) THEN 1 ELSE 0 END) as is_blocked from $log where $filter and apps is not null) t where saas_s=12 group by saasuser, app_s order by bandwidth desc)### t group by saasuser order by total_app desc"
        set hidden enable
        set protected enable
    next
    edit "saas-drilldown-Top-Tolerated-SaaS-Application"
        set description "Top Tolerated SaaS Applications"
        set log-type traffic
        set query "select app_s, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions, sum(session_block) as session_block, (sum(sessions)-sum(session_block)) as session_pass from ###(select saasuser, app_s, sum(sentbyte+rcvdbyte) as bandwidth, sum(rcvdbyte) as traffic_in, sum(sentbyte) as traffic_out, count(*) as sessions, sum(is_blocked) as session_block from (select coalesce(nullifna(`user`), nullifna(`clouduser`), nullifna(`unauthuser`), srcname, ipstr(`srcip`)) as saasuser, unnest(apps) as app_s, unnest(saasinfo) as saas_s, coalesce(sentbyte, 0) as sentbyte, coalesce(rcvdbyte, 0) as rcvdbyte, (CASE WHEN (logflag&2>0) THEN 1 ELSE 0 END) as is_blocked from $log where $filter and apps is not null) t where saas_s=12 group by saasuser, app_s order by bandwidth desc)### t where $filter-drilldown group by app_s order by bandwidth desc"
            config variable
                edit "saasuser"
                    set var-name "SaaS User"
                    set var-expression "coalesce(nullifna(`user`), nullifna(`clouduser`), nullifna(`unauthuser`), srcname, ipstr(`srcip`))"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set hidden enable
        set protected enable
    next
    edit "saas-Top-File-Sharing-SaaS-Application"
        set description "Top File Sharing Applications"
        set log-type traffic
        set query "select t2.id as appid, (case t2.risk when '5' then 'Critical' when '4' then 'High' when '3' then 'Medium' when '2' then 'Info' else 'Low' end) as risk, app_group, bandwidth, traffic_in, traffic_out, sessions, session_block, session_pass, total_user from (select app_group, count(distinct saasuser) as total_user, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions, sum(session_block) as session_block, (sum(sessions)-sum(session_block)) as session_pass from ###(select app_group_name(app_s) as app_group, saasuser, sum(sentbyte+rcvdbyte) as bandwidth, sum(rcvdbyte) as traffic_in, sum(sentbyte) as traffic_out, count(*) as sessions, sum(is_blocked) as session_block from (select coalesce(nullifna(`user`), nullifna(`clouduser`), nullifna(`unauthuser`), srcname, ipstr(`srcip`)) as saasuser, unnest(apps) as app_s, unnest(saasinfo) as saas_s, coalesce(sentbyte, 0) as sentbyte, coalesce(rcvdbyte, 0) as rcvdbyte, (CASE WHEN (logflag&2>0) THEN 1 ELSE 0 END) as is_blocked from $log where $filter and apps is not null) t where saas_s>=10 group by app_group, saasuser order by bandwidth desc)### t group by app_group) t1 inner join app_mdata t2 on lower(t1.app_group)=lower(t2.name) where t2.app_cat='Storage.Backup' order by total_user desc, bandwidth desc"
        set protected enable
    next
    edit "saas-drilldown-Top-File-Sharing-SaaS-Application-Detail"
        set description "Top File Sharing SaaS Applications Detail"
        set log-type traffic 
        set query "select saasuser, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions, sum(session_block) as session_block, (sum(sessions)-sum(session_block)) as session_pass from ###(select app_group_name(app_s) as app_group, saasuser, sum(sentbyte+rcvdbyte) as bandwidth, sum(rcvdbyte) as traffic_in, sum(sentbyte) as traffic_out, count(*) as sessions, sum(is_blocked) as session_block from (select coalesce(nullifna(`user`), nullifna(`clouduser`), nullifna(`unauthuser`), srcname, ipstr(`srcip`)) as saasuser, unnest(apps) as app_s, unnest(saasinfo) as saas_s, coalesce(sentbyte, 0) as sentbyte, coalesce(rcvdbyte, 0) as rcvdbyte, (CASE WHEN (logflag&2>0) THEN 1 ELSE 0 END) as is_blocked from $log where $filter and apps is not null) t where saas_s>=10 group by app_group, saasuser order by bandwidth desc)### t where $filter-drilldown group by saasuser order by sessions desc"
            config variable
                edit "app_group"
                    set var-name "Application"
                    set var-expression "app_group"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next

    edit "aware-Device-By-Location"
        set description "Device by Location"
        set log-type traffic
        set query "select 'All'::text as country, count(distinct devid) as device_count from ###(select devid from $log where $filter group by devid)### t"
        set protected enable
    next
    edit "aware-Network-Endpoint-Devices"
        set description "Endpoint Devices on Network"
        set query "select category, total_num from (select 'Seen Devices' as category, 1 as idx, count(distinct epname) as total_num from (select epname, map_dev.devid, map_dev.vd, max(lastseen) as itime from $ADOM_ENDPOINT t inner join $ADOM_EPEU_DEVMAP map_dev on t.epid=map_dev.epid where $filter-drilldown and epname is not null group by epname, map_dev.devid, map_dev.vd) t where $filter and $filter-drilldown union all select 'New Devices' as category, 2 as idx, count(distinct epname) as total_num from (select epname, map_dev.devid, map_dev.vd, min(firstseen) as itime from $ADOM_ENDPOINT  t inner join $ADOM_EPEU_DEVMAP map_dev on t.epid=map_dev.epid where epname is not null group by epname, map_dev.devid, map_dev.vd) t where $filter and $filter-drilldown union all select 'Unseen Devices' as category, 3 as idx, count(distinct t1.epname) as total_num from $ADOM_ENDPOINT t1 where not exists (select 1 from (select epname, map_dev.devid, map_dev.vd, max(lastseen) as itime from $ADOM_ENDPOINT t inner join $ADOM_EPEU_DEVMAP map_dev on t.epid=map_dev.epid where epname is not null group by epname, map_dev.devid, map_dev.vd) t2 where $filter and $filter-drilldown and t1.epname=t2.epname)) t order by idx"
        set protected enable
    next
    edit "aware-New-Endpoint-Devices"
        set description "New Endpoint Devices"
        set query "drop table if exists devmap_tmp; create temporary table devmap_tmp as (select epid, max(euid) as max_euid from $ADOM_EPEU_DEVMAP where $filter-drilldown and euid >= 1024 group by epid); select timestamp, epname as hostname, max(osname) as osname, max(devtype) as devtype, max(srcip) as srcip, string_agg(distinct epname, ',') as user_agg from (select from_itime(itime) as timestamp, osname, epname, epdevtype as devtype, epip as srcip, epid from (select max(osname) as osname, max(epname) as epname, max(epdevtype) as epdevtype, max(epip) as epip, t.epid, map_dev.devid, map_dev.vd, min(firstseen) as itime from $ADOM_ENDPOINT t inner join $ADOM_EPEU_DEVMAP map_dev on t.epid=map_dev.epid where epname is not null group by epname, t.epid, map_dev.devid, map_dev.vd) t where $filter and $filter-drilldown) t1 inner join devmap_tmp on devmap_tmp.epid=t1.epid inner join $ADOM_ENDUSER as teu on devmap_tmp.max_euid=teu.euid group by timestamp, hostname order by timestamp desc"
        set protected enable
    next
    edit "aware-New-Endpoint-Devices-Trend"
        set description "New Endpoint Devices Trend"
        set query "select $flex_timescale(itime) as hodex, count(distinct epname) as total_num from (select epname, map_dev.devid, map_dev.vd, min(firstseen) as itime from $ADOM_ENDPOINT t inner join $ADOM_EPEU_DEVMAP map_dev on t.epid=map_dev.epid where $filter-drilldown and epname is not null group by epname, map_dev.devid, map_dev.vd) t where $filter and $filter-drilldown group by hodex order by hodex"
        set protected enable
    next
    edit "aware-Top-Endpoint-Operating-Systems"
        set description "Top Endpoint Operating Systems"
        set log-type fct-traffic
        set query "select os1 as os, count(distinct hostname) as total_num from ###(select split_part(os, ',', 1) as os1, hostname from $log where $filter and nullifna(os) is not null group by os1, hostname)### t group by os order by total_num desc"
        set protected enable
    next
    edit "aware-Top-Endpoint-Applications-Windows"
        set description "Top Endpoint Applications Windows"
        set log-type fct-traffic
        set query "select srcname1 as srcname, count(distinct hostname) as total_num from ###(select split_part(srcname, '.', 1) as srcname1, hostname from $log where $filter and nullifna(srcname) is not null and lower(os) like '%windows%' group by srcname, hostname)### t group by srcname order by total_num desc"
        set protected enable
    next
    edit "aware-Top-Endpoint-Applications-Mac"
        set description "Top Endpoint Applications Mac"
        set log-type fct-traffic
        set query "select srcname1 as srcname, count(distinct hostname) as total_num from ###(select split_part(srcname, '.', 1) as srcname1, hostname from $log where $filter and nullifna(srcname) is not null and lower(os) like '%mac os%' group by srcname, hostname)### t group by srcname order by total_num desc"
        set protected enable
    next
    edit "aware-Top-SaaS-Application-by-Number-of-Users"
        set description "Top SaaS Applications by Number of Users"
        set log-type traffic
        set query "select app_group, count(distinct saasuser) as total_user from ###(select app_group_name(app_s) as app_group, saasuser from (select unnest(apps) as app_s, unnest(saasinfo) as saas_s, coalesce(nullifna(`user`), nullifna(`clouduser`), nullifna(`unauthuser`), srcname, ipstr(`srcip`)) as saasuser from $log where $filter and (logflag&1>0) and apps is not null) t where saas_s>=10 group by app_group, saasuser)### t group by app_group order by total_user desc"
        set protected enable
    next
    edit "aware-Summary-Of-Changes"
        set description "Summary of Changes"
        set log-type event
        set query "select regexp_replace(msg, '[^ ]*$','') as msg_trim, count(*) as total_num from $log where $filter and logid_to_int(logid)=44547 group by msg_trim order by total_num desc"
        set protected enable
    next
    edit "aware-Change-Details"
        set description "Change Details"
        set log-type event
        set query "select $calendar_time as timestamp, `user`, ui, msg from $log where $filter and logid_to_int(logid)=44547 order by timestamp desc"
        set protected enable
    next
    edit "aware-Vulnerabilities-By-Severity"
        set description "Vulnerabilities by Security"
        set log-type fct-netscan
        set query "select vulnseverity, count(distinct vulnname) as vuln_num from ###(select vulnseverity, vulnname from $log where $filter and nullifna(vulnname) is not null and nullifna(vulnseverity) is not null group by vulnseverity, vulnname)### t group by vulnseverity order by vuln_num desc"
        set protected enable
    next
    edit "aware-Vulnerabilities-Trend"
        set description "Vulnerabilities Trend"
        set log-type fct-netscan
        set query "select $flex_timescale(timestamp) as timescale, sum(critical) as critical, sum(high) as high, sum(medium) as medium, sum(low) as low from ###(select $flex_timestamp as timestamp, sum(case when lower(vulnseverity) = 'critical' then 1 else 0 end) as critical, sum(case when lower(vulnseverity) = 'high' then 1 else 0 end) as high, sum(case when lower(vulnseverity) = 'medium' then 1 else 0 end) as medium, sum(case when lower(vulnseverity) = 'notice' then 1 else 0 end) as Low from $log where $filter group by timestamp order by timestamp desc)### t group by timescale order by timescale"
        set protected enable
    next
    edit "aware-Top-Critical-Vulnerabilities"
        set description "Top Critical Vulnerabilities"
        set log-type fct-netscan
        set query "select vulnname, vulnseverity, vulncat, count(distinct hostname) as total_num from ###(select hostname, vulnname, vulnseverity, vulncat, count(*) as total_num from $log where $filter and nullifna(vulnname) is not null and vulnseverity='Critical' group by hostname, vulnname, vulnseverity, vulncat order by total_num desc)### t group by vulnname, vulnseverity, vulncat order by total_num desc"
        set protected enable
    next
    edit "aware-Top-Vulnerabilities-Last-Period"
        set description "Top Vulnerabilities Last Period"
        set log-type fct-netscan
        set query "select vulnname, vulnseverity, sev_num, vulncat, count(distinct hostname) as total_num from ###(select hostname, vulnname, vulnseverity, (CASE vulnseverity WHEN 'Critical' THEN 5 WHEN 'High' THEN 4 WHEN 'Medium' THEN 3 WHEN 'Info' THEN 2 WHEN 'Low' THEN 1 ELSE 0 END) as sev_num, vulncat, count(*) as total_num from $log where $pre_period $filter and nullifna(vulnname) is not null group by hostname, vulnname, vulnseverity, vulncat order by sev_num desc, total_num desc)### t group by vulnname, vulnseverity, sev_num, vulncat order by sev_num desc, total_num desc"
        set protected enable
    next
    edit "aware-Top-New-Vulnerabilities"
        set description "Top New Vulnerabilities"
        set log-type fct-netscan
        set query "drop table if exists rpt_tmptbl_1; drop table if exists rpt_tmptbl_2; create temporary table rpt_tmptbl_1 as select vulnid, vulnname, vulnseverity, vulncat, hostname from ###(select vulnid, vulnname, vulnseverity, vulncat, hostname from $log where $pre_period $filter and nullifna(vulnname) is not null group by vulnid, vulnname, vulnseverity, vulncat, hostname)### t group by vulnid, vulnname, vulnseverity, vulncat, hostname; create temporary table rpt_tmptbl_2 as select vulnid, vulnname, vulnseverity, vulncat, hostname from ###(select vulnid, vulnname, vulnseverity, vulncat, hostname from $log where $filter and nullifna(vulnname) is not null group by vulnid, vulnname, vulnseverity, vulncat, hostname)### t group by vulnid, vulnname, vulnseverity, vulncat, hostname; select vulnname, (case when vulnseverity='Critical' then 5 when vulnseverity='High' then 4 when vulnseverity='Medium' then 3 when vulnseverity='Low' then 2 when vulnseverity='Info' then 1 else 0 end) as sev, vulnseverity, vulncat, count(distinct hostname) as host_num, cve_id from rpt_tmptbl_2 t1 left join fct_mdata t2 on t1.vulnid=t2.vid::int where not exists (select 1 from rpt_tmptbl_1 where t1.vulnid=rpt_tmptbl_1.vulnid) group by vulnname, sev, vulnseverity, vulncat, cve_id order by sev desc, host_num desc"
        set protected enable
    next
    edit "aware-Top-User-With-Critical-Vulnerabilities"
        set description "Top Users with Critical Vulnerabilities"
        set log-type fct-netscan
        set query "select hostname, `user` as user_src,  vulnname, vulncat, count(*) as total_num from $log where $filter and nullifna(`user`) is not null and vulnseverity='Critical' group by hostname, user_src, vulnname, vulncat order by total_num desc"
        set protected enable
    next
    edit "aware-Top-Device-Attack-Targets"
        set description "Top Device Attack Targets"
        set log-type fct-netscan
        set query "select hostname, count(*) as total_num from $log where $filter and nullifna(hostname) is not null and nullifna(vulnname) is not null group by hostname order by total_num desc"
        set protected enable
    next
    edit "aware-Ingress-Data-Flow-By-Zone"
        set description "Ingress Data Flow By Zone"
        set log-type traffic
        set query "select app, tag, sum(rcvdbyte) as rcvdbyte from ###(select dvid, app, dstintf, sum(coalesce(rcvdbyte, 0)) as rcvdbyte from $log where $filter group by dvid, app, dstintf having sum(coalesce(rcvdbyte, 0)) > 0 order by rcvdbyte desc)### tt1 inner join (select dvid, intfname, unnest(tags) as tag from intfinfo) tt2 on tt1.dvid=tt2.dvid and tt1.dstintf=tt2.intfname group by app, tag order by rcvdbyte desc"
        set protected enable
    next
    edit "aware-Egress-Data-Flow-By-Zone"
        set description "Egress Data Flow By Zone"
        set log-type traffic
        set query "select app, tag, sum(sentbyte) as sentbyte from ###(select dvid, app, srcintf, sum(coalesce(sentbyte, 0)) as sentbyte from $log where $filter group by dvid, app, srcintf having sum(coalesce(sentbyte, 0)) > 0 order by sentbyte desc)### tt1 inner join (select dvid, intfname, unnest(tags) as tag from intfinfo) tt2 on tt1.dvid=tt2.dvid and tt1.srcintf=tt2.intfname group by app, tag order by sentbyte desc"
        set protected enable
    next
    edit "aware-Top-Attack-Targets"
        set description "Top Attack Targets"
        set log-type fct-netscan
        set query "select hostname, srcip, os, vuln_num, (CASE sevid WHEN 5 THEN 'Critical' WHEN 4 THEN 'High' WHEN 3 THEN 'Medium' WHEN '2' THEN 'Info' ELSE 'Low' END) as vulnseverity, sevid as severity_num, left(cve_agg, 512) as cve_agg from (select hostname, max(srcip) as srcip, string_agg(distinct os1, '/') as os, count(distinct vulnname) as vuln_num, max((CASE vulnseverity WHEN 'Critical' THEN 5 WHEN 'High' THEN 4 WHEN 'Medium' THEN 3 WHEN 'Info' THEN 2 WHEN 'Low' THEN 1 ELSE 0 END)) as sevid, string_agg(distinct cve_id, ',') as cve_agg from ###(select hostname, max(deviceip) as srcip, split_part(os, ',', 1) as os1, vulnname, vulnseverity, vulnid from $log where $filter and nullifna(vulnname) is not null and nullifna(vulnseverity) is not null group by hostname, os1, vulnname, vulnseverity, vulnid)### t1 left join fct_mdata t2 on t1.vulnid=t2.vid::int group by hostname) t order by severity_num desc, vuln_num desc"
        set protected enable
    next
    edit "aware-Threats-By-Severity"
        set description "Threats by Severity"
        set log-type attack
        set query "select initcap(sev) as severity, sum(total_num) as total_num from (###(select crlevel::text as sev, count(*) as total_num from $log-virus where $filter and nullifna(virus) is not null  and crlevel is not null group by sev order by total_num desc)### union all ###(select severity::text as sev, count(*) as total_num from $log-attack where $filter and nullifna(attack) is not null and severity is not null group by sev order by total_num desc)### union all ###(select apprisk::text as sev, count(*) as total_num from $log-app-ctrl where $filter and lower(appcat)='botnet' and apprisk is not null group by sev order by total_num desc)###) t group by severity order by total_num desc"
        set protected enable
    next
    edit "aware-Threats-Type-By-Severity"
        set description "Threats Type by Severity"
        set log-type virus
        set query "select threat_type, sum(critical) as critical, sum(high) as high, sum(medium) as medium, sum(low) as low from (###(select (case when eventtype='botnet' then 'Botnets' else 'Malware' end) as threat_type, sum(case when crlevel = 'critical' then 1 else 0 end) as critical, sum(case when crlevel = 'high' then 1 else 0 end) as high, sum(case when crlevel = 'medium' then 1 else 0 end) as medium, sum(case when crlevel = 'low' then 1 else 0 end) as low from $log-virus where $filter and nullifna(virus) is not null group by threat_type)### union all ###(select 'Intrusions' as threat_type, sum(case when severity = 'critical' then 1 else 0 end) as critical, sum(case when severity = 'high' then 1 else 0 end) as high, sum(case when severity = 'medium' then 1 else 0 end) as medium, sum(case when severity = 'low' then 1 else 0 end) as low from $log-attack where $filter and nullifna(attack) is not null group by threat_type)### union all ###(select 'Botnets' as threat_type, sum(case when apprisk = 'critical' then 1 else 0 end) as critical, sum(case when apprisk = 'high' then 1 else 0 end) as high, sum(case when apprisk = 'medium' then 1 else 0 end) as medium, sum(case when apprisk = 'low' then 1 else 0 end) as low from $log-app-ctrl where $filter and lower(appcat)='botnet' group by threat_type)###) t group by threat_type"
        set protected enable
    next
    edit "aware-Threats-By-Day"
        set description "Threats by Day"
        set log-type virus
        set query "select daystamp, sum(total_num) as total_num from (###(select $day_of_week as daystamp, count(*) as total_num from $log-virus where $filter and nullifna(virus) is not null group by daystamp)### union all ###(select $day_of_week as daystamp, count(*) as total_num from $log-attack where $filter and nullifna(attack) is not null group by daystamp)### union all ###(select $day_of_week as daystamp, count(*) as total_num from $log-app-ctrl where $filter and lower(appcat)='botnet' group by daystamp)###) t group by daystamp order by daystamp"
        set protected enable
    next
    edit "aware-Count-Of-Malware-Events"
        set description "Count of Malware Events"
        set log-type virus
        set query "select virus, count(*) as total_num from $log where $filter and nullifna(virus) is not null group by virus order by total_num desc"
        set protected enable
    next
    edit "aware-Top-Malware-By-Count"
        set description "Top Malware by Count"
        set log-type app-ctrl
        set query "select virus, malware_type, risk_level, count(distinct victim) as victim, count(distinct source) as source, sum(total_num) as total_num from (###(select app as virus, 'Botnet C&C' as malware_type, apprisk::text as risk_level, (CASE WHEN direction='incoming' THEN dstip ELSE srcip END) as source, (CASE WHEN direction='incoming' THEN srcip ELSE dstip END) as victim, count(*) as total_num from $log-app-ctrl where $filter and lower(appcat)='botnet' and apprisk is not null group by app, malware_type, apprisk, victim, source order by total_num desc)### union all ###(select virus, (case when eventtype='botnet' then 'Botnet C&C' else 'Virus' end) as malware_type, crlevel::text as risk_level, (CASE WHEN direction='incoming' THEN dstip ELSE srcip END) as source, (CASE WHEN direction='incoming' THEN srcip ELSE dstip END) as victim, count(*) as total_num from $log-virus where $filter and nullifna(virus) is not null and crlevel is not null group by virus, malware_type, crlevel, victim, source order by total_num desc)### union all ###(select attack as virus, (case when eventtype='botnet' then 'Botnet C&C' else 'Virus' end) as malware_type, crlevel::text as risk_level, (CASE WHEN direction='incoming' THEN dstip ELSE srcip END) as source, (CASE WHEN direction='incoming' THEN srcip ELSE dstip END) as victim, count(*) as total_num from $log-attack where $filter and (logflag&16>0) and crlevel is not null group by virus, malware_type, crlevel, victim, source order by total_num desc)###) t group by virus, malware_type, risk_level order by total_num desc"
        set protected enable
    next
    edit "aware-Top-Failed-Login-Attempts"
        set description "Top Failed Login Attempts"
        set log-type event
        set query "select `user` as f_user, ui, dstip, count(status) as total_failed from $log where $filter and nullifna(`user`) is not null and logid_to_int(logid) = 32002 group by ui, f_user, dstip order by total_failed desc"
        set protected enable
    next
    edit "aware-Top-Denied-Connections"
        set description "Top Denied Connections"
        set log-type traffic
        set query "select coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, service || '(' || ipstr(srcip) || ')' as interface, dstip, count(*) as total_num from $log where $filter and (logflag&1>0) and action = 'deny' group by user_src, interface, dstip order by total_num desc"
        set protected enable
    next
    edit "aware-Failed-Compliance-Checked-By-Device"
        set description "Failed Compliance Checked by Device"
        set log-type event
        set query "select devid, 'Failed' as results, count(distinct reason) as total_num from ###(select devid, reason from $log where $filter and subtype='compliance-check' and result='fail' group by devid, reason)### t group by devid, results order by total_num desc"
        set protected enable
    next
    edit "aware-Ioc-Blacklist-Summary"
        set description "IOC Blacklist Summary"
        set log-type app-ctrl
        set query "drop table if exists tmp_ep_eu_map; create temporary table tmp_ep_eu_map as (select epid, euid from $ADOM_EPEU_DEVMAP where euid >= 1024); select coalesce(nullifna(epname), nullifna(ipstr(`srcip`)), 'Unknown') as epname, user_agg, sevid, (CASE sevid WHEN 5 THEN 'Critical' WHEN 4 THEN 'High' WHEN 3 THEN 'Medium' WHEN '2' THEN 'Info' ELSE 'Low' END) as severity, threats, bl_count as total_bl from (select th1.epid, srcip, sevid, bl_count, threats from (select epid, srcip, max(verdict)+1 as sevid, sum(bl_count) as bl_count from ((select epid, srcip, day_st as itime, bl_count, verdict, unnest(dvid) as dvid_s from $ADOMTBL_PLHD_IOC_VERDICT where bl_count>0) union all (select epid, srcip, day_st as itime, bl_count, verdict, unnest(dvid) as dvid_s from $ADOMTBL_PLHD_INTERIM_IOC_VERDICT where bl_count>0)) tvdt inner join devtable_ext td on td.dvid = tvdt.dvid_s where $filter and $filter-drilldown and $dev_filter group by epid, srcip) th1 inner join (select epid, string_agg(name, ',') as threats from ((select epid, thid from ((select epid, thid, itime, unnest(dvid) as dvid_s from (select epid, unnest(threatid) as thid, day_st as itime, dvid from $ADOMTBL_PLHD_IOC_VERDICT where bl_count>0) ta1) union all (select epid, thid, itime, unnest(dvid) as dvid_s from (select epid, unnest(threatid) as thid, day_st as itime, dvid from $ADOMTBL_PLHD_INTERIM_IOC_VERDICT where  bl_count>0) ta2)) t inner join devtable_ext td on td.dvid = t.dvid_s where $filter and $filter-drilldown and $dev_filter group by epid, thid) thr inner join td_threat_name_mdata tm on tm.id=thr.thid) t group by epid) th2 on th1.epid=th2.epid) t1 left join (select epid, string_agg(distinct euname, ',') as user_agg from tmp_ep_eu_map tpu inner join $ADOM_ENDUSER as teu on tpu.euid=teu.euid group by epid) t2 on t2.epid=t1.epid inner join $ADOM_ENDPOINT as tep on tep.epid=t1.epid order by total_bl desc, sevid desc"
        set protected enable
    next
    edit "aware-Ioc-Potential-Breach-By-Day"
        set description "IOC Potential Breach by Day"
        set log-type app-ctrl
        set query "select number, day_st as itime from (select count(epid) as number, to_char(from_itime(itime), 'Day') as day_st from (select epid, day_st as itime, unnest(dvid) as dvid_s from $ADOMTBL_PLHD_INTERIM_IOC_VERDICT where $filter-drilldown and cs_count>0 union all (select epid, day_st as itime, unnest(dvid) as dvid_s from $ADOMTBL_PLHD_IOC_VERDICT where $filter-drilldown and cs_count>0)) t inner join devtable_ext td on td.dvid = t.dvid_s where $filter and $filter-drilldown group by day_st) tt order by itime"
        set protected enable
    next
    edit "aware-Ioc-Suspicion-Summary"
        set description "IOC Suspicion Summary"
        set log-type app-ctrl
        set query "select coalesce(nullifna(epname), nullifna(ipstr(`srcip`)), 'Unknown') as epname, cs_count as total_cs, cs_score as max_cs, verdict as max_verdict, threats from (select th1.epid, srcip, itime, cs_count, verdict, cs_score, threats from (select epid, srcip, min(itime) as itime, sum(cs_count) as cs_count, max(verdict) as verdict, max(cs_score) as cs_score from ((select epid, srcip, day_st as itime, cs_count, verdict, cs_score, unnest(dvid) as dvid_s from $ADOMTBL_PLHD_IOC_VERDICT where $filter-drilldown and bl_count=0 and cs_count>0) union all (select epid, srcip, day_st as itime, cs_count, verdict, cs_score, unnest(dvid) as dvid_s from $ADOMTBL_PLHD_INTERIM_IOC_VERDICT where $filter-drilldown and bl_count=0 and cs_count>0)) tvdt inner join devtable_ext td on td.dvid = tvdt.dvid_s where $filter and $filter-drilldown group by epid, srcip) th1 inner join (select epid, string_agg(name, ',') as threats from ((select epid, thid from ((select epid, thid, itime, unnest(dvid) as dvid_s from (select epid, unnest(threatid) as thid, day_st as itime, dvid from $ADOMTBL_PLHD_IOC_VERDICT where bl_count=0 and cs_count>0) ta1) union all (select epid, thid, itime, unnest(dvid) as dvid_s from (select epid, unnest(threatid) as thid, day_st as itime, dvid from $ADOMTBL_PLHD_INTERIM_IOC_VERDICT where bl_count=0 and cs_count>0) ta2)) tt1 inner join devtable_ext td on td.dvid = tt1.dvid_s where $filter and $filter-drilldown group by epid, thid) thr inner join td_threat_name_mdata tm on tm.id=thr.thid) tt2 group by epid) th2 on th1.epid=th2.epid) t inner join $ADOM_ENDPOINT as tep on tep.epid=t.epid order by max_verdict desc, max_cs desc, total_cs desc"
        set protected enable
    next
    edit "aware-Botnet-IP"
        set description "Top Source IP Affected by Botnet"
        set log-type virus
        set query "select f_user, source, string_agg(distinct `virus`, ',') as virus_agg, count(distinct ipstr(`victim`)) as dstip_cnt, max(action) as action, sum(total_num) as total_num, min(from_itime(first_seen)) as first_seen, max(from_itime(last_seen)) as last_seen from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`)) as f_user, virus, (CASE WHEN direction='incoming' THEN dstip ELSE srcip END) as source, (CASE WHEN direction='incoming' THEN srcip ELSE dstip END) as victim, max(action) as action, count(*) as total_num, min(itime) as first_seen, max(itime) as last_seen from $log where $filter and logid in ('0202009248', '0202009249') and virus is not null group by f_user, virus, source, victim order by total_num desc)### t group by source, f_user order by total_num desc"
        set protected enable
    next
    edit "aware-Botnet-Domain"
        set description "New Botnet Domains"
        set log-type dns
        set query "select botnet, count(distinct `qname`) as qname_cnt, count(distinct ipstr(`dstip`)) as dnssvr_cnt, sum(total_num) as total_num, min(from_itime(first_seen)) as first_seen, max(from_itime(last_seen)) as last_seen from ###(select coalesce(`botnetdomain`, ipstr(`botnetip`)) as botnet, qname, dstip, count(*) as total_num, min(nanosec_to_sec(eventtime)) as first_seen, max(nanosec_to_sec(eventtime)) as last_seen from $log where $filter and logid in ('1501054601', '1501054600') group by botnet, qname, dstip order by total_num desc)### t group by botnet order by first_seen desc"
        set protected enable
    next
    edit "aware-High-Risk-URL-Category"
        set description "Category of High Risk URLs"
        set log-type webfilter
        set query "select catdesc, string_agg(distinct hostname, ',') as hostname_agg, max(action) as action, sum(total_num) as total_num, min(from_itime(first_seen)) as first_seen, max(from_itime(last_seen)) as last_seen from ###(select catdesc, hostname, max(action) as action, count(*) as total_num, min(itime) as first_seen, max(itime) as last_seen from $log where $filter and cat in (26, 61, 86, 88, 90, 91, 93) group by catdesc, hostname order by total_num desc)### t group by catdesc order by total_num desc"
        set protected enable
    next
    edit "aware-Malicious-Files"
        set description "Type of Malicious Files from AV and Sandbox"
        set log-type virus
        set query "select virus, left(url_agg, 1000) as url_agg, left(filename_agg, 1000) as filename_agg, quarskip, action, from_sandbox, total_num, first_seen, last_seen from (select virus, string_agg(distinct url, '<br/>') as url_agg, string_agg(distinct filename, '<br/>') as filename_agg, max(quarskip) as quarskip, max(action) as action, max(from_sandbox) as from_sandbox, sum(total_num) as total_num, min(from_itime(first_seen)) as first_seen, max(from_itime(last_seen)) as last_seen from ###(select virus, url, filename, max(quarskip) as quarskip, max(action) as action, (case when logid in ('0211009234', '0211009235') then 1 else 0 end) as from_sandbox, count(*) as total_num, min(itime) as first_seen, max(itime) as last_seen from $log where $filter and virus is not null and logid in ('0211009234', '0201009235', '0211008192', '0211008193', '0211008194', '0211008195') group by virus, url, filename, from_sandbox order by total_num desc)### t group by virus) t order by total_num desc"
        set protected enable
    next

    edit "newthing-New-Users"
        set description "New users"
        set log-type fct-traffic
        set query "drop table if exists rpt_tmptbl_1; drop table if exists rpt_tmptbl_2; create temporary table rpt_tmptbl_1 as select f_user, min(start_time) as start_time from ###(select coalesce(nullifna(`user`), ipstr(`srcip`)) as f_user, min(dtime) as start_time from $log where $pre_period $filter group by f_user order by start_time desc)### t group by f_user; create temporary table rpt_tmptbl_2 as select f_user, min(start_time) as start_time from ###(select coalesce(nullifna(`user`), ipstr(`srcip`)) as f_user, min(dtime) as start_time from $log where $filter group by f_user order by start_time desc)### t group by f_user; select f_user, from_dtime(min(start_time)) as start_time from rpt_tmptbl_2 where f_user is not null and not exists (select 1 from rpt_tmptbl_1 where rpt_tmptbl_2.f_user=rpt_tmptbl_1.f_user) group by f_user order by start_time desc"
        set protected enable
    next
    edit "newthing-New-Devices"
        set description "New devices"
        set log-type fct-traffic
        set query "drop table if exists rpt_tmptbl_1; drop table if exists rpt_tmptbl_2; create temporary table rpt_tmptbl_1 as select hostname, os, srcip, fctver from ###(select hostname, os, srcip, fctver from $log where $pre_period $filter and hostname is not null group by hostname, os, srcip, fctver order by hostname)### t group by hostname, os, srcip, fctver; create temporary table rpt_tmptbl_2 as select hostname, os, srcip, fctver from ###(select hostname, os, srcip, fctver from $log where $filter and hostname is not null group by hostname, os, srcip, fctver order by hostname)### t group by hostname, os, srcip, fctver; select hostname, max(fctos_to_devtype(os)) as devtype, string_agg(distinct os, '/') as os_agg, string_agg(distinct ipstr(srcip), '/') as srcip_agg, string_agg(distinct fctver, '/') as fctver_agg from rpt_tmptbl_2 where not exists (select 1 from rpt_tmptbl_1 where rpt_tmptbl_2.hostname=rpt_tmptbl_1.hostname) group by hostname order by hostname"
        set protected enable
    next
    edit "newthing-New-Software-Installed"
        set description "New software installed"
        set log-type fct-traffic
        set query "drop table if exists rpt_tmptbl_1; drop table if exists rpt_tmptbl_2; create temporary table rpt_tmptbl_1 as select srcproduct, hostname from ###(select srcproduct, hostname from $log where $pre_period $filter and nullifna(srcproduct) is not null group by srcproduct, hostname order by srcproduct)### t group by srcproduct, hostname; create temporary table rpt_tmptbl_2 as select srcproduct, hostname from ###(select srcproduct, hostname from $log where $filter and nullifna(srcproduct) is not null group by srcproduct, hostname order by srcproduct)### t group by srcproduct, hostname; select srcproduct, string_agg(distinct hostname, ',') as host_agg from rpt_tmptbl_2 where not exists (select 1 from rpt_tmptbl_1 where rpt_tmptbl_2.srcproduct=rpt_tmptbl_1.srcproduct) group by srcproduct order by srcproduct"
        set protected enable
    next
    edit "newthing-New-Security-Threats"
        set description "New security threats"
        set log-type virus
        set query "drop table if exists rpt_tmptbl_1; drop table if exists rpt_tmptbl_2; create temporary table rpt_tmptbl_1 as select threat_name, cat_id, source from (###(select app as threat_name, 1 as cat_id, (CASE WHEN direction='incoming' THEN dstip ELSE srcip END) as source from $log-app-ctrl where $pre_period $filter and nullifna(app) is not null and lower(appcat)='botnet' group by threat_name, cat_id, source)### union all ###(select virus as threat_name, 2 as cat_id, (CASE WHEN direction='incoming' THEN dstip ELSE srcip END) as source from $log-virus where $pre_period $filter and nullifna(virus) is not null group by threat_name, cat_id, source)### union all ###(select attack as threat_name, 3 as cat_id, (CASE WHEN direction='incoming' THEN dstip ELSE srcip END) as source from $log-attack where $pre_period $filter and nullifna(attack) is not null group by threat_name, cat_id, source)###) t; create temporary table rpt_tmptbl_2 as select daystamp, threat_name, cat_id, source from (###(select $DAY_OF_MONTH as daystamp, app as threat_name, 1 as cat_id, (CASE WHEN direction='incoming' THEN dstip ELSE srcip END) as source from $log-app-ctrl where $filter and nullifna(app) is not null and lower(appcat)='botnet' group by daystamp, threat_name, cat_id, source order by daystamp)### union all ###(select $DAY_OF_MONTH as daystamp, virus as threat_name, 2 as cat_id, (CASE WHEN direction='incoming' THEN dstip ELSE srcip END) as source from $log-virus where $filter and nullifna(virus) is not null group by daystamp, threat_name, cat_id, source order by daystamp)### union all ###(select $DAY_OF_MONTH as daystamp, attack as threat_name, 3 as cat_id, (CASE WHEN direction='incoming' THEN dstip ELSE srcip END) as source from $log-attack where $filter and nullifna(attack) is not null group by daystamp, threat_name, cat_id, source order by daystamp)###) t; select threat_name, (case cat_id when 1 then 'Botnet' when 2 then 'Malware' when 3 then 'Attack' end) as threat_cat, count(distinct source) as host_num, string_agg(distinct cve, ',') as cve_agg from rpt_tmptbl_2 left join ips_mdata t2 on rpt_tmptbl_2.threat_name=t2.name where not exists (select 1 from rpt_tmptbl_1 where rpt_tmptbl_2.threat_name=rpt_tmptbl_1.threat_name) group by threat_name, threat_cat order by host_num desc"
        set protected enable
    next
    edit "newthing-dns-Botnet-Domain-IP"
        set description "New Queried Botnet C&C Domains and IPs"
        set log-type dns
        set query "drop table if exists rpt_tmptbl_1; drop table if exists rpt_tmptbl_2; create temporary table rpt_tmptbl_1 as select domain, malware_type, action_s as action, srcip, sevid from ###(select coalesce(botnetdomain, ipstr(botnetip)) as domain, cast('Botnet C&C' as char(32)) as malware_type, (case when action='block' then 'Blocked' when action='redirect' then 'Redirected' else 'Passed' end) as action_s, srcip, (CASE WHEN level IN ('critical', 'alert', 'emergency') THEN 5 WHEN level='error' THEN 4 WHEN level='warning' THEN 3 WHEN level='notice' THEN 2 ELSE 1 END) as sevid, coalesce(botnetdomain, ipstr(botnetip)) as sources_s, count(*) as total_num from $log where $pre_period $filter and (botnetdomain is not null or botnetip is not null) group by domain, action_s, srcip, sevid order by sevid desc)### t group by domain, malware_type, action, srcip, sevid; create temporary table rpt_tmptbl_2 as select domain, malware_type, action_s as action, srcip, sevid from ###(select coalesce(botnetdomain, ipstr(botnetip)) as domain, cast('Botnet C&C' as char(32)) as malware_type, (case when action='block' then 'Blocked' when action='redirect' then 'Redirected' else 'Passed' end) as action_s, srcip, (CASE WHEN level IN ('critical', 'alert', 'emergency') THEN 5 WHEN level='error' THEN 4 WHEN level='warning' THEN 3 WHEN level='notice' THEN 2 ELSE 1 END) as sevid, coalesce(botnetdomain, ipstr(botnetip)) as sources_s, count(*) as total_num from $log where $filter and (botnetdomain is not null or botnetip is not null) group by domain, action_s, srcip, sevid order by sevid desc)### t group by domain, malware_type, action, srcip, sevid; select domain, srcip, sevid, (CASE sevid WHEN 5 THEN 'Critical' WHEN 4 THEN 'High' WHEN 3 THEN 'Medium' WHEN '2' THEN 'Info' ELSE 'Low' END) as severity from rpt_tmptbl_2 where (domain is not null and not exists (select 1 from rpt_tmptbl_1 where rpt_tmptbl_2.domain=rpt_tmptbl_1.domain)) or (srcip is not null and not exists (select 1 from rpt_tmptbl_1 where rpt_tmptbl_2.srcip=rpt_tmptbl_1.srcip)) group by domain, srcip, sevid order by sevid desc, domain"
        set protected enable
    next
    edit "newthing-New-Security-Threats-Timeline"
        set description "New security threats timeline"
        set log-type virus
        set query "drop table if exists rpt_tmptbl_1; drop table if exists rpt_tmptbl_2; create temporary table rpt_tmptbl_1 as select threat_name, cat_id, source from (###(select app as threat_name, 1 as cat_id, (CASE WHEN direction='incoming' THEN dstip ELSE srcip END) as source from $log-app-ctrl where $pre_period $filter and nullifna(app) is not null and lower(appcat)='botnet' group by threat_name, cat_id, source)### union all ###(select virus as threat_name, 2 as cat_id, (CASE WHEN direction='incoming' THEN dstip ELSE srcip END) as source from $log-virus where $pre_period $filter and nullifna(virus) is not null group by threat_name, cat_id, source)### union all ###(select attack as threat_name, 3 as cat_id, (CASE WHEN direction='incoming' THEN dstip ELSE srcip END) as source from $log-attack where $pre_period $filter and nullifna(attack) is not null group by threat_name, cat_id, source)###) t; create temporary table rpt_tmptbl_2 as select timestamp, threat_name, cat_id, source from (###(select $flex_timestamp as timestamp, app as threat_name, 1 as cat_id, (CASE WHEN direction='incoming' THEN dstip ELSE srcip END) as source from $log-app-ctrl where $filter and nullifna(app) is not null and lower(appcat)='botnet' group by timestamp, threat_name, cat_id, source order by timestamp)### union all ###(select $flex_timestamp as timestamp, virus as threat_name, 2 as cat_id, (CASE WHEN direction='incoming' THEN dstip ELSE srcip END) as source from $log-virus where $filter and nullifna(virus) is not null group by timestamp, threat_name, cat_id, source order by timestamp)### union all ###(select $flex_timestamp as timestamp, attack as threat_name, 3 as cat_id, (CASE WHEN direction='incoming' THEN dstip ELSE srcip END) as source from $log-attack where $filter and nullifna(attack) is not null group by timestamp, threat_name, cat_id, source order by timestamp)###) t; select $flex_datetime(timestamp) as timescale, count(distinct source) as host_num, (case cat_id when 1 then 'Botnet' when 2 then 'Malware' when 3 then 'Attack' end) as threat_cat from rpt_tmptbl_2 where not exists (select 1 from rpt_tmptbl_1 where rpt_tmptbl_2.threat_name=rpt_tmptbl_1.threat_name) group by timescale, cat_id order by timescale, cat_id"
        set protected enable
    next
    edit "newthing-New-Vulnerability"
        set description "New vulnerabilities"
        set log-type fct-netscan
        set query "drop table if exists rpt_tmptbl_1; drop table if exists rpt_tmptbl_2; create temporary table rpt_tmptbl_1 as select vulnid, vulnname, vulnseverity, vulncat, hostname from ###(select vulnid, vulnname, vulnseverity, vulncat, hostname from $log where $pre_period $filter and nullifna(vulnname) is not null group by vulnid, vulnname, vulnseverity, vulncat, hostname)### t group by vulnid, vulnname, vulnseverity, vulncat, hostname; create temporary table rpt_tmptbl_2 as select vulnid, vulnname, vulnseverity, vulncat, hostname from ###(select vulnid, vulnname, vulnseverity, vulncat, hostname from $log where $filter and nullifna(vulnname) is not null group by vulnid, vulnname, vulnseverity, vulncat, hostname)### t group by vulnid, vulnname, vulnseverity, vulncat, hostname; select vulnname, (case when vulnseverity='Critical' then 5 when vulnseverity='High' then 4 when vulnseverity='Medium' then 3 when vulnseverity='Low' then 2 when vulnseverity='Info' then 1 else 0 end) as sev, vulnseverity, vulncat, count(distinct hostname) as host_num, cve_id from rpt_tmptbl_2 t1 left join fct_mdata t2 on t1.vulnid=t2.vid::int where not exists (select 1 from rpt_tmptbl_1 where t1.vulnid=rpt_tmptbl_1.vulnid) group by vulnname, sev, vulnseverity, vulncat, cve_id order by sev desc, host_num desc"
        set protected enable
    next
    edit "newthing-New-Vulnerability-Graph"
        set description "New vulnerabilities (Graph)"
        set log-type fct-netscan
        set query "drop table if exists rpt_tmptbl_1; drop table if exists rpt_tmptbl_2; create temporary table rpt_tmptbl_1 as select vulnid, vulnname, vulnseverity, vulncat, hostname from ###(select vulnid, vulnname, vulnseverity, vulncat, hostname from $log where $pre_period $filter and nullifna(vulnname) is not null group by vulnid, vulnname, vulnseverity, vulncat, hostname)### t group by vulnid, vulnname, vulnseverity, vulncat, hostname; create temporary table rpt_tmptbl_2 as select vulnid, vulnname, vulnseverity, vulncat, hostname from ###(select vulnid, vulnname, vulnseverity, vulncat, hostname from $log where $filter and nullifna(vulnname) is not null group by vulnid, vulnname, vulnseverity, vulncat, hostname)### t group by vulnid, vulnname, vulnseverity, vulncat, hostname; select vulnseverity, count (distinct vulnid) as vuln_num from rpt_tmptbl_2 where not exists (select 1 from rpt_tmptbl_1 where rpt_tmptbl_2.vulnid=rpt_tmptbl_1.vulnid) group by vulnseverity order by (case when vulnseverity='Critical' then 5 when vulnseverity='High' then 4 when vulnseverity='Medium' then 3 when vulnseverity='Low' then 2 when vulnseverity='Info' then 1 else 0 end) desc"
        set protected enable
    next
    edit "newthing-System-Alerts"
        set description "System Alerts"
        set log-type local-event
        set query "select from_itime(itime) as timestamp, msg from $log where $filter and msg is not null and level='critical' order by timestamp desc"
        set protected enable
    next
    edit "newthing-Configuration-Changes"
        set description "Configuration Changes"
        set log-type event
        set query "select `user` as f_user, devid, from_dtime(dtime) as time_s, ui, msg from $log where $filter and cfgtid>0 order by time_s desc"
        set protected enable
    next
    edit "newthing-FortiGate-Upgrades"
        set description "FortiGate Upgrades"
        set log-type event
        set query "select devid, from_dtime(dtime) as time_s, info[1] as intf, info[2] as prev_ver, info[3] as new_ver from (select devid, dtime, regexp_matches(msg, 'from ([^ ]+) \\(([^ ]+) -> ([^)]+)\\)') as info from $log where $filter and action='restore-image') t order by time_s desc"
        set protected enable
    next
    edit "newthing-User-Upgrades"
        set description "User Upgrades"
        set log-type fct-event
        set query "drop table if exists rpt_tmptbl_1; drop table if exists rpt_tmptbl_2; create temporary table rpt_tmptbl_1 as select fgtserial, hostname, deviceip, os, dtime from ###(select distinct on (fgtserial, hostname) fgtserial, hostname, deviceip, os, dtime from $log where $pre_period $filter and hostname is not null order by fgtserial, hostname, dtime desc)### t; create temporary table rpt_tmptbl_2 as select fgtserial, hostname, deviceip, os, dtime from ###(select distinct on (fgtserial, hostname) fgtserial, hostname, deviceip, os, dtime from $log where $filter and hostname is not null order by fgtserial, hostname, dtime desc)### t; select distinct on (1, 2) t2.fgtserial as devid, t2.hostname, t2.deviceip, t1.os as prev_os, t2.os as cur_os, from_dtime(t1.dtime) as time_s from rpt_tmptbl_2 t2 inner join rpt_tmptbl_1 t1 on t2.fgtserial=t1.fgtserial and t2.hostname=t1.hostname and t2.os!=t1.os order by devid, t2.hostname, t1.dtime desc"
        set protected enable
    next

    edit "GTP-List-of-APN-Used"
        set description "List of APNs Used"
        set log-type gtp
        set query "select apn, from_dtime(min(first_seen)) as first_seen, from_dtime(max(last_seen)) as last_seen from ###(select apn, min(dtime) as first_seen, max(dtime) as last_seen from $log where $filter and nullifna(apn) is not null group by apn order by last_seen desc)### t group by apn order by last_seen desc, first_seen"
        set protected enable
    next
    edit "GTP-Top-APN-by-Bytes"
        set description "Top APNs by Bytes"
        set log-type gtp
        set query "select apn, sum(coalesce(`u-bytes`, 0)) as total_bytes from $log where $filter and nullifna(apn) is not null and status='traffic-count' group by apn having sum(coalesce(`u-bytes`, 0))>0 order by total_bytes desc"
        set protected enable
    next
    edit "GTP-Top-APN-by-Duration"
        set description "Top APNs by Duration"
        set log-type gtp
        set query "select apn, sum(coalesce(duration, 0)) as total_dura from $log where $filter and nullifna(apn) is not null and status='traffic-count' group by apn having sum(coalesce(duration, 0)) >0 order by total_dura desc"
        set protected enable
    next
    edit "GTP-Top-APN-by-Packets"
        set description "Top APNs by Number of Packets"
        set log-type gtp
        set query "select apn, sum(coalesce(`u-pkts`, 0)) as total_num from $log where $filter and nullifna(apn) is not null and status='traffic-count' group by apn having sum(coalesce(`u-pkts`, 0))>0 order by total_num desc"
        set protected enable
    next

    edit "dns-Botnet-Domain-IP"
        set description "Queried Botnet C&C Domains and IPs"
        set log-type dns
        set query "select domain, srcip, sevid, (CASE sevid WHEN 5 THEN 'Critical' WHEN 4 THEN 'High' WHEN 3 THEN 'Medium' WHEN '2' THEN 'Info' ELSE 'Low' END) as severity from ###(select coalesce(botnetdomain, ipstr(botnetip)) as domain, qname, cast('Botnet C&C' as char(32)) as malware_type, (case when action='block' then 'Blocked' when action='redirect' then 'Redirected' else 'Passed' end) as action, srcip, (CASE WHEN level IN ('critical', 'alert', 'emergency') THEN 5 WHEN level='error' THEN 4 WHEN level='warning' THEN 3 WHEN level='notice' THEN 2 ELSE 1 END) as sevid, coalesce(botnetdomain, ipstr(botnetip)) as sources_s, count(*) as total_num from $log where $filter and (botnetdomain is not null or botnetip is not null) group by domain, qname, action, srcip, sevid order by sevid desc)### t group by domain, srcip, sevid order by sevid desc, domain"
        set protected enable
    next
    edit "dns-Top-Botnet-Domain-IP"
        set description "Top Queried Botnet C&C Domains and IPs"
        set log-type dns
        set query "select domain, malware_type, action, count(distinct srcip) as victims, count(distinct sources_s) as sources, sum(total_num) as total_num from ###(select coalesce(botnetdomain, ipstr(botnetip)) as domain, qname, cast('Botnet C&C' as char(32)) as malware_type, (case when action='block' then 'Blocked' when action='redirect' then 'Redirected' else 'Passed' end) as action, srcip, (CASE WHEN level IN ('critical', 'alert', 'emergency') THEN 5 WHEN level='error' THEN 4 WHEN level='warning' THEN 3 WHEN level='notice' THEN 2 ELSE 1 END) as sevid, coalesce(botnetdomain, ipstr(botnetip)) as sources_s, count(*) as total_num from $log where $filter and (botnetdomain is not null or botnetip is not null) group by domain, qname, action, srcip, sevid order by sevid desc)### t group by domain, malware_type, action order by total_num desc"
        set protected enable
    next
    edit "dns-High-Risk-Source"
        set description "High Risk Sources"
        set log-type dns
        set query "select srcip, sum(total_num) as total_num, sum(case when sevid=5 then total_num else 0 end) as num_cri, sum(case when sevid=4 then total_num else 0 end) as num_hig, sum(case when sevid=3 then total_num else 0 end) as num_med from ###(select srcip, (CASE WHEN level IN ('critical', 'alert', 'emergency') THEN 5 WHEN level='error' THEN 4 WHEN level='warning' THEN 3 WHEN level='notice' THEN 2 ELSE 1 END) as sevid, count(*) as total_num from $log where $filter and srcip is not null group by srcip, sevid order by total_num desc)### t where sevid>=3 group by srcip having sum(total_num)>0 order by total_num desc"
        set protected enable
    next
    edit "dns-DNS-Request-Over-Time"
        set description "DNS Request Over Time"
        set log-type dns
        set query "select $flex_timescale(timestamp) as timescale, sum(case when sevid=5 then total_num else 0 end) as num_cri, sum(case when sevid=4 then total_num else 0 end) as num_hig, sum(case when sevid=3 then total_num else 0 end) as num_med, sum(case when sevid=2 then total_num else 0 end) as num_inf, sum(case when sevid=1 then total_num else 0 end) as num_low from ###(select $flex_timestamp as timestamp, (CASE WHEN level IN ('critical', 'alert', 'emergency') THEN 5 WHEN level='error' THEN 4 WHEN level='warning' THEN 3 WHEN level='notice' THEN 2 ELSE 1 END) as sevid, count(*) as total_num from $log where $filter group by timestamp, sevid order by total_num desc)### t group by timescale order by timescale"
        set protected enable
    next
    edit "dns-Top-Queried-Domain"
        set description "Top Queried Domain"
        set log-type dns
        set query "select qname, count(*) as total_num from $log where $filter and qname is not null group by qname order by total_num desc"
        set protected enable
    next
    edit "dns-Top-Domain-Lookup-Failure"
        set description "Top Domain Lookup Failures"
        set log-type dns
        set query "select qname, srcip, count(*) as total_num from $log where $filter and qname is not null and (action='block' or logid_to_int(logid)=54200) group by qname, srcip order by total_num desc"
        set protected enable
    next
    edit "dns-Query-Timeout"
        set description "Query Timeout"
        set log-type dns
        set query "select srcip, qname, count(*) as total_num from $log where $filter and srcip is not null and logid_to_int(logid)=54200 group by qname, srcip order by total_num desc"
        set protected enable
    next
    edit "dns-Blocked-Query"
        set description "Blocked Queries"
        set log-type dns
        set query "select srcip, msg, count(*) as total_num from $log where $filter and srcip is not null and action='block' group by srcip, msg order by total_num desc"
        set protected enable
    next

    edit "incident-Incident-Count-by-Status"
        set description "Incident status distribution"
        set query "select status, count(*) as cnt from $incident where $filter-drilldown group by status order by status"
        set protected enable
    next
    edit "incident-Incident-Count-Timeline"
        set description "Incident count by status over time"
        set query "select $flex_timescale(agg_time) as hodex, max(num_sta_draft) as num_sta_draft, max(num_sta_analysis) as num_sta_analysis, max(num_sta_response) as num_sta_response, max(num_sta_closed) as num_sta_closed, max(num_sta_cancelled) as num_sta_cancelled from $incident_history where $filter-drilldown and $cust_time_filter(agg_time) group by hodex order by hodex"
        set protected enable
    next

    edit "resource-detailed-timeline"
        set description "Fortigate resource detail timeline"
        set log-type event
        set query "select hodex, cast(sum(cpu_ave)/count(*) as decimal(6, 0)) as cpu_ave, cast(sum(mem_ave)/count(*) as decimal(6, 0)) as mem_ave, cast(sum(disk_ave)/count(*) as decimal(6, 0)) as disk_ave, cast(sum(log_rate)/count(*) as decimal(10, 2)) as log_rate, cast(sum(sessions)/count(*) as decimal(10, 0)) as sessions, cast(sum(sent_kbps)/count(*) as decimal(10, 0)) as sent_kbps, cast(sum(recv_kbps)/count(*) as decimal(10, 0)) as recv_kbps, cast(sum(transmit_kbps)/count(*) as decimal(10, 0)) as transmit_kbps, max(mem_peak) as mem_peak, max(disk_peak) as disk_peak, max(cpu_peak) as cpu_peak, max(lograte_peak) as lograte_peak, max(session_peak) as session_peak, max(transmit_kbps_peak) as transmit_kbps_peak, cast(sum(cps_ave)/count(*) as decimal(10, 0)) as cps_ave, max(cps_peak) as cps_peak from (select hodex, devid, get_fgt_role(devid, slot) as role, cast(sum(cpu_ave)/count(*) as decimal(6, 0)) as cpu_ave, cast(sum(mem_ave)/count(*) as decimal(6, 0)) as mem_ave, cast(sum(disk_ave)/count(*) as decimal(6, 0)) as disk_ave, cast(sum(log_rate) as decimal(10, 2)) as log_rate, cast(sum(sessions) as decimal(10, 0)) as sessions, cast(sum(sent_kbps) as decimal(10, 0)) as sent_kbps, cast(sum(recv_kbps) as decimal(10, 0)) as recv_kbps, cast(sum(transmit_kbps) as decimal(10, 0)) as transmit_kbps, max(mem_peak) as mem_peak, max(disk_peak) as disk_peak, max(cpu_peak) as cpu_peak, cast(max(lograte_peak) as decimal(10, 2)) as lograte_peak, max(session_peak) as session_peak, max(transmit_kbps_peak) as transmit_kbps_peak, cast(sum(cps_ave) as decimal(10, 0)) as cps_ave, sum(cps_peak) as cps_peak from (select $flex_timescale(timestamp) as hodex, devid, slot, sum(total_cpu)/sum(count) cpu_ave, sum(total_mem)/sum(count) as mem_ave, sum(total_disk)/sum(count) as disk_ave, sum(total_trate+total_erate+total_orate)/100.00/sum(count) as log_rate, sum(totalsession)/sum(count) as sessions, sum(sent)/sum(count) as sent_kbps, sum(recv)/sum(count) as recv_kbps, sum(sent+recv)/sum(count) as transmit_kbps, max(mem_peak) as mem_peak, max(disk_peak) as disk_peak, max(cpu_peak) as cpu_peak, max(lograte_peak)/100.00 as lograte_peak, max(session_peak) as session_peak, max(transmit_peak) as transmit_kbps_peak, sum(cps)/sum(count) as cps_ave, max(cps_peak) as cps_peak from ###(select $flex_timestamp as timestamp, devid, slot, sum(coalesce(trate, 0)) as total_trate, sum(coalesce(erate, 0)) as total_erate, sum(coalesce(orate, 0)) as total_orate, min(itime) as first_seen, max(itime) as last_seen, sum(coalesce(mem, 0)) as total_mem, max(coalesce(mem, 0)) as mem_peak, sum(coalesce(disk, 0)) as total_disk, max(coalesce(disk, 0)) as disk_peak, sum(coalesce(cpu, 0)) as total_cpu, max(coalesce(cpu, 0)) as cpu_peak, max(coalesce(trate, 0)+coalesce(erate, 0)+coalesce(orate, 0)) as lograte_peak, sum(coalesce(totalsession, 0)) as totalsession, max(coalesce(totalsession, 0)) as session_peak, sum(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)) as sent, sum(cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as recv, max(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)+cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as transmit_peak, sum(coalesce(setuprate, 0)) as cps, max(coalesce(setuprate, 0)) as cps_peak, count(*) as count from $log where $filter and subtype='system' and action='perf-stats' group by timestamp, devid, slot order by total_mem desc)### t where $filter-drilldown group by hodex, devid, slot) t group by hodex, devid, role) t group by hodex order by hodex"
            config variable
                edit "devid"
                    set var-name "devid"
                    set var-expression "devid"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "resource-summary-view"
        set description "Fortigate resource summary view"
        set log-type event
        set query "select devid, get_fgt_role(devid, slot) as role, cast(sum(cpu_ave)/count(*) as decimal(6, 0)) as cpu_ave, cast(sum(mem_ave)/count(*) as decimal(6, 0)) as mem_ave, cast(sum(disk_ave)/count(*) as decimal(6, 0)) as disk_ave, cast(sum(log_rate) as decimal(10, 2)) as log_rate, cast(sum(sessions) as decimal(10, 0)) as sessions, cast(sum(sent_kbps) as decimal(10, 0)) as sent_kbps, cast(sum(recv_kbps) as decimal(10, 0)) as recv_kbps, cast(sum(transmit_kbps) as decimal(10, 0)) as transmit_kbps, max(mem_peak) as mem_peak, max(disk_peak) as disk_peak, max(cpu_peak) as cpu_peak, cast(max(lograte_peak) as decimal(10, 2)) as lograte_peak, max(session_peak) as session_peak, max(transmit_kbps_peak) as transmit_kbps_peak from (select devid, slot, sum(total_cpu)/sum(count) as cpu_ave, sum(total_mem)/sum(count) as mem_ave, sum(total_disk)/sum(count) as disk_ave, sum(total_trate+total_erate+total_orate)/100.00/sum(count) as log_rate, sum(totalsession)/sum(count) as sessions, sum(sent)/sum(count) as sent_kbps, sum(recv)/sum(count) as recv_kbps, sum(sent+recv)/sum(count) as transmit_kbps, max(mem_peak) as mem_peak, max(disk_peak) as disk_peak, max(cpu_peak) as cpu_peak, max(lograte_peak)/100.00 as lograte_peak, max(session_peak) as session_peak, max(transmit_peak) as transmit_kbps_peak from ###(select $flex_timestamp as timestamp, devid, slot, sum(coalesce(trate, 0)) as total_trate, sum(coalesce(erate, 0)) as total_erate, sum(coalesce(orate, 0)) as total_orate, min(itime) as first_seen, max(itime) as last_seen, sum(coalesce(mem, 0)) as total_mem, max(coalesce(mem, 0)) as mem_peak, sum(coalesce(disk, 0)) as total_disk, max(coalesce(disk, 0)) as disk_peak, sum(coalesce(cpu, 0)) as total_cpu, max(coalesce(cpu, 0)) as cpu_peak, max(coalesce(trate, 0)+coalesce(erate, 0)+coalesce(orate, 0)) as lograte_peak, sum(coalesce(totalsession, 0)) as totalsession, max(coalesce(totalsession, 0)) as session_peak, sum(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)) as sent, sum(cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as recv, max(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)+cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as transmit_peak, sum(coalesce(setuprate, 0)) as cps, max(coalesce(setuprate, 0)) as cps_peak, count(*) as count from $log where $filter and subtype='system' and action='perf-stats' group by timestamp, devid, slot order by total_mem desc)### t group by devid, slot) t group by devid, role order by devid, role"
        set protected enable
    next
    edit "Top-Interested-Apps-By-Bandwidth"
        set description "Top Interested Applications by Bandwidth Usage"
        set log-type traffic
        set query "select app, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###(select timestamp, user_src, appid, app, appcat, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t where appcat in ('P2P', 'Storage.Backup', 'File.Sharing', 'Video/Audio') group by timestamp, user_src, appid, app, appcat /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t group by app having sum(bandwidth)>0 order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
                edit "appcat"
                    set var-name "appcat"
                next
            end
        set protected enable
    next
    edit "Interested-Applications-by-Risk-Level"
        set description "Interested Applications by Risk Level"
        set log-type traffic
        set query "select app, min(id) as id, appcat, max(risk) as d_risk, (case when max(risk)='5' then 'Critical' when max(risk)='4' then 'High' when max(risk)='3' then 'Medium' when max(risk)='2' then 'Low' else 'Info' end) as risk_level, sum(sessions) as sessions, sum(traffic_out) as sent, sum(traffic_in) as received, sum(bandwidth) as bandwidth from ###(select timestamp, user_src, appid, app, appcat, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t where appcat in ('P2P', 'Storage.Backup', 'File.Sharing', 'Video/Audio') group by timestamp, user_src, appid, app, appcat /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t1 inner join app_mdata t2 on lower(t1.app)=lower(t2.name) group by app, appcat order by d_risk desc, bandwidth desc"
        set hidden enable
        set protected enable
    next
    edit "Top-Interested-Apps-by-Number-of-Users"
        set description "Top Applications by number of users"
        set log-type traffic
        set query "select app, count(distinct user_src) as number from ###(select timestamp, user_src, appid, app, appcat, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t where appcat in ('P2P', 'Storage.Backup', 'File.Sharing', 'Video/Audio') group by timestamp, user_src, appid, app, appcat /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t group by app order by number desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "Total-Number-of-P2P-Apps"
        set description "Total Number of P2P Application"
        set log-type traffic
        set query "select count(distinct app) as number from ###(select timestamp, user_src, appid, app, appcat, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t where appcat in ('P2P', 'Storage.Backup', 'File.Sharing', 'Video/Audio') group by timestamp, user_src, appid, app, appcat /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t where $filter-drilldown and appcat='P2P'"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "Total-Number-of-P2P-Users"
        set description "Total Number of P2P Users"
        set log-type traffic
        set query "select count(distinct user_src) as number from ###(select timestamp, user_src, appid, app, appcat, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t where appcat in ('P2P', 'Storage.Backup', 'File.Sharing', 'Video/Audio') group by timestamp, user_src, appid, app, appcat /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t where appcat='P2P'"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "Total-Usage-of-P2P-Applications"
        set description "Total Usage of P2P Applications"
        set log-type traffic
        set query "select sum(bandwidth) as bandwidth from ###(select timestamp, user_src, appid, app, appcat, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t where appcat in ('P2P', 'Storage.Backup', 'File.Sharing', 'Video/Audio') group by timestamp, user_src, appid, app, appcat /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t where appcat='P2P'"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "Total-Sessions-of-P2P-Applications"
        set description "Total Sessions of P2P Applications"
        set log-type traffic
        set query "select sum(sessions) as total_num from ###(select timestamp, user_src, appid, app, appcat, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t where appcat in ('P2P', 'Storage.Backup', 'File.Sharing', 'Video/Audio') group by timestamp, user_src, appid, app, appcat /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t where appcat='P2P'"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "Total-Number-of-file-sharing-Applications"
        set description "Total Number of file sharing Applications"
        set log-type traffic
        set query "select count(distinct app) as number from ###(select timestamp, user_src, appid, app, appcat, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t where appcat in ('P2P', 'Storage.Backup', 'File.Sharing', 'Video/Audio') group by timestamp, user_src, appid, app, appcat /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t where appcat in ('Storage.Backup', 'File.Sharing')"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "Total-Number-of-file-sharing-Users"
        set description "Total Number of file sharing Users"
        set log-type traffic
        set query "select count(distinct user_src) as number from ###(select timestamp, user_src, appid, app, appcat, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t where appcat in ('P2P', 'Storage.Backup', 'File.Sharing', 'Video/Audio') group by timestamp, user_src, appid, app, appcat /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t where appcat in ('Storage.Backup', 'File.Sharing')"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "Total-Usage-of-file-sharing-Applications"
        set description "Total Usage of file sharing Applications"
        set log-type traffic
        set query "select sum(bandwidth) as bandwidth from ###(select timestamp, user_src, appid, app, appcat, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t where appcat in ('P2P', 'Storage.Backup', 'File.Sharing', 'Video/Audio') group by timestamp, user_src, appid, app, appcat /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t where appcat in ('Storage.Backup', 'File.Sharing')"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "Total-Sessions-of-file-sharing-Applications"
        set description "Total Sessions of file sharing Applications"
        set log-type traffic
        set query "select sum(sessions) as total_num from ###(select timestamp, user_src, appid, app, appcat, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t where appcat in ('P2P', 'Storage.Backup', 'File.Sharing', 'Video/Audio') group by timestamp, user_src, appid, app, appcat /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t where appcat in ('Storage.Backup', 'File.Sharing')"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "Total-Number-of-Video-Audio-Applications"
        set description "Total Number of Video Audio Applications"
        set log-type traffic
        set query "select count(distinct app) as number from ###(select timestamp, user_src, appid, app, appcat, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t where appcat in ('P2P', 'Storage.Backup', 'File.Sharing', 'Video/Audio') group by timestamp, user_src, appid, app, appcat /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t where appcat='Video\/Audio'"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "Total-Number-of-Video-Audio-Users"
        set description "Total Number of Video Audio Users"
        set log-type traffic
        set query "select count(distinct user_src) as number from ###(select timestamp, user_src, appid, app, appcat, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t where appcat in ('P2P', 'Storage.Backup', 'File.Sharing', 'Video/Audio') group by timestamp, user_src, appid, app, appcat /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t where appcat='Video\/Audio'"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "Total-Usage-of-Video-Audio-Applications"
        set description "Total Usage of Video Audio Applications"
        set log-type traffic
        set query "select sum(bandwidth) as bandwidth from ###(select timestamp, user_src, appid, app, appcat, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t where appcat in ('P2P', 'Storage.Backup', 'File.Sharing', 'Video/Audio') group by timestamp, user_src, appid, app, appcat /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t where appcat='Video\/Audio'"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "Total-Sessions-of-Video-Audio-Applications"
        set description "Total Sessions of Video Audio Applications"
        set log-type traffic
        set query "select sum(sessions) as total_num from ###(select timestamp, user_src, appid, app, appcat, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t where appcat in ('P2P', 'Storage.Backup', 'File.Sharing', 'Video/Audio') group by timestamp, user_src, appid, app, appcat /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t where appcat='Video\/Audio'"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "Total-Number-of-Apps"
        set description "Total Number of Application"
        set log-type traffic
        set query "select count(distinct app) as num_app from ###(select user_src, appid, app, appcat, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t group by user_src, appid, app, appcat /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "Total-Number-of-App-Category"
        set description "Total Number of Application Categories"
        set log-type traffic
        set query "select count(distinct appcat) as num_appcat from ###(select user_src, appid, app, appcat, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t group by user_src, appid, app, appcat /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "Total-Number-of-App-Users"
        set description "Total Number of Application Users"
        set log-type traffic
        set query "select count(distinct user_src) as num_user from ###(select user_src, appid, app, appcat, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t group by user_src, appid, app, appcat /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "Total-Usage-of-Applications"
        set description "Total Usage of Application"
        set log-type traffic
        set query "select sum(bandwidth) as bandwidth from ###(select user_src, appid, app, appcat, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t group by user_src, appid, app, appcat /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "Total-Usage-of-Applications-Per-Day"
        set description "Total Usage of Application Per Day"
        set log-type traffic
        set query "select cast((sum(bandwidth)/$days_num) as decimal(18,0)) as bandwidth_perday from ###(select user_src, appid, app, appcat, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t group by user_src, appid, app, appcat /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "Top-App-Category-by-Bandwidth"
        set description "Top Application Categories by Bandwidth Usage"
        set log-type traffic
        set query "select appcat, sum(bandwidth) as bandwidth from ###(select user_src, appid, app, appcat, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t group by user_src, appid, app, appcat /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t where $filter-drilldown group by appcat order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "Top-Interested-App-Users-By-Bandwidth-Timeline"
        set description "Top Interested Application Users by Bandwidth Timeline"
        set log-type traffic
        set query "select hodex, t1.user_src, t1.bandwidth from (select $flex_timescale(timestamp) as hodex, user_src, sum(bandwidth) as bandwidth from ###(select timestamp, user_src, appid, app, appcat, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t where appcat in ('P2P', 'Storage.Backup', 'File.Sharing', 'Video/Audio') group by timestamp, user_src, appid, app, appcat /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t group by hodex, user_src having sum(bandwidth)>0 order by hodex) t1 inner join (select user_src, sum(bandwidth) as bandwidth from ###(select timestamp, user_src, appid, app, appcat, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t where appcat in ('P2P', 'Storage.Backup', 'File.Sharing', 'Video/Audio') group by timestamp, user_src, appid, app, appcat /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t group by user_src order by bandwidth desc limit $ddown-top) t2 on t1.user_src=t2.user_src order by hodex"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "Top-Interested-App-Users-By-Bandwidth"
        set description "Top Interested Application Users by Bandwidth"
        set log-type traffic
        set query "select user_src, sum(bandwidth) as bandwidth from ###(select timestamp, user_src, appid, app, appcat, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t where appcat in ('P2P', 'Storage.Backup', 'File.Sharing', 'Video/Audio') group by timestamp, user_src, appid, app, appcat /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t group by user_src having sum(bandwidth)>0 order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "soc-Event-vs-Incident-Today-Trend"
        set description "Events vs Incidents Today Trend"
        set query "select item, num_cur, num_pre, num_diff from (select 'Events' as item, num_cur, num_pre, (num_cur-num_pre) as num_diff from (select (select count(*) from $event t1 left join devtable_ext t2 on t1.dvid=t2.dvid where $filter-drilldown and $cust_time_filter(alerttime,TODAY)) as num_cur, (select count(*) from $event t1 left join devtable_ext t2 on t1.dvid=t2.dvid where $filter-drilldown and $cust_time_filter(alerttime,YESTERDAY)) as num_pre) t union all select 'Incidents' as item, num_cur, num_pre, (num_cur-num_pre) as num_diff from (select (select count(*) from $incident where $cust_time_filter(createtime,TODAY)) as num_cur, (select count(*) from $incident where $cust_time_filter(createtime,YESTERDAY)) as num_pre) t) t order by item"
        set protected enable
    next
    edit "soc-Event-vs-Incident-History-Trend"
        set description "Events vs Incidents History Trend"
        set query "select item, num_cur, num_pre, num_diff from (select 'Events' as item, num_cur, num_pre, (num_cur-num_pre) as num_diff from (select (select count(*) from $event t1 left join devtable_ext t2 on t1.dvid=t2.dvid where $filter-drilldown and $cust_time_filter(alerttime)) as num_cur, (select count(*) from $event t1 left join devtable_ext t2 on t1.dvid=t2.dvid where $filter-drilldown and $cust_time_filter(alerttime,LAST_N_PERIOD,1)) as num_pre) t union all select 'Incidents' as item, num_cur, num_pre, (num_cur-num_pre) as num_diff from (select (select count(*) from $incident where $cust_time_filter(createtime)) as num_cur, (select count(*) from $incident where $cust_time_filter(createtime,LAST_N_PERIOD,1)) as num_pre) t) t order by item"
        set protected enable
    next
    edit "soc-Event-vs-Incident-Trend"
        set description "Events vs Incidents Trend"
        set query "select t1.item, t1.num_cur as num_today, t1.num_pre as num_yesterday, t1.num_diff as num_diff1, t2.num_cur as num_this_period, t2.num_pre as num_last_period, t2.num_diff as num_diff2 from (select 'Events' as item, num_cur, num_pre, (num_cur-num_pre) as num_diff from (select (select count(*) from $event t1 left join devtable_ext t2 on t1.dvid=t2.dvid where $filter-drilldown and $cust_time_filter(alerttime,TODAY)) as num_cur, (select count(*) from $event t1 left join devtable_ext t2 on t1.dvid=t2.dvid where $filter-drilldown and $cust_time_filter(alerttime,YESTERDAY)) as num_pre) t union all select 'Incidents' as item, num_cur, num_pre, (num_cur-num_pre) as num_diff from (select (select count(*) from $incident where $cust_time_filter(createtime,TODAY)) as num_cur, (select count(*) from $incident where $cust_time_filter(createtime,YESTERDAY)) as num_pre) t) t1 full join (select 'Events' as item, num_cur, num_pre, (num_cur-num_pre) as num_diff from (select (select count(*) from $event t1 left join devtable_ext t2 on t1.dvid=t2.dvid where $filter-drilldown and $cust_time_filter(alerttime)) as num_cur, (select count(*) from $event t1 left join devtable_ext t2 on t1.dvid=t2.dvid where $filter-drilldown and $cust_time_filter(alerttime,LAST_N_PERIOD,1)) as num_pre) t union all select 'Incidents' as item, num_cur, num_pre, (num_cur-num_pre) as num_diff from (select (select count(*) from $incident where $cust_time_filter(createtime)) as num_cur, (select count(*) from $incident where $cust_time_filter(createtime,LAST_N_PERIOD,1)) as num_pre) t) t2 on t1.item=t2.item order by t1.item"
        set protected enable
    next
    edit "soc-Total-Event-by-Severity"
        set description "Total Events by Severity"
        set query "select (CASE severity WHEN 0 THEN 'Critical' WHEN 1 THEN 'High' WHEN 2 THEN 'Medium' WHEN 3 THEN 'Low' ELSE NULL END) as sev, count(*) as num_events from $event t1 left join devtable_ext t2 on t1.dvid=t2.dvid where $cust_time_filter(alerttime) and $filter-drilldown group by severity order by severity desc"
        set protected enable
    next
    edit "soc-Total-Event-by-Severity-History"
        set description "Total Events by Severity History"
        set query "select dom, (CASE severity WHEN 0 THEN 'Critical' WHEN 1 THEN 'High' WHEN 2 THEN 'Medium' WHEN 3 THEN 'Low' ELSE NULL END) as sev, sum(num_events) as num_events from (select dom, unnest(agg_sev) as severity, unnest(agg_num) as num_events from (select $DAY_OF_MONTH(agg_time) as dom, array[0, 1, 2, 3] as agg_sev, array[max(num_sev_critical), max(num_sev_high), max(num_sev_medium), max(num_sev_low)] as agg_num from $event_history where $filter-drilldown and $cust_time_filter(agg_time) group by dom order by dom) t) t group by dom, severity order by dom, severity"
        set protected enable
    next
    edit "soc-Total-Event-by-Severity-Category"
        set description "Total Events Count by Severity and Category"
        set query "select (CASE severity WHEN 0 THEN 'Critical' WHEN 1 THEN 'High' WHEN 2 THEN 'Medium' WHEN 3 THEN 'Low' ELSE NULL END) as sev, triggername, count(*) as num_events from $event t1 left join devtable_ext t2 on t1.dvid=t2.dvid where $cust_time_filter(alerttime) and $filter-drilldown group by severity, triggername order by severity desc, triggername"
        set protected enable
    next
    edit "soc-Total-Incident-by-Severity"
        set description "Total Incidents by Severity"
        set query "select severity, count(*) as num_inc from $incident where  $filter-drilldown group by severity order by severity"
        set protected enable
    next
    edit "soc-Total-Event-vs-Incident-History"
        set description "Total Events vs Incidents History"
        set query "select coalesce(t1.hodex, t2.hodex) as hodex, coalesce(num_event_total, 0) as num_event_total, coalesce(num_inc_total, 0) as num_inc_total, coalesce(num_event_high, 0) as num_event_high from (select $flex_timescale(agg_time) as hodex, max(num_total) as num_event_total, max(num_sev_critical+num_sev_high) as num_event_high from $event_history where $cust_time_filter(agg_time) group by hodex order by hodex) t1 full join (select $flex_timescale(agg_time) as hodex, max(num_sev_high+num_sev_medium+num_sev_low) as num_inc_total from $incident_history where $cust_time_filter(agg_time) group by hodex order by hodex) t2 on t1.hodex=t2.hodex order by hodex"
        set protected enable
    next
    edit "soc-Incident-List"
        set description "List of Incidents"
        set query "select incid_to_str(incid) as incnum, from_itime(createtime) as timestamp, inc_cat_encode(category) as category, severity, status, endpoint from $incident where $cust_time_filter(createtime) order by createtime desc"
        set protected enable
    next
    edit "soc-Incident-by-Severity"
        set description "Incidents by Severity"
        set query "select severity, count(*) as incnum from $incident where $cust_time_filter(createtime) group by severity order by incnum desc"
        set protected enable
    next
    edit "soc-Incident-by-Status"
        set description "Incidents by Status"
        set query "select status, count(*) as incnum from $incident where $cust_time_filter(createtime) group by status order by incnum desc"
        set protected enable
    next
    edit "soc-Incident-by-Category-Unresolved"
        set description "Unresolved Incidents by Category"
        set query "select inc_cat_encode(category) as category, count(*) as incnum from $incident where $cust_time_filter(createtime) and status not in ('closed', 'cancelled') group by category order by incnum desc"
        set protected enable
    next
    edit "soc-Incident-by-Severity-Unresolved"
        set description "Unresolved Incidents by Severity"
        set query "select severity, count(*) as incnum from $incident where $cust_time_filter(createtime) and status not in ('closed', 'cancelled') group by severity order by incnum desc"
        set protected enable
    next
    edit "soc-Incident-Timeline-by-Category"
        set description "Incidents Timeline by Category"
        set query "select $flex_timescale(agg_time) as hodex, max(num_cat_cat1) as num_cat1, max(num_cat_cat2) as num_cat2, max(num_cat_cat3) as num_cat3, max(num_cat_cat4) as num_cat4, max(num_cat_cat5) as num_cat5, max(num_cat_cat6) as num_cat6 from $incident_history where $cust_time_filter(agg_time) group by hodex order by hodex"
        set protected enable
    next
    edit "soc-Incident-List-Unresolved"
        set description "List of Unresolved Incidents"
        set query "select incid_to_str(incid) as incnum, from_itime(createtime) as timestamp, severity, status, endpoint, description from $incident where $cust_time_filter(createtime) and status not in ('closed', 'cancelled') order by severity desc"
        set protected enable
    next
    edit "fex-RSRQ-timeline"
        set description "FortiExtender RSRQ timeline"
        set log-type event
        set query "select $flex_timescale(timestamp) as hodex, cast(sum(rsrq_sum)/sum(count) as decimal(18, 2)) || 'dB' as rsrq from ###(select $flex_timestamp(dtime) as timestamp, sum(to_number(rsrq, '999999.99')) as rsrq_sum, sum(to_number(sinr, '999999.99')) as sinr_sum, count(*) as count from $log where $filter and logid='0111046409' group by timestamp order by timestamp desc)### t group by hodex order by hodex desc"
        set protected enable
    next
    edit "fex-SINR-timeline"
        set description "FortiExtender SINR timeline"
        set log-type event
        set query "select $flex_timescale(timestamp) as hodex, cast(sum(sinr_sum)/sum(count) as decimal(18, 0)) || 'dB' as sinr from ###(select $flex_timestamp(dtime) as timestamp, sum(to_number(rsrq, '999999.99')) as rsrq_sum, sum(to_number(sinr, '999999.99')) as sinr_sum, count(*) as count from $log where $filter and logid='0111046409' group by timestamp order by timestamp desc)### t group by hodex order by hodex desc"
        set protected enable
    next
    edit "fgt-device-monitoring-inventory"
        set description "FortiGate Device Monitoring Inventory"
        set log-type event
        set query "select devname, (' ' || devid) as id_devid, ip, platform, os, '1' as total_num from $func-fgt-inventory as t1 where exists (select 1 from devtable_ext t2 where $dev_filter and t2.devid=t1.devid) order by devname"
        set protected enable
        set hidden disable
    next

    edit "fgt-inventory-hardware"
        set description "FortiGate Monitoring Inventory Hardware"
        set log-type event
        set query "select platform, count(*) as total_num from $func-fgt-inventory as t1 where exists (select 1 from devtable_ext t2 where $dev_filter and t2.devid=t1.devid) group by platform order by total_num desc"
        set protected enable
        set hidden disable
    next

    edit "fgt-inventory-software"
        set description "FortiGate Monitoring Inventory Software"
        set log-type event
        set query "select 'FortiOS' as sf_name, (platform || ' ' || os) as firmware, count(*) as total_num from $func-fgt-inventory as t1 where exists (select 1 from devtable_ext t2 where $dev_filter and t2.devid=t1.devid) group by platform, os order by total_num desc"
        set protected enable
        set hidden disable
    next

    edit "fgt-resource-utilization-timeline"
        set description "FortiGate cpu utilization timeline"
        set log-type event
        set query "select $flex_timescale(timestamp) as hodex, devid, cast(sum(total_cpu)/sum(count) as decimal(6, 0)) as cpu_ave, cast(sum(total_mem)/sum(count) as decimal(6, 0)) as mem_ave, cast(sum(total_disk)/sum(count) as decimal(6, 0)) as disk_ave, cast(sum(sent)/sum(count) as decimal(10, 0)) as sent_kbps, cast(sum(recv)/sum(count) as decimal(10, 0)) as recv_kbps from ###(select $flex_timestamp as timestamp, devid, slot, sum(coalesce(trate, 0)) as total_trate, sum(coalesce(erate, 0)) as total_erate, sum(coalesce(orate, 0)) as total_orate, min(itime) as first_seen, max(itime) as last_seen, sum(coalesce(mem, 0)) as total_mem, max(coalesce(mem, 0)) as mem_peak, sum(coalesce(disk, 0)) as total_disk, max(coalesce(disk, 0)) as disk_peak, sum(coalesce(cpu, 0)) as total_cpu, max(coalesce(cpu, 0)) as cpu_peak, max(coalesce(trate, 0)+coalesce(erate, 0)+coalesce(orate, 0)) as lograte_peak, sum(coalesce(totalsession, 0)) as totalsession, max(coalesce(totalsession, 0)) as session_peak, sum(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)) as sent, sum(cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as recv, max(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)+cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as transmit_peak, sum(coalesce(setuprate, 0)) as cps, max(coalesce(setuprate, 0)) as cps_peak, count(*) as count from $log where $filter and subtype='system' and action='perf-stats' group by timestamp, devid, slot order by total_mem desc)### t where $filter-drilldown group by hodex, devid order by hodex"
            config variable
                edit "devid"
                    set var-name "devid"
                    set var-expression "devid"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next

    edit "resource-summary-view-cpu"
        set description "FortiGate cpu summary view"
        set log-type event
        set query "select devid, cast(sum(total_cpu)/sum(count) as decimal(6, 0)) as cpu_ave, max(cpu_peak) as cpu_peak from ###(select $flex_timestamp as timestamp, devid, slot, sum(coalesce(trate, 0)) as total_trate, sum(coalesce(erate, 0)) as total_erate, sum(coalesce(orate, 0)) as total_orate, min(itime) as first_seen, max(itime) as last_seen, sum(coalesce(mem, 0)) as total_mem, max(coalesce(mem, 0)) as mem_peak, sum(coalesce(disk, 0)) as total_disk, max(coalesce(disk, 0)) as disk_peak, sum(coalesce(cpu, 0)) as total_cpu, max(coalesce(cpu, 0)) as cpu_peak, max(coalesce(trate, 0)+coalesce(erate, 0)+coalesce(orate, 0)) as lograte_peak, sum(coalesce(totalsession, 0)) as totalsession, max(coalesce(totalsession, 0)) as session_peak, sum(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)) as sent, sum(cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as recv, max(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)+cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as transmit_peak, sum(coalesce(setuprate, 0)) as cps, max(coalesce(setuprate, 0)) as cps_peak, count(*) as count from $log where $filter and subtype='system' and action='perf-stats' group by timestamp, devid, slot order by total_mem desc)### t group by devid order by cpu_peak desc"
        set protected enable
    next
    edit "resource-summary-view-memory"
        set description "FortiGate memory summary view"
        set log-type event
        set query "select devid, cast(sum(total_mem)/sum(count) as decimal(6, 0)) as mem_ave, max(mem_peak) as mem_peak from ###(select $flex_timestamp as timestamp, devid, slot, sum(coalesce(trate, 0)) as total_trate, sum(coalesce(erate, 0)) as total_erate, sum(coalesce(orate, 0)) as total_orate, min(itime) as first_seen, max(itime) as last_seen, sum(coalesce(mem, 0)) as total_mem, max(coalesce(mem, 0)) as mem_peak, sum(coalesce(disk, 0)) as total_disk, max(coalesce(disk, 0)) as disk_peak, sum(coalesce(cpu, 0)) as total_cpu, max(coalesce(cpu, 0)) as cpu_peak, max(coalesce(trate, 0)+coalesce(erate, 0)+coalesce(orate, 0)) as lograte_peak, sum(coalesce(totalsession, 0)) as totalsession, max(coalesce(totalsession, 0)) as session_peak, sum(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)) as sent, sum(cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as recv, max(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)+cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as transmit_peak, sum(coalesce(setuprate, 0)) as cps, max(coalesce(setuprate, 0)) as cps_peak, count(*) as count from $log where $filter and subtype='system' and action='perf-stats' group by timestamp, devid, slot order by total_mem desc)### t group by devid order by mem_peak desc"
        set protected enable
    next
    edit "resource-summary-view-disk"
        set description "FortiGate disk summary view"
        set log-type event
        set query "select devid, cast(sum(total_disk)/sum(count) as decimal(6, 0)) as disk_ave, max(disk_peak) as disk_peak from ###(select $flex_timestamp as timestamp, devid, slot, sum(coalesce(trate, 0)) as total_trate, sum(coalesce(erate, 0)) as total_erate, sum(coalesce(orate, 0)) as total_orate, min(itime) as first_seen, max(itime) as last_seen, sum(coalesce(mem, 0)) as total_mem, max(coalesce(mem, 0)) as mem_peak, sum(coalesce(disk, 0)) as total_disk, max(coalesce(disk, 0)) as disk_peak, sum(coalesce(cpu, 0)) as total_cpu, max(coalesce(cpu, 0)) as cpu_peak, max(coalesce(trate, 0)+coalesce(erate, 0)+coalesce(orate, 0)) as lograte_peak, sum(coalesce(totalsession, 0)) as totalsession, max(coalesce(totalsession, 0)) as session_peak, sum(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)) as sent, sum(cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as recv, max(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)+cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as transmit_peak, sum(coalesce(setuprate, 0)) as cps, max(coalesce(setuprate, 0)) as cps_peak, count(*) as count from $log where $filter and subtype='system' and action='perf-stats' group by timestamp, devid, slot order by total_mem desc)### t group by devid order by disk_peak desc"
        set protected enable
    next
    edit "resource-summary-view-intf"
        set description "FortiGate interface summary view"
        set log-type event
        set query "select devid, cast(sum(sent)/sum(count) as decimal(10, 0)) as sent_kbps, cast(sum(recv)/sum(count) as decimal(10, 0)) as recv_kbps, cast(sum(sent+recv)/sum(count) as decimal(10, 0)) as transmit_kbps, max(transmit_peak) as transmit_kbps_peak from ###(select $flex_timestamp as timestamp, devid, slot, sum(coalesce(trate, 0)) as total_trate, sum(coalesce(erate, 0)) as total_erate, sum(coalesce(orate, 0)) as total_orate, min(itime) as first_seen, max(itime) as last_seen, sum(coalesce(mem, 0)) as total_mem, max(coalesce(mem, 0)) as mem_peak, sum(coalesce(disk, 0)) as total_disk, max(coalesce(disk, 0)) as disk_peak, sum(coalesce(cpu, 0)) as total_cpu, max(coalesce(cpu, 0)) as cpu_peak, max(coalesce(trate, 0)+coalesce(erate, 0)+coalesce(orate, 0)) as lograte_peak, sum(coalesce(totalsession, 0)) as totalsession, max(coalesce(totalsession, 0)) as session_peak, sum(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)) as sent, sum(cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as recv, max(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)+cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as transmit_peak, sum(coalesce(setuprate, 0)) as cps, max(coalesce(setuprate, 0)) as cps_peak, count(*) as count from $log where $filter and subtype='system' and action='perf-stats' group by timestamp, devid, slot order by total_mem desc)### t group by devid order by transmit_kbps_peak desc"
        set protected enable
    next

    edit "fgt-session-total-summary"
        set description "FortiGate Total Sessions"
        set log-type event
        set query "select devid, max(session_peak) as max_session, cast(sum(totalsession)/sum(count) as decimal(10, 0)) as sessions, max(cps_peak) as cps_peak, cast(sum(cps)/sum(count) as decimal(10, 0)) as cps_ave from ###(select $flex_timestamp as timestamp, devid, slot, sum(coalesce(trate, 0)) as total_trate, sum(coalesce(erate, 0)) as total_erate, sum(coalesce(orate, 0)) as total_orate, min(itime) as first_seen, max(itime) as last_seen, sum(coalesce(mem, 0)) as total_mem, max(coalesce(mem, 0)) as mem_peak, sum(coalesce(disk, 0)) as total_disk, max(coalesce(disk, 0)) as disk_peak, sum(coalesce(cpu, 0)) as total_cpu, max(coalesce(cpu, 0)) as cpu_peak, max(coalesce(trate, 0)+coalesce(erate, 0)+coalesce(orate, 0)) as lograte_peak, sum(coalesce(totalsession, 0)) as totalsession, max(coalesce(totalsession, 0)) as session_peak, sum(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)) as sent, sum(cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as recv, max(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)+cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as transmit_peak, sum(coalesce(setuprate, 0)) as cps, max(coalesce(setuprate, 0)) as cps_peak, count(*) as count from $log where $filter and subtype='system' and action='perf-stats' group by timestamp, devid, slot order by total_mem desc)### t group by devid order by max_session desc"
        set protected enable
    next

    edit "fgt-session-rate-summary"
        set description "FortiGate Session Rate"
        set log-type event
        set query "select devid, max(cps_peak) as max_rate from ###(select $flex_timestamp as timestamp, devid, slot, sum(coalesce(trate, 0)) as total_trate, sum(coalesce(erate, 0)) as total_erate, sum(coalesce(orate, 0)) as total_orate, min(itime) as first_seen, max(itime) as last_seen, sum(coalesce(mem, 0)) as total_mem, max(coalesce(mem, 0)) as mem_peak, sum(coalesce(disk, 0)) as total_disk, max(coalesce(disk, 0)) as disk_peak, sum(coalesce(cpu, 0)) as total_cpu, max(coalesce(cpu, 0)) as cpu_peak, max(coalesce(trate, 0)+coalesce(erate, 0)+coalesce(orate, 0)) as lograte_peak, sum(coalesce(totalsession, 0)) as totalsession, max(coalesce(totalsession, 0)) as session_peak, sum(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)) as sent, sum(cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as recv, max(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)+cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as transmit_peak, sum(coalesce(setuprate, 0)) as cps, max(coalesce(setuprate, 0)) as cps_peak, count(*) as count from $log where $filter and subtype='system' and action='perf-stats' group by timestamp, devid, slot order by total_mem desc)### t group by devid order by max_rate desc"
        set protected enable
    next

    edit "fgt-intf-down-timeline"
        set description "FortiGate Interface Down Timeline"
        set log-type event
        set query "select $flex_timescale(timestamp) as hodex, devid, sum(total_num) as total_num from ###(select $flex_timestamp as timestamp, devid, status, count(*) as total_num from $log where $filter and logid_to_int(logid)=20099 and status='DOWN' group by timestamp, devid, status)### t where $filter-drilldown group by hodex, devid order by hodex"
            config variable
                edit "devid"
                    set var-name "devid"
                    set var-expression "devid"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "fgt-intf-down-dev"
        set description "FortiGate Interface Down by Device"
        set log-type event
        set query "select devid, status, sum(total_num) as total_num from ###(select $flex_timestamp as timestamp, devid, status, count(*) as total_num from $log where $filter and logid_to_int(logid)=20099 and status='DOWN' group by timestamp, devid, status)### t group by devid, status order by total_num desc"
        set protected enable
    next

    edit "fgt-ha-failure-timeline"
        set description "FortiGate HA Failure Timeline"
        set log-type event
        set query "select $flex_timescale(timestamp) as hodex, count(*) as total_num from ###(select $flex_timestamp as timestamp, dtime, devid, coalesce(nullifna(logdesc), msg) as msg_desc from $log where $filter and subtype='ha' and logid_to_int(logid) in (35011, 35012, 35013, 37892, 37893, 37897, 37898, 37901, 37902, 37907, 37908) order by dtime desc)### t group by hodex order by hodex"
        set protected enable
    next
    edit "fgt-ha-failure-summary"
        set description "FortiGate HA Failure Summary"
        set log-type event
        set query "select from_dtime(dtime) as time_s, devid, msg_desc from ###(select $flex_timestamp as timestamp, dtime, devid, coalesce(nullifna(logdesc), msg) as msg_desc from $log where $filter and subtype='ha' and logid_to_int(logid) in (35011, 35012, 35013, 37892, 37893, 37897, 37898, 37901, 37902, 37907, 37908) order by dtime desc)### t order by time_s desc"
        set protected enable
    next

    edit "fgt-faults-power"
        set description "FortiGate Power Supply Faults"
        set log-type event
        set query "select time_s, devid, msg_desc from ###(select from_dtime(dtime) as time_s, devid, coalesce(nullifna(logdesc), msg) as msg_desc, logid_to_int(logid) as logid from $log where $filter and logid_to_int(logid) in (22105, 22107, 22108, 22109) order by time_s desc)### t where logid in (22105, 22107) order by time_s desc"
        set protected enable
    next
    edit "fgt-faults-fan"
        set description "FortiGate Fan Faults"
        set log-type event
        set query "select time_s, devid, msg_desc from ###(select from_dtime(dtime) as time_s, devid, coalesce(nullifna(logdesc), msg) as msg_desc, logid_to_int(logid) as logid from $log where $filter and logid_to_int(logid) in (22105, 22107, 22108, 22109) order by time_s desc)### t where logid=22108 order by time_s desc"
        set protected enable
    next
    edit "fgt-faults-temperature"
        set description "FortiGate Temperatre Too High"
        set log-type event
        set query "select time_s, devid, msg_desc from ###(select from_dtime(dtime) as time_s, devid, coalesce(nullifna(logdesc), msg) as msg_desc, logid_to_int(logid) as logid from $log where $filter and logid_to_int(logid) in (22105, 22107, 22108, 22109) order by time_s desc)### t where logid=22109 order by time_s desc"
        set protected enable
    next

    edit "fgt-intf-stats-summary-sent-bps"
        set description "FortiGate Interface Sent Bit Rate"
        set log-type event
        set query "select (devname || ':' || intfname) as dev_intf, cast(sum(bps_out)/sum(interval)/1000 as decimal(10, 0)) as kbps_out_avg, cast(sum(bps_in)/sum(interval)/1000 as decimal(10, 0)) as kbps_in_avg, cast(sum(util_out)/sum(interval)/100 as decimal(10, 2)) as util_out_avg, cast(sum(util_in)/sum(interval)/100 as decimal(10, 2)) as util_in_avg from (select $flex_timestamp(timestamp) as tmstamp, tbl_intf.dvid, intfname, sum(interval) as interval, sum(sentbps*interval) as bps_out, sum(rcvdbps*interval) as bps_in, sum(sentutil*interval) as util_out, sum(rcvdutil*interval) as util_in from (select distinct dvid from ###(select dvid from $log-event where $filter and action='perf-stats' group by dvid)### t) tbl_log inner join intfstats tbl_intf on tbl_log.dvid = tbl_intf.dvid where $cust_time_filter(timestamp) group by tmstamp, tbl_intf.dvid, intfname) t1 left join devtable_ext t2 on t1.dvid = t2.dvid group by dev_intf order by kbps_out_avg desc"
        set protected enable
    next

    edit "fgt-intf-stats-summary-rcvd-bps"
        set description "FortiGate Interface Received Bit Rate"
        set log-type event
        set query "select (devname || ':' || intfname) as dev_intf, cast(sum(bps_out)/sum(interval)/1000 as decimal(10, 0)) as kbps_out_avg, cast(sum(bps_in)/sum(interval)/1000 as decimal(10, 0)) as kbps_in_avg, cast(sum(util_out)/sum(interval)/100 as decimal(10, 2)) as util_out_avg, cast(sum(util_in)/sum(interval)/100 as decimal(10, 2)) as util_in_avg from (select $flex_timestamp(timestamp) as tmstamp, tbl_intf.dvid, intfname, sum(interval) as interval, sum(sentbps*interval) as bps_out, sum(rcvdbps*interval) as bps_in, sum(sentutil*interval) as util_out, sum(rcvdutil*interval) as util_in from (select distinct dvid from ###(select dvid from $log-event where $filter and action='perf-stats' group by dvid)### t) tbl_log inner join intfstats tbl_intf on tbl_log.dvid = tbl_intf.dvid where $cust_time_filter(timestamp) group by tmstamp, tbl_intf.dvid, intfname) t1 left join devtable_ext t2 on t1.dvid = t2.dvid group by dev_intf order by kbps_in_avg desc"
        set protected enable
    next

    edit "fgt-intf-stats-summary-sent-util"
        set description "FortiGate Interface Sent Utilization"
        set log-type event
        set query "select (devname || ':' || intfname) as dev_intf, cast(sum(bps_out)/sum(interval)/1000 as decimal(10, 0)) as kbps_out_avg, cast(sum(bps_in)/sum(interval)/1000 as decimal(10, 0)) as kbps_in_avg, cast(sum(util_out)/sum(interval)/100 as decimal(10, 2)) as util_out_avg, cast(sum(util_in)/sum(interval)/100 as decimal(10, 2)) as util_in_avg from (select $flex_timestamp(timestamp) as tmstamp, tbl_intf.dvid, intfname, sum(interval) as interval, sum(sentbps*interval) as bps_out, sum(rcvdbps*interval) as bps_in, sum(sentutil*interval) as util_out, sum(rcvdutil*interval) as util_in from (select distinct dvid from ###(select dvid from $log-event where $filter and action='perf-stats' group by dvid)### t) tbl_log inner join intfstats tbl_intf on tbl_log.dvid = tbl_intf.dvid where $cust_time_filter(timestamp) group by tmstamp, tbl_intf.dvid, intfname) t1 left join devtable_ext t2 on t1.dvid = t2.dvid group by dev_intf order by util_out_avg desc, kbps_out_avg desc, kbps_in_avg desc"
        set protected enable
    next

    edit "fgt-intf-stats-summary-rcvd-util"
        set description "FortiGate Interface Received Utilization"
        set log-type event
        set query "select (devname || ':' || intfname) as dev_intf, cast(sum(bps_out)/sum(interval)/1000 as decimal(10, 0)) as kbps_out_avg, cast(sum(bps_in)/sum(interval)/1000 as decimal(10, 0)) as kbps_in_avg, cast(sum(util_out)/sum(interval)/100 as decimal(10, 2)) as util_out_avg, cast(sum(util_in)/sum(interval)/100 as decimal(10, 2)) as util_in_avg from (select $flex_timestamp(timestamp) as tmstamp, tbl_intf.dvid, intfname, sum(interval) as interval, sum(sentbps*interval) as bps_out, sum(rcvdbps*interval) as bps_in, sum(sentutil*interval) as util_out, sum(rcvdutil*interval) as util_in from (select distinct dvid from ###(select dvid from $log-event where $filter and action='perf-stats' group by dvid)### t) tbl_log inner join intfstats tbl_intf on tbl_log.dvid = tbl_intf.dvid where $cust_time_filter(timestamp) group by tmstamp, tbl_intf.dvid, intfname) t1 left join devtable_ext t2 on t1.dvid = t2.dvid group by dev_intf order by util_in_avg desc, kbps_in_avg desc, kbps_out_avg desc"
        set protected enable
    next

    edit "fgt-intf-stats-timeline"
        set description "FortiGate Interface Statistics Timeline"
        set log-type event
        set query "select $flex_timescale(tmstamp) as hodex, (devname || ':' || intfname) as dev_intf, cast(sum(bps_out)/sum(interval)/1000 as decimal(10, 0)) as kbps_out_avg, cast(sum(bps_in)/sum(interval)/1000 as decimal(10, 0)) as kbps_in_avg, cast(sum(util_out)/sum(interval)/100 as decimal(10, 2)) as util_out_avg, cast(sum(util_in)/sum(interval)/100 as decimal(10, 2)) as util_in_avg from (select $flex_timestamp(timestamp) as tmstamp, dvid, intfname, sum(interval) as interval, sum(sentbps*interval) as bps_out, sum(rcvdbps*interval) as bps_in, sum(sentutil*interval) as util_out, sum(rcvdutil*interval) as util_in from intfstats where $cust_time_filter(timestamp) group by tmstamp, dvid, intfname) t1 left join devtable_ext t2 on t1.dvid = t2.dvid where $filter-drilldown group by hodex, dev_intf order by hodex"
            config variable
                edit "dev_intf"
                    set var-name "dev_intf"
                    set var-expression "(devname || ':' || intfname)"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "chat-search-and-message-logging"
        set description "Bullying Chat Search and Message Logging"
        set log-type app-ctrl
        set query "select filename, min(id) as id, string_agg(distinct app, ' ') as app_agg, string_agg(distinct from_itime(itime)::text, ' ') as itime_agg, string_agg(distinct user_src, ', ') as user_agg, string_agg(distinct `group`, ' ') as group_agg, string_agg(distinct ipstr(`srcip`), ' ') as srcip_agg, count(*) as requests from ###(select filename, app, itime, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, `group`, `srcip` from $log where $filter and ($bully_keywords) and (lower(app) in ('facebook_post', 'facebook_chat', 'twitter_post', 'youtube_video.access', 'gmail_chat', 'gmail_send.message', 'linkedin_post', 'vimeo_video.access', 'google.search_search.phrase', 'bing.search_search.phrase')) order by itime desc)### t left join app_mdata t2 on lower(t.app)=lower(t2.name) group by filename order by requests desc"
        set protected enable
    next
    edit "user-chat-search-and-message-logging"
        set description "Users' Bullying Chat Search and Message Logging"
        set log-type app-ctrl
        set query "select user_src, filename, min(id) as id, string_agg(distinct app, ' ') as app_agg, string_agg(distinct from_itime(itime)::text, ' ') as itime_agg, string_agg(distinct `group`, ' ') as group_agg, string_agg(distinct ipstr(`srcip`), ' ') as srcip_agg, count(*) as requests from ###(select filename, app, itime, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, `group`, `srcip` from $log where $filter and ($bully_keywords) and (lower(app) in ('facebook_post', 'facebook_chat', 'twitter_post', 'youtube_video.access', 'gmail_chat', 'gmail_send.message', 'linkedin_post', 'vimeo_video.access', 'google.search_search.phrase', 'bing.search_search.phrase')) order by itime desc)### t left join app_mdata t2 on lower(t.app)=lower(t2.name) group by user_src, filename order by requests desc"
        set protected enable
    next
    edit "chat-search-and-message-logging-by-platform"
        set description "Bullying Chat Search and Message Logging by Platforms"
        set log-type app-ctrl
        set query "select app, count(*) as requests from ###(select filename, app, itime, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, `group`, `srcip` from $log where $filter and ($bully_keywords) and (lower(app) in ('facebook_post', 'facebook_chat', 'twitter_post', 'youtube_video.access', 'gmail_chat', 'gmail_send.message', 'linkedin_post', 'vimeo_video.access', 'google.search_search.phrase', 'bing.search_search.phrase')) order by itime desc)### t group by app order by requests desc"
        set protected enable
    next
    edit "chat-search-and-message-logging-by-user"
        set description "Bullying Chat Search and Message Logging by Users"
        set log-type app-ctrl
        set query "select user_src, count(*) as requests from ###(select filename, app, itime, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, `group`, `srcip` from $log where $filter and ($bully_keywords) and (lower(app) in ('facebook_post', 'facebook_chat', 'twitter_post', 'youtube_video.access', 'gmail_chat', 'gmail_send.message', 'linkedin_post', 'vimeo_video.access', 'google.search_search.phrase', 'bing.search_search.phrase')) order by itime desc)### t group by user_src order by requests desc"
        set protected enable
    next
    edit "self-harm-Risky-Term-User-Count"
        set description "User Count of Self-Harm Risky Terms"
        set log-type app-ctrl
        set query "select count(distinct user_src) as num_user from ###(select $flex_timestamp as timestamp, filename, app, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, `group`, `srcip`, count(*) as total_num from $log where $filter and ($banned_keywords) and (lower(app) in ('facebook_post', 'facebook_chat', 'twitter_post', 'youtube_video.access', 'gmail_chat', 'gmail_send.message', 'linkedin_post', 'vimeo_video.access', 'google.search_search.phrase', 'bing.search_search.phrase')) group by timestamp, filename, app, user_src, `group`, `srcip` /*SkipSTART*/order by total_num desc, timestamp desc/*SkipEND*/)### t"
        set protected enable
    next
    edit "self-harm-Risky-Term-Indicator-Count"
        set description "Indicator Count of Self-Harm Risky Terms"
        set log-type app-ctrl
        set query "select count(*) as requests from ###(select $flex_timestamp as timestamp, filename, app, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, `group`, `srcip`, count(*) as total_num from $log where $filter and ($banned_keywords) and (lower(app) in ('facebook_post', 'facebook_chat', 'twitter_post', 'youtube_video.access', 'gmail_chat', 'gmail_send.message', 'linkedin_post', 'vimeo_video.access', 'google.search_search.phrase', 'bing.search_search.phrase')) group by timestamp, filename, app, user_src, `group`, `srcip` /*SkipSTART*/order by total_num desc, timestamp desc/*SkipEND*/)### t"
        set protected enable
    next
    edit "self-harm-Risky-Term-App-Count"
        set description "App Count of Self-Harm Risky Terms"
        set log-type app-ctrl
        set query "select count(distinct app) as num_app from ###(select $flex_timestamp as timestamp, filename, app, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, `group`, `srcip`, count(*) as total_num from $log where $filter and ($banned_keywords) and (lower(app) in ('facebook_post', 'facebook_chat', 'twitter_post', 'youtube_video.access', 'gmail_chat', 'gmail_send.message', 'linkedin_post', 'vimeo_video.access', 'google.search_search.phrase', 'bing.search_search.phrase')) group by timestamp, filename, app, user_src, `group`, `srcip` /*SkipSTART*/order by total_num desc, timestamp desc/*SkipEND*/)### t"
        set protected enable
    next
    edit "self-harm-chat-search-and-message-logging"
        set description "Self-Harm Chat Search and Message Logging"
        set log-type app-ctrl
        set query "select filename, string_agg(distinct app, ' ') as app_agg, string_agg(distinct user_src, ' ') as user_agg, string_agg(distinct `group`, ' ') as group_agg, string_agg(distinct ipstr(`srcip`), ' ') as srcip_agg, count(*) as requests from ###(select $flex_timestamp as timestamp, filename, app, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, `group`, `srcip`, count(*) as total_num from $log where $filter and ($banned_keywords) and (lower(app) in ('facebook_post', 'facebook_chat', 'twitter_post', 'youtube_video.access', 'gmail_chat', 'gmail_send.message', 'linkedin_post', 'vimeo_video.access', 'google.search_search.phrase', 'bing.search_search.phrase')) group by timestamp, filename, app, user_src, `group`, `srcip` /*SkipSTART*/order by total_num desc, timestamp desc/*SkipEND*/)### t group by filename order by requests desc"
        set protected enable
    next
    edit "self-harm-Chat-Search-And-Message-Logging-By-Platform"
        set description "Self-Harm Chat Search and Message Logging by Platforms"
        set log-type app-ctrl
        set query "select app, count(*) as requests from ###(select $flex_timestamp as timestamp, filename, app, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, `group`, `srcip`, count(*) as total_num from $log where $filter and ($banned_keywords) and (lower(app) in ('facebook_post', 'facebook_chat', 'twitter_post', 'youtube_video.access', 'gmail_chat', 'gmail_send.message', 'linkedin_post', 'vimeo_video.access', 'google.search_search.phrase', 'bing.search_search.phrase')) group by timestamp, filename, app, user_src, `group`, `srcip` /*SkipSTART*/order by total_num desc, timestamp desc/*SkipEND*/)### t group by app order by requests desc"
        set protected enable
    next
    edit "self-harm-Chat-Search-And-Message-Logging-By-User"
        set description "Self-Harm Chat Search and Message Logging by Users"
        set log-type app-ctrl
        set query "select user_src, filename, count(*) as requests from ###(select $flex_timestamp as timestamp, filename, app, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, `group`, `srcip`, count(*) as total_num from $log where $filter and ($banned_keywords) and (lower(app) in ('facebook_post', 'facebook_chat', 'twitter_post', 'youtube_video.access', 'gmail_chat', 'gmail_send.message', 'linkedin_post', 'vimeo_video.access', 'google.search_search.phrase', 'bing.search_search.phrase')) group by timestamp, filename, app, user_src, `group`, `srcip` /*SkipSTART*/order by total_num desc, timestamp desc/*SkipEND*/)### t group by user_src, filename order by requests desc"
        set protected enable
    next
    edit "self-harm-Chat-Search-And-Message-Logging-Timeline"
        set description "Self-Harm Chat Search and Message Logging Timeline"
        set log-type app-ctrl
        set query "select $flex_timescale(timestamp) as hodex, count(*) as requests from ###(select $flex_timestamp as timestamp, filename, app, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, `group`, `srcip`, count(*) as total_num from $log where $filter and ($banned_keywords) and (lower(app) in ('facebook_post', 'facebook_chat', 'twitter_post', 'youtube_video.access', 'gmail_chat', 'gmail_send.message', 'linkedin_post', 'vimeo_video.access', 'google.search_search.phrase', 'bing.search_search.phrase')) group by timestamp, filename, app, user_src, `group`, `srcip` /*SkipSTART*/order by total_num desc, timestamp desc/*SkipEND*/)### t group by hodex order by requests desc"
        set protected enable
    next
    edit "Browsing-Time-vs-Domain"
        set description "Browsing Time vs. Domain"
        set log-type traffic
        set query "select domain, ebtr_value(ebtr_agg_flat(browsetime), null, $timespan) as browsetime from ###(select domain, f_user, srcip, ebtr_agg_flat(browsetime) as browsetime, sum(bandwidth) as bandwidth from (select app_group_name(app) as app_group, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as f_user, srcip, coalesce(nullifna(root_domain(hostname)), ipstr(dstip), NULL) as domain, ebtr_agg_flat($browse_time) as browsetime, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter and (logflag&1>0) group by app_group, f_user, hostname, domain, srcip, dstip) t1 inner join app_mdata t2 on lower(t1.app_group)=lower(t2.name) where app_cat='Social.Media' group by domain, f_user, srcip order by browsetime, bandwidth desc)### t where browsetime is not null group by domain order by browsetime desc"
        set protected enable
    next
    edit "Social-Networking-Browsing-Time"
        set description "Social Networking Browsing Time"
        set log-type traffic
        set query "select f_user, sum(bandwidth) as bandwidth from ###(select domain, f_user, srcip, ebtr_agg_flat(browsetime) as browsetime, sum(bandwidth) as bandwidth from (select app_group_name(app) as app_group, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as f_user, srcip, coalesce(nullifna(root_domain(hostname)), ipstr(dstip), NULL) as domain, ebtr_agg_flat($browse_time) as browsetime, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter and (logflag&1>0) group by app_group, f_user, hostname, domain, srcip, dstip) t1 inner join app_mdata t2 on lower(t1.app_group)=lower(t2.name) where app_cat='Social.Media' group by domain, f_user, srcip order by browsetime, bandwidth desc)### t where bandwidth>0 group by f_user order by bandwidth desc"
        set protected enable
    next
    edit "Social-Networking-Durations-Sources-Drilldown"
        set description "Top Social Networking Durations from Sources Drilldown"
        set log-type traffic
        set query "select f_user, ebtr_value(ebtr_agg_flat(browsetime), null, $timespan) as browsetime from ###(select domain, f_user, srcip, ebtr_agg_flat(browsetime) as browsetime, sum(bandwidth) as bandwidth from (select app_group_name(app) as app_group, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as f_user, srcip, coalesce(nullifna(root_domain(hostname)), ipstr(dstip), NULL) as domain, ebtr_agg_flat($browse_time) as browsetime, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter and (logflag&1>0) group by app_group, f_user, hostname, domain, srcip, dstip) t1 inner join app_mdata t2 on lower(t1.app_group)=lower(t2.name) where app_cat='Social.Media' group by domain, f_user, srcip order by browsetime, bandwidth desc)### t where $filter-drilldown and browsetime is not null group by f_user order by browsetime desc"
        set protected enable
    next
    edit "Facebook-Posts"
        set description "Facebook Posts"
        set log-type app-ctrl
        set query "select i_time, f_user, srcip, filename from ###(select from_itime(itime) as i_time, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as f_user, srcip, filename, app from $log where $filter and filename is not null order by i_time desc)### t where lower(app)=lower('Facebook_Post') order by i_time desc"
        set protected enable
    next
    edit "Facebook-Chats"
        set description "Facebook Chats"
        set log-type app-ctrl
        set query "select filename, string_agg(distinct from_itime(itime)::text, ' ') as itime_agg, string_agg(distinct user_src, ' ') as user_agg, string_agg(distinct `group`, ' ') as group_agg, string_agg(distinct ipstr(srcip), ' ') as srcip_agg, count(*) as requests from ###(select filename, itime, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, `group`, srcip, app from $log where $filter and filename is not null order by itime desc)### t where lower(app)=lower('Facebook_Chat') group by filename order by requests desc"
        set protected enable
    next
    edit "Twitter-Posts"
        set description "Twitter Posts"
        set log-type app-ctrl
        set query "select i_time, f_user, srcip, filename from ###(select from_itime(itime) as i_time, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as f_user, srcip, filename, app from $log where $filter and filename is not null order by i_time desc)### t where lower(app)=lower('Twitter_Post') order by i_time desc"
        set protected enable
    next
    edit "LinkedIn-Posts-and-Comments"
        set description "LinkedIn Posts and Comments"
        set log-type app-ctrl
        set query "select filename, string_agg(distinct from_itime(itime)::text, ' ') as itime_agg, string_agg(distinct user_src, ' ') as user_agg, string_agg(distinct `group`, ' ') as group_agg, string_agg(distinct ipstr(srcip), ' ') as srcip_agg, count(*) as requests from ###(select filename, itime, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, `group`, srcip, app from $log where $filter and filename is not null order by itime desc)### t where lower(app)=lower('LinkedIn_Post') group by filename order by requests desc"
        set protected enable
    next
    edit "sdwan-fw-Device-Interface-Stat_Bibandwidth"
        set description "SD-WAN Device-Interface Statistic"
        set log-type event
        set query "select devid, sum(bibandwidth)/sum(count) as bibandwidth from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where $filter-drilldown and bibandwidth is not null group by devid having sum(count)>0 order by bibandwidth desc"
            config variable
                edit "devid"
                    set var-name "Device Name"
                    set var-expression "devid"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "sdwan-Device-Interface-Latency-Timeline"
        set description "SD-WAN Device-Interface Latency Timeline"
        set log-type event
        set query "select $flex_timescale(timestamp) as hodex, t1.interface, min(latency) as latency from (select timestamp, devid, interface, (case when sum(count_linkup)>0 then sum(latency)/sum(count_linkup) else NULL end) as latency from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t group by timestamp, devid, interface having sum(count)>0) t1 inner join (select interface, count(*) as num_intf from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where $filter-drilldown and interface is not null group by interface order by num_intf desc limit $ddown-top)t2 on t1.interface=t2.interface group by hodex, t1.interface order by hodex"
            config variable
                edit "devid"
                    set var-name "Device Name"
                    set var-expression "devid"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "sdwan-Device-Interface-Jitter-Timeline"
        set description "SD-WAN Device-Interface Jitter Timeline"
        set log-type event
        set query "select $flex_timescale(timestamp) as hodex, t1.interface, min(jitter) as jitter from (select timestamp, devid, interface, (case when sum(count_linkup)>0 then sum(jitter)/sum(count_linkup) else NULL end) as jitter from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t group by timestamp, devid, interface having sum(count)>0) t1 inner join (select interface, count(*) as num_intf from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where $filter-drilldown and interface is not null group by interface order by num_intf desc limit $ddown-top)t2 on t1.interface=t2.interface group by hodex, t1.interface order by hodex"
            config variable
                edit "devid"
                    set var-name "Device Name"
                    set var-expression "devid"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "sdwan-Device-Interface-Packetloss-Timeline"
        set description "SD-WAN Device-Interface Packetloss Timeline"
        set log-type event
        set query "select $flex_timescale(timestamp) as hodex, t1.interface, min(packetloss) as packetloss from (select timestamp, devid, interface, (case when sum(count_linkup)>0 then sum(packetloss)/sum(count_linkup) else NULL end) as packetloss from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t group by timestamp, devid, interface having sum(count)>0) t1 inner join (select interface, count(*) as num_intf from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where $filter-drilldown and interface is not null group by interface order by num_intf desc limit $ddown-top)t2 on t1.interface=t2.interface group by hodex, t1.interface order by hodex"
            config variable
                edit "devid"
                    set var-name "Device Name"
                    set var-expression "devid"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "sdwan-fw-Device-Stat_by_Bibandwidth"
        set description "SD-WAN Device Statistic by Bibandwidth"
        set log-type event
        set query "select devid, sum(bibandwidth)/sum(count) as bibandwidth from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where $filter-drilldown and bibandwidth is not null group by devid having sum(count)>0 order by bibandwidth desc"
            config variable
                edit "devid"
                    set var-name "Device Name"
                    set var-expression "devid"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "sdwan-Device-Intf-List-by-Availability"
        set description "SD-WAN Device Interface List by Availability"
        set log-type event
        set query "select devname || ':' || interface as dev_intf, sum(count_linkup)/sum(count) as available from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where $filter-drilldown group by dev_intf having sum(count)>0 order by dev_intf"
        set protected enable
    next
    edit "sdwan-Device-Intf-Updown-Timeline"
        set description "SD-WAN Device Interface Updown Time Line"
        set log-type event
        set query "select $fv_line_timescale(timestamp) as hodex,  devname || ':' || interface as dev_intf, cast(100*sum(count_linkup)/sum(count) as decimal(10,2)) as sdwan_status from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t group by hodex, dev_intf order by hodex"
            config variable
                edit "dev_intf"
                    set var-name "Device Link"
                    set var-expression "(devname || ':' || interface)"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "sdwan-Device-Latency-Timeline"
        set description "SD-WAN Device Latency Timeline"
        set log-type event
        set query "select $flex_timescale(timestamp) as hodex, devid, min(latency) as latency from (select timestamp, devid, interface, (case when sum(count_linkup)>0 then sum(latency)/sum(count_linkup) else NULL end) as latency from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where $filter-drilldown and latency is not null group by timestamp, devid, interface having sum(count)>0) t1 group by hodex, devid order by hodex"
            config variable
                edit "devid"
                    set var-name "Device Name"
                    set var-expression "devid"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "sdwan-Device-Jitter-Timeline"
        set description "SD-WAN Device Jitter Timeline"
        set log-type event
        set query "select $flex_timescale(timestamp) as hodex, devid, min(jitter) as jitter from (select timestamp, devid, interface, (case when sum(count_linkup)>0 then sum(jitter)/sum(count_linkup)  else NULL end) as jitter from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where $filter-drilldown and jitter is not null group by timestamp, devid, interface having sum(count)>0) t1 group by hodex, devid order by hodex"
            config variable
                edit "devid"
                    set var-name "Device Name"
                    set var-expression "devid"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "sdwan-Device-Packetloss-Timeline"
        set description "SD-WAN Device Packet Loss Timeline"
        set log-type event
        set query "select $flex_timescale(timestamp) as hodex, devid, min(packetloss) as packetloss from (select timestamp, devid, interface, (case when sum(count_linkup)>0 then sum(packetloss)/sum(count_linkup) else NULL end) as packetloss from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where $filter-drilldown and packetloss is not null group by timestamp, devid, interface having sum(count)>0) t1 group by hodex, devid order by hodex"
            config variable
                edit "devid"
                    set var-name "Device Name"
                    set var-expression "devid"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "sdwan-Device-Intf-Avail-Percentage-Timeline"
        set description "SD-WAN Device Interface Availability Percentage Timeline"
        set log-type event
        set query "select hodex, interface, available from ((select $flex_datetime(timestamp) as hodex, 'SD-WAN' as interface, cast(sum(availcnt)*100.0/sum(count) as decimal(18,2)) as available from (select timestamp, devid, first_value(count) OVER (PARTITION BY timestamp, devid ORDER BY link_status/count desc, count desc) as count, first_value(link_status) OVER (PARTITION BY timestamp, devid ORDER BY link_status/count desc, count desc) as availcnt from (select timestamp, devid, interface, sum(link_status) as link_status, sum(count) as count from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where $filter-drilldown and count>0 group by timestamp, devid, interface)t) t group by hodex order by hodex) union all (select $flex_datetime(timestamp) as hodex, interface, cast(sum(link_status)*100.0/sum(count) as decimal(18,2)) as available from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where $filter-drilldown group by hodex, interface order by hodex)) t order by hodex"
            config variable
                edit "devid"
                    set var-name "Device Name"
                    set var-expression "devid"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "sdwan-Device-Interface-Summary-by-Bibandwidth"
        set description "SD-WAN Device Interface Summary by Bibandwidth"
        set log-type event
        set query "select devid, interface, sum(bibandwidth)/sum(count) as bibandwidth, cast(min(latency_min) as decimal(18,2)) as latency_min, cast((case when sum(count_linkup)>0 then sum(latency)/sum(count_linkup) else NULL end) as decimal(18,2)) as latency_avg, cast(max(latency_max) as decimal(18,2)) as latency_max, cast(min(jitter_min) as decimal(18,2)) as jitter_min, cast((case when sum(count_linkup)>0 then sum(jitter)/sum(count_linkup) else NULL end) as decimal(18,2)) as jitter_avg, cast(max(jitter_max) as decimal(18,2)) as jitter_max, cast(min(packetloss_min) as decimal(18,2)) as packetloss_min, cast((case when sum(count_linkup)>0 then sum(packetloss)/sum(count_linkup) else NULL end) as decimal(18,2))as packetloss_avg, cast(max(packetloss_max) as decimal(18,2)) as packetloss_max from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where $filter-drilldown and interface is not null group by devid, interface having sum(count)>0 order by devid, interface"
        set protected enable
    next
    edit "sdwan-device-availability-percentage"
        set description "SD-WAN Device Availability Percentage"
        set log-type event
        set query "select cast(sum(availcnt)*100.0/sum(count) as decimal(18,2)) as available from (select timestamp, devid, first_value(count) OVER (PARTITION BY timestamp, devid ORDER BY link_status/count desc, count desc) as count, first_value(link_status) OVER (PARTITION BY timestamp, devid ORDER BY link_status/count desc,count desc) as availcnt from (select timestamp, devid, interface, sum(link_status) as link_status, sum(count) as count from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where $filter-drilldown and count>0 group by timestamp, devid, interface)t) t"
            config variable
                edit "devid"
                    set var-name "Device Name"
                    set var-expression "devid"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "sdwan-device-intf-availability-percentage"
        set description "SD-WAN Device Interface Availability Percentage"
        set log-type event
        set query "(select 'SD-WAN' as interface, cast(sum(availcnt)*100.0/sum(count) as decimal(18,2)) as available from (select timestamp, devid, first_value(count) OVER (PARTITION BY timestamp, devid ORDER BY link_status/count desc, count desc) as count, first_value(link_status) OVER (PARTITION BY timestamp, devid ORDER BY link_status/count desc, count desc) as availcnt from (select timestamp, devid, interface, sum(link_status) as link_status, sum(count) as count from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where $filter-drilldown and count>0 group by timestamp, devid, interface)t) t group by interface) union all (select interface, cast(sum(link_status)*100.0/sum(count) as decimal(18,2)) as available from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where $filter-drilldown group by interface order by interface)"
            config variable
                edit "devid"
                    set var-name "Device Name"
                    set var-expression "devid"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "sdwan-device-intf-availability-percentage-donut"
        set description "SD-WAN Device Interface Availability Percentage Donut"
        set log-type event
        set query "select interface, unnest(avail) as avail, unnest(val) as val from (select interface, array['Available', 'Unavailable'] as avail, array[available, 100-available] as val from ((select 'SD-WAN' as interface, cast(sum(availcnt)*100.0/sum(count) as decimal(18,2)) as available from (select timestamp, devid, first_value(count) OVER (PARTITION BY timestamp, devid ORDER BY link_status/count desc, count desc) as count, first_value(link_status) OVER (PARTITION BY timestamp, devid ORDER BY link_status/count desc, count desc) as availcnt from (select timestamp, devid, interface, sum(link_status) as link_status, sum(count) as count from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where $filter-drilldown and count>0 group by timestamp, devid, interface)t) t group by interface) union all (select interface, cast(sum(link_status)*100.0/sum(count) as decimal(18,2)) as available from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where $filter-drilldown group by interface order by interface)) t) t"
            config variable
                edit "devid"
                    set var-name "Device Name"
                    set var-expression "devid"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "sdwan-device-sla-intf-latency-pass-percent"
        set description "SD-WAN Device Latency Pass Percentage by SLA rules and Interface"
        set log-type event
        set query "select sla_rule, interface, cast(100*(1-sum(failed_latency)/sum(count_linkup)) as decimal(18,2)) as latency from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where $filter-drilldown group by sla_rule, interface having sum(count_linkup)>0 order by latency desc"
            config variable
                edit "devid"
                    set var-name "Device Name"
                    set var-expression "devid"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "sdwan-device-sla-intf-jitter-pass-percent"
        set description "SD-WAN Device Jitter Pass Percentage by SLA rules and Interface"
        set log-type event
        set query "select sla_rule, interface, cast(100*(1-sum(failed_jitter)/sum(count_linkup)) as decimal(18,2)) as jitter from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where $filter-drilldown group by sla_rule, interface having sum(count_linkup)>0 order by jitter desc"
            config variable
                edit "devid"
                    set var-name "Device Name"
                    set var-expression "devid"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "sdwan-device-sla-intf-packetloss-pass-percent"
        set description "SD-WAN Device Packet Loss Pass Percentage by SLA rules and Interface"
        set log-type event
        set query "select sla_rule, interface, cast(100*(1-sum(failed_packetloss)/sum(count_linkup)) as decimal(18,2)) as packetloss from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where $filter-drilldown group by sla_rule, interface having sum(count_linkup)>0 order by packetloss desc"
            config variable
                edit "devid"
                    set var-name "Device Name"
                    set var-expression "devid"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "sdwan-Top-App-By-Bandwidth-Sankey"
        set description "Top SD-WAN application by bandwidth usage"
        set log-type traffic
        set query "select 'SD-WAN Utilization' as summary, app_group, devid, dstintf as interface, sum(bandwidth) as bandwidth  from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown group by app_group, devid, interface order by bandwidth desc"
        config variable
                edit "devid"
                    set var-name "Device Name"
                    set var-expression "devid"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "sdwan-Device-Rules-Bandwidth"
        set description "Top SD-WAN Links bandwidth"
        set log-type traffic
        set query "select coalesce(rulename, 'Unknown') as rulename, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown group by rulename order by bandwidth desc limit 10"
            config variable
                edit "devid"
                    set var-name "Device Name"
                    set var-expression "devid"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "sdwan-total-bandwidth"
        set description "SD-WAN Total Bandwidth"
        set log-type traffic
        set query "select sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown"
        set protected enable
    next
    edit "sdwan-Top-App-By-Bandwidth"
        set description "Top SD-WAN application by bandwidth"
        set log-type traffic
        set query "select appid, app_group, sum(bandwidth) as bandwidth, sum(sessions) as sessions from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown group by appid, app_group order by bandwidth desc"
        set protected enable
    next
    edit "sdwan-device-interface-bandwidth"
        set description "Top SD-WAN Links bandwidth"
        set log-type traffic
        set query "select interface, sum(bandwidth) as bandwidth from ((select srcintf as interface, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where srcintfrole='wan' and $filter-drilldown group by interface) union all (select dstintf as interface, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown group by interface)) t group by interface order by bandwidth desc limit 10"
            config variable
                edit "devid"
                    set var-name "Device Name"
                    set var-expression "devid"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "sdwan-Top-Users-By-Bandwidth"
        set description "SD-WAN Top users by bandwidth usage"
        set log-type traffic
        set query "select user_src, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown group by user_src order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "sdwan-Top-Users-By-Bandwidth-test"
        set description "SD-WAN Top users by bandwidth usage-test"
        set log-type traffic
        set query "select rulename, sum(bandwidth) as bandwidth from ###(/*tag:fv_t_sdwan*/SELECT dvid, agg_timescale AS timescale, f_user, srcip, dstintf, dstintfrole, app_group, rulename, bandwidth, traffic_in, traffic_out, sessions FROM ( SELECT * /*SkipSTART*/, row_number() OVER (PARTITION BY dvid, agg_timescale ORDER BY sessions DESC, bandwidth DESC) AS session_rank, row_number() OVER (PARTITION BY dvid, agg_timescale ORDER BY bandwidth DESC, sessions DESC) AS bandwidth_rank/*SkipEND*/ FROM ( SELECT dvid, $fv_agg_timescale(timescale) AS agg_timescale, f_user, srcip, dstintf, dstintfrole, app_group, rulename, sum(bandwidth) AS bandwidth, sum(traffic_in) AS traffic_in, sum(traffic_out) AS traffic_out, sum(sessions) AS sessions FROM ###base(/*tag:fv_base_t_src_dst*/SELECT dvid, srcintfrole, dstintfrole, $fv_timescale AS timescale, epid, coalesce(nullifna(`user`), nullifna(`unauthuser`)) AS f_user, `group` AS f_group, srcip, srcintf, srcuuid, srcinetsvc, max(srcmac) AS srcmac, max(coalesce(srcname, srcmac)) AS dev_src, dstip, dstintf, dstuuid, dstowner, max(dstmac) AS dstmac, max(get_devtype(srcswversion, osname, devtype)) AS devtype, max(dstcountry) AS dstcountry, app_group_name(app) AS app_group, rulename, vwlid, ((CASE WHEN (logflag&64>0) THEN 2 ELSE 0 END) | (CASE WHEN appcat='unscanned' THEN 1 ELSE 0 END)) AS flags, (CASE WHEN (logflag&64>0) THEN hostname ELSE root_domain(hostname) END) AS domain, catdesc, policymode, policyid, policytype, poluuid, policyname, accessproxy, saasname, fctuid, max((CASE WHEN fctuid IS NOT NULL AND unauthuser IS NOT NULL THEN fctuid || ',' || unauthuser ELSE NULL END)) AS avatar, max((CASE WHEN epid>1023 AND euid IS NOT NULL THEN epid || ',' || euid ELSE NULL END)) AS epeuid, ebtr_agg_flat($browse_time) AS browsetime, max(dtime) AS logtime, max(threatlvl) AS threatlvl, sum(threatwgt) AS threatweight, sum(CASE WHEN (logflag&2>0) THEN threatwgt ELSE 0 END) AS threat_block, sum(thwgt_cri) AS thwgt_cri, sum(thwgt_hig) AS thwgt_hig, sum(thwgt_med) AS thwgt_med, sum(thwgt_low) AS thwgt_low, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) AS bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) AS traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) AS traffic_out, sum((CASE WHEN (logflag&2>0) THEN 1 ELSE 0 END)) AS session_block, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) AS sessions FROM ( SELECT dvid, srcintfrole, dstintfrole, itime, dtime, (case when epid<1024 then NULL else epid end) as epid, euid, `user`, `group`, srcip, srcintf, srcmac, srcname, dstip, dstintf, dstowner, dstmac, dstcountry, app, appcat, srcswversion, osname, devtype, hostname, catdesc, srcuuid, dstuuid, srcinetsvc, accessproxy, saasname, policymode, policyid, policytype, poluuid, policyname, unauthuser, fctuid, ebtime, logflag, sentdelta, sentbyte, rcvddelta, rcvdbyte, coalesce(vwlname,vwlservice) as rulename, vwlid, threatlevel_max(threatlvls) AS threatlvl, threatweight_sum(threatwgts, threatcnts) AS threatwgt, threatweight_level_sum(4,threatlvls,threatcnts,threatwgts) AS thwgt_cri, threatweight_level_sum(3,threatlvls,threatcnts,threatwgts) AS thwgt_hig, threatweight_level_sum(2,threatlvls,threatcnts,threatwgts) AS thwgt_med, threatweight_level_sum(1,threatlvls,threatcnts,threatwgts) AS thwgt_low FROM $log-traffic WHERE $filter AND (logflag&(1|32)>0) ) t1 GROUP BY dvid, srcintfrole, dstintfrole, timescale, epid, f_user, f_group, srcip, srcintf, dstip, dstintf, dstowner, app_group, rulename, vwlid, flags, domain, catdesc, policymode, policyid, policytype, poluuid, policyname, accessproxy, saasname, fctuid, srcuuid, dstuuid, srcinetsvc )base### base_query WHERE vwlid IS NOT NULL GROUP BY dvid, agg_timescale, f_user, srcip, dstintf, dstintfrole, app_group, rulename ) agg_query ) rank_query /*SkipSTART*/ ORDER BY (CASE WHEN session_rank<$fv_rank_limit OR bandwidth_rank<$fv_rank_limit THEN least(session_rank, bandwidth_rank) ELSE session_rank*bandwidth_rank END) /*SkipEND*/ /*NOHCACHE SELECT dvid, timescale, f_user, srcip, dstintf, dstintfrole, app_group, rulename, bandwidth, traffic_in, traffic_out, sessions FROM (SELECT dvid, srcintfrole, dstintfrole, $fv_timescale AS timescale, epid, coalesce(nullifna(`user`), nullifna(`unauthuser`)) AS f_user, `group` AS f_group, srcip, srcintf, srcuuid, srcmac, srcinetsvc, coalesce(srcname, srcmac) AS dev_src, dstip, dstintf, dstuuid, dstowner, dstmac, get_devtype(srcswversion, osname, devtype) AS devtype, dstcountry, app_group_name(app) AS app_group, rulename, vwlid, ((CASE WHEN (logflag&64>0) THEN 2 ELSE 0 END) | (CASE WHEN appcat='unscanned' THEN 1 ELSE 0 END)) AS flags, (CASE WHEN (logflag&64>0) THEN hostname ELSE root_domain(hostname) END) AS domain, catdesc, policymode, policyid, policytype, poluuid, policyname, accessproxy, saasname, fctuid, (CASE WHEN fctuid IS NOT NULL AND unauthuser IS NOT NULL THEN fctuid || ',' || unauthuser ELSE NULL END) AS avatar, (CASE WHEN epid>1023 AND euid IS NOT NULL THEN epid || ',' || euid ELSE NULL END) AS epeuid, $browse_time AS browsetime, dtime AS logtime, threatlvl, threatwgt AS threatweight, (CASE WHEN (logflag&2>0) THEN threatwgt ELSE 0 END) AS threat_block, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, (coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) AS bandwidth, (coalesce(rcvddelta, rcvdbyte, 0)) AS traffic_in, (coalesce(sentdelta, sentbyte, 0)) AS traffic_out, (CASE WHEN (logflag&2>0) THEN 1 ELSE 0 END) AS session_block, (CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) AS sessions FROM ( SELECT dvid, srcintfrole, dstintfrole, itime, dtime, (case when epid<1024 then NULL else epid end) as epid, euid, `user`, `group`, srcip, srcintf, srcmac, srcname, dstip, dstintf, dstowner, dstmac, dstcountry, app, appcat, srcswversion, osname, devtype, hostname, catdesc, srcuuid, dstuuid, srcinetsvc, accessproxy, saasname, policymode, policyid, policytype, poluuid, policyname, unauthuser, fctuid, ebtime, logflag, sentdelta, sentbyte, rcvddelta, rcvdbyte, coalesce(vwlname,vwlservice) as rulename, vwlid, threatlevel_max(threatlvls) AS threatlvl, threatweight_sum(threatwgts, threatcnts) AS threatwgt, threatweight_level_sum(4,threatlvls,threatcnts,threatwgts) AS thwgt_cri, threatweight_level_sum(3,threatlvls,threatcnts,threatwgts) AS thwgt_hig, threatweight_level_sum(2,threatlvls,threatcnts,threatwgts) AS thwgt_med, threatweight_level_sum(1,threatlvls,threatcnts,threatwgts) AS thwgt_low FROM $log-traffic WHERE $filter AND (logflag&(1|32)>0) ) t ) base_query WHERE vwlid IS NOT NULL NOHCACHE-END*//*HCACHE-AGG SELECT dvid, agg_timescale AS timescale, f_user, srcip, dstintf, dstintfrole, app_group, rulename, bandwidth, traffic_in, traffic_out, sessions FROM ( SELECT *, row_number() OVER (PARTITION BY dvid, agg_timescale ORDER BY sessions DESC, bandwidth DESC) AS session_rank, row_number() OVER (PARTITION BY dvid, agg_timescale ORDER BY bandwidth DESC, sessions DESC) AS bandwidth_rank FROM ( SELECT dvid, $fv_agg_timescale(timescale) AS agg_timescale, f_user, srcip, dstintf, dstintfrole, app_group, rulename, sum(bandwidth) AS bandwidth, sum(traffic_in) AS traffic_in, sum(traffic_out) AS traffic_out, sum(sessions) AS sessions FROM ###LOG### GROUP BY dvid, agg_timescale, f_user, srcip, dstintf, dstintfrole, app_group, rulename ) agg_query ) rank_query ORDER BY (CASE WHEN session_rank<$fv_rank_limit OR bandwidth_rank<$fv_rank_limit THEN least(session_rank, bandwidth_rank) ELSE session_rank*bandwidth_rank END) AGG-END*/)### t where $filter-drilldown and rulename is not null group by rulename order by bandwidth desc"
        set protected enable
    next
    edit "sdwan-Top-Users-Application-By-Bandwidth"
        set description "SD-WAN Top users and Application by bandwidth"
        set log-type traffic
        set query "select user_src, app_group, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown group by user_src, app_group order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "sdwan-Device-Intfe-traffic-bandwidth-Timeline"
        set description "SD-WAN Device-Interface traffic bandwidth Timeline"
        set log-type traffic
        set query "select $flex_timescale(timestamp) as hodex, t1.from_to as interface, sum(bandwidth) as bandwidth from ((select timestamp, dstintf as from_to, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t group by timestamp, dstintf) union all (select timestamp, srcintf as from_to, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where srcintfrole ='wan' group by timestamp, srcintf)) t1 inner join (select from_to, sum(num_intf) as num_intf from ((select dstintf as from_to, count(*) as num_intf from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown group by dstintf) union all (select srcintf as from_to, count(*) as num_intf from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown and srcintfrole ='wan' group by srcintf))t where from_to is not null group by from_to order by num_intf desc limit $ddown-top)t2 on t1.from_to=t2.from_to group by hodex, t1.from_to order by hodex"
            config variable
                edit "devid"
                    set var-name "Device Name"
                    set var-expression "devid"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "sdwan-Device-Intfe-traffic-in-bandwidth-Timeline"
        set description "SD-WAN Device-Interface traffic received bandwidth Timeline"
        set log-type traffic
        set query "select $flex_timescale(timestamp) as hodex, t1.srcintf as interface, sum(traffic_in) as bandwidth from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t1 inner join (select srcintf, count(*) as num_intf from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown and srcintf is not null and srcintfrole ='wan' group by srcintf order by num_intf desc limit $ddown-top)t2 on t1.srcintf=t2.srcintf group by hodex, t1.srcintf order by hodex"
            config variable
                edit "devid"
                    set var-name "Device Name"
                    set var-expression "devid"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "sdwan-Device-Intfe-traffic-out-bandwidth-Timeline"
        set description "SD-WAN Device-Interface traffic sent bandwidth Timeline"
        set log-type traffic
        set query "select $flex_timescale(timestamp) as hodex, t1.dstintf as interface, sum(traffic_out) as bandwidth from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t1 inner join (select dstintf, count(*) as num_intf from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown group by dstintf order by num_intf desc limit $ddown-top)t2 on t1.dstintf=t2.dstintf group by hodex, t1.dstintf order by hodex"
            config variable
                edit "devid"
                    set var-name "Device Name"
                    set var-expression "devid"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "sdwan-Device-Interface-Application-Traffic-Sankey"
        set description "Top SD-WAN application by bandwidth sankey"
        set log-type traffic
        set query "select 'SD-WAN Rules' as summary, 'Rule:' || coalesce(rulename, 'Unknown') as rule_name, app_group, devid, dstintf as interface, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown group by rule_name, app_group, devid, interface order by bandwidth desc"
        config variable
                edit "devid"
                    set var-name "Device Name"
                    set var-expression "devid"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "sdwan-Device-SLA-Rule-Latency-Line"
        set description "SD-WAN Device-SLA-Rule Latency Line"
        set log-type event
        set query "select $flex_timescale(timestamp) as hodex, t1.intf_sla, (case when sum(count_linkup)>0 then sum(latency)/sum(count_linkup) else NULL end) as latency from (select timestamp, interface || ':' || sla_rule as intf_sla, sum(latency) as latency, sum(count_linkup) as count_linkup from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where latency is not null group by timestamp, intf_sla having sum(count)>0) t1 inner join (select interface || ':' || sla_rule as intf_sla, count(*) as num_intf from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where $filter-drilldown and sla_rule is not null group by intf_sla order by num_intf desc limit $ddown-top)t2 on t1.intf_sla=t2.intf_sla group by hodex, t1.intf_sla order by hodex"
            config variable
                edit "devid"
                    set var-name "Device Name"
                    set var-expression "devid"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "sdwan-Device-SLA-Rule-Jitter-Line"
        set description "SD-WAN Device-SLA-Rule Jitter Line"
        set log-type event
        set query "select $flex_timescale(timestamp) as hodex, t1.intf_sla, (case when sum(count_linkup)>0 then sum(jitter)/sum(count_linkup) else NULL end) as jitter from (select timestamp, interface || ':' || sla_rule as intf_sla, sum(jitter) as jitter, sum(count_linkup) as count_linkup from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where jitter is not null group by timestamp, intf_sla having sum(count)>0) t1 inner join (select interface || ':' || sla_rule as intf_sla, count(*) as num_intf from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where $filter-drilldown and sla_rule is not null group by intf_sla order by num_intf desc limit $ddown-top)t2 on t1.intf_sla=t2.intf_sla group by hodex, t1.intf_sla order by hodex"
            config variable
                edit "devid"
                    set var-name "Device Name"
                    set var-expression "devid"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "sdwan-Device-SLA-Rule-Packetloss-Line"
        set description "SD-WAN Device-SLA-Rule Packetloss Line"
        set log-type event
        set query "select $flex_timescale(timestamp) as hodex, t1.intf_sla, (case when sum(count_linkup)>0 then sum(packetloss)/sum(count_linkup) else NULL end) as packetloss from (select timestamp, interface || ':' || sla_rule as intf_sla, sum(packetloss) as packetloss, sum(count_linkup) as count_linkup from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where packetloss is not null group by timestamp, intf_sla having sum(count)>0) t1 inner join (select interface || ':' || sla_rule as intf_sla, count(*) as num_intf from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where $filter-drilldown and sla_rule is not null group by intf_sla order by num_intf desc limit $ddown-top)t2 on t1.intf_sla=t2.intf_sla group by hodex, t1.intf_sla order by hodex"
            config variable
                edit "devid"
                    set var-name "Device Name"
                    set var-expression "devid"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "sdwan-Device-Intf-Inbandwidth-Timeline"
        set description "SD-WAN Device-Interface Inbandwidth Timeline"
        set log-type event
        set query "select $flex_timescale(timestamp) as time, t1.interface, cast(sum(inbandwidth)/sum(count)  as decimal(18,2)) as inbandwidth from (select timestamp, devid, interface, sum(count) as count, sum(inbandwidth) as inbandwidth from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t group by timestamp, devid, interface) t1 inner join (select devid, interface, count(*) as num_intf from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where $filter-drilldown group by devid, interface order by num_intf desc limit $ddown-top)t2 on t1.interface=t2.interface and t1.devid=t2.devid group by time, t1.interface having sum(count)>0 order by time"
            config variable
                edit "devid"
                    set var-name "Device Name"
                    set var-expression "devid"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "sdwan-Device-Intf-Outbandwidth-Timeline"
        set description "SD-WAN Device-Interface Outbandwidth Timeline"
        set log-type event
        set query "select $flex_timescale(timestamp) as time, t1.interface, cast(sum(outbandwidth)/sum(count) as decimal(18,2)) as outbandwidth from (select timestamp, devid, interface, sum(count) as count, sum(outbandwidth) as outbandwidth from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t group by timestamp, devid, interface) t1 inner join (select devid, interface, count(*) as num_intf from ###(select $flex_timestamp as timestamp, csf, devname, devid, vd, interface, healthcheck as sla_rule, sum(link_status) as link_status, sum(failed_latency) as failed_latency, sum(failed_jitter) as failed_jitter,  sum(failed_packetloss) as failed_packetloss, sum(latency) as latency, max(latency) as latency_max, min(latency) as latency_min, sum(jitter) as jitter, max(jitter) as jitter_max, min(jitter) as jitter_min, sum(packetloss) as packetloss, max(packetloss) as packetloss_max, min(packetloss) as packetloss_min, sum(inbandwidth) as inbandwidth, sum(outbandwidth) as outbandwidth, sum(bibandwidth) as bibandwidth, count(*) as count, sum(CASE WHEN link_status=1 THEN 1 ELSE 0 END) AS count_linkup, min(sdwan_status) as sdwan_status from (select itime, csf, devname, devid, vd, interface, healthcheck, link_status, (CASE WHEN link_status=1 THEN latency ELSE NULL END) AS latency, (CASE WHEN link_status=1 THEN jitter ELSE NULL END) AS jitter, (CASE WHEN link_status=1 THEN packetloss ELSE NULL END) AS packetloss, (CASE WHEN sla_failed=1 AND metric='packetloss' THEN 1 ELSE 0 END) AS failed_packetloss, (CASE WHEN sla_failed=1 AND metric='jitter' THEN 1 ELSE 0 END) AS failed_jitter, (CASE WHEN sla_failed=1 AND metric='latency' THEN 1 ELSE 0 END) AS failed_latency, (CASE WHEN sla_failed=1 THEN 3 ELSE sdwan_status END) AS sdwan_status,  (CASE WHEN link_status=1 THEN inbandwidth ELSE 0 END) AS inbandwidth,  (CASE WHEN link_status=1 THEN outbandwidth ELSE 0 END) AS outbandwidth,  (CASE WHEN link_status=1 THEN bibandwidth ELSE 0 END) AS bibandwidth from (select itime, csf, devname, devid, vd, interface, healthcheck, (CASE WHEN status='down' THEN 0 ELSE 1 END) AS link_status, latency::float as latency, jitter::float as jitter, trim(trailing '%' from packetloss)::float as packetloss, (CASE WHEN status='down' THEN 1 WHEN msg LIKE '%SLA failed%' THEN 1 ELSE 0 END) AS sla_failed, metric, (CASE WHEN msg LIKE '%SLA status%' THEN 1 ELSE 0 END) AS sdwan_status, convert_unit_to_num(inbandwidthused) as inbandwidth, convert_unit_to_num(outbandwidthused) as outbandwidth, convert_unit_to_num(bibandwidthused) as bibandwidth from $log where $filter and logid_to_int(logid) in (22925, 22933, 22936) and interface is not null) t ) t group by timestamp, csf, devname, devid, vd, interface, healthcheck /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where $filter-drilldown group by devid, interface order by num_intf desc limit $ddown-top)t2 on t1.interface=t2.interface and t1.devid=t2.devid group by time, t1.interface having sum(count)>0 order by time"
            config variable
                edit "devid"
                    set var-name "Device Name"
                    set var-expression "devid"
                    set drilldown-flag enable
                    set var-type string
                next
            end
        set protected enable
    next
    edit "Top-App-Category-by-Session"
        set description "Application risk application usage by category"
        set log-type traffic
        set query "select appcat, sum(sessions) as total_num from ###(select appid, app, appcat, apprisk, sum(bandwidth) as bandwidth, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t group by appid, app, appcat, apprisk /*SkipSTART*/order by sessions desc, bandwidth desc/*SkipEND*/)### t where $filter-drilldown group by appcat order by total_num desc"
        set protected enable
    next
    edit "Top-Region-Name-by-Traffic"
        set description "Traffic top destination countries by browsing time"
        set log-type traffic
        set query "select dstcountry, sum(bandwidth) as bandwidth  from ###(select dstcountry, ebtr_agg_flat(browsetime) as browsetime, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from (select dstcountry, ebtr_agg_flat($browse_time) as browsetime, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out from $log where $filter and (logflag&1>0) and $browse_time is not null group by dstcountry) t group by dstcountry /*SkipSTART*/order by ebtr_value(ebtr_agg_flat(browsetime), null, null) desc/*SkipEND*/)### t where $filter-drilldown group by dstcountry order by bandwidth desc"
        set protected enable
    next
    edit "Top-Protocols-By-Traffic"
        set description "Top applications by bandwidth usage"
        set log-type traffic
        set query "select service, sum(bandwidth) as bandwidth from ###(select service, sum(bandwidth) as bandwidth from ###base(/*tag:rpt_base_t_bndwdth_sess*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, appcat, apprisk, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, count(*) as sessions, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in from $log-traffic where $filter and (logflag&(1|32)>0) group by timestamp, dvid, srcip, dstip, epid, euid, appcat, apprisk, user_src, service /*SkipSTART*/order by timestamp desc/*SkipEND*/)base### base_query group by service order by bandwidth desc)### t where $filter-drilldown group by service order by bandwidth desc"
        set protected enable
    next
    edit "Top-Attacks-by-Count"
        set description "Threat attacks by severity"
        set log-type attack
        set query "select attack, sum(attack_count) as totalnum from ###(select coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, attack, (case when severity in ('critical', 'high') then 1 else 0 end) as high_severity, count(*) as attack_count from $log where $filter and nullifna(attack) is not null group by user_src, attack, high_severity order by attack_count desc)### t where $filter-drilldown and attack is not null group by attack order by totalnum desc"
        set protected enable
    next
    edit "Top-Spams-by-Count"
        set description "User drilldown top spam sources"
        set log-type emailfilter
        set query "select user_src, sum(totalnum) as totalnum from ###(select $flex_timestamp as timestamp, coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, `from` as mf_sender, `to` as mf_receiver, action, eventtype, count(*) as totalnum from $log where $filter group by timestamp, user_src, mf_sender, mf_receiver, action, eventtype /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where $filter-drilldown and mf_sender is not null group by user_src order by totalnum desc"
        set protected enable
    next
    edit "security-Antivirus-Inspections"
        set description "Antivirus Inspections"
        set log-type virus
        set query "select action, sum(totalnum) as totalnum from  ###(select $flex_timestamp as timestamp, coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, `from` as mf_sender, `to` as mf_receiver, action, eventtype, count(*) as totalnum from $log where $filter group by timestamp, user_src, mf_sender, mf_receiver, action, eventtype /*SkipSTART*/order by timestamp desc/*SkipEND*/)### t where $filter-drilldown and action is not null group by action order by totalnum desc"
        set protected enable
    next
    edit "Top-DLP-by-Count"
        set description "Email DLP Activity Summary"
        set log-type dlp
        set query "select profile, count(*) as total_num from ###(select itime, hostname,`from` as sender, `to` as receiver, profile, action, service, subtype, srcip, dstip, severity, filename, direction, filesize, (case when severity='critical' then 'Critical Data Exfiltration' else (case when coalesce(nullifna(`user`), ipstr(`srcip`)) is not null then 'User Associated Data Loss' else NULL end) end) as data_loss from $log where $filter /*SkipSTART*/order by itime desc/*SkipEND*/)### t where $filter-drilldown and profile is not null group by profile order by total_num desc"
        set protected enable
    next
    edit "sdwan-CTAP-Business-Apps-Bandwidth"
        set description "CTAP SD-WAN Business Application with Bandwidth"
        set log-type traffic
        set query "select app_group, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t1 inner join app_mdata t2 on lower(t1.app_group)=lower(t2.name) where $filter-drilldown and appcat not in ('Network.Service', 'Mobile','Social.Media','Proxy','Video\/Audio','Game','P2P','unknown') group by app_group order by bandwidth desc, app_group"
        set protected enable
    next
    edit "sdwan-CTAP-Cloud-IT-Apps-Bandwidth"
        set description "CTAP SD-WAN Cloud IT Application Bandwidth"
        set log-type traffic
        set query "select app_group, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown and appcat='Cloud.IT' and bandwidth>0 group by app_group order by bandwidth desc"
        set protected enable
    next
    edit "sdwan-CTAP-Storage-Backup-Apps-Bandwidth"
        set description "CTAP SD-WAN Storage Backup Application Bandwidth"
        set log-type traffic
        set query "select app_group, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown and appcat='Storage.Backup' and bandwidth>0 group by app_group order by bandwidth desc"
        set protected enable
    next
    edit "sdwan-CTAP-Collaboration-Apps-Bandwidth"
        set description "CTAP SD-WAN Collaboration Application Bandwidth"
        set log-type traffic
        set query "select app_group, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown and appcat='Collaboration' and bandwidth>0 group by app_group order by bandwidth desc"
        set protected enable
    next
    edit "sdwan-CTAP-Top-Streaming-App-By-Bandwidth"
        set description "CTAP SD-WAN Top Streaming Application by Bandwidth"
        set log-type traffic
        set query "select app_group, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown and appcat='Video\/Audio' and bandwidth>0 group by app_group order by bandwidth desc"
        set protected enable
        config variable
            edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
        end
    next
    edit "sdwan-CTAP-Top-SocialMedia-App-By-Bandwidth"
        set description "CTAP SD-WAN Top SocialMedia Application by Bandwidth"
        set log-type traffic
        set query "select app_group, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown and appcat='Social.Media' and bandwidth>0 group by app_group order by bandwidth desc"
        set protected enable
        config variable
            edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
        end
    next
    edit "sdwan-CTAP-App-Risk-Reputation-Top-Devices-By-Scores"
        set description "CTAP SD-WAN Top Risk Reputation Devices by Scores"
        set log-type traffic
        set query "select dev_src, sum(crscore%65536) as scores from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown and crscore is not null group by dev_src having sum(crscore%65536)>0 order by scores desc"
        set protected enable
    next
    edit "sdwan-CTAP-SB-Top-Sandbox-Files"
        set description "CTAP SD-WAN Sandbox Top Sandbox Files"
        set log-type virus
        set query "select  filename, analyticscksum, service, sum(totalnum) as total_num, (case fsaverdict  when 'malicious' then 'Malicious'  when 'high risk' then 'High' when 'medium risk' then 'Medium'  when 'low risk' then 'Low' else 'Other' end) as risk, (case fsaverdict when 'malicious' then 5 when 'high risk' then 4 when 'medium risk' then 3 when 'low risk' then 2 else 1 end) as risk_level from ###(select filename, analyticscksum, service, fsaverdict, dtype, coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, virus, virusid_to_str(virusid, eventtype) as virusid_s, count(*) as totalnum from $log where $filter group by filename, analyticscksum, service, fsaverdict, dtype, user_src, virus, virusid_s /*SkipSTART*/order by totalnum desc/*SkipEND*/)### t where $filter-drilldown and filename is not null and dtype='fortisandbox' and fsaverdict not in ('clean', 'submission failed') group by filename, analyticscksum, risk_level, risk, service  order by risk_level desc, total_num desc, service, filename"
        set protected enable
    next
    edit "sdwan-CTAP-SB-Total-Number-of-Malicious-Suspicious-Files"
        set description "CTAP SD-WAN Sandbox Malicious Suspicious Files Number"
        set log-type virus
        set query "select (case fsaverdict  when 'malicious' then 'Malicious'  when 'high risk' then 'High' when 'medium risk' then 'Medium'  when 'low risk' then 'Low' else 'Other' end) as risk,  sum(totalnum) as total_num  from ###(select filename, analyticscksum, service, fsaverdict, dtype, coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, virus, virusid_to_str(virusid, eventtype) as virusid_s, count(*) as totalnum from $log where $filter group by filename, analyticscksum, service, fsaverdict, dtype, user_src, virus, virusid_s /*SkipSTART*/order by totalnum desc/*SkipEND*/)### t where $filter-drilldown and dtype='fortisandbox' and fsaverdict not in ('clean','submission failed') group by risk order by total_num desc"
        set protected enable
    next
    edit "sdwan-CTAP-Top-Source-Countries"
        set description "CTAP SD-WAN Top Source Countries"
        set log-type traffic
        set query "select srccountry, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown and nullifna(srccountry) is not null and srccountry <> 'Reserved' and bandwidth>0 group by srccountry order by bandwidth desc, srccountry"
        set protected enable
    next
    edit "sdwan-CTAP-Average-Bandwidth-Hour"
        set description "CTAP SD-WAN Average Bandwidth by Hour"
        set log-type traffic
        set query "select hourstamp, sum(bandwidth) / count(*) as bandwidth from (select $hour_of_day(timestamp) as hourstamp, $HOUR_OF_DAY(timestamp) as hour_stamp, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown group by hourstamp, hour_stamp) t group by hourstamp order by hourstamp"
        set protected enable
    next
    edit "sdwan-CTAP-Average-Bandwidth-Day-Hour"
        set description "CTAP SD-WAN Average Bandwidth by Day of Week and Hour"
        set log-type traffic
        set query "select hourstamp, daystamp, round(sum(bandwidth) / count(*)) as bandwidth from (select $hour_of_day(timestamp) as hourstamp, $HOUR_OF_DAY(timestamp) as hour_stamp, $day_of_week(timestamp) as daystamp, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown group by hourstamp, hour_stamp, daystamp) t group by hourstamp, daystamp order by hourstamp"
        set protected enable
    next
    edit "sdwan-CTAP-Avg-Log-Rate-Hour"
        set description "CTAP SD-WAN Average Log Rate by Hour"
        set log-type event
        set query "select $hour_of_day(timestamp) as hourstamp, cast((sum(total_trate+total_erate+total_orate))/sum(count)/100.0 as decimal(10, 2)) as log_rate from ###(select $flex_timestamp as timestamp, devid, slot, sum(coalesce(trate, 0)) as total_trate, sum(coalesce(erate, 0)) as total_erate, sum(coalesce(orate, 0)) as total_orate, min(itime) as first_seen, max(itime) as last_seen, sum(coalesce(mem, 0)) as total_mem, max(coalesce(mem, 0)) as mem_peak, sum(coalesce(disk, 0)) as total_disk, max(coalesce(disk, 0)) as disk_peak, sum(coalesce(cpu, 0)) as total_cpu, max(coalesce(cpu, 0)) as cpu_peak, max(coalesce(trate, 0)+coalesce(erate, 0)+coalesce(orate, 0)) as lograte_peak, sum(coalesce(totalsession, 0)) as totalsession, max(coalesce(totalsession, 0)) as session_peak, sum(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)) as sent, sum(cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as recv, max(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)+cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as transmit_peak, sum(coalesce(setuprate, 0)) as cps, max(coalesce(setuprate, 0)) as cps_peak, count(*) as count from $log where $filter and subtype='system' and action='perf-stats' group by timestamp, devid, slot order by total_mem desc)### t where $filter-drilldown group by hourstamp order by hourstamp"
        set protected enable
    next
    edit "sdwan-CTAP-Total-DIA-Applications-Detected"
        set description "CTAP SD-WAN Direct Internet Access(DIA) Application Number"
        set log-type traffic
        set query "select count(distinct app_group) as totalnum from  ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t1 inner join app_mdata t2 on lower(t1.app_group)=lower(t2.name) where $filter-drilldown and technology like '%Browser-Based%'"
        set protected enable
    next
    edit "sdwan-CTAP-Total-Bandwidth-Cloud-IT"
        set description "CTAP SD-WAN Total Bandwidth of Cloud-IT Application"
        set log-type traffic
        set query "select coalesce(sum(bandwidth), 0) as bandwidth from  ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown and appcat='Cloud.IT'"
        set protected enable
    next
    edit "sdwan-CTAP-Total-Bandwidth-VoIP-Video-Audio"
        set description "CTAP SD-WAN Total Bandwidth of VoIP-Video-Audio Application"
        set log-type traffic
        set query "select coalesce(sum(bandwidth), 0) as bandwidth from  ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown and appcat in ('Video\/Audio', 'VoIP')"
        set protected enable
    next
    edit "sdwan-CTAP-Total-Bandwidth"
        set description "CTAP SD-WAN Total Bandwidth"
        set log-type traffic
        set query "select coalesce(sum(bandwidth), 0) as totalnum from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown"
        set protected enable
    next
    edit "sdwan-CTAP-Total-Bandwidth-nonBusiness"
        set description "CTAP SD-WAN Total nonBusiness Bandwidth"
        set log-type traffic
        set query "select coalesce(sum(bandwidth), 0) as totalnum  from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown and appcat in ('Mobile','Social.Media','Proxy','Video\/Audio','Game','P2P','unknown')"
        set protected enable
    next
    edit "sdwan-CTAP-HTTPS-SSL-Bandwidth"
        set description "CTAP SD-WAN Total Business Bandwidth"
        set log-type traffic
        set query "select coalesce(sum(bandwidth), 0) as totalnum  from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown and appcat not in ('Network.Service', 'Mobile','Social.Media','Proxy','Video\/Audio','Game','P2P','unknown')"
        set protected enable
    next
    edit "sdwan-CTAP-Total-Bandwidth-Internal"
        set description "CTAP SD-WAN Total Internal Bandwidth"
        set log-type traffic
        set query "select coalesce(sum(bandwidth), 0) as totalnum  from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown and dstintfrole='lan'"
        set protected enable
    next
    edit "sdwan-CTAP-Total-Bandwidth-External"
        set description "CTAP SD-WAN Total External Bandwidth"
        set log-type traffic
        set query "select coalesce(sum(bandwidth), 0) as totalnum  from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown and dstintfrole='wan'"
        set protected enable
    next
    edit "sdwan-CTAP-Total-Bandwidth-Internal-And-External"
        set description "CTAP SD-WAN Internal and External Bandwidth"
        set log-type traffic
        set query "select interface, bandwidth from ((select 'Internal' as interface, coalesce(sum(bandwidth), 0) as bandwidth from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown and dstintfrole='lan') union all (select 'External' as interface, coalesce(sum(bandwidth), 0) as bandwidth from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown and dstintfrole='wan')) t where bandwidth>0"
        set protected enable
    next
    edit "sdwan-CTAP-Total-Bandwidth-External-Business-nonBusiness-Network"
        set description "CTAP SD-WAN Bandwidth of External Business and nonBusiness"
        set log-type traffic
        set query "select (case when appcat not in ('Network.Service', 'Mobile','Social.Media','Proxy','Video\/Audio','Game','P2P','unknown') then 'Business' when appcat in ('Mobile','Social.Media','Proxy','Video\/Audio','Game','P2P','unknown') then 'nonBusiness'when appcat in ('Network.Service') then 'Network Service' end) as app_cat, coalesce(sum(bandwidth), 0) as bandwidth from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown group by app_cat order by bandwidth desc"
        set protected enable
    next
    edit "sdwan-CTAP-Total-Bandwidth-Business-External"
        set description "CTAP SD-WAN External Bandwidth of Business"
        set log-type traffic
        set query "select coalesce(sum(bandwidth), 0) as totalnum  from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown and appcat not in ('Network.Service', 'Mobile','Social.Media','Proxy','Video\/Audio','Game','P2P','unknown')"
        set protected enable
    next
    edit "sdwan-CTAP-Total-Bandwidth-nonBusiness-External"
        set description "CTAP SD-WAN External Bandwidth of nonBusiness"
        set log-type traffic
        set query "select coalesce(sum(bandwidth), 0) as totalnum  from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown and appcat in ('Mobile','Social.Media','Proxy','Video\/Audio','Game','P2P','unknown')"
        set protected enable
    next
    edit "sdwan-CTAP-Total-Bandwidth-Network-Service-External"
        set description "CTAP SD-WAN External Bandwidth of Network Service"
        set log-type traffic
        set query "select coalesce(sum(bandwidth), 0) as totalnum  from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown and appcat in ('Network.Service')"
        set protected enable
    next
    edit "sdwan-CTAP-Top-Appcat-Appgroup-By-Bandwidth-Sankey"
        set description "CTAP SD-WAN Top SD-WAN application by bandwidth usage"
        set log-type traffic
        set query "select 'External' as summary, appcat, app_group, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown and bandwidth>0 group by appcat, app_group order by bandwidth desc"
        set protected enable
    next
    edit "sdwan-CTAP-App-With-Highest-Bandwidth"
        set description "CTAP SD-WAN Application with Highest Bandwidth"
        set log-type traffic
        set query "select app_group, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown and bandwidth>0 group by app_group order by bandwidth desc limit 1"
        set protected enable
    next
    edit "sdwan-CTAP-Appcat-With-Highest-Bandwidth"
        set description "CTAP SD-WAN Application Category with Highest Bandwidth"
        set log-type traffic
        set query "select appcat, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown and bandwidth>0 group by appcat order by bandwidth desc limit 1"
        set protected enable
    next
    edit "sdwan-CTAP-SB-Number-of-Suspicious-Files"
        set description "CTAP SD-WAN Sandbox Suspicious Files"
        set log-type virus
        set query "select sum(totalnum) as total_num from ###(select filename, analyticscksum, service, fsaverdict, dtype, coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, virus, virusid_to_str(virusid, eventtype) as virusid_s, count(*) as totalnum from $log where $filter group by filename, analyticscksum, service, fsaverdict, dtype, user_src, virus, virusid_s /*SkipSTART*/order by totalnum desc/*SkipEND*/)### t where $filter-drilldown and dtype='fortisandbox' and fsaverdict in ('malicious','high risk','medium risk', 'low risk') and filename is not null"
        set protected enable
    next
    edit "sdwan-CTAP-SB-Analyzed-Files-Number"
        set description "CTAP SD-WAN Sandbox Analyzed Files Number"
        set log-type virus
        set query "select sum(totalnum) as total_num from  ###(select filename, analyticscksum, service, fsaverdict, dtype, coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, virus, virusid_to_str(virusid, eventtype) as virusid_s, count(*) as totalnum from $log where $filter group by filename, analyticscksum, service, fsaverdict, dtype, user_src, virus, virusid_s /*SkipSTART*/order by totalnum desc/*SkipEND*/)### t where $filter-drilldown and dtype='fortisandbox' and fsaverdict <> 'submission failed' and filename is not null"
        set protected enable
    next
    edit "sdwan-CTAP-Top-User-Source-By-Sessions"
        set description "CTAP SD-WAN Top User Source by Session Count"
        set log-type traffic
        set query "select user_src, sum(sessions) as sessions from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown group by user_src order by sessions desc limit 1"
        set protected enable
    next
    edit "sdwan-CTAP-Top-User-Source-By-Bandwidth"
        set description "CTAP SD-WAN Top User Source by Bandwidth"
        set log-type traffic
        set query "select user_src, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown group by user_src order by bandwidth desc limit 1"
        set protected enable
    next
    edit "sdwan-CTAP-Top-Bandwidth-Day"
        set description "CTAP SD-WAN Top Day of Bandwidth Usage"
        set log-type traffic
        set query "select TO_CHAR(hourstamp::TIME, 'HHpm') ||' - ' || TO_CHAR(hourstamp::TIME + '1 hour', 'HHpm') as hour_span, sum(bandwidth) / count(*) as bandwidth from (select $hour_of_day(timestamp) as hourstamp, $HOUR_OF_DAY(timestamp) as hour_stamp, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, csf, devid, vd, srccountry, dstintf, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group_name(app) as app_group, coalesce(vwlname,vwlservice) as rulename, service, coalesce(nullifna(`srcname`),ipstr(`srcip`),nullifna(`srcmac`)) as dev_src,  sum(crscore%65536) as crscore, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from $log-traffic where $filter and vwlid IS NOT NULL and (logflag&(1|32)>0) group by timestamp, srccountry, dstintf, csf, devid, vd, srcintf, srcintfrole, dstintfrole, appid, appcat, app_group, rulename, service, user_src, dev_src order by bandwidth desc)### t where $filter-drilldown group by hourstamp, hour_stamp) t group by hour_span order by bandwidth desc limit 1"
        set protected enable
    next
    edit "sdwan-CTAP-Avg-Log-Rate-Overall"
        set description "CTAP SD-WAN Overall Average Log Rate"
        set log-type event
        set query "select round((sum(total_trate+total_erate+total_orate))/sum(count)) as log_rate from ###(select $flex_timestamp as timestamp, devid, slot, sum(coalesce(trate, 0)) as total_trate, sum(coalesce(erate, 0)) as total_erate, sum(coalesce(orate, 0)) as total_orate, min(itime) as first_seen, max(itime) as last_seen, sum(coalesce(mem, 0)) as total_mem, max(coalesce(mem, 0)) as mem_peak, sum(coalesce(disk, 0)) as total_disk, max(coalesce(disk, 0)) as disk_peak, sum(coalesce(cpu, 0)) as total_cpu, max(coalesce(cpu, 0)) as cpu_peak, max(coalesce(trate, 0)+coalesce(erate, 0)+coalesce(orate, 0)) as lograte_peak, sum(coalesce(totalsession, 0)) as totalsession, max(coalesce(totalsession, 0)) as session_peak, sum(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)) as sent, sum(cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as recv, max(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)+cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as transmit_peak, sum(coalesce(setuprate, 0)) as cps, max(coalesce(setuprate, 0)) as cps_peak, count(*) as count from $log where $filter and subtype='system' and action='perf-stats' group by timestamp, devid, slot order by total_mem desc)### t where $filter-drilldown "
        set protected enable
    next
    edit "sdwan-CTAP-event-Usage-CPU-Overall"
        set description "Overall Average CPU Usage"
        set log-type event
        set query "select cast(sum(total_cpu)/sum(count) as decimal(6,2)) as cpu_avg_usage from ###(select $flex_timestamp as timestamp, devid, slot, sum(coalesce(trate, 0)) as total_trate, sum(coalesce(erate, 0)) as total_erate, sum(coalesce(orate, 0)) as total_orate, min(itime) as first_seen, max(itime) as last_seen, sum(coalesce(mem, 0)) as total_mem, max(coalesce(mem, 0)) as mem_peak, sum(coalesce(disk, 0)) as total_disk, max(coalesce(disk, 0)) as disk_peak, sum(coalesce(cpu, 0)) as total_cpu, max(coalesce(cpu, 0)) as cpu_peak, max(coalesce(trate, 0)+coalesce(erate, 0)+coalesce(orate, 0)) as lograte_peak, sum(coalesce(totalsession, 0)) as totalsession, max(coalesce(totalsession, 0)) as session_peak, sum(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)) as sent, sum(cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as recv, max(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)+cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as transmit_peak, sum(coalesce(setuprate, 0)) as cps, max(coalesce(setuprate, 0)) as cps_peak, count(*) as count from $log where $filter and subtype='system' and action='perf-stats' group by timestamp, devid, slot order by total_mem desc)### t where $filter-drilldown"
        set protected enable
    next
    edit "sdwan-CTAP-event-Usage-Mem-Overall"
        set description "Overall Average Memory Usage"
        set log-type event
        set query "select cast(sum(total_mem)/sum(count) as decimal(6,2)) as mem_avg_usage from ###(select $flex_timestamp as timestamp, devid, slot, sum(coalesce(trate, 0)) as total_trate, sum(coalesce(erate, 0)) as total_erate, sum(coalesce(orate, 0)) as total_orate, min(itime) as first_seen, max(itime) as last_seen, sum(coalesce(mem, 0)) as total_mem, max(coalesce(mem, 0)) as mem_peak, sum(coalesce(disk, 0)) as total_disk, max(coalesce(disk, 0)) as disk_peak, sum(coalesce(cpu, 0)) as total_cpu, max(coalesce(cpu, 0)) as cpu_peak, max(coalesce(trate, 0)+coalesce(erate, 0)+coalesce(orate, 0)) as lograte_peak, sum(coalesce(totalsession, 0)) as totalsession, max(coalesce(totalsession, 0)) as session_peak, sum(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)) as sent, sum(cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as recv, max(cast(coalesce(split_part(bandwidth, '/', 1), '0') as integer)+cast(coalesce(split_part(bandwidth, '/', 2), '0') as integer)) as transmit_peak, sum(coalesce(setuprate, 0)) as cps, max(coalesce(setuprate, 0)) as cps_peak, count(*) as count from $log where $filter and subtype='system' and action='perf-stats' group by timestamp, devid, slot order by total_mem desc)### t where $filter-drilldown"
        set protected enable
    next
    edit "intf-Util-Timeline-Sampling"
        set description "Interface Utilization Timeline by Data Sampling"
        set log-type event
        set query "with base_qry as (select tm, rcvdbps, ntile(100) over (order by rcvdbps) as percentile from (select (timestamp/300*300) as tm, sum(rcvdbps) as rcvdbps, 300 as interval from $intfstats_billing tb1 join (select ti.dvid, intfname from intfinfo ti left join devtable_ext td on ti.dvid = td.dvid where $dev_filter) tb2 on tb1.dvid=tb2.dvid and tb1.intfname=tb2.intfname where $cust_time_filter(timestamp) group by tm) tmp), ref_qry as (select cast(max(rcvdbps)/1000000 as decimal(18,2)) as ref_val from base_qry where percentile = 95) select from_itime(timestamp) as tmstamp, cast(rcvdbps/1000000 as decimal(18,2)) as rcvdbps, ref_val from ref_qry, (select tm as timestamp, rcvdbps, rank() over(partition by (tm/3600) order by tm) as r from base_qry) t where r =1 order by tmstamp"
        set protected enable
    next
    edit "intf-Util-Distribution"
        set description "Interface Utilization Value Distribution"
        set log-type event
        set query "select cast(((max(max_value) over ())*seq/100 ) as decimal(16, 0)) as value, cnt from (select generate_series(0, 100, 2) as seq) t1 left join (select perc, max_value, count(*) as cnt from (select WIDTH_BUCKET(rcvdbps, 0, (max(rcvdbps) over ()) +1, 50)*2 as perc, max(rcvdbps) over () as max_value from (select (timestamp/300*300) as tm, sum(rcvdbps) as rcvdbps, 300 as interval from $intfstats_billing tb1 join (select ti.dvid, intfname from intfinfo ti left join devtable_ext td on ti.dvid = td.dvid where $dev_filter) tb2 on tb1.dvid=tb2.dvid and tb1.intfname=tb2.intfname where $cust_time_filter(timestamp) group by tm) tmp) t_bucket group by perc, max_value) t2 on t1.seq = t2.perc order by seq"
        set protected enable
    next
    edit "intf-Util-Sortline"
        set description "Interface Utilization Line Sorted by bps"
        set log-type event
        set query "with base_qry as (select rcvdbps, ntile(100) over (order by rcvdbps) as percentile from (select (timestamp/300*300) as tm, sum(rcvdbps) as rcvdbps, 300 as interval from $intfstats_billing tb1 join (select ti.dvid, intfname from intfinfo ti left join devtable_ext td on ti.dvid = td.dvid where $dev_filter) tb2 on tb1.dvid=tb2.dvid and tb1.intfname=tb2.intfname where $cust_time_filter(timestamp) group by tm) tmp), ref_qry as (select cast(max(rcvdbps)/1000000 as decimal(18,2)) as ref_val from base_qry where percentile = 95) select n_perc, cast(rcvdbps/1000000 as decimal(18,2)) as rcvdbps, ref_val from (select seq as n_perc, rcvdbps from (select generate_series(0, 100, 1) as seq) t1 left join (select max(rcvdbps) as rcvdbps, percentile from base_qry group by percentile) t2 on t1.seq = t2.percentile) t, ref_qry order by n_perc"
        set protected enable
    next
    edit "intf-Util-Analysis"
        set description "Interface Utilization Data Analysis"
        set log-type event
        set query "with base_qry as (select rcvdbps, interval, ntile(100) over (order by rcvdbps) as percentile from (select (timestamp/300*300) as tm, sum(rcvdbps) as rcvdbps, 300 as interval from $intfstats_billing tb1 join (select ti.dvid, intfname from intfinfo ti left join devtable_ext td on ti.dvid = td.dvid where $dev_filter) tb2 on tb1.dvid=tb2.dvid and tb1.intfname=tb2.intfname where $cust_time_filter(timestamp) group by tm) tmp) select min_mbps, low_ref_mbps, mean_mbps, ref_mbps, peak_mbps, actual_gb, total from (select cast(min(rcvdbps)/1000000 as decimal(18,2)) as min_mbps, cast(avg(rcvdbps)/1000000 as decimal(18,2)) as mean_mbps, cast(max(rcvdbps)/1000000 as decimal(18,2)) as peak_mbps, cast((select max(rcvdbps) from base_qry where percentile = 5)/1000000 as decimal(18,2)) as low_ref_mbps, cast((select max(rcvdbps) from base_qry where percentile = 95)/1000000 as decimal(18,2)) as ref_mbps, cast(sum(interval*rcvdbps)/8/(1024*1024*1024) as decimal(18,2)) as actual_gb, count(*) as total from base_qry) t"
        set protected enable
    next
    edit "intf-Device-Summary"
        set description "Interface Utilization Device Summary"
        set log-type event
        set query "select devname, t1.intfname, rcvd_gb from (select devname, ti.dvid, intfname from devtable_ext td join intfinfo ti on ti.dvid = td.dvid where $dev_filter) t1 join (select dvid, intfname, cast(sum(interval*rcvdbps)/8/(1024*1024*1024) as decimal(18,2)) as rcvd_gb from $intfstats_billing tb1 where $cust_time_filter(timestamp) group by dvid, intfname) t2 on t1.dvid=t2.dvid and t1.intfname=t2.intfname order by devname, rcvd_gb desc, t1.intfname"
        set protected enable
    next
    edit "daily-Summary-Top-Domain"
        set description "Daily Summary - Top Domain by Bandwidth"
        set log-type traffic
        set query "select domain, sum(bandwidth) as bandwidth from ###(/*tag:fv_t_website*/SELECT dvid, srcintfrole, dstintfrole, agg_timescale AS timescale, domain, catdesc, group_info, avatar, epeuid, f_user, srcip, srcintf, srcuuid, srcmac, dstip, dstintf, dstuuid, dstcountry, policymode, policyid, policytype, browsetime, threatweight, threat_block, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, bandwidth, traffic_in, traffic_out, session_block, sessions FROM ( SELECT * /*SkipSTART*/, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY sessions DESC, threatweight DESC) AS session_rank, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY threatweight DESC, sessions DESC) AS threatweight_rank /*SkipEND*/ FROM ( SELECT dvid, srcintfrole, dstintfrole, $fv_agg_timescale(timescale) AS agg_timescale, domain, catdesc, f_user, f_group AS group_info, srcip, srcintf, srcuuid, srcmac, dstip, dstintf, dstuuid, dstcountry, policymode, policyid, policytype, max(avatar) AS avatar, max(epeuid) AS epeuid, ebtr_agg_flat(browsetime) AS browsetime, sum(threatweight) AS threatweight, sum(threat_block) AS threat_block, sum(thwgt_cri) AS thwgt_cri, sum(thwgt_hig) AS thwgt_hig, sum(thwgt_med) AS thwgt_med, sum(thwgt_low) AS thwgt_low, sum(bandwidth) AS bandwidth, sum(traffic_in) AS traffic_in, sum(traffic_out) AS traffic_out, sum(session_block) AS session_block, sum(sessions) AS sessions FROM ###base(/*tag:fv_base_t_src_dst*/SELECT dvid, srcintfrole, dstintfrole, $fv_timescale AS timescale, epid, coalesce(nullifna(`user`), nullifna(`unauthuser`)) AS f_user, `group` AS f_group, srcip, srcintf, srcuuid, srcinetsvc, max(srcmac) AS srcmac, max(coalesce(srcname, srcmac)) AS dev_src, dstip, dstintf, dstuuid, dstowner, max(dstmac) AS dstmac, max(get_devtype(srcswversion, osname, devtype)) AS devtype, max(dstcountry) AS dstcountry, app_group_name(app) AS app_group, rulename, vwlid, ((CASE WHEN (logflag&64>0) THEN 2 ELSE 0 END) | (CASE WHEN appcat='unscanned' THEN 1 ELSE 0 END)) AS flags, (CASE WHEN (logflag&64>0) THEN hostname ELSE root_domain(hostname) END) AS domain, catdesc, policymode, policyid, policytype, poluuid, policyname, accessproxy, saasname, fctuid, max((CASE WHEN fctuid IS NOT NULL AND unauthuser IS NOT NULL THEN fctuid || ',' || unauthuser ELSE NULL END)) AS avatar, max((CASE WHEN epid>1023 AND euid IS NOT NULL THEN epid || ',' || euid ELSE NULL END)) AS epeuid, ebtr_agg_flat($browse_time) AS browsetime, max(dtime) AS logtime, max(threatlvl) AS threatlvl, sum(threatwgt) AS threatweight, sum(CASE WHEN (logflag&2>0) THEN threatwgt ELSE 0 END) AS threat_block, sum(thwgt_cri) AS thwgt_cri, sum(thwgt_hig) AS thwgt_hig, sum(thwgt_med) AS thwgt_med, sum(thwgt_low) AS thwgt_low, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) AS bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) AS traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) AS traffic_out, sum((CASE WHEN (logflag&2>0) THEN 1 ELSE 0 END)) AS session_block, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) AS sessions FROM ( SELECT dvid, srcintfrole, dstintfrole, itime, dtime, (case when epid<1024 then NULL else epid end) as epid, euid, `user`, `group`, srcip, srcintf, srcmac, srcname, dstip, dstintf, dstowner, dstmac, dstcountry, app, appcat, srcswversion, osname, devtype, hostname, catdesc, srcuuid, dstuuid, srcinetsvc, accessproxy, saasname, policymode, policyid, policytype, poluuid, policyname, unauthuser, fctuid, ebtime, logflag, sentdelta, sentbyte, rcvddelta, rcvdbyte, coalesce(vwlname,vwlservice) as rulename, vwlid, threatlevel_max(threatlvls) AS threatlvl, threatweight_sum(threatwgts, threatcnts) AS threatwgt, threatweight_level_sum(4,threatlvls,threatcnts,threatwgts) AS thwgt_cri, threatweight_level_sum(3,threatlvls,threatcnts,threatwgts) AS thwgt_hig, threatweight_level_sum(2,threatlvls,threatcnts,threatwgts) AS thwgt_med, threatweight_level_sum(1,threatlvls,threatcnts,threatwgts) AS thwgt_low FROM $log-traffic WHERE $filter AND (logflag&(1|32)>0) ) t1 GROUP BY dvid, srcintfrole, dstintfrole, timescale, epid, f_user, f_group, srcip, srcintf, dstip, dstintf, dstowner, app_group, rulename, vwlid, flags, domain, catdesc, policymode, policyid, policytype, poluuid, policyname, accessproxy, saasname, fctuid, srcuuid, dstuuid, srcinetsvc )base### base_query WHERE (flags & 2 = 0) AND (domain IS NOT NULL OR catdesc IS NOT NULL) GROUP BY dvid, srcintfrole, dstintfrole, agg_timescale, domain, catdesc, f_user, group_info, srcip, srcintf, srcuuid, srcmac, dstip, dstintf, dstuuid, dstcountry, policymode, policyid, policytype ) agg_query ) rank_query /*SkipSTART*/ ORDER BY (CASE WHEN session_rank<$fv_rank_limit OR threatweight_rank<$fv_rank_limit THEN least(session_rank, threatweight_rank) ELSE session_rank*threatweight_rank END) /*SkipEND*/ /*NOHCACHE SELECT dvid, srcintfrole, dstintfrole, timescale, domain, catdesc, f_group AS group_info, avatar, epeuid, f_user, srcip, srcintf, srcuuid, srcmac, dstip, dstintf, dstuuid, dstcountry, policymode, policyid, policytype, browsetime, threatweight, threat_block, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, bandwidth, traffic_in, traffic_out, session_block, sessions FROM (SELECT dvid, srcintfrole, dstintfrole, $fv_timescale AS timescale, epid, coalesce(nullifna(`user`), nullifna(`unauthuser`)) AS f_user, `group` AS f_group, srcip, srcintf, srcuuid, srcmac, srcinetsvc, coalesce(srcname, srcmac) AS dev_src, dstip, dstintf, dstuuid, dstowner, dstmac, get_devtype(srcswversion, osname, devtype) AS devtype, dstcountry, app_group_name(app) AS app_group, rulename, vwlid, ((CASE WHEN (logflag&64>0) THEN 2 ELSE 0 END) | (CASE WHEN appcat='unscanned' THEN 1 ELSE 0 END)) AS flags, (CASE WHEN (logflag&64>0) THEN hostname ELSE root_domain(hostname) END) AS domain, catdesc, policymode, policyid, policytype, poluuid, policyname, accessproxy, saasname, fctuid, (CASE WHEN fctuid IS NOT NULL AND unauthuser IS NOT NULL THEN fctuid || ',' || unauthuser ELSE NULL END) AS avatar, (CASE WHEN epid>1023 AND euid IS NOT NULL THEN epid || ',' || euid ELSE NULL END) AS epeuid, $browse_time AS browsetime, dtime AS logtime, threatlvl, threatwgt AS threatweight, (CASE WHEN (logflag&2>0) THEN threatwgt ELSE 0 END) AS threat_block, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, (coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) AS bandwidth, (coalesce(rcvddelta, rcvdbyte, 0)) AS traffic_in, (coalesce(sentdelta, sentbyte, 0)) AS traffic_out, (CASE WHEN (logflag&2>0) THEN 1 ELSE 0 END) AS session_block, (CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) AS sessions FROM ( SELECT dvid, srcintfrole, dstintfrole, itime, dtime, (case when epid<1024 then NULL else epid end) as epid, euid, `user`, `group`, srcip, srcintf, srcmac, srcname, dstip, dstintf, dstowner, dstmac, dstcountry, app, appcat, srcswversion, osname, devtype, hostname, catdesc, srcuuid, dstuuid, srcinetsvc, accessproxy, saasname, policymode, policyid, policytype, poluuid, policyname, unauthuser, fctuid, ebtime, logflag, sentdelta, sentbyte, rcvddelta, rcvdbyte, coalesce(vwlname,vwlservice) as rulename, vwlid, threatlevel_max(threatlvls) AS threatlvl, threatweight_sum(threatwgts, threatcnts) AS threatwgt, threatweight_level_sum(4,threatlvls,threatcnts,threatwgts) AS thwgt_cri, threatweight_level_sum(3,threatlvls,threatcnts,threatwgts) AS thwgt_hig, threatweight_level_sum(2,threatlvls,threatcnts,threatwgts) AS thwgt_med, threatweight_level_sum(1,threatlvls,threatcnts,threatwgts) AS thwgt_low FROM $log-traffic WHERE $filter AND (logflag&(1|32)>0) ) t ) base_query WHERE (flags & 2 = 0) AND (domain IS NOT NULL OR catdesc IS NOT NULL) NOHCACHE-END*//*HCACHE-AGG SELECT dvid, srcintfrole, dstintfrole, agg_timescale AS timescale, domain, catdesc, group_info, avatar, epeuid, f_user, srcip, srcintf, srcuuid, srcmac, dstip, dstintf, dstuuid, dstcountry, policymode, policyid, policytype, browsetime, threatweight, threat_block, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, bandwidth, traffic_in, traffic_out, session_block, sessions FROM ( SELECT *, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY sessions DESC, threatweight DESC) AS session_rank, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY threatweight DESC, sessions DESC) AS threatweight_rank FROM ( SELECT dvid, srcintfrole, dstintfrole, $fv_agg_timescale(timescale) AS agg_timescale, domain, catdesc, f_user, group_info, srcip, srcintf, srcuuid, srcmac, dstip, dstintf, dstuuid, dstcountry, policymode, policyid, policytype, max(avatar) AS avatar, max(epeuid) AS epeuid, ebtr_agg_flat(browsetime) AS browsetime, sum(threatweight) AS threatweight, sum(threat_block) AS threat_block, sum(thwgt_cri) AS thwgt_cri, sum(thwgt_hig) AS thwgt_hig, sum(thwgt_med) AS thwgt_med, sum(thwgt_low) AS thwgt_low, sum(bandwidth) AS bandwidth, sum(traffic_in) AS traffic_in, sum(traffic_out) AS traffic_out, sum(session_block) AS session_block, sum(sessions) AS sessions FROM ###LOG### GROUP BY dvid, srcintfrole, dstintfrole, agg_timescale, domain, catdesc, f_user, group_info, srcip, srcintf, srcuuid, srcmac, dstip, dstintf, dstuuid, dstcountry, policymode, policyid, policytype ) agg_query ) rank_query ORDER BY (CASE WHEN session_rank<$fv_rank_limit OR threatweight_rank<$fv_rank_limit THEN least(session_rank, threatweight_rank) ELSE session_rank*threatweight_rank END) AGG-END*/)### t where domain is not null group by domain order by bandwidth desc"
        set protected enable
    next
    edit "daily-Summary-Top-User"
        set description "Daily Summary - Top User by Bandwidth"
        set log-type traffic
        set query "select coalesce(nullifna(f_user), ipstr(srcip), 'Unknown') as f_user, srcip, sum(bandwidth) as bandwidth FROM ###(/*tag:fv_t_website*/SELECT dvid, srcintfrole, dstintfrole, agg_timescale AS timescale, domain, catdesc, group_info, avatar, epeuid, f_user, srcip, srcintf, srcuuid, srcmac, dstip, dstintf, dstuuid, dstcountry, policymode, policyid, policytype, browsetime, threatweight, threat_block, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, bandwidth, traffic_in, traffic_out, session_block, sessions FROM ( SELECT * /*SkipSTART*/, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY sessions DESC, threatweight DESC) AS session_rank, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY threatweight DESC, sessions DESC) AS threatweight_rank /*SkipEND*/ FROM ( SELECT dvid, srcintfrole, dstintfrole, $fv_agg_timescale(timescale) AS agg_timescale, domain, catdesc, f_user, f_group AS group_info, srcip, srcintf, srcuuid, srcmac, dstip, dstintf, dstuuid, dstcountry, policymode, policyid, policytype, max(avatar) AS avatar, max(epeuid) AS epeuid, ebtr_agg_flat(browsetime) AS browsetime, sum(threatweight) AS threatweight, sum(threat_block) AS threat_block, sum(thwgt_cri) AS thwgt_cri, sum(thwgt_hig) AS thwgt_hig, sum(thwgt_med) AS thwgt_med, sum(thwgt_low) AS thwgt_low, sum(bandwidth) AS bandwidth, sum(traffic_in) AS traffic_in, sum(traffic_out) AS traffic_out, sum(session_block) AS session_block, sum(sessions) AS sessions FROM ###base(/*tag:fv_base_t_src_dst*/SELECT dvid, srcintfrole, dstintfrole, $fv_timescale AS timescale, epid, coalesce(nullifna(`user`), nullifna(`unauthuser`)) AS f_user, `group` AS f_group, srcip, srcintf, srcuuid, srcinetsvc, max(srcmac) AS srcmac, max(coalesce(srcname, srcmac)) AS dev_src, dstip, dstintf, dstuuid, dstowner, max(dstmac) AS dstmac, max(get_devtype(srcswversion, osname, devtype)) AS devtype, max(dstcountry) AS dstcountry, app_group_name(app) AS app_group, rulename, vwlid, ((CASE WHEN (logflag&64>0) THEN 2 ELSE 0 END) | (CASE WHEN appcat='unscanned' THEN 1 ELSE 0 END)) AS flags, (CASE WHEN (logflag&64>0) THEN hostname ELSE root_domain(hostname) END) AS domain, catdesc, policymode, policyid, policytype, poluuid, policyname, accessproxy, saasname, fctuid, max((CASE WHEN fctuid IS NOT NULL AND unauthuser IS NOT NULL THEN fctuid || ',' || unauthuser ELSE NULL END)) AS avatar, max((CASE WHEN epid>1023 AND euid IS NOT NULL THEN epid || ',' || euid ELSE NULL END)) AS epeuid, ebtr_agg_flat($browse_time) AS browsetime, max(dtime) AS logtime, max(threatlvl) AS threatlvl, sum(threatwgt) AS threatweight, sum(CASE WHEN (logflag&2>0) THEN threatwgt ELSE 0 END) AS threat_block, sum(thwgt_cri) AS thwgt_cri, sum(thwgt_hig) AS thwgt_hig, sum(thwgt_med) AS thwgt_med, sum(thwgt_low) AS thwgt_low, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) AS bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) AS traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) AS traffic_out, sum((CASE WHEN (logflag&2>0) THEN 1 ELSE 0 END)) AS session_block, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) AS sessions FROM ( SELECT dvid, srcintfrole, dstintfrole, itime, dtime, (case when epid<1024 then NULL else epid end) as epid, euid, `user`, `group`, srcip, srcintf, srcmac, srcname, dstip, dstintf, dstowner, dstmac, dstcountry, app, appcat, srcswversion, osname, devtype, hostname, catdesc, srcuuid, dstuuid, srcinetsvc, accessproxy, saasname, policymode, policyid, policytype, poluuid, policyname, unauthuser, fctuid, ebtime, logflag, sentdelta, sentbyte, rcvddelta, rcvdbyte, coalesce(vwlname,vwlservice) as rulename, vwlid, threatlevel_max(threatlvls) AS threatlvl, threatweight_sum(threatwgts, threatcnts) AS threatwgt, threatweight_level_sum(4,threatlvls,threatcnts,threatwgts) AS thwgt_cri, threatweight_level_sum(3,threatlvls,threatcnts,threatwgts) AS thwgt_hig, threatweight_level_sum(2,threatlvls,threatcnts,threatwgts) AS thwgt_med, threatweight_level_sum(1,threatlvls,threatcnts,threatwgts) AS thwgt_low FROM $log-traffic WHERE $filter AND (logflag&(1|32)>0) ) t1 GROUP BY dvid, srcintfrole, dstintfrole, timescale, epid, f_user, f_group, srcip, srcintf, dstip, dstintf, dstowner, app_group, rulename, vwlid, flags, domain, catdesc, policymode, policyid, policytype, poluuid, policyname, accessproxy, saasname, fctuid, srcuuid, dstuuid, srcinetsvc )base### base_query WHERE (flags & 2 = 0) AND (domain IS NOT NULL OR catdesc IS NOT NULL) GROUP BY dvid, srcintfrole, dstintfrole, agg_timescale, domain, catdesc, f_user, group_info, srcip, srcintf, srcuuid, srcmac, dstip, dstintf, dstuuid, dstcountry, policymode, policyid, policytype ) agg_query ) rank_query /*SkipSTART*/ ORDER BY (CASE WHEN session_rank<$fv_rank_limit OR threatweight_rank<$fv_rank_limit THEN least(session_rank, threatweight_rank) ELSE session_rank*threatweight_rank END) /*SkipEND*/ /*NOHCACHE SELECT dvid, srcintfrole, dstintfrole, timescale, domain, catdesc, f_group AS group_info, avatar, epeuid, f_user, srcip, srcintf, srcuuid, srcmac, dstip, dstintf, dstuuid, dstcountry, policymode, policyid, policytype, browsetime, threatweight, threat_block, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, bandwidth, traffic_in, traffic_out, session_block, sessions FROM (SELECT dvid, srcintfrole, dstintfrole, $fv_timescale AS timescale, epid, coalesce(nullifna(`user`), nullifna(`unauthuser`)) AS f_user, `group` AS f_group, srcip, srcintf, srcuuid, srcmac, srcinetsvc, coalesce(srcname, srcmac) AS dev_src, dstip, dstintf, dstuuid, dstowner, dstmac, get_devtype(srcswversion, osname, devtype) AS devtype, dstcountry, app_group_name(app) AS app_group, rulename, vwlid, ((CASE WHEN (logflag&64>0) THEN 2 ELSE 0 END) | (CASE WHEN appcat='unscanned' THEN 1 ELSE 0 END)) AS flags, (CASE WHEN (logflag&64>0) THEN hostname ELSE root_domain(hostname) END) AS domain, catdesc, policymode, policyid, policytype, poluuid, policyname, accessproxy, saasname, fctuid, (CASE WHEN fctuid IS NOT NULL AND unauthuser IS NOT NULL THEN fctuid || ',' || unauthuser ELSE NULL END) AS avatar, (CASE WHEN epid>1023 AND euid IS NOT NULL THEN epid || ',' || euid ELSE NULL END) AS epeuid, $browse_time AS browsetime, dtime AS logtime, threatlvl, threatwgt AS threatweight, (CASE WHEN (logflag&2>0) THEN threatwgt ELSE 0 END) AS threat_block, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, (coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) AS bandwidth, (coalesce(rcvddelta, rcvdbyte, 0)) AS traffic_in, (coalesce(sentdelta, sentbyte, 0)) AS traffic_out, (CASE WHEN (logflag&2>0) THEN 1 ELSE 0 END) AS session_block, (CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) AS sessions FROM ( SELECT dvid, srcintfrole, dstintfrole, itime, dtime, (case when epid<1024 then NULL else epid end) as epid, euid, `user`, `group`, srcip, srcintf, srcmac, srcname, dstip, dstintf, dstowner, dstmac, dstcountry, app, appcat, srcswversion, osname, devtype, hostname, catdesc, srcuuid, dstuuid, srcinetsvc, accessproxy, saasname, policymode, policyid, policytype, poluuid, policyname, unauthuser, fctuid, ebtime, logflag, sentdelta, sentbyte, rcvddelta, rcvdbyte, coalesce(vwlname,vwlservice) as rulename, vwlid, threatlevel_max(threatlvls) AS threatlvl, threatweight_sum(threatwgts, threatcnts) AS threatwgt, threatweight_level_sum(4,threatlvls,threatcnts,threatwgts) AS thwgt_cri, threatweight_level_sum(3,threatlvls,threatcnts,threatwgts) AS thwgt_hig, threatweight_level_sum(2,threatlvls,threatcnts,threatwgts) AS thwgt_med, threatweight_level_sum(1,threatlvls,threatcnts,threatwgts) AS thwgt_low FROM $log-traffic WHERE $filter AND (logflag&(1|32)>0) ) t ) base_query WHERE (flags & 2 = 0) AND (domain IS NOT NULL OR catdesc IS NOT NULL) NOHCACHE-END*//*HCACHE-AGG SELECT dvid, srcintfrole, dstintfrole, agg_timescale AS timescale, domain, catdesc, group_info, avatar, epeuid, f_user, srcip, srcintf, srcuuid, srcmac, dstip, dstintf, dstuuid, dstcountry, policymode, policyid, policytype, browsetime, threatweight, threat_block, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, bandwidth, traffic_in, traffic_out, session_block, sessions FROM ( SELECT *, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY sessions DESC, threatweight DESC) AS session_rank, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY threatweight DESC, sessions DESC) AS threatweight_rank FROM ( SELECT dvid, srcintfrole, dstintfrole, $fv_agg_timescale(timescale) AS agg_timescale, domain, catdesc, f_user, group_info, srcip, srcintf, srcuuid, srcmac, dstip, dstintf, dstuuid, dstcountry, policymode, policyid, policytype, max(avatar) AS avatar, max(epeuid) AS epeuid, ebtr_agg_flat(browsetime) AS browsetime, sum(threatweight) AS threatweight, sum(threat_block) AS threat_block, sum(thwgt_cri) AS thwgt_cri, sum(thwgt_hig) AS thwgt_hig, sum(thwgt_med) AS thwgt_med, sum(thwgt_low) AS thwgt_low, sum(bandwidth) AS bandwidth, sum(traffic_in) AS traffic_in, sum(traffic_out) AS traffic_out, sum(session_block) AS session_block, sum(sessions) AS sessions FROM ###LOG### GROUP BY dvid, srcintfrole, dstintfrole, agg_timescale, domain, catdesc, f_user, group_info, srcip, srcintf, srcuuid, srcmac, dstip, dstintf, dstuuid, dstcountry, policymode, policyid, policytype ) agg_query ) rank_query ORDER BY (CASE WHEN session_rank<$fv_rank_limit OR threatweight_rank<$fv_rank_limit THEN least(session_rank, threatweight_rank) ELSE session_rank*threatweight_rank END) AGG-END*/)### t group by f_user, srcip order by bandwidth desc"
        set protected enable
    next
    edit "daily-Summary-Top-App"
        set description "Daily Summary - Top Application"
        set log-type traffic
        set query "select app_group, max(appcat) as appcat, (case max(d_risk) when 1 then 'Low' when 2 then 'Elevated' when 3 then 'Medium' when 4 then 'High' when 5 then 'Critical' else NULL end) as risk, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(session_block) as session_block, (sum(sessions)-sum(session_block)) as session_pass, sum(sessions) as sessions from (select t1.*, (case when (d_flags & 1) = 1 then 'Not.Scanned' when t2.app_cat is null then 'Unknown' else t2.app_cat end) as appcat, (case when t2.risk is null then 0 else t2.risk::int end) as d_risk from ###(/*tag:fv_t_app*/SELECT dvid, srcintfrole, dstintfrole, agg_timescale AS timescale, app_group, f_user, f_group, srcip, srcuuid, srcmac, srcintf, srcinetsvc, dstip, dstuuid, dstintf, dstowner, dstcountry, policymode, policyid, policytype, d_flags, avatar, epeuid, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, bandwidth, traffic_in, traffic_out, session_block, sessions FROM ( SELECT * /*SkipSTART*/, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY sessions DESC, bandwidth DESC) AS session_rank, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY bandwidth DESC, sessions DESC) AS bandwidth_rank/*SkipEND*/ FROM ( SELECT dvid, srcintfrole, dstintfrole, $fv_agg_timescale(timescale) AS agg_timescale, app_group, f_user, f_group, srcip, srcuuid, srcmac, srcintf, srcinetsvc, dstip, dstuuid, dstintf, dstowner, dstcountry, policymode, policyid, policytype, ((CASE WHEN (flags & 2 = 0) AND catdesc IS NOT NULL THEN 4 ELSE 0 END) | (flags & 1)) AS d_flags, max(avatar) AS avatar, max(epeuid) AS epeuid, sum(thwgt_cri) AS thwgt_cri, sum(thwgt_hig) AS thwgt_hig, sum(thwgt_med) AS thwgt_med, sum(thwgt_low) AS thwgt_low, sum(bandwidth) AS bandwidth, sum(traffic_in) AS traffic_in, sum(traffic_out) AS traffic_out, sum(session_block) AS session_block, sum(sessions) AS sessions FROM ###base(/*tag:fv_base_t_src_dst*/SELECT dvid, srcintfrole, dstintfrole, $fv_timescale AS timescale, epid, coalesce(nullifna(`user`), nullifna(`unauthuser`)) AS f_user, `group` AS f_group, srcip, srcintf, srcuuid, srcinetsvc, max(srcmac) AS srcmac, max(coalesce(srcname, srcmac)) AS dev_src, dstip, dstintf, dstuuid, dstowner, max(dstmac) AS dstmac, max(get_devtype(srcswversion, osname, devtype)) AS devtype, max(dstcountry) AS dstcountry, app_group_name(app) AS app_group, rulename, vwlid, ((CASE WHEN (logflag&64>0) THEN 2 ELSE 0 END) | (CASE WHEN appcat='unscanned' THEN 1 ELSE 0 END)) AS flags, (CASE WHEN (logflag&64>0) THEN hostname ELSE root_domain(hostname) END) AS domain, catdesc, policymode, policyid, policytype, poluuid, policyname, accessproxy, saasname, fctuid, max((CASE WHEN fctuid IS NOT NULL AND unauthuser IS NOT NULL THEN fctuid || ',' || unauthuser ELSE NULL END)) AS avatar, max((CASE WHEN epid>1023 AND euid IS NOT NULL THEN epid || ',' || euid ELSE NULL END)) AS epeuid, ebtr_agg_flat($browse_time) AS browsetime, max(dtime) AS logtime, max(threatlvl) AS threatlvl, sum(threatwgt) AS threatweight, sum(CASE WHEN (logflag&2>0) THEN threatwgt ELSE 0 END) AS threat_block, sum(thwgt_cri) AS thwgt_cri, sum(thwgt_hig) AS thwgt_hig, sum(thwgt_med) AS thwgt_med, sum(thwgt_low) AS thwgt_low, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) AS bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) AS traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) AS traffic_out, sum((CASE WHEN (logflag&2>0) THEN 1 ELSE 0 END)) AS session_block, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) AS sessions FROM ( SELECT dvid, srcintfrole, dstintfrole, itime, dtime, (case when epid<1024 then NULL else epid end) as epid, euid, `user`, `group`, srcip, srcintf, srcmac, srcname, dstip, dstintf, dstowner, dstmac, dstcountry, app, appcat, srcswversion, osname, devtype, hostname, catdesc, srcuuid, dstuuid, srcinetsvc, accessproxy, saasname, policymode, policyid, policytype, poluuid, policyname, unauthuser, fctuid, ebtime, logflag, sentdelta, sentbyte, rcvddelta, rcvdbyte, coalesce(vwlname,vwlservice) as rulename, vwlid, threatlevel_max(threatlvls) AS threatlvl, threatweight_sum(threatwgts, threatcnts) AS threatwgt, threatweight_level_sum(4,threatlvls,threatcnts,threatwgts) AS thwgt_cri, threatweight_level_sum(3,threatlvls,threatcnts,threatwgts) AS thwgt_hig, threatweight_level_sum(2,threatlvls,threatcnts,threatwgts) AS thwgt_med, threatweight_level_sum(1,threatlvls,threatcnts,threatwgts) AS thwgt_low FROM $log-traffic WHERE $filter AND (logflag&(1|32)>0) ) t1 GROUP BY dvid, srcintfrole, dstintfrole, timescale, epid, f_user, f_group, srcip, srcintf, dstip, dstintf, dstowner, app_group, rulename, vwlid, flags, domain, catdesc, policymode, policyid, policytype, poluuid, policyname, accessproxy, saasname, fctuid, srcuuid, dstuuid, srcinetsvc )base### base_query GROUP BY dvid, srcintfrole, dstintfrole, agg_timescale, app_group, f_user, f_group, srcip, srcuuid, srcmac, srcintf, srcinetsvc, dstip, dstuuid, dstintf, dstowner, dstcountry, policymode, policyid, policytype, d_flags ) agg_query ) rank_query /*SkipSTART*/ORDER BY (CASE WHEN session_rank<$fv_rank_limit OR bandwidth_rank<$fv_rank_limit THEN least(session_rank, bandwidth_rank) ELSE session_rank*bandwidth_rank END)/*SkipEND*/ /*NOHCACHE SELECT dvid, srcintfrole, dstintfrole, timescale, app_group, f_user, f_group, srcip, srcuuid, srcmac, srcintf, srcinetsvc, dstip, dstuuid, dstintf, dstowner, dstcountry, policymode, policyid, policytype, ((CASE WHEN (flags & 2 = 0) AND catdesc IS NOT NULL THEN 4 ELSE 0 END) | (flags & 1)) AS d_flags, avatar, epeuid, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, bandwidth, traffic_in, traffic_out, session_block, sessions FROM (SELECT dvid, srcintfrole, dstintfrole, $fv_timescale AS timescale, epid, coalesce(nullifna(`user`), nullifna(`unauthuser`)) AS f_user, `group` AS f_group, srcip, srcintf, srcuuid, srcmac, srcinetsvc, coalesce(srcname, srcmac) AS dev_src, dstip, dstintf, dstuuid, dstowner, dstmac, get_devtype(srcswversion, osname, devtype) AS devtype, dstcountry, app_group_name(app) AS app_group, rulename, vwlid, ((CASE WHEN (logflag&64>0) THEN 2 ELSE 0 END) | (CASE WHEN appcat='unscanned' THEN 1 ELSE 0 END)) AS flags, (CASE WHEN (logflag&64>0) THEN hostname ELSE root_domain(hostname) END) AS domain, catdesc, policymode, policyid, policytype, poluuid, policyname, accessproxy, saasname, fctuid, (CASE WHEN fctuid IS NOT NULL AND unauthuser IS NOT NULL THEN fctuid || ',' || unauthuser ELSE NULL END) AS avatar, (CASE WHEN epid>1023 AND euid IS NOT NULL THEN epid || ',' || euid ELSE NULL END) AS epeuid, $browse_time AS browsetime, dtime AS logtime, threatlvl, threatwgt AS threatweight, (CASE WHEN (logflag&2>0) THEN threatwgt ELSE 0 END) AS threat_block, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, (coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) AS bandwidth, (coalesce(rcvddelta, rcvdbyte, 0)) AS traffic_in, (coalesce(sentdelta, sentbyte, 0)) AS traffic_out, (CASE WHEN (logflag&2>0) THEN 1 ELSE 0 END) AS session_block, (CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) AS sessions FROM ( SELECT dvid, srcintfrole, dstintfrole, itime, dtime, (case when epid<1024 then NULL else epid end) as epid, euid, `user`, `group`, srcip, srcintf, srcmac, srcname, dstip, dstintf, dstowner, dstmac, dstcountry, app, appcat, srcswversion, osname, devtype, hostname, catdesc, srcuuid, dstuuid, srcinetsvc, accessproxy, saasname, policymode, policyid, policytype, poluuid, policyname, unauthuser, fctuid, ebtime, logflag, sentdelta, sentbyte, rcvddelta, rcvdbyte, coalesce(vwlname,vwlservice) as rulename, vwlid, threatlevel_max(threatlvls) AS threatlvl, threatweight_sum(threatwgts, threatcnts) AS threatwgt, threatweight_level_sum(4,threatlvls,threatcnts,threatwgts) AS thwgt_cri, threatweight_level_sum(3,threatlvls,threatcnts,threatwgts) AS thwgt_hig, threatweight_level_sum(2,threatlvls,threatcnts,threatwgts) AS thwgt_med, threatweight_level_sum(1,threatlvls,threatcnts,threatwgts) AS thwgt_low FROM $log-traffic WHERE $filter AND (logflag&(1|32)>0) ) t ) base_query NOHCACHE-END*//*HCACHE-AGG SELECT dvid, srcintfrole, dstintfrole, agg_timescale AS timescale, app_group, f_user, f_group, srcip, srcuuid, srcmac, srcintf, srcinetsvc, dstip, dstuuid, dstintf, dstowner, dstcountry, policymode, policyid, policytype, d_flags, avatar, epeuid, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, bandwidth, traffic_in, traffic_out, session_block, sessions FROM ( SELECT *, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY sessions DESC, bandwidth DESC) AS session_rank, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY bandwidth DESC, sessions DESC) AS bandwidth_rank FROM ( SELECT dvid, srcintfrole, dstintfrole, $fv_agg_timescale(timescale) AS agg_timescale, app_group, f_user, f_group, srcip, srcuuid, srcmac, srcintf, srcinetsvc, dstip, dstuuid, dstintf, dstowner, dstcountry, policymode, policyid, policytype, d_flags, max(avatar) AS avatar, max(epeuid) AS epeuid, sum(thwgt_cri) AS thwgt_cri, sum(thwgt_hig) AS thwgt_hig, sum(thwgt_med) AS thwgt_med, sum(thwgt_low) AS thwgt_low, sum(bandwidth) AS bandwidth, sum(traffic_in) AS traffic_in, sum(traffic_out) AS traffic_out, sum(session_block) AS session_block, sum(sessions) AS sessions FROM ###LOG### GROUP BY dvid, srcintfrole, dstintfrole, agg_timescale, app_group, f_user, f_group, srcip, srcuuid, srcmac, srcintf, srcinetsvc, dstip, dstuuid, dstintf, dstowner, dstcountry, policymode, policyid, policytype, d_flags ) agg_query ) rank_query ORDER BY (CASE WHEN session_rank<$fv_rank_limit OR bandwidth_rank<$fv_rank_limit THEN least(session_rank, bandwidth_rank) ELSE session_rank*bandwidth_rank END) AGG-END*/)### t1 left join app_mdata t2 on t1.app_group=t2.name) t where $filter-drilldown group by app_group order by max(d_risk) desc, sessions desc, bandwidth desc"
        set protected enable
    next
    edit "daily-Summary-Top-Appcat-Bandwidth"
        set description "Daily Summary - Top Application Category by Bandwidth"
        set log-type traffic
        set query "select appcat, sum(bandwidth) as bandwidth from (select t1.*, t2.app_cat as appcat from ###(/*tag:fv_t_app*/SELECT dvid, srcintfrole, dstintfrole, agg_timescale AS timescale, app_group, f_user, f_group, srcip, srcuuid, srcmac, srcintf, srcinetsvc, dstip, dstuuid, dstintf, dstowner, dstcountry, policymode, policyid, policytype, d_flags, avatar, epeuid, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, bandwidth, traffic_in, traffic_out, session_block, sessions FROM ( SELECT * /*SkipSTART*/, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY sessions DESC, bandwidth DESC) AS session_rank, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY bandwidth DESC, sessions DESC) AS bandwidth_rank/*SkipEND*/ FROM ( SELECT dvid, srcintfrole, dstintfrole, $fv_agg_timescale(timescale) AS agg_timescale, app_group, f_user, f_group, srcip, srcuuid, srcmac, srcintf, srcinetsvc, dstip, dstuuid, dstintf, dstowner, dstcountry, policymode, policyid, policytype, ((CASE WHEN (flags & 2 = 0) AND catdesc IS NOT NULL THEN 4 ELSE 0 END) | (flags & 1)) AS d_flags, max(avatar) AS avatar, max(epeuid) AS epeuid, sum(thwgt_cri) AS thwgt_cri, sum(thwgt_hig) AS thwgt_hig, sum(thwgt_med) AS thwgt_med, sum(thwgt_low) AS thwgt_low, sum(bandwidth) AS bandwidth, sum(traffic_in) AS traffic_in, sum(traffic_out) AS traffic_out, sum(session_block) AS session_block, sum(sessions) AS sessions FROM ###base(/*tag:fv_base_t_src_dst*/SELECT dvid, srcintfrole, dstintfrole, $fv_timescale AS timescale, epid, coalesce(nullifna(`user`), nullifna(`unauthuser`)) AS f_user, `group` AS f_group, srcip, srcintf, srcuuid, srcinetsvc, max(srcmac) AS srcmac, max(coalesce(srcname, srcmac)) AS dev_src, dstip, dstintf, dstuuid, dstowner, max(dstmac) AS dstmac, max(get_devtype(srcswversion, osname, devtype)) AS devtype, max(dstcountry) AS dstcountry, app_group_name(app) AS app_group, rulename, vwlid, ((CASE WHEN (logflag&64>0) THEN 2 ELSE 0 END) | (CASE WHEN appcat='unscanned' THEN 1 ELSE 0 END)) AS flags, (CASE WHEN (logflag&64>0) THEN hostname ELSE root_domain(hostname) END) AS domain, catdesc, policymode, policyid, policytype, poluuid, policyname, accessproxy, saasname, fctuid, max((CASE WHEN fctuid IS NOT NULL AND unauthuser IS NOT NULL THEN fctuid || ',' || unauthuser ELSE NULL END)) AS avatar, max((CASE WHEN epid>1023 AND euid IS NOT NULL THEN epid || ',' || euid ELSE NULL END)) AS epeuid, ebtr_agg_flat($browse_time) AS browsetime, max(dtime) AS logtime, max(threatlvl) AS threatlvl, sum(threatwgt) AS threatweight, sum(CASE WHEN (logflag&2>0) THEN threatwgt ELSE 0 END) AS threat_block, sum(thwgt_cri) AS thwgt_cri, sum(thwgt_hig) AS thwgt_hig, sum(thwgt_med) AS thwgt_med, sum(thwgt_low) AS thwgt_low, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) AS bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) AS traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) AS traffic_out, sum((CASE WHEN (logflag&2>0) THEN 1 ELSE 0 END)) AS session_block, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) AS sessions FROM ( SELECT dvid, srcintfrole, dstintfrole, itime, dtime, (case when epid<1024 then NULL else epid end) as epid, euid, `user`, `group`, srcip, srcintf, srcmac, srcname, dstip, dstintf, dstowner, dstmac, dstcountry, app, appcat, srcswversion, osname, devtype, hostname, catdesc, srcuuid, dstuuid, srcinetsvc, accessproxy, saasname, policymode, policyid, policytype, poluuid, policyname, unauthuser, fctuid, ebtime, logflag, sentdelta, sentbyte, rcvddelta, rcvdbyte, coalesce(vwlname,vwlservice) as rulename, vwlid, threatlevel_max(threatlvls) AS threatlvl, threatweight_sum(threatwgts, threatcnts) AS threatwgt, threatweight_level_sum(4,threatlvls,threatcnts,threatwgts) AS thwgt_cri, threatweight_level_sum(3,threatlvls,threatcnts,threatwgts) AS thwgt_hig, threatweight_level_sum(2,threatlvls,threatcnts,threatwgts) AS thwgt_med, threatweight_level_sum(1,threatlvls,threatcnts,threatwgts) AS thwgt_low FROM $log-traffic WHERE $filter AND (logflag&(1|32)>0) ) t1 GROUP BY dvid, srcintfrole, dstintfrole, timescale, epid, f_user, f_group, srcip, srcintf, dstip, dstintf, dstowner, app_group, rulename, vwlid, flags, domain, catdesc, policymode, policyid, policytype, poluuid, policyname, accessproxy, saasname, fctuid, srcuuid, dstuuid, srcinetsvc )base### base_query GROUP BY dvid, srcintfrole, dstintfrole, agg_timescale, app_group, f_user, f_group, srcip, srcuuid, srcmac, srcintf, srcinetsvc, dstip, dstuuid, dstintf, dstowner, dstcountry, policymode, policyid, policytype, d_flags ) agg_query ) rank_query /*SkipSTART*/ORDER BY (CASE WHEN session_rank<$fv_rank_limit OR bandwidth_rank<$fv_rank_limit THEN least(session_rank, bandwidth_rank) ELSE session_rank*bandwidth_rank END)/*SkipEND*/ /*NOHCACHE SELECT dvid, srcintfrole, dstintfrole, timescale, app_group, f_user, f_group, srcip, srcuuid, srcmac, srcintf, srcinetsvc, dstip, dstuuid, dstintf, dstowner, dstcountry, policymode, policyid, policytype, ((CASE WHEN (flags & 2 = 0) AND catdesc IS NOT NULL THEN 4 ELSE 0 END) | (flags & 1)) AS d_flags, avatar, epeuid, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, bandwidth, traffic_in, traffic_out, session_block, sessions FROM (SELECT dvid, srcintfrole, dstintfrole, $fv_timescale AS timescale, epid, coalesce(nullifna(`user`), nullifna(`unauthuser`)) AS f_user, `group` AS f_group, srcip, srcintf, srcuuid, srcmac, srcinetsvc, coalesce(srcname, srcmac) AS dev_src, dstip, dstintf, dstuuid, dstowner, dstmac, get_devtype(srcswversion, osname, devtype) AS devtype, dstcountry, app_group_name(app) AS app_group, rulename, vwlid, ((CASE WHEN (logflag&64>0) THEN 2 ELSE 0 END) | (CASE WHEN appcat='unscanned' THEN 1 ELSE 0 END)) AS flags, (CASE WHEN (logflag&64>0) THEN hostname ELSE root_domain(hostname) END) AS domain, catdesc, policymode, policyid, policytype, poluuid, policyname, accessproxy, saasname, fctuid, (CASE WHEN fctuid IS NOT NULL AND unauthuser IS NOT NULL THEN fctuid || ',' || unauthuser ELSE NULL END) AS avatar, (CASE WHEN epid>1023 AND euid IS NOT NULL THEN epid || ',' || euid ELSE NULL END) AS epeuid, $browse_time AS browsetime, dtime AS logtime, threatlvl, threatwgt AS threatweight, (CASE WHEN (logflag&2>0) THEN threatwgt ELSE 0 END) AS threat_block, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, (coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) AS bandwidth, (coalesce(rcvddelta, rcvdbyte, 0)) AS traffic_in, (coalesce(sentdelta, sentbyte, 0)) AS traffic_out, (CASE WHEN (logflag&2>0) THEN 1 ELSE 0 END) AS session_block, (CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) AS sessions FROM ( SELECT dvid, srcintfrole, dstintfrole, itime, dtime, (case when epid<1024 then NULL else epid end) as epid, euid, `user`, `group`, srcip, srcintf, srcmac, srcname, dstip, dstintf, dstowner, dstmac, dstcountry, app, appcat, srcswversion, osname, devtype, hostname, catdesc, srcuuid, dstuuid, srcinetsvc, accessproxy, saasname, policymode, policyid, policytype, poluuid, policyname, unauthuser, fctuid, ebtime, logflag, sentdelta, sentbyte, rcvddelta, rcvdbyte, coalesce(vwlname,vwlservice) as rulename, vwlid, threatlevel_max(threatlvls) AS threatlvl, threatweight_sum(threatwgts, threatcnts) AS threatwgt, threatweight_level_sum(4,threatlvls,threatcnts,threatwgts) AS thwgt_cri, threatweight_level_sum(3,threatlvls,threatcnts,threatwgts) AS thwgt_hig, threatweight_level_sum(2,threatlvls,threatcnts,threatwgts) AS thwgt_med, threatweight_level_sum(1,threatlvls,threatcnts,threatwgts) AS thwgt_low FROM $log-traffic WHERE $filter AND (logflag&(1|32)>0) ) t ) base_query NOHCACHE-END*//*HCACHE-AGG SELECT dvid, srcintfrole, dstintfrole, agg_timescale AS timescale, app_group, f_user, f_group, srcip, srcuuid, srcmac, srcintf, srcinetsvc, dstip, dstuuid, dstintf, dstowner, dstcountry, policymode, policyid, policytype, d_flags, avatar, epeuid, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, bandwidth, traffic_in, traffic_out, session_block, sessions FROM ( SELECT *, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY sessions DESC, bandwidth DESC) AS session_rank, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY bandwidth DESC, sessions DESC) AS bandwidth_rank FROM ( SELECT dvid, srcintfrole, dstintfrole, $fv_agg_timescale(timescale) AS agg_timescale, app_group, f_user, f_group, srcip, srcuuid, srcmac, srcintf, srcinetsvc, dstip, dstuuid, dstintf, dstowner, dstcountry, policymode, policyid, policytype, d_flags, max(avatar) AS avatar, max(epeuid) AS epeuid, sum(thwgt_cri) AS thwgt_cri, sum(thwgt_hig) AS thwgt_hig, sum(thwgt_med) AS thwgt_med, sum(thwgt_low) AS thwgt_low, sum(bandwidth) AS bandwidth, sum(traffic_in) AS traffic_in, sum(traffic_out) AS traffic_out, sum(session_block) AS session_block, sum(sessions) AS sessions FROM ###LOG### GROUP BY dvid, srcintfrole, dstintfrole, agg_timescale, app_group, f_user, f_group, srcip, srcuuid, srcmac, srcintf, srcinetsvc, dstip, dstuuid, dstintf, dstowner, dstcountry, policymode, policyid, policytype, d_flags ) agg_query ) rank_query ORDER BY (CASE WHEN session_rank<$fv_rank_limit OR bandwidth_rank<$fv_rank_limit THEN least(session_rank, bandwidth_rank) ELSE session_rank*bandwidth_rank END) AGG-END*/)### t1 left join app_mdata t2 on t1.app_group=t2.name) t where $filter-drilldown and appcat is not null group by appcat order by bandwidth desc"
        set protected enable
    next
    edit "daily-Summary-Traffic-Bandwidth-Line"
        set description "Daily Summary - Traffic Bandwidth Line"
        set log-type traffic
        set query "select $fv_line_timescale(timescale) as time, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(session_block) as session_block, (sum(sessions)-sum(session_block)) as session_pass from ((select timescale, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(session_block) as session_block, sum(sessions) as sessions from ###(/*tag:fv_t_src_dst*/SELECT dvid, srcintfrole, dstintfrole, agg_timescale AS timescale, epid, f_user, srcip, srcintf, srcuuid, srcmac, dev_src, dstip, dstintf, dstuuid, dstowner, dstmac, dstcountry, app_group, policymode, policyid, policytype, d_flags, catdesc, domain, devtype, avatar, epeuid, browsetime, accessproxy, (CASE threatlvl WHEN 4 THEN 'critical' WHEN 3 THEN 'high' WHEN 2 THEN 'medium' WHEN 1 THEN 'low' ELSE NULL END)::fgt_enum_crlevel AS crlevel, threatweight, threat_block, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, bandwidth, traffic_in, traffic_out, session_block, sessions, incident_block, incidents FROM ( SELECT * /*SkipSTART*/, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY sessions DESC, bandwidth DESC) AS session_rank, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY bandwidth DESC, sessions DESC) AS bandwidth_rank /*SkipEND*/ FROM ( SELECT dvid, srcintfrole, dstintfrole, $fv_agg_timescale(timescale) AS agg_timescale, epid, f_user, srcip, srcintf, srcuuid, accessproxy, max(srcmac) AS srcmac, max(dev_src) AS dev_src, dstip, dstintf, dstuuid, dstowner, max(dstmac) AS dstmac, app_group, policymode, policyid, policytype, flags AS d_flags, catdesc, domain, max(devtype) AS devtype, max(dstcountry) AS dstcountry, max(avatar) AS avatar, max(epeuid) AS epeuid, ebtr_agg_flat(browsetime) AS browsetime, max(threatlvl) AS threatlvl, sum(threatweight) AS threatweight, sum(threat_block) AS threat_block, sum(thwgt_cri) AS thwgt_cri, sum(thwgt_hig) AS thwgt_hig, sum(thwgt_med) AS thwgt_med, sum(thwgt_low) AS thwgt_low, sum(bandwidth) AS bandwidth, sum(traffic_in) AS traffic_in, sum(traffic_out) AS traffic_out, sum(session_block) AS session_block, sum(sessions) AS sessions, sum(session_block) AS incident_block, sum(sessions) AS incidents FROM ###base(/*tag:fv_base_t_src_dst*/SELECT dvid, srcintfrole, dstintfrole, $fv_timescale AS timescale, epid, coalesce(nullifna(`user`), nullifna(`unauthuser`)) AS f_user, `group` AS f_group, srcip, srcintf, srcuuid, srcinetsvc, max(srcmac) AS srcmac, max(coalesce(srcname, srcmac)) AS dev_src, dstip, dstintf, dstuuid, dstowner, max(dstmac) AS dstmac, max(get_devtype(srcswversion, osname, devtype)) AS devtype, max(dstcountry) AS dstcountry, app_group_name(app) AS app_group, rulename, vwlid, ((CASE WHEN (logflag&64>0) THEN 2 ELSE 0 END) | (CASE WHEN appcat='unscanned' THEN 1 ELSE 0 END)) AS flags, (CASE WHEN (logflag&64>0) THEN hostname ELSE root_domain(hostname) END) AS domain, catdesc, policymode, policyid, policytype, poluuid, policyname, accessproxy, saasname, fctuid, max((CASE WHEN fctuid IS NOT NULL AND unauthuser IS NOT NULL THEN fctuid || ',' || unauthuser ELSE NULL END)) AS avatar, max((CASE WHEN epid>1023 AND euid IS NOT NULL THEN epid || ',' || euid ELSE NULL END)) AS epeuid, ebtr_agg_flat($browse_time) AS browsetime, max(dtime) AS logtime, max(threatlvl) AS threatlvl, sum(threatwgt) AS threatweight, sum(CASE WHEN (logflag&2>0) THEN threatwgt ELSE 0 END) AS threat_block, sum(thwgt_cri) AS thwgt_cri, sum(thwgt_hig) AS thwgt_hig, sum(thwgt_med) AS thwgt_med, sum(thwgt_low) AS thwgt_low, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) AS bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) AS traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) AS traffic_out, sum((CASE WHEN (logflag&2>0) THEN 1 ELSE 0 END)) AS session_block, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) AS sessions FROM ( SELECT dvid, srcintfrole, dstintfrole, itime, dtime, (case when epid<1024 then NULL else epid end) as epid, euid, `user`, `group`, srcip, srcintf, srcmac, srcname, dstip, dstintf, dstowner, dstmac, dstcountry, app, appcat, srcswversion, osname, devtype, hostname, catdesc, srcuuid, dstuuid, srcinetsvc, accessproxy, saasname, policymode, policyid, policytype, poluuid, policyname, unauthuser, fctuid, ebtime, logflag, sentdelta, sentbyte, rcvddelta, rcvdbyte, coalesce(vwlname,vwlservice) as rulename, vwlid, threatlevel_max(threatlvls) AS threatlvl, threatweight_sum(threatwgts, threatcnts) AS threatwgt, threatweight_level_sum(4,threatlvls,threatcnts,threatwgts) AS thwgt_cri, threatweight_level_sum(3,threatlvls,threatcnts,threatwgts) AS thwgt_hig, threatweight_level_sum(2,threatlvls,threatcnts,threatwgts) AS thwgt_med, threatweight_level_sum(1,threatlvls,threatcnts,threatwgts) AS thwgt_low FROM $log-traffic WHERE $filter AND (logflag&(1|32)>0) ) t1 GROUP BY dvid, srcintfrole, dstintfrole, timescale, epid, f_user, f_group, srcip, srcintf, dstip, dstintf, dstowner, app_group, rulename, vwlid, flags, domain, catdesc, policymode, policyid, policytype, poluuid, policyname, accessproxy, saasname, fctuid, srcuuid, dstuuid, srcinetsvc )base### base_query GROUP BY dvid, srcintfrole, dstintfrole, agg_timescale, epid, f_user, srcip, srcintf, dstip, dstintf, dstowner, app_group, policymode, policyid, policytype, d_flags, catdesc, domain, srcuuid, dstuuid, accessproxy ) agg_query ) rank_query /*SkipSTART*/ ORDER BY (CASE WHEN session_rank<$fv_rank_limit OR bandwidth_rank<$fv_rank_limit THEN least(session_rank, bandwidth_rank) ELSE session_rank*bandwidth_rank END) /*SkipEND*/ /*NOHCACHE SELECT dvid, srcintfrole, dstintfrole, timescale, epid, f_user, srcip, srcintf, srcuuid, srcmac, dev_src, dstip, dstintf, dstuuid, dstowner, dstmac, dstcountry, app_group, policymode, policyid, policytype, flags AS d_flags, catdesc, domain, devtype, avatar, epeuid, browsetime, accessproxy, (CASE threatlvl WHEN 4 THEN 'critical' WHEN 3 THEN 'high' WHEN 2 THEN 'medium' WHEN 1 THEN 'low' ELSE NULL END)::fgt_enum_crlevel AS crlevel, threatweight, threat_block, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, bandwidth, traffic_in, traffic_out, session_block, sessions, session_block AS incident_block, sessions AS incidents FROM (SELECT dvid, srcintfrole, dstintfrole, $fv_timescale AS timescale, epid, coalesce(nullifna(`user`), nullifna(`unauthuser`)) AS f_user, `group` AS f_group, srcip, srcintf, srcuuid, srcmac, srcinetsvc, coalesce(srcname, srcmac) AS dev_src, dstip, dstintf, dstuuid, dstowner, dstmac, get_devtype(srcswversion, osname, devtype) AS devtype, dstcountry, app_group_name(app) AS app_group, rulename, vwlid, ((CASE WHEN (logflag&64>0) THEN 2 ELSE 0 END) | (CASE WHEN appcat='unscanned' THEN 1 ELSE 0 END)) AS flags, (CASE WHEN (logflag&64>0) THEN hostname ELSE root_domain(hostname) END) AS domain, catdesc, policymode, policyid, policytype, poluuid, policyname, accessproxy, saasname, fctuid, (CASE WHEN fctuid IS NOT NULL AND unauthuser IS NOT NULL THEN fctuid || ',' || unauthuser ELSE NULL END) AS avatar, (CASE WHEN epid>1023 AND euid IS NOT NULL THEN epid || ',' || euid ELSE NULL END) AS epeuid, $browse_time AS browsetime, dtime AS logtime, threatlvl, threatwgt AS threatweight, (CASE WHEN (logflag&2>0) THEN threatwgt ELSE 0 END) AS threat_block, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, (coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) AS bandwidth, (coalesce(rcvddelta, rcvdbyte, 0)) AS traffic_in, (coalesce(sentdelta, sentbyte, 0)) AS traffic_out, (CASE WHEN (logflag&2>0) THEN 1 ELSE 0 END) AS session_block, (CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) AS sessions FROM ( SELECT dvid, srcintfrole, dstintfrole, itime, dtime, (case when epid<1024 then NULL else epid end) as epid, euid, `user`, `group`, srcip, srcintf, srcmac, srcname, dstip, dstintf, dstowner, dstmac, dstcountry, app, appcat, srcswversion, osname, devtype, hostname, catdesc, srcuuid, dstuuid, srcinetsvc, accessproxy, saasname, policymode, policyid, policytype, poluuid, policyname, unauthuser, fctuid, ebtime, logflag, sentdelta, sentbyte, rcvddelta, rcvdbyte, coalesce(vwlname,vwlservice) as rulename, vwlid, threatlevel_max(threatlvls) AS threatlvl, threatweight_sum(threatwgts, threatcnts) AS threatwgt, threatweight_level_sum(4,threatlvls,threatcnts,threatwgts) AS thwgt_cri, threatweight_level_sum(3,threatlvls,threatcnts,threatwgts) AS thwgt_hig, threatweight_level_sum(2,threatlvls,threatcnts,threatwgts) AS thwgt_med, threatweight_level_sum(1,threatlvls,threatcnts,threatwgts) AS thwgt_low FROM $log-traffic WHERE $filter AND (logflag&(1|32)>0) ) t ) base_query NOHCACHE-END*//*HCACHE-AGG SELECT dvid, srcintfrole, dstintfrole, agg_timescale AS timescale, epid, f_user, srcip, srcintf, srcuuid, srcmac, dev_src, dstip, dstintf, dstuuid, dstowner, dstmac, dstcountry, app_group, policymode, policyid, policytype, d_flags, catdesc, domain, devtype, avatar, epeuid, browsetime, accessproxy, crlevel, threatweight, threat_block, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, bandwidth, traffic_in, traffic_out, session_block, sessions, incident_block, incidents FROM ( SELECT *, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY sessions DESC, bandwidth DESC) AS session_rank, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY bandwidth DESC, sessions DESC) AS bandwidth_rank FROM ( SELECT dvid, srcintfrole, dstintfrole, $fv_agg_timescale(timescale) AS agg_timescale, epid, f_user, srcip, srcintf, srcuuid, accessproxy, max(srcmac) AS srcmac, max(dev_src) AS dev_src, dstip, dstintf, dstuuid, dstowner, max(dstmac) AS dstmac, app_group, policymode, policyid, policytype, d_flags, catdesc, domain, max(devtype) AS devtype, max(dstcountry) AS dstcountry, max(avatar) AS avatar, max(epeuid) AS epeuid, ebtr_agg_flat(browsetime) AS browsetime, max(crlevel) AS crlevel, sum(threatweight) AS threatweight, sum(threat_block) AS threat_block, sum(thwgt_cri) AS thwgt_cri, sum(thwgt_hig) AS thwgt_hig, sum(thwgt_med) AS thwgt_med, sum(thwgt_low) AS thwgt_low, sum(bandwidth) AS bandwidth, sum(traffic_in) AS traffic_in, sum(traffic_out) AS traffic_out, sum(session_block) AS session_block, sum(sessions) AS sessions, sum(incident_block) AS incident_block, sum(incidents) AS incidents FROM ###LOG### GROUP BY dvid, srcintfrole, dstintfrole, agg_timescale, epid, f_user, srcip, srcintf, dstip, dstintf, dstowner, app_group, policymode, policyid, policytype, d_flags, catdesc, domain, srcuuid, dstuuid, accessproxy ) agg_query ) rank_query ORDER BY (CASE WHEN session_rank<$fv_rank_limit OR bandwidth_rank<$fv_rank_limit THEN least(session_rank, bandwidth_rank) ELSE session_rank*bandwidth_rank END) AGG-END*/)### t group by timescale) union all (select timescale, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out, sum(session_block) as session_block, sum(sessions) as sessions from ###(/*tag:fv_a_src_dst*/SELECT dvid, srcintfrole, dstintfrole, agg_timescale AS timescale, epid, f_user, srcip, srcintf, cast(NULL AS uuid) AS srcuuid, cast(NULL AS char) AS srcmac, cast(NULL AS char) AS dev_src, dstip, dstintf, cast(NULL AS uuid) AS dstuuid, cast(NULL AS fgt_enum_dstowner) AS dstowner, cast(NULL AS char) AS dstmac, cast(NULL AS char) AS dstcountry, cast(NULL AS char) AS app_group, cast(NULL AS char) AS policymode, 0 AS policyid, cast(NULL AS fgt_enum_traffic_policytype) AS policytype, 0 AS d_flags, cast(NULL AS char) AS catdesc, cast(NULL AS char) AS domain, cast(NULL AS char) AS devtype, avatar, epeuid, cast(NULL AS int4range[]) AS browsetime, cast(NULL AS char) AS accessproxy, crlevel, threatweight, threat_block, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, 0 AS bandwidth, 0 AS traffic_in, 0 AS traffic_out, 0 AS session_block, 0 AS sessions, incident_block, incidents FROM ( SELECT * /*SkipSTART*/, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY incidents DESC) AS incident_rank /*SkipEND*/ FROM ( SELECT dvid, srcintfrole, dstintfrole, $fv_agg_timescale(timescale) AS agg_timescale, epid, f_user, srcip, srcintf, dstip, dstintf, max(avatar) AS avatar, max(epeuid) AS epeuid, max(crlevel) AS crlevel, sum(threatweight) AS threatweight, sum(threat_block) AS threat_block, sum(thwgt_cri) AS thwgt_cri, sum(thwgt_hig) AS thwgt_hig, sum(thwgt_med) AS thwgt_med, sum(thwgt_low) AS thwgt_low, sum(incidents) AS incident_block, sum(incidents) AS incidents FROM ###base(/*tag:fv_base_a_src_dst*/SELECT dvid, srcintfrole, dstintfrole, $fv_timescale AS timescale, coalesce(nullifna(`user`), nullifna(`unauthuser`)) AS f_user, epid, srcip, srcintf, dstip, dstintf, policyid, policytype, max((CASE WHEN fctuid IS NOT NULL AND unauthuser IS NOT NULL THEN fctuid || ',' || unauthuser ELSE NULL END)) AS avatar, max((CASE WHEN epid>1023 AND euid IS NOT NULL THEN epid || ',' || euid ELSE NULL END)) AS epeuid, max(crlevel) AS crlevel, sum(crscore) AS threatweight, sum(crscore) AS threat_block, sum(CASE WHEN crlevel='critical' THEN crscore ELSE 0 END) AS thwgt_cri, sum(CASE WHEN crlevel='high'     THEN crscore ELSE 0 END) AS thwgt_hig, sum(CASE WHEN crlevel='medium'   THEN crscore ELSE 0 END) AS thwgt_med, sum(CASE WHEN crlevel='low'      THEN crscore ELSE 0 END) AS thwgt_low, count(*) AS incidents FROM ( SELECT dvid, srcintfrole, dstintfrole, itime, dtime, (case when epid<1024 then NULL else epid end) as epid, euid, `user`, srcip, srcintf, dstip, dstintf, policyid, policytype, unauthuser, fctuid, crlevel, coalesce(crscore, 0)&65535 AS crscore FROM $log-attack WHERE $filter AND msg LIKE 'anomaly%' ) t1 GROUP BY dvid, srcintfrole, dstintfrole, timescale, epid, f_user, srcip, srcintf, dstip, dstintf, policyid, policytype )base### base_query GROUP BY dvid, srcintfrole, dstintfrole, agg_timescale, epid, f_user, srcip, srcintf, dstip, dstintf ) agg_query ) rank_query /*SkipSTART*/ ORDER BY incident_rank /*SkipEND*/ /*HCACHE-AGG SELECT dvid, srcintfrole, dstintfrole, agg_timescale AS timescale, epid, f_user, srcip, srcintf, cast(NULL AS uuid) AS srcuuid, cast(NULL AS char) AS srcmac, cast(NULL AS char) AS dev_src, dstip, dstintf, cast(NULL AS uuid) AS dstuuid, cast(NULL AS fgt_enum_dstowner) AS dstowner, cast(NULL AS char) AS dstmac, cast(NULL AS char) AS dstcountry, cast(NULL AS char) AS app_group, cast(NULL AS char) AS policymode, 0 AS policyid, cast(NULL AS fgt_enum_traffic_policytype) AS policytype, 0 AS d_flags, cast(NULL AS char) AS catdesc, cast(NULL AS char) AS domain, cast(NULL AS char) AS devtype, avatar, epeuid, cast(NULL AS int4range[]) AS browsetime, cast(NULL AS char) AS accessproxy, crlevel, threatweight, threat_block, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, 0 AS bandwidth, 0 AS traffic_in, 0 AS traffic_out, 0 AS session_block, 0 AS sessions, incident_block, incidents FROM ( SELECT *, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY incidents DESC) AS incident_rank FROM ( SELECT dvid, srcintfrole, dstintfrole, $fv_agg_timescale(timescale) AS agg_timescale, epid, f_user, srcip, srcintf, dstip, dstintf, max(avatar) AS avatar, max(epeuid) AS epeuid, max(crlevel) AS crlevel, sum(threatweight) AS threatweight, sum(threat_block) AS threat_block, sum(thwgt_cri) AS thwgt_cri, sum(thwgt_hig) AS thwgt_hig, sum(thwgt_med) AS thwgt_med, sum(thwgt_low) AS thwgt_low, sum(incident_block) AS incident_block, sum(incidents) AS incidents FROM ###LOG### GROUP BY dvid, srcintfrole, dstintfrole, agg_timescale, epid, f_user, srcip, srcintf, dstip, dstintf ) agg_query ) rank_query ORDER BY incident_rank AGG-END*/ )### t group by timescale)) t group by time order by time"
        set protected enable
    next
    edit "daily-Summary-Top-Threats"
        set description "Daily Summary - Top Threats"
        set log-type traffic
        set query "select threat_s as threat, threattype_s as threattype, sum(threatweight) as threatweight, sum(threat_block) as threat_block, (sum(threatweight)-sum(threat_block)) as threat_pass, sum(incidents) as incidents, sum(incident_block) as incident_block, (sum(incidents)-sum(incident_block)) as incident_pass from ((select threat_s, threattype_s, sum(threatweight) as threatweight, sum(threat_block) as threat_block, sum(incidents) as incidents, sum(incident_block) as incident_block from ###(/*tag:fv_t_threat*/SELECT dvid, srcintfrole, dstintfrole, agg_timescale AS timescale, 10 AS logtype, threat_s, threattype_s, threatlevel_s, app_group, dstcountry, f_user, srcip, srcuuid, srcintf, srcmac, dstip, dstuuid, dstintf, dstowner, policyid, policytype, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, threatweight, threat_block, incident_block, incidents FROM ( SELECT * /*SkipSTART*/, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY threatweight DESC, incidents DESC) AS thwgt_rank, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY incidents DESC, threatweight DESC) AS incident_rank /*SkipEND*/ FROM ( SELECT dvid, srcintfrole, dstintfrole, agg_timescale, threat_s, threattype_s, threatlevel_s, app_group, f_user, srcip, srcuuid, srcintf, srcmac, dstip, dstuuid, dstintf, dstowner, policyid, policytype, max(dstcountry) AS dstcountry, sum(CASE WHEN threatlevel_s=4 THEN (thweight*thcnt) ELSE 0 END) AS thwgt_cri, sum(CASE WHEN threatlevel_s=3 THEN (thweight*thcnt) ELSE 0 END) AS thwgt_hig, sum(CASE WHEN threatlevel_s=2 THEN (thweight*thcnt) ELSE 0 END) AS thwgt_med, sum(CASE WHEN threatlevel_s=1 THEN (thweight*thcnt) ELSE 0 END) AS thwgt_low, sum(thweight*thcnt) AS threatweight, sum(incident_block*thcnt) AS incident_block, sum(thcnt) AS incidents, sum(CASE WHEN incident_block=1 THEN thweight*thcnt ELSE 0 END) as threat_block FROM ( SELECT dvid, srcintfrole, dstintfrole, $fv_timescale AS agg_timescale, unnest(threats) AS threat_s, unnest(threattyps) AS threattype_s, unnest(threatlvls) AS threatlevel_s, unnest(threatcnts) AS thcnt, unnest(threatwgts) AS thweight, app_group_name(app) AS app_group, dstcountry, coalesce(nullifna(`user`), nullifna(`unauthuser`)) AS f_user, srcip, srcuuid, srcintf, srcmac, dstip, dstuuid, dstintf, dstowner, policyid, policytype, (CASE WHEN (logflag&2>0) THEN 1 ELSE 0 END) AS incident_block FROM $log-traffic WHERE $filter AND threats IS NOT NULL ) AS t GROUP BY dvid, srcintfrole, dstintfrole, agg_timescale, threat_s, threattype_s, threatlevel_s, app_group, f_user, srcip, srcuuid, srcintf, srcmac, dstip, dstuuid, dstintf, dstowner, policyid, policytype ) agg_query ) rank_query /*SkipSTART*/ ORDER BY (CASE WHEN thwgt_rank<$fv_rank_limit OR incident_rank<$fv_rank_limit THEN least(thwgt_rank, incident_rank) ELSE thwgt_rank*incident_rank END) /*SkipEND*/ /*HCACHE-AGG SELECT dvid, srcintfrole, dstintfrole, agg_timescale AS timescale, 10 AS logtype, threat_s, threattype_s, threatlevel_s, app_group, dstcountry, f_user, srcip, srcuuid, srcintf, srcmac, dstip, dstuuid, dstintf, dstowner, policyid, policytype, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, threatweight, threat_block, incident_block, incidents FROM ( SELECT *, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY threatweight DESC, incidents DESC) AS thwgt_rank, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY incidents DESC, threatweight DESC) AS incident_rank FROM ( SELECT dvid, srcintfrole, dstintfrole, $fv_agg_timescale(timescale) AS agg_timescale, threat_s, threattype_s, threatlevel_s, app_group, f_user, srcip, srcuuid, srcintf, srcmac, dstip, dstuuid, dstintf, dstowner, policyid, policytype, max(dstcountry) AS dstcountry, sum(thwgt_cri) AS thwgt_cri, sum(thwgt_hig) AS thwgt_hig, sum(thwgt_med) AS thwgt_med, sum(thwgt_low) AS thwgt_low, sum(threatweight) AS threatweight, sum(threat_block) AS threat_block, sum(incident_block) AS incident_block, sum(incidents) AS incidents FROM ###LOG### GROUP BY dvid, srcintfrole, dstintfrole, agg_timescale, threat_s, threattype_s, threatlevel_s, app_group, f_user, srcip, srcuuid, srcintf, srcmac, dstip, dstuuid, dstintf, dstowner, policyid, policytype ) agg_query ) rank_query ORDER BY (CASE WHEN thwgt_rank<$fv_rank_limit OR incident_rank<$fv_rank_limit THEN least(thwgt_rank, incident_rank) ELSE thwgt_rank*incident_rank END) AGG-END*/ )### t group by threat_s, threattype_s) union all (select threat_s, threattype_s, sum(threatweight) as threatweight, sum(threat_block) as threat_block, sum(incidents) as incidents, sum(incident_block) as incident_block from ###(/*tag:fv_a_threat*/SELECT dvid, srcintfrole, dstintfrole, agg_timescale AS timescale, 1 AS logtype, threat_s, threattype_s, threatlevel_s, cast(NULL AS char) AS app_group, cast(NULL AS char) AS dstcountry, f_user, srcip, cast(NULL AS uuid) AS srcuuid, srcintf, cast(NULL AS char) AS srcmac, dstip, cast(NULL AS uuid) AS dstuuid, dstintf, cast(NULL AS fgt_enum_dstowner) AS dstowner, 0 AS policyid, cast(NULL AS fgt_enum_traffic_policytype) AS policytype, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, threatweight, threat_block, incident_block, incidents FROM ( SELECT * /*SkipSTART*/, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY threatweight DESC, incidents DESC) AS thwgt_rank, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY incidents DESC, threatweight DESC) AS incident_rank /*SkipEND*/ FROM ( SELECT dvid, srcintfrole, dstintfrole, $fv_timescale AS agg_timescale, threat AS threat_s, threattype AS threattype_s, threatlevel AS threatlevel_s, `user` AS f_user, srcip, srcintf, dstip, dstintf, sum(CASE WHEN threatlevel=4 THEN (coalesce(crscore, 0)&65535) ELSE 0 END) AS thwgt_cri, sum(CASE WHEN threatlevel=3 THEN (coalesce(crscore, 0)&65535) ELSE 0 END) AS thwgt_hig, sum(CASE WHEN threatlevel=2 THEN (coalesce(crscore, 0)&65535) ELSE 0 END) AS thwgt_med, sum(CASE WHEN threatlevel=1 THEN (coalesce(crscore, 0)&65535) ELSE 0 END) AS thwgt_low, sum(coalesce(crscore, 0)&65535) AS threatweight, sum(coalesce(crscore, 0)&65535) AS threat_block, count(*) AS incident_block, count(*) AS incidents FROM $log-attack WHERE $filter AND threat IS NOT NULL AND msg LIKE 'anomaly%' GROUP BY dvid, srcintfrole, dstintfrole, agg_timescale, threat, threattype, threatlevel, f_user, srcip, srcintf, dstip, dstintf ) agg_query ) rank_query /*SkipSTART*/ ORDER BY (CASE WHEN thwgt_rank<$fv_rank_limit OR incident_rank<$fv_rank_limit THEN least(thwgt_rank, incident_rank) ELSE thwgt_rank*incident_rank END) /*SkipEND*/ /*HCACHE-AGG SELECT dvid, srcintfrole, dstintfrole, agg_timescale AS timescale, 1 AS logtype, threat_s, threattype_s, threatlevel_s, cast(NULL AS char) AS app_group, cast(NULL AS char) AS dstcountry, f_user, srcip, cast(NULL AS uuid) AS srcuuid, srcintf, cast(NULL AS char) AS srcmac, dstip, cast(NULL AS uuid) AS dstuuid, dstintf, cast(NULL AS fgt_enum_dstowner) AS dstowner, 0 AS policyid, cast(NULL AS fgt_enum_traffic_policytype) AS policytype, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, threatweight, threat_block, incident_block, incidents FROM ( SELECT *, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY threatweight DESC, incidents DESC) AS thwgt_rank, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY incidents DESC, threatweight DESC) AS incident_rank FROM ( SELECT dvid, srcintfrole, dstintfrole, $fv_agg_timescale(timescale) AS agg_timescale, threat_s, threattype_s, threatlevel_s, f_user, srcip, srcintf, dstip, dstintf, sum(thwgt_cri) AS thwgt_cri, sum(thwgt_hig) AS thwgt_hig, sum(thwgt_med) AS thwgt_med, sum(thwgt_low) AS thwgt_low, sum(threatweight) AS threatweight, sum(threat_block) AS threat_block, sum(incident_block) AS incident_block, sum(incidents) AS incidents FROM ###LOG### GROUP BY dvid, srcintfrole, dstintfrole, agg_timescale, threat_s, threattype_s, threatlevel_s, f_user, srcip, srcintf, dstip, dstintf ) agg_query ) rank_query ORDER BY (CASE WHEN thwgt_rank<$fv_rank_limit OR incident_rank<$fv_rank_limit THEN least(thwgt_rank, incident_rank) ELSE thwgt_rank*incident_rank END) AGG-END*/ )### t group by threat_s, threattype_s)) t group by threat, threattype order by threatweight desc"
        set protected enable
    next
    edit "daily-Summary-Top-Compromised-Hosts"
        set description "Daily Summary - Top Compromised Hosts"
        set log-type traffic
        set query "select epid, devid, vd, srcip, devtype, fctuid, euid, bmp_logtype as logtype, unauthuser, srcmac, osname, osversion, f_user,(case when epid<1024 then ipstr(srcip) else epname end) as epname,threat_num, bl_count, cs_score, cs_count, verdict, ip_reversed, rescan, (case verdict when 1 then 'Low Suspicion' when 2 then 'Medium Suspicion' when 3 then 'High Suspicion' when 4 then 'Infected' else 'N/A' end) as verdict_s,ack_time, ack_note, last_bl as last_detected_time from (SELECT epid, itime, bl_count, cs_score, cs_count, threat_num, bmp_logtype, last_bl, verdict, ip_reversed, rescan, srcip, epname, srcmac, osname, osversion, devtype, fctuid, euid, unauthuser, f_user, ack_note, ack_time, devid, vd, csf, devname FROM (SELECT tvdt.epid, itime, tvdt.bl_count, tvdt.cs_score, tvdt.cs_count, tvdt.threat_num, tvdt.bmp_logtype, tvdt.last_bl, tvdt.verdict, tvdt.ip_reversed, tvdt.rescan, (CASE WHEN tvdt.epid>1024 THEN tep.epip ELSE tvdt.srcip END) as srcip, tep.epname, tep.mac as srcmac, tep.osname, tep.osversion,tep.epdevtype as devtype, teu.fctuid, teu.euid, teu.unauthuser, (case when teu.euid<=1024 then ipstr(tvdt.srcip) else teu.euname end) as f_user, tack.ack_note, (case when (tvdt.ack_time_max=0 or tvdt.ack_time_min=0) then NULL else tvdt.ack_time_max end) as ack_time,tdev.devid, tdev.vd, tdev.csf, tdev.devname, tdev.devgrps FROM (SELECT epid, srcip, min(day_st) as itime, array_length(intarr_agg(threatid), 1) as threat_num, intarr_agg(dvid) as dvid, sum(bl_count) as bl_count, max(cs_score) as cs_score, sum(cs_count) as cs_count, max(last_bl) as last_bl, max(ack_time) as ack_time_max, min(ack_time) as ack_time_min, bit_or(bmp_logtype) as bmp_logtype, max(verdict) as verdict, max(ip_reversed) as ip_reversed, max(rescan) as rescan FROM ((SELECT epid, srcip, day_st, ack_time, threatid, dvid,bl_count, cs_score, cs_count, last_bl, bmp_logtype, verdict, (case when ioc_flags&2>0 then 1 else 0 end) as ip_reversed, (case when ioc_flags&1>0 then 1 else 0 end) as rescan FROM $ADOMTBL_PLHD_IOC_VERDICT /*verdict table*/WHERE day_st>=$start_time and day_st<=$end_time /*time filter*/) UNION ALL (SELECT epid, srcip, day_st, ack_time, threatid, dvid,bl_count, cs_score, cs_count, last_bl, bmp_logtype, verdict, (case when ioc_flags&2>0 then 1 else 0 end) as ip_reversed, (case when ioc_flags&1>0 then 1 else 0 end) as rescan FROM $ADOMTBL_PLHD_INTERIM_IOC_VERDICT /*verdict intrim table*/WHERE day_st>=$start_time and day_st<=$end_time /*time filter*/ and verdict>0)) tvdt_int GROUP BY epid, srcip) tvdt INNER JOIN /*end points*/  $ADOM_ENDPOINT as tep ON tvdt.epid=tep.epid LEFT JOIN /*end user*/ (select epid, euname, fctuid, euid, unauthuser from (select epid, eu.euid, euname, fctuid, euname as unauthuser, row_number() over (partition by epid order by ((case when fctuid is null then 0 else 1 end), lastactive) desc) nth from $ADOM_ENDUSER eu /*end user*/, $ADOM_EPEU_DEVMAP as map /*epeu dev_map*/ where eu.euid=map.euid and eu.euid>1024) eum where nth=1) teu on tvdt.epid=teu.epid LEFT JOIN /*ack table*/(SELECT epid, srcip, ack_time, ack_note FROM (SELECT epid, srcip, ack_time, ack_note, row_number() over (PARTITION BY epid, srcip order by ack_time desc) as ackrank FROM ioc_ack WHERE adomoid=$adom_oid) rankqry WHERE ackrank=1) tack ON tvdt.epid=tack.epid and ((tvdt.srcip is null and tack.srcip is null) or tvdt.srcip=tack.srcip) LEFT JOIN devtable_ext tdev ON tdev.dvid = tvdt.dvid[1] WHERE tvdt.dvid && (SELECT array_agg(dvid) from devtable_ext WHERE $filter-drilldown)) tioc) t order by threat_num desc"
        set protected enable
    next
    edit "daily-Summary-Total-Bandwidth"
        set description "Daily Summary - Total Bandwidth"
        set log-type traffic
        set query "select sum(bandwidth) as totalnum from ((select sum(bandwidth) as bandwidth from ###(/*tag:fv_t_src_dst*/SELECT dvid, srcintfrole, dstintfrole, agg_timescale AS timescale, epid, f_user, srcip, srcintf, srcuuid, srcmac, dev_src, dstip, dstintf, dstuuid, dstowner, dstmac, dstcountry, app_group, policymode, policyid, policytype, d_flags, catdesc, domain, devtype, avatar, epeuid, browsetime, accessproxy, (CASE threatlvl WHEN 4 THEN 'critical' WHEN 3 THEN 'high' WHEN 2 THEN 'medium' WHEN 1 THEN 'low' ELSE NULL END)::fgt_enum_crlevel AS crlevel, threatweight, threat_block, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, bandwidth, traffic_in, traffic_out, session_block, sessions, incident_block, incidents FROM ( SELECT * /*SkipSTART*/, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY sessions DESC, bandwidth DESC) AS session_rank, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY bandwidth DESC, sessions DESC) AS bandwidth_rank /*SkipEND*/ FROM ( SELECT dvid, srcintfrole, dstintfrole, $fv_agg_timescale(timescale) AS agg_timescale, epid, f_user, srcip, srcintf, srcuuid, accessproxy, max(srcmac) AS srcmac, max(dev_src) AS dev_src, dstip, dstintf, dstuuid, dstowner, max(dstmac) AS dstmac, app_group, policymode, policyid, policytype, flags AS d_flags, catdesc, domain, max(devtype) AS devtype, max(dstcountry) AS dstcountry, max(avatar) AS avatar, max(epeuid) AS epeuid, ebtr_agg_flat(browsetime) AS browsetime, max(threatlvl) AS threatlvl, sum(threatweight) AS threatweight, sum(threat_block) AS threat_block, sum(thwgt_cri) AS thwgt_cri, sum(thwgt_hig) AS thwgt_hig, sum(thwgt_med) AS thwgt_med, sum(thwgt_low) AS thwgt_low, sum(bandwidth) AS bandwidth, sum(traffic_in) AS traffic_in, sum(traffic_out) AS traffic_out, sum(session_block) AS session_block, sum(sessions) AS sessions, sum(session_block) AS incident_block, sum(sessions) AS incidents FROM ###base(/*tag:fv_base_t_src_dst*/SELECT dvid, srcintfrole, dstintfrole, $fv_timescale AS timescale, epid, coalesce(nullifna(`user`), nullifna(`unauthuser`)) AS f_user, `group` AS f_group, srcip, srcintf, srcuuid, srcinetsvc, max(srcmac) AS srcmac, max(coalesce(srcname, srcmac)) AS dev_src, dstip, dstintf, dstuuid, dstowner, max(dstmac) AS dstmac, max(get_devtype(srcswversion, osname, devtype)) AS devtype, max(dstcountry) AS dstcountry, app_group_name(app) AS app_group, rulename, vwlid, ((CASE WHEN (logflag&64>0) THEN 2 ELSE 0 END) | (CASE WHEN appcat='unscanned' THEN 1 ELSE 0 END)) AS flags, (CASE WHEN (logflag&64>0) THEN hostname ELSE root_domain(hostname) END) AS domain, catdesc, policymode, policyid, policytype, poluuid, policyname, accessproxy, saasname, fctuid, max((CASE WHEN fctuid IS NOT NULL AND unauthuser IS NOT NULL THEN fctuid || ',' || unauthuser ELSE NULL END)) AS avatar, max((CASE WHEN epid>1023 AND euid IS NOT NULL THEN epid || ',' || euid ELSE NULL END)) AS epeuid, ebtr_agg_flat($browse_time) AS browsetime, max(dtime) AS logtime, max(threatlvl) AS threatlvl, sum(threatwgt) AS threatweight, sum(CASE WHEN (logflag&2>0) THEN threatwgt ELSE 0 END) AS threat_block, sum(thwgt_cri) AS thwgt_cri, sum(thwgt_hig) AS thwgt_hig, sum(thwgt_med) AS thwgt_med, sum(thwgt_low) AS thwgt_low, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) AS bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) AS traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) AS traffic_out, sum((CASE WHEN (logflag&2>0) THEN 1 ELSE 0 END)) AS session_block, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) AS sessions FROM ( SELECT dvid, srcintfrole, dstintfrole, itime, dtime, (case when epid<1024 then NULL else epid end) as epid, euid, `user`, `group`, srcip, srcintf, srcmac, srcname, dstip, dstintf, dstowner, dstmac, dstcountry, app, appcat, srcswversion, osname, devtype, hostname, catdesc, srcuuid, dstuuid, srcinetsvc, accessproxy, saasname, policymode, policyid, policytype, poluuid, policyname, unauthuser, fctuid, ebtime, logflag, sentdelta, sentbyte, rcvddelta, rcvdbyte, coalesce(vwlname,vwlservice) as rulename, vwlid, threatlevel_max(threatlvls) AS threatlvl, threatweight_sum(threatwgts, threatcnts) AS threatwgt, threatweight_level_sum(4,threatlvls,threatcnts,threatwgts) AS thwgt_cri, threatweight_level_sum(3,threatlvls,threatcnts,threatwgts) AS thwgt_hig, threatweight_level_sum(2,threatlvls,threatcnts,threatwgts) AS thwgt_med, threatweight_level_sum(1,threatlvls,threatcnts,threatwgts) AS thwgt_low FROM $log-traffic WHERE $filter AND (logflag&(1|32)>0) ) t1 GROUP BY dvid, srcintfrole, dstintfrole, timescale, epid, f_user, f_group, srcip, srcintf, dstip, dstintf, dstowner, app_group, rulename, vwlid, flags, domain, catdesc, policymode, policyid, policytype, poluuid, policyname, accessproxy, saasname, fctuid, srcuuid, dstuuid, srcinetsvc )base### base_query GROUP BY dvid, srcintfrole, dstintfrole, agg_timescale, epid, f_user, srcip, srcintf, dstip, dstintf, dstowner, app_group, policymode, policyid, policytype, d_flags, catdesc, domain, srcuuid, dstuuid, accessproxy ) agg_query ) rank_query /*SkipSTART*/ ORDER BY (CASE WHEN session_rank<$fv_rank_limit OR bandwidth_rank<$fv_rank_limit THEN least(session_rank, bandwidth_rank) ELSE session_rank*bandwidth_rank END) /*SkipEND*/ /*NOHCACHE SELECT dvid, srcintfrole, dstintfrole, timescale, epid, f_user, srcip, srcintf, srcuuid, srcmac, dev_src, dstip, dstintf, dstuuid, dstowner, dstmac, dstcountry, app_group, policymode, policyid, policytype, flags AS d_flags, catdesc, domain, devtype, avatar, epeuid, browsetime, accessproxy, (CASE threatlvl WHEN 4 THEN 'critical' WHEN 3 THEN 'high' WHEN 2 THEN 'medium' WHEN 1 THEN 'low' ELSE NULL END)::fgt_enum_crlevel AS crlevel, threatweight, threat_block, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, bandwidth, traffic_in, traffic_out, session_block, sessions, session_block AS incident_block, sessions AS incidents FROM (SELECT dvid, srcintfrole, dstintfrole, $fv_timescale AS timescale, epid, coalesce(nullifna(`user`), nullifna(`unauthuser`)) AS f_user, `group` AS f_group, srcip, srcintf, srcuuid, srcmac, srcinetsvc, coalesce(srcname, srcmac) AS dev_src, dstip, dstintf, dstuuid, dstowner, dstmac, get_devtype(srcswversion, osname, devtype) AS devtype, dstcountry, app_group_name(app) AS app_group, rulename, vwlid, ((CASE WHEN (logflag&64>0) THEN 2 ELSE 0 END) | (CASE WHEN appcat='unscanned' THEN 1 ELSE 0 END)) AS flags, (CASE WHEN (logflag&64>0) THEN hostname ELSE root_domain(hostname) END) AS domain, catdesc, policymode, policyid, policytype, poluuid, policyname, accessproxy, saasname, fctuid, (CASE WHEN fctuid IS NOT NULL AND unauthuser IS NOT NULL THEN fctuid || ',' || unauthuser ELSE NULL END) AS avatar, (CASE WHEN epid>1023 AND euid IS NOT NULL THEN epid || ',' || euid ELSE NULL END) AS epeuid, $browse_time AS browsetime, dtime AS logtime, threatlvl, threatwgt AS threatweight, (CASE WHEN (logflag&2>0) THEN threatwgt ELSE 0 END) AS threat_block, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, (coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) AS bandwidth, (coalesce(rcvddelta, rcvdbyte, 0)) AS traffic_in, (coalesce(sentdelta, sentbyte, 0)) AS traffic_out, (CASE WHEN (logflag&2>0) THEN 1 ELSE 0 END) AS session_block, (CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) AS sessions FROM ( SELECT dvid, srcintfrole, dstintfrole, itime, dtime, (case when epid<1024 then NULL else epid end) as epid, euid, `user`, `group`, srcip, srcintf, srcmac, srcname, dstip, dstintf, dstowner, dstmac, dstcountry, app, appcat, srcswversion, osname, devtype, hostname, catdesc, srcuuid, dstuuid, srcinetsvc, accessproxy, saasname, policymode, policyid, policytype, poluuid, policyname, unauthuser, fctuid, ebtime, logflag, sentdelta, sentbyte, rcvddelta, rcvdbyte, coalesce(vwlname,vwlservice) as rulename, vwlid, threatlevel_max(threatlvls) AS threatlvl, threatweight_sum(threatwgts, threatcnts) AS threatwgt, threatweight_level_sum(4,threatlvls,threatcnts,threatwgts) AS thwgt_cri, threatweight_level_sum(3,threatlvls,threatcnts,threatwgts) AS thwgt_hig, threatweight_level_sum(2,threatlvls,threatcnts,threatwgts) AS thwgt_med, threatweight_level_sum(1,threatlvls,threatcnts,threatwgts) AS thwgt_low FROM $log-traffic WHERE $filter AND (logflag&(1|32)>0) ) t ) base_query NOHCACHE-END*//*HCACHE-AGG SELECT dvid, srcintfrole, dstintfrole, agg_timescale AS timescale, epid, f_user, srcip, srcintf, srcuuid, srcmac, dev_src, dstip, dstintf, dstuuid, dstowner, dstmac, dstcountry, app_group, policymode, policyid, policytype, d_flags, catdesc, domain, devtype, avatar, epeuid, browsetime, accessproxy, crlevel, threatweight, threat_block, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, bandwidth, traffic_in, traffic_out, session_block, sessions, incident_block, incidents FROM ( SELECT *, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY sessions DESC, bandwidth DESC) AS session_rank, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY bandwidth DESC, sessions DESC) AS bandwidth_rank FROM ( SELECT dvid, srcintfrole, dstintfrole, $fv_agg_timescale(timescale) AS agg_timescale, epid, f_user, srcip, srcintf, srcuuid, accessproxy, max(srcmac) AS srcmac, max(dev_src) AS dev_src, dstip, dstintf, dstuuid, dstowner, max(dstmac) AS dstmac, app_group, policymode, policyid, policytype, d_flags, catdesc, domain, max(devtype) AS devtype, max(dstcountry) AS dstcountry, max(avatar) AS avatar, max(epeuid) AS epeuid, ebtr_agg_flat(browsetime) AS browsetime, max(crlevel) AS crlevel, sum(threatweight) AS threatweight, sum(threat_block) AS threat_block, sum(thwgt_cri) AS thwgt_cri, sum(thwgt_hig) AS thwgt_hig, sum(thwgt_med) AS thwgt_med, sum(thwgt_low) AS thwgt_low, sum(bandwidth) AS bandwidth, sum(traffic_in) AS traffic_in, sum(traffic_out) AS traffic_out, sum(session_block) AS session_block, sum(sessions) AS sessions, sum(incident_block) AS incident_block, sum(incidents) AS incidents FROM ###LOG### GROUP BY dvid, srcintfrole, dstintfrole, agg_timescale, epid, f_user, srcip, srcintf, dstip, dstintf, dstowner, app_group, policymode, policyid, policytype, d_flags, catdesc, domain, srcuuid, dstuuid, accessproxy ) agg_query ) rank_query ORDER BY (CASE WHEN session_rank<$fv_rank_limit OR bandwidth_rank<$fv_rank_limit THEN least(session_rank, bandwidth_rank) ELSE session_rank*bandwidth_rank END) AGG-END*/)### t) union all (select sum(bandwidth) as bandwidth from ###(/*tag:fv_a_src_dst*/SELECT dvid, srcintfrole, dstintfrole, agg_timescale AS timescale, epid, f_user, srcip, srcintf, cast(NULL AS uuid) AS srcuuid, cast(NULL AS char) AS srcmac, cast(NULL AS char) AS dev_src, dstip, dstintf, cast(NULL AS uuid) AS dstuuid, cast(NULL AS fgt_enum_dstowner) AS dstowner, cast(NULL AS char) AS dstmac, cast(NULL AS char) AS dstcountry, cast(NULL AS char) AS app_group, cast(NULL AS char) AS policymode, 0 AS policyid, cast(NULL AS fgt_enum_traffic_policytype) AS policytype, 0 AS d_flags, cast(NULL AS char) AS catdesc, cast(NULL AS char) AS domain, cast(NULL AS char) AS devtype, avatar, epeuid, cast(NULL AS int4range[]) AS browsetime, cast(NULL AS char) AS accessproxy, crlevel, threatweight, threat_block, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, 0 AS bandwidth, 0 AS traffic_in, 0 AS traffic_out, 0 AS session_block, 0 AS sessions, incident_block, incidents FROM ( SELECT * /*SkipSTART*/, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY incidents DESC) AS incident_rank /*SkipEND*/ FROM ( SELECT dvid, srcintfrole, dstintfrole, $fv_agg_timescale(timescale) AS agg_timescale, epid, f_user, srcip, srcintf, dstip, dstintf, max(avatar) AS avatar, max(epeuid) AS epeuid, max(crlevel) AS crlevel, sum(threatweight) AS threatweight, sum(threat_block) AS threat_block, sum(thwgt_cri) AS thwgt_cri, sum(thwgt_hig) AS thwgt_hig, sum(thwgt_med) AS thwgt_med, sum(thwgt_low) AS thwgt_low, sum(incidents) AS incident_block, sum(incidents) AS incidents FROM ###base(/*tag:fv_base_a_src_dst*/SELECT dvid, srcintfrole, dstintfrole, $fv_timescale AS timescale, coalesce(nullifna(`user`), nullifna(`unauthuser`)) AS f_user, epid, srcip, srcintf, dstip, dstintf, policyid, policytype, max((CASE WHEN fctuid IS NOT NULL AND unauthuser IS NOT NULL THEN fctuid || ',' || unauthuser ELSE NULL END)) AS avatar, max((CASE WHEN epid>1023 AND euid IS NOT NULL THEN epid || ',' || euid ELSE NULL END)) AS epeuid, max(crlevel) AS crlevel, sum(crscore) AS threatweight, sum(crscore) AS threat_block, sum(CASE WHEN crlevel='critical' THEN crscore ELSE 0 END) AS thwgt_cri, sum(CASE WHEN crlevel='high'     THEN crscore ELSE 0 END) AS thwgt_hig, sum(CASE WHEN crlevel='medium'   THEN crscore ELSE 0 END) AS thwgt_med, sum(CASE WHEN crlevel='low'      THEN crscore ELSE 0 END) AS thwgt_low, count(*) AS incidents FROM ( SELECT dvid, srcintfrole, dstintfrole, itime, dtime, (case when epid<1024 then NULL else epid end) as epid, euid, `user`, srcip, srcintf, dstip, dstintf, policyid, policytype, unauthuser, fctuid, crlevel, coalesce(crscore, 0)&65535 AS crscore FROM $log-attack WHERE $filter AND msg LIKE 'anomaly%' ) t1 GROUP BY dvid, srcintfrole, dstintfrole, timescale, epid, f_user, srcip, srcintf, dstip, dstintf, policyid, policytype )base### base_query GROUP BY dvid, srcintfrole, dstintfrole, agg_timescale, epid, f_user, srcip, srcintf, dstip, dstintf ) agg_query ) rank_query /*SkipSTART*/ ORDER BY incident_rank /*SkipEND*/ /*HCACHE-AGG SELECT dvid, srcintfrole, dstintfrole, agg_timescale AS timescale, epid, f_user, srcip, srcintf, cast(NULL AS uuid) AS srcuuid, cast(NULL AS char) AS srcmac, cast(NULL AS char) AS dev_src, dstip, dstintf, cast(NULL AS uuid) AS dstuuid, cast(NULL AS fgt_enum_dstowner) AS dstowner, cast(NULL AS char) AS dstmac, cast(NULL AS char) AS dstcountry, cast(NULL AS char) AS app_group, cast(NULL AS char) AS policymode, 0 AS policyid, cast(NULL AS fgt_enum_traffic_policytype) AS policytype, 0 AS d_flags, cast(NULL AS char) AS catdesc, cast(NULL AS char) AS domain, cast(NULL AS char) AS devtype, avatar, epeuid, cast(NULL AS int4range[]) AS browsetime, cast(NULL AS char) AS accessproxy, crlevel, threatweight, threat_block, thwgt_cri, thwgt_hig, thwgt_med, thwgt_low, 0 AS bandwidth, 0 AS traffic_in, 0 AS traffic_out, 0 AS session_block, 0 AS sessions, incident_block, incidents FROM ( SELECT *, row_number() OVER (PARTITION BY dvid, srcintfrole, agg_timescale ORDER BY incidents DESC) AS incident_rank FROM ( SELECT dvid, srcintfrole, dstintfrole, $fv_agg_timescale(timescale) AS agg_timescale, epid, f_user, srcip, srcintf, dstip, dstintf, max(avatar) AS avatar, max(epeuid) AS epeuid, max(crlevel) AS crlevel, sum(threatweight) AS threatweight, sum(threat_block) AS threat_block, sum(thwgt_cri) AS thwgt_cri, sum(thwgt_hig) AS thwgt_hig, sum(thwgt_med) AS thwgt_med, sum(thwgt_low) AS thwgt_low, sum(incident_block) AS incident_block, sum(incidents) AS incidents FROM ###LOG### GROUP BY dvid, srcintfrole, dstintfrole, agg_timescale, epid, f_user, srcip, srcintf, dstip, dstintf ) agg_query ) rank_query ORDER BY incident_rank AGG-END*/ )### t)) t"
        set protected enable
    next
    edit "ueba-Asset-Count-by-Detecttype"
        set description "Asset Count by Detection Type"
        set query "select (case detecttype when 'by_ip' then 'IP' when 'by_mac' then 'MAC' end) as detecttype, count(distinct epid) as count from $ADOM_ENDPOINT t1 where epid>1024 and $filter-drilldown and lastseen>=$start_time and firstseen<$end_time and detecttype in ('by_ip', 'by_mac') group by detecttype order by count desc"
        set protected enable
    next
    edit "ueba-Asset-Identification"
        set description "Asset Count by Identification"
        set query "with qualified_ep as (select t2.epid, t2.euid from $ADOM_ENDPOINT t1 inner join $ADOM_EPEU_DEVMAP t2 on t1.epid=t2.epid where $filter-drilldown and lastseen>=$start_time and firstseen<$end_time and t2.epid>1024), identified_ep as (select distinct epid from qualified_ep t1 inner join $ADOM_ENDUSER t2 on t1.euid=t2.euid where t1.euid is not null and t1.euid>1024 and euname !='(none)' and euname is not null) (select 'Identified' as type, count(distinct epid) as count from identified_ep) union all (select 'Unidentified' as type, count(distinct epid) as count from qualified_ep where epid not in (select * from identified_ep))"
        set protected enable
    next
    edit "ueba-Asset-Count-by-HWOS"
        set description "Asset Count by Hardware OS"
        set query "select osname, count(distinct t2.epid) as count from $ADOM_ENDPOINT t1 inner join $ADOM_EPEU_DEVMAP t2 on t1.epid=t2.epid where $filter-drilldown and lastseen>=$start_time and firstseen<$end_time and osname is not null and t2.epid>1024 group by osname order by count desc"
        set protected enable
    next
    edit "ueba-Asset-Count-by-Device-and-Detecttype"
        set description "Asset Count by Source and Detection Type"
        set query "select devname, (case detecttype when 'by_ip' then 'IP' when 'by_mac' then 'MAC' end) as detecttype, count(distinct t1.epid) as count from $ADOM_ENDPOINT t1 inner join $ADOM_EPEU_DEVMAP t2 on t1.epid=t2.epid inner join devtable_ext t3 on t2.devid=t3.devid where t1.epid>1024 and $filter-drilldown and t1.lastseen>=$start_time and firstseen<$end_time and devname is not null and detecttype in ('by_ip', 'by_mac') group by devname, detecttype order by count desc"
        set protected enable
    next
    edit "ueba-User-Count"
        set description "User Total Count"
        set query "select count(DISTINCT t1.euid) as count from $ADOM_ENDUSER t1 inner join $ADOM_EPEU_DEVMAP t2 ON t1.euid=t2.euid where $filter-drilldown and lastseen>=$start_time and firstseen<$end_time and euname != '(none)' and epid>1024 and t1.euid>1024"
        set protected enable
    next
    edit "ueba-User-Count-by-Usergroup"
        set description "User Count by User Group"
        set query "select coalesce(eugroup, 'Unknown') as eugroup, count(distinct t1.euid) as count from $ADOM_ENDUSER t1 inner join $ADOM_EPEU_DEVMAP t2 ON t1.euid=t2.euid where $filter-drilldown and t1.euid>1024 and t1.lastseen>=$start_time and firstseen<$end_time group by eugroup order by count desc"
        set protected enable
    next
    edit "ueba-Asset-User-Count-by-Device"
        set description "Asset and User Count by Device"
        set query "select devname, cnt_for, sum(count) as count from ((select devname, 'Endpoint' as cnt_for, count(distinct t2.epid) as count from $ADOM_ENDPOINT t1 inner join $ADOM_EPEU_DEVMAP t2 on t1.epid=t2.epid inner join devtable_ext t3 on t2.devid=t3.devid where $filter-drilldown and t1.lastseen>=$start_time and t1.firstseen<$end_time and t2.epid>1024 group by devname order by count desc) union all (select devname, 'User' as cnt_for, count(distinct t1.euid) as count from $ADOM_ENDUSER t1 inner join $ADOM_EPEU_DEVMAP t2 ON t1.euid=t2.euid inner join devtable_ext t3 on t2.devid=t3.devid where $filter-drilldown and t1.lastseen>=$start_time and t1.firstseen<$end_time and euname != '(none)' and epid>1024 and t1.euid>1024  group by devname order by count desc)) t group by devname, cnt_for order by count desc"
        set protected enable
    next
    edit "ueba-Asset-User-Count-by-Device-Interface-and-Detectiontype"
        set description "Asset and User Count by Source Device Interface and Detection Method"
        set query "select devname, srcintf, sum(mac_cnt) as mac_cnt, sum(ip_cnt) as ip_cnt, sum(ep_count) as ep_count, sum(eu_count) as eu_count from ((select devname, srcintf, sum(case when detecttype='by_mac' then count else 0 end) as mac_cnt, sum(case when detecttype='by_ip' then count else 0 end) as ip_cnt, sum(count) as ep_count, 0 as eu_count from (select devname, srcintf, detecttype, count(distinct t1.epid) as count from $ADOM_ENDPOINT t1 inner join $ADOM_EPEU_DEVMAP t2 on t1.epid=t2.epid inner join devtable_ext t3 on t2.devid=t3.devid where t1.epid>1024 and $filter-drilldown and t1.lastseen>=$start_time and firstseen<$end_time and devname is not null and srcintf is not null and detecttype in ('by_ip', 'by_mac') group by devname,srcintf, detecttype order by count desc) t1 group by devname,srcintf order by ep_count desc) union all (SELECT devname, srcintf, 0 as mac_cnt, 0 as ip_cnt, 0 as ep_count, count(DISTINCT euid) as eu_count from (select euid, euname, t3.epid, eugroup, srcintf, devname, devid from (select t1.euid, euname, epid, eugroup, srcintf, devname, t2.devid from  $ADOM_ENDUSER t1 inner join $ADOM_EPEU_DEVMAP t2 ON t1.euid=t2.euid inner join devtable_ext t3 on t2.devid=t3.devid where t1.lastseen>=$start_time and t1.firstseen<$end_time and srcintf is not null ) t3 LEFT JOIN $ADOM_ENDPOINT t4 ON t3.epid = t4.epid) t5 where euname != '(none)' and epid>1024 and euid>1024 and $filter-drilldown group by devname, srcintf order by eu_count desc)) t group by devname, srcintf order by devname, sum(eu_count)+ sum(ep_count) desc"
        set protected enable
    next
    edit "ueba-Asset-User-Discovery-by-Time"
        set description "Asset and User Count by Discovery Time"
        set query "select $flex_timescale(firstseen) as time, count(distinct epid) as ep_count, count(distinct euid) as eu_count from ((select firstseen, t1.epid, null as euid from $ADOM_ENDPOINT t1 inner join $ADOM_EPEU_DEVMAP t2 on t1.epid=t2.epid where $filter-drilldown and t1.firstseen>=$start_time and t1.firstseen<$end_time and t1.epid>1024) union all (select firstseen, null as epid, t1.euid from $ADOM_ENDUSER t1 inner join $ADOM_EPEU_DEVMAP t2 ON t1.euid=t2.euid where t1.euid>1024 and $filter-drilldown and firstseen>=$start_time and firstseen<$end_time)) t group by time order by time"
        set protected enable
    next
    edit "dns-Security-Top-DNS-High-Risk-Source-IP"
        set description "Top DNS High Risk Source IP"
        set log-type dns
        set query "select srcip, sum(case when sevid=5 then total_num else 0 end) as num_cri, sum(case when sevid=4 then total_num else 0 end) as num_hig, sum(case when sevid=3 then total_num else 0 end) as num_med, sum(total_num) as total_num from (select srcip, (CASE WHEN level IN ('critical', 'alert', 'emergency') THEN 5 WHEN level='error' THEN 4 WHEN level='warning' THEN 3 WHEN level='notice' THEN 2 ELSE 1 END) as sevid, count(*) as total_num from ###(select dvid, qname, coalesce(nullifna(`user`), nullifna(`unauthuser`)) as f_user, dstip, srcip, catdesc, level, tdtype,  (botnetdomain is not null or botnetip is not null) as is_botnet, min(nanosec_to_sec(eventtime)) as first_seen, max(nanosec_to_sec(eventtime)) as last_seen, count(*) as total_num from $log-dns where $filter group by dvid, qname, f_user, dstip, srcip, catdesc, level, tdtype, is_botnet order by total_num desc)### t where level>='warning' and srcip is not null group by srcip, sevid order by total_num desc) t group by srcip having sum(total_num)>0 order by total_num desc"
        set protected enable
    next
    edit "dns-Security-Top-Malicious-IP"
        set description "Top Malicious IP"
        set log-type dns
        set query "select srcip, sum(total_num) as total_num from ###(select dvid, qname, coalesce(nullifna(`user`), nullifna(`unauthuser`)) as f_user, dstip, srcip, catdesc, level, tdtype,  (botnetdomain is not null or botnetip is not null) as is_botnet, min(nanosec_to_sec(eventtime)) as first_seen, max(nanosec_to_sec(eventtime)) as last_seen, count(*) as total_num from $log-dns where $filter group by dvid, qname, f_user, dstip, srcip, catdesc, level, tdtype, is_botnet order by total_num desc)### t where srcip is not null and tdtype='infected-domain' group by srcip order by total_num desc"
        set protected enable
    next
    edit "dns-Security-Count-of-Domains-Blocked"
        set description "Count of Domains Blocked"
        set log-type dns
        set query "select count(*) as total_num from $log-dns where $filter and qname is not null and action='block'"
        set protected enable
    next
    edit "dns-Security-Domain-Count-by-Threat-Level"
        set description "Domain Count by Threat level"
        set log-type dns
        set query "select threat_level, total_num from (select (case when tdtype in ('infected-domain', 'infected-ip', 'infected-url') then 'critical' when is_botnet or catdesc in ('Malicious Websites', 'Phishing', 'Spam URLs') then 'high' when catdesc in ('Newly Observed Domain', 'Newly Registered Domain', 'Proxy Avoidance','Unrated') or catdesc LIKE '%Dynamic DNS%' then 'medium' end) as threat_level, sum(total_num) as total_num from  ###(select dvid, qname, coalesce(nullifna(`user`), nullifna(`unauthuser`)) as f_user, dstip, srcip, catdesc, level, tdtype,  (botnetdomain is not null or botnetip is not null) as is_botnet, min(nanosec_to_sec(eventtime)) as first_seen, max(nanosec_to_sec(eventtime)) as last_seen, count(*) as total_num from $log-dns where $filter group by dvid, qname, f_user, dstip, srcip, catdesc, level, tdtype, is_botnet order by total_num desc)### t group by threat_level order by total_num desc) t where threat_level is not null order by total_num desc"
        set protected enable
    next
    edit "dns-Security-Top-Visited-Domain-Categories"
        set description "Top Visited Domain Categories"
        set log-type dns
        set query "select catdesc, sum(total_num) as total_num from ###(select dvid, qname, coalesce(nullifna(`user`), nullifna(`unauthuser`)) as f_user, dstip, srcip, catdesc, level, tdtype,  (botnetdomain is not null or botnetip is not null) as is_botnet, min(nanosec_to_sec(eventtime)) as first_seen, max(nanosec_to_sec(eventtime)) as last_seen, count(*) as total_num from $log-dns where $filter group by dvid, qname, f_user, dstip, srcip, catdesc, level, tdtype, is_botnet order by total_num desc)### t where catdesc is not null group by catdesc order by total_num desc"
        set protected enable
    next
    edit "dns-Security-Top-Visited-High-Risk-Domain-Categories"
        set description "Top Visited High Risk Domain Categories"
        set log-type dns
        set query "select catdesc, sum(total_num) as total_num from ###(select dvid, qname, coalesce(nullifna(`user`), nullifna(`unauthuser`)) as f_user, dstip, srcip, catdesc, level, tdtype,  (botnetdomain is not null or botnetip is not null) as is_botnet, min(nanosec_to_sec(eventtime)) as first_seen, max(nanosec_to_sec(eventtime)) as last_seen, count(*) as total_num from $log-dns where $filter group by dvid, qname, f_user, dstip, srcip, catdesc, level, tdtype, is_botnet order by total_num desc)### t where level>='warning' and catdesc is not null group by catdesc order by total_num desc"
        set protected enable
    next
    edit "dns-Security-Top-Domain-with-Botnet-CC-Detected"
        set description "Top Domain with Botnet C&C Detected"
        set log-type dns
        set query "select qname, sum(total_num) as total_num from ###(select coalesce(botnetdomain, ipstr(botnetip)) as domain, qname, cast('Botnet C&C' as char(32)) as malware_type, (case when action='block' then 'Blocked' when action='redirect' then 'Redirected' else 'Passed' end) as action, srcip, (CASE WHEN level IN ('critical', 'alert', 'emergency') THEN 5 WHEN level='error' THEN 4 WHEN level='warning' THEN 3 WHEN level='notice' THEN 2 ELSE 1 END) as sevid, coalesce(botnetdomain, ipstr(botnetip)) as sources_s, count(*) as total_num from $log where $filter and (botnetdomain is not null or botnetip is not null) group by domain, qname, action, srcip, sevid order by sevid desc)### t where qname is not null group by qname order by total_num desc"
        set protected enable
    next
    edit "dns-Security-FortiGate-with-Top-Domain-Visited-by_Source-IP"
        set description "FortiGate with Top Domain Visited by Source IP"
        set log-type dns
        set query "select devname, srcip, qname, category, total_num from (select devname, srcip, qname, category, total_num, row_number() over (partition by devname, srcip, qname order by total_num desc, qname ) as rank from (select devname, srcip, qname, max(catdesc) as category, sum(total_num) as total_num from ###(select dvid, qname, coalesce(nullifna(`user`), nullifna(`unauthuser`)) as f_user, dstip, srcip, catdesc, level, tdtype,  (botnetdomain is not null or botnetip is not null) as is_botnet, min(nanosec_to_sec(eventtime)) as first_seen, max(nanosec_to_sec(eventtime)) as last_seen, count(*) as total_num from $log-dns where $filter group by dvid, qname, f_user, dstip, srcip, catdesc, level, tdtype, is_botnet order by total_num desc)### t1 inner join devtable_ext t2 on t1.dvid=t2.dvid where qname is not null and srcip is not null group by devname, srcip, qname order by total_num desc) t) t where rank=1 order by devname, srcip, qname"
        set protected enable
    next
    edit "dns-Security-Top-Domain-Lookup-Failure-by-Count"
        set description "Top Domain Lookup Failures by Count"
        set log-type dns
        set query "select qname, count(*) as total_num from $log-dns where $filter and qname is not null and (action='block' or logid_to_int(logid)=54200) group by qname order by total_num desc"
        set protected enable
    next
    edit "dns-Security-Top-Source-IP-by-Destination-Count"
        set description "Top Source IP by Destination Count"
        set log-type dns
        set query "select srcip, count(distinct dstip) as total_num from ###(select dvid, qname, coalesce(nullifna(`user`), nullifna(`unauthuser`)) as f_user, dstip, srcip, catdesc, level, tdtype,  (botnetdomain is not null or botnetip is not null) as is_botnet, min(nanosec_to_sec(eventtime)) as first_seen, max(nanosec_to_sec(eventtime)) as last_seen, count(*) as total_num from $log-dns where $filter group by dvid, qname, f_user, dstip, srcip, catdesc, level, tdtype, is_botnet order by total_num desc)### t where srcip is not null and dstip is not null group by srcip order by total_num desc"
        set protected enable
    next
    edit "dns-Security-Top-Destination-IP-by-Source-Count"
        set description "Top Destination IP by Source Count"
        set log-type dns
        set query "select dstip, count(distinct srcip) as total_num from ###(select dvid, qname, coalesce(nullifna(`user`), nullifna(`unauthuser`)) as f_user, dstip, srcip, catdesc, level, tdtype,  (botnetdomain is not null or botnetip is not null) as is_botnet, min(nanosec_to_sec(eventtime)) as first_seen, max(nanosec_to_sec(eventtime)) as last_seen, count(*) as total_num from $log-dns where $filter group by dvid, qname, f_user, dstip, srcip, catdesc, level, tdtype, is_botnet order by total_num desc)### t where srcip is not null and dstip is not null  group by dstip order by total_num desc"
        set protected enable
    next
    edit "dns-Security-Severity-by-High-Risk-Source-IPs-Count"
        set description "Severity by High Risk Source IPs Count"
        set log-type dns
        set query "select (CASE sevid WHEN 5 THEN 'Critical' WHEN 4 THEN 'High' WHEN 3 THEN 'Medium' WHEN '2' THEN 'Info' ELSE 'Low' END) as severity, count(distinct srcip) as total_num from (select srcip, (CASE WHEN level IN ('critical', 'alert', 'emergency') THEN 5 WHEN level='error' THEN 4 WHEN level='warning' THEN 3 WHEN level='notice' THEN 2 ELSE 1 END) as sevid, count(*) as total_num from ###(select dvid, qname, coalesce(nullifna(`user`), nullifna(`unauthuser`)) as f_user, dstip, srcip, catdesc, level, tdtype,  (botnetdomain is not null or botnetip is not null) as is_botnet, min(nanosec_to_sec(eventtime)) as first_seen, max(nanosec_to_sec(eventtime)) as last_seen, count(*) as total_num from $log-dns where $filter group by dvid, qname, f_user, dstip, srcip, catdesc, level, tdtype, is_botnet order by total_num desc)### t where level>='warning' and srcip is not null group by srcip, sevid order by total_num desc) t group by severity having sum(total_num)>0 order by total_num desc"
        set protected enable
    next
    edit "dns-Security-Top-Infected-Domain-by-Count"
        set description "Top Infected Domain by Count"
        set log-type dns
        set query "select qname, count(distinct srcip) as total_num from ###(select dvid, qname, coalesce(nullifna(`user`), nullifna(`unauthuser`)) as f_user, dstip, srcip, catdesc, level, tdtype,  (botnetdomain is not null or botnetip is not null) as is_botnet, min(nanosec_to_sec(eventtime)) as first_seen, max(nanosec_to_sec(eventtime)) as last_seen, count(*) as total_num from $log-dns where $filter group by dvid, qname, f_user, dstip, srcip, catdesc, level, tdtype, is_botnet order by total_num desc)### t where qname is not null and tdtype='infected-domain' group by qname order by total_num desc"
        set protected enable
    next
    edit "dns-Security-Top-Blocked-Domains-by-Reason"
        set description "Top Blocked Domains by Reason"
        set log-type dns
        set query "select qname, msg, count(*) as total_num from $log where $filter and qname is not null and msg LIKE 'Domain was blocked%' group by qname, msg order by total_num desc"
        set protected enable
    next

    edit "dns-Security-Top-Users-by-Infected-Domain-Visits"
        set description "Top Users by Infected Domain Visits"
        set log-type dns
        set query "select coalesce(f_user, ipstr(`srcip`)) as user_src, count(distinct qname) as total_num from ###(select dvid, qname, coalesce(nullifna(`user`), nullifna(`unauthuser`)) as f_user, dstip, srcip, catdesc, level, tdtype,  (botnetdomain is not null or botnetip is not null) as is_botnet, min(nanosec_to_sec(eventtime)) as first_seen, max(nanosec_to_sec(eventtime)) as last_seen, count(*) as total_num from $log-dns where $filter group by dvid, qname, f_user, dstip, srcip, catdesc, level, tdtype, is_botnet order by total_num desc)### t where qname is not null and tdtype='infected-domain' and (f_user is not null or srcip is not null) group by user_src order by total_num desc"
        set protected enable
    next
    edit "dns-Security-Top-Users-and-Infected-Domain-by-Visit-Count"
        set description "Top Users and Infected Domain by Visit Count"
        set log-type dns
        set query "select coalesce(f_user, ipstr(`srcip`)) as user_src, qname, sum(total_num) as total_num from ###(select dvid, qname, coalesce(nullifna(`user`), nullifna(`unauthuser`)) as f_user, dstip, srcip, catdesc, level, tdtype,  (botnetdomain is not null or botnetip is not null) as is_botnet, min(nanosec_to_sec(eventtime)) as first_seen, max(nanosec_to_sec(eventtime)) as last_seen, count(*) as total_num from $log-dns where $filter group by dvid, qname, f_user, dstip, srcip, catdesc, level, tdtype, is_botnet order by total_num desc)### t where qname is not null and (f_user is not null or srcip is not null) and tdtype='infected-domain' group by user_src, qname order by total_num desc"
        set protected enable
    next

    edit "dns-Security-Top-Users-by-Visited-Domain-Category-Count"
        set description "Top Users by Visited Domain Category Count"
        set log-type dns
        set query "select coalesce(f_user, ipstr(`srcip`)) as user_src, count(distinct catdesc) as total_num from ###(select dvid, qname, coalesce(nullifna(`user`), nullifna(`unauthuser`)) as f_user, dstip, srcip, catdesc, level, tdtype,  (botnetdomain is not null or botnetip is not null) as is_botnet, min(nanosec_to_sec(eventtime)) as first_seen, max(nanosec_to_sec(eventtime)) as last_seen, count(*) as total_num from $log-dns where $filter group by dvid, qname, f_user, dstip, srcip, catdesc, level, tdtype, is_botnet order by total_num desc)### t where catdesc is not null and (f_user is not null or srcip is not null) group by user_src order by total_num desc"
    next
    edit "dns-Security-Top-Users-and-Visited-Domain-Category-by-Count"
        set description "Top Users and Visited Domain Category by Count"
        set log-type dns
        set query "select coalesce(f_user, ipstr(`srcip`)) as user_src, catdesc, srcip, sum(total_num) as total_num from ###(select dvid, qname, coalesce(nullifna(`user`), nullifna(`unauthuser`)) as f_user, dstip, srcip, catdesc, level, tdtype,  (botnetdomain is not null or botnetip is not null) as is_botnet, min(nanosec_to_sec(eventtime)) as first_seen, max(nanosec_to_sec(eventtime)) as last_seen, count(*) as total_num from $log-dns where $filter group by dvid, qname, f_user, dstip, srcip, catdesc, level, tdtype, is_botnet order by total_num desc)### t where catdesc is not null and (f_user is not null or srcip is not null) group by user_src, catdesc, srcip order by total_num desc"
        set protected enable
    next

    edit "dns-Security-Top-Newly-Detected-Domain-by-Count"
        set description "Top Newly Detected Domain by Count"
        set log-type dns
        set query "select qname, sum(total_num) as total_num from ###(select dvid, qname, coalesce(nullifna(`user`), nullifna(`unauthuser`)) as f_user, dstip, srcip, catdesc, level, tdtype,  (botnetdomain is not null or botnetip is not null) as is_botnet, min(nanosec_to_sec(eventtime)) as first_seen, max(nanosec_to_sec(eventtime)) as last_seen, count(*) as total_num from $log-dns where $filter group by dvid, qname, f_user, dstip, srcip, catdesc, level, tdtype, is_botnet order by total_num desc)### t where last_seen>=$start_time and first_seen<$end_time and tdtype is not null and qname is not null group by qname order by total_num desc"
        set protected enable
    next
    edit "dns-Security-Top-Newly-Detected-Domain-and-Source-IP-with-First-Seen-and-Last-Seen"
        set description "Top Newly Detected Domain and Source IP with First Seen and Last Seen"
        set log-type dns
        set query "select qname, srcip, from_itime(min(first_seen)) as first_seen, from_itime(max(last_seen)) as last_seen, sum(total_num) as total_num from ###(select dvid, qname, coalesce(nullifna(`user`), nullifna(`unauthuser`)) as f_user, dstip, srcip, catdesc, level, tdtype,  (botnetdomain is not null or botnetip is not null) as is_botnet, min(nanosec_to_sec(eventtime)) as first_seen, max(nanosec_to_sec(eventtime)) as last_seen, count(*) as total_num from $log-dns where $filter group by dvid, qname, f_user, dstip, srcip, catdesc, level, tdtype, is_botnet order by total_num desc)### t where last_seen>=$start_time and first_seen<$end_time and tdtype is not null and qname is not null group by qname, srcip order by total_num desc"
        set protected enable
    next
    edit "360-security-Rating-Asset-Endpoint-Total-Count"
        set description "Asset Endpoint Total Count"
        set query "select sum(count) as total_num from (select osname, count(distinct t2.epid) as count from $ADOM_ENDPOINT t1 inner join $ADOM_EPEU_DEVMAP t2 on t1.epid=t2.epid where exists (select 1 from devtable_ext t3 where $dev_filter and t3.devid=t2.devid) and lastseen>=$start_time and firstseen<$end_time and osname is not null and t2.epid>1024 group by osname order by count desc) t"
        set protected enable
    next
    edit "360-security-Rating-Asset-Endpoint-HWOS-Count"
        set description "Asset Endpoint Count by OS"
        set query "select osname, count(distinct t2.epid) as count from $ADOM_ENDPOINT t1 inner join $ADOM_EPEU_DEVMAP t2 on t1.epid=t2.epid where exists (select 1 from devtable_ext t3 where $dev_filter and t3.devid=t2.devid) and lastseen>=$start_time and firstseen<$end_time and osname is not null and t2.epid>1024 group by osname order by count desc"
        set protected enable
    next
    edit "360-security-Rating-Posture-Stats-Status-Count"
        set description "Posture Security Rating Statistic Status Count"
        set query "select unnest(name) as stats, unnest(val) as value from (select array['Passed','Failed','Exempt','Unmet'] as name, array[(sum(passedchkcnt::int)/count(*)), sum((failedchkcnt-unmetchkcnt)::int)/count(*), sum((data->'statistics'->'numExemptChecks')::int)/count(*), sum(unmetchkcnt::int)/count(*)] as val from $ADOMTBL_PLHD_AUDIT_HST t inner join devtable_ext td on td.dvid = t.dvid where $filter-drilldown and $cust_time_filter(itime) and reporttype='PostureReport') t"
        set protected enable
    next
    edit "360-security-Rating-Posture-Stats-Average-Total-Score"
        set description "Posture Security Rating Statistic Average Total Score"
        set query "select cast(sum((data->'statistics'->'scoreTotal')::float)/count(*) as decimal(10,2)) as avg_score from $ADOMTBL_PLHD_AUDIT_HST t inner join devtable_ext td on td.dvid = t.dvid where $filter-drilldown and $cust_time_filter(itime) and reporttype='PostureReport'"
        set protected enable
    next
    edit "360-security-Rating-Posture-Stats-Average-Total-Grade"
        set description "Posture Security Rating Statistic Average Total Grade"
        set query "select sum((grade_info->>'percentage')::int * (grade_info->>'count')::int) / sum((grade_info->>'count')::int) as total_grade from (select (json_each((data->'gradeStatistics'->'categoryGrades')::json)).key::text as category, (json_each((data->'gradeStatistics'->'categoryGrades')::json)).value as grade_info from $ADOMTBL_PLHD_AUDIT_HST t inner join devtable_ext td on td.dvid = t.dvid where $filter-drilldown and itime>=$start_time and itime<$end_time and reporttype='PostureReport') t"
        set protected enable
    next
    edit "360-security-Rating-Posture-fabricHardening-Avg-Grade"
        set description "Posture Fabric Security Hardening Statistic Average Grade"
        set query "select (sum((data->'gradeStatistics'->'categoryGrades'->'fabricHardening'->'percentage')::int)/count(*)) as grade_value from $ADOMTBL_PLHD_AUDIT_HST t inner join devtable_ext td on td.dvid = t.dvid where $filter-drilldown and $cust_time_filter(itime) and reporttype='PostureReport'"
        set protected enable
    next
    edit "360-security-Rating-Posture-auditLoggingMonitoring-Avg-Grade"
        set description "Posture Audit Logging and Monitoring Statistic Average Grade"
        set query "select (sum((data->'gradeStatistics'->'categoryGrades'->'auditLoggingMonitoring'->'percentage')::int)/count(*)) as grade_value from $ADOMTBL_PLHD_AUDIT_HST t inner join devtable_ext td on td.dvid = t.dvid where $filter-drilldown and $cust_time_filter(itime) and reporttype='PostureReport'"
        set protected enable
    next
    edit "360-security-Rating-Posture-threatManagement-Avg-Grade"
        set description "Posture Threat and Vulnerability Management Statistic Average Grade"
        set query "select (sum((data->'gradeStatistics'->'categoryGrades'->'threatManagement'->'percentage')::int)/count(*)) as grade_value from $ADOMTBL_PLHD_AUDIT_HST t inner join devtable_ext td on td.dvid = t.dvid where $filter-drilldown and $cust_time_filter(itime) and reporttype='PostureReport'"
        set protected enable
    next
    edit "360-security-Rating-Posture-networkDesign-Avg-Grade"
        set description "Posture Network Design and Policies Statistic Average Grade"
        set query "select (sum((data->'gradeStatistics'->'categoryGrades'->'networkDesign'->'percentage')::int)/count(*)) as grade_value from $ADOMTBL_PLHD_AUDIT_HST t inner join devtable_ext td on td.dvid = t.dvid where $filter-drilldown and $cust_time_filter(itime) and reporttype='PostureReport'"
        set protected enable
    next
    edit "360-security-Rating-Posture-endpointManagement-Avg-Grade"
        set description "Posture Endpoint Management Statistic Average Grade"
        set query "select (sum((data->'gradeStatistics'->'categoryGrades'->'endpointManagement'->'percentage')::int)/count(*)) as grade_value from $ADOMTBL_PLHD_AUDIT_HST t inner join devtable_ext td on td.dvid = t.dvid where $filter-drilldown and $cust_time_filter(itime) and reporttype='PostureReport'"
        set protected enable
    next
    edit "360-security-Rating-Posture-firmwareSubscriptions-Avg-Grade"
        set description "Posture Firmware and Subscriptions Statistic Average Grade"
        set query "select (sum((data->'gradeStatistics'->'categoryGrades'->'firmwareSubscriptions'->'percentage')::int)/count(*)) as grade_value from $ADOMTBL_PLHD_AUDIT_HST t inner join devtable_ext td on td.dvid = t.dvid where $filter-drilldown and $cust_time_filter(itime) and reporttype='PostureReport'"
        set protected enable
    next
    edit "360-security-Rating-Coverage-Stats-Status-Count"
        set description "Fabric Coverage Security Rating Statistic Status Count"
        set query "select unnest(name) as stats, unnest(val) as value from (select array['Passed','Failed','Exempt'] as name, array[(sum(passedchkcnt::int)/count(*)), sum(failedchkcnt::int)/count(*), sum((data->'statistics'->'numExemptChecks')::int)/count(*)] as val from $ADOMTBL_PLHD_AUDIT_HST t inner join devtable_ext td on td.dvid = t.dvid where $filter-drilldown and $cust_time_filter(itime) and reporttype='CoverageReport') t"
        set protected enable
    next
    edit "360-security-Rating-Coverage-Stats-Average-Total-Score"
        set description "Coverage Security Rating Statistic Average Total Score"
        set query "select cast(sum((data->'statistics'->'scoreTotal')::float)/count(*) as decimal(10,2)) as avg_score from $ADOMTBL_PLHD_AUDIT_HST t inner join devtable_ext td on td.dvid = t.dvid where $filter-drilldown and $cust_time_filter(itime) and reporttype='CoverageReport'"
        set protected enable
    next
    edit "360-security-Rating-Coverage-Stats-Average-Total-Grade"
        set description "Coverage Security Rating Statistic Average Total Grade"
        set query "select sum((grade_info->>'percentage')::int * (grade_info->>'count')::int) / sum((grade_info->>'count')::int) as total_grade from (select (json_each((data->'gradeStatistics'->'categoryGrades')::json)).key::text as category, (json_each((data->'gradeStatistics'->'categoryGrades')::json)).value as grade_info from $ADOMTBL_PLHD_AUDIT_HST t inner join devtable_ext td on td.dvid = t.dvid where $filter-drilldown and itime>=$start_time and itime<$end_time and reporttype='CoverageReport') t"
        set protected enable
    next
    edit "360-security-Rating-Coverage-firmwareSubscriptions-Avg-Grade"
        set description "Coverage Firmware and Subscriptions Statistic Average Grade"
        set query "select (sum((data->'gradeStatistics'->'categoryGrades'->'firmwareSubscriptions'->'percentage')::int)/count(*)) as grade_value from $ADOMTBL_PLHD_AUDIT_HST t inner join devtable_ext td on td.dvid = t.dvid where $filter-drilldown and $cust_time_filter(itime) and reporttype='CoverageReport'"
        set protected enable
    next
    edit "360-security-Rating-Coverage-auditLoggingMonitoring-Avg-Grade"
        set description "Coverage Audit Logging and Monitoring Statistic Average Grade"
        set query "select (sum((data->'gradeStatistics'->'categoryGrades'->'auditLoggingMonitoring'->'percentage')::int)/count(*)) as grade_value from $ADOMTBL_PLHD_AUDIT_HST t inner join devtable_ext td on td.dvid = t.dvid where $filter-drilldown and $cust_time_filter(itime) and reporttype='CoverageReport'"
        set protected enable
    next
    edit "360-security-Rating-Coverage-threatManagement-Avg-Grade"
        set description "Coverage Threat and Vulnerability Management Statistic Average Grade"
        set query "select (sum((data->'gradeStatistics'->'categoryGrades'->'threatManagement'->'percentage')::int)/count(*)) as grade_value from $ADOMTBL_PLHD_AUDIT_HST t inner join devtable_ext td on td.dvid = t.dvid where $filter-drilldown and $cust_time_filter(itime) and reporttype='CoverageReport'"
        set protected enable
    next
    edit "360-security-Rating-Coverage-networkDesign-Avg-Grade"
        set description "Coverage Network Design and Policies Statistic Average Grade"
        set query "select (sum((data->'gradeStatistics'->'categoryGrades'->'networkDesign'->'percentage')::int)/count(*)) as grade_value from $ADOMTBL_PLHD_AUDIT_HST t inner join devtable_ext td on td.dvid = t.dvid where $filter-drilldown and $cust_time_filter(itime) and reporttype='CoverageReport'"
        set protected enable
    next
    edit "360-security-Rating-Optimize-Stats-Status-Count"
        set description "Optimization Security Rating Statistic Status Count"
        set query "select unnest(name) as stats, unnest(val) as value from (select array['Passed','Failed','Exempt'] as name, array[(sum(passedchkcnt::int)/count(*)), sum(failedchkcnt::int)/count(*), sum((data->'statistics'->'numExemptChecks')::int)/count(*)] as val from $ADOMTBL_PLHD_AUDIT_HST t inner join devtable_ext td on td.dvid = t.dvid where $filter-drilldown and $cust_time_filter(itime) and reporttype='OptimizationReport') t"
        set protected enable
    next
    edit "360-security-Rating-Optimize-Stats-Average-Total-Score"
        set description "Optimization Security Rating Statistic Average Total Score"
        set query "select cast(sum((data->'statistics'->'scoreTotal')::float)/count(*) as decimal(10,2)) as avg_score from $ADOMTBL_PLHD_AUDIT_HST t inner join devtable_ext td on td.dvid = t.dvid where $filter-drilldown and $cust_time_filter(itime) and reporttype='OptimizationReport'"
        set protected enable
    next
    edit "360-security-Rating-Optimize-Stats-Average-Total-Grade"
        set description "Optimization Security Rating Statistic Average Total Grade"
        set query "select sum((grade_info->>'percentage')::int * (grade_info->>'count')::int) / sum((grade_info->>'count')::int) as total_grade from (select (json_each((data->'gradeStatistics'->'categoryGrades')::json)).key::text as category, (json_each((data->'gradeStatistics'->'categoryGrades')::json)).value as grade_info from $ADOMTBL_PLHD_AUDIT_HST t inner join devtable_ext td on td.dvid = t.dvid where $filter-drilldown and itime>=$start_time and itime<$end_time and reporttype='OptimizationReport') t"
        set protected enable
    next
    edit "360-security-Rating-Optimize-performanceOptimization-Avg-Grade"
        set description "Optimization Performance Optimization Statistic Average Grade"
        set query "select (sum((data->'gradeStatistics'->'categoryGrades'->'performanceOptimization'->'percentage')::int)/count(*)) as grade_value from $ADOMTBL_PLHD_AUDIT_HST t inner join devtable_ext td on td.dvid = t.dvid where $filter-drilldown and $cust_time_filter(itime) and reporttype='OptimizationReport'"
        set protected enable
    next
    edit "360-security-Rating-Optimize-networkDesign-Avg-Grade"
        set description "Optimization Network Design and Policies Statistic Average Grade"
        set query "select (sum((data->'gradeStatistics'->'categoryGrades'->'networkDesign'->'percentage')::int)/count(*)) as grade_value from $ADOMTBL_PLHD_AUDIT_HST t inner join devtable_ext td on td.dvid = t.dvid where $filter-drilldown and $cust_time_filter(itime) and reporttype='OptimizationReport'"
        set protected enable
    next
    edit "360-security-Rating-Optimize-firmwareSubscriptions-Avg-Grade"
        set description "Optimization Firmware and Subscriptions Statistic Average Grade"
        set query "select (sum((data->'gradeStatistics'->'categoryGrades'->'firmwareSubscriptions'->'percentage')::int)/count(*)) as grade_value from $ADOMTBL_PLHD_AUDIT_HST t inner join devtable_ext td on td.dvid = t.dvid where $filter-drilldown and $cust_time_filter(itime) and reporttype='OptimizationReport'"
        set protected enable
    next
    edit "360-security-Rating-Asset-Count-by-HWVendor"
        set description "Asset Count by Hardware Vendor"
        set query "select (case when hwvendor='Fortinet' then hwvendor else 'Other identified device' end) as vendor, sum(total_num) as total_num from (select osname, hwvendor, srcintf, count(distinct t1.epid) as total_num from $ADOM_ENDPOINT t1 inner join $ADOM_EPEU_DEVMAP t2 on t1.epid=t2.epid where exists (select 1 from devtable_ext t3 where $dev_filter and t3.devid=t2.devid) and lastseen>=$start_time and firstseen<$end_time and hwvendor is not null and osname is not null and t2.srcintf is not null and t2.epid>1024 group by osname, hwvendor, srcintf order by total_num desc) t group by vendor order by vendor"
        set protected enable
    next
    edit "360-security-Rating-Asset-Count-by-HWOS-List"
        set description "Asset Count by Hardware OS List"
        set query "select osname, sum(total_num) as total_num from (select osname, hwvendor, srcintf, count(distinct t1.epid) as total_num from $ADOM_ENDPOINT t1 inner join $ADOM_EPEU_DEVMAP t2 on t1.epid=t2.epid where  exists (select 1 from devtable_ext t3 where $dev_filter and t3.devid=t2.devid) and lastseen>=$start_time and firstseen<$end_time and hwvendor is not null and osname is not null and t2.srcintf is not null and t2.epid>1024 group by osname, hwvendor, srcintf order by total_num desc) t group by osname order by total_num desc"
        set protected enable
    next
    edit "360-security-Rating-Asset-Count-by-Interface"
        set description "Asset Count by Interface"
        set query "select srcintf, sum(total_num) as count from (select osname, hwvendor, srcintf, count(distinct t1.epid) as total_num from $ADOM_ENDPOINT t1 inner join $ADOM_EPEU_DEVMAP t2 on t1.epid=t2.epid where  exists (select 1 from devtable_ext t3 where $dev_filter and t3.devid=t2.devid) and lastseen>=$start_time and firstseen<$end_time and hwvendor is not null and osname is not null and t2.srcintf is not null and t2.epid>1024 group by osname, hwvendor, srcintf order by total_num desc) t group by srcintf order by count desc"
        set protected enable
    next
    edit "360-security-Rating-Asset-List-From-Fortinet"
        set description "Asset List from Fortinet"
        set log-type traffic
        set query "select coalesce(epname, ipstr(`srcip`)) as ep_name, coalesce(epip::text || ' ' || mac::text, ipstr(`srcip`)) as addr, osname, hwfamily, hwversion, coalesce(osname, max(epdevtype)) as devtype, sum(sessions) as sessions from (select dvid, epid, srcip, sum(sessions) as sessions from ###(select dvid, $flex_timestamp as timestamp, epid, srcip, policyname, policyid, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum((CASE WHEN (logflag&2>0) THEN 1 ELSE 0 END)) AS session_block, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) AS sessions from $log-traffic where $filter and (logflag&(1|32)>0) group by dvid, timestamp, epid, srcip, policyname, policyid order by bandwidth desc)### t where epid>1024 group by dvid, epid, srcip) t1 inner join (select epid, srcmac as epmac, dvid from $ADOM_EPEU_DEVMAP dm inner join devtable dt ON dm.devid=dt.devid and dm.vd=dt.vd) t2 on t1.epid=t2.epid and t1.dvid=t2.dvid left join $ADOM_ENDPOINT t3 on t1.epid=t3.epid and t2.epmac=t3.mac where hwvendor='Fortinet' group by ep_name, addr, osname, hwfamily, hwversion order by sessions desc"
        set protected enable
    next
    edit "360-security-Rating-Asset-List-From-Other-Identified-Device"
        set description "Asset List from Other Identified Device"
        set log-type traffic
        set query "select coalesce(epname, ipstr(`srcip`)) as ep_name, coalesce(epip::text || ' ' || mac::text, ipstr(`srcip`)) as addr, osname, hwfamily, hwversion, coalesce(osname, max(epdevtype)) as devtype, sum(sessions) as sessions from (select dvid, epid, srcip, sum(sessions) as sessions from ###(select dvid, $flex_timestamp as timestamp, epid, srcip, policyname, policyid, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum((CASE WHEN (logflag&2>0) THEN 1 ELSE 0 END)) AS session_block, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) AS sessions from $log-traffic where $filter and (logflag&(1|32)>0) group by dvid, timestamp, epid, srcip, policyname, policyid order by bandwidth desc)### t where epid>1024 group by dvid, epid, srcip) t1 inner join (select epid, srcmac as epmac, dvid from $ADOM_EPEU_DEVMAP dm inner join devtable dt ON dm.devid=dt.devid and dm.vd=dt.vd) t2 on t1.epid=t2.epid and t1.dvid=t2.dvid left join $ADOM_ENDPOINT t3 on t1.epid=t3.epid and t2.epmac=t3.mac where hwvendor<>'Fortinet' group by ep_name, addr, osname, hwfamily, hwversion order by sessions desc"
        set protected enable
    next
    edit "360-security-wifi-AP-WaitingAuth-Online-Offline-Count"
        set description "WiFi AP count by Waiting Auth Online and Offline Status"
        set log-type event
        set query "select * from (select unnest(status) as ap_status, unnest(num) as totalnum from (select array['Online', 'Offline'] as status, array[sum(case when onwire!='no' or onwire is null then 1 end), sum(case when onwire='no' then 1 end)] as num from ###(select apstatus, bssid, ssid, onwire, count(*) as subtotal from $log where $filter and apstatus is not null and apstatus!=0 and bssid is not null and logid_to_int(logid) in (43527, 43521, 43525, 43563, 43564, 43565, 43566, 43569, 43570, 43571, 43582, 43583, 43584, 43585) group by apstatus, bssid, ssid, onwire order by subtotal desc)### t)t union all (select ap_status, totalnum from ###(select (case when not (action like '%join%') then 'Waiting for Authentication' end) as ap_status, count(*) as totalnum from $log where $filter and logid_to_int(logid) in (43522, 43551) group by ap_status order by totalnum desc)### t)) t where ap_status is not null and totalnum>0"
        set protected enable
    next
    edit "360-security-wifi-Top-AP-By-Client"
        set description "WiFi Top Access Point by Client"
        set log-type event
        set query "select ap, count(distinct lmac) as totalnum from ###(select ap, stamac as lmac, ssid, action, max(dtime) as last from $log-event where $filter and ssid is not null group by ap, lmac, ssid, action order by last desc)### t group by ap order by totalnum desc"
        set protected enable
    next
    edit "360-security-wifi-Signal-By-Client"
        set description "WiFi Signal by Client"
        set log-type event
        set query "select sig_status, count(distinct lmac) as totalnum from ###(select ap, stamac as lmac, ssid, action, (case when signal>=-65 then 'Good (>=-65dBm)' when signal<-75 then 'Poor (<-75dBm)' end) as sig_status, max(dtime) as last from $log-event where $filter and ssid is not null group by ap, lmac, ssid, action, sig_status order by last desc)### t where sig_status is not null group by sig_status order by totalnum desc"
        set protected enable
    next
    edit "360-security-wifi-Auth-Failure-Event"
        set description "WiFi Authentication Failure Event"
        set log-type event
        set query "select ssid, from_dtime(last) as last from ###(select ap, stamac as lmac, ssid, action, max(dtime) as last from $log-event where $filter and ssid is not null group by ap, lmac, ssid, action order by last desc)### t where action like '%auth-failure' order by last desc"
        set protected enable
    next
    edit "360-security-Top-Policy-Bandwidth-Timeline"
        set description "Top Policy Bandwidth Timeline"
        set log-type traffic
        set query "select timestamp, policy, bandwidth, sum(bandwidth) over (partition by policy) as total_bandwidth from (select timestamp, t1.policy, t1.bandwidth from (select $fv_line_timescale(timestamp) as timestamp, coalesce(policyname, policyid::text) as policy, sum(bandwidth) as bandwidth FROM ###(select dvid, $flex_timestamp as timestamp, epid, srcip, policyname, policyid, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum((CASE WHEN (logflag&2>0) THEN 1 ELSE 0 END)) AS session_block, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) AS sessions from $log-traffic where $filter and (logflag&(1|32)>0) group by dvid, timestamp, epid, srcip, policyname, policyid order by bandwidth desc)### t group by timestamp, policy order by timestamp) t1 inner join (select coalesce(policyname, policyid::text) as policy, sum(bandwidth) as bandwidth FROM ###(select dvid, $flex_timestamp as timestamp, epid, srcip, policyname, policyid, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum((CASE WHEN (logflag&2>0) THEN 1 ELSE 0 END)) AS session_block, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) AS sessions from $log-traffic where $filter and (logflag&(1|32)>0) group by dvid, timestamp, epid, srcip, policyname, policyid order by bandwidth desc)### t where coalesce(policyname, policyid::text) is not null and bandwidth>0  group by policy order by bandwidth desc limit $ddown-top) t2 on t1.policy=t2.policy order by timestamp) t order by timestamp, total_bandwidth desc"
        set protected enable
    next
    edit "360-security-Policy-by-Bandwidth"
        set description "Top Policy by Bandwidth"
        set log-type traffic
        set query "select policy, sum(bandwidth) as bandwidth FROM  ###(select coalesce(policyname, policyid::text) as policy, max(policytype) as policytype, srcintf, dstintf, max(devname) as devname, max(vd) as vd, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) AS sessions, from_dtime(max(dtime)) as time_stamp from $log-traffic where $filter and (logflag&(1|32)>0) and coalesce(policyname, policyid::text) is not null group by policy, srcintf, dstintf order by bandwidth desc)### t where bandwidth>0 group by policy order by bandwidth desc"
        set protected enable
    next
    edit "360-security-Policy-by-Session"
        set description "Top Policy by Session"
        set log-type traffic
        set query "select coalesce(policyname, policyid::text) as policy, sum(sessions) as sessions FROM ###(select dvid, $flex_timestamp as timestamp, epid, srcip, policyname, policyid, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum((CASE WHEN (logflag&2>0) THEN 1 ELSE 0 END)) AS session_block, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) AS sessions from $log-traffic where $filter and (logflag&(1|32)>0) group by dvid, timestamp, epid, srcip, policyname, policyid order by bandwidth desc)### t where policyid is not null group by policy order by sessions desc"
        set protected enable
    next
    edit "360-security-Policy-Details"
        set description "Top Policy with Details by Bandwidth"
        set log-type traffic
        set query "select policy, max(policytype) as policytype, string_agg(distinct srcintf, ',') as srcintf, string_agg(distinct dstintf, ',') as dstintf, max(devname) as devname, max(vd) as vd, sum(bandwidth) as bandwidth, sum(sessions) as sessions, max(time_stamp) as time_stamp from ###(select coalesce(policyname, policyid::text) as policy, max(policytype) as policytype, srcintf, dstintf, max(devname) as devname, max(vd) as vd, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) AS sessions, from_dtime(max(dtime)) as time_stamp from $log-traffic where $filter and (logflag&(1|32)>0) and coalesce(policyname, policyid::text) is not null group by policy, srcintf, dstintf order by bandwidth desc)### t where bandwidth>0 group by policy order by bandwidth desc"
        set protected enable
    next
    edit "360-security-Top-Source-Session-Timeline"
        set description "Top Source Session Timeline"
        set log-type traffic
        set query "select $fv_line_timescale(timestamp) as timestamp, sum(session_block) as session_block, (sum(sessions)-sum(session_block)) as session_pass FROM ###(select dvid, $flex_timestamp as timestamp, epid, srcip, policyname, policyid, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum((CASE WHEN (logflag&2>0) THEN 1 ELSE 0 END)) AS session_block, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) AS sessions from $log-traffic where $filter and (logflag&(1|32)>0) group by dvid, timestamp, epid, srcip, policyname, policyid order by bandwidth desc)### t group by timestamp order by timestamp"
        set protected enable
    next
    edit "360-security-Top-Source-Details"
        set description "Top Source with Details by Bandwidth"
        set log-type traffic
        set query "select f_user, string_agg(distinct srcintf, ',') as srcintf, string_agg(distinct dev_src, ',') as dev_src, sum(threatwgt) as threatweight, sum(threat_block) as threat_block, (sum(threatwgt)-sum(threat_block)) as threat_pass, sum(bandwidth) as bandwidth, sum(sessions) as sessions from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as f_user, srcintf, max(coalesce(srcname, srcmac)) AS dev_src, sum(threatwgt) as threatwgt, sum(CASE WHEN (logflag&2>0) THEN threatwgt ELSE 0 END) AS threat_block, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) AS sessions from (select `user`, unauthuser, srcip, srcintf, srcname, srcmac, threatweight_sum(threatwgts, threatcnts) as threatwgt, sentdelta, sentbyte, rcvddelta, rcvdbyte, logflag  from $log-traffic where $filter and (logflag&(1|32)>0)) t group by f_user, srcintf order by bandwidth desc)### t where f_user is not null group by f_user order by bandwidth desc"
        set protected enable
    next
    edit "360-security-Top-Destination-Bandwidth-Timeline"
        set description "Top Destination Bandwidth Timeline"
        set log-type traffic
        set query "select $fv_line_timescale(timestamp) as timestamp, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from ###(select dvid, $flex_timestamp as timestamp, epid, srcip, policyname, policyid, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum((CASE WHEN (logflag&2>0) THEN 1 ELSE 0 END)) AS session_block, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) AS sessions from $log-traffic where $filter and (logflag&(1|32)>0) group by dvid, timestamp, epid, srcip, policyname, policyid order by bandwidth desc)### t group by timestamp order by timestamp"
        set protected enable
    next
    edit "360-security-Top-Destination-Details"
        set description "Top Destination with Details by Bandwidth"
        set log-type traffic
        set query "select dstip, count(distinct app_group) as app_num, sum(sessions) as sessions, sum(bandwidth) as bandwidth from ###(select dstip, app_group_name(app) as app_group, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) AS sessions from $log-traffic where $filter and (logflag&(1|32)>0) group by dstip, app_group order by bandwidth desc)### t1 where dstip is not null group by dstip order by bandwidth desc"
        set protected enable
    next
    edit "360-security-Incidents-Total-Count"
        set description "360 Security Incidents Total Count"
        set log-type dlp
        set query "select count(*) as total_num from  ###(select itime, hostname,`from` as sender, `to` as receiver, profile, action, service, subtype, srcip, dstip, severity, filename, direction, filesize, (case when severity='critical' then 'Critical Data Exfiltration' else (case when coalesce(nullifna(`user`), ipstr(`srcip`)) is not null then 'User Associated Data Loss' else NULL end) end) as data_loss from $log where $filter /*SkipSTART*/order by itime desc/*SkipEND*/)### t where $filter-drilldown and severity is not null"
        set protected enable
    next
    edit "360-security-App-Category-Group-By-Bandwidth"
        set description "Application Category and Group by Bandwidth"
        set log-type traffic
        set query "select appcat, app_group, bandwidth, sum(bandwidth) over (partition by appcat) as total_bandwidth from (select appcat, app_group_name(app) as app_group, sum(bandwidth) as bandwidth from ###(select app, appcat, user_src, sum(bandwidth) as bandwidth, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t where nullifna(appcat) is not null group by app, appcat, user_src /*SkipSTART*/ order by bandwidth desc /*SkipEND*/)### t where $filter-drilldown and app is not null group by appcat, app_group) t order by total_bandwidth desc, appcat"
        set protected enable
    next
    edit "360-security-Applications-By-Bandwidth"
        set description "360 Security Top Applications by Bandwidth"
        set log-type traffic
        set query "select risk as d_risk, t2.name, t2.app_cat, t2.technology, count(distinct user_src) as users, sum(bandwidth) as bandwidth, sum(sessions) as sessions from ###(select user_src, appid, app, appcat, apprisk, sum(bandwidth) as bandwidth, sum(sessions) as sessions from ###base(/*tag:rpt_base_t_top_app*/select $flex_timestamp as timestamp, dvid, srcip, dstip, epid, euid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, appid, app, appcat, apprisk, hostname, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(CASE WHEN (logflag&1>0) THEN 1 ELSE 0 END) as sessions from $log-traffic where $filter and (logflag&(1|32)>0) and nullifna(app) is not null group by timestamp, dvid, srcip, dstip, epid, euid, user_src, service, appid, app, appcat, apprisk, hostname order by sessions desc, bandwidth desc)base### t group by user_src, appid, app, appcat, apprisk /*SkipSTART*/order by sessions desc, bandwidth desc/*SkipEND*/)###  t1 inner join app_mdata t2 on t1.appid=t2.id group by d_risk, t2.name, t2.app_cat, t2.technology order by d_risk desc, bandwidth desc"
        set protected enable
    next
    edit "360-security-Top-Category-User-By-Count"
        set description "Top Web Category and User by Count"
        set log-type traffic
        set query "select catdesc, coalesce(firstname || ' ' || lastname, euname, usersrc) as user_src, requests, sum(requests) over (partition by catdesc) as total_num from ###(select $flex_timestamp as timestamp, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as usersrc, euid, catdesc, hostname as website, ebtr_agg_flat($browse_time) as browsetime, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out, count(*) as requests from $log-traffic where $filter and (logflag&1>0) and (countweb>0 or ((logver is null or logver<502000000) and (hostname is not null or utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter')))) group by timestamp, usersrc, euid, catdesc,website /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t1 left join $ADOM_ENDUSER t3 on t1.euid=t3.euid where usersrc is not null and catdesc<>'Unknown' order by total_num desc, catdesc"
        set protected enable
    next
    edit "360-security-Malware-Virus-Botnet-Spyware"
        set description "Top Virus Botnet Spyware Adware and Phishing Websites"
        set log-type traffic
        set query "select malware_type, virus_s, total_num, sum(total_num) over (partition by malware_type) as type_total_num from ((select (case when lower(appcat)='botnet' then 'Botnet C&C' else (case when virus_s like 'Riskware%' then 'Spyware' when virus_s like 'Adware%' then 'Adware' else 'Virus' end) end) as malware_type, virus_s, sum(total_num) as total_num from (###(select app as virus_s, appcat, hostname, count(*) as total_num from $log-traffic where $filter and (logflag&1>0) and lower(appcat)='botnet' group by virus_s, appcat, hostname order by total_num desc)### union all ###(select unnest(string_to_array(virus, ',')) as virus_s, appcat, hostname, count(*) as total_num from $log-traffic where $filter and (logflag&1>0) and virus is not null group by virus_s, appcat, hostname order by total_num desc)### union all ###(select attack as virus_s, 'botnet' as appcat, hostname, count(*) as total_num from $log-attack where $filter and (logflag&16>0) group by virus_s, appcat, hostname order by total_num desc)###) t where virus_s is not null group by malware_type, virus_s) union all (select 'Phishing' as malware_type, hostname as virus_s, count(*) as total_num from $log-webfilter where $filter and hostname is not null and catdesc='Phishing' group by malware_type, virus_s)) t order by type_total_num desc, virus_s"
        set protected enable
    next
    edit "360-security-Victims-of-Phishing-Site-by-Count"
        set description "Victims of Phishing Site by Count"
        set log-type webfilter
        set query "select phishing_site, user_src, total_num, sum(total_num) over (partition by phishing_site) as user_total_num from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, hostname as phishing_site, count(*) as total_num from $log where $filter and lower(service) in ('http', 'https') and hostname is not null and cat in (26, 61) group by user_src, phishing_site order by total_num desc)### t order by user_total_num desc, user_src"
        set protected enable
    next
    edit "360-security-App-Visibility-Control-Total-Count"
        set description "Application Visibility and Control Total Count"
        set log-type app-ctrl
        set query "select sum(total_num) as total_num from (select appcat, count(distinct app) as total_num from ###(select appcat, app from $log where $filter and app is not null and appcat is not null group by appcat, app)### t group by appcat order by total_num desc) t"
        set protected enable
    next
    edit "360-security-Total-Malware-Detected"
         set description "360-Security Total Malware Detected"
         set log-type virus
         set query "select sum(total_num) as total_num from (select threat_name, count(distinct threats) as total_num from (###(select cast('Malware & Botnet C&C' as char(32)) as threat_name, app as threats, count(*) as total_num from $log-app-ctrl where $filter and lower(appcat)='botnet' group by app order by total_num desc)### union all ###(select cast('Malware & Botnet C&C' as char(32)) as threat_name, virus as threats, count(*) as total_num from $log-virus where $filter and nullifna(virus) is not null group by virus order by total_num desc)### union all ###(select cast('Malicious & Phishing Sites' as char(32)) as threat_name, hostname as threats, count(*) as total_num from $log-webfilter where $filter and cat in (26, 61) group by hostname order by total_num desc)### union all ###(select cast('Critical & High Intrusion Attacks' as char(32)) as threat_name, attack as threats, count(*) as total_num from $log-attack where $filter and severity in ('critical', 'high') group by attack order by total_num desc)###) t group by threat_name order by total_num desc) t"
         set protected enable
     next
    edit "web-Usage-Top-User-Category-By-Count"
        set description "Top Web User and Category by Count"
        set log-type traffic
        set query "select coalesce(firstname || ' ' || lastname, euname, usersrc) as user_src, catdesc, requests, sum(requests) over (partition by usersrc) as total_num from ###(select $flex_timestamp as timestamp, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as usersrc, euid, catdesc, hostname as website, ebtr_agg_flat($browse_time) as browsetime, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out, count(*) as requests from $log-traffic where $filter and (logflag&1>0) and (countweb>0 or ((logver is null or logver<502000000) and (hostname is not null or utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter')))) group by timestamp, usersrc, euid, catdesc,website /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t1 left join $ADOM_ENDUSER t3 on t1.euid=t3.euid where usersrc is not null and catdesc<>'Unknown' order by total_num desc, user_src"
        set protected enable
    next
    edit "web-Usage-Request-Count"
        set description "Web Usage Request Count"
        set log-type webfilter
        set query "select sum(requests) as requests from ###(select $flex_timestamp as timestamp, coalesce(nullifna(`user`), ipstr(`srcip`)) as usersrc, euid, action, count(*) as requests from $log-webfilter where $filter and coalesce(nullifna(`user`), ipstr(`srcip`)) is not null group by timestamp, usersrc, euid, action /*SkipSTART*/order by requests desc, timestamp desc/*SkipEND*/)### t"
        set protected enable
    next
    edit "web-Usage-Application-Count"
        set description "Web Usage Application Count"
        set log-type traffic
        set query "select count(distinct t2.name) as total_num from ###(select appid, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as f_user, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, count(*) as num_session from $log where $filter and (logflag&1>0) and nullifna(app) is not null and service in ('80/tcp', '443/tcp', 'HTTP', 'HTTPS', 'http', 'https') group by appid, f_user order by bandwidth desc)### t1 inner join app_mdata t2 on t1.appid=t2.id"
        set protected enable
    next
    edit "web-Usage-Category-Count"
        set description "Web Usage Category Count"
        set log-type traffic 
        set query "select count(distinct catdesc) as total_num from ###(select $flex_timestamp as timestamp, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as usersrc, euid, catdesc, hostname as website, ebtr_agg_flat($browse_time) as browsetime, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out, count(*) as requests from $log-traffic where $filter and (logflag&1>0) and (countweb>0 or ((logver is null or logver<502000000) and (hostname is not null or utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter')))) group by timestamp, usersrc, euid, catdesc,website /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t where catdesc is not null"
    set protected enable
    next
    edit "web-Usage-User-Count"
        set description "Web Usage User Count"
        set log-type traffic
        set query "select count(distinct usersrc) as total_num from ###(select $flex_timestamp as timestamp, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as usersrc, euid, catdesc, hostname as website, ebtr_agg_flat($browse_time) as browsetime, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out, count(*) as requests from $log-traffic where $filter and (logflag&1>0) and (countweb>0 or ((logver is null or logver<502000000) and (hostname is not null or utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter')))) group by timestamp, usersrc, euid, catdesc,website /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t where usersrc is not null and bandwidth>0"
        set protected enable
    next
    edit "web-Usage-Count-By-Allowed-Blocked"
        set description "Web Usage Allowed and Blocked Count"
        set log-type webfilter
        set query "select unnest(type) as allow_block, unnest(request_cnt) as totoal_num from (select array['Allowed', 'Blocked'] as type, array[sum(case when action!='blocked' then requests end), sum(case when action='blocked' then requests end)] as request_cnt from ###(select $flex_timestamp as timestamp, coalesce(nullifna(`user`), ipstr(`srcip`)) as usersrc, euid, action, count(*) as requests from $log-webfilter where $filter and coalesce(nullifna(`user`), ipstr(`srcip`)) is not null group by timestamp, usersrc, euid, action /*SkipSTART*/order by requests desc, timestamp desc/*SkipEND*/)### t) t"
        set protected enable
    next
    edit "web-Usage-Top-Web-Users-By-Blocked-Requests"
        set description "Web Usage Top Web Users by Blocked Requests"
        set log-type webfilter
        set query "select coalesce(firstname || ' ' || lastname, euname, usersrc) as user_src, sum(requests) as requests from ###(select $flex_timestamp as timestamp, coalesce(nullifna(`user`), ipstr(`srcip`)) as usersrc, euid, action, count(*) as requests from $log-webfilter where $filter and coalesce(nullifna(`user`), ipstr(`srcip`)) is not null group by timestamp, usersrc, euid, action /*SkipSTART*/order by requests desc, timestamp desc/*SkipEND*/)### t1 left join $ADOM_ENDUSER t3 on t1.euid=t3.euid where action='blocked' group by user_src order by requests desc"
        set protected enable
    next
    edit "web-Usage-Top-Web-Users-By-Allowed-Requests"
        set description "Web Usage Top Web Users by Allowed Requests"
        set log-type webfilter
        set query "select coalesce(firstname || ' ' || lastname, euname, usersrc) as user_src, sum(requests) as requests from ###(select $flex_timestamp as timestamp, coalesce(nullifna(`user`), ipstr(`srcip`)) as usersrc, euid, action, count(*) as requests from $log-webfilter where $filter and coalesce(nullifna(`user`), ipstr(`srcip`)) is not null group by timestamp, usersrc, euid, action /*SkipSTART*/order by requests desc, timestamp desc/*SkipEND*/)### t1 left join $ADOM_ENDUSER t3 on t1.euid=t3.euid where action!='blocked' group by user_src order by requests desc"
        set protected enable
    next
    edit "web-Usage-Bandwidth-Timeline"
        set description "Web Usage Bandwidth Timeline"
        set log-type traffic 
        set query "select $flex_timescale(timestamp) as hodex, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from  ###(select $flex_timestamp as timestamp, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as usersrc, euid, catdesc, hostname as website, ebtr_agg_flat($browse_time) as browsetime, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out, count(*) as requests from $log-traffic where $filter and (logflag&1>0) and (countweb>0 or ((logver is null or logver<502000000) and (hostname is not null or utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter')))) group by timestamp, usersrc, euid, catdesc,website /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t group by hodex order by hodex"
    set protected enable
    next
    edit "web-Usage-Top-Web-Users-By-Requests"
        set description "Web Usage Top Web Users by Requests"
        set log-type webfilter
        set query "select coalesce(firstname || ' ' || lastname, euname, usersrc) as user_src, sum(requests) as requests from ###(select $flex_timestamp as timestamp, coalesce(nullifna(`user`), ipstr(`srcip`)) as usersrc, euid, action, count(*) as requests from $log-webfilter where $filter and coalesce(nullifna(`user`), ipstr(`srcip`)) is not null group by timestamp, usersrc, euid, action /*SkipSTART*/order by requests desc, timestamp desc/*SkipEND*/)### t1 left join $ADOM_ENDUSER t3 on t1.euid=t3.euid where usersrc is not null group by user_src order by requests desc"
        set protected enable
    next
    edit "web-Usage-Top-Web-Users-By-Requests-Timeline"
        set description "Web Usage top Web Users by Requests Timeline"
        set log-type webfilter
        set query "with time_users as (select $flex_timescale(timestamp) as hodex, coalesce(firstname || ' ' || lastname, euname, usersrc) as user_src, sum(requests) as requests from (select timestamp, usersrc, euid, requests from ###(select $flex_timestamp as timestamp, coalesce(nullifna(`user`), ipstr(`srcip`)) as usersrc, euid, action, count(*) as requests from $log-webfilter where $filter and coalesce(nullifna(`user`), ipstr(`srcip`)) is not null group by timestamp, usersrc, euid, action /*SkipSTART*/order by requests desc, timestamp desc/*SkipEND*/)### t where usersrc is not null) t1 left join $ADOM_ENDUSER t3 on t1.euid=t3.euid group by hodex, user_src order by hodex), top_users as (select user_src, sum(requests) as requests from time_users group by user_src order by requests desc limit $ddown-top) select hodex, user_src, requests from time_users t where exists (select 1 from top_users where user_src=t.user_src) order by hodex"
        set protected enable
    next
    edit "web-Usage-Top-User-Browsing-Time"
        set description "Web Usage Top User Browsing Time"
        set log-type traffic
        set query "select user_src, sum(browsetime) as browsetime from (select coalesce(firstname || ' ' || lastname, euname, usersrc) as user_src, catdesc, ebtr_value(ebtr_agg_flat(browsetime), null, $timespan) as browsetime from ###(select $flex_timestamp as timestamp, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as usersrc, euid, catdesc, hostname as website, ebtr_agg_flat($browse_time) as browsetime, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out, count(*) as requests from $log-traffic where $filter and (logflag&1>0) and (countweb>0 or ((logver is null or logver<502000000) and (hostname is not null or utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter')))) group by timestamp, usersrc, euid, catdesc,website /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t1 left join $ADOM_ENDUSER t3 on t1.euid=t3.euid where usersrc is not null group by user_src, catdesc order by browsetime desc) t group by user_src order by browsetime desc, user_src"
        set protected enable
    next
    edit "web-Usage-Top-User-Category-by-Browsing-Time"
        set description "Web Usage Top User and Category by Browsing Time"
        set log-type traffic
        set query "select coalesce(firstname || ' ' || lastname, euname, usersrc) as user_src, catdesc, ebtr_value(ebtr_agg_flat(browsetime), null, $timespan) as browsetime from ###(select $flex_timestamp as timestamp, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as usersrc, euid, catdesc, hostname as website, ebtr_agg_flat($browse_time) as browsetime, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out, count(*) as requests from $log-traffic where $filter and (logflag&1>0) and (countweb>0 or ((logver is null or logver<502000000) and (hostname is not null or utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter')))) group by timestamp, usersrc, euid, catdesc,website /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t1 left join $ADOM_ENDUSER t3 on t1.euid=t3.euid where usersrc is not null group by user_src, catdesc order by browsetime desc, user_src, catdesc"
        set protected enable
    next
    edit "web-Usage-Top-Category-By-Website-Browsetime"
        set description "Top Category By Website Browsetime"
        set log-type traffic
        set query "select catdesc, ebtr_value(ebtr_agg_flat(browsetime), null, $timespan) as browsetime from ###(select $flex_timestamp as timestamp, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as usersrc, euid, catdesc, hostname as website, ebtr_agg_flat($browse_time) as browsetime, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out, count(*) as requests from $log-traffic where $filter and (logflag&1>0) and (countweb>0 or ((logver is null or logver<502000000) and (hostname is not null or utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter')))) group by timestamp, usersrc, euid, catdesc,website /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t where catdesc!='Unrated' and browsetime is not null group by catdesc order by browsetime desc"
        set protected enable
    next
    edit "web-Usage-Top-User-By-Bandwidth"
        set description "Web Usage Top User By Bandwidth"
        set log-type traffic
        set query "select coalesce(firstname || ' ' || lastname, euname, usersrc) as user_src, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as usersrc, euid, catdesc, hostname as website, ebtr_agg_flat($browse_time) as browsetime, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out, count(*) as requests from $log-traffic where $filter and (logflag&1>0) and (countweb>0 or ((logver is null or logver<502000000) and (hostname is not null or utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter')))) group by timestamp, usersrc, euid, catdesc,website /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t1 left join $ADOM_ENDUSER t3 on t1.euid=t3.euid where bandwidth>0 group by user_src order by bandwidth desc"
        set protected enable
    next
    edit "web-Usage-Top-User-By-Bandwidth-Timeline"
        set description "Web Usage Top User By Bandwidth Timeline"
        set log-type traffic
        set query "with time_users as (select $flex_timescale(timestamp) as hodex, coalesce(firstname || ' ' || lastname, euname, usersrc) as user_src, sum(bandwidth) as bandwidth from (select timestamp, usersrc, euid, bandwidth from ###(select $flex_timestamp as timestamp, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as usersrc, euid, catdesc, hostname as website, ebtr_agg_flat($browse_time) as browsetime, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out, count(*) as requests from $log-traffic where $filter and (logflag&1>0) and (countweb>0 or ((logver is null or logver<502000000) and (hostname is not null or utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter')))) group by timestamp, usersrc, euid, catdesc,website /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t where usersrc is not null) t1 left join $ADOM_ENDUSER t3 on t1.euid=t3.euid group by hodex, user_src order by bandwidth desc), top_users as (select user_src, sum(bandwidth) as bandwidth from time_users where bandwidth>0 group by user_src order by bandwidth desc limit $ddown-top) select hodex, user_src, bandwidth from time_users t where exists (select 1 from top_users where user_src=t.user_src) order by hodex"
        set protected enable
    next
    edit "web-Usage-Top-Category-and-Websites-by-Bandwidth"
        set description "Web Usage Top Web Category and Websites by Bandwidth"
        set log-type traffic
        set query "select catdesc, website, bandwidth, sum(bandwidth) over (partition by catdesc) as sub_bandwidth from (select website, catdesc, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as usersrc, euid, catdesc, hostname as website, ebtr_agg_flat($browse_time) as browsetime, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out, count(*) as requests from $log-traffic where $filter and (logflag&1>0) and (countweb>0 or ((logver is null or logver<502000000) and (hostname is not null or utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter')))) group by timestamp, usersrc, euid, catdesc,website /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t where  website is not null and catdesc is not null group by website, catdesc order by bandwidth desc) t order by sub_bandwidth desc, catdesc"
        set protected enable
    next
    edit "web-Usage-Top-Blocked-User-Category-By-Request"
        set description "Web Usage Top Blocked Web User and Category by Request"
        set log-type webfilter
        set query "select user_src, catdesc, requests, sum(requests) over (partition by user_src) as total_num from (select coalesce(firstname || ' ' || lastname, euname, usersrc) as user_src, catdesc, sum(requests) as requests from  ###(select coalesce(nullifna(`user`), ipstr(`srcip`)) as usersrc, euid, hostname, catdesc, action, count(*) as requests from $log where $filter group by usersrc, euid, hostname, catdesc, action order by requests desc)### t1 left join $ADOM_ENDUSER t3 on t1.euid=t3.euid where usersrc is not null and catdesc<>'Unknown' and action='blocked' group by user_src, catdesc order by requests desc) t order by total_num desc, user_src"
        set protected enable
    next
    edit "web-Usage-Top-Web-Users-By-Blocked-Requests-Timeline"
        set description "Web Usage Top Web Users Timeline by Blocked Requests"
        set log-type webfilter
        set query "with time_users as (select $flex_timescale(timestamp) as hodex, coalesce(firstname || ' ' || lastname, euname, usersrc) as user_src, sum(requests) as requests from (select timestamp, usersrc, euid, requests from ###(select $flex_timestamp as timestamp, coalesce(nullifna(`user`), ipstr(`srcip`)) as usersrc, euid, action, count(*) as requests from $log-webfilter where $filter and coalesce(nullifna(`user`), ipstr(`srcip`)) is not null group by timestamp, usersrc, euid, action /*SkipSTART*/order by requests desc, timestamp desc/*SkipEND*/)### t where usersrc is not null and action='blocked') t1 left join $ADOM_ENDUSER t3 on t1.euid=t3.euid group by hodex, user_src order by hodex), top_users as (select user_src, sum(requests) as requests from time_users group by user_src order by requests desc limit $ddown-top) select hodex, user_src, requests from time_users t where exists (select 1 from top_users where user_src=t.user_src) order by hodex"
        set protected enable
    next
    edit "web-Usage-Top-Blocked-Web-Categories-by-Request"
        set description "Web Usage Top Blocked Web Categories by Request"
        set log-type webfilter
        set query "select catdesc, hostname, sum(requests) as requests from ###(select coalesce(nullifna(`user`), ipstr(`srcip`)) as usersrc, euid, hostname, catdesc, action, count(*) as requests from $log where $filter group by usersrc, euid, hostname, catdesc, action order by requests desc)### t1 where catdesc is not null and hostname is not null and action='blocked' group by catdesc, hostname order by requests desc"
        set protected enable
    next
    edit "web-Usage-Top-Sites-By-Browsing-Time"
        set description "Web Usage Top Websites by Browsing Time"
        set log-type traffic
        set query "select website, max(catdesc) as catdesc, ebtr_value(ebtr_agg_flat(browsetime), null, $timespan) as browsetime, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from ###(select $flex_timestamp as timestamp, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as usersrc, euid, catdesc, hostname as website, ebtr_agg_flat($browse_time) as browsetime, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out, count(*) as requests from $log-traffic where $filter and (logflag&1>0) and (countweb>0 or ((logver is null or logver<502000000) and (hostname is not null or utmevent in ('webfilter', 'banned-word', 'web-content', 'command-block', 'script-filter')))) group by timestamp, usersrc, euid, catdesc,website /*SkipSTART*/order by bandwidth desc/*SkipEND*/)### t where website is not null and catdesc is not null group by website order by browsetime desc"
        set protected enable
    next
    edit "soc-summary-Event-Count"
        set description "Security Event Count"
        set query "select count(*) as num_events from $event t1 left join devtable_ext t2 on t1.dvid=t2.dvid where $cust_time_filter(alerttime) and $filter-drilldown"
        set protected enable
    next
    edit "soc-summary-Analyzed-Event-Count"
        set description "Analyzed Security Event Count"
        set query "select count(*) as num_analyzed from $event t1 left join devtable_ext t2 on t1.dvid=t2.dvid where $cust_time_filter(alerttime) and ((comment is not null and comment != '') or flags&1 != 0) and $filter-drilldown"
        set protected enable
    next
    edit "soc-summary-Incident-Count"
        set description "Incident Count"
        set query "select count(*) as num_inc from $incident where $cust_time_filter(createtime)"
        set protected enable
    next
    edit "soc-summary-Affected-Endpoint-Count"
        set description "Affected Endpoint Count"
        set query "select count(distinct(endpoint)) as num_ep from $incident where $cust_time_filter(createtime)"
        set protected enable
    next
    edit "soc-summary-Affected-Endpoint-by-HWOS"
        set description "Affected Endpoint Count by OS"
        set query "select (case when osname is null then 'N/A' else osname end) as osname, count(distinct(endpoint)) as count from $incident t1 inner join $ADOM_ENDPOINT t2 on t1.epid=t2.epid where $cust_time_filter(createtime) and t2.epid>1024 group by osname order by count desc"
        set protected enable
    next
    edit "soc-summary-Incident-by-Category"
        set description "Incident Count by Category"
        set query "select inc_cat_encode(category) as cat, count(*) as num_cat from $incident where $cust_time_filter(createtime) group by cat order by num_cat desc"
        set protected enable
    next
end

config sql-report chart
    edit "Traffic-Bandwidth-Summary-Day-Of-Month"
        set disp-name "Bandwidth Summary"
        set category "Network Usage"
        set description "Traffic bandwidth usage summary"
        set dataset "traffic-bandwidth-timeline"
        set chart-type area
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "traffic_out"
                set column-graph-type line-up
                set column-attr bandwidth
                set legend "Sent"
            next
            edit 3
                set data-binding "traffic_in"
                set column-graph-type line-down
                set column-attr bandwidth
                set legend "Received"
            next
        end
        set protected enable
    next
    edit "Session-Summary-Day-Of-Month"
        set disp-name "Session Summary"
        set category "Network Usage"
        set description "Session summary"
        set dataset "number-of-session-timeline"
        set chart-type area
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "sessions"
                set column-graph-type line-up
                set legend "Number of Sessions"
            next
        end
        set protected enable
    next
    edit "Top-Users-By-Bandwidth"
        set disp-name "Top Users by Bandwidth"
        set category "Network Usage"
        set description "Top 10 users by bandwidth usage"
        set dataset "bandwidth-app-Top-Users-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "User(or IP)"
                set data-binding "user_src"
                set column-attr user
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 60
            next
            edit 3
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 4
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "Top-App-By-Bandwidth"
        set disp-name "Top Applications by Bandwidth"
        set category "Application"
        set description "Top 10 applications by bandwidth usage"
        set dataset "Top-App-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Application"
                set data-binding "app_group"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Bandwidth"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 60
            next
            edit 3
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 4
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "Top-User-Source-By-Sessions"
        set disp-name "Top Users by Sessions"
        set category "Network Usage"
        set description "Top 10 users by session count"
        set dataset "Top-User-Source-By-Sessions"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set column-attr user
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Sessions"
                set data-binding "sessions"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "sessions"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Top-App-By-Sessions"
        set disp-name "Top Applications by Sessions"
        set category "Application"
        set description "Top 10 applications by session count"
        set dataset "Top-App-By-Sessions"
        set chart-type table
        config table-columns
            edit 1
                set header "Application"
                set data-binding "app_group"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Sessions"
                set data-binding "sessions"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "sessions"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Top-Destination-Addresses-By-Sessions"
        set disp-name "Top Destinations by Sessions"
        set category "Network Usage"
        set description "Top 10 destination addresses by session count"
        set dataset "Top-Destinations-By-Sessions"
        set chart-type table
        config table-columns
            edit 1
                set header "Hostname(or IP)"
                set data-binding "domain"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Sessions"
                set data-binding "sessions"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "sessions"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Top-Destination-Addresses-By-Bandwidth"
        set disp-name "Top Destinations by Bandwidth"
        set category "Network Usage"
        set description "Top 10 destination addresses by bandwidth usage"
        set dataset "Top-Destinations-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Hostname(or IP)"
                set data-binding "domain"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 60
            next
            edit 3
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 4
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit  "DHCP-Summary-By-Port"
        set disp-name "Top DHCP Summary by Interfaces"
        set category "Event"
        set description "Top 10 DHCP summary by interfaces"
        set dataset "event-Top-DHCP-Summary"
        set chart-type table
        config table-columns
            edit 1
                set header "Interface"
                set data-binding "interface"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Allocated IP (%)"
                set data-binding "percent_of_allocated_ip"
                set column-span 2
                set column-graph-type bar
                set data-top 10
                set column-width 30
            next
            edit 3
                set data-binding "percent_of_allocated_ip"
                set data-top 10
            next
            edit 4
                set header "New Clients Count"
                set data-binding "new_cli_count"
                set column-span 2
                set column-graph-type bar
                set data-top 10
                set column-width 30
            next
            edit 5
                set data-binding "new_cli_count"
                set column-attr count
            next
        end
        set protected enable

    next
    edit "Top-Wifi-Client-By-Bandwidth"
        set disp-name "Top WiFi Clients Bandwidth"
        set category "Network Usage"
        set description "Top 10 WiFi clients by bandwidth usage"
        set dataset "traffic-Top-WiFi-Client-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set data-top 10
                set column-width 20
            next
            edit 2
                set header "SSID"
                set data-binding "srcssid"
                set data-top 10
                set column-width 20
            next
            edit 3
                set header "Hostname (or MAC)"
                set data-binding "devtype_new"
                set column-span 2
                set column-attr dev-type
                set data-top 10
                set column-width 30
            next
            edit 4
                set data-binding "hostname_mac"
            next
            edit 5
                set header "Bytes"
                set data-binding "bandwidth"
                set column-span 2
                set column-graph-type bar
                set column-width 30
            next
            edit 6
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next

    edit "Traffic-History-By-Active-User"
        set disp-name "Traffic History"
        set category "Network Usage"
        set description "Traffic history by number of active users"
        set dataset "Traffic-History-By-Active-User"
        set chart-type area
        config table-columns
            edit 1
                set header "Time Stamp"
                set column-attr time
                set data-binding "hodex"
                set data-top 168
            next
            edit 2
                set data-binding "total_user"
                set column-graph-type line-up
                set column-attr count
                set legend "Active Users"
            next
        end
        set protected enable
    next

    edit "Top-Allowed-Websites-By-Requests"
        set disp-name "Top 50 Allowed Websites by Requests"
        set category "Web"
        set description "Top 50 allowed websites by number of requests"
        set dataset "utm-Top-Allowed-Web-Sites-By-Request"
        set chart-type table
        config table-columns
            edit 1
                set header "Website"
                set data-binding "hostname"
                set data-top 50
                set column-width 30
            next
            edit 2
                set header "Category"
                set data-binding "catdesc"
                set column-attr web-cat
                set column-width 30
            next
            edit 3
                set header "Requests"
                set data-binding "requests"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 4
                set data-binding "requests"
            next
        end
        set protected enable
    next
    edit "Top-50-Websites-By-Bandwidth"
        set disp-name "Top 50 Websites and Category by Bandwidth"
        set category "Web"
        set description "Top 50 websites and web filtering categories by bandwidth usage"
        set dataset "webfilter-Top-Allowed-Web-Sites-by-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Site"
                set data-binding "domain"
                set data-top 50
                set column-width 30
            next
            edit 2
                set header "Category"
                set data-binding "agg_catdesc"
                set column-attr web-cat
                set column-width 30
            next
            edit 3
                set header "Bytes"
                set data-binding "bandwidth"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 4
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next

    edit "Top-Blocked-Websites"
        set disp-name "Top Blocked Websites"
        set category "Web"
        set description "Top 10 blocked websites by number of requests"
        set dataset "utm-Top-Blocked-Web-Sites-By-Request"
        set chart-type table
        config table-columns
            edit 1
                set header "Website"
                set data-binding "hostname"
                set data-top 10
                set column-width 40
                set column-attr obf-url
            next
            edit 2
                set header "Requests"
                set data-binding "requests"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Top-Web-Users-By-Request"
        set disp-name "Top 20 Web Users by Requests"
        set category "Web"
        set description "Top 20 web users by number of requests"
        set dataset "utm-Top-Web-Users-By-Request"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set column-attr user
                set data-top 20
                set column-width 30
            next
            edit 2
                set header "Hostname (or MAC)"
                set data-binding "devtype_new"
                set column-attr dev-type
                set column-span 2
                set column-width 30
            next
            edit 3
                set data-binding "srcname"
            next
            edit 4
                set header "Requests"
                set data-binding "requests"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 5
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Top-Allowed-WebSites-By-Bandwidth"
        set disp-name "Top Allowed Websites by Bandwidth"
        set category "Web"
        set description "Top 10 allowed websites by bandwidth usage"
        set dataset "utm-Top-Allowed-Websites-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Website"
                set data-binding "appid"
                set column-attr app-id
                set column-span 2
                set data-top 10
                set column-width 40
            next
            edit 2
                set data-binding "hostname"
            next
            edit 3
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 60
            next
            edit 4
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 5
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "Top-Blocked-Web-Users"
        set disp-name "Top Blocked Web Users"
        set category "Web"
        set description "Top 10 blocked web users"
        set dataset "utm-Top-Blocked-Web-Users"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set column-attr user
                set data-top 10
                set column-width 30
            next
            edit 2
                set header "Hostname (or MAC)"
                set data-binding "srcname"
                set column-width 30
            next
            edit 3
                set header "Requests"
                set data-binding "requests"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 4
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Top-20-Web-Users-By-Bandwidth"
        set disp-name "Top 20 Bandwidth Users"
        set category "Web"
        set description "Top 20 web users by bandwidth users"
        set dataset "webfilter-Top-Web-Users-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set column-attr user
                set data-top 20
                set column-width 30
            next
            edit 2
                set header "Hostname"
                set data-binding "ep_src"
                set column-width 30
            next
            edit 3
                set header "Bytes"
                set data-binding "bandwidth"
                set column-span 2
                set column-attr none
                set column-graph-type bar
                set column-width 40
            next
            edit 4
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next

    edit "Top-Web-Users-By-Bandwidth"
        set disp-name "Top Web Users by Bandwidth"
        set category "Web"
        set description "Top 10 web users by bandwidth usage"
        set dataset "utm-Top-Web-Users-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set column-attr user
                set data-top 10
                set column-width 30
            next
            edit 2
                set header "Hostname (or MAC)"
                set data-binding "devtype_new"
                set column-attr dev-type
                set column-span 2
                set column-width 30
            next
            edit 3
                set data-binding "srcname"
            next
            edit 4
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 40
            next
            edit 5
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 6
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "Top-Video-Streaming-Websites-By-Bandwidth"
        set disp-name "Top Video Streaming Applications and Websites by Bandwidth"
        set category "Web"
        set description "Top 10 video streaming applications and websites by bandwidth usage"
        set dataset "utm-Top-Video-Streaming-Websites-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Video Streaming Website"
                set data-binding "appid"
                set column-attr app-id
                set column-span 2
                set data-top 10
                set column-width 40
            next
            edit 2
                set data-binding "hostname"
            next
            edit 3
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 60
            next
            edit 4
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 5
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "Top-Email-Senders-By-Count"
        set disp-name "Top Email Senders"
        set category "Email"
        set description "Top 10 senders by number of emails"
        set dataset "default-Top-Email-Senders-By-Count"
        set chart-type table
        config table-columns
            edit 1
                set header "Sender"
                set data-binding "user_src"
                set column-attr email-sender
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Number of Emails"
                set data-binding "requests"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Top-Email-Receivers-By-Count"
        set disp-name "Top Email Recipients"
        set category "Email"
        set description "Top 10 recipients by number of emails"
        set dataset "default-Email-Top-Receivers-By-Count"
        set chart-type table
        config table-columns
            edit 1
                set header "Recipient"
                set data-binding "user_src"
                set column-attr email-recver
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Number of Emails"
                set data-binding "requests"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Top-Email-Senders-By-Bandwidth"
        set disp-name "Top Senders by Aggregated Email Size"
        set category "Email"
        set description "Top 10 senders by aggregated email size"
        set dataset "default-Email-Top-Senders-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Sender"
                set data-binding "user_src"
                set column-attr email-sender
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Combined Email Size"
                set data-binding "bandwidth"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "Top-Email-Receivers-By-Bandwidth"
        set disp-name "Top Recipients by Aggregated Email Size"
        set category "Email"
        set description "Top 10 recipients by aggregated email size"
        set dataset "default-Email-Top-Receivers-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Recipient"
                set data-binding "user_src"
                set column-attr email-recver
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Combined Email Size"
                set data-binding "bandwidth"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "Top-Malware-By-Name"
        set disp-name "Top Malware"
        set category "Threat"
        set description "Top malware detected by malware type"
        set dataset "utm-Top-Virus"
        set chart-type table
        config table-columns
            edit 1
                set header "Malware Name"
                set data-binding "virusid"
                set column-attr url
                set column-span 2
                set data-top 10
                set column-width 30
            next
            edit 2
                set data-binding "virus"
                set column-attr virus
            next
            edit 3
                set header "Malware Type"
                set data-binding "malware_type"
                set column-width 30
            next
            edit 4
                set header "Counts"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 5
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Top-Virus-By-Name"
        set disp-name "Top Viruses"
        set category "Threat"
        set description "Top 10 viruses detected"
        set dataset "utm-Top-Virus"
        set chart-type table
        config table-columns
            edit 1
                set header "Virus Name"
                set data-binding "virus"
                set column-attr url
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Occurrences"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
            next
        end
        set protected enable
    next
    edit "Top-Virus-Victim"
        set disp-name "Top Virus Victims"
        set category "Threat"
        set description "Top virus victims"
        set dataset "utm-Top-Virus-User"
        set chart-type table
        config table-columns
            edit 1
                set header "Victim Name (or IP)"
                set data-binding "user_src"
                set column-attr user
                set data-top 0
                set column-width 40
            next
            edit 2
                set header "Counts"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Top-Attack-Source"
        set disp-name "Top Attack Sources"
        set category "Threat"
        set description "Top 10 attack sources"
        set dataset "utm-Top-Attack-Source"
        set chart-type table
        config table-columns
            edit 1
                set header "Attack Source"
                set data-binding "user_src"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Counts"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Top-Attack-Victim"
        set disp-name "Top Attack Victims"
        set category "Threat"
        set description "Top 10 attack victims"
        set dataset "utm-Top-Attack-Dest"
        set chart-type table
        config table-columns
            edit 1
                set header "Attack Victim"
                set data-binding "victim"
                set column-attr user
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Counts"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Top-Static-IPSEC-Tunnels-By-Bandwidth"
        set disp-name "Top Site-to-Site IPsec Tunnels by Bandwidth"
        set category "Network Usage"
        set description "Top 10 site-to-site IPsec VPN tunnels by bandwidth usage"
        set dataset "vpn-Top-Static-IPSEC-Tunnels-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Site-to-Site IPsec Tunnel"
                set data-binding "vpn_name"
                set column-attr ipsec-tunnel
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 60
            next
            edit 3
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 4
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "Top-SSL-VPN-Tunnel-Users-By-Bandwidth"
        set disp-name "Top SSL Tunnel Users by Bandwidth"
        set category "VPN"
        set description "Top 10 users of SSL VPN tunnel by bandwidth usage"
        set dataset "vpn-Top-SSL-VPN-Tunnel-Users-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "User"
                set data-binding "user_src"
                set column-attr user
                set data-top 10
                set column-width 20
            next
            edit 2
                set header "IP"
                set data-binding "remote_ip"
                set column-width 20
            next
            edit 3
                set header "First Used"
                set data-binding "start_time"
                set column-width 20
            next
            edit 4
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 40
            next
            edit 5
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 6
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "Top-Dial-Up-IPSEC-Tunnels-By-Bandwidth"
        set disp-name "Top Dial-up IPsec Tunnels by Bandwidth"
        set category "Network Usage"
        set description "Top 10 dial-up IPsec VPN tunnels by bandwidth usage"
        set dataset "vpn-Top-Dial-Up-IPSEC-Tunnels-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Dial-up IPsec Tunnel"
                set data-binding "vpn_name"
                set column-attr ipsec-tunnel
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 60
            next
            edit 3
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 4
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "Top-Dial-Up-IPSEC-Users-By-Bandwidth"
        set disp-name "Top Dial-up IPsec Users by Bandwidth"
        set category "Network Usage"
        set description "Top 10 users of dial-up IPsec VPN by bandwidth usage"
        set dataset "vpn-Top-Dial-Up-IPSEC-Users-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "User"
                set data-binding "user_src"
                set column-attr user
                set data-top 10
                set column-width 20
            next
            edit 2
                set header "IP"
                set data-binding "remip"
                set column-width 20
            next
            edit 3
                set header "First Used"
                set data-binding "start_time"
                set column-width 20
            next
            edit 4
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 40
            next
            edit 5
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 6
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "Top-Dial-Up-IPSEC-Users-By-Duration"
        set disp-name "Top Dial-up IPsec Users by Duration"
        set category "VPN"
        set description "Top 10 users of dial-up IPsec VPN by duration"
        set dataset "vpn-Top-Dial-Up-IPSEC-Users-By-Duration"
        set chart-type table
        config table-columns
            edit 1
                set header "User"
                set data-binding "user_src"
                set column-attr user
                set data-top 10
                set column-width 20
            next
            edit 2
                set header "First Used"
                set data-binding "start_time"
                set column-width 20
            next
            edit 3
                set header "Aggregated Dialed Time(HH:MM:SS)"
                set data-binding "duration"
                set column-graph-type bar
                set column-span 2
                set column-width 30
            next
            edit 4
                set data-binding "duration"
                set column-attr timespan
            next
            edit 5
                set header "Aggregated Bytes"
                set column-span 2
                set column-graph-type bar
                set data-binding "bandwidth"
                set column-width 30
            next
            edit 6
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "Top-SSL-VPN-Web-Mode-Users-By-Bandwidth"
        set disp-name "Top SSL Web Portal Users by Bandwidth"
        set category "VPN"
        set description "Top 10 users of SSL VPN web portal by bandwidth usage"
        set dataset "vpn-Top-SSL-VPN-Web-Mode-Users-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "User"
                set data-binding "user_src"
                set column-attr user
                set data-top 10
                set column-width 20
            next
            edit 2
                set header "IP"
                set data-binding "remote_ip"
                set column-width 20
            next
            edit 3
                set header "First Used"
                set data-binding "start_time"
                set column-width 20
            next
            edit 4
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 40
            next
            edit 5
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 6
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "Top-SSL-VPN-Web-Mode-Users-By-Duration"
        set disp-name "Top SSL Web Portal Users by Duration"
        set category "VPN"
        set description "Top 10 users of SSL VPN web portal by duration"
        set dataset "vpn-Top-SSL-VPN-Web-Mode-Users-By-Duration"
        set chart-type table
        config table-columns
            edit 1
                set header "User"
                set data-binding "user_src"
                set column-attr user
                set data-top 10
                set column-width 20
            next
            edit 2
                set header "IP"
                set data-binding "remote_ip"
                set column-width 20
            next
            edit 3
                set header "First Used"
                set data-binding "start_time"
                set column-width 20
            next
            edit 4
                set header "Aggregated Dialed Time(HH:MM:SS)"
                set data-binding "duration"
                set column-graph-type bar
                set column-span 2
                set column-width 40
            next
            edit 5
                set data-binding "duration"
                set column-attr timespan
            next
        end
        set protected enable
    next
    edit "Top-SSL-VPN-Users-By-Duration"
        set disp-name "Top SSL Users by Duration"
        set category "VPN"
        set description "Top 10 users of SSL VPN web portal and tunnel by duration"
        set dataset "vpn-Top-SSL-VPN-Users-By-Duration"
        set chart-type table
        config table-columns
            edit 1
                set header "User"
                set data-binding "user_src"
                set column-attr user
                set data-top 10
                set column-width 20
            next
            edit 2
                set header "Type"
                set data-binding "tunneltype"
                set column-width 20
            next
            edit 3
                set header "Aggregated Dialed Time(HH:MM:SS)"
                set data-binding "duration"
                set column-graph-type bar
                set column-span 2
                set column-width 30
            next
            edit 4
                set data-binding "duration"
                set column-attr timespan
            next
            edit 5
                set header "Aggregated Bytes"
                set column-span 2
                set column-graph-type bar
                set data-binding "bandwidth"
                set column-width 30
            next
            edit 6
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "vpn-User-Login-history"
        set disp-name "VPN Logins"
        set category "Event"
        set description "List of VPN user logins"
        set dataset "vpn-User-Login-history"
        set chart-type line
        config table-columns
            edit 1
                set header "Date"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "total_num"
                set column-graph-type line-up
                set legend "Users"
            next
        end
        set protected enable
    next
    edit "vpn-Failed-Login-Atempts"
        set category "Event"
        set disp-name "Top Failed VPN Logins"
        set description "Top 10 failed VPN login attempts"
        set dataset "vpn-Failed-Logins"
        set chart-type table
        config table-columns
            edit 1
                set header "user"
                set data-binding "f_user"
                set column-attr user
                set data-top 10
                set column-width 30
            next
            edit 2
                set header "Type"
                set data-binding "tunneltype"
                set column-width 30
            next
            edit 3
                set header "Total Number of Failed Attempts"
                set data-binding "total_num"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 4
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "vpn-Traffic-Usage-Trend-VPN-Summary"
        set disp-name "VPN Traffic Usage Trend"
        set category "Event"
        set description "Bandwidth usage trend for VPN traffic"
        set dataset "vpn-Traffic-Usage-Trend-VPN"
        set chart-type line
        config table-columns
            edit 1
                set header "Date"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "ssl_bandwidth"
                set column-graph-type line-up
                set column-attr bandwidth
                set legend "SSL"
            next
            edit 3
                set data-binding "ipsec_bandwidth"
                set column-graph-type line-up
                set column-attr bandwidth
                set legend "IPSEC"
            next
        end
        set protected enable
    next
    edit "Top-S2S-IPSEC-Tunnels-By-Bandwidth-and-Availability"
        set category "Event"
        set disp-name "Top Site-to-Site IPsec Tunnels by Bandwidth and Availability"
        set description "Top 10 Site-to-Site IPsec tunnels by bandwidth usage and availability"
        set dataset "vpn-Top-S2S-IPSEC-Tunnels-By-Bandwidth-and-Avail"
        set chart-type table
        config table-columns
            edit 1
                set header "Tunnel"
                set data-binding "vpntunnel"
                set data-top 10
                set column-width 30
            next
            edit 2
                set header "Tunnel Uptime(hh:mm:ss)"
                set data-binding "uptime"
                set column-attr timespan
                set column-width 30
            next
            edit 3
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 40
            next
            edit 4
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 5
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "Top-Dialup-IPSEC-By-Bandwidth-and-Availability"
        set category "Event"
        set disp-name "Top Dial-up IPsec Users by Bandwidth and Availability"
        set description "Top 10 users of dial-up IPsec VPN tunnel by bandwidth usage and availability"
        set dataset "vpn-Top-Dialup-IPSEC-Users-By-Bandwidth-and-Avail"
        set chart-type table
        config table-columns
            edit 1
                set header "User"
                set data-binding "user_src"
                set data-top 10
                set column-width 20
            next
            edit 2
                set header "IP"
                set data-binding "remip"
                set column-width 20
            next
            edit 3
                set header "Connection Time(hh:mm:ss)"
                set data-binding "uptime"
                set column-attr timespan
                set column-width 20
            next
            edit 4
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 40
            next
            edit 5
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 6
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "Top-SSL-Tunnel-Mode-By-Bandwidth-and-Availability"
        set category "Event"
        set disp-name "Top SSL Tunnel Users by Bandwidth and Availability"
        set description "Top 10 users of SSL VPN tunnel by bandwidth usage and availability"
        set dataset "vpn-Top-SSL-Tunnel-Users-By-Bandwidth-and-Avail"
        set chart-type table
        config table-columns
            edit 1
                set header "User"
                set data-binding "user_src"
                set data-top 10
                set column-width 20
            next
            edit 2
                set header "IP"
                set data-binding "remote_ip"
                set column-width 20
            next
            edit 3
                set header "Connection Time(hh:mm:ss)"
                set data-binding "uptime"
                set column-attr timespan
                set column-width 20
            next
            edit 4
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 40
            next
            edit 5
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 6
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "Top-SSL-Web-Mode-By-Bandwidth-and-Availability"
        set category "Event"
        set disp-name "Top SSL Web Portal Users by Bandwidth and Availability"
        set description "Top 10 users of SSL web portal by bandwidth usage and availability"
        set dataset "vpn-Top-SSL-Web-Users-By-Bandwidth-and-Avail"
        set chart-type table
        config table-columns
            edit 1
                set header "User"
                set data-binding "user_src"
                set data-top 10
                set column-width 20
            next
            edit 2
                set header "IP"
                set data-binding "remote_ip"
                set column-width 20
            next
            edit 3
                set header "Connection Time(hh:mm:ss)"
                set data-binding "uptime"
                set column-attr timespan
                set column-width 20
            next
            edit 4
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 40
            next
            edit 5
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 6
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next

    edit "Admin-Login-Summary"
        set disp-name "Top 20 Admin Login Summary"
        set category "Event"
        set description "Top 20 login summary of administrator"
        set dataset "event-Admin-Login-Summary"
        set chart-type table
        config table-columns
            edit 1
                set header "User Name"
                set data-binding "f_user"
                set data-top 20
                set column-width 15
            next
            edit 2
                set header "Login Interface"
                set data-binding "ui"
                set column-width 15
            next
            edit 3
                set header "Total Number of Logins"
                set data-binding "total_num"
                set column-graph-type bar
                set column-span 2
                set column-width 25
            next
            edit 4
                set data-binding "total_num"
                set column-attr count
            next
            edit 5
                set header "Total Number of Configuration Changes"
                set data-binding "total_change"
                set column-graph-type bar
                set column-span 2
                set column-width 25
            next
            edit 6
                set data-binding "total_change"
                set column-attr count
            next
            edit 7
                set header "Total Duration (hh:mm:ss)"
                set data-binding "total_duration"
                set column-attr timespan
                set column-width 20
            next
        end
        set protected enable
    next

    edit "Admin-Login-Summary-By-Date"
        set disp-name "Admin Login Summary by Date"
        set category "Event"
        set description "Administrator login summary by date"
        set dataset "event-Admin-Login-Summary-By-Date"
        set chart-type line
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "dom"
                set column-attr time
                set data-top 7
            next
            edit 2
                set data-binding "total_num"
                set column-graph-type line-up
                set legend "# Logins"
            next
            edit 3
                set data-binding "total_change"
                set column-graph-type line-up
                set legend "# Config Changes"
            next
        end
        set protected enable
    next

    edit "Admin-Failed-Login-Summary"
        set disp-name "Top 20 Failed Admin Logins"
        set category "Event"
        set description "Top 20 failed logins of administrator"
        set dataset "event-Admin-Failed-Login-Summary"
        set chart-type table
        config table-columns
            edit 1
                set header "Login Source"
                set data-binding "ui"
                set data-top 20
                set column-width 30
            next
            edit 2
                set header "User Name"
                set data-binding "f_user"
                set column-width 30
            next
            edit 3
                set header "Total Number of Failed Logins"
                set data-binding "total_failed"
                set column-graph-type bar
                set column-span 2
                set column-width 40
            next
            edit 4
                set data-binding "total_failed"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "System-Summary-By-Severity"
        set disp-name "Top 5 System Events by Severity"
        set category "Event"
        set description "Top 5 system events summary by severity"
        set dataset "event-System-Summary-By-Severity"
        set chart-type pie
        config table-columns
            edit 1
                set header "Severity"
                set data-binding "severity"
                set data-top 5
            next
            edit 2
                set header "Total Number"
                set data-type aggregate
                set data-binding "total_num"
                set column-attr none
            next
        end
        set protected enable
    next

    edit "System-Summary-By-Date"
        set disp-name "System Events Summary by Date"
        set category "Event"
        set description "System events summary by date"
        set dataset "event-System-Summary-By-Date"
        set chart-type line
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "dom"
                set column-attr time
                set data-top 7
            next
            edit 2
                set data-binding "critical"
                set column-graph-type line-up
                set legend "Critical"
            next
            edit 3
                set data-binding "high"
                set column-graph-type line-up
                set legend "High"
            next
            edit 4
                set data-binding "medium"
                set column-graph-type line-up
                set legend "Medium"
            next
        end
        set protected enable
    next

    edit "Important-System-Summary-By-Date"
        set disp-name "Critical High and Medium Events by Date"
        set category "Event"
        set description "Critical high and medium events by date"
        set dataset "event-System-Summary-By-Date"
        set chart-type line
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "dom"
                set column-attr time
                set data-top 7
            next
            edit 2
                set data-binding "critical"
                set column-graph-type line-up
                set legend "Critical"
            next
            edit 3
                set data-binding "high"
                set column-graph-type line-up
                set legend "High"
            next
            edit 4
                set data-binding "medium"
                set column-graph-type line-up
                set legend "Medium"
            next
        end
        set protected enable
    next

    edit "System-Critical-Severity-Events"
        set disp-name "Top 100 Critical Severity System Events"
        set category "Event"
        set description "Top 100 critical severity system events"
        set dataset "event-System-Critical-Severity-Events"
        set chart-type table
        config table-columns
            edit 1
                set header "Event Name (Description)"
                set data-binding "msg"
                set data-top 100
                set column-width 30
            next
            edit 2
                set header "Level"
                set data-binding "severity"
                set column-width 30
            next
            edit 3
                set header "Counts"
                set data-binding "counts"
                set column-graph-type bar
                set column-span 2
                set column-width 40
            next
            edit 4
                set data-binding "counts"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "System-High-Severity-Events"
        set disp-name "Top 100 High Severity System Events"
        set category "Event"
        set description "Top 100 high severity system events"
        set dataset "event-System-High-Severity-Events"
        set chart-type table
        config table-columns
            edit 1
                set header "Event Name (Description)"
                set data-binding "msg"
                set data-top 100
                set column-width 30
            next
            edit 2
                set header "Level"
                set data-binding "severity"
                set column-width 30
            next
            edit 3
                set header "Counts"
                set data-binding "counts"
                set column-graph-type bar
                set column-span 2
                set column-width 40
            next
            edit 4
                set data-binding "counts"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "System-Medium-Severity-Events"
        set disp-name "Top 100 Medium Severity System Events"
        set category "Event"
        set description "Top 100 medium severity system events"
        set dataset "event-System-Medium-Severity-Events"
        set chart-type table
        config table-columns
            edit 1
                set header "Event Name (Description)"
                set data-binding "msg"
                set data-top 100
                set column-width 30
            next
            edit 2
                set header "Level"
                set data-binding "severity"
                set column-width 30
            next
            edit 3
                set header "Counts"
                set data-binding "counts"
                set column-graph-type bar
                set column-span 2
                set column-width 40
            next
            edit 4
                set data-binding "counts"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "utm-drilldown-Top-Traffic-Summary"
        set disp-name "UTM Drilldown No.1 Traffic Summary"
        set category "Network Usage"
        set description "UTM drilldown number 1 traffic summary"
        set hidden enable
        set dataset "utm-drilldown-Traffic-Summary"
        set chart-type table
        config table-columns
            edit 1
                set header "Source IP"
                set data-binding "srcip"
                set data-top 1
            next
            edit 2
                set header "Source Name"
                set data-binding "srcname"
            next

        end
        set protected enable
    next
    edit "utm-drilldown-Top-User-Destination"
        set disp-name "UTM Drilldown Top 10 User Destination"
        set category "Network Usage"
        set description "UTM drilldown top 10 user destinations"
        set hidden enable
        set dataset "utm-drilldown-Top-User-Destination"
        set chart-type table
        config table-columns
            edit 1
                set header "Destination"
                set data-binding "appid"
                set column-attr app-id
                set column-span 2
                set data-top 10
            next
            edit 2
                set data-binding "dstip"
            next
            edit 3
                set header "Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
            edit 4
                set header "Application"
                set data-binding "app"
            next
        end
        set protected enable
    next
    edit "utm-drilldown-Email-Senders-Summary"
        set disp-name "UTM Drilldown Email Senders Summary"
        set category "Email"
        set description "UTM drilldown email senders summary"
        set hidden enable
        set dataset "utm-drilldown-Email-Senders-Summary"
        set chart-type table
        config table-columns
            edit 1
                set header "Requests"
                set data-binding "requests"
            next
            edit 2
                set header "Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "utm-drilldown-Email-Receivers-Summary"
        set disp-name "UTM Drilldown Email Receivers Summary"
        set category "Email"
        set description "UTM drilldown email receivers summary"
        set hidden enable
        set dataset "utm-drilldown-Email-Receivers-Summary"
        set chart-type table
        config table-columns
            edit 1
                set header "Requests"
                set data-binding "requests"
            next
            edit 2
                set header "Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "utm-drilldown-Top-Email-Recipients-By-Bandwidth"
        set disp-name "UTM Drilldown Top 5 Email Recipients by Bandwidth"
        set category "Email"
        set description "UTM drilldown top 5 email recipients by bandwidth"
        set hidden enable
        set dataset "utm-drilldown-Top-Email-Recipients"
        set chart-type table
        config table-columns
            edit 1
                set header "Recipient"
                set data-binding "recipient"
                set data-top 5
            next
            edit 2
                set header "Bytes"
                set data-binding "bandwidth"
                set column-span 2
                set column-graph-type bar
            next
            edit 3
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "utm-drilldown-Top-Email-Senders-By-Bandwidth"
        set disp-name "UTM Drilldown Top 5 Email Senders by Bandwidth"
        set category "Email"
        set description "UTM drilldown top 5 email senders by bandwidth"
        set hidden enable
        set dataset "utm-drilldown-Top-Email-Senders"
        set chart-type table
        config table-columns
            edit 1
                set header "Sender"
                set data-binding "sender"
                set data-top 5
            next
            edit 2
                set header "Bytes"
                set data-binding "bandwidth"
                set column-span 2
                set column-graph-type bar
            next
            edit 3
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "utm-drilldown-Top-Allowed-Websites-By-Bandwidth"
        set disp-name "UTM Drilldown Top Allowed Websites by Bandwidth"
        set category "Web"
        set description "UTM drilldown top 10 allowed sites by bandwidth"
        set hidden enable
        set dataset "utm-drilldown-Top-Allowed-Web-Sites-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Website"
                set data-binding "appid"
                set column-attr app-id
                set column-span 2
                set data-top 10
            next
            edit 2
                set data-binding "hostname"
            next
            edit 3
                set header "Bytes"
                set data-binding "bandwidth"
                set column-graph-type bar
            next
            edit 4
                set header " "
                set data-binding "bandwidth"
            next
        end
        set protected enable
    next
    edit "utm-drilldown-Top-Blocked-Websites-By-Request"
        set disp-name "UTM Drilldown Top Blocked Websites by Requests"
        set category "Web"
        set description "UTM drilldown top 10 blocked sites by request"
        set hidden enable
        set dataset "utm-drilldown-Top-Blocked-Web-Sites-By-Request"
        set chart-type table
        config table-columns
            edit 1
                set header "Website"
                set data-binding "appid"
                set column-attr app-id
                set column-span 2
                set data-top 10
            next
            edit 2
                set data-binding "hostname"
            next
            edit 3
                set header "Requests"
                set data-binding "requests"
                set column-graph-type bar
            next
            edit 4
                set header " "
                set data-binding "requests"
            next
        end
        set protected enable
    next
    edit "utm-drilldown-Top-Virus-By-Name"
        set disp-name "UTM Drilldown Top 20 Virus by Name"
        set category "Threat"
        set description "UTM drilldown top 20 viruses by name"
        set hidden enable
        set dataset "utm-drilldown-Top-Virus"
        set chart-type table
        config table-columns
            edit 1
                set header "Virus Name"
                set data-binding "virus"
                set column-attr url
                set data-top 20
            next
            edit 2
                set header "Counts"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
            next
            edit 3
                set data-binding "totalnum"
            next
        end
        set protected enable
    next
    edit "utm-drilldown-Top-Attacks"
        set disp-name "UTM Drilldown Top 20 Attacks"
        set category "Threat"
        set description "UTM drilldown top 20 attacks by name"
        set hidden enable
        set dataset "utm-drilldown-Top-Attacks-By-Name"
        set chart-type table
        config table-columns
            edit 1
                set header "Attack Name"
                set data-binding "attack"
                set column-attr url
                set data-top 20
            next
            edit 2
                set header "Counts"
                set data-binding "attack_count"
                set column-span 2
                set column-graph-type bar
            next
            edit 3
                set data-binding "attack_count"
            next
        end
        set protected enable
    next
    edit "utm-drilldown-Top-Vulnerability"
        set disp-name "UTM Drilldown Top 20 Vulnerability"
        set category "Other"
        set description "Top 20 vulnerabilities by name"
        set hidden enable
        set dataset "utm-drilldown-Top-Vulnerability-By-Name"
        set chart-type table
        config table-columns
            edit 1
                set header "Vulnerability"
                set data-binding "vuln"
                set column-attr url
                set data-top 20
            next
            edit 2
                set header "Counts"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
            next
            edit 3
                set data-binding "totalnum"
            next
        end
        set protected enable
    next
    edit "utm-drilldown-Top-App-By-Bandwidth"
        set disp-name "UTM Drilldown Top 5 Applications by Bandwidth"
        set category "Application"
        set description "UTM drilldown top 5 applications by bandwidth"
        set hidden enable
        set dataset "utm-drilldown-Top-App-By-Bandwidth"
        set chart-type pie
        config table-columns
            edit 1
                set header "Application"
                set data-binding "appid"
                set column-attr app-id
                set column-span 2
                set data-top 5
            next
            edit 2
                set data-binding "app"
            next
            edit 3
                set header "Bytes"
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "utm-drilldown-Top-App-By-Sessions"
        set disp-name "UTM Drilldown Top 5 Applications by Sessions"
        set category "Application"
        set description "UTM drilldown top 5 applications by sessions"
        set hidden enable
        set dataset "utm-drilldown-Top-App-By-Sessions"
        set chart-type pie
        config table-columns
            edit 1
                set header "Application"
                set data-binding "appid"
                set column-attr app-id
                set column-span 2
                set data-top 5
            next
            edit 2
                set data-binding "app"
            next
            edit 3
                set header "Sessions"
                set data-type aggregate
                set data-binding "sessions"
                set column-attr none
            next
        end
        set protected enable
    next

    edit "Top5-Users-By-Bandwidth"
        set disp-name "Top 5 Users by Bandwidth"
        set category "Network Usage"
        set description "Top 5 users by bandwidth usage"
        set dataset "utm-drilldown-Top-Users-By-Bandwidth"
        set tags "top5_users_by_bandwidth"
        set resolve-hostname-mode specify
        set resolve-hostname disable
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "dldn_user"
                set data-top 5
            next
            edit 2
                set header "Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
            edit 3
                set header "Session"
                set data-binding "session"
            next
            edit 4
                set header "Received"
                set data-binding "traffic_in"
            next
            edit 5
                set header "Sent"
                set data-binding "traffic_out"
            next
        end
        config drill-down-table
            edit 1
                set chart "utm-drilldown-Top-Traffic-Summary"
                set chart-group "Traffic Summary"
            next
            edit 2
                set chart "utm-drilldown-Top-User-Destination"
                set chart-group "Traffic Summary"
            next
            edit 3
                set chart "utm-drilldown-Email-Senders-Summary"
                set flag disable
            next
            edit 4
                set chart "utm-drilldown-Email-Receivers-Summary"
                set flag disable
            next
            edit 5
                set chart "utm-drilldown-Top-Email-Recipients-By-Bandwidth"
                set flag disable
            next
            edit 6
                set chart "utm-drilldown-Top-Email-Senders-By-Bandwidth"
                set flag disable
            next
            edit 7
                set chart "utm-drilldown-Top-Allowed-Websites-By-Bandwidth"
                set chart-group "Web Summary"
            next
            edit 8
                set chart "utm-drilldown-Top-Blocked-Websites-By-Request"
                set flag disable
            next
            edit 9
                set chart "utm-drilldown-Top-Virus-By-Name"
                set chart-group "Threat Summary"
            next
            edit 10
                set chart "utm-drilldown-Top-Attacks"
                set chart-group "Threat Summary"
            next
            edit 11
                set chart "utm-drilldown-Top-Vulnerability"
                set chart-group "Threat Summary"
            next
            edit 15
                set chart "utm-drilldown-Top-App-By-Bandwidth"
                set chart-group "Application Summary"
            next
            edit 16
                set chart "utm-drilldown-Top-App-By-Sessions"
                set chart-group "Application Summary"
            next
        end
        set protected enable
    next
    edit "bandwidth-app-Top-App-By-Bandwidth-Sessions"
        set disp-name "Top 30 Applications by Bandwidth and Sessions"
        set category "Application"
        set description "Top 30 applications by bandwidth usage and session count"
        set dataset "Top-App-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Application"
                set data-binding "app_group"
                set data-top 30
                set column-width 30
            next
            edit 2
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 40
            next
            edit 3
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 4
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
            edit 5
                set header "Sessions"
                set data-binding "sessions"
                set column-span 2
                set column-graph-type bar
                set column-width 30
            next
            edit 6
                set data-binding "sessions"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "bandwidth-app-Category-By-Bandwidth"
        set disp-name "Top Application Categories by Bandwidth"
        set category "Application"
        set description "Top 10 application categories by bandwidth usage"
        set dataset "App-Risk-App-Usage-By-Category"
        set chart-type table
        config table-columns
            edit 1
                set header "Application Category"
                set data-binding "appcat"
                set column-attr appcat
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Bytes"
                set data-binding "bandwidth"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "bandwidth-app-Top-Users-By-Bandwidth-Sessions"
        set disp-name "Top 30 Users by Bandwidth and Sessions"
        set category "Network Usage"
        set description "Top 30 users by bandwidth usage and session count"
        set dataset "bandwidth-app-Top-Users-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "User(or IP)"
                set data-binding "user_src"
                set column-attr user
                set data-top 30
                set column-width 30
            next
            edit 2
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 40
            next
            edit 3
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 4
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
            edit 5
                set header "Sessions"
                set data-binding "sessions"
                set column-span 2
                set column-graph-type bar
                set column-width 30
            next
            edit 6
                set data-binding "sessions"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "bandwidth-app-Traffic-By-Active-User-Number"
        set disp-name "Active Traffic Users"
        set category "Network Usage"
        set description "List of active traffic users"
        set dataset "bandwidth-app-Traffic-By-Active-User-Number"
        set chart-type area
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "total_user"
                set column-graph-type line-up
                set legend "Active Users"
            next
        end
        set protected enable
    next
    edit "bandwidth-app-Top-Dest-By-Bandwidth-Sessions"
        set disp-name "Top 30 Destinations by Bandwidth and Sessions"
        set category "Application"
        set description "Top 30 destinations by bandwidth usage and session count"
        set dataset "bandwidth-app-Top-Dest-By-Bandwidth-Sessions"
        set chart-type table
        config table-columns
            edit 1
                set header "Hostname(or IP)"
                set data-binding "dst"
                set data-top 30
                set column-width 30
            next
            edit 2
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 40
            next
            edit 3
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 4
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
            edit 5
                set header "Sessions"
                set data-binding "sessions"
                set column-span 2
                set column-graph-type bar
                set column-width 30
            next
            edit 6
                set data-binding "sessions"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "bandwidth-app-Top-Policies-By-Bandwidth-Sessions"
        set disp-name "Top 30 Policies by Bandwidth and Sessions"
        set category "Application"
        set description "Top 30 policies by bandwidth usage and sessions"
        set dataset "bandwidth-app-Top-Policies-By-Bandwidth-Sessions"
        set chart-type table
        config table-columns
            edit 1
                set header "Policy ID"
                set data-binding "polid"
                set data-top 30
                set column-width 30
            next
            edit 2
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 40
            next
            edit 3
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 4
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
            edit 5
                set header "Sessions"
                set data-binding "sessions"
                set column-span 2
                set column-graph-type bar
                set column-width 30
            next
            edit 6
                set data-binding "sessions"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "bandwidth-app-Traffic-Statistics"
        set disp-name "Traffic Statistics"
        set category "Application"
        set description "Top 10 traffic statistics summary"
        set dataset "bandwidth-app-Traffic-Statistics"
        set chart-type table
        config table-columns
            edit 1
                set header "Summary"
                set data-binding "summary"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Statistics"
                set data-binding "stats"
                set column-width 60
            next
        end
        set protected enable
    next
    edit "bandwidth-app-Bandwidth-Usage-Summary"
        set disp-name "Traffic Usage Timeline (App)"
        set category "Application"
        set description "Traffic Usage Timeline (App)"
        set dataset "bandwidth-app-Bandwidth-Usage-Timeline"
        set chart-type area
        set chart-style "{\"legend-position\":\"bottom\"}"
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "traffic_out"
                set column-graph-type line-up
                set column-attr bandwidth
                set legend "Sent"
            next
            edit 3
                set data-binding "traffic_in"
                set column-graph-type line-up
                set column-attr bandwidth
                set legend "Received"
            next
        end
        set protected enable
    next
    edit "bandwidth-app-Sessions-Summary"
        set disp-name "Traffic Session Timeline (App)"
        set category "Application"
        set description "Traffic Session Timeline (App)"
        set dataset "number-of-session-timeline"
        set chart-type line
        set chart-style "{\"legend-position\":\"top\"}"
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "sessions"
                set column-graph-type line-up
                set column-attr count
                set legend "Number of sessions"
            next
        end
        set protected enable
    next
    edit "bandwidth-app-Top-App-Bandwidth-Usage"
        set disp-name "Top Applications by Bandwidth and Sessions"
        set category "Application"
        set description "Top 15 Applications by Bandwidth Usage and Session Count"
        set dataset "bandwidth-app-Top-App-Bandwidth-Usage"
        set chart-type table
        config table-columns
            edit 1
                set header "Application"
                set data-binding "app"
                set data-top 15
                set column-width 22
            next
            edit 2
                set header "Category"
                set data-binding "appcat"
                set column-attr appcat
                set column-width 20
            next
            edit 3
                set header "User"
                set data-binding "num_user"
                set column-attr count
                set column-width 13
            next
            edit 4
                set header "Session"
                set data-binding "sessions"
                set column-attr count
                set column-width 15
            next
            edit 5
                set header "Total Bytes"
                set data-binding "bandwidth"
                set column-span 3
                set column-attr bandwidth
                set column-style "{\"align\":\"left\",\"width\":30}"
                set column-width 30
            next
            edit 6
                set data-binding "traffic_out"
                set column-graph-type bar
                set legend "Sent"
            next
            edit 7
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next

        end
        set protected enable
    next
    edit "bandwidth-app-Top-App-Category-By-Bandwidth"
        set disp-name "Top Application Categories by Bandwidth (Bubble-ring)"
        set category "Application"
        set description "Top 10 Application Categories by Bandwidth in Bubble-ring Chart"
        set dataset "App-Risk-App-Usage-By-Category"
        set chart-type bubble-ring
        set chart-style "{\"show-value\":\"enable\" }"
        set include-other enable
        config table-columns
            edit 1
                set header "Category"
                set data-binding "appcat"
                set data-top 9
            next
            edit 2
                set header "Application"
                set data-type drilldown
                set data-binding "app"
                set data-top 4
            next
            edit 3
                set data-binding "bandwidth"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "bandwidth-app-Active-User-Count-Timeline"
        set disp-name "Active Traffic User Count Timeline"
        set category "Application"
        set description "Active Traffic User Count Timeline"
        set dataset "bandwidth-app-Traffic-By-Active-User-Number"
        set chart-type line
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "total_user"
                set column-graph-type line-up
                set column-attr count
            next
        end
        set protected enable
    next
    edit "bandwidth-app-Top-Dest-By-Bandwidth"
        set disp-name "Top Destinations by Bandwidth (Donut)"
        set category "Application"
        set description "Top 10 Destinations by Bandwidth in Donut Chart"
        set dataset "bandwidth-app-Top-Dest-By-Bandwidth-Sessions"
        set chart-type donut
        set chart-style "{\"legend-format\":\"${name}: ${val}\", \"legend-font-size\": \"9px\", \"show-header\": \"enable\", \"show-value\": \"enable\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "Destination"
                set data-binding "dst"
                set data-top 10
            next
            edit 2
                set header "Traffic"
                set data-binding "bandwidth"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "bandwidth-app-Top-Dest-By-Session"
        set disp-name "Top Destinations by Session Count"
        set category "Application"
        set description "Top 10 Destinations by Session Count"
        set dataset "bandwidth-app-Top-Dest-By-Bandwidth-Sessions"
        set chart-type donut
        set chart-style "{\"legend-format\":\"${name}: ${val}\", \"legend-font-size\": \"9px\", \"show-header\": \"enable\", \"show-value\": \"enable\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "Destination"
                set data-binding "dst"
                set data-top 10
            next
            edit 2
                set header "Sessions"
                set data-binding "sessions"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "bandwidth-app-Top-Bandwidth-Users"
        set disp-name "Top Users by Bandwidth (Donut)"
        set description "Top 10 Users by Bandwidth in Donut Chart"
        set category "Application"
        set dataset "bandwidth-app-Top-Users-By-Bandwidth"
        set chart-type donut
        set chart-style "{\"legend-columns\":\"3\", \"show-header\": \"enable\", \"legend-format\":\"${name}: ${val}\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "User"
                set data-binding "user_src"
                set data-top 10
            next
            edit 2
                set header "Traffic"
                set data-binding "bandwidth"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "bandwidth-app-Top-Session-Users"
        set disp-name "Top Users by Session Count"
        set description "Top 10 Users by Session Count"
        set category "Application"
        set dataset "bandwidth-app-Top-Users-By-Bandwidth"
        set chart-type bubble
        set chart-style "{\"legend-columns\":\"3\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "User"
                set data-binding "user_src"
                set data-top 10
            next
            edit 2
                set header "Sessions"
                set data-binding "sessions"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next

    edit "Score-Summary-For-All-Users-Devices"
        set disp-name "Threat Score Summary"
        set category "Network Usage"
        set description "Threat score summary for all users and devices"
        set dataset "reputation-Score-Summary-For-All-Users-Devices"
        set chart-type area
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
                set data-top 7
            next
            edit 2
                set data-binding "scores"
                set column-graph-type line-up
                set column-attr count
                set legend "Score Summary for All Users"
            next
        end
        set protected enable
    next
    edit "Number-Of-Incidents-For-All-Users-Devices"
        set disp-name "Threat Incident Summary"
        set category "Network Usage"
        set description "Number of incidents for all users and devices"
        set dataset "reputation-Number-Of-Incidents-For-All-Users-Devices"
        set chart-type area
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "totalnum"
                set column-graph-type line-up
                set column-attr count
                set legend "Number of Incidents"
            next
        end
        set protected enable
    next
    edit "Top-Users-By-Reputation-Scores"
        set disp-name "Top Users by Threat Scores"
        set category "Network Usage"
        set description "Top 10 users by threat scores"
        set dataset "reputation-Top-Users-By-Scores"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set column-attr user
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Scores"
                set data-binding "scores"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "scores"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Top-Devices-By-Reputation-Scores"
        set disp-name "Top Devices by Threat Scores"
        set category "Network Usage"
        set description "Top 10 devices by threat scores"
        set dataset "reputation-Top-Devices-By-Scores"
        set chart-type table
        config table-columns
            edit 1
                set header "Device"
                set data-binding "devtype_new"
                set column-attr dev-type
                set column-span 2
                set data-top 10
                set column-width 40
            next
            edit 2
                set data-binding "dev_src"
            next
            edit 3
                set header "Scores"
                set data-binding "scores"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 4
                set data-binding "scores"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Top-Users-With-Increased-Scores"
        set disp-name "Top Users by Increased Threat Scores"
        set category "Network Usage"
        set description "Top 10 users by increased threat scores for last 2 periods"
        set dataset "reputation-Top-Users-With-Increased-Scores"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "f_user"
                set column-attr user
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Increased Scores"
                set data-binding "t1_sum_score"
                set column-span 3
                set column-graph-type bar
                set legend "${PRE_PERIOD}"
                set column-width 60
            next
            edit 3
                set data-binding "t2_sum_score"
                set column-graph-type bar
                set legend "${CUR_PERIOD}"
            next
            edit 4
                set data-binding "delta"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Top-Devices-With-Increased-Scores"
        set disp-name "Top Devices by Increased Threat Scores"
        set category "Network Usage"
        set description "Top 10 devices by increased threat scores for last two periods"
        set dataset "reputation-Top-Devices-With-Increased-Scores"
        set chart-type table
        config table-columns
            edit 1
                set header "Device"
                set data-binding "devtype_new"
                set column-attr dev-type
                set column-span 2
                set data-top 10
                set column-width 40
            next
            edit 2
                set data-binding "f_device"
            next
            edit 3
                set header "Increased Scores"
                set data-binding "t1_sum_score"
                set column-span 3
                set column-graph-type bar
                set legend "${PRE_PERIOD}"
                set column-width 60
            next
            edit 4
                set data-binding "t2_sum_score"
                set column-graph-type bar
                set legend "${CUR_PERIOD}"
            next
            edit 5
                set data-binding "delta"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "Attacks-By-Severity"
        set disp-name "Top 5 Attacks by Severity"
        set category "Threat"
        set description "Top 5 attacks by severity"
        set dataset "threat-Attacks-By-Severity"
        set chart-type pie
        config table-columns
            edit 1
                set header "Severity"
                set data-binding "severity"
                set data-top 5
            next
            edit 2
                set header "Total Number"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr none
            next
        end
        set protected enable
    next
    edit "Top-Attacks-Detected"
        set disp-name "Top Attacks"
        set category "Threat"
        set description "Top 10 intrusions"
        set dataset "threat-Top-Attacks-Detected"
        set chart-type table
        config table-columns
            edit 1
                set header "Attack Name"
                set data-binding "attackid"
                set column-attr url
                set data-top 10
                set column-span 2
                set column-width 25
            next
            edit 2
                set data-binding "attack"
                set column-attr attack
            next
            edit 3
                set header "Severity"
                set data-binding "severity"
                set data-top 10
                set column-width 20
            next
            edit 4
                set header "CVE-ID"
                set data-binding "cve"
                set column-width 20
            next
            edit 5
                set header "Counts"
                set data-binding "attack_count"
                set column-span 2
                set column-graph-type bar
                set column-width 35
            next
            edit 6
                set data-binding "attack_count"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Top-Attacks-Blocked"
        set disp-name "Top Blocked Attacks"
        set category "Threat"
        set description "Top 10 blocked intrusions"
        set dataset "threat-Top-Attacks-Blocked"
        set chart-type table
        config table-columns
            edit 1
                set header "Attack Name"
                set data-binding "attack"
                set column-attr url
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Counts"
                set data-binding "attack_count"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "attack_count"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Top-Virus-Source"
        set disp-name "Top Malware Sources"
        set category "Threat"
        set description "Top 10 malware sources by host name or IP address"
        set dataset "threat-Top-Virus-Source"
        set chart-type table
        config table-columns
            edit 1
                set header "Malware Source"
                set data-binding "source"
                set data-top 0
                set column-width 30
            next
            edit 2
                set header "Hostname (or IP)"
                set data-binding "hostname"
                set data-top 10
                set column-width 30
            next
            edit 3
                set header "Counts"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 4
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Intrusion-in-Last-7-Days"
        set disp-name "Attack Summary"
        set category "Threat"
        set description "Intrusion events summary"
        set dataset "threat-Intrusion-Timeline"
        set chart-type area
        config table-columns
            edit 1
                set header "Date"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "totalnum"
                set column-graph-type line-up
                set column-attr count
                set legend "Counts"
            next
        end
        set protected enable
    next
    edit "Virus-Time-Line"
        set disp-name "Virus Timeline"
        set category "Threat"
        set description "Virus timeline"
        set dataset "threat-Virus-Timeline"
        set chart-type bar
        set order-by "hodex"
        config table-columns
            edit 1
                set header "Date"
                set data-binding "hodex"
                set column-attr none
                set data-top 744
            next
            edit 2
                set data-binding "totalnum"
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "Top-Spyware-Victims"
        set disp-name "Top Spyware Victims"
        set category "Threat"
        set description "Top 10 spyware victims"
        set dataset "threat-Top-Spyware-Victims"
        set chart-type table
        config table-columns
            edit 1
                set header "Spyware Victims"
                set data-binding "user_src"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Occurrences"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Top-Spyware-by-Name"
        set disp-name "Top Spyware"
        set category "Threat"
        set description "Top 10 spyware"
        set dataset "threat-Top-Spyware-by-Name"
        set chart-type table
        config table-columns
            edit 1
                set header "Spyware Name"
                set data-binding "virusid"
                set column-attr url
                set data-top 10
                set column-span 2
                set column-width 40
            next
            edit 2
                set data-binding "virus"
                set column-attr virus
            next
            edit 3
                set header "Occurrences"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 4
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Top-Spyware-Source"
        set disp-name "Top Spyware Sources"
        set category "Threat"
        set description "Top 10 spyware sources"
        set dataset "threat-Top-Spyware-Source"
        set chart-type table
        config table-columns
            edit 1
                set header "IP"
                set data-binding "srcip"
                set data-top 10
                set column-width 30
            next
            edit 2
                set header "Hostname (or IP)"
                set data-binding "hostname"
                set data-top 10
                set column-width 30
            next
            edit 3
                set header "Counts"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 4
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Spyware-Time-Line"
        set disp-name "Spyware Timeline"
        set category "Threat"
        set description "Spyware timeline"
        set dataset "threat-Spyware-Timeline"
        set chart-type area
        config table-columns
            edit 1
                set header "Date"
                set data-binding "hodex"
                set column-attr time
                set data-top 744
            next
            edit 2
                set data-binding "totalnum"
                set column-graph-type line-up
                set column-attr count
                set legend "Counts"
            next
        end
        set protected enable
    next
    edit "Top-Adware-Victims"
        set disp-name "Top Adware Victims"
        set category "Threat"
        set description "Top 10 adware victims"
        set dataset "threat-Top-Adware-Victims"
        set chart-type table
        config table-columns
            edit 1
                set header "Adware Victims"
                set data-binding "user_src"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Occurrences"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Top-Adware-by-Name"
        set disp-name "Top Adware"
        set category "Threat"
        set description "Top 10 adware"
        set dataset "threat-Top-Adware-by-Name"
        set chart-type table
        config table-columns
            edit 1
                set header "Adware Name"
                set data-binding "virusid"
                set column-attr url
                set data-top 10
                set column-span 2
                set column-width 40
            next
            edit 2
                set data-binding "virus"
                set column-attr virus
            next
            edit 3
                set header "Occurrences"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 4
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Top-Adware-Source"
        set disp-name "Top Adware Sources"
        set category "Threat"
        set description "Top 10 adware sources"
        set dataset "threat-Top-Adware-Source"
        set chart-type table
        config table-columns
            edit 1
                set header "IP"
                set data-binding "srcip"
                set data-top 10
                set column-width 30
            next
            edit 2
                set header "Hostname (or IP)"
                set data-binding "hostname"
                set data-top 10
                set column-width 30
            next
            edit 3
                set header "Counts"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 4
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Adware-Time-Line"
        set disp-name "Adware Timeline"
        set category "Threat"
        set description "Adware timeline"
        set dataset "threat-Adware-Timeline"
        set chart-type area
        config table-columns
            edit 1
                set header "Date"
                set data-binding "hodex"
                set column-attr time
                set data-top 744
            next
            edit 2
                set data-binding "totalnum"
                set column-graph-type line-up
                set column-attr count
                set legend "Counts"
            next
        end
        set protected enable
    next

    edit "Intrusions-Timeline-By-Severity"
        set disp-name "Intrusions Timeline"
        set category "Threat"
        set description "Intrusions timeline by severity"
        set dataset "threat-Intrusions-Timeline-By-Severity"
        set chart-type line
        config table-columns
            edit 1
                set header "Date"
                set data-binding "timescale"
                set column-attr time
                set data-top 744
            next
            edit 2
                set data-binding "critical"
                set column-graph-type line-up
                set legend "Critical"
            next
            edit 3
                set data-binding "high"
                set column-graph-type line-up
                set legend "High"
            next
            edit 4
                set data-binding "medium"
                set column-graph-type line-up
                set legend "Medium"
            next
            edit 5
                set data-binding "low"
                set column-graph-type line-up
                set legend "Low"
            next
            edit 6
                set data-binding "info"
                set column-graph-type line-up
                set legend "Info"
            next
        end
        set protected enable
    next

    edit "Important-Intrusions-Timeline-By-Severity"
        set disp-name "Critical High and Medium Intrusions Timeline"
        set category "Threat"
        set description "Critical high and medium intrusions timeline by severity"
        set dataset "threat-Intrusions-Timeline-By-Severity"
        set chart-type line
        config table-columns
            edit 1
                set header "Date"
                set data-binding "timescale"
                set column-attr time
                set data-top 744
            next
            edit 2
                set data-binding "critical"
                set column-graph-type line-up
                set legend "Critical"
            next
            edit 3
                set data-binding "high"
                set column-graph-type line-up
                set legend "High"
            next
            edit 4
                set data-binding "medium"
                set column-graph-type line-up
                set legend "Medium"
            next
        end
        set protected enable
    next

    edit "Top-Intrusions-By-Types"
        set disp-name "Top 20 Intrusions by Types"
        set category "Threat"
        set description "Top 20 intrusions by types"
        set dataset "threat-Top-Intrusions-By-Types"
        set chart-type table
        config table-columns
            edit 1
                set header "Intrusion Type"
                set data-binding "vuln_type"
                set data-top 20
                set column-width 40
            next
            edit 2
                set header "Counts"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "Critical-Severity-Intrusions"
        set disp-name "Top 20 Critical Severity Intrusions"
        set category "Threat"
        set description "Top 20 critical severity intrusions"
        set dataset "threat-Critical-Severity-Intrusions"
        set chart-type table
        config table-columns
            edit 1
                set header "Attack Name"
                set data-binding "attackid"
                set column-attr url
                set data-top 20
                set column-span 2
                set column-width 25
            next
            edit 2
                set data-binding "attack"
                set column-attr attack
            next
            edit 3
                set header "CVE-ID"
                set data-binding "cve"
                set column-width 25
            next
            edit 4
                set header "Intrusion Type"
                set data-binding "vuln_type"
            next
            edit 5
                set header "Counts"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
            next
            edit 6
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "High-Severity-Intrusions"
        set disp-name "Top 20 High Severity Intrusions"
        set category "Threat"
        set description "Top 20 high severity intrusions"
        set dataset "threat-High-Severity-Intrusions"
        set chart-type table
        config table-columns
            edit 1
                set header "Attack Name"
                set data-binding "attackid"
                set column-attr url
                set data-top 20
                set column-span 2
                set column-width 25
            next
            edit 2
                set data-binding "attack"
                set column-attr attack
            next
            edit 3
                set header "CVE-ID"
                set data-binding "cve"
                set column-width 25
            next
            edit 4
                set header "Intrusion Type"
                set data-binding "vuln_type"
            next
            edit 5
                set header "Counts"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
            next
            edit 6
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "Medium-Severity-Intrusions"
        set disp-name "Top 20 Medium Severity Intrusions"
        set category "Threat"
        set description "Top 20 medium severity intrusions"
        set dataset "threat-Medium-Severity-Intrusions"
        set chart-type table
        config table-columns
            edit 1
                set header "Attack Name"
                set data-binding "attack"
                set column-attr url
                set data-top 20
                set column-width 25
            next
            edit 2
                set header "CVE-ID"
                set data-binding "cve"
                set column-width 25
            next
            edit 3
                set header "Intrusion Type"
                set data-binding "vuln_type"
            next
            edit 4
                set header "Counts"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
            next
            edit 5
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "Top-Intrusion-Victims"
        set disp-name "Top 20 Intrusion Victims"
        set category "Threat"
        set description "Top 20 intrusion victims"
        set dataset "threat-Top-Intrusion-Victims"
        set chart-type table
        config table-columns
            edit 1
                set header "Attack Victim"
                set data-binding "victim"
                set data-top 20
                set column-width 30
            next
            edit 2
                set header "Counts"
                set data-binding "critical"
                set column-span 4
                set column-graph-type bar
                set legend "Critical"
                set column-width 50
            next
            edit 3
                set data-binding "high"
                set column-graph-type bar
                set legend "High"
            next
            edit 4
                set data-binding "medium"
                set column-graph-type bar
                set legend "Medium"
            next
            edit 5
                set data-binding "totalnum"
                set column-attr count
            next
            edit 6
                set header "Percent of Total Attacks"
                set data-binding "totalnum"
                set column-attr cal-percent
                set column-width 20
            next
        end
        set protected enable
    next

    edit "Top-Intrusion-Sources"
        set disp-name "Top 20 Intrusion Sources"
        set category "Threat"
        set description "Top 20 intrusion sources"
        set dataset "threat-Top-Intrusion-Sources"
        set chart-type table
        config table-columns
            edit 1
                set header "Attack Source"
                set data-binding "source"
                set data-top 20
                set column-width 30
            next
            edit 2
                set header "Counts"
                set data-binding "critical"
                set column-span 4
                set column-graph-type bar
                set legend "Critical"
                set column-width 50
            next
            edit 3
                set data-binding "high"
                set column-graph-type bar
                set legend "High"
            next
            edit 4
                set data-binding "medium"
                set column-graph-type bar
                set legend "Medium"
            next
            edit 5
                set data-binding "totalnum"
                set column-attr count
            next
            edit 6
                set header "Percent of Total Attacks"
                set data-binding "totalnum"
                set column-attr cal-percent
                set column-width 20
            next
        end
        set protected enable
    next

    edit "Top-Blocked-Intrusions"
        set disp-name "Top 20 Blocked Intrusions"
        set category "Threat"
        set description "Top 20 blocked intrusions"
        set dataset "threat-Top-Blocked-Intrusions"
        set chart-type table
        config table-columns
            edit 1
                set header "Intrusion Name"
                set data-binding "attackid"
                set column-attr url
                set data-top 20
                set column-span 2
                set column-width 20
            next
            edit 2
                set data-binding "attack"
                set column-attr attack
            next
            edit 3
                set header "Intrusion Type"
                set data-binding "vuln_type"
                set column-width 20
            next
            edit 4
                set header "Severity"
                set data-binding "severity_name"
                set data-top 20
                set column-width 20
            next
            edit 5
                set header "Counts"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 6
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "Top-Monitored-Intrusions"
        set disp-name "Top 20 Monitored Intrusions"
        set category "Threat"
        set description "Top 20 monitored intrusions"
        set dataset "threat-Top-Monitored-Intrusions"
        set chart-type table
        config table-columns
            edit 1
                set header "Intrusion Name"
                set data-binding "attackid"
                set column-attr url
                set data-top 20
                set column-span 2
                set column-width 20
            next
            edit 2
                set data-binding "attack"
                set column-attr attack
            next
            edit 3
                set header "Intrusion Type"
                set data-binding "vuln_type"
                set column-width 20
            next
            edit 4
                set header "Severity"
                set data-binding "severity_name"
                set data-top 20
                set column-width 20
            next
            edit 5
                set header "Counts"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 6
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "Attacks-Over-HTTP-HTTPs"
        set disp-name "Attacks Over HTTP or HTTPs"
        set category "Threat"
        set description "Intrusions over HTTP or HTTPs"
        set dataset "threat-Attacks-Over-HTTP-HTTPs"
        set chart-type table
        config table-columns
            edit 1
                set header "Attack Name"
                set data-binding "attackid"
                set column-attr url
                set data-top 0
                set column-span 2
                set column-width 30
            next
            edit 2
                set data-binding "attack"
                set column-attr attack
            next
            edit 3
                set header "Severity"
                set data-binding "severity"
                set column-width 30
            next
            edit 4
                set header "Attack Counts"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 5
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "default-AP-Detection-Summary-by-Status-OffWire"
        set disp-name "Top Off-Wire AP Summary Pie Chart"
        set category "Event"
        set description "Top 10 off-wire wireless access point detection summary by status pie chart"
        set dataset "default-AP-Detection-Summary-by-Status-OffWire"
        set chart-type pie
        config table-columns
            edit 1
                set header "AP Status"
                set data-binding "ap_full_status"
                set data-top 10
            next
            edit 2
                set header "Total Number"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr none
            next
        end
        set protected enable
    next
    edit "default-AP-Detection-Summary-by-Status-OffWire_table"
        set disp-name "Top Off-Wire AP Summary"
        set category "Event"
        set description "Top 10 off-wire wireless access point detection summary by status"
        set dataset "default-AP-Detection-Summary-by-Status-OffWire"
        set chart-type table
        config table-columns
            edit 1
                set header "AP Status"
                set data-binding "ap_full_status"
                set data-top 10
                set column-width 30
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set data-top 10
                set column-width 50
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
            edit 4
                set header "Percentage"
                set data-binding "totalnum"
                set column-attr cal-percent
                set data-top 10
                set column-width 20
            next
        end
        set protected enable
    next
    edit "default-AP-Detection-Summary-by-Status-OnWire"
        set disp-name "Top On-Wire AP Summary Pie Chart"
        set category "Event"
        set description "Top 10 on-wire wireless access point detection summary by status pie chart"
        set dataset "default-AP-Detection-Summary-by-Status-OnWire"
        set chart-type pie
        config table-columns
            edit 1
                set header "AP Status"
                set data-binding "ap_full_status"
                set data-top 10
            next
            edit 2
                set header "Total Number"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr none
            next
        end
        set protected enable
    next
    edit "default-AP-Detection-Summary-by-Status-OnWire_table"
        set disp-name "Top On-Wire AP Summary"
        set category "Event"
        set description "Top 10 on-wire wireless access point detection summary by status"
        set dataset "default-AP-Detection-Summary-by-Status-OnWire"
        set chart-type table
        config table-columns
            edit 1
                set header "AP Status"
                set data-binding "ap_full_status"
                set data-top 10
                set column-width 30
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set data-top 10
                set column-width 50
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
            edit 4
                set header "Percentage"
                set data-binding "totalnum"
                set column-attr cal-percent
                set data-top 10
                set column-width 20
            next
        end
        set protected enable
    next
    edit "default-Managed-AP-Summary"
        set disp-name "Managed AP Summary Pie Chart"
        set category "Event"
        set description "Managed wireless access point summary by status pie chart"
        set dataset "default-Managed-AP-Summary"
        set chart-type pie
        config table-columns
            edit 1
                set header "AP State"
                set data-binding "ap_status"
                set data-top 3
            next
            edit 2
                set header "Total Number"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr none
            next
        end
        set protected enable
    next
    edit "default-Managed-AP-Summary_table"
        set disp-name "Top Managed AP Summary"
        set category "Event"
        set description "Top 10 managed wireless access point summary by status"
        set dataset "default-Managed-AP-Summary"
        set chart-type table
        config table-columns
            edit 1
                set header "AP State"
                set data-binding "ap_status"
                set data-top 100
                set column-width 30
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set data-top 10
                set column-width 50
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
            edit 4
                set header "Percentage"
                set data-binding "totalnum"
                set column-attr cal-percent
                set data-top 10
                set column-width 20
            next
        end
        set protected enable
    next

    edit "default-Unclassified-AP-Summary"
        set disp-name "Unclassified AP Summary Pie Chart"
        set category "Event"
        set description "Unclassified wireless access point summary by status pie chart"
        set dataset "default-Unclassified-AP-Summary"
        set chart-type pie
        config table-columns
            edit 1
                set header "AP State"
                set data-binding "ap_status"
                set data-top 3
            next
            edit 2
                set header "Total Number"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr none
            next
        end
        set protected enable
    next
    edit "default-Unclassified-AP-Summary_table"
        set disp-name "Top Unclassified AP Summary"
        set category "Event"
        set description "Top 10 unclassified wireless access point summary by status"
        set dataset "default-Unclassified-AP-Summary"
        set chart-type table
        config table-columns
            edit 1
                set header "AP State"
                set data-binding "ap_status"
                set data-top 10
                set column-width 30
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set data-top 10
                set column-width 50
            next
            edit 3
                set data-binding "totalnum"
            next
            edit 4
                set header "Percentage"
                set data-binding "totalnum"
                set column-attr cal-percent
                set data-top 10
                set column-width 20
            next
        end
        set protected enable
    next


    edit "default-selected-AP-Details-OffWire"
        set disp-name "Top Off-Wire AP Details"
        set category "Event"
        set description "Top 10 details of off-wire wireless access point"
        set dataset "default-selected-AP-Details-OffWire"
        set chart-type table
        config table-columns
            edit 1
                set header "SSID"
                set data-binding "ssid"
                set data-top 10
                set column-width 10
            next
            edit 2
                set header "BSSID"
                set data-binding "bssid"
                set data-top 10
                set column-width 15
            next
            edit 3
                set header "MFR"
                set data-binding "manuf"
                set data-top 10
                set column-width 11
            next
            edit 4
                set header "Channel"
                set data-binding "channel"
                set data-top 10
                set column-width 0
            next
            edit 5
                set header "Radio Band"
                set data-binding "radioband"
                set data-top 10
                set column-width 7
            next
            edit 6
                set header "First Seen"
                set data-binding "first_seen"
                set data-top 10
                set column-width 16
            next
            edit 7
                set header "Last Seen"
                set data-binding "last_seen"
                set data-top 10
                set column-width 16
            next
            edit 8
                set header "DevID"
                set data-binding "devid"
                set data-top 10
                set column-width 17
            next
            edit 9
                set header "VD"
                set data-binding "vd"
                set data-top 10
                set column-width 0
            next
        end
        set protected enable
    next
    edit "default-selected-AP-Details-OnWire"
        set disp-name "Top On-Wire AP Details"
        set category "Event"
        set description "Top 10 details of on-wire wireless access point"
        set dataset "default-selected-AP-Details-OnWire"
        set chart-type table
        config table-columns
            edit 1
                set header "SSID"
                set data-binding "ssid"
                set data-top 10
                set column-width 10
            next
            edit 2
                set header "BSSID"
                set data-binding "bssid"
                set data-top 10
                set column-width 15
            next
            edit 3
                set header "MFR"
                set data-binding "manuf"
                set data-top 10
                set column-width 11
            next
            edit 4
                set header "Channel"
                set data-binding "channel"
                set data-top 10
                set column-width 0
            next
            edit 5
                set header "Radio Band"
                set data-binding "radioband"
                set data-top 10
                set column-width 7
            next
            edit 6
                set header "First Seen"
                set data-binding "first_seen"
                set data-top 10
                set column-width 16
            next
            edit 7
                set header "Last Seen"
                set data-binding "last_seen"
                set data-top 10
                set column-width 16
            next
            edit 8
                set header "DevID"
                set data-binding "devid"
                set data-top 10
                set column-width 17
            next
            edit 9
                set header "VD"
                set data-binding "vd"
                set data-top 10
                set column-width 0
            next
        end
        set protected enable
    next
    edit "event-Wireless-Client-Details"
        set disp-name "Top 100 WiFi Client Details"
        set category "Event"
        set description "Top 100 details of client event of wireless access point"
        set dataset "event-Wireless-Client-Details"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set data-top 100
                set column-width 8
            next
            edit 2
                set header "MAC"
                set data-binding "lmac"
                set data-top 100
                set column-width 15
            next
            edit 3
                set header "SN"
                set data-binding "sn"
                set data-top 100
                set column-width 15
            next
            edit 4
                set header "SSID"
                set data-binding "ssid"
                set data-top 100
                set column-width 10
            next
            edit 5
                set header "Channel"
                set data-binding "channel"
                set data-top 100
                set column-width 0
            next
            edit 6
                set header "Radio Band"
                set data-binding "radioband"
                set data-top 100
                set column-width 7
            next
            edit 7
                set header "First Seen"
                set data-binding "first_seen"
                set data-top 100
                set column-width 16
            next
            edit 8
                set header "Last Seen"
                set data-binding "last_seen"
                set data-top 100
                set column-width 16
            next
            edit 9
                set header "Bytes"
                set data-binding "bandwidth"
                set data-top 100
                set column-width 10
            next
        end
        set protected enable
    next
    edit "event-Wireless-Accepted-Offwire"
        set disp-name "Top 100 Off-Wire Accepted APs"
        set category "WiFi"
        set description "Top 100 off-wire accepted wireless access points"
        set dataset "event-Wireless-Accepted-Offwire"
        set chart-type table
        config table-columns
            edit 1
                set header "SSID"
                set data-binding "ssid"
                set data-top 100
                set column-width 10
            next
            edit 2
                set header "BSSID"
                set data-binding "bssid"
                set data-top 100
                set column-width 15
            next
            edit 3
                set header "MFR"
                set data-binding "manuf"
                set data-top 100
                set column-width 11
            next
            edit 4
                set header "Channel"
                set data-binding "channel"
                set data-top 100
                set column-width 0
            next
            edit 5
                set header "Radio Band"
                set data-binding "radioband"
                set data-top 100
                set column-width 7
            next
            edit 6
                set header "Last Seen"
                set data-binding "last_seen"
                set data-top 100
                set column-width 16
            next
            edit 7
                set header "Closest AP"
                set data-binding "snclosest"
                set data-top 100
                set column-width 16
            next
            edit 8
                set header "Device ID"
                set data-binding "devid"
                set data-top 100
                set column-width 17
            next
            edit 9
                set header "VDOM"
                set data-binding "vd"
                set data-top 100
                set column-width 0
            next
        end
        set protected enable
    next
    edit "event-Wireless-Accepted-Onwire"
        set disp-name "Top 100 On-Wire Accepted APs"
        set category "WiFi"
        set description "Top 100 on-wire accepted wireless access points"
        set dataset "event-Wireless-Accepted-Onwire"
        set chart-type table
        config table-columns
            edit 1
                set header "SSID"
                set data-binding "ssid"
                set data-top 100
                set column-width 10
            next
            edit 2
                set header "BSSID"
                set data-binding "bssid"
                set data-top 100
                set column-width 15
            next
            edit 3
                set header "MFR"
                set data-binding "manuf"
                set data-top 100
                set column-width 11
            next
            edit 4
                set header "Channel"
                set data-binding "channel"
                set data-top 100
                set column-width 0
            next
            edit 5
                set header "Radio Band"
                set data-binding "radioband"
                set data-top 100
                set column-width 7
            next
            edit 6
                set header "Last Seen"
                set data-binding "last_seen"
                set data-top 100
                set column-width 16
            next
            edit 7
                set header "Closest AP"
                set data-binding "snclosest"
                set data-top 100
                set column-width 16
            next
            edit 8
                set header "Device ID"
                set data-binding "devid"
                set data-top 100
                set column-width 17
            next
            edit 9
                set header "VDOM"
                set data-binding "vd"
                set data-top 100
                set column-width 0
            next
        end
        set protected enable
    next
    edit "event-Wireless-Rogue-Offwire"
        set disp-name "Off-Wire Rogue APs"
        set category "WiFi"
        set description "Rogue off-wire wireless access points"
        set dataset "event-Wireless-Rogue-Offwire"
        set chart-type table
        config table-columns
            edit 1
                set header "SSID"
                set data-binding "ssid"
                set data-top 100
                set column-width 10
            next
            edit 2
                set header "BSSID"
                set data-binding "bssid"
                set data-top 100
                set column-width 15
            next
            edit 3
                set header "MFR"
                set data-binding "manuf"
                set data-top 100
                set column-width 11
            next
            edit 4
                set header "Channel"
                set data-binding "channel"
                set data-top 100
                set column-width 0
            next
            edit 5
                set header "Radio Band"
                set data-binding "radioband"
                set data-top 100
                set column-width 7
            next
            edit 6
                set header "Last Seen"
                set data-binding "last_seen"
                set data-top 100
                set column-width 16
            next
            edit 7
                set header "Closest AP"
                set data-binding "snclosest"
                set data-top 100
                set column-width 16
            next
            edit 8
                set header "Device ID"
                set data-binding "devid"
                set data-top 100
                set column-width 17
            next
            edit 9
                set header "VDOM"
                set data-binding "vd"
                set data-top 100
                set column-width 0
            next
        end
        set protected enable
    next
    edit "event-Wireless-Rogue-Onwire"
        set disp-name "Top 100 On-Wire Rogue APs"
        set category "WiFi"
        set description "Top 100 rogue on-wire wireless access points"
        set dataset "event-Wireless-Rogue-Onwire"
        set chart-type table
        config table-columns
            edit 1
                set header "SSID"
                set data-binding "ssid"
                set data-top 100
                set column-width 10
            next
            edit 2
                set header "BSSID"
                set data-binding "bssid"
                set data-top 100
                set column-width 15
            next
            edit 3
                set header "MFR"
                set data-binding "manuf"
                set data-top 100
                set column-width 11
            next
            edit 4
                set header "Channel"
                set data-binding "channel"
                set data-top 100
                set column-width 0
            next
            edit 5
                set header "Radio Band"
                set data-binding "radioband"
                set data-top 100
                set column-width 7
            next
            edit 6
                set header "Last Seen"
                set data-binding "last_seen"
                set data-top 100
                set column-width 16
            next
            edit 7
                set header "Closest AP"
                set data-binding "snclosest"
                set data-top 100
                set column-width 16
            next
            edit 8
                set header "Device ID"
                set data-binding "devid"
                set data-top 100
                set column-width 17
            next
            edit 9
                set header "VDOM"
                set data-binding "vd"
                set data-top 100
                set column-width 0
            next
        end
        set protected enable
    next
    edit "event-Wireless-Suppressed-Offwire"
        set disp-name "Top 100 Off-Wire Suppressed APs"
        set category "WiFi"
        set description "Top 100 suppressed off-wire wireless access points"
        set dataset "event-Wireless-Suppressed-Offwire"
        set chart-type table
        config table-columns
            edit 1
                set header "SSID"
                set data-binding "ssid"
                set data-top 100
                set column-width 10
            next
            edit 2
                set header "BSSID"
                set data-binding "bssid"
                set data-top 100
                set column-width 15
            next
            edit 3
                set header "MFR"
                set data-binding "manuf"
                set data-top 100
                set column-width 11
            next
            edit 4
                set header "Channel"
                set data-binding "channel"
                set data-top 100
                set column-width 0
            next
            edit 5
                set header "Radio Band"
                set data-binding "radioband"
                set data-top 100
                set column-width 7
            next
            edit 6
                set header "Last Seen"
                set data-binding "last_seen"
                set data-top 100
                set column-width 16
            next
            edit 7
                set header "Closest AP"
                set data-binding "snclosest"
                set data-top 100
                set column-width 16
            next
            edit 8
                set header "Device ID"
                set data-binding "devid"
                set data-top 100
                set column-width 17
            next
            edit 9
                set header "VDOM"
                set data-binding "vd"
                set data-top 100
                set column-width 0
            next
        end
        set protected enable
    next
    edit "event-Wireless-Suppressed-Onwire"
        set disp-name "Top 100 On-Wire Suppressed APs"
        set category "WiFi"
        set description "Top 100 suppressed on-wire wireless access points"
        set dataset "event-Wireless-Suppressed-Onwire"
        set chart-type table
        config table-columns
            edit 1
                set header "SSID"
                set data-binding "ssid"
                set data-top 100
                set column-width 10
            next
            edit 2
                set header "BSSID"
                set data-binding "bssid"
                set data-top 100
                set column-width 15
            next
            edit 3
                set header "MFR"
                set data-binding "manuf"
                set data-top 100
                set column-width 11
            next
            edit 4
                set header "Channel"
                set data-binding "channel"
                set data-top 100
                set column-width 0
            next
            edit 5
                set header "Radio Band"
                set data-binding "radioband"
                set data-top 100
                set column-width 7
            next
            edit 6
                set header "Last Seen"
                set data-binding "last_seen"
                set data-top 100
                set column-width 16
            next
            edit 7
                set header "Closest AP"
                set data-binding "snclosest"
                set data-top 100
                set column-width 16
            next
            edit 8
                set header "Device ID"
                set data-binding "devid"
                set data-top 100
                set column-width 17
            next
            edit 9
                set header "VDOM"
                set data-binding "vd"
                set data-top 100
                set column-width 0
            next
        end
        set protected enable
    next
    edit "event-Wireless-Unclassified-Offwire"
        set disp-name "Top 100 Off-Wire Unclassified APs"
        set category "WiFi"
        set description "Top 100 unclassified off-wire wireless access points"
        set dataset "event-Wireless-Unclassified-Offwire"
        set chart-type table
        config table-columns
            edit 1
                set header "SSID"
                set data-binding "ssid"
                set data-top 100
                set column-width 10
            next
            edit 2
                set header "BSSID"
                set data-binding "bssid"
                set data-top 100
                set column-width 15
            next
            edit 3
                set header "MFR"
                set data-binding "manuf"
                set data-top 100
                set column-width 11
            next
            edit 4
                set header "Channel"
                set data-binding "channel"
                set data-top 100
                set column-width 0
            next
            edit 5
                set header "Radio Band"
                set data-binding "radioband"
                set data-top 100
                set column-width 7
            next
            edit 6
                set header "Last Seen"
                set data-binding "last_seen"
                set data-top 100
                set column-width 16
            next
            edit 7
                set header "Closest AP"
                set data-binding "snclosest"
                set data-top 100
                set column-width 16
            next
            edit 8
                set header "Device ID"
                set data-binding "devid"
                set data-top 100
                set column-width 17
            next
            edit 9
                set header "VDOM"
                set data-binding "vd"
                set data-top 100
                set column-width 0
            next
        end
        set protected enable
    next
    edit "event-Wireless-Unclassified-Onwire"
        set disp-name "Top 100 On-Wire Unclassified APs"
        set category "WiFi"
        set description "Top 100 unclassified on-wire wireless access points"
        set dataset "event-Wireless-Unclassified-Onwire"
        set chart-type table
        config table-columns
            edit 1
                set header "SSID"
                set data-binding "ssid"
                set data-top 100
                set column-width 10
            next
            edit 2
                set header "BSSID"
                set data-binding "bssid"
                set data-top 100
                set column-width 15
            next
            edit 3
                set header "MFR"
                set data-binding "manuf"
                set data-top 100
                set column-width 11
            next
            edit 4
                set header "Channel"
                set data-binding "channel"
                set data-top 100
                set column-width 0
            next
            edit 5
                set header "Radio Band"
                set data-binding "radioband"
                set data-top 100
                set column-width 7
            next
            edit 6
                set header "Last Seen"
                set data-binding "last_seen"
                set data-top 100
                set column-width 16
            next
            edit 7
                set header "Closest AP"
                set data-binding "snclosest"
                set data-top 100
                set column-width 16
            next
            edit 8
                set header "Device ID"
                set data-binding "devid"
                set data-top 100
                set column-width 17
            next
            edit 9
                set header "VDOM"
                set data-binding "vd"
                set data-top 100
                set column-width 0
            next
        end
        set protected enable
    next
    edit "default-Top-IPSEC-Vpn-Dial-Up-User-By-Bandwidth"
        set disp-name "Top IPsec Dial-up User by Bandwidth"
        set category "Network Usage"
        set description "Top 10 users of IPsec VPN dial-up tunnel by bandwidth usage"
        set dataset "default-Top-IPSEC-Vpn-Dial-Up-User-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "User"
                set data-binding "user_src"
                set data-top 10
                set column-attr user
                set column-width 30
            next
            edit 2
                set header "First Used"
                set data-binding "start_time"
                set column-width 30
            next
            edit 3
                set header "Bytes"
                set data-binding "bandwidth"
                set column-graph-type bar
                set column-span 2
                set column-width 40
            next
            edit 4
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "default-Top-Sources-Of-SSL-VPN-Tunnels-By-Bandwidth"
        set disp-name "Top SSL VPN Sources by Bandwidth"
        set category "VPN"
        set description "Top 10 users of SSL VPN tunnel by bandwidth usage"
        set dataset "default-Top-Sources-Of-SSL-VPN-Tunnels-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Remote Host"
                set data-binding "remote_ip"
                set column-attr ip-country
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Bytes"
                set data-binding "bandwidth"
                set column-graph-type bar
                set column-span 2
                set column-width 60
            next
            edit 3
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "vpn-Login-Connection-Count-by-Type"
        set disp-name "VPN Login Connection Count by VPN Type"
        set category "VPN"
        set description "VPN Login Connection Count by VPN Type"
        set dataset "vpn-Authenticated-Logins"
        set chart-type donut
        set chart-style "{\"legend-format\":\"${pct} ${name} (${val})\", \"show-header\" :\"enable\"}"
        set include-other enable
        config table-columns
            edit 1
                set header ""
                set data-binding "tunneltype"
                set data-top 10
            next
            edit 2
                set header "Connections"
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "vpn-Login-User-Count-by-Type"
        set disp-name "VPN Login User Count by VPN Type"
        set category "VPN"
        set description "VPN Login User Count by VPN Type"
        set dataset "vpn-Login-User-Count-by-Type"
        set chart-type donut
        set chart-style "{\"legend-format\":\"${pct} ${name} (${val})\", \"show-header\" :\"enable\"}"
        set include-other enable
        config table-columns
            edit 1
                set header ""
                set data-binding "type_agg"
                set data-top 10
            next
            edit 2
                set header "Users"
                set data-binding "num_user"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "vpn-Login-Total-Bandwidth-by-Type"
        set disp-name "VPN Login Total Bandwidth by VPN Type"
        set category "VPN"
        set description "VPN Login Total Bandwidth by VPN Type"
        set dataset "vpn-Login-Total-Bandwidth-by-Type"
        set chart-type donut
        set chart-style "{\"legend-format\":\"${pct} ${name} (${val})\", \"show-header\" :\"enable\"}"
        set include-other enable
        config table-columns
            edit 1
                set header ""
                set data-binding "t_type"
                set data-top 10
            next
            edit 2
                set header "Traffic"
                set data-binding "total_bandwidth"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "vpn-Login-Attempt-by-Type"
        set disp-name "VPN Login Attempts by VPN Type"
        set category "VPN"
        set description "VPN Login Attempts by VPN Type"
        set dataset "vpn-Login-Attempt-by-Type"
        set chart-type donut
        set chart-style "{\"legend-format\":\"${pct} ${name} (${val})\", \"show-header\" :\"enable\"}"
        set include-other enable
        config table-columns
            edit 1
                set header ""
                set data-binding "type"
                set data-top 10
            next
            edit 2
                set header "Attemps"
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "vpn-Traffic-Usage-Trend"
        set disp-name "VPN Traffic Usage Trend Area Chart"
        set description "VPN Traffic Usage Trend Area Chart"
        set dataset "vpn-Traffic-Usage-Trend-VPN"
        set category "VPN"
        set chart-type area
        set chart-style "{\"legend-position\":\"top\"}"
        config table-columns
            edit 1
                set data-binding "hodex"
                set column-attr time
            next
            edit 2
                set data-binding "ssl_bandwidth"
                set column-graph-type line-up
                set legend "SSL"
            next
            edit 3
                set data-binding "ipsec_bandwidth"
                set column-graph-type line-up
                set legend "IPSEC"
            next
        end
        set protected enable
    next
    edit "vpn-Authenticated-Logins"
        set category "Event"
        set disp-name "Top Authenticated VPN Logins"
        set description "Top 15 authenticated VPN logins"
        set dataset "vpn-Authenticated-Logins"
        set chart-type table
        config table-columns
            edit 1
                set header "user"
                set data-binding "f_user"
                set column-attr user
                set data-top 15
                set column-width 18
            next
            edit 2
                set header "Type"
                set data-binding "tunneltype"
                set column-width 12
            next
            edit 3
                set header "First Used"
                set data-binding "start_time"
                set column-width 20
            next
            edit 4
                set header "Total Number of Connections"
                set data-binding "total_num"
                set column-span 2
                set column-attr count
                set column-style "{\"align\":\"left\",\"width\":24}"
                set column-width 25
            next
            edit 5
                set data-binding "total_num"
                set column-graph-type bar
                set column-style "{\"width\":74}"
            next
            edit 6
                set header "Total Duration Connected(HH:MM:SS)"
                set data-binding "duration"
                set column-attr timespan
                set column-style "{\"align\":\"left\",\"width\":30}"
                set column-span 2
                set column-width 25
            next
            edit 7
                set data-binding "duration"
                set column-graph-type bar
                set column-style "{\"width\":68}"
            next
        end
        set protected enable
    next
    edit "vpn-Failed-Login-Attempt-by-User"
        set disp-name "VPN Failed Login Attempts by User"
        set category "VPN"
        set description "VPN Failed Login Attempts by User"
        set dataset "vpn-Failed-Logins"
        set chart-type donut
        set chart-style "{\"show-header\" :\"enable\"}"
        config table-columns
            edit 1
                set header ""
                set data-binding "f_user"
                set data-top 10
            next
            edit 2
                set header "Attemps"
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "vpn-Failed-Login-Timeline"
        set disp-name "VPN Failed Login Timeline"
        set category "VPN"
        set description "VPN Failed Login Timeline"
        set dataset "vpn-Failed-Login-Timeline"
        set chart-type line
        config table-columns
            edit 1
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "total_num"
                set column-graph-type line-up
                set column-attr count
            next
        end
        set protected enable
    next
    edit "vpn-Top-Dial-Up-VPN-Users-By-Duration"
        set disp-name "Top Dial Up VPN Users"
        set category "VPN"
        set description "Top 10 Dial Up VPN Users"
        set dataset "vpn-Top-Dial-Up-VPN-Users-By-Duration"
        set chart-type table
        config table-columns
            edit 1
                set header "User"
                set data-binding "user_src"
                set column-attr user
                set data-top 10
                set column-width 15
            next
            edit 2
                set header "Type"
                set data-binding "tunneltype"
                set column-width 10
            next
            edit 3
                set header "First Used"
                set data-binding "start_time"
                set column-width 17
            next
            edit 4
                set header "Aggregated Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-style "{\"align\":\"left\",\"width\":38}"
                set column-span 2
                set column-width 29
            next
            edit 5
                set data-binding "bandwidth"
                set column-graph-type bar
                set column-style "{\"width\":60}"
            next
            edit 6
                set header "Aggregated Dialed Time(HH:MM:SS)"
                set data-binding "duration"
                set column-attr timespan
                set column-style "{\"align\":\"left\",\"width\":38}"
                set column-span 2
                set column-width 29
            next
            edit 7
                set data-binding "duration"
                set column-graph-type bar
                set column-style "{\"width\":60}"
            next
        end
        set protected enable
    next
    edit "vpn-Top-SSL-VPN-Tunnel-Duration-By-Users"
        set disp-name "Top SSL VPN Tunnel Duration by Users"
        set category "VPN"
        set description "Top 5 SSL VPN Tunnel Duration by Users"
        set dataset "vpn-Top-SSL-VPN-Tunnel-Duration-By-Users"
        set chart-type pie
        set chart-style "{\"size\": \"big\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "User"
                set data-binding "user_src"
                set data-top 5
            next
            edit 2
                set header "Duration"
                set data-binding "duration"
                set data-type aggregate
                set column-attr timespan
            next
        end
        set protected enable
    next
    edit "vpn-Top-SSL-VPN-Tunnel-Users-By-Traffic-Directions"
        set disp-name "Top SSL VPN Tunnel Users by Traffic Directions"
        set category "VPN"
        set description "Top 5 SSL VPN Tunnel Users by Traffic Directions"
        set dataset "vpn-Top-SSL-VPN-Tunnel-Users-By-Traffic-Directions"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\", \"legend-position\":\"top\", \"height\":\"240\", \"y-axis-type\":\"bandwidth\", \"y-label\": \"flat\", \"fixed-bar-width\": \"10\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "User"
                set data-binding "user_src"
                set data-top 5
            next
            edit 2
                set header "Direction"
                set data-binding "direction"
                set data-type drilldown
                set data-top 3
            next
            edit 3
                set header "Traffic"
                set data-binding "traffic"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "vpn-Top-SSL-VPN-Web-Mode-Users-By-Duration"
        set disp-name "Top SSL VPN Web Mode Users by Duration"
        set category "VPN"
        set description "Top 5 SSL VPN Web Mode Users by Duration"
        set dataset "vpn-Top-SSL-VPN-Web-Mode-Users-By-Duration"
        set chart-type pie
        set chart-style "{\"size\": \"big\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "User"
                set data-binding "user_src"
                set data-top 5
            next
            edit 2
                set header "Duration"
                set data-binding "duration"
                set data-type aggregate
                set column-attr timespan
            next
        end
        set protected enable
    next
    edit "vpn-Top-SSL-VPN-Web-Mode-Users-By-Traffic-Directions"
        set disp-name "Top SSL VPN Web Mode Users by Traffic Directions"
        set category "VPN"
        set description "Top 5 SSL VPN Web Mode Users by Traffic Directions"
        set dataset "vpn-Top-SSL-VPN-Web-Mode-Users-By-Traffic-Directions"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\", \"legend-position\":\"top\", \"height\":\"240\", \"y-axis-type\":\"bandwidth\", \"y-label\": \"flat\", \"fixed-bar-width\": \"10\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "User"
                set data-binding "user_src"
                set data-top 5
            next
            edit 2
                set header "Direction"
                set data-binding "direction"
                set data-type drilldown
                set data-top 3
            next
            edit 3
                set header "Traffic"
                set data-binding "traffic"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "vpn-Top-IPsec-Vpn-Dial-Up-User-By-Bandwidth"
        set disp-name "Top IPsec VPN Dial Up User by Bandwidth Usage"
        set category "VPN"
        set description "Top 5 IPsec VPN Dial Up User by Bandwidth Usage"
        set dataset "default-Top-IPSEC-Vpn-Dial-Up-User-By-Bandwidth"
        set chart-type donut
        set chart-style "{\"legend-font-size\": \"8px\"}"
        set include-other disable
        config table-columns
            edit 1
                set header ""
                set data-binding "user_src"
                set data-top 5
            next
            edit 2
                set header "Bandwidth"
                set data-binding "bandwidth"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "vpn-Top-Static-IPsec-Tunnels-By-Traffic-Directions"
        set disp-name "Top Site-to-Site IPsec Tunnels by Traffic Directions"
        set category "VPN"
        set description "Top 5 Site-to-Site IPsec Tunnels by Traffic Directions"
        set dataset "vpn-Top-Static-IPsec-Tunnels-By-Traffic-Directions"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\", \"legend-position\":\"top\", \"height\":\"240\", \"y-axis-type\":\"bandwidth\", \"y-label\": \"flat\", \"fixed-bar-width\": \"10\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "VPN Name"
                set data-binding "vpn_name"
                set data-top 5
            next
            edit 2
                set header "Direction"
                set data-binding "direction"
                set data-type drilldown
                set data-top 3
            next
            edit 3
                set header "Traffic"
                set data-binding "traffic"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "vpn-Top-Dial-Up-IPsec-Users-By-Duration"
        set disp-name "Top Dial-up IPsec Users by Duration Pie Chart"
        set category "VPN"
        set description "Top 5 Dial-up IPsec Users by Duration"
        set dataset "vpn-Top-Dial-Up-IPSEC-Users-By-Duration"
        set chart-type pie
        set chart-style "{\"size\": \"big\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "User"
                set data-binding "user_src"
                set data-top 5
            next
            edit 2
                set header "Duration"
                set data-binding "duration"
                set data-type aggregate
                set column-attr timespan
            next
        end
        set protected enable
    next
    edit "vpn-Top-Dial-Up-IPsec-Tunnels-By-Traffic-Directions"
        set disp-name "Top Dial-up IPsec Tunnels by Traffic Directions"
        set category "VPN"
        set description "VPN Top 5 Dial-up IPsec Tunnels by Traffic Directions"
        set dataset "vpn-Top-Dial-Up-IPsec-Tunnels-By-Traffic-Directions"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\", \"legend-position\":\"top\", \"height\":\"240\", \"y-axis-type\":\"bandwidth\", \"y-label\": \"flat\", \"fixed-bar-width\": \"10\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "VPN Name"
                set data-binding "vpn_name"
                set data-top 5
            next
            edit 2
                set header "Direction"
                set data-binding "direction"
                set data-type drilldown
                set data-top 3
            next
            edit 3
                set header "Traffic"
                set data-binding "traffic"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "webfilter-Web-Activity-Summary-By-Requests"
        set disp-name "Web Activity Summary"
        set category "Web"
        set description "Web activity summary by number of requests"
        set dataset "webfilter-Web-Activity-Summary-By-Requests"
        set chart-type line
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "allowed_request"
                set column-graph-type line-up
                set legend "Allowed Request"
            next
            edit 3
                set data-binding "blocked_request"
                set column-graph-type line-up
                set legend "Blocked Request"
            next
        end
        set protected enable
    next
    edit "traffic-Browsing-Time-Summary"
        set disp-name "Browsing Time Summary"
        set category "Web"
        set description " Estimated browsing time by HTTP/HTTPs duration of traffic session"
        set dataset "traffic-Browsing-Time-Summary"
        set chart-type line
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "browsetime"
                set column-graph-type line-up
                set legend "Browsing Time (Min)"
            next
        end
        set protected enable
    next
    edit "webfilter-Top-Web-Users-By-Blocked-Requests"
        set disp-name "Top Web Users by Blocked Requests"
        set category "Web"
        set description "Top 10 web users by number of blocked requests"
        set dataset "webfilter-Top-Web-Users-By-Blocked-Requests"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set column-attr user
                set data-top 20
                set column-width 30
            next
            edit 2
                set header "Hostname"
                set data-binding "ep_src"
                set column-width 30
            next
            edit 3
                set header "Requests"
                set data-binding "requests"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 4
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "webfilter-Top-Web-Users-By-Allowed-Requests"
        set disp-name "Top Web Users by Allowed Requests"
        set category "Web"
        set description "Top 10 web users by number of allowed requests"
        set dataset "webfilter-Top-Web-Users-By-Allowed-Requests"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set column-attr user
                set data-top 20
                set column-width 30
            next
            edit 2
                set header "Hostname"
                set data-binding "ep_src"
                set column-width 30
            next
            edit 3
                set header "Requests"
                set data-binding "requests"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 4
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "traffic-Top-Web-Users-By-Browsing-Time"
        set disp-name "Top Web Users by Browsing Time"
        set category "Web"
        set description "Top 10 web users by browsing time"
        set dataset "traffic-Top-Web-Users-By-Browsing-Time"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set column-attr user
                set data-top 10
                set column-width 30
            next
            edit 2
                set header "Browsing Time(hh:mm:ss)"
                set data-binding "browsetime"
                set column-graph-type bar
                set column-span 2
                set column-width 30
            next
            edit 3
                set data-binding "browsetime"
                set column-attr timespan
            next
            edit 4
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 40
            next
            edit 5
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 6
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "webfilter-Top-Blocked-Web-Sites-By-Requests"
        set disp-name "Top Blocked Websites and Categories"
        set category "Web"
        set description "Top 10 blocked web filtering websites and categories by number of requests"
        set dataset "webfilter-Top-Blocked-Web-Sites-By-Requests"
        set chart-type table
        config table-columns
            edit 1
                set header "Website"
                set data-binding "domain"
                set data-top 50
                set column-width 30
                set column-attr obf-url
            next
            edit 2
                set header "Category"
                set data-binding "catdesc"
                set column-attr web-cat
                set data-top 10
                set column-width 30
            next
            edit 3
                set header "Requests"
                set data-binding "requests"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 4
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "webfilter-Top-Allowed-Web-Sites-By-Requests"
        set disp-name "Top 50 Allowed Websites"
        set category "Web"
        set description "Top 50 allowed websites by number of requests"
        set dataset "webfilter-Top-Allowed-Web-Sites-By-Requests"
        set chart-type table
        config table-columns
            edit 1
                set header "Website"
                set data-binding "domain"
                set data-top 50
                set column-width 30
            next
            edit 2
                set header "Category"
                set data-binding "agg_catdesc"
                set column-width 30
            next
            edit 3
                set header "Requests"
                set data-binding "requests"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 4
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "webfilter-Top-Video-Streaming-Websites-By-Bandwidth"
        set disp-name "Top Video Streaming Websites by Bandwidth"
        set category "Web"
        set description "Top 10 video streaming websites of web filter by bandwidth usage"
        set dataset "webfilter-Top-Video-Streaming-Websites-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Website"
                set data-top 10
                set data-binding "domain"
                set column-width 40
            next
            edit 2
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 60
            next
            edit 3
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 4
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "webfilter-Top-Blocked-Web-Categories"
        set disp-name "Top 20 Blocked Web Categories"
        set category "Web"
        set description "Top 20 blocked web filtering categories"
        set dataset "webfilter-Top-Blocked-Web-Categories"
        set chart-type table
        config table-columns
            edit 1
                set header "Category"
                set data-binding "catdesc"
                set column-attr web-cat
                set data-top 20
                set column-width 40
            next
            edit 2
                set header "Requests"
                set data-binding "requests"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "webfilter-Top-Allowed-Web-Categories"
        set disp-name "Top 20 Allowed Web Categories"
        set category "Web"
        set description "Top 20 allowed web filtering categories"
        set dataset "webfilter-Top-Allowed-Web-Categories"
        set chart-type table
        config table-columns
            edit 1
                set header "Category"
                set data-binding "catdesc"
                set column-attr web-cat
                set data-top 20
                set column-width 40
            next
            edit 2
                set header "Requests"
                set data-binding "requests"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "traffic-Top-50-Sites-By-Browsing-Time"
        set disp-name "Top 50 Websites by Browsing Time"
        set category "Web"
        set description "Top 50 websites by browsing time"
        set dataset "traffic-Top-Sites-By-Browsing-Time"
        set chart-type table
        config table-columns
            edit 1
                set header "Sites"
                set data-binding "hostname"
                set data-top 50
                set column-width 30
            next
            edit 2
                set header "Category"
                set data-binding "agg_catdesc"
                set column-attr web-cat
                set data-top 50
                set column-width 30
            next
            edit 3
                set header "Browsing Time(hh:mm:ss)"
                set data-binding "browsetime"
                set column-graph-type bar
                set column-span 2
                set column-width 40
            next
            edit 4
                set data-binding "browsetime"
                set column-attr timespan
            next
        end
        set protected enable
    next
    edit "traffic-Top-10-Categories-By-Browsing-Time"
        set disp-name "Top Web Categories by Browsing Time"
        set category "Web"
        set description "Top 10 web filtering categories by browsing time"
        set dataset "traffic-Top-Category-By-Browsing-Time"
        set chart-type table
        config table-columns
            edit 1
                set header "Category"
                set data-binding "catdesc"
                set column-attr web-cat
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Browsing Time(hh:mm:ss)"
                set data-binding "browsetime"
                set column-graph-type bar
                set column-span 2
                set column-width 60
            next
            edit 3
                set data-binding "browsetime"
                set column-attr timespan
            next
        end
        set protected enable
    next
    edit "traffic-Top-Destination-Countries-By-Browsing-Time"
        set disp-name "Top Destination Countries by Browsing Time"
        set category "Web"
        set description "Top 10 destination countries by browsing time"
        set dataset "traffic-Top-Destination-Countries-By-Browsing-Time"
        set chart-type table
        config table-columns
            edit 1
                set header "Destination"
                set data-top 10
                set data-binding "dstcountry"
                set column-attr dst-country
                set column-width 30
            next
            edit 2
                set header "Browsing Time(hh:mm:ss)"
                set data-binding "browsetime"
                set column-graph-type bar
                set column-span 2
                set column-width 30
            next
            edit 3
                set data-binding "browsetime"
                set column-attr timespan
            next
            edit 4
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 40
            next
            edit 5
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 6
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "webfilter-Top-Search-Phrases"
        set disp-name "Top Search Phrases"
        set category "Web"
        set description "Top 10 search filtering phrases"
        set dataset "webfilter-Top-Search-Phrases"
        set chart-type table
        config table-columns
            edit 1
                set header "Phrase"
                set data-binding "keyword"
                set data-top 10
                set column-attr search
                set column-width 40
            next
            edit 2
                set header "Requests"
                set data-binding "requests"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "Top-10-Users-Browsing-Time"
        set disp-name "Top Users Browsing Time"
        set category "Network Usage"
        set description "Top 10 users by estimated web browsing time"
        set dataset "Estimated-Browsing-Time"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set data-top 10
                set column-width 30
            next
            edit 2
                set header "Hostname"
                set data-binding "ep_src"
                set column-width 30
            next
            edit 3
                set header "Browsing Time(hh:mm:ss)"
                set data-binding "browsetime"
                set column-graph-type bar
                set column-span 2
                set column-width 40
            next
            edit 4
                set data-binding "browsetime"
                set column-attr timespan
            next
        end
        set protected enable
    next

    edit "Estimated-Browsing-Time"
        set disp-name "Top Users by Browsing Time"
        set category "Network Usage"
        set description "Top 10 users by estimated web browsing time"
        set dataset "Estimated-Browsing-Time"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set data-top 10
            next
            edit 2
                set header "Hostname"
                set data-binding "ep_src"
            next
            edit 3
                set header "Browsing Time(hh:mm:ss)"
                set data-type aggregate
                set data-binding "browsetime"
                set column-attr timespan
            next
        end
        set protected enable
    next

    edit "wifi-Top-AP-By-Bandwidth"
        set disp-name "Top APs by Bandwidth"
        set category "Network Usage"
        set description "Top 10 wireless access points by WiFi bandwidth usage"
        set dataset "wifi-Top-AP-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "AP Name"
                set data-binding "ap_srcintf"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Usage"
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-width 30
            next
        end
        set protected enable
     next
    edit "wifi-Top-AP-By-Client"
        set disp-name "Top APs by WiFi Clients"
        set category "Network Usage"
        set description "Top 10 wireless access points by number of clients via WiFi"
        set dataset "wifi-Top-AP-By-Client"
        set chart-type table
        config table-columns
            edit 1
                set header "AP Name"
                set data-binding "srcintf"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Number of Clients"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
                set column-width 30
            next
        end
        set protected enable
     next
     edit "wifi-Top-SSID-By-Bandwidth"
        set disp-name "Top SSIDs by Bandwidth"
        set category "Network Usage"
        set description "Top 10 SSIDs by WiFi bandwidth usage"
        set dataset "wifi-Top-SSID-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "SSID"
                set data-binding "srcssid"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Usage"
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-width 30
            next
        end
        set protected enable
    next
    edit "wifi-Top-SSID-By-Client"
        set disp-name "Top SSIDs by WiFi Clients"
        set category "Network Usage"
        set description "Top 10 SSIDs by number of clients via WiFi"
        set dataset "wifi-Top-SSID-By-Client"
        set chart-type table
        config table-columns
            edit 1
                set header "SSID"
                set data-binding "srcssid"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Number of Clients"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
                set column-width 30
            next
        end
        set protected enable
    next
    edit "wifi-Top-App-By-Bandwidth"
        set disp-name "Top Applications by WiFi Traffic"
        set category "Application"
        set description "Top 10 applications by WiFi bandwidth usage"
        set dataset "wifi-Top-App-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Application"
                set data-binding "app"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Usage"
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-width 30
            next
        end
        set protected enable
    next
    edit "wifi-Top-Client-By-Bandwidth"
        set disp-name "Top WiFi Clients by Bandwidth"
        set category "Network Usage"
        set description "Top 10 clients by WiFi bandwidth usage"
        set dataset "wifi-Top-Client-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Client"
                set data-binding "client"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Usage"
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-width 30
            next
        end
        set protected enable
    next
    edit "wifi-Top-OS-By-Bandwidth"
        set disp-name "Top OS by WiFi Traffic"
        set category "Network Usage"
        set description "Top 10 operating systems by WiFi bandwidth usage"
        set dataset "wifi-Top-OS-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Operating System"
                set data-binding "os"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Usage"
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-width 30
            next
        end
        set protected enable
    next
    edit "wifi-Top-OS-By-WiFi-Client"
        set disp-name "Top OS by WiFi Clients"
        set category "Network Usage"
        set description "Top 10 operating systems by number of clients via WiFi"
        set dataset "wifi-Top-OS-By-WiFi-Client"
        set chart-type table
        config table-columns
            edit 1
                set header "Operating System"
                set data-binding "os"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Number of Clients"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
                set column-width 30
            next
        end
        set protected enable
    next
    edit "wifi-Top-Device-By-Bandwidth"
        set disp-name "Top Device Types by WiFi Traffic"
        set category "Network Usage"
        set description "Top 10 device types by WiFi bandwidth usage"
        set dataset "wifi-Top-Device-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "DevType"
                set data-binding "devtype_new"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Usage"
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-width 30
            next
        end
        set protected enable
    next
    edit "wifi-Top-Device-By-Client"
        set disp-name "Top Device Types by WiFi Clients"
        set category "Network Usage"
        set description "Top 10 device types by number of clients via WiFi"
        set dataset "wifi-Top-Device-By-Client"
        set chart-type table
        config table-columns
            edit 1
                set header "DevType"
                set data-binding "devtype_new"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Number of Clients"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
                set column-width 30
            next
        end
        set protected enable
    next
    edit "wifi-Overall-Traffic"
        set disp-name "WiFi Traffic Bandwidth"
        set category "Network Usage"
        set description "Overall WiFi traffic bandwidth usage"
        set dataset "wifi-Overall-Traffic"
        set chart-type table
        config table-columns
            edit 1
                set header "Data Transferred"
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "wifi-Num-Distinct-Client"
        set disp-name "Number of Distinct WiFi Clients"
        set category "Network Usage"
        set description "Number of distinct WiFi clients"
        set dataset "wifi-Num-Distinct-Client"
        set chart-type table
        config table-columns
            edit 1
                set header "Distinct Clients"
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "Top30-Subnets-by-Bandwidth-and-Sessions"
        set disp-name "Top 30 Subnets by Bandwidth and Sessions"
        set category "Network Usage"
        set description "Top 30 Subnets by Bandwidth and Sessions"
        set dataset "Subnet-Top-Subnets-By-App-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Subnet"
                set data-binding "subnet"
                set data-top 30
                set column-width 30
            next
            edit 2
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 40
            next
            edit 3
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 4
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
            edit 5
                set header "Sessions"
                set data-binding "sessions"
                set column-span 2
                set column-graph-type bar
                set column-width 30
            next
            edit 6
                set header " "
                set data-binding "sessions"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Top30-Subnets-by-Application-Bandwidth"
        set disp-name "Top 30 Subnets by Application Bandwidth"
        set category "Network Usage"
        set description "Top 30 Subnets by Application Bandwidth"
        set dataset "Subnet-Top-App-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Subnet"
                set data-binding "subnet"
                set data-top 30
            next
            edit 2
                set header "Application"
                set data-binding "app_group"
                set data-type drilldown
                set data-top 10
            next
            edit 3
                set header "Bytes"
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "Top30-Subnets-by-Application-Sessions"
        set disp-name "Top 30 Subnets by Application Sessions"
        set category "Network Usage"
        set description "Top 30 Subnets by Application Sessions"
        set dataset "Subnet-Top-App-By-Sessions"
        set chart-type table
        config table-columns
            edit 1
                set header "Subnet"
                set data-binding "subnet"
                set data-top 30
            next
            edit 2
                set header "Application"
                set data-binding "app_group"
                set data-type drilldown
                set data-top 10
            next
            edit 3
                set header "Sessions"
                set data-type aggregate
                set data-binding "sessions"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Top30-Subnets-by-Website-Bandwidth"
        set disp-name "Top 30 Subnets by Website Bandwidth"
        set category "Network Usage"
        set description "Top 30 Subnets by Website Bandwidth"
        set dataset "Subnet-Top-Websites-And-Web-Category-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Subnet"
                set data-binding "subnet"
                set data-top 30
            next
            edit 2
                set header "Website"
                set data-binding "website"
                set data-type drilldown
                set data-top 10
            next
            edit 3
                set header "Bytes"
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "Top30-Subnets-by-Website-Hits"
        set disp-name "Top 30 Subnets by Website Hits"
        set category "Network Usage"
        set description "Top 30 Subnets by Website Hits"
        set dataset "Subnet-Top-Websites-And-Web-Category-By-Sessions"
        set chart-type table
        config table-columns
            edit 1
                set header "Subnet"
                set data-binding "subnet"
                set data-top 30
            next
            edit 2
                set header "Website"
                set data-binding "website"
                set data-type drilldown
                set data-top 10
            next
            edit 3
                set header "Hits"
                set data-type aggregate
                set data-binding "hits"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Top30-Subnets-with-Top10-User-by-Bandwidth"
        set disp-name "Top 30 Subnets with Top 10 User by Bandwidth"
        set category "Network Usage"
        set description "Top 30 Subnets with Top 10 User by Bandwidth"
        set dataset "Subnet-Top-Users-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Subnet"
                set data-binding "subnet"
                set data-top 30
            next
            edit 2
                set header "User(or IP)"
                set data-binding "user_src"
                set data-top 10
                set data-type drilldown
            next
            edit 3
                set header "Bytes"
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "Top30-Subnets-with-Top10-User-by-Sessions"
        set disp-name "Top 30 Subnets with Top 10 User by Sessions"
        set category "Network Usage"
        set description "Top 30 Subnets with Top 10 User by Sessions"
        set dataset "Subnet-Top-Users-By-Sessions"
        set chart-type table
        config table-columns
            edit 1
                set header "Subnet"
                set data-binding "subnet"
                set data-top 30
            next
            edit 2
                set header "User(or IP)"
                set data-binding "user_src"
                set data-top 10
                set data-type drilldown
            next
            edit 3
                set header "Sessions"
                set data-type aggregate
                set data-binding "sessions"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "app-Top-20-Category-and-Applications-by-Bandwidth"
        set disp-name "Top 20 Category and Applications by Bandwidth"
        set category "Traffic"
        set description "Top 20 category and applications by bandwidth usage"
        set dataset "app-Top-Category-and-Applications-by-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Category"
                set data-binding "appcat"
                set column-attr appcat
                set data-top 20
            next
            edit 2
                set header "Application"
                set data-type drilldown
                set data-binding "app"
                set data-top 20
            next
            edit 3
                set header "Bytes"
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next

    edit "app-Top-20-Category-and-Applications-by-Session"
        set disp-name "Top 20 Category and Applications by Sessions"
        set category "Traffic"
        set description "Top 20 category and applications by session count"
        set dataset "app-Top-Category-and-Applications-by-Session"
        set chart-type table
        config table-columns
            edit 1
                set header "Category"
                set data-binding "appcat"
                set column-attr appcat
                set data-top 20
            next
            edit 2
                set header "Application"
                set data-type drilldown
                set data-binding "app"
                set data-top 20
            next
            edit 3
                set header "Sessions"
                set data-type aggregate
                set data-binding "sessions"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "app-Top-500-Allowed-Applications-by-Bandwidth"
        set disp-name "Top 500 Allowed Applications by Bandwidth"
        set category "Traffic"
        set description "Top 500 allowed applications by bandwidth usage"
        set dataset "app-Top-Allowed-Applications-by-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Timestamp"
                set data-binding "timestamp"
                set data-top 500
                set column-width 20
            next
            edit 2
                set header "User (or IP)"
                set data-binding "user_src"
                set column-attr user
                set column-width 20
            next
            edit 3
                set header "Application"
                set data-binding "app"
                set column-width 15
            next
            edit 4
                set header "Category"
                set data-binding "appcat"
                set column-attr appcat
                set column-width 15
            next
            edit 5
                set header "Destination"
                set data-binding "destination"
                set column-width 15
            next
            edit 6
                set header "Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-width 15
            next
        end
        set protected enable
    next

    edit "app-Top-500-Blocked-Applications-by-Session"
        set disp-name "Top 500 Blocked Applications by Sessions"
        set category "Traffic"
        set description "Top 500 blocked applications by session count"
        set dataset "app-Top-Blocked-Applications-by-Session"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set column-attr user
                set data-top 500
                set column-width 20
            next
            edit 2
                set header "Application"
                set data-binding "app"
                set column-width 30
            next
            edit 3
                set header "Category"
                set data-binding "appcat"
                set column-attr appcat
                set column-width 30
            next
            edit 4
                set header "Sessions"
                set data-binding "sessions"
                set column-attr count
                set column-width 20
            next
        end
        set protected enable
    next

    edit "web-Detailed-Website-Browsing-Log"
        set disp-name "Detailed Web Browsing Log"
        set category "Traffic"
        set description "Detailed browsing log of web"
        set dataset "web-Detailed-Website-Browsing-Log"
        set chart-type table
        config table-columns
            edit 1
                set header "Timestamp"
                set data-binding "timestamp"
                set data-top 0
                set column-width 20
            next
            edit 2
                set header "Category"
                set data-binding "catdesc"
                set column-attr web-cat
                set column-width 20
            next
            edit 3
                set header "Website"
                set data-binding "website"
                set column-width 20
            next
            edit 4
                set header "Action"
                set data-binding "status"
                set column-width 20
            next
            edit 5
                set header "Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-width 20
            next
        end
        set protected enable
    next

    edit "web-Hourly-Category-and-Website-Hits-Action"
        set disp-name "Hourly Category and Website Hits"
        set category "Traffic"
        set description "Hourly category and website hits"
        set dataset "web-Hourly-Category-and-Website-Hits-Action"
        set chart-type table
        config table-columns
            edit 1
                set header "Hour of Day"
                set data-binding "hod"
                set data-top 24
            next
            edit 2
                set header "Website"
                set data-type drilldown
                set data-binding "website"
                set data-top 200
            next
            edit 3
                set header "Hits"
                set data-type aggregate
                set data-binding "hits"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "web-Top-20-Category-and-Websites-by-Bandwidth"
        set disp-name "Top 20 Category and Websites by Bandwidth"
        set category "Traffic"
        set description "Top 20 category and websites by bandwidth usage"
        set dataset "web-Top-Category-and-Websites-by-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Category"
                set data-binding "catdesc"
                set column-attr web-cat
                set data-top 20
            next
            edit 2
                set header "Website"
                set data-type drilldown
                set data-binding "website"
                set data-top 20
            next
            edit 3
                set header "Bandwdith"
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next

    edit "web-Top-20-Category-and-Websites-by-Session"
        set disp-name "Top 20 Category and Websites by Sessions"
        set category "Traffic"
        set description "Top 20 category and websites by session count"
        set dataset "web-Top-Category-and-Websites-by-Session"
        set chart-type table
        config table-columns
            edit 1
                set header "Category"
                set data-binding "catdesc"
                set column-attr web-cat
                set data-top 20
            next
            edit 2
                set header "Website"
                set data-type drilldown
                set data-binding "website"
                set data-top 20
            next
            edit 3
                set header "Sessions"
                set data-type aggregate
                set data-binding "hits"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "web-Top-500-Website-Sessions-by-Bandwidth"
        set disp-name "Top 500 Websites by Bandwidth"
        set category "Traffic"
        set description "Top 500 website sessions by bandwidth usage"
        set dataset "web-Top-Website-Sessions-by-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Timestamp"
                set data-binding "timestamp"
                set data-top 500
                set column-width 20
            next
            edit 2
                set header "Duration (MIN)"
                set data-binding "dura"
                set column-width 0
            next
            edit 3
                set header "User (or IP)"
                set data-binding "user_src"
                set column-attr user
                set column-width 20
            next
            edit 4
                set header "Website"
                set data-binding "website"
                set column-width 20
            next
            edit 5
                set header "Category"
                set data-binding "catdesc"
                set column-attr web-cat
                set column-width 20
            next
            edit 6
                set header "Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-width 0
            next
        end
        set protected enable
    next

    edit "web-Top-500-User-Visted-Websites-by-Bandwidth"
        set disp-name "User Top 500 Websites by Bandwidth"
        set category "Traffic"
        set description "Top 500 user visted websites by bandwidth usage"
        set dataset "web-Top-User-Visted-Websites-by-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Website"
                set data-binding "website"
                set data-top 500
                set column-width 30
            next
            edit 2
                set header "Category"
                set data-binding "catdesc"
                set column-attr web-cat
                set column-width 30
            next
            edit 3
                set header "Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-width 40
            next
        end
        set protected enable
    next

    edit "web-Top-500-User-Visted-Websites-by-Session"
        set disp-name "User Top 500 Websites by Sessions"
        set category "Traffic"
        set description "Top 500 user visted websites by session count"
        set dataset "web-Top-User-Visted-Websites-by-Session"
        set chart-type table
        config table-columns
            edit 1
                set header "Website"
                set data-binding "website"
                set data-top 500
                set column-width 30
            next
            edit 2
                set header "Category"
                set data-binding "catdesc"
                set column-attr web-cat
                set column-width 30
            next
            edit 3
                set header "Hits"
                set data-binding "sessions"
                set column-attr count
                set column-width 40
            next
        end
        set protected enable
    next







    edit "os-Detect-OS-Count"
        set disp-name "Detected OS Count"
        set category "Traffic"
        set description "Detected operating system count"
        set dataset "os-Detect-OS-Count"
        set chart-type pie
        config table-columns
            edit 1
                set header "OS Type"
                set data-binding "os"
                set data-top 0
            next
            edit 2
                set header "Total Number"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr none
            next
        end
        set protected enable
    next

    edit "drilldown-Top-App-By-Sessions-Table"
        set disp-name "Drilldown Top 20 Applications by Sessions"
        set category "Application"
        set description "Drilldown top 20 applications by session count"
        set hidden enable
        set dataset "drilldown-Top-App-By-Sessions"
        set chart-type table
        config table-columns
            edit 1
                set header "Application"
                set data-binding "appid"
                set column-attr app-id
                set column-span 2
                set data-top 20
            next
            edit 2
                set data-binding "app"
            next
            edit 3
                set header "Sessions"
                set data-binding "sessions"
            next
        end
        set protected enable
    next
    edit "drilldown-Top-App-By-Sessions-Bar"
        set disp-name "Drilldown Top 20 Applications by Sessions Bar Chart"
        set category "Application"
        set description "Drilldown top 20 applications by session count bar chart"
        set hidden enable
        set dataset "drilldown-Top-App-By-Sessions"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "Application"
                set data-binding "app"
                set data-top 20
            next
            edit 2
                set header "Sessions"
                set data-type aggregate
                set data-binding "sessions"
            next
        end
        set protected enable
    next
    edit "drilldown-Top-App-By-Bandwidth-Table"
        set disp-name "Drilldown Top 20 Applications by Bandwidth"
        set category "Application"
        set description "Drilldown top 20 applications by bandwidth usage"
        set hidden enable
        set dataset "drilldown-Top-App-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Application"
                set data-binding "appid"
                set column-attr app-id
                set column-span 2
                set data-top 20
            next
            edit 2
                set data-binding "app"
            next
            edit 3
                set header "Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "drilldown-Top-App-By-Bandwidth-Bar"
        set disp-name "Drilldown Top 20 Applications by Bandwidth Bar Chart"
        set category "Application"
        set description "Drilldown top 20 applications by bandwidth usage bar chart"
        set hidden enable
        set dataset "drilldown-Top-App-By-Bandwidth"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "Application"
                set data-binding "app"
                set data-top 20
            next
            edit 2
                set header "Bytes"
                set data-type aggregate
                set data-binding "bandwidth"
            next
        end
        set protected enable
    next
    edit "drilldown-Top-Destination-By-Sessions-Table"
        set disp-name "Drilldown Top 20 Destination by Sessions"
        set category "Network Usage"
        set description "Drilldown top 20 destination by session count"
        set hidden enable
        set dataset "drilldown-Top-Destination-By-Sessions"
        set chart-type table
        config table-columns
            edit 1
                set header "Destination"
                set data-binding "dstip"
                set data-top 20
            next
            edit 2
                set header "Sessions"
                set data-binding "sessions"
            next
        end
        set protected enable
    next
    edit "drilldown-Top-Destination-By-Bandwidth-Table"
        set disp-name "Drilldown Top 20 Destination by Bandwidth"
        set category "Network Usage"
        set description "Drilldown top 20 destination by bandwidth usage"
        set hidden enable
        set dataset "drilldown-Top-Destination-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Destination"
                set data-binding "dstip"
                set data-top 20
            next
            edit 2
                set header "Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "drilldown-Top-User-By-Sessions-Table"
        set disp-name "Drilldown Top 20 User by Sessions"
        set category "Network Usage"
        set description "Drilldown top 20 users by session count"
        set hidden enable
        set dataset "drilldown-Top-User-By-Sessions"
        set chart-type table
        config table-columns
            edit 1
                set header "Source"
                set data-binding "user_src"
                set data-top 20
            next
            edit 2
                set header "Sessions"
                set data-binding "sessions"
            next
        end
        set protected enable
    next
    edit "drilldown-Top-User-By-Sessions-Bar"
        set disp-name "Drilldown Top 20 User by Sessions Bar Chart"
        set category "Network Usage"
        set description "Drilldown top 20 users by session count bar chart"
        set hidden enable
        set dataset "drilldown-Top-User-By-Sessions"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set data-top 20
            next
            edit 2
                set header "Sessions"
                set data-type aggregate
                set data-binding "sessions"
            next
        end
        set protected enable
    next
    edit "drilldown-Top-User-By-Bandwidth-Table"
        set disp-name "Drilldown Top 20 User by Bandwidth"
        set category "Network Usage"
        set description "Drilldown top 20 users by bandwidth"
        set hidden enable
        set dataset "drilldown-Top-User-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Source"
                set data-binding "user_src"
                set data-top 20
            next
            edit 2
                set header "Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "drilldown-Top-User-By-Bandwidth-Bar"
        set disp-name "Drilldown Top 20 User by Bandwidth Bar Chart"
        set category "Network Usage"
        set description "Drilldown top 20 users by bandwidth usage bar chart"
        set hidden enable
        set dataset "drilldown-Top-User-By-Bandwidth"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set data-top 20
            next
            edit 2
                set header "Bytes"
                set data-type aggregate
                set data-binding "bandwidth"
            next
        end
        set protected enable
    next
    edit "drilldown-Top-Web-User-By-Visit-Table"
        set disp-name "Drilldown Top 20 Web User by Visits"
        set category "Web"
        set description "Drilldown top 20 web users by visits"
        set hidden enable
        set dataset "drilldown-Top-Web-User-By-Visit"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set column-attr user
                set data-top 20
            next
            edit 2
                set header "Visits"
                set data-binding "visits"
            next
        end
        set protected enable
    next
    edit "drilldown-Top-Web-User-By-Visit-Bar"
        set disp-name "Drilldown Top 20 Web User by Visits Bar Chart"
        set category "Web"
        set description "Drilldown top 20 web users by visits bar chart"
        set hidden enable
        set dataset "drilldown-Top-Web-User-By-Visit"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set data-top 20
            next
            edit 2
                set header "Visits"
                set data-type aggregate
                set data-binding "visits"
            next
        end
        set protected enable
    next
    edit "drilldown-Top-Website-By-Request-Table"
        set disp-name "Drilldown Top 20 Website by Requests"
        set category "Web"
        set description "Drilldown top 20 web sites by requests"
        set hidden enable
        set dataset "drilldown-Top-Website-By-Request"
        set chart-type table
        config table-columns
            edit 1
                set header "Website"
                set data-binding "hostname"
                set data-top 20
            next
            edit 2
                set header "Visits"
                set data-type aggregate
                set data-binding "visits"
            next
        end
        set protected enable
    next
    edit "drilldown-Top-Website-By-Request-Bar"
        set disp-name "Drilldown Top 20 Website by Requests Bar Chart"
        set category "Web"
        set description "Drilldown top 20 web sites by requests bar chart"
        set hidden enable
        set dataset "drilldown-Top-Website-By-Request"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "Sites"
                set data-binding "hostname"
                set data-top 20
            next
            edit 2
                set header "Visits"
                set data-type aggregate
                set data-binding "visits"
            next
        end
        set protected enable
    next
    edit "drilldown-Top-Email-Sender-By-Volume"
        set disp-name "Drilldown Top 20 Email Sender by Volume"
        set category "Email"
        set description "Drilldown top 20 email senders by volume"
        set hidden enable
        set dataset "drilldown-Top-Email-Sender-By-Volume"
        set chart-type table
        config table-columns
            edit 1
                set header "Sender"
                set data-binding "sender"
                set column-attr email-sender
                set data-top 20
            next
            edit 2
                set header "Volume"
                set data-binding "volume"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "drilldown-Top-Email-Send-Recipient-By-Volume"
        set disp-name "Drilldown Top 20 Email Send Recipient by Volume"
        set category "Email"
        set description "Drilldown top 20 Email-Send recipients by volume"
        set hidden enable
        set dataset "drilldown-Top-Email-Send-Recipient-By-Volume"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "Recipient"
                set data-binding "recipient"
                set data-top 20
            next
            edit 2
                set header "Volume"
                set data-type aggregate
                set data-binding "volume"
            next
        end
        set protected enable
    next
    edit "drilldown-Top-Email-Sender-By-Count"
        set disp-name "Drilldown Top 20 Email Sender by Count"
        set category "Email"
        set description "Drilldown top 20 email senders by count"
        set hidden enable
        set dataset "drilldown-Top-Email-Sender-By-Count"
        set chart-type table
        config table-columns
            edit 1
                set header "Sender"
                set data-binding "sender"
                set column-attr email-sender
                set data-top 20
            next
            edit 2
                set header "Number of Emails"
                set data-binding "requests"
            next
        end
        set protected enable
    next
    edit "drilldown-Top-Email-Send-Recipient-By-Count"
        set disp-name "Drilldown Top 20 Email Send Recipient by Count"
        set category "Email"
        set description "Drilldown top 20 email-send recipients by count"
        set hidden enable
        set dataset "drilldown-Top-Email-Send-Recipient-By-Count"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "Recipient"
                set data-binding "recipient"
                set data-top 20
            next
            edit 2
                set header "Number of Emails"
                set data-type aggregate
                set data-binding "requests"
            next
        end
        set protected enable
    next
    edit "drilldown-Top-Email-Recipient-By-Volume"
        set disp-name "Drilldown Top 20 Email Recipient by Volume"
        set category "Email"
        set description "Drilldown top 20 email recipients by volume"
        set hidden enable
        set dataset "drilldown-Top-Email-Receiver-By-Volume"
        set chart-type table
        config table-columns
            edit 1
                set header "Recipient"
                set data-binding "recipient"
                set column-attr email-recver
                set data-top 20
            next
            edit 2
                set header "Volume"
                set data-binding "volume"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "drilldown-Top-Email-Receive-Sender-By-Volume"
        set disp-name "Drilldown Top 20 Email Receive Sender by Volume"
        set category "Email"
        set description "Drilldown top 20 email-receive senders by volume"
        set hidden enable
        set dataset "drilldown-Top-Email-Receive-Sender-By-Volume"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "Sender"
                set data-binding "sender"
                set data-top 20
            next
            edit 2
                set header "Volume"
                set data-type aggregate
                set data-binding "volume"
            next
        end
        set protected enable
    next
    edit "drilldown-Top-Email-Recipient-By-Count"
        set disp-name "Drilldown Top 20 Email Recipient by Count"
        set category "Email"
        set description "Drilldown top 20 email recipients by count"
        set hidden enable
        set dataset "drilldown-Top-Email-Receiver-By-Count"
        set chart-type table
        config table-columns
            edit 1
                set header "Recipient"
                set data-binding "recipient"
                set column-attr email-recver
                set data-top 20
            next
            edit 2
                set header "Number of Emails"
                set data-binding "requests"
            next
        end
        set protected enable
    next
    edit "drilldown-Top-Email-Receive-Sender-By-Count"
        set disp-name "Drilldown Top 20 Email Receive Sender by Count"
        set category "Email"
        set description "Drilldown top 20 email-receive senders by count"
        set hidden enable
        set dataset "drilldown-Top-Email-Receive-Sender-By-Count"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "Sender"
                set data-binding "sender"
                set data-top 20
            next
            edit 2
                set header "Number of Emails"
                set data-type aggregate
                set data-binding "requests"
            next
        end
        set protected enable
    next
    edit "drilldown-Top-Attack-Destination"
        set disp-name "Drilldown Top 20 Attack Destination"
        set category "Threat"
        set description "Drilldown top 20 attack destinations"
        set hidden enable
        set dataset "drilldown-Top-Attack-Dest"
        set chart-type table
        config table-columns
            edit 1
                set header "Attack Destination"
                set data-binding "victim"
                set column-attr user
                set data-top 20
            next
            edit 2
                set header "Occurrences"
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "drilldown-Top-Attack-Source"
        set disp-name "Drilldown Top Attack Source"
        set category "Threat"
        set description "Drilldown top attack sources"
        set hidden enable
        set dataset "drilldown-Top-Attack-Source"
        set chart-type table
        config table-columns
            edit 1
                set header "Attack Source"
                set data-binding "source"
            next
            edit 2
                set header "Occurrences"
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "drilldown-Top-Attack-List"
        set disp-name "Drilldown Top 20 Attack List"
        set category "Threat"
        set description "Drilldown top 20 attack list"
        set hidden enable
        set dataset "drilldown-Top-Attack-List"
        set chart-type table
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "timestamp"
                set data-top 20
            next
            edit 2
                set header "Attack Name"
                set data-binding "attack"
            next
            edit 3
                set header "Source"
                set data-binding "source"
            next
            edit 4
                set header "Destination"
                set data-binding "victim"
            next
        end
        set protected enable
    next
    edit "drilldown-Top-Virus"
        set disp-name "Drilldown Top 20 Viruses"
        set category "Threat"
        set description "Drilldown top 20 viruses"
        set hidden enable
        set dataset "utm-Top-Virus"
        set chart-type table
        config table-columns
            edit 1
                set header "Virus Name"
                set data-binding "virus"
                set column-attr virus
                set data-top 20
            next
            edit 2
                set header "Occurrences"
                set data-binding "totalnum"
            next
        end
        set protected enable
    next
    edit "drilldown-Virus-Detail"
        set disp-name "Drilldown Virus Details"
        set category "Threat"
        set description "Drilldown virus details"
        set hidden enable
        set dataset "drilldown-Virus-Detail"
        set chart-type table
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "timestamp"
            next
            edit 2
                set header "Virus"
                set data-binding "virus"
            next
            edit 3
                set header "Source"
                set data-binding "user_src"
            next
            edit 4
                set header "Destination"
                set data-binding "victim"
            next
            edit 5
                set header "Host Name"
                set data-binding "hostname"
            next
            edit 6
                set header "Recipient"
                set data-binding "recipient"
            next
        end
        set protected enable
    next

    edit "user-drilldown-Top-Blocked-Web-Sites-By-Requests"
        set disp-name "User Drilldown Top Blocked Web Sites by Requests"
        set category "Web"
        set description "User drilldown top 10 blocked web sites by requests"
        set hidden enable
        set dataset "user-drilldown-Top-Blocked-Web-Sites-By-Requests"
        set chart-type table
        config table-columns
            edit 1
                set header "Website"
                set data-binding "hostname"
                set data-top 10
                set column-width 40
                set column-attr obf-url
            next
            edit 2
                set header "Requests"
                set data-binding "requests"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "user-drilldown-Top-Allowed-Web-Sites-By-Requests"
        set disp-name "User Drilldown Top Allowed Web Sites by Requests"
        set category "Web"
        set description "User drilldown top 10 allowed web sites by requests"
        set hidden enable
        set dataset "user-drilldown-Top-Allowed-Web-Sites-By-Requests"
        set chart-type table
        config table-columns
            edit 1
                set header "Website"
                set data-binding "hostname"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Requests"
                set data-binding "requests"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "user-drilldown-Top-Blocked-Web-Categories"
        set disp-name "User Drilldown Top Blocked Web Categories"
        set category "Web"
        set description "User drilldown top 10 bloacked web categories"
        set hidden enable
        set dataset "user-drilldown-Top-Blocked-Web-Categories"
        set chart-type table
        config table-columns
            edit 1
                set header "Category"
                set data-binding "catdesc"
                set column-attr web-cat
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Requests"
                set data-binding "requests"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "user-drilldown-Top-Allowed-Web-Categories"
        set disp-name "User Drilldown Top Allowed Web Categories"
        set category "Web"
        set description "User drilldown top 10 allowed web categories"
        set hidden enable
        set dataset "user-drilldown-Top-Allowed-Web-Categories"
        set chart-type table
        config table-columns
            edit 1
                set header "Category"
                set data-binding "catdesc"
                set column-attr web-cat
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Requests"
                set data-binding "requests"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "user-drilldown-Top-Attacks"
        set disp-name "User Drilldown Top Attacks"
        set category "Threat"
        set description "User drilldown top 10 attacks"
        set hidden enable
        set dataset "user-drilldown-Top-Attacks-By-Name"
        set chart-type table
        config table-columns
            edit 1
                set header "Attack Name"
                set data-binding "attack"
                set column-attr url
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Counts"
                set data-binding "attack_count"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "attack_count"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "user-drilldown-Top-Attacks-High-Severity"
        set disp-name "User Drilldown Top Attacks High Severity"
        set category "Threat"
        set description "User drilldown top 10 attacks high severity"
        set hidden enable
        set dataset "user-drilldown-Top-Attacks-High-Severity"
        set chart-type table
        config table-columns
            edit 1
                set header "Attack Name"
                set data-binding "attack"
                set column-attr url
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Counts"
                set data-binding "attack_count"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "attack_count"
                set column-attr count
            next
        end

        set protected enable
    next
    edit "user-drilldown-Top-Virus-By-Name"
        set disp-name "User Drilldown Top Virus by Name"
        set category "Threat"
        set description "User drilldown top 10 virus by name"
        set hidden enable
        set dataset "user-drilldown-Top-Virus"
        set chart-type table
        config table-columns
            edit 1
                set header "Virus Name"
                set data-binding "virusid"
                set column-attr url
                set column-span 2
                set data-top 10
                set column-width 40
            next
            edit 2
                set data-binding "virus"
                set column-attr virus
            next
            edit 3
                set header "Counts"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 4
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "user-drilldown-Top-Virus-Receivers-Over-Email"
        set disp-name "User Drilldown Top Virus Receivers Over Email"
        set category "Threat"
        set description "User Drilldown top 10 virus receivers over email"
        set hidden enable
        set dataset "user-drilldown-Top-Virus-Receivers-Over-Email"
        set chart-type table
        config table-columns
            edit 1
                set header "Receiver"
                set data-binding "receiver"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Counts"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "user-drilldown-Count-Spam-Activity-by-Hour-of-Day"
        set disp-name "User Drilldown Count Spam Activity by Hour Of Day"
        set category "Email"
        set description "User drilldown count of spam activity by hour of day"
        set hidden enable
        set dataset "user-drilldown-Count-Spam-Activity-by-Hour-of-Day"
        set chart-type table
        config table-columns
            edit 1
                set header "Hour Of Day"
                set data-binding "hourstamp"
                set data-top 0
                set column-width 40
            next
            edit 2
                set header "Count"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "user-drilldown-Top-Spam-Sources"
        set disp-name "User Drilldown Top Spam Sources"
        set category "Email"
        set description "User drilldown top 10 spam sources"
        set hidden enable
        set dataset "user-drilldown-Top-Spam-Sources"
        set chart-type table
        config table-columns
            edit 1
                set header "Spam Source"
                set data-binding "mf_sender"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Count"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "event-Usage-CPU"
        set disp-name "CPU Usage"
        set category "Event"
        set description "CPU usage"
        set dataset "event-Usage-CPU"
        set resolve-hostname disable
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "Hour of Day"
                set data-binding "hourstamp"
                set data-top 0
            next
            edit 2
                set header "Percentage Usage"
                set data-type aggregate
                set column-attr percent
                set data-binding "cpu_avg_usage"
            next
        end
        set protected enable
    next
    edit "event-Usage-Memory"
        set disp-name "Memory Usage"
        set category "Event"
        set description "Memory usage"
        set dataset "event-Usage-Mem"
        set resolve-hostname disable
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "Hour of Day"
                set data-binding "hourstamp"
                set data-top 0
            next
            edit 2
                set header "Percentage Usage"
                set data-type aggregate
                set column-attr percent
                set data-binding "mem_avg_usage"
            next
        end
        set protected enable
    next
    edit "event-Usage-Sessions"
        set disp-name "Session Usage"
        set category "Event"
        set description "Session usage"
        set dataset "event-Usage-Sessions"
        set resolve-hostname disable
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "Hour of Day"
                set data-binding "hourstamp"
                set data-top 0
            next
            edit 2
                set header "Sessions Usage"
                set data-type aggregate
                set column-attr count
                set data-binding "sess_avg_usage"
            next
        end
        set protected enable
    next
    edit "event-Usage-CPU-Sessions"
        set disp-name "CPU Session Usage"
        set category "Event"
        set description "CPU session usage"
        set dataset "event-Usage-CPU-Sessions"
        set resolve-hostname disable
        set chart-type table
        config table-columns
            edit 1
                set header "Hour of Day"
                set data-binding "hourstamp"
                set data-top 0
                set column-width 30
            next
            edit 2
                set header "CPU Usage"
                set data-binding "cpu_avg_usage"
                set data-top 0
                set column-width 30
            next
            edit 3
                set header "Sessions Usage"
                set data-binding "sess_avg_usage"
                set data-top 0
                set column-width 40
            next
        end
        set protected enable
    next
    edit "App-Risk-Top-Users-By-Bandwidth"
        set disp-name "Top 20 Users by Bandwidth"
        set category "Network Usage"
        set description "Top 20 users by bandwidth usage"
        set dataset "Top-Users-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set column-attr user
                set data-top 20
                set column-width 30
            next
            edit 2
                set header "Source IP"
                set data-binding "srcip"
                set column-width 30
            next
            edit 3
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 40
            next
            edit 4
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 5
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "App-Risk-Top-User-Source-By-Sessions"
        set disp-name "Top 20 Users or Sources by Sessions"
        set category "Network Usage"
        set description "Top 20 users or sources by session count"
        set dataset "App-Risk-Top-User-Source-By-Sessions"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set column-attr user
                set data-top 20
                set column-width 30
            next
            edit 2
                set header "Source IP"
                set data-binding "srcip"
                set column-width 30
            next
            edit 3
                set header "Sessions"
                set data-binding "sessions"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 4
                set data-binding "sessions"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "App-Risk-Top-Users-By-Reputation-Scores-Bar"
        set disp-name "Top Users Threat Score"
        set category "Network Usage"
        set description "Top 10 users by threat score"
        set dataset "App-Risk-Reputation-Top-Users-By-Scores"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set column-attr user
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Scores"
                set data-binding "scores"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "scores"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "App-Risk-Top-Devices-By-Reputation-Scores"
        set disp-name "Top Devices by Threat Score"
        set category "Network Usage"
        set description "Top 10 devices by threat score in risk"
        set dataset "App-Risk-Reputation-Top-Devices-By-Scores"
        set chart-type table
        config table-columns
            edit 1
                set header "Device"
                set data-binding "devtype_new"
                set column-attr dev-type
                set column-span 2
                set data-top 10
                set column-width 40
            next
            edit 2
                set data-binding "dev_src"
            next
            edit 3
                set header "Scores"
                set data-binding "scores"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 4
                set data-binding "scores"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "App-Risk-Application-Usage-By-Category-With-Pie"
        set disp-name "Top Application Categories Bandwidth"
        set category "Application"
        set description "Top 10 application categories by bandwidth usage"
        set dataset "App-Risk-App-Usage-By-Category"
        set chart-type pie
        config table-columns
            edit 1
                set header "Application Category"
                set data-binding "appcat"
                set column-attr appcat
                set data-top 10
            next
            edit 2
                set header "Bytes"
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "App-Risk-App-Usage-by-Category"
        set disp-name "Top 30 Application Categories by Bandwidth"
        set category "Application"
        set description "Top 30 application categories by bandwidth usage"
        set dataset "App-Risk-App-Usage-By-Category"
        set chart-type table
        config table-columns
            edit 1
                set header "Application Category"
                set data-binding "appcat"
                set column-attr appcat
                set data-top 30
                set column-width 40
            next
            edit 2
                set header "Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-width 60
            next
        end
        set protected enable
    next
    edit "Top-20-Categories-By-Bandwidth"
        set disp-name "Top 20 Application Categories by Bandwidth"
        set category "Application"
        set description "Top 20 application categories by bandwidth usage"
        set dataset "webfilter-Categories-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Category"
                set data-binding "catdesc"
                set column-attr web-cat
                set data-top 20
                set column-width 40
            next
            edit 2
                set header "Bytes"
                set data-binding "bandwidth"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "bandwidth"
                set column-attr bandwidth
            next

        end
        set protected enable
    next

    edit "App-Risk-Key-Applications-Crossing-The-Network"
        set disp-name "Top 30 Key Applications"
        set category "Application"
        set description "Top 30 key applications crossing the network"
        set dataset "App-Risk-Application-Activity-APP"
        set chart-type table
        config table-columns
            edit 1
                set header "Application"
                set data-binding "app_group"
                set data-top 30
                set column-width 30
            next
            edit 2
                set header "Category"
                set data-binding "appcat"
                set column-attr appcat
                set column-width 30
            next
            edit 3
                set header "Sessions"
                set data-binding "num_session"
                set column-attr count
                set column-width 20
            next
            edit 4
                set header "Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-width 20
            next
        end
        set protected enable
    next
    edit "App-Risk-Applications-Running-Over-HTTP"
        set disp-name "Applications Running over HTTP"
        set category "Application"
        set description "Applications running over HTTP protocol"
        set dataset "App-Risk-Applications-Running-Over-HTTP"
        set chart-type table
        config table-columns
            edit 1
                set header "Application"
                set data-binding "app_group"
                set data-top 25
                set column-width 40
            next
            edit 2
                set header "Sessions"
                set data-binding "sessions"
                set column-attr count
                set column-width 30
            next
            edit 3
                set header "Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-width 30
            next
        end
        set protected enable
    next
    edit "App-Risk-Top-Web-Sites-Visited-By-Network-Users-Pie-Cha"
        set disp-name "Top Web Categories by Bandwidth and Sessions"
        set category "Web"
        set description "Top 10 web filtering categories by bandwidth usage and session count"
        set dataset "App-Risk-Web-Browsing-Summary-Category"
        set chart-type pie
        config table-columns
            edit 1
                set header "Category Description"
                set data-binding "catdesc"
                set column-attr web-cat
                set data-top 10
            next
            edit 2
                set header "Number of Sessions"
                set data-type aggregate
                set data-binding "num_sess"
                set column-attr none
            next
        end
        set protected enable
    next
    edit "App-Risk-Top-Web-Sites-Visited-By-Network-Users"
        set disp-name "Top 20 Web Categories by Bandwidth and Sessions"
        set category "Web"
        set description "Top 20 web filtering categories by bandwidth usage and session count"
        set dataset "App-Risk-Web-Browsing-Summary-Category"
        set chart-type table
        config table-columns
            edit 1
                set header "Category Description"
                set data-binding "catdesc"
                set column-attr web-cat
                set data-top 20
                set column-width 40
            next
            edit 2
                set header "Sessions"
                set data-binding "num_sess"
                set column-attr count
                set column-width 30
            next
            edit 3
                set header "Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-width 30
            next
        end
        set protected enable
    next
    edit "App-Risk-Web-Browsing-Hostname-Category"
        set disp-name "Top 20 Web Domains by Visits"
        set category "Web"
        set description "Top 20 visited web domains by number of visits"
        set dataset "App-Risk-Web-Browsing-Activity-Hostname-Category"
        set chart-type table
        config table-columns
            edit 1
                set header "Domain"
                set data-binding "domain"
                set data-top 20
                set column-width 40
            next
            edit 2
                set header "Category"
                set data-binding "catdesc"
                set column-attr web-cat
                set column-width 30
            next
            edit 3
                set header "Visits"
                set data-binding "visits"
                set column-attr count
                set column-width 30
            next
        end
        set protected enable
    next
    edit "Top-Destination-Countries-By-Browsing-Time"
        set disp-name "Top 15 Destination Countries by Browsing Time"
        set category "Web"
        set description "Top 15 destination countries by browsing time"
        set dataset "traffic-Top-Destination-Countries-By-Browsing-Time"
        set chart-type table
        config table-columns
            edit 1
                set header "Destination Country/Region"
                set data-binding "dstcountry"
                set column-attr dst-country
                set data-top 15
                set column-width 30
            next
            edit 2
                set header "Browsing Time(hh:mm:ss)"
                set data-binding "browsetime"
                set column-graph-type bar
                set column-span 2
                set column-width 30
            next
            edit 3
                set data-binding "browsetime"
                set column-attr timespan
            next
            edit 4
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 40
            next
            edit 5
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 6
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "App-Risk-Traffic-Top-Hostnames-By-Browsing-Time"
        set disp-name "Top 15 Websites by Browsing Time"
        set category "Network Usage"
        set description "Top 15 websites by browsing time"
        set dataset "traffic-Top-Domains-By-Browsing-Time"
        set chart-type table
        config table-columns
            edit 1
                set header "Website"
                set data-binding "hostname"
                set data-top 15
                set column-width 30
            next
            edit 2
                set header "Browsing Time(hh:mm:ss)"
                set data-binding "browsetime"
                set column-span 2
                set column-graph-type bar
                set column-width 30
            next
            edit 3
                set data-binding "browsetime"
                set column-attr timespan
            next
            edit 4
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 40
            next
            edit 5
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 6
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "App-Risk-Top-Threat-Vectors-Crossing-The-Network"
        set disp-name "Top 5 IPS Events by Severity"
        set category "Threat"
        set description "Top 5 intrusion protection events by severity"
        set dataset "App-Risk-Top-Threat-Vectors"
        set chart-type pie
        config table-columns
            edit 1
                set header "Severity"
                set data-binding "severity"
                set data-top 5
            next
            edit 2
                set header "Total Num"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr none
            next
        end
        set protected enable
    next
    edit "App-Risk-Top-Critical-Threat-Vectors-Crossing-The-Network"
        set disp-name "Top Critical Severity IPS Events"
        set category "Threat"
        set description "Top 10 critical severity intrusion protection events"
        set dataset "App-Risk-Top-Critical-Threat-Vectors"
        set chart-type table
        config table-columns
            edit 1
                set header "Attack Name"
                set data-binding "ref"
                set column-attr url
                set column-span 2
                set data-top 10
                set column-width 40
            next
            edit 2
                set data-binding "attack"
                set data-top 10
            next
            edit 3
                set header "Reference"
                set data-binding "ref"
                set column-width 30
            next
            edit 4
                set header "Total Num"
                set data-binding "totalnum"
                set column-attr count
                set column-width 30
            next
        end
        set protected enable
    next
    edit "App-Risk-Top-High-Threat-Vectors-Crossing-The-Network"
        set disp-name "Top High Severity IPS Events"
        set category "Threat"
        set description "Top 10 high severity intrusion protection events"
        set dataset "App-Risk-Top-High-Threat-Vectors"
        set chart-type table
        config table-columns
            edit 1
                set header "Attack Name"
                set data-binding "ref"
                set column-attr url
                set column-span 2
                set data-top 10
                set column-width 40
            next
            edit 2
                set data-binding "attack"
                set data-top 10
            next
            edit 3
                set header "Reference"
                set data-binding "ref"
                set column-width 30
            next
            edit 4
                set header "Total Num"
                set data-binding "totalnum"
                set column-attr count
                set column-width 30
            next
        end
        set protected enable
    next
    edit "App-Risk-Top-Medium-Threat-Vectors-Crossing-The-Network"
        set disp-name "Top Medium Severity IPS Events"
        set category "Threat"
        set description "Top 10 medium severity intrusion protection events"
        set dataset "App-Risk-Top-Medium-Threat-Vectors"
        set chart-type table
        config table-columns
            edit 1
                set header "Attack Name"
                set data-binding "ref"
                set column-attr url
                set column-span 2
                set data-top 10
                set column-width 40
            next
            edit 2
                set data-binding "attack"
                set data-top 10
            next
            edit 3
                set header "Reference"
                set data-binding "ref"
                set column-width 30
            next
            edit 4
                set header "Total Num"
                set data-binding "totalnum"
                set column-attr count
                set column-width 30
            next
        end
        set protected enable
    next
    edit "App-Risk-Top-Low-Threat-Vectors-Crossing-The-Network"
        set disp-name "Top Low Severity IPS Events"
        set category "Threat"
        set description "Top 10 low severity intrusion protection events"
        set dataset "App-Risk-Top-Low-Threat-Vectors"
        set chart-type table
        config table-columns
            edit 1
                set header "Attack Name"
                set data-binding "ref"
                set column-attr url
                set column-span 2
                set data-top 10
                set column-width 40
            next
            edit 2
                set data-binding "attack"
                set data-top 10
            next
            edit 3
                set header "Reference"
                set data-binding "ref"
                set column-width 30
            next
            edit 4
                set header "Total Num"
                set data-binding "totalnum"
                set column-attr count
                set column-width 30
            next
        end
        set protected enable
    next
    edit "App-Risk-Top-Info-Threat-Vectors-Crossing-The-Network"
        set disp-name "Top Informational Severity IPS Events"
        set category "Threat"
        set description "Top 10 informational severity intrusion protection events"
        set dataset "App-Risk-Top-Info-Threat-Vectors"
        set chart-type table
        config table-columns
            edit 1
                set header "Attack Name"
                set data-binding "ref"
                set column-attr url
                set column-span 2
                set data-top 10
                set column-width 40
            next
            edit 2
                set data-binding "attack"
                set data-top 10
            next
            edit 3
                set header "Reference"
                set data-binding "ref"
                set column-width 30
            next
            edit 4
                set header "Total Num"
                set data-binding "totalnum"
                set column-attr count
                set column-width 30
            next
        end
        set protected enable
    next
    edit "App-Risk-Top-Virus-By-Name"
        set disp-name "Top 20 Viruses"
        set category "Threat"
        set description "Top 20 viruses detected"
        set dataset "utm-Top-Virus"
        set chart-type table
        config table-columns
            edit 1
                set header "Virus Name"
                set data-binding "virusid"
                set column-attr url
                set column-span 2
                set data-top 20
                set column-width 40
            next
            edit 2
                set data-binding "virus"
                set column-attr virus
            next
            edit 3
                set header "Occurrences"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 4
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "App-Risk-Top-Virus-Victim"
        set disp-name "Top 20 Virus Victims"
        set category "Threat"
        set description "Top 20 virus victims"
        set dataset "utm-Top-Virus-User"
        set chart-type table
        config table-columns
            edit 1
                set header "Virus Victims"
                set data-binding "user_src"
                set column-attr user
                set data-top 20
                set column-width 40
            next
            edit 2
                set header "Occurrences"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "App-Risk-Data-Loss-Prevention-Type-Events"
        set disp-name "Top DLP Events"
        set category "DLP"
        set description "Top 10 data leak prevention events"
        set dataset "App-Risk-DLP-UTM-Event"
        set chart-type table
        config table-columns
            edit 1
                set header "DLP Type"
                set data-binding "utmsubtype"
                set data-top 10
                set column-width 60
            next
            edit 2
                set header "Number"
                set data-binding "number"
                set column-attr count
                set column-width 40
            next
        end
        set protected enable
    next
    edit "App-Risk-Vulnerability-Discovered"
        set disp-name "Top Application Vulnerabilities"
        set category "Other"
        set description "Top 10 application vulnerabilities discovered"
        set dataset "App-Risk-Vulnerability-Discovered"
        set chart-type table
        config table-columns
            edit 1
                set header "Vulnerability"
                set data-binding "ref"
                set column-attr url
                set column-span 2
                set data-top 10
                set column-width 40
            next
            edit 2
                set data-binding "vuln"
            next
            edit 3
                set header "Category"
                set data-binding "vulncat"
                set column-width 30
            next
            edit 4
                set header "Severity"
                set data-binding "severity"
                set column-width 15
            next
            edit 5
                set header "Count"
                set data-binding "totalnum"
                set column-attr count
                set column-width 15
            next
        end
        set protected enable
    next
    edit "App-Risk-Malware-Discovered"
        set disp-name "Viruses Discovered"
        set category "Network Usage"
        set description "Viruses discovered"
        set dataset "App-Risk-Virus-Discovered"
        set chart-type table
        config table-columns
            edit 1
                set header "Day"
                set data-binding "dom"
                set data-top 7
                set column-width 40
            next
            edit 2
                set header "Malware"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "App-Risk-Breakdown-Of-Risk-Applications"
        set disp-name "Application Risk Distribution"
        set category "Application"
        set description "Application risk distribution"
        set dataset "App-Risk-Breakdown-Of-Risk-Applications"
        set chart-type pie
        config table-columns
            edit 1
                set header "Risk"
                set data-binding "d_behavior"
                set data-top 6
            next
            edit 2
                set header "Number of Applications"
                set data-type aggregate
                set data-binding "number"
                set column-attr none
            next
        end
        set protected enable
    next
    edit "App-Risk-Number-Of-Applications-By-Risk-Behavior"
        set disp-name "Number of Applications by Risk Behaviour"
        set category "Application"
        set description "Number of applications by risk behaviour"
        set dataset "App-Risk-Number-Of-Applications-By-Risk-Behavior"
        set chart-type table
        config table-columns
            edit 1
                set header "Risk"
                set data-binding "f_behavior"
                set data-top 4
                set column-width 30
            next
            edit 2
                set header "Number of Applications"
                set data-binding "number"
                set column-span 2
                set column-graph-type bar
                set column-width 50
            next
            edit 3
                set data-binding "number"
                set column-attr count
            next
            edit 4
                set header "Percentage"
                set data-binding "number"
                set column-attr cal-percent
                set column-width 20
            next
        end
        set protected enable
    next
    edit "App-Risk-High-Risk-Application"
        set disp-name "Top 20 High Risk Applications"
        set category "Application"
        set description "Top 20 high risk applications"
        set dataset "App-Risk-High-Risk-Application"
        set chart-type table
        config table-columns
            edit 1
                set header "Risk"
                set data-binding "d_behavior"
                set data-top 20
                set column-width 12
            next
            edit 2
                set header "Application Name"
                set data-binding "id"
                set column-attr app-id
                set column-span 2
                set column-width 13
            next
            edit 3
                set data-binding "name"
            next
            edit 4
                set header "Category"
                set data-binding "app_cat"
                set column-attr appcat
                set column-width 13
            next
            edit 5
                set header "Technology"
                set data-binding "technology"
                set column-width 12
            next
            edit 6
                set header "Bytes"
                set data-binding "bandwidth"
                set column-span 2
                set column-graph-type bar
                set column-width 25
            next
            edit 7
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
            edit 8
                set header "Sessions"
                set data-binding "sessions"
                set column-span 2
                set column-graph-type bar
                set column-width 25
            next
            edit 9
                set data-binding "sessions"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "Apprisk-Ctrl-Breakdown-Of-High-Risk-Application"
        set disp-name "High Risk Apps"
        set category "Application"
        set description "Breakdown of high risk applications"
        set dataset "apprisk-ctrl-Severe-High-Risk-Apps"
        set chart-type donut
        config table-columns
            edit 1
                set header "High Risk Apps"
                set data-binding "appcat"
                set data-top 10
            next
            edit 2
                set header "Total Number"
                set data-type aggregate
                set data-binding "total_num"
                set column-attr percent
            next
        end
        set protected enable
    next
    edit "Apprisk-Ctrl-High-Risk-Application-Behavioral"
        set disp-name "Application Behavioral Characteristics"
        set category "Application"
        set description "Application Behavioral Characteristics"
        set dataset "apprisk-ctrl-High-Risk-Apps-Behavioral"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "Behavior"
                set data-binding "behavior"
                set data-top 5
            next
            edit 2
                set header "Percentage"
                set data-type aggregate
                set column-attr percent
                set data-binding "percentage"
            next
        end
        set protected enable
    next
    edit "Apprisk-Ctrl-Key-Application-Crossing-The-Network"
        set disp-name "Key Application Crossing The Network"
        set category "Application"
        set description "Top 30 applications crossing the network"
        set dataset "apprisk-ctrl-Key-Application-Crossing-The-Network"
        set chart-type table
        config table-columns
            edit 1
                set header "Risk"
                set data-binding "d_risk"
                set column-attr severity
                set data-top 30
                set column-width 10
            next
            edit 2
                set header "Application Name"
                set data-binding "id"
                set column-attr app-id
                set column-span 2
                set column-width 20
            next
            edit 3
                set data-binding "name"
            next
            edit 4
                set header "Category"
                set data-binding "app_cat"
                set column-attr appcat
                set column-width 20
            next
            edit 5
                set header "Technology"
                set data-binding "technology"
                set column-width 20
            next
            edit 6
                set header "User"
                set data-binding "users"
                set column-attr count
                set column-width 10
            next
            edit 7
                set header "Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-width 10
            next
            edit 8
                set header "Session"
                set data-binding "sessions"
                set column-attr count
                set column-width 10
            next
        end
        set protected enable
    next
    edit "Apprisk-Ctrl-Risk-Application-Usage-By-Category-With-Pie"
        set disp-name "App Categories"
        set category "Application"
        set description "Application categories by bandwidth usage"
        set dataset "App-Risk-App-Usage-By-Category"
        set chart-type donut
        config table-columns
            edit 1
                set header "App Categories"
                set data-binding "appcat"
                set column-attr appcat
                set data-top 10
            next
            edit 2
                set header "Bytes"
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr percent
            next
        end
        set protected enable
    next
    edit "Apprisk-Ctrl-Category-Breakdown-By-Bandwidth"
        set disp-name "Category Breakdown of Applications by Bandwidth"
        set category "Application"
        set description "Category Breakdown of all applications, sorted by Bandwidth"
        set dataset "apprisk-ctrl-Category-Breakdown-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Application Category"
                set data-binding "appcat"
                set column-attr appcat
                set data-top 25
                set column-width 40
            next
            edit 2
                set header "Number of Applications"
                set data-binding "app_num"
                set column-attr count
                set column-width 15
            next
            edit 3
                set header "Number of Users"
                set data-binding "user_num"
                set column-attr count
                set column-width 15
            next
            edit 4
                set header "Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-width 15
            next
            edit 5
                set header "Session"
                set data-binding "num_session"
                set column-attr count
                set column-width 15
            next
        end
        set protected enable
    next
    edit "Apprisk-Ctrl-Common-Virus-Botnet-Spyware"
        set disp-name "Common Virus Botnet and Spyware and Adware"
        set category "Application"
        set description "Common virus discovered, the botnet communications and the spyware/adware"
        set dataset "apprisk-ctrl-Common-Virus-Botnet-Spyware"
        set chart-type table
        config table-columns
            edit 1
                set header "Malware Name"
                set data-binding "virus"
                set column-attr url
                set data-top 25
                set column-width 20
            next
            edit 2
                set header "Type"
                set data-binding "malware_type"
                set column-width 20
            next
            edit 3
                set header "Application"
                set data-binding "appid"
                set column-attr app-id
                set column-span 2
                set column-width 30
            next
            edit 4
                set data-binding "app"
            next
            edit 5
                set header "Victim"
                set data-binding "victims"
                set column-attr count
                set column-width 10
            next
            edit 6
                set header "Source"
                set data-binding "source"
                set column-attr count
                set column-width 10
            next
            edit 7
                set header "Count"
                set data-binding "total_num"
                set column-attr count
                set column-width 10
            next
        end
        set protected enable
    next
    edit "Apprisk-Ctrl-Zero-Day-Detected-On-Network"
        set disp-name "Zero-day Malware Detected on The Network"
        set category "Application"
        set description "Zero-day malware detected on the network"
        set dataset "apprisk-ctrl-Zero-Day-Detected-On-Network"
        set chart-type table
        config table-columns
            edit 1
                set header "Zero-day Malware"
                set data-binding "virus_s"
                set data-top 5
                set column-width 30
            next
            edit 2
                set header "Application"
                set data-binding "appid"
                set column-attr app-id
                set column-span 2
                set column-width 40
            next
            edit 3
                set data-binding "app"
            next
            edit 4
                set header "Victim"
                set data-binding "victims"
                set column-attr count
                set column-width 10
            next
            edit 5
                set header "Source"
                set data-binding "source"
                set column-attr count
                set column-width 10
            next
            edit 6
                set header "Count"
                set data-binding "total_num"
                set column-attr count
                set column-width 10
            next
        end
        set protected enable
    next
    edit "Apprisk-Ctrl-Files-Analyzed-By-FortiCloud-Sandbox"
        set disp-name "Files Analyzed by FortiCloud Sandbox"
        set category "Application"
        set description "Files analyzed by FortiCloud Sandbox"
        set dataset "apprisk-ctrl-Files-Analyzed-By-FortiCloud-Sandbox"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "Date"
                set data-binding "dom"
                set data-top 7
            next
            edit 2
                set header "Count"
                set data-type aggregate
                set data-binding "total_num"
            next
        end
        set protected enable
    next
    edit "Apprisk-Ctrl-File-Transferred-By-Application"
        set disp-name "File Transferred by Applications"
        set category "Application"
        set description "File transferred by applications on the network"
        set dataset "apprisk-ctrl-File-Transferred-By-Application"
        set chart-type table
        config table-columns
            edit 1
                set header "File Name"
                set data-binding "filename"
                set data-top 20
                set column-width 35
            next
            edit 2
                set header "Upload/Download"
                set data-binding "cloudaction"
                set column-width 20
            next
            edit 3
                set header "Application"
                set data-binding "appid"
                set column-attr app-id
                set column-span 2
                set column-width 30
            next
            edit 4
                set data-binding "app"
            next
            edit 5
                set header "File Size"
                set data-binding "filesize"
                set column-attr bandwidth
                set column-width 15
            next
        end
        set protected enable
    next


    edit "appctrl-Top-Blocked-SCCP-Callers"
        set disp-name "Top Blocked SCCP Callers"
        set category "Application"
        set description "Top 10 blocked SCCP callers"
        set dataset "appctrl-Top-Blocked-SCCP-Callers"
        set resolve-hostname disable
        set chart-type pie
        config table-columns
            edit 1
                set header "SCCP Caller"
                set data-binding "caller"
                set data-top 10
            next
            edit 2
                set header "Total Number"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr none
            next
        end
        set protected enable
    next
    edit "appctrl-Top-Blocked-SIP-Callers"
        set disp-name "Top Blocked SIP Callers"
        set category "Application"
        set description "Top 10 blocked SIP callers"
        set dataset "appctrl-Top-Blocked-SIP-Callers"
        set resolve-hostname disable
        set chart-type pie
        config table-columns
            edit 1
                set header "SIP Caller"
                set data-binding "caller"
                set data-top 10
            next
            edit 2
                set header "Total Number"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr none
            next
        end
        set protected enable
    next

    edit "360-degree-security-Application-Visiblity-and-Control-Summary"
        set disp-name "360 Degree Application Visibility and Control"
        set category "Application"
        set description "Application Visibility and Control Summary"
        set dataset "security-App-Visibility-Control-Summary"
        set chart-type donut
        set chart-style "{\"inner-content\": \"summary\", \"show-header\": \"enable\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "appcat"
                set data-top 5
            next
            edit 2
                set header "Apps"
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "360-degree-security-Threats-Detection-and-Prevention-Summary"
        set disp-name "360 Degree Threats Detection and Prevention"
        set category "Threat"
        set description "Threats Detection and Prevention Summary"
        set dataset "apprisk-ctrl-Threats-Prevention"
        set chart-type donut
        set chart-style "{\"inner-content\": \"summary\", \"show-header\": \"enable\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "threat_name"
                set data-top 5
            next
            edit 2
                set header "Threats"
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "360-degree-security-Data-Exfiltration-Detection-and-Prevention-Summary"
        set disp-name "360 Degree Data Exfiltration Detection and Prevention"
        set category "Threat"
        set description "Data Exfiltration Detection and Prevention Summary"
        set dataset "security-Data-Exfiltration-Summary"
         set chart-type donut
         set chart-style "{\"inner-content\": \"summary\", \"show-header\": \"enable\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "data_loss"
                set data-top 5
            next
            edit 2
                set header "Date Loss"
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "360-degree-security-Endpoint-Protection-Summary"
        set disp-name "360 Degree Endpoint Protection"
        set category "Event"
        set description "Endpoint Protection Summary"
        set dataset "security-Endpoint-Protection"
        set chart-type donut
        set chart-style "{\"inner-content\": \"summary\", \"show-header\": \"enable\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "blocked_event"
                set data-top 5
            next
            edit 2
                set header "Counts"
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next

    edit "security-Top20-High-Risk-Application-In-Use"
        set disp-name "Top 20 High Risk Application In Use"
        set category "Application"
        set description "Top 20 High Risk Application In Use"
        set dataset "security-High-Risk-Application-In-Use"
        set chart-type table
        config table-columns
            edit 1
                set header "Risk"
                set data-binding "d_risk"
                set column-attr severity
                set data-top 20
                set column-width 10
            next
            edit 2
                set header "Application Name"
                set data-binding "name"
                set column-width 20
            next
            edit 3
                set header "Category"
                set data-binding "app_cat"
                set column-width 20
            next
            edit 4
                set header "Technology"
                set data-binding "technology"
                set column-width 20
            next
            edit 5
                set header "User"
                set data-binding "users"
                set column-attr count
                set column-width 10
            next
            edit 6
                set header "Total Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-width 10
            next
            edit 7
                set header "Session"
                set data-binding "sessions"
                set column-attr count
                set column-width 10
            next
        end
        set protected enable
    next
    edit "security-High-Risk-Application-By-Category"
        set disp-name "High Risk Application By Category"
        set category "Application"
        set description "High Risk Application By Category"
        set dataset "security-High-Risk-Application-By-Category"
        set chart-type pie
        config table-columns
            edit 1
                set header "Category"
                set data-binding "app_cat"
                set data-top 10
            next
            edit 2
                set header "Count"
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "security-Top10-Application-Categories-By-Bandwidth"
        set disp-name "Application categories by bandwidth"
        set category "Application"
        set description "Application categories by bandwidth"
        set dataset "App-Risk-App-Usage-By-Category"
        set chart-type pie
        set include-other disable
        config table-columns
            edit 1
                set header "Category"
                set data-binding "appcat"
                set data-top 10
            next
            edit 2
                set header "Total"
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "Security-Category-Breakdown-By-Bandwidth"
        set disp-name "Category Breakdown of all Applications"
        set category "Application"
        set description "Category Breakdown of all applications, sorted by Bandwidth"
        set dataset "apprisk-ctrl-Category-Breakdown-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Category"
                set data-binding "appcat"
                set data-top 0
                set column-width 40
            next
            edit 2
                set header "Number of Applications"
                set data-binding "app_num"
                set column-attr count
                set column-width 15
            next
            edit 3
                set header "User"
                set data-binding "user_num"
                set column-attr count
                set column-width 15
            next
            edit 4
                set header "Total Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-width 15
            next
            edit 5
                set header "Session"
                set data-binding "num_session"
                set column-attr count
                set column-width 15
            next
        end
        set protected enable
    next
    edit "security-Top25-Web-Applications-By-Bandwidth"
        set disp-name "Top 25 Web Applications by Bandwidth"
        set description "Top 25 Web Applications by Bandwidth"
        set category "Web"
        set dataset "security-Web-Applications-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Risk"
                set data-binding "d_risk"
                set column-attr severity
                set data-top 25
                set column-width 10
            next
            edit 2
                set header "Application Name"
                set data-binding "name"
                set column-width 20
            next
            edit 3
                set header "Category"
                set data-binding "app_cat"
                set column-width 20
            next
            edit 4
                set header "Technology"
                set data-binding "technology"
                set column-width 20
            next
            edit 5
                set header "User"
                set data-binding "users"
                set column-attr count
                set column-width 10
            next
            edit 6
                set header "Total Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-width 10
            next
            edit 7
                set header "Session"
                set data-binding "sessions"
                set column-attr count
                set column-width 10
            next
        end
        set protected enable
    next
    edit "Security-Top25-Web-Categories-Visited"
        set category "Application"
        set disp-name "Most Commonly Visited Web Categories"
        set category "Application"
        set description "Top 25 Web Categories Visited"
        set dataset "apprisk-ctrl-Top-Web-Categories-Visited"
        set chart-type table
        config table-columns
            edit 1
                set header "Webfilter URL"
                set data-binding "catdesc"
                set column-attr url
                set data-top 25
                set column-width 70
            next
            edit 2
                set header "User"
                set data-binding "user_num"
                set column-attr count
                set column-width 10
            next
            edit 3
                set header "Count"
                set data-binding "sessions"
                set column-attr count
                set column-width 10
            next
            edit 4
                set header "Total Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-width 10
            next
        end
        set protected enable
    next
    edit "security-Top25-Malware-Virus-Botnet-Spyware"
        set disp-name "Malware: Viruses Botnet Spyware and Adware"
        set category "Application"
        set description "Malware discovered: viruses, botnet communications and the spyware/adware"
        set dataset "security-Malware-Virus-Botnet-Spyware"
        set chart-type table
        config table-columns
            edit 1
                set header "Malware Name"
                set data-binding "virus"
                set column-attr url
                set data-top 25
                set column-width 35
            next
            edit 2
                set header "Malware Type"
                set data-binding "malware_type"
                set column-width 35
            next
            edit 3
                set header "Victim"
                set data-binding "victims"
                set column-attr count
                set column-width 10
            next
            edit 4
                set header "Source"
                set data-binding "source"
                set column-attr count
                set column-width 10
            next
            edit 5
                set header "Count"
                set data-binding "total_num"
                set column-attr count
                set column-width 10
            next
        end
        set protected enable
    next

    edit "security-Top10-Malware-Virus-Spyware"
        set disp-name "Malware: Viruses Spyware and Adware"
        set category "Virus"
        set description "Malware discovered: viruses and the spyware/adware"
        set dataset "security-Malware-Virus-Spyware"
        set chart-type table
        config table-columns
            edit 1
                set header "Malware Name"
                set data-binding "virusid"
                set column-attr url
                set column-span 2
                set data-top 10
                set column-width 35
            next
            edit 2
                set data-binding "virus"
                set column-attr virus
            next
            edit 3
                set header "Malware Type"
                set data-binding "malware_type"
                set column-width 35
            next
            edit 4
                set header "Victim"
                set data-binding "victims"
                set column-attr count
                set column-width 10
            next
            edit 5
                set header "Source"
                set data-binding "source"
                set column-attr count
                set column-width 10
            next
            edit 6
                set header "Count"
                set data-binding "total_num"
                set column-attr count
                set column-width 10
            next
        end
        set protected enable
    next

    edit "security-Top10-Malware-Botnet"
        set disp-name "Malware: Botnet"
        set category "Application"
        set description "Malware discovered: botnet communications"
        set dataset "security-Malware-Botnet"
        set chart-type table
        config table-columns
            edit 1
                set header "Botnet Name"
                set data-binding "appid"
                set column-attr url
                set column-span 3
                set data-top 10
                set column-width 35
            next
            edit 2
                set data-binding "appid"
                set column-attr app-id
            next
            edit 3
                set data-binding "app"
            next
            edit 4
                set header "Malware Type"
                set data-binding "malware_type"
                set column-width 35
            next
            edit 5
                set header "Victim"
                set data-binding "victims"
                set column-attr count
                set column-width 10
            next
            edit 6
                set header "Source"
                set data-binding "source"
                set column-attr count
                set column-width 10
            next
            edit 7
                set header "Count"
                set data-binding "total_num"
                set column-attr count
                set column-width 10
            next
        end
        set protected enable
    next

    edit "security-Top10-Victims-of-Malware"
        set disp-name "Victims of Malware"
        set category "Virus"
        set description "Victims of Malware"
        set dataset "security-Victims-of-Malware"
        set chart-type table
        config table-columns
            edit 1
                set header "User(or IP)"
                set data-binding "user_src"
                set data-top 10
            next
            edit 2
                set header "Malware"
                set data-binding "malware"
                set data-type drilldown
                set data-top 5
            next
            edit 3
                set header "Count"
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "security-Top10-Victims-of-Phishing-Site"
        set disp-name "Victims of Phishing Site"
        set category "Virus"
        set description "Victims of Phishing Site"
        set dataset "security-Victims-of-Phishing-Site"
        set chart-type table
        config table-columns
            edit 1
                set header "User(or IP)"
                set data-binding "user_src"
                set data-top 10
                set column-width 20
            next
            edit 2
                set header "Phishing Site"
                set data-binding "phishing_site"
                set data-type drilldown
                set data-top 5
                set column-width 70
                set column-attr obf-url
            next
            edit 3
                set header "Count"
                set data-binding "total_num"
                set data-type aggregate
                set column-width 10
                set column-attr count
            next
        end
        set protected enable
    next
    edit "security-Top25-Malicious-Phishing-Sites"
        set disp-name "Malicious Phishing Sites"
        set category "Virus"
        set description "Malicious Phishing Sites"
        set dataset "security-Malicious-Phishing-Site"
        set chart-type table
        config table-columns
            edit 1
                set header "Phishing Site"
                set data-binding "phishing_site"
                set data-top 25
                set column-width 55
                set column-attr obf-url
            next
            edit 2
                set header "Victims"
                set data-binding "victims"
                set column-width 15
                set column-span 2
                set column-graph-type bar
            next
            edit 3
                set data-binding "victims"
                set column-attr count
            next
            edit 4
                set header "Source"
                set data-binding "source"
                set column-width 15
                set column-span 2
                set column-graph-type bar
            next
            edit 5
                set data-binding "source"
                set column-attr count
            next
            edit 6
                set header "Count"
                set data-binding "total_num"
                set column-width 15
                set column-span 2
                set column-graph-type bar
            next
            edit 7
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "security-Application-Vulnerability"
        set disp-name "Application Vulnerability Discovered"
        set category "Application"
        set description "Application vulnerabilities discovered on the network"
        set dataset "apprisk-ctrl-Application-Vulnerability"
        set chart-type table
        config table-columns
            edit 1
                set header "Severity"
                set data-binding "severity_number"
                set column-attr severity
                set data-top 25
                set column-width 8
            next
            edit 2
                set header "Malware Name"
                set data-binding "attackid"
                set column-attr url
                set column-span 2
                set column-width 30
            next
            edit 3
                set data-binding "attack"
                set column-attr attack
            next
            edit 4
                set header "Malware Type"
                set data-binding "vuln_type"
                set column-width 20
            next
            edit 5
                set header "CVE-ID"
                set data-binding "cve"
                set column-width 16
            next
            edit 6
                set header "Victim"
                set data-binding "victims"
                set column-attr count
                set column-width 8
            next
            edit 7
                set header "Source"
                set data-binding "sources"
                set column-attr count
                set column-width 8
            next
            edit 8
                set header "Count"
                set data-binding "totalnum"
                set column-attr count
                set column-width 10
            next
        end
        set protected enable
    next
    edit "security-Files-Analyzed-By-FortiCloud-Sandbox"
        set disp-name "Security Review:Files Analyzed by FortiCloud Sandbox"
        set category "Application"
        set description "Files analyzed by FortiCloud Sandbox"
        set dataset "security-Files-Analyzed-By-FortiCloud-Sandbox"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "Day"
                set data-binding "dow"
                set data-top 7
            next
            edit 2
                set header "Count"
                set data-type aggregate
                set data-binding "total_num"
            next
        end
        set protected enable
    next
    edit "Security-Zero-Day-Detected-On-Network"
        set disp-name "Security Review:Zero-day Malware Detected on The Network"
        set category "Application"
        set description "Zero-day malware detected on the network"
        set dataset "security-Zero-Day-Detected-On-Network"
        set chart-type table
        config table-columns
            edit 1
                set header "Zero-day Malware"
                set data-binding "virus_s"
                set data-top 5
                set column-width 35
            next
            edit 2
                set header "Application"
                set data-binding "app"
                set column-width 35
            next
            edit 3
                set header "Victim"
                set data-binding "victims"
                set column-attr count
                set column-width 10
            next
            edit 4
                set header "Source"
                set data-binding "source"
                set column-attr count
                set column-width 10
            next
            edit 5
                set header "Count"
                set data-binding "total_num"
                set column-attr count
                set column-width 10
            next
        end
        set protected enable
    next
    edit "security-Data-Loss-Incidents-By-Severity"
        set disp-name "Data loss incidents summary by severity"
        set category "Event"
        set description "Data loss incidents summary by severity"
        set dataset "security-Data-Loss-Incidents-By-Severity"
        set chart-type pie
        set include-other disable
        config table-columns
            edit 1
                set header "Severity"
                set data-binding "s_severity"
                set data-top 5
            next
            edit 2
                set header "Count"
                set data-type aggregate
                set data-binding "total_num"
            next
        end
        set protected enable
    next
    edit "security-Data-Loss-Files-By-Service"
        set disp-name "Data Loss Files By Service"
        set category "Event"
        set description "Data Loss Files By Service"
        set dataset "security-Data-Loss-Files-By-Service"
        set chart-type table
        config table-columns
            edit 1
                set header "File Name"
                set data-binding "filename"
                set data-top 10
                set column-width 30
            next
            edit 2
                set header "Upload/Download"
                set data-binding "action"
                set column-width 20
            next
            edit 3
                set header "Service"
                set data-binding "service"
                set column-width 30
            next
            edit 4
                set header "File Size"
                set data-binding "filesize"
                set column-attr bandwidth
                set column-width 20
            next
        end
        set protected enable
    next

    edit "security-Endpoint-Security-Events-Summary"
        set disp-name "Endpoint Security Events summary"
        set category "Event"
        set description "Endpoint Security Events summary"
        set dataset "security-Endpoint-Security-Events-Summary"
        set chart-type pie
        set include-other disable
        config table-columns
            edit 1
                set header "Security Event"
                set data-binding "events"
                set data-top 5
            next
            edit 2
                set header "Count"
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "security-Top-Endpoing-Running-High-Risk-Application"
        set disp-name "Endpoints Running High Risk Application"
        set category "Event"
        set description "Endpoints Running High Risk Application"
        set dataset "security-Top-Endpoing-Running-High-Risk-Application"
        set chart-type table
        config table-columns
            edit 1
                set header "User"
                set data-binding "f_user"
                set data-top 10
                set column-width 20
            next
            edit 2
                set header "Hostname"
                set data-binding "host_name"
                set column-width 20
            next
            edit 3
                set header "Application Name"
                set data-binding "app"
                set column-width 20
            next
            edit 4
                set header "Category"
                set data-binding "appcat"
                set column-width 20
            next
            edit 5
                set header "Risk"
                set data-binding "d_risk"
                set column-width 20
            next
        end
        set protected enable
    next
    edit "security-Top-Endpoints-Infected-With-Malware"
        set disp-name "Endpoints Infected With Malware"
        set category "Event"
        set description "Endpoints Infected With Malware"
        set dataset "security-Top-Endpoints-Infected-With-Malware"
        set chart-type table
        config table-columns
            edit 1
                set header "User"
                set data-binding "f_user"
                set data-top 10
                set column-width 20
            next
            edit 2
                set header "Hostname"
                set data-binding "host_name"
                set column-width 20
            next
            edit 3
                set header "Malware"
                set data-binding "virus"
                set column-width 30
            next
            edit 4
                set header "File Name"
                set data-binding "file"
                set column-width 30
            next
        end
        set protected enable
    next
    edit "security-Top-Endpoints-With-Web-Violateions"
        set disp-name "Endpoints With Web Violateions"
        set category "Event"
        set description "Endpoints With Web Violations"
        set dataset "security-Top-Endpoints-With-Web-Violateions"
        set chart-type table
        config table-columns
            edit 1
                set header "User"
                set data-binding "f_user"
                set data-top 10
            next
            edit 2
                set header "Hostname"
                set data-binding "host_name"
            next
            edit 3
                set header "Remote Host"
                set data-binding "remotename"
                set column-attr obf-url
            next
            edit 4
                set header "Total Visits"
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "security-Top-Endpoints-With-Data-Loss-Incidents"
        set disp-name "Endpoints With Data Loss Incidents"
        set category "Event"
        set description "Endpoints With Data Loss Incidents"
        set dataset "security-Top-Endpoints-With-Data-Loss-Incidents"
        set chart-type table
        config table-columns
            edit 1
                set header "User"
                set data-binding "f_user"
                set data-top 10
                set column-width 20
            next
            edit 2
                set header "Hostname"
                set data-binding "host_name"
                set column-width 20
            next
            edit 3
                set header "Event Summary"
                set data-binding "msg"
                set column-width 50
            next
            edit 4
                set header "Count"
                set data-binding "total_num"
                set column-attr count
                set column-width 10
            next
        end
        set protected enable
    next

    edit "content-Count-Total-SCCP-Call-Registrations-by-Hour-of-Day"
	set disp-name "Number of SCCP Call Registrations by Hour-of-Day"
    	set category "Other"
	set description "Number of SCCP call registrations by hour of day"
	set dataset "content-Count-Total-SCCP-Call-Registrations-by-Hour-of-Day"
        set chart-type table
        config table-columns
            edit 1
                set header "Hour Of Day"
                set data-binding "hourstamp"
                set data-top 0
                set column-width 40
            next
            edit 2
                set header "Count"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
            next
        end
        set protected enable
    next
    edit "content-Count-Total-SCCP-Calls-Duration-by-Hour-of-Day"
	set disp-name "SCCP Call Duration by Hour-of-Day"
	set category "Other"
	set description "SCCP call duration by hour of day"
	set dataset "content-Count-Total-SCCP-Calls-Duration-by-Hour-of-Day"
	set resolve-hostname disable
        set chart-type pie
        config table-columns
            edit 1
                set header "Hour of Day"
                set data-binding "hourstamp"
                set data-top 0
            next
            edit 2
                set header "SCCP Usage"
                set data-type aggregate
                set data-binding "sccp_usage"
                set column-attr none
           next
        end
        set protected enable
    next
    edit "content-Count-Total-SCCP-Calls-per-Status"
	set disp-name "Number of SCCP Calls by Status"
	set category "Other"
	set description "Number of SCCP calls by status"
	set dataset "content-Count-Total-SCCP-Calls-per-Status"
	set resolve-hostname disable
        set chart-type pie
        config table-columns
            edit 1
                set header "Status"
                set data-binding "status"
                set data-top 10
            next
            edit 2
                set header "Total Number"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr none
            next
        end
	set protected enable
    next
    edit "content-Count-Total-SIP-Call-Registrations-by-Hour-of-Day"
	set disp-name "Number of SIP Call Registrations by Hour-of-Day"
	set category "Other"
	set description "Number of SIP call registrations by hour of day"
	set dataset "content-Count-Total-SIP-Call-Registrations-by-Hour-of-Day"
	set resolve-hostname disable
        set chart-type table
        config table-columns
            edit 1
                set header "Hour Of Day"
                set data-binding "hourstamp"
                set data-top 0
                set column-width 40
            next
            edit 2
                set header "Count"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
	set protected enable
        next
	edit "content-Count-Total-SIP-Calls-per-Status"
		set disp-name "Number of SIP Calls by Status"
		set category "Other"
		set description "Number of SIP calls by status"
		set dataset "content-Count-Total-SIP-Calls-per-Status"
		set resolve-hostname disable
        set chart-type pie
        config table-columns
            edit 1
                set header "Status"
                set data-binding "status"
                set data-top 10
            next
            edit 2
                set header "Total Number"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr none
            next
        end
	set protected enable
	next
	edit "content-Dist-Total-SIP-Calls-by-Duration"
		set disp-name "Distribution of SIP Calls by Duration"
		set category "Other"
		set description "Distribution of SIP calls by duration"
		set dataset "content-Dist-Total-SIP-Calls-by-Duration"
		set resolve-hostname disable
        set chart-type pie
        config table-columns
            edit 1
                set header "Duration"
                set data-binding "f_duration"
                set data-top 10
            next
            edit 2
                set header "Total Number"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr none
            next
        end
	set protected enable
	next

    edit "Botnet-Activity-By-Sources"
        set disp-name "Top Botnets by Sources"
        set category "Network Usage"
        set description "Top 10 botnets by sources"
        set dataset "Botnet-Activity-By-Sources"
        set chart-type table
        config table-columns
            edit 1
                set header "Botnet"
                set data-binding "app"
                set data-top 10
            next
            edit 2
                set header "User/Source IP"
                set data-type drilldown
                set data-binding "user_src"
                set column-attr user
                set data-top 0
            next
            edit 3
                set header "Number of Connections"
                set data-type aggregate
                set data-binding "events"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Botnet-Infected-Hosts"
        set disp-name "Top Botnet Infected Hosts"
        set category "Network Usage"
        set description "Top 10 botnet infected hosts"
        set dataset "Botnet-Infected-Hosts"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set column-attr user
                set data-top 10
                set column-width 30
            next
            edit 2
                set header "Hostname (or MAC)"
                set data-binding "devtype_new"
                set column-span 2
                set column-attr dev-type
                set column-width 30
            next
            edit 3
                set data-binding "host_mac"
            next
            edit 4
                set header "Occurrences"
                set data-binding "events"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 5
                set data-binding "events"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Detected-Botnet"
        set disp-name "Detected Botnets"
        set category "Network Usage"
        set description "Detected botnets"
        set dataset "Detected-Botnet"
        set chart-type table
        config table-columns
            edit 1
                set header "Botnet Name"
                set data-binding "app"
                set data-top 0
                set column-width 40
            next
            edit 2
                set header "Counts"
                set data-binding "events"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "events"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Botnet-Sources"
        set disp-name "Top Botnet Sources"
        set category "Network Usage"
        set description "Top 10 botnet sources"
        set dataset "Botnet-Sources"
        set chart-type table
        config table-columns
            edit 1
                set header "C&C IP"
                set data-binding "dstip"
                set column-attr virus
                set data-top 10
                set column-width 30
            next
            edit 2
                set header "Hostname"
                set data-binding "domain"
                set column-width 30
                set column-attr obf-url
            next
            edit 3
                set header "Counts"
                set data-binding "events"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 4
                set data-binding "events"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Botnet-Victims"
        set disp-name "Botnet Victims"
        set category "Network Usage"
        set description "Botnet victims"
        set dataset "Botnet-Victims"
        set chart-type table
        config table-columns
            edit 1
                set header "Victim Name (or IP)"
                set data-binding "user_src"
                set column-attr user
                set data-top 0
                set column-width 40
            next
            edit 2
                set header "Counts"
                set data-binding "events"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "events"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "Botnet-Timeline"
        set disp-name "Botnet Timeline"
        set category "Network Usage"
        set description "Botnet timeline"
        set dataset "Botnet-Timeline"
        set chart-type bar
        set order-by "hodex"
        config table-columns
            edit 1
                set header "Date"
                set data-binding "hodex"
                set column-attr none
                set data-top 168
            next
            edit 2
                set data-type aggregate
                set data-binding "events"
            next
        end
        set protected enable
    next

    edit "Application-Session-History"
        set disp-name "Session History Graph"
        set category "Event"
        set description "Session history graph"
        set dataset "Application-Session-History"
        set resolve-hostname disable
        set chart-type area
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
                set data-top 500
            next
            edit 2
                set data-binding "counter"
                set column-graph-type line-up
                set legend "Session Count"
            next
        end
        set protected enable
    next

    edit "Application-Usage-List"
        set disp-name "Application Bandwidth Usage"
        set category "Network Usage"
        set description "Application bandwidth usage details"
        set dataset "Detailed-Application-Usage"
        set resolve-hostname disable
        set chart-type table
        config table-columns
            edit 1
                set header "Application"
                set data-binding "appid"
                set column-attr app-id
                set data-top 300
                set column-span 2
                set column-width 30
            next
            edit 2
                set data-binding "app"
                set data-top 300
            next
            edit 3
                set header "Action"
                set data-binding "custaction"
                set data-top 300
                set column-width 30
            next
            edit 4
                set header "Bytes"
                set data-binding "bandwidth"
                set data-top 300
                set column-attr bandwidth
                set column-width 20
            next
            edit 5
                set header "Session Count"
                set data-binding "num_session"
                set data-top 300
                set column-attr count
                set column-width 20
            next
        end
        set protected enable
    next

    edit "PCI-DSS-Compliance-Summary"
        set disp-name "PCI Compliance Summary"
        set category "Security"
        set description "PCI Compliace Summary"
        set dataset "pci-dss-Compliance-Summary"
        set chart-type donut
        config table-columns
            edit 1
                set data-binding "status"
                set data-top 5
            next
            edit 2
                set data-binding "requirements"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "PCI-DSS-Non-Compliant-Requirements-By-Severity"
        set disp-name "PCI DSS Non-Compliant Requirements By Severity"
        set category "Security"
        set description "PCI DSS Non-Compliant Requirements By Severity"
        set dataset "pci-dss-Non-Compliant-Requirements-By-Severity"
        set chart-type donut
        config table-columns
            edit 1
                set data-binding "severity"
                set data-top 5
            next
            edit 2
                set data-binding "requirements"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "PCI-DSS-Compliant-Requirements-By-Severity"
        set disp-name "PCI DSS Compliant Requirements By Severity"
        set category "Security"
        set description "PCI DSS Compliant Requirements By Severity"
        set dataset "pci-dss-Compliant-Requirements-By-Severity"
        set chart-type donut
        config table-columns
            edit 1
                set data-binding "severity"
                set data-top 5
            next
            edit 2
                set data-binding "requirements"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next

    edit "PCI-DSS-Fortinet-Security-Best-Practice-Summary"
        set disp-name "PCI DSS Fortinet Security Best Practice Summary"
        set category "Security"
        set description "PCI DSS Fortinet Security Best Practice Summary"
        set dataset "pci-dss-Fortinet-Security-Best-Practice-Summary"
        set chart-type donut
        config table-columns
            edit 1
                set data-binding "status"
                set data-top 5
            next
            edit 2
                set data-binding "practices"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "PCI-DSS-Failed-Fortinet-Security-Best-Practices-By-Severity"
        set disp-name "PCI DSS Failed Fortinet Security Best Practices By Severity"
        set category "Security"
        set description "PCI DSS Failed Fortinet Security Best Practices By Severity"
        set dataset "pci-dss-Failed-Fortinet-Security-Best-Practices-By-Severity"
        set chart-type donut
        config table-columns
            edit 1
                set data-binding "status"
                set data-top 5
            next
            edit 2
                set data-binding "practices"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "PCI-DSS-Passed-Fortinet-Security-Best-Practices-By-Severity"
        set disp-name "PCI DSS Passed Fortinet Security Best Practices By Severity"
        set category "Security"
        set description "PCI DSS Passed Fortinet Security Best Practices By Severity"
        set dataset "pci-dss-Passed-Fortinet-Security-Best-Practices-By-Severity"
        set chart-type donut
        config table-columns
            edit 1
                set data-binding "status"
                set data-top 5
            next
            edit 2
                set data-binding "practices"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next

    edit "PCI-DSS-Requirements-Compliance-Details"
        set disp-name "PCI DSS Requirement Compliance Details"
        set category "Security"
        set description "PCI DSS Requirement Compliance Details"
        set dataset "pci-dss-Requirements-Compliance-Details"
        set chart-type table
        config table-columns
            edit 1
                set header "Fortinet PCI ID"
                set data-binding "ftnt_pci_id"
                set column-width 15
                set data-top 0
            next
            edit 2
                set header "PCI Requirement"
                set data-binding "pci_requirement"
                set column-width 50
            next
            edit 3
                set header "PCI Compliance"
                set data-binding "compliance"
                set column-width 15
            next
            edit 4
                set header "FTNT Best Practice IDs"
                set data-binding "practice"
                set column-width 20
            next
        end
        set protected enable
    next

    edit "PCI-DSS-Fortinet-Security-Best-Practice-Details"
        set disp-name "PCI DSS Fortinet Security Best Practice Details"
        set category "Security"
        set description "PCI DSS Fortinet Security Best Practice Details"
        set dataset "pci-dss-Fortinet-Security-Best-Practice-Details"
        set chart-type table
        config table-columns
            edit 1
                set header "FTNT ID"
                set data-binding "ftnt_id"
                set data-top 500
                set column-width 15
            next
            edit 2
                set header "Description/Goal"
                set data-binding "msg"
                set column-width 60
            next
            edit 3
                set header "Severity"
                set data-binding "status"
                set column-width 10
            next
            edit 4
                set header "Feature Category"
                set data-binding "module"
                set column-width 15
            next
        end
        set protected enable
    next

    edit "DLP-Email-Activity-Details"
        set disp-name "Email DLP Activity Details"
        set category "DLP"
        set description "Email DLP Activity Details"
        set dataset "dlp-email-activity-details"
        set chart-type table
        config table-columns
            edit 1
                set header "Date"
                set data-binding "timestamp"
                set data-top 100
                set column-width 16
            next
            edit 2
                set header "Sender"
                set data-binding "sender"
                set column-width 13
            next
            edit 3
                set header "Receiver"
                set data-binding "receiver"
                set column-width 13
            next
            edit 4
                set header "Rule"
                set data-binding "profile"
                set column-width 13
            next
            edit 5
                set header "File"
                set data-binding "filename"
                set column-width 23
            next
            edit 6
                set header "Size"
                set data-binding "filesize"
                set column-attr bandwidth
                set column-width 6
            next
            edit 7
                set header "Status"
                set data-binding "action"
                set column-width 8
            next
            edit 8
                set header "Direction"
                set data-binding "direction"
                set column-width 8
            next
        end
        set protected enable
    next
    edit "Email-DLP-Chart"
        set disp-name "Email DLP Violation Summary"
        set category "DLP"
        set description "Email DLP Violation Summary"
        set dataset "dlp-email-violation-summary"
        set chart-type table
        config table-columns
            edit 1
                set header "Rule"
                set data-binding "profile"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Count"
                set data-binding "total_num"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "total_num"
                set column-attr count

            next
        end
        set protected enable
    next
    edit "DLP-Web-Activity-Details"
        set disp-name "Web DLP Activity Details"
        set category "DLP"
        set description "Web DLP Activity Details"
        set dataset "dlp-web-activity-details"
        set chart-type table
        config table-columns
            edit 1
                set header "Date"
                set data-binding "timestamp"
                set data-top 100
                set column-width 16
            next
            edit 2
                set header "Source"
                set data-binding "srcip"
                set column-width 13
            next
            edit 3
                set header "Destination"
                set data-binding "dstip"
                set column-width 13
            next
            edit 4
                set header "Hostname"
                set data-binding "hostname"
                set column-width 13
            next
            edit 5
                set header "Rule"
                set data-binding "profile"
                set column-width 8
            next
            edit 6
                set header "File"
                set data-binding "filename"
                set column-width 13
            next
            edit 7
                set header "Size"
                set data-binding "filesize"
                set column-attr bandwidth
                set column-width 6
            next
            edit 8
                set header "Status"
                set data-binding "action"
                set column-width 8
            next
            edit 9
                set header "Direction"
                set data-binding "direction"
                set column-width 8
            next
        end
        set protected enable
    next
    edit "Web-DLP-Chart"
        set disp-name "Web DLP Violation Summary"
        set category "DLP"
        set description "Web DLP Violation Summary"
        set dataset "dlp-web-violation-summary"
        set chart-type table
        config table-columns
            edit 1
                set header "Rule"
                set data-binding "profile"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Count"
                set data-binding "total_num"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "DLP-FTP-Activity-Details"
        set disp-name "FTP DLP Activity Details"
        set category "Security"
        set description "FTP DLP Activity Details"
        set dataset "dlp-ftp-activity-details"
        set chart-type table
        config table-columns
            edit 1
                set header "Date"
                set data-binding "timestamp"
                set data-top 100
                set column-width 16
            next
            edit 2
                set header "Source"
                set data-binding "srcip"
                set column-width 13
            next
            edit 3
                set header "Destination"
                set data-binding "dstip"
                set column-width 13
            next
            edit 4
                set header "Rule"
                set data-binding "profile"
                set column-width 13
            next
            edit 5
                set header "File"
                set data-binding "filename"
                set column-width 23
            next
            edit 6
                set header "Size"
                set data-binding "filesize"
                set column-attr bandwidth
                set column-width 6
            next
            edit 7
                set header "Status"
                set data-binding "action"
                set column-width 8
            next
            edit 8
                set header "Direction"
                set data-binding "direction"
                set column-width 8
            next
        end
        set protected enable
    next
    edit "FTP-DLP-Chart"
        set disp-name "FTP DLP Violation Summary"
        set category "Security"
        set description "FTP DLP Violation Summary"
        set dataset "dlp-ftp-violation-summary"
        set chart-type table
        config table-columns
            edit 1
                set header "Rule"
                set data-binding "profile"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Count"
                set data-binding "total_num"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "top-users-by-browsetime"
        set disp-name "Top 20 Browsing Users Drilldown"
        set category "Security"
        set description "Top 20 Browsing Users Drilldown"
        set dataset "top-user-by-website-browsetime"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set column-attr user
                set data-top 20
            next
            edit 2
                set header "Website"
                set data-binding "domain"
                set data-type drilldown
                set data-top 20
            next
            edit 3
                set header "Browse Time(hh:mm:ss)"
                set data-binding "browsetime"
                set column-attr timespan
                set data-type aggregate
            next
        end
        set protected enable
    next

    edit "wifi-usage-by-hour-authenticated"
        set disp-name "Wifi Usage by Hour - Authenticated"
        set category "Event"
        set description "Wifi Usage by Hour - Authenticated"
        set dataset "wifi-usage-by-hour-authenticated"
        set chart-type table
        config table-columns
            edit 1
                set header "Date/Time"
                set data-binding "hod"
                set data-top 500
            next
            edit 2
                set header "Total # Wifi Clients"
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "wifi-usage-authenticated-timeline"
        set disp-name "Wifi Usage Timeline - Authenticated"
        set category "Event"
        set description "Wifi Usage Timeline - Authenticated"
        set dataset "wifi-usage-authenticated-timeline"
        set chart-type area
        config table-columns
            edit 1
                set data-binding "hodex"
                set column-attr time
            next
            edit 2
                set data-binding "totalnum"
                set column-graph-type line-up
                set legend "Total # Wifi Clients"
            next
        end
        set protected enable
    next

    edit "app-top-user-by-bandwidth"
        set disp-name "Top 10 Applications Bandwidth by User Drilldown"
        set category "Traffic"
        set description "Top 10 Applications Bandwidth by User Drilldown"
        set dataset "app-Top-User-by-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Application"
                set data-binding "app"
                set data-top 10
            next
            edit 2
                set header "User (or IP)"
                set data-binding "user_src"
                set data-type drilldown
                set data-top 10
            next
            edit 3
                set header "Bytes"
                set data-binding "bandwidth"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next

    edit "app-top-user-by-session"
        set disp-name "Top 10 Applications Sessions by User Drilldown"
        set category "Traffic"
        set description "Top 10 Applications Sessions by User Drilldown"
        set dataset "app-Top-User-by-Sessions"
        set chart-type table
        config table-columns
            edit 1
                set header "Application"
                set data-binding "app"
                set data-top 10
            next
            edit 2
                set header "User (or IP)"
                set data-binding "user_src"
                set data-type drilldown
                set data-top 10
            next
            edit 3
                set header "Session"
                set data-binding "sessions"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next

    edit "traffic-Interface-Bandwidth-Usage"
        set disp-name "Interface Bandwidth Usage"
        set category "Traffic"
        set description "Interface Bandwidth Usage"
        set dataset "traffic-Interface-Bandwidth-Usage"
        set chart-type bar
        set order-by "dom"
        config table-columns
            edit 1
                set header "Day"
                set data-binding "dom"
                set data-top 30
            next
            edit 2
                set header "Type"
                set data-binding "type"
                set data-type drilldown
            next
            edit 3
                set header "Bytes"
                set data-binding "bandwidth"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        config variable-template
            edit "srcintf"
                set var-value "wan1"
                set var-type string
            next
        end
        set protected enable
    next

    edit "ctap-SB-Files-Needing-Inspection-vs-Others"
        set disp-name "CTAP SB Files Needing Inspection vs Others"
        set description "Files needing inspection vs others"
        set dataset "CTAP-SB-Files-Needing-Inspection-vs-Others"
        set chart-type pie
        config table-columns
            edit 1
                set data-binding "files"
                set data-top 10
            next
            edit 2
                set data-binding "total_num"
                set data-type aggregate
            next
        end
        set protected enable
    next

    edit "ctap-SB-Breakdown-of-File-Types"
        set disp-name "CTAP SB Breakdown of File Types"
        set description "Breakdown of file types"
        set dataset "CTAP-SB-Breakdown-of-File-Types"
        set chart-type pie
        config table-columns
            edit 1
                set data-binding "filetype"
                set data-top 10
            next
            edit 2
                set data-binding "total_num"
                set data-type aggregate
            next
        end
        set protected enable
    next

    edit "ctap-SB-Top-Sandbox-Malicious-Exes"
        set disp-name "CTAP SB Top Sandbox Malicious Exes"
        set description "Top sandbox malicious exes"
        set dataset "CTAP-SB-Top-Sandbox-Malicious-Exes"
        set chart-type table
        config table-columns
            edit 1
                set header "Filename"
                set data-binding "filename"
                set data-top 5
            next
            edit 2
                set header "Service"
                set data-binding "service"
                set data-top 5
            next
            edit 3
                set header "Count"
                set data-binding "total_num"
                set column-attr count
            next
            edit 4
                set header "Risk"
                set data-binding "risk"
                set column-attr severity
            next
        end
        set protected enable
    next

    edit "ctap-SB-Sources-of-Sandbox-Discovered-Malware"
        set disp-name "CTAP SB Sources of Sandbox Discovered Malware"
        set description "Sources of sandbox discovered malware"
        set dataset "CTAP-SB-Sources-of-Sandbox-Discovered-Malware"
        set chart-type table
        config table-columns
            edit 1
                set header "Source"
                set data-binding "source"
            next
            edit 2
                set header "Count"
                set data-binding "total_num"
                set column-attr count
                set column-span 2
            next
            edit 3
                set data-binding "total_num"
                set column-graph-type bar
            next
        end
        set protected enable
    next

    edit "ctap-apprisk-ctrl-High-Risk-Application"
        set disp-name "CTAP High Risk Applications Crossing The Network"
        set description "High Risk Applications Crossing The Network"
        set dataset "apprisk-ctrl-High-Risk-Application"
        set chart-type table
        config table-columns
            edit 1
                set header "Risk"
                set data-binding "d_risk"
                set column-attr severity
                set data-top 20
                set column-width 5
            next
            edit 2
                set header "Application Name"
                set data-binding "id"
                set column-attr app-id
                set column-span 2
                set column-width 25
            next
            edit 3
                set data-binding "name"
            next
            edit 4
                set header "Category"
                set data-binding "app_cat"
                set column-attr appcat
                set column-width 20
            next
            edit 5
                set header "Technology"
                set data-binding "technology"
                set column-width 20
            next
            edit 6
                set header "User"
                set data-binding "users"
                set column-attr count
                set column-width 10
            next
            edit 7
                set header "Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-width 10
            next
            edit 8
                set header "Session"
                set data-binding "sessions"
                set column-attr count
                set column-width 10
            next
        end
        set protected enable
    next
    edit "ctap-apprisk-ctrl-Application-Vulnerability"
        set disp-name "CTAP Application Vulnerability Exploits"
        set description "Application Vulnerability Exploits"
        set dataset "apprisk-ctrl-Application-Vulnerability"
        set chart-type table
        config table-columns
            edit 1
                set header "Severity"
                set data-binding "severity_number"
                set column-attr severity
                set data-top 25
                set column-width 7
            next
            edit 2
                set header "Threat Name"
                set data-binding "attackid"
                set column-attr url
                set column-span 2
                set column-width 45
            next
            edit 3
                set data-binding "attack"
                set column-attr attack
            next
            edit 4
                set header "Type"
                set data-binding "vuln_type"
                set column-width 9
            next
            edit 5
                set header "CVE-ID"
                set data-binding "cve"
                set column-width 17
            next
            edit 6
                set header "Victim"
                set data-binding "victims"
                set column-attr count
                set column-width 7
            next
            edit 7
                set header "Source"
                set data-binding "sources"
                set column-attr count
                set column-width 7
            next
            edit 8
                set header "Count"
                set data-binding "totalnum"
                set column-attr count
                set column-width 8
            next
        end
        set protected enable
    next
    edit "ctap-apprisk-ctrl-Common-Virus-Botnet-Spyware"
        set disp-name "CTAP Common Virus Botnet and Spyware and Adware"
        set description "Common virus discovered, the botnet communications and the spyware/adware"
        set dataset "CTAP-apprisk-ctrl-Common-Virus-Botnet-Spyware"
        set chart-type table
        config table-columns
            edit 1
                set header "Malware Name"
                set data-binding "virus"
            next
            edit 2
                set header "Type"
                set data-binding "malware_type"
            next
            edit 3
                set header "Application"
                set data-binding "appid"
                set column-attr app-id
                set column-span 2
            next
            edit 4
                set data-binding "app"
            next
            edit 5
                set header "Victim"
                set data-binding "victims"
                set column-attr count
            next
            edit 6
                set header "Source"
                set data-binding "source"
                set column-attr count
            next
            edit 7
                set header "Count"
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "ctap-App-Risk-Reputation-Top-Devices-By-Scores"
        set disp-name "CTAP Top Devices by Threat Score"
        set description "Top 10 devices by threat score in risk"
        set dataset "CTAP-App-Risk-Reputation-Top-Devices-By-Scores"
        set chart-type table
        config table-columns
            edit 1
                set header "Device"
                set data-binding "dev_src"
                set column-width 40
                set data-top 10
            next
            edit 2
                set header "Scores"
                set data-binding "scores"
                set column-graph-type bar
                set column-span 2
                set column-width 60
            next
            edit 3
                set data-binding "scores"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "ctap-HTTP-SSL-Traffic-Ratio"
        set disp-name "CTAP HTTP SSL Traffic Ratio"
        set description "HTTP SSL Traffic Ratio"
        set dataset "CTAP-HTTP-SSL-Traffic-Ratio"
        set chart-type pie
        config table-columns
            edit 1
                set data-binding "service"
                set data-top 10
            next
            edit 2
                set data-binding "bandwidth"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next

    edit "ctap-Top-Source-Countries"
        set disp-name "CTAP Top Source Countries"
        set description "Top 10 Source Countries"
        set dataset "CTAP-Top-Source-Countries"
        set chart-type table
        config table-columns
            edit 1
                set header "Country/Region"
                set data-binding "srccountry"
                set data-top 10
            next
            edit 2
                set header "Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next

    edit "ctap-SaaS-Apps"
        set disp-name "CTAP SaaS Apps"
        set description "CTAP SaaS Apps"
        set dataset "CTAP-SaaS-Apps"
        set chart-type pie
        config table-columns
            edit 1
                set data-binding "app_group"
                set data-top 6
            next
            edit 2
                set data-binding "bandwidth"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next

    edit "ctap-IaaS-Apps"
        set disp-name "CTAP IaaS Apps"
        set description "CTAP IaaS Apps"
        set dataset "CTAP-IaaS-Apps"
        set chart-type pie
        config table-columns
            edit 1
                set data-binding "app_group"
                set data-top 6
            next
            edit 2
                set data-binding "bandwidth"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next

    edit "ctap-RAS-Apps"
        set disp-name "CTAP RAS Apps"
        set description "CTAP RAS Apps"
        set dataset "CTAP-RAS-Apps"
        set chart-type pie
        config table-columns
            edit 1
                set data-binding "app_group"
                set data-top 6
            next
            edit 2
                set data-binding "bandwidth"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next

    edit "ctap-Proxy-Apps"
        set disp-name "CTAP Proxy Apps"
        set description "CTAP Proxy Apps"
        set dataset "CTAP-Proxy-Apps"
        set chart-type pie
        config table-columns
            edit 1
                set data-binding "app_group"
                set data-top 6
            next
            edit 2
                set data-binding "bandwidth"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next

    edit "ctap-Top-SocialMedia-App-By-Bandwidth"
        set disp-name "CTAP Top Social Media Applications By Bandwidth (Pie)"
        set description "Top Social Media Applications By Bandwidth"
        set dataset "CTAP-Top-SocialMedia-App-By-Bandwidth"
        set chart-type pie
        config table-columns
            edit 1
                set data-binding "app_group"
                set data-top 6
            next
            edit 2
                set data-binding "bandwidth"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next

    edit "ctap-Top-Streaming-App-By-Bandwidth"
        set disp-name "CTAP Top Streaming Applications By Bandwidth (Pie)"
        set description "Top Streaming Applications By Bandwidth"
        set dataset "CTAP-Top-Streaming-App-By-Bandwidth"
        set chart-type pie
        config table-columns
            edit 1
                set data-binding "app_group"
                set data-top 6
            next
            edit 2
                set data-binding "bandwidth"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next

    edit "ctap-Top-Game-App-By-Bandwidth"
        set disp-name "CTAP Top Game Applications By Bandwidth (Pie)"
        set description "Top Game Applications By Bandwidth"
        set dataset "CTAP-Top-Game-App-By-Bandwidth"
        set chart-type pie
        config table-columns
            edit 1
                set data-binding "app_group"
                set data-top 6
            next
            edit 2
                set data-binding "bandwidth"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next

    edit "ctap-Top-P2P-App-By-Bandwidth"
        set disp-name "CTAP Top P2P Applications By Bandwidth (Pie)"
        set description "Top P2P Applications By Bandwidth"
        set dataset "CTAP-Top-P2P-App-By-Bandwidth"
        set chart-type pie
        config table-columns
            edit 1
                set data-binding "app_group"
                set data-top 6
            next
            edit 2
                set data-binding "bandwidth"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next

    edit "ctap-apprisk-ctrl-Top-Web-Categories-Visited"
        set disp-name "CTAP Top Web Categories Visited"
        set description "Top 10 Web Categories Visited"
        set dataset "apprisk-ctrl-Top-Web-Categories-Visited"
        set chart-type table
        config table-columns
            edit 1
                set header "URL Category"
                 set data-binding "catdesc"
                set column-attr web-cat
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "User"
                set data-binding "user_num"
                set column-attr count
                set column-width 20
            next
            edit 3
                set header "Count"
                set data-binding "sessions"
                set column-attr count
                set column-width 20
            next
            edit 4
                set header "Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-width 20
            next
        end
        set protected enable
    next

    edit "ctap-App-Risk-Applications-Running-Over-HTTP"
        set disp-name "CTAP Applications Running over HTTP"
        set description "Applications running over HTTP protocol"
        set dataset "App-Risk-Applications-Running-Over-HTTP"
        set chart-type table
        config table-columns
            edit 1
                set header "Application"
                set data-binding "app_group"
                set data-top 25
                set column-width 40
            next
            edit 2
                set header "Sessions"
                set data-binding "sessions"
                set column-attr count
                set column-width 30
            next
            edit 3
                set header "Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-width 30
            next
        end
        set protected enable
    next

    edit "ctap-App-Risk-Web-Browsing-Activity-Hostname-Category"
        set disp-name "CTAP Top Web Domains by Visits"
        set description "Top 10 visited web domains by number of visits"
        set dataset "App-Risk-Web-Browsing-Activity-Hostname-Category"
        set chart-type table
        config table-columns
            edit 1
                set header "Domain"
                set data-binding "domain"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Category"
                set data-binding "catdesc"
                set column-attr web-cat
                set column-width 30
            next
            edit 3
                set header "Visits"
                set data-binding "visits"
                set column-attr count
                set column-width 30
            next
        end
        set protected enable
    next

    edit "ctap-Top-Sites-By-Browsing-Time"
        set disp-name "CTAP Top Websites by Browsing Time"
        set description "Top 50 websites by browsing time"
        set dataset "traffic-Top-Sites-By-Browsing-Time"
        set chart-type table
        config table-columns
            edit 1
                set header "Sites"
                set data-binding "hostname"
                set data-top 50
                set column-width 30
            next
            edit 2
                set header "Category"
                set data-binding "agg_catdesc"
                set column-attr web-cat
                set data-top 50
                set column-width 30
            next
            edit 3
                set header "Browsing Time(hh:mm:ss)"
                set data-binding "browsetime"
                set column-graph-type bar
                set column-span 2
                set column-width 40
            next
            edit 4
                set data-binding "browsetime"
                set column-attr timespan
            next
        end
        set protected enable
    next

    edit "ctap-Average-Bandwidth-Hour"
        set disp-name "CTAP Average Bandwidth Hour"
        set description "Average Bandwidth Hour"
        set dataset "CTAP-Average-Bandwidth-Hour"
        set include-other disable
        set chart-type area
        config table-columns
            edit 1
                set data-binding "hourstamp"
                set column-attr none
            next
            edit 2
                set data-binding "bandwidth"
                set column-graph-type line-up
                set column-attr bandwidth
            next
        end
        set protected enable
    next

    edit "ctap-Top-Bandwidth-Hosts"
        set disp-name "CTAP Top Bandwidth Hosts"
        set description "Top 10 Bandwidth Hosts"
        set dataset "CTAP-Top-Bandwidth-Hosts"
        set chart-type table
        config table-columns
            edit 1
                set header "Host Name"
                set data-binding "hostname"
                set data-top 10
            next
            edit 2
                set header "Bytes"
                set data-binding "bandwidth"
                set column-graph-type bar
                set column-span 2
            next
            edit 3
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next


    edit "saas-Application-Discovered"
        set disp-name "All Applications Discovered on the Network"
        set category "SaaS"
        set description "All Applications Discovered on the Network"
        set dataset "saas-Application-Discovered"
        set chart-type donut
        config table-columns
            edit 1
                set data-binding "app_type"
                set data-top 0
            next
            edit 2
                set data-type aggregate
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "saas-SaaS-Application-by-Category"
        set disp-name "Sanctioned vs Unsanctioned SaaS Applications"
        set category "SaaS"
        set description "Sanctioned vs Unsanctioned SaaS Applications"
        set dataset "saas-SaaS-Application-by-Category"
        set chart-type donut
        config table-columns
            edit 1
                set data-binding "saas_cat_str"
                set data-top 0
            next
            edit 2
                set data-type aggregate
                set data-binding "num_saas_app"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "saas-SaaS-Application-by-Bandwidth"
        set disp-name "Sanctioned vs Tolerated Apps by Bandwidth"
        set category "SaaS"
        set description "Sanctioned vs Tolerated Apps by Bandwidth"
        set hidden enable
        set dataset "saas-SaaS-Application-by-Bandwidth"
        set chart-type donut
        config table-columns
            edit 1
                set data-binding "saas_cat_str"
                set data-top 0
            next
            edit 2
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "saas-SaaS-Application-by-Session"
        set disp-name "Sanctioned vs Tolerated Apps by Session"
        set category "SaaS"
        set description "Sanctioned vs Tolerated Apps by Session"
        set hidden enable
        set dataset "saas-SaaS-Application-by-Session"
        set chart-type donut
        config table-columns
            edit 1
                set data-binding "saas_cat_str"
                set data-top 0
            next
            edit 2
                set data-type aggregate
                set data-binding "total_app"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "saas-SaaS-App-Users-vs-Others"
        set disp-name "Number of Users of SaaS Apps vs Others"
        set category "SaaS"
        set description "Number of Users of SaaS Apps vs Others"
        set dataset "saas-SaaS-App-Users-vs-Others"
        set chart-type donut
        config table-columns
            edit 1
                set data-binding "app_type"
                set data-top 0
            next
            edit 2
                set data-type aggregate
                set data-binding "total_user"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "saas-SaaS-App-Users"
        set disp-name "Number of Users of SaaS Apps"
        set category "SaaS"
        set description "Number of Users of SaaS Apps"
        set dataset "saas-SaaS-App-Users"
        set chart-type donut
        config table-columns
            edit 1
                set data-binding "app_type"
                set data-top 0
            next
            edit 2
                set data-type aggregate
                set data-binding "total_user"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "saas-Top-SaaS-User-by-Bandwidth-Session"
        set disp-name "Top 10 SaaS Users by Bandwidth and Session"
        set category "SaaS"
        set description "Top 10 SaaS Users by Bandwidth and Session"
        set dataset "saas-Top-SaaS-User-by-Bandwidth-Session"
        set chart-type table
        config table-columns
            edit 1
                set header "User"
                set data-binding "saasuser"
                set data-top 10
            next
            edit 2
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
            next
            edit 3
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 4
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
            edit 5
                set header "Sessions"
                set data-binding "session_block"
                set column-span 3
                set column-graph-type bar
                set legend "Blocked"
            next
            edit 6
                set data-binding "session_pass"
                set column-graph-type bar
                set legend "Allowed"
            next
            edit 7
                set data-binding "sessions"
                set column-attr count
            next
            edit 8
                set header "Number of Applications"
                set data-binding "total_app"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "saas-Top-Category-by-SaaS-Application-Usage"
        set disp-name "Top 10 Categories - SaaS Application Usage"
        set category "SaaS"
        set description "Top 10 Categories - SaaS Application Usage"
        set dataset "saas-Top-Category-by-SaaS-Application-Usage"
        set chart-type bar
        config table-columns
            edit 1
                set header "App Category"
                set data-binding "app_cat"
                set data-top 10
            next
            edit 2
                set header "SaaS Category"
                set data-type drilldown
                set data-binding "saas_cat_str"
                set data-top 0
            next
            edit 3
                set header "Number of Apps"
                set data-type aggregate
                set data-binding "total_app"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "saas-Top-SaaS-Category-by-Number-of-User"
        set disp-name "Top 10 SaaS Categories by Number of Users"
        set category "SaaS"
        set description "Top 10 SaaS Categories by Number of Users"
        set dataset "saas-Top-SaaS-Category-by-Number-of-User"
        set chart-type bar
        config table-columns
            edit 1
                set header "App Category"
                set data-binding "app_cat"
                set data-top 10
            next
            edit 2
                set header "SaaS Category"
                set data-type drilldown
                set data-binding "saas_cat_str"
                set data-top 0
            next
            edit 3
                set header "Number of Users"
                set data-type aggregate
                set data-binding "total_user"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "saas-Top-User-by-Number-of-SaaS-Application"
        set disp-name "Top 10 Users by Number of SaaS Applications"
        set category "SaaS"
        set description "Top 10 Users by Number of SaaS Applications"
        set dataset "saas-Top-User-by-Number-of-SaaS-Application"
        set chart-type bar
        config table-columns
            edit 1
                set header "User"
                set data-binding "saasuser"
                set data-top 10
            next
            edit 2
                set header "SaaS Category"
                set data-type drilldown
                set data-binding "saas_cat_str"
                set data-top 0
            next
            edit 3
                set header "Number of Apps"
                set data-type aggregate
                set data-binding "total_app"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "saas-Top-SaaS-Application-by-Bandwidth-Session"
        set disp-name "Top 10 SaaS Applications by Sessions and Bandwidth"
        set category "SaaS"
        set description "Top 10 SaaS Applications by Sessions and Bandwidth"
        set dataset "saas-Top-SaaS-Application-by-Bandwidth-Session"
        set chart-type table
        config table-columns
            edit 1
                set header "Application"
                set data-binding "app_id"
                set column-attr app-id
                set data-top 10
                set column-span 2
            next
            edit 2
                set data-binding "app_s"
            next
            edit 3
                set header "Category"
                set data-binding "app_cat"
            next
            edit 4
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
            next
            edit 5
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 6
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
            edit 7
                set header "Sessions"
                set data-binding "session_block"
                set column-span 3
                set column-graph-type bar
                set legend "Blocked"
            next
            edit 8
                set data-binding "session_pass"
                set column-graph-type bar
                set legend "Allowed"
            next
            edit 9
                set data-binding "sessions"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "saas-Top-Tolerated-SaaS-Application-by-Bandwidth"
        set disp-name "Top 10 Tolerated SaaS Applications by Bandwidth"
        set category "SaaS"
        set description "Top 10 Tolerated SaaS Applications by Bandwidth"
        set hidden enable
        set dataset "saas-Top-Tolerated-SaaS-Application-by-Bandwidth"
        set chart-type bar
        config table-columns
            edit 1
                set header "Application"
                set data-binding "app_s"
                set data-top 10
            next
            edit 2
                set header "Bytes"
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "saas-drilldown-Top-Tolerated-SaaS-Application"
        set disp-name "drilldown - Top 5 Tolerated SaaS Apps by Bandwidth and Session"
        set category "SaaS"
        set description "drilldown - Top 5 Tolerated SaaS Apps by Bandwidth and Session"
        set hidden enable
        set dataset "saas-drilldown-Top-Tolerated-SaaS-Application"
        set chart-type table
        config table-columns
            edit 1
                set header "Application"
                set data-binding "app_s"
                set data-top 5
            next
            edit 2
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
            next
            edit 3
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 4
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
            edit 5
                set header "Sessions"
                set data-binding "session_block"
                set column-span 3
                set column-graph-type bar
                set legend "Blocked"
            next
            edit 6
                set data-binding "session_pass"
                set column-graph-type bar
                set legend "Allowed"
            next
            edit 7
                set data-binding "sessions"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "saas-Top-User-by-Tolerated-SaaS-Application-Drilldown"
        set disp-name "Top 5 Users by Top 5 Tolerated SaaS Apps Drilldown"
        set category "SaaS"
        set description "Top 5 Users by Top 5 Tolerated SaaS Apps Drilldown"
        set hidden enable
        set dataset "saas-Top-User-by-Tolerated-SaaS-Application"
        set chart-type table
        config table-columns
            edit 1
                set header "User"
                set data-binding "saasuser"
                set data-top 5
            next
            edit 2
                set header "Number of Apps"
                set data-binding "total_app"
                set column-attr count
            next
        end
        config drill-down-table
            edit 1
                set chart "saas-drilldown-Top-Tolerated-SaaS-Application"
            next
        end
        set drill-down-layout "<h2>${var.title.\"User\"}</h2><p>Total ${var.title.\"Number of Apps\"} Apps</p>${chart.id.1}"
        set protected enable
    next
    edit "saas-drilldown-Top-File-Sharing-SaaS-Application-Detail"
        set disp-name "Top 5 File Sharing SaaS Applications Detail"
        set category "SaaS"
        set description "Top 5 File Sharing SaaS Applications Detail"
        set hidden enable
        set dataset "saas-drilldown-Top-File-Sharing-SaaS-Application-Detail"
        set chart-type table
        config table-columns
            edit 1
                set header "User"
                set data-binding "saasuser"
                set data-top 5
            next
            edit 2
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
            next
            edit 3
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 4
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
            edit 5
                set header "Sessions"
                set data-binding "session_block"
                set column-span 3
                set column-graph-type bar
                set legend "Blocked"
            next
            edit 6
                set data-binding "session_pass"
                set column-graph-type bar
                set legend "Allowed"
            next
            edit 7
                set data-binding "sessions"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "saas-Top-File-Sharing-SaaS-Application"
        set disp-name "Top 5 File Sharing SaaS Applications"
        set category "SaaS"
        set description "Top 5 File Sharing SaaS Applications"
        set dataset "saas-Top-File-Sharing-SaaS-Application"
        set chart-type table
        config table-columns
            edit 1
                set header "Application"
                set data-binding "appid"
                set column-attr app-id
                set data-top 5
                set column-span 2
            next
            edit 2
                set data-binding "app_group"
            next
            edit 3
                set header "Number of Users"
                set data-binding "total_user"
            next
            edit 4
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
            next
            edit 5
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 6
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
            edit 7
                set header "Sessions"
                set data-binding "session_block"
                set column-span 3
                set column-graph-type bar
                set legend "Blocked"
            next
            edit 8
                set data-binding "session_pass"
                set column-graph-type bar
                set legend "Allowed"
            next
            edit 9
                set data-binding "sessions"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "saas-Top-File-Sharing-SaaS-Application-Drilldown"
        set disp-name "Top 5 File Sharing SaaS Applications Drilldown"
        set category "SaaS"
        set description "Top 5 File Sharing SaaS Applications Drilldown"
        set dataset "saas-Top-File-Sharing-SaaS-Application"
        set chart-type table
        config table-columns
            edit 1
                set header "Application"
                set data-binding "app_group"
                set data-top 5
            next
            edit 2
                set header "Risk"
                set data-binding "risk"
            next
        end
        config drill-down-table
            edit 1
                set chart "saas-drilldown-Top-File-Sharing-SaaS-Application-Detail"
            next
        end
        set drill-down-layout "<h2>${var.title.\"Application\"}</h2><p>Risk: ${var.title.\"Risk\"}</p>${chart.id.1}"
        set protected enable
    next


    edit "aware-Device-By-Location"
        set disp-name "Device by Location"
        set description "Device by Location"
        set dataset "aware-Device-By-Location"
        set chart-type donut
        config table-columns
            edit 1
                set data-binding "country"
                set data-top 10
            next
            edit 2
                set data-type aggregate
                set data-binding "device_count"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "aware-Network-Endpoint-Devices"
        set disp-name "Endpoint Devices on Network"
        set description "Endpoint Devices on Network"
        set dataset "aware-Network-Endpoint-Devices"
        set chart-type donut
        config table-columns
            edit 1
                set data-binding "category"
                set data-top 0
            next
            edit 2
                set data-type aggregate
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "aware-New-Endpoint-Devices"
        set disp-name "Top 3 New Endpoint Devices"
        set description "Top 3 New Endpoint Devices"
        set dataset "aware-New-Endpoint-Devices"
        set chart-type table
        config table-columns
            edit 1
                set header "Detected Date/Time"
                set data-binding "timestamp"
                set data-top 3
                set column-width 20
            next
            edit 2
                set header "New Devices"
                set data-binding "devtype"
                set column-attr dev-type
                set column-span 2
                set column-width 20
            next
            edit 3
                set data-binding "hostname"
            next
            edit 4
                set header "User"
                set data-binding "user_agg"
                set column-width 20
            next
            edit 5
                set header "IP"
                set data-binding "srcip"
                set column-width 20
            next
            edit 6
                set header "OS"
                set data-binding "osname"
                set column-width 20
            next
        end
        set protected enable
    next
    edit "aware-New-Endpoint-Devices-Trend"
        set disp-name "New Endpoint Devices Trend"
        set description "New Endpoint Devices Trend"
        set dataset "aware-New-Endpoint-Devices-Trend"
        set chart-type line
        config table-columns
            edit 1
                set header "Time"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "total_num"
                set column-graph-type line-up
                set legend "Number of New Devices"
            next
        end
        set protected enable
    next
    edit "aware-Top-Endpoint-Operating-Systems"
        set disp-name "Top Endpoint Operating Systems"
        set description "Top Endpoint Operating Systems"
        set dataset "aware-Top-Endpoint-Operating-Systems"
        set chart-type table
        config table-columns
            edit 1
                set header "Operating System"
                set data-binding "os"
                set data-top 10
                set column-attr none
                set column-width 40
            next
            edit 2
                set header "Count"
                set column-span 2
                set column-graph-type bar
                set data-binding "total_num"
                set data-top 10
                set column-width 60
            next
            edit 3
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "aware-Top-Endpoint-Applications-Windows"
        set disp-name "Top 5 Endpoint Applications - Windows"
        set description "Top 5 Endpoint Applications - Windows"
        set dataset "aware-Top-Endpoint-Applications-Windows"
        set chart-type donut
        set include-other disable
        config table-columns
            edit 1
                set data-binding "srcname"
                set data-top 5
            next
            edit 2
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "aware-Top-Endpoint-Applications-Mac"
        set disp-name "Top 5 Endpoint Applications - Mac"
        set description "Top 5 Endpoint Applications - Mac"
        set dataset "aware-Top-Endpoint-Applications-Mac"
        set chart-type donut
        set include-other disable
        config table-columns
            edit 1
                set data-binding "srcname"
                set data-top 5
            next
            edit 2
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "aware-Top-SaaS-Application-by-Number-of-Users"
        set disp-name "Top 10 SaaS Applications by Number of Users"
        set description "Top 10 SaaS Applications by Number of Users"
        set dataset "aware-Top-SaaS-Application-by-Number-of-Users"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header ""
                set data-binding "app_group"
                set data-top 10
            next
            edit 2
                set header "Users"
                set data-binding "total_user"
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "aware-Summary-Of-Changes"
        set disp-name "Summary of Changes"
        set description "Summary of Changes"
        set dataset "aware-Summary-Of-Changes"
        set chart-type donut
        config table-columns
            edit 1
                set data-binding "msg_trim"
                set data-top 10
            next
            edit 2
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "aware-Change-Details"
        set disp-name "Change Details"
        set description "Change Details"
        set dataset "aware-Change-Details"
        set chart-type table
        config table-columns
            edit 1
                set header "Date/Time"
                set data-binding "timestamp"
                set data-top 25
            next
            edit 2
                set header "User"
                set data-binding "user"
            next
            edit 3
                set header "User Interface"
                set data-binding "ui"
            next
            edit 4
                set header "Action Performed"
                set data-binding "msg"
            next
        end
        set protected enable
    next
    edit "aware-Vulnerabilities-By-Severity"
        set disp-name "Vulnerabilities by Severity"
        set description "Vulnerabilities by Severity"
        set dataset "aware-Vulnerabilities-By-Severity"
        set chart-type donut
        config table-columns
            edit 1
                set data-binding "vulnseverity"
                set data-top 5
            next
            edit 2
                set data-binding "vuln_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "aware-Vulnerabilities-Trend"
        set disp-name "Vulnerabilities Trend"
        set description "Vulnerabilities Trend"
        set dataset "aware-Vulnerabilities-Trend"
        set chart-type line
        config table-columns
            edit 1
                set data-binding "timescale"
                set data-top 3
                set column-attr time
            next
            edit 2
                set data-binding "critical"
                set legend "Critical"
                set column-graph-type line-up
            next
            edit 3
                set data-binding "high"
                set legend "High"
                set column-graph-type line-up
            next
            edit 4
                set data-binding "medium"
                set legend "Medium"
                set column-graph-type line-up
            next
            edit 5
                set data-binding "low"
                set legend "Low"
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "aware-Top-Critical-Vulnerabilities"
        set disp-name "Top 10 Critical Vulnerabilities - Endpoint"
        set description "Top 10 Critical Vulnerabilities - Endpoint"
        set dataset "aware-Top-Critical-Vulnerabilities"
        set chart-type table
        config table-columns
            edit 1
                set header "Vulnerability"
                set data-binding "vulnname"
                set data-top 10
            next
            edit 2
                set header "Threat"
                set data-binding "vulnseverity"
                set column-span 2
                set column-attr severity
            next
            edit 3
                set data-binding "vulnseverity"
            next
            edit 4
                set data-binding "vulncat"
                set header "Category"
            next
            edit 5
                set header "#Devices"
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "aware-Top-Vulnerabilities-Last-Period"
        set disp-name "Top 10 Endpoint Vulnerabilities in Last Period"
        set description "Top 10 Endpoint Vulnerabilities in Last Period"
        set dataset "aware-Top-Vulnerabilities-Last-Period"
        set chart-type table
        config table-columns
            edit 1
                set header "Vulnerability"
                set data-binding "vulnname"
                set data-top 10
            next
            edit 2
                set header "Threat"
                set data-binding "vulnseverity"
                set column-span 2
                set column-attr severity
            next
            edit 3
                set data-binding "vulnseverity"
            next
            edit 4
                set header "Category"
                set data-binding "vulncat"
            next
            edit 5
                set header "#Device"
                set data-binding "total_num"
            next
        end
        set protected enable
    next
    edit "aware-Top-New-Vulnerabilities"
        set disp-name "Top 10 New Vulnerabilities"
        set description "Top 10 New Vulnerabilities"
        set dataset "aware-Top-New-Vulnerabilities"
        set chart-type table
        config table-columns
            edit 1
                set header "Vulnerability"
                set data-binding "vulnname"
                set data-top 10
            next
            edit 2
                set header "Threat"
                set data-binding "vulnseverity"
                set column-span 2
                set column-attr severity
            next
            edit 3
                set data-binding "vulnseverity"
            next
            edit 4
                set header "Category"
                set data-binding "vulncat"
            next
            edit 5
                set header "#Device"
                set data-binding "host_num"
            next
        end
        set protected enable
    next
    edit "aware-Top-User-With-Critical-Vulnerabilities"
        set disp-name "Top 10 Users with Critical Vulnerabilities"
        set description "Top 10 Users with Critical Vulnerabilities"
        set dataset "aware-Top-User-With-Critical-Vulnerabilities"
        set chart-type table
        config table-columns
            edit 1
                set header "Host"
                set data-binding "hostname"
                set data-top 10
            next
            edit 2
                set header "User"
                set data-binding "user_src"
            next
            edit 3
                set header "Vulnerability"
                set data-binding "vulnname"
            next
            edit 4
                set header "Category"
                set data-binding "vulncat"
            next
            edit 5
                set header "Count"
                set data-binding "total_num"
            next
        end
        set protected enable
    next
    edit "aware-Ingress-Data-Flow-By-Zone"
        set disp-name "Ingress Data Flow By Zone"
        set description "Top 10 Ingress Data Flow By Zone"
        set dataset "aware-Ingress-Data-Flow-By-Zone"
        set chart-type bar
        config table-columns
            edit 1
                set header "Zone"
                set data-binding "tag"
                set data-top 10
            next
            edit 2
                set header "App"
                set data-type drilldown
                set data-binding "app"
                set data-top 5
            next
            edit 3
                set header "Traffic"
                set data-binding "rcvdbyte"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "aware-Egress-Data-Flow-By-Zone"
        set disp-name "Egress Data Flow By Zone"
        set description "Top 10 Egress Data Flow By Zone"
        set dataset "aware-Egress-Data-Flow-By-Zone"
        set chart-type bar
        config table-columns
            edit 1
                set header "Zone"
                set data-binding "tag"
                set data-top 10
            next
            edit 2
                set header "App"
                set data-type drilldown
                set data-binding "app"
                set data-top 5
            next
            edit 3
                set header "Traffic"
                set data-binding "sentbyte"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "aware-Top-Device-Attack-Targets"
        set disp-name "Top 5 Device Attack Targets - Endpoint"
        set description "Top 5 Device Attack Targets - Endpoint"
        set dataset "aware-Top-Device-Attack-Targets"
        set chart-type table
        config table-columns
            edit 1
                set header "Device"
                set data-binding "hostname"
                set data-top 5
            next
            edit 2
                set header "Count"
                set data-binding "total_num"
                set column-span 2
                set column-graph-type bar
            next
            edit 3
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "aware-Top-Attack-Targets"
        set disp-name "Top Attack Targets - Endpoint"
        set description "Top Attack Targets - Endpoint"
        set dataset "aware-Top-Attack-Targets"
        set chart-type table
        config table-columns
            edit 1
                set header "Device"
                set data-binding "hostname"
                set column-width 25
                set data-top 10
            next
            edit 2
                set header "IP Address"
                set data-binding "srcip"
                set column-width 15
            next
            edit 3
                set header "OS"
                set data-binding "os"
                set column-width 20
            next
            edit 4
                set header "Intrusion Attacks"
                set data-binding "vuln_num"
                set column-width 10
            next
            edit 5
                set header "Severity"
                set data-binding "severity_num"
                set column-span 2
                set column-attr severity
                set column-width 10
            next
            edit 6
                set data-binding "vulnseverity"
            next
            edit 7
                set header "CVE Numbers"
                set data-binding "cve_agg"
                set column-width 20
            next
        end
        set protected enable
    next
    edit "aware-Threats-By-Severity"
        set disp-name "Threats by Severity"
        set description "Threats by Severity"
        set dataset "aware-Threats-By-Severity"
        set chart-type donut
        config table-columns
            edit 1
                set data-binding "severity"
                set data-top 5
            next
            edit 2
                set data-binding "total_num"
                set column-attr count
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "aware-Threats-Type-By-Severity"
        set disp-name "Threat Types by Severity"
        set description "Threat Types by Severity"
        set dataset "aware-Threats-Type-By-Severity"
        set chart-type table
        config table-columns
            edit 1
                set header "Threat Type"
                set data-binding "threat_type"
                set data-top 5
            next
            edit 2
                set header "Critical"
                set data-binding "critical"
                set column-attr count
            next
            edit 3
                set header "High"
                set data-binding "high"
                set column-attr count
            next
            edit 4
                set header "Medium"
                set data-binding "medium"
                set column-attr count
            next
            edit 5
                set header "Low"
                set data-binding "low"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "aware-Threats-By-Day"
        set disp-name "Threats by Day"
        set description "Threats by Day"
        set dataset "aware-Threats-By-Day"
        set chart-type bar
        config table-columns
            edit 1
                set data-binding "daystamp"
                set data-top 7
            next
            edit 2
                set data-binding "total_num"
                set data-top 3
                set column-attr count
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "aware-Threats-By-Day-Radar"
        set disp-name "Threats by Day Radar"
        set description "Threats by Day Radar"
        set dataset "aware-Threats-By-Day"
        set chart-type radar
        config table-columns
            edit 1
                set data-binding "daystamp"
                set data-top 7
            next
            edit 2
                set data-binding "total_num"
                set data-top 3
                set column-attr count
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "aware-Count-Of-Malware-Events"
        set disp-name "Count of Malware Events"
        set description "Count of Malware Events"
        set dataset "aware-Count-Of-Malware-Events"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set data-binding "virus"
                set data-top 10
            next
            edit 2
                set data-binding "total_num"
                set data-top 3
                set column-attr count
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "aware-Top-Malware-By-Count"
        set disp-name "Top 10 Malware by Count"
        set description "Top 10 Malware by Count"
        set dataset "aware-Top-Malware-By-Count"
        set chart-type table
        config table-columns
            edit 1
                set header "Malware Name"
                set data-binding "virus"
                set data-top 10
            next
            edit 2
                set header "Malware Type"
                set data-binding "malware_type"
            next
            edit 3
                set header "Threat"
                set data-binding "risk_level"
                set column-span 2
                set column-attr severity
            next
            edit 4
                set data-binding "risk_level"
            next
            edit 5
                set header "Victim"
                set data-binding "victim"
                set column-attr count
            next
            edit 6
                set header "Source"
                set data-binding "source"
                set column-attr count
            next
            edit 7
                set header "Count"
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "aware-Top-Failed-Login-Attempts"
        set disp-name "Top 5 Failed Login Attempts"
        set description "Top 5 Failed Login Attempts"
        set dataset "aware-Top-Failed-Login-Attempts"
        set chart-type table
        config table-columns
            edit 1
                set header "User"
                set data-binding "f_user"
                set data-top 5
            next
            edit 2
                set header "Source"
                set data-binding "ui"
            next
            edit 3
                set header "Destination"
                set data-binding "dstip"
            next
            edit 4
                set header "Failed Login Attempts"
                set data-binding "total_failed"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "aware-Top-Failed-Authentication-Attempts"
        set disp-name "Top 5 Failed Authentication Attempts"
        set description "Top 5 Failed Authentication Attempts"
        set dataset "vpn-Failed-Logins"
        set chart-type table
        config table-columns
            edit 1
                set header "User"
                set data-binding "f_user"
                set column-attr user
                set data-top 5
            next
            edit 2
                set header "Type"
                set data-binding "tunneltype"
            next
            edit 3
                set header "# of Failed Authentications"
                set data-binding "total_num"
                set column-span 2
                set column-graph-type bar
            next
            edit 4
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "aware-Top-Denied-Connections"
        set disp-name "Top 5 Denied Connections"
        set description "Top 5 Denied Connections"
        set dataset "aware-Top-Denied-Connections"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set data-top 5
            next
            edit 2
                set header "Interface"
                set data-binding "interface"
            next
            edit 3
                set header "Destination"
                set data-binding "dstip"
            next
            edit 4
                set header "#Denied connection attempts"
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "aware-Failed-Compliance-Checked-By-Device"
        set disp-name "Failed Compliance Checks by Device"
        set description "Failed Compliance Checks by Device"
        set dataset "aware-Failed-Compliance-Checked-By-Device"
        set chart-type table
        config table-columns
            edit 1
                set header "Device"
                set data-binding "devid"
                set data-top 10
            next
            edit 2
                set header "Compliance Check Result"
                set data-binding "results"
            next
            edit 3
                set header "Count"
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "aware-Ioc-Blacklist-Summary"
        set disp-name "IOC Breaches by Source"
        set description "IOC Breaches by Source"
        set dataset "aware-Ioc-Blacklist-Summary"
        set chart-type table
        config table-columns
            edit 1
                set header "Source"
                set data-binding "epname"
                set column-width 15
            next
            edit 2
                set header "User"
                set data-binding "user_agg"
                set column-width 25
            next
            edit 3
                set header "Threat"
                set data-binding "threats"
                set column-width 40
            next
            edit 4
                set header "Severity"
                set data-binding "sevid"
                set column-span 2
                set column-attr severity
                set column-width 10
            next
            edit 5
                set data-binding "severity"
            next
            edit 6
                set header "#Event"
                set data-binding "total_bl"
                set column-width 10
            next
        end
        set protected enable
    next
    edit "aware-Ioc-Potential-Breach-By-Day"
        set disp-name "IOC Potential Breach by Day"
        set description "IOC Potential Breach by Day"
        set dataset "aware-Ioc-Potential-Breach-By-Day"
        set chart-type radar
        config table-columns
            edit 1
                set data-binding "itime"
                set data-top 0
            next
            edit 2
                set data-binding "number"
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "aware-Ioc-Potential-Breach-By-Day-Bar"
        set disp-name "IOC Potential Breach by Day - Bar"
        set description "IOC Potential Breach by Day - Bar"
        set dataset "aware-Ioc-Potential-Breach-By-Day"
        set chart-type bar
        config table-columns
            edit 1
                set data-binding "itime"
                set data-top 0
            next
            edit 2
                set data-binding "number"
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "aware-Ioc-Suspicion-Summary"
        set disp-name "IOC Top 10 Potential Breaches"
        set description "IOC Top 10 Potential Breaches"
        set dataset "aware-Ioc-Suspicion-Summary"
        set chart-type table
        config table-columns
            edit 1
                set header "Device"
                set data-binding "epname"
                set column-width 20
                set data-top 10
            next
            edit 2
                set header "#Event"
                set data-binding "total_cs"
                set column-width 15
                set column-span 2
                set column-graph-type bar
            next
            edit 3
                set data-binding "total_cs"
            next
            edit 4
                set header "Verdict"
                set data-binding "max_verdict"
                set column-width 8
            next
            edit 5
                set header "Confidence Level"
                set data-binding "max_cs"
                set column-graph-type bar
                set column-width 15
                set column-span 2
            next
            edit 6
                set data-binding "max_cs"
            next
            edit 7
                set header "Threats"
                set data-binding "threats"
                set column-width 42
            next
        end
        set protected enable
    next
    edit "aware-Botnet-IP"
        set disp-name "Top 10 Source IP Affected by Botnet"
        set description "Top 10 Source IP Affected by Botnet"
        set dataset "aware-Botnet-IP"
        set chart-type table
        config table-columns
            edit 1
                set header "Source"
                set data-binding "source"
                set column-width 15
                set data-top 10
            next
            edit 2
                set header "Virus"
                set data-binding "virus_agg"
                set column-width 15
            next
            edit 3
                set header "Dest Count"
                set data-binding "dstip_cnt"
                set column-graph-type bar
                set legend "Dest Count"
                set column-width 30
                set column-span 2
            next
            edit 4
                set data-binding "dstip_cnt"
            next
            edit 5
                set header "#Session Count"
                set data-binding "total_num"
                set column-width 10
                set column-attr count
            next
            edit 6
                set header "First Seen"
                set data-binding "first_seen"
                set column-width 15
            next
            edit 7
                set header "Last Seen"
                set data-binding "last_seen"
                set column-width 15
            next
        end
        set protected enable
    next
    edit "aware-Botnet-Domain"
        set disp-name "Top 10 Botnet by Domain"
        set description "Top 10 Botnet by Domain"
        set dataset "aware-Botnet-Domain"
        set chart-type table
        config table-columns
            edit 1
                set header "Botnet"
                set data-binding "botnet"
                set column-width 30
                set data-top 10
            next
            edit 2
                set header "#Domain"
                set data-binding "qname_cnt"
                set column-width 10
            next
            edit 3
                set header "#DNS Server"
                set data-binding "dnssvr_cnt"
                set column-width 10
            next
            edit 4
                set header "Session Count"
                set data-binding "total_num"
                set column-attr count
                set column-width 10
            next
            edit 5
                set header "First Seen"
                set data-binding "first_seen"
                set column-width 20
            next
            edit 6
                set header "Last Seen"
                set data-binding "last_seen"
                set column-width 20
            next
        end
        set protected enable
    next
    edit "aware-High-Risk-URL-Category"
        set disp-name "Top 20 Categories by High Risk URLs"
        set description "Top 20 Categories by High Risk URLs"
        set dataset "aware-High-Risk-URL-Category"
        set chart-type table
        config table-columns
            edit 1
                set header "Category"
                set data-binding "catdesc"
                set column-width 15
                set data-top 20
            next
            edit 2
                set header "Host"
                set data-binding "hostname_agg"
                set column-width 50
                set column-attr obf-url
            next
            edit 3
                set header "Session Count"
                set data-binding "total_num"
                set column-attr count
                set column-width 15
            next
            edit 4
                set header "First Seen"
                set data-binding "first_seen"
                set column-width 10
            next
            edit 5
                set header "Last Seen"
                set data-binding "last_seen"
                set column-width 10
            next
        end
        set protected enable
    next
    edit "aware-Malicious-Files"
        set disp-name "Top 30 Malicious Virus and Files from AV and Sandbox"
        set description "Top 30 Malicious Virus and Files from AV and Sandbox"
        set dataset "aware-Malicious-Files"
        set chart-type table
        config table-columns
            edit 1
                set header "Malware"
                set data-binding "virus"
                set column-width 10
                set data-top 30
            next
            edit 2
                set header "Filename"
                set data-binding "filename_agg"
                set column-attr html
                set column-width 25
            next
            edit 3
                set header "URL"
                set data-binding "url_agg"
                set column-width 25
                set column-attr obf-url
            next
            edit 4
                set header "Action"
                set data-binding "action"
                set column-width 5
            next
            edit 5
                set header "Quarantine Status"
                set data-binding "quarskip"
                set column-width 5
            next
            edit 6
                set header "Session_Count"
                set data-binding "total_num"
                set column-width 5
                set column-attr count
            next
            edit 7
                set header "First Seen"
                set data-binding "first_seen"
                set column-width 10
            next
            edit 8
                set header "Last Seen"
                set data-binding "last_seen"
                set column-width 10
            next
            edit 9
                set header "By Sandbox"
                set data-binding "from_sandbox"
                set column-width 5
            next
        end
        set protected enable
    next


    edit "newthing-New-Users"
        set disp-name "New Users"
        set description "New Users"
        set dataset "newthing-New-Users"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "f_user"
                set data-top 500
            next
            edit 2
                set header "Date Added"
                set data-binding "start_time"
            next
        end
        set protected enable
    next
    edit "newthing-New-Devices"
        set disp-name "New Devices"
        set description "New Devices"
        set dataset "newthing-New-Devices"
        set chart-type table
        config table-columns
            edit 1
                set header "Host Name"
                set data-binding "hostname"
                set data-top 500
                set column-width 20
            next
            edit 2
                set header "OS"
                set data-binding "devtype"
                set column-attr dev-type
                set column-span 2
                set column-width 40
            next
            edit 3
                set data-binding "os_agg"
            next
            edit 4
                set header "Source"
                set data-binding "srcip_agg"
                set column-width 20
            next
            edit 5
                set header "FCT Version"
                set data-binding "fctver_agg"
                set column-width 20
            next
        end
        set protected enable
    next
    edit "newthing-New-Software-Installed"
        set disp-name "New Software Installed"
        set description "New Software Installed"
        set dataset "newthing-New-Software-Installed"
        set chart-type table
        config table-columns
            edit 1
                set header "Software"
                set data-binding "srcproduct"
                set data-top 500
            next
            edit 2
                set header "Host Name"
                set data-binding "host_agg"
            next
        end
        set protected enable
    next
    edit "newthing-New-Security-Threats"
        set disp-name "New Security Threats"
        set description "New Security Threats"
        set dataset "newthing-New-Security-Threats"
        set chart-type table
        config table-columns
            edit 1
                set header "Name"
                set data-binding "threat_name"
                set data-top 500
            next
            edit 2
                set header "Category"
                set data-binding "threat_cat"
            next
            edit 3
                set header "Host"
                set data-binding "host_num"
                set column-attr count
            next
            edit 4
                set header "CVE"
                set data-binding "cve_agg"
            next
        end
        set protected enable
    next
    edit "newthing-dns-Botnet-Domain-IP"
        set disp-name "New Botnet Domains and IPs Detected by DNS Filtering"
        set description "DNS - Queried Botnet C&C Domains and IPs"
        set dataset "newthing-dns-Botnet-Domain-IP"
        set chart-type table
        config table-columns
            edit 1
                set header "Domain (or IP)"
                set data-binding "domain"
                set data-top 30
                set column-attr obf-url
            next
            edit 2
                set header "Source IP"
                set data-binding "srcip"
            next
            edit 3
                set header "Severity"
                set data-binding "severity"
                set column-span 2
                set column-attr severity
            next
            edit 4
                set data-binding "severity"
            next
        end
        set protected enable
    next
    edit "newthing-New-Security-Threats-Timeline"
        set disp-name "New Security Threats Timeline"
        set description "New Security Threats Timeline"
        set dataset "newthing-New-Security-Threats-Timeline"
        set chart-type bar
        set order-by "timescale"
        config table-columns
            edit 1
                set header "Date"
                set data-binding "timescale"
                set column-attr none
                set data-top 0
            next
            edit 2
                set header "Threat Category"
                set data-type drilldown
                set data-binding "threat_cat"
            next
            edit 3
                set data-type aggregate
                set data-binding "host_num"
            next
        end
        set protected enable
    next
    edit "newthing-New-Vulnerability"
        set disp-name "New Vulnerabilities"
        set description "New Vulnerabilities"
        set dataset "newthing-New-Vulnerability"
        set chart-type table
        config table-columns
            edit 1
                set header "Vulnerability Name"
                set data-binding "vulnname"
                set data-top 500
                set column-width 42
            next
            edit 2
                set header "Threat Level"
                set data-binding "vulnseverity"
                set column-attr severity
                set column-span 2
                set column-width 12
            next
            edit 3
                set data-binding "vulnseverity"
            next
            edit 4
                set header "Category"
                set data-binding "vulncat"
                set column-width 11
            next
            edit 5
                set header "Hosts"
                set data-binding "host_num"
                set column-attr count
                set column-width 5
            next
            edit 6
                set header "CVE"
                set data-binding "cve_id"
                set column-width 30
            next
        end
        set protected enable
    next
    edit "newthing-New-Vulnerability-Graph"
        set disp-name "New Vulnerabilities (Graph)"
        set description"New Vulnerabilities (Graph)"
        set dataset "newthing-New-Vulnerability-Graph"
        set chart-type donut
        config table-columns
            edit 1
                set data-binding "vulnseverity"
            next
            edit 2
                set header "Vulnerabilities"
                set data-type aggregate
                set data-binding "vuln_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "newthing-System-Alerts"
        set disp-name "System Alerts"
        set description "System Alerts"
        set dataset "newthing-System-Alerts"
        set chart-type table
        config table-columns
            edit 1
                set header "Message"
                set data-binding "msg"
                set column-width 80
                set data-top 500
            next
            edit 2
                set header "Time"
                set data-binding "timestamp"
                set column-width 20
            next
        end
        set protected enable
    next
    edit "newthing-Configuration-Changes"
        set disp-name "Configuration Changes"
        set description "Configuration Changes"
        set dataset "newthing-Configuration-Changes"
        set chart-type table
        config table-columns
            edit 1
                set header "User"
                set data-binding "f_user"
                set data-top 500
                set column-width 20
            next
            edit 2
                set header "Device"
                set data-binding "devid"
                set column-width 20
            next
            edit 3
                set header "Date/Time"
                set data-binding "time_s"
                set column-width 20
            next
            edit 4
                set header "User Interface"
                set data-binding "ui"
                set column-width 15
            next
            edit 5
                set header "Action Performed"
                set data-binding "msg"
                set column-width 25
            next
        end
        set protected enable
    next
    edit "newthing-FortiGate-Upgrades"
        set disp-name "FortiGate Upgrades"
        set description "FortiGate Upgrades"
        set dataset "newthing-FortiGate-Upgrades"
        set chart-type table
        config table-columns
            edit 1
                set header "Device"
                set data-binding "devid"
                set data-top 500
            next
            edit 2
                set header "User Interface"
                set data-binding "intf"
            next
            edit 3
                set header "Previous Version"
                set data-binding "prev_ver"
            next
            edit 4
                set header "New Version"
                set data-binding "new_ver"
            next
            edit 5
                set header "Date/Time"
                set data-binding "time_s"
            next
        end
        set protected enable
    next
    edit "newthing-User-Upgrades"
        set disp-name "User Upgrades"
        set description "User Upgrades"
        set dataset "newthing-User-Upgrades"
        set chart-type table
        config table-columns
            edit 1
                set header "Host Name"
                set data-binding "hostname"
                set data-top 500
            next
            edit 2
                set header "Device"
                set data-binding "devid"
            next
            edit 3
                set header "IP Address"
                set data-binding "deviceip"
            next
            edit 4
                set header "Previous Version"
                set data-binding "prev_os"
            next
            edit 5
                set header "New Version"
                set data-binding "cur_os"
            next
            edit 6
                set header "Date/Time"
                set data-binding "time_s"
            next
        end
        set protected enable
    next

    edit "GTP-List-of-APN-Used"
        set disp-name "List of APNs Used"
        set description "GTP - List of APNs Used"
        set dataset "GTP-List-of-APN-Used"
        set chart-type table
        config table-columns
            edit 1
                set header "APN"
                set data-binding "apn"
                set column-width 40
                set data-top 0
            next
            edit 2
                set header "Last Seen"
                set data-binding "last_seen"
                set column-width 30
            next
            edit 3
                set header "First Seen"
                set data-binding "first_seen"
                set column-width 30
            next
        end
        set protected enable
    next
    edit "GTP-Top-APN-by-Bytes"
        set disp-name "Top 30 APNs by Bytes"
        set description "GTP - Top 30 APNs by Bytes"
        set dataset "GTP-Top-APN-by-Bytes"
        set chart-type table
        config table-columns
            edit 1
                set header "APN"
                set data-binding "apn"
                set column-width 40
                set data-top 30
            next
            edit 2
                set header "Bytes"
                set data-binding "total_bytes"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "total_bytes"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "GTP-Top-APN-by-Duration"
        set disp-name "Top 30 APNs by Duration"
        set description "GTP - Top 30 APNs by Duration"
        set dataset "GTP-Top-APN-by-Duration"
        set chart-type table
        config table-columns
            edit 1
                set header "APN"
                set data-binding "apn"
                set column-width 40
                set data-top 30
            next
            edit 2
                set header "Duration"
                set data-binding "total_dura"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "total_dura"
                set column-attr timespan
            next
        end
        set protected enable
    next
    edit "GTP-Top-APN-by-Packets"
        set disp-name "Top 30 APNs by Number of Packets"
        set description "GTP - Top 30 APNs by Number of Packets"
        set dataset "GTP-Top-APN-by-Packets"
        set chart-type table
        config table-columns
            edit 1
                set header "APN"
                set data-binding "apn"
                set column-width 40
                set data-top 30
            next
            edit 2
                set header "# of Packets"
                set data-binding "total_num"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "Top10-dns-Botnet-Domain-IP"
        set disp-name "Top 10 Botnet Command-and-Control Domains and IPs Detected by DNS Filtering"
        set description "Top 10 DNS - Queried Botnet C&C Domains and IPs"
        set dataset "dns-Top-Botnet-Domain-IP"
        set chart-type table
        config table-columns
            edit 1
                set header "Botnet Domain (or IP)"
                set data-binding "domain"
                set data-top 10
                set column-width 35
                set column-attr obf-url
            next
            edit 2
                set header "Malware Type"
                set data-binding "malware_type"
                set column-width 35
            next
            edit 3
                set header "Victim"
                set data-binding "victims"
                set column-attr count
                set column-width 10
            next
            edit 4
                set header "Source"
                set data-binding "sources"
                set column-attr count
                set column-width 10
            next
            edit 5
                set header "Count"
                set data-binding "total_num"
                set column-attr count
                set column-width 10
            next
        end
        set protected enable
    next
    edit "dns-Botnet-Usage"
        set disp-name "Botnet Command-and-Control Usage Detected by DNS Filtering"
        set description "Botnet Command-and-Control Usage"
        set dataset "dns-Top-Botnet-Domain-IP"
        set chart-type table
        config table-columns
            edit 1
                set header "Botnet Domain (or IP)"
                set data-binding "domain"
                set data-top 30
                set column-width 30
                set column-attr obf-url
            next
            edit 2
                set header "DNS Action"
                set data-binding "action"
                set column-width 30
            next
            edit 3
                set header "Victim"
                set data-binding "victims"
                set column-attr count
                set column-width 20
            next
            edit 4
                set header "Session Count"
                set data-binding "total_num"
                set column-attr count
                set column-width 20
            next
        end
        set protected enable
    next
    edit "Dns-Detected-Botnet"
        set disp-name "DNS Detected Botnets"
        set description "DNS Detected botnets"
        set dataset "dns-Top-Botnet-Domain-IP"
        set chart-type table
        config table-columns
            edit 1
                set header "Domain (or IP)"
                set data-binding "domain"
                set data-top 30
                set column-width 30
                set column-attr obf-url
            next
            edit 2
                set header "Victim"
                set data-binding "victims"
                set column-attr count
                set column-width 30
            next
            edit 3
                set header "Counts"
                set data-binding "total_num"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 4
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "dns-Botnet-Domain-IP"
        set disp-name "Botnet Domains and IPs Detected by DNS Filtering"
        set description "DNS - Queried Botnet C&C Domains and IPs"
        set dataset "dns-Botnet-Domain-IP"
        set chart-type table
        config table-columns
            edit 1
                set header "Domain (or IP)"
                set data-binding "domain"
                set data-top 30
                set column-attr obf-url
            next
            edit 2
                set header "Source IP"
                set data-binding "srcip"
            next
            edit 3
                set header "Severity"
                set data-binding "severity"
                set column-span 2
                set column-attr severity
            next
            edit 4
                set data-binding "severity"
            next
        end
        set protected enable
    next
    edit "dns-High-Risk-Source"
        set disp-name "High Risk Sources"
        set description "DNS - High Risk Sources"
        set dataset "dns-High-Risk-Source"
        set chart-type table
        config table-columns
            edit 1
                set header "Source IP"
                set data-binding "srcip"
                set data-top 40
            next
            edit 2
                set header "Count"
                set data-binding "num_cri"
                set column-span 4
                set column-graph-type bar
                set legend "Critical"
                set column-width 60
            next
            edit 3
                set data-binding "num_hig"
                set column-graph-type bar
                set legend "High"
            next
            edit 4
                set data-binding "num_med"
                set column-graph-type bar
                set legend "Medium"
            next
            edit 5
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "dns-DNS-Request-Over-Time"
        set disp-name "DNS Request Over Time"
        set description "DNS - DNS Request Over Time"
        set dataset "dns-DNS-Request-Over-Time"
        set chart-type line
        config table-columns
            edit 1
                set data-binding "timescale"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "num_cri"
                set legend "Critical"
                set column-graph-type line-up
            next
            edit 3
                set data-binding "num_hig"
                set legend "High"
                set column-graph-type line-up
            next
            edit 4
                set data-binding "num_med"
                set legend "Medium"
                set column-graph-type line-up
            next
            edit 5
                set data-binding "num_inf"
                set legend "Info"
                set column-graph-type line-up
            next
            edit 6
                set data-binding "num_low"
                set legend "Low"
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "dns-Top-Queried-Domain"
        set disp-name "Top Queried Domain"
        set description "DNS - Top Queried Domain"
        set dataset "dns-Top-Queried-Domain"
        set chart-type table
        config table-columns
            edit 1
                set header "Queried Domain"
                set data-binding "qname"
                set data-top 30
            next
            edit 2
                set header "Count"
                set data-binding "total_num"
                set column-span 2
                set column-graph-type bar
            next
            edit 3
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "dns-Top-Domain-Lookup-Failure-Bar"
        set disp-name "Top Domain Lookup Failures (bar)"
        set description "DNS - Top Domain Lookup Failures (bar)"
        set dataset "dns-Top-Domain-Lookup-Failure"
        set chart-type bar
        config table-columns
            edit 1
                set header "Queried Domain"
                set data-binding "qname"
                set data-top 20
            next
            edit 2
                set header "Count"
                set data-type aggregate
                set data-binding "total_num"
            next
        end
        set protected enable
    next
    edit "dns-Top-Domain-Lookup-Failure-Table"
        set disp-name "Top Domain Lookup Failures"
        set description "DNS - Top Domain Lookup Failures"
        set dataset "dns-Top-Domain-Lookup-Failure"
        set chart-type table
        config table-columns
            edit 1
                set header "Queried Domain"
                set data-binding "qname"
                set data-top 20
            next
            edit 2
                set header "Source IP"
                set data-binding "srcip"
            next
            edit 3
                set header "Failed Attempts"
                set data-binding "total_num"
                set column-span 2
                set column-graph-type bar
            next
            edit 4
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "dns-Query-Timeout"
        set disp-name "Query Timeout"
        set description "DNS - Query Timeout"
        set dataset "dns-Query-Timeout"
        set chart-type table
        config table-columns
            edit 1
                set header "Source IP"
                set data-binding "srcip"
                set data-top 30
            next
            edit 2
                set header "Domain"
                set data-binding "qname"
            next
            edit 3
                set header "Attempts"
                set data-binding "total_num"
                set column-span 2
                set column-graph-type bar
            next
            edit 4
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "dns-Blocked-Query"
        set disp-name "Blocked Queries"
        set description "DNS - Blocked Queries"
        set dataset "dns-Blocked-Query"
        set chart-type table
        config table-columns
            edit 1
                set header "Source IP"
                set data-binding "srcip"
                set data-top 30
            next
            edit 2
                set header "Reason"
                set data-binding "msg"
            next
            edit 3
                set header "Count"
                set data-binding "total_num"
                set column-span 2
                set column-graph-type bar
            next
            edit 4
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "perf-stat-cpu-usage-drilldown"
        set disp-name "Resource CPU Usage"
        set description "CPU Usage"
        set dataset "resource-detailed-timeline"
        set category "Event"
        set hidden enable
        set chart-type line
        config table-columns
            edit 1
                set header "Time"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "cpu_ave"
                set column-graph-type line-up
                set legend "Average Usage"
            next
            edit 3
                set data-binding "cpu_peak"
                set column-graph-type line-up
                set legend "Peak Usage"
            next
        end
        set protected enable
    next
    edit "perf-stat-mem-usage-drilldown"
        set disp-name "Resource Memory Usage"
        set description "Memory Usage"
        set dataset "resource-detailed-timeline"
        set category "Event"
        set hidden enable
        set chart-type line
        config table-columns
            edit 1
                set header "Time"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "mem_ave"
                set column-graph-type line-up
                set legend "Average Usage"
            next
            edit 3
                set data-binding "mem_peak"
                set column-graph-type line-up
                set legend "Peak Usage"
            next
        end
        set protected enable
    next
    edit "perf-stat-disk-usage-drilldown"
        set disp-name "Resource Disk Usage"
        set description "Disk Usage"
        set dataset "resource-detailed-timeline"
        set category "Event"
        set hidden enable
        set chart-type line
        config table-columns
            edit 1
                set header "Time"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "disk_ave"
                set column-graph-type line-up
                set legend "Average Usage"
            next
            edit 3
                set data-binding "disk_peak"
                set column-graph-type line-up
                set legend "Peak Usage"
            next
        end
        set protected enable
    next
    edit "perf-stat-sessions-drilldown"
        set disp-name "Resource Sessions"
        set description "Sessions"
        set dataset "resource-detailed-timeline"
        set category "Event"
        set hidden enable
        set chart-type line
        config table-columns
            edit 1
                set header "Time"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "sessions"
                set column-graph-type line-up
                set legend "Average Count"
            next
            edit 3
                set data-binding "session_peak"
                set column-graph-type line-up
                set legend "Peak Count"
            next
        end
        set protected enable
    next
    edit "perf-stat-lograte-drilldown"
        set disp-name "Resource Logs Per Second"
        set description "Logs per second"
        set dataset "resource-detailed-timeline"
        set category "Event"
        set hidden enable
        set chart-type line
        config table-columns
            edit 1
                set header "Time"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "log_rate"
                set column-graph-type line-up
                set legend "Average Rate"
            next
            edit 3
                set data-binding "lograte_peak"
                set column-graph-type line-up
                set legend "Peak Rate"
            next
        end
        set protected enable
    next
    edit "perf-stat-connections-drilldown"
        set disp-name "Resource Connections Per Second"
        set description "Connections per second"
        set dataset "resource-detailed-timeline"
        set category "Event"
        set hidden enable
        set chart-type line
        config table-columns
            edit 1
                set header "Time"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "cps_ave"
                set column-graph-type line-up
                set legend "Average Rate"
            next
            edit 3
                set data-binding "cps_peak"
                set column-graph-type line-up
                set legend "Peak Rate"
            next
        end
        set protected enable
    next
    edit "perf-stat-bandwidth-drilldown"
        set disp-name "Resource Bandwidth Rate"
        set description "Bandwidth Rate"
        set dataset "resource-detailed-timeline"
        set category "Event"
        set hidden enable
        set chart-type line
        config table-columns
            edit 1
                set header "Time"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "transmit_kbps"
                set column-graph-type line-up
                set legend "Average Rate"
            next
            edit 3
                set data-binding "transmit_kbps_peak"
                set column-graph-type line-up
                set legend "peak Rate"
            next
        end
        set protected enable
    next
    edit "perf-stat-usage-summary-average"
        set disp-name "Resource Usage Summary - Average"
        set description "FGT - Usage Summary - Average"
        set dataset "resource-summary-view"
        set category "Event"
        set chart-type table
        config table-columns
            edit 1
                set header "Device Name"
                set data-binding "devid"
                set data-top 10
            next
            edit 2
                set header "Role"
                set data-binding "role"
            next
            edit 3
                set header "CPU"
                set data-binding "cpu_ave"
                set column-attr percent
            next
            edit 4
                set header "Memory"
                set data-binding "mem_ave"
                set column-attr percent
            next
            edit 5
                set header "Disk"
                set data-binding "disk_ave"
                set column-attr percent
            next
            edit 6
                set header "Logs Per Second"
                set data-binding "log_rate"
                set column-span 2
                set column-graph-type bar
                set legend "Log Rate"
            next
            edit 7
                set data-binding "log_rate"
                set column-attr count
            next
            edit 8
                set header "Sessions"
                set data-binding "sessions"
                set column-attr count
            next
            edit 9
                set header "Bandwidth Rate (kbps)"
                set data-binding "sent_kbps"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
            next
            edit 10
                set data-binding "recv_kbps"
                set column-graph-type bar
                set legend "Received"
            next
            edit 11
                set data-binding "transmit_kbps"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "perf-stat-usage-summary-peak"
        set disp-name "Resource Usage Summary - Peak"
        set description "FGT - Usage Summary - Peak"
        set dataset "resource-summary-view"
        set category "Event"
        set chart-type table
        config table-columns
            edit 1
                set header "Device Name"
                set data-binding "devid"
                set data-top 10
            next
            edit 2
                set header "Role"
                set data-binding "role"
                set data-top 10
            next
            edit 3
                set header "CPU"
                set data-binding "cpu_peak"
                set column-attr percent
            next
            edit 4
                set header "Memory"
                set data-binding "mem_peak"
                set column-attr percent
            next
            edit 5
                set header "Disk"
                set data-binding "disk_peak"
                set column-attr percent
            next
            edit 6
                set header "Logs Per Second"
                set data-binding "lograte_peak"
                set column-span 2
                set column-graph-type bar
                set legend "Lograte Peak"
            next
            edit 7
                set data-binding "lograte_peak"
                set column-attr count
            next
            edit 8
                set header "Sessions"
                set data-binding "session_peak"
                set column-attr count
            next
            edit 9
                set header "Bandwidth Rate (kbps)"
                set data-binding "transmit_kbps_peak"
                set column-span 2
                set column-graph-type bar
                set legend "Bandwidth Peak"
            next
            edit 10
                set data-binding "transmit_kbps_peak"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "perf-stat-usage-details-drilldown-master"
        set disp-name "Resource Usage Top 50 Drilldown"
        set description "FGT - Usage Top 50 Drilldown"
        set dataset "resource-summary-view"
        set category "Event"
        set hidden disable
        set chart-type table
        config table-columns
            edit 1
                set header "Device Name"
                set data-binding "devid"
                set data-top 50
            next
        end
        config drill-down-table
            edit 1
                set chart "perf-stat-cpu-usage-drilldown"
                set show-title enable
            next
            edit 2
                set chart "perf-stat-mem-usage-drilldown"
                set show-title enable
            next
            edit 3
                set chart "perf-stat-disk-usage-drilldown"
                set show-title enable
            next
            edit 4
                set chart "perf-stat-lograte-drilldown"
                set show-title enable
            next
            edit 5
                set chart "perf-stat-sessions-drilldown"
                set show-title enable
            next
            edit 6
                set chart "perf-stat-bandwidth-drilldown"
                set show-title enable
                set page-break-after enable
            next
        end
        set drill-down-layout "<h2>Resource Usage Details - ${var.title.\"Device Name\"}</h2>${chart.id.1}${chart.id.2}${chart.id.3}${chart.id.4}${chart.id.5}${chart.id.6}"
        set protected enable
    next

    edit "incident-Incident-Count-by-Status"
        set disp-name "Incident Count by Status"
        set description "Incident count by status"
        set dataset "incident-Incident-Count-by-Status"
        set chart-type table
        config table-columns
            edit 1
                set header "Status"
                set data-binding "status"
                set data-top 10
            next
            edit 2
                set header "Count"
                set data-binding "cnt"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "incident-Incident-Count-by-Status-Donut"
        set disp-name "Incident Count by Status Donut"
        set description "Incident count by status Donut"
        set dataset "incident-Incident-Count-by-Status"
        set chart-type donut
        config table-columns
            edit 1
                set header ""
                set data-binding "status"
                set data-top 10
            next
            edit 2
                set header "Count"
                set data-binding "cnt"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "incident-Open-Incident-Count-Timeline"
        set disp-name "Open Incident Count by Status Timeline"
        set description "Open incident count by status time line"
        set dataset "incident-Incident-Count-Timeline"
        set category "Events/Incidents"
        set chart-type area
        config table-columns
            edit 1
                set header "Time"
                set data-binding "hodex"
                set column-attr time
            next
            edit 2
                set data-binding "num_sta_draft"
                set column-graph-type line-up
                set legend "New"
            next
            edit 3
                set data-binding "num_sta_analysis"
                set column-graph-type line-up
                set legend "Analysis"
            next
            edit 4
                set data-binding "num_sta_response"
                set column-graph-type line-up
                set legend "Response"
            next
        end
        set protected enable
    next
    edit "incident-Closed-Incident-Count-Timeline"
        set disp-name "Closed Incident Count by Status Timeline"
        set description "Closed incidents count by status timeline"
        set dataset "incident-Incident-Count-Timeline"
        set category "Events/Incidents"
        set chart-type area
        config table-columns
            edit 1
                set header "Time"
                set data-binding "hodex"
                set column-attr time
            next
            edit 2
                set data-binding "num_sta_closed"
                set column-graph-type line-up
                set legend "Closed-Remediated"
            next
            edit 3
                set data-binding "num_sta_cancelled"
                set column-graph-type line-up
                set legend "Closed-False Positive"
            next
        end
        set protected enable
    next

    edit "Top-10-Interested-Apps-by-Bandwidth"
        set disp-name "Top 10 Interested Apps by Bandwidth"
        set description "Top 10 Interested Apps by Bandwidth"
        set dataset "Top-Interested-Apps-By-Bandwidth"
        set category "Traffic"
        set include-other disable
        set chart-type donut
        set chart-style "{\"legend-format\":\"${pct} ${name} (${val})\", \"legend-width\":\"200\", \"show-header\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "app"
                set data-top 10
            next
            edit 2
                set header "Traffic"
				set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "Top-Interested-App-Users-by-Bandwidth"
        set disp-name "Top 10 Interested Application Users by Bandwidth"
        set description "Top 10 Interested Application Users by Bandwidth"
        set dataset "Top-Interested-App-Users-By-Bandwidth"
        set category "Traffic"
        set include-other disable
        set chart-type donut
        set chart-style "{\"legend-format\":\"${pct} ${name} (${val})\", \"legend-width\":\"200\", \"show-header\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "user_src"
                set data-top 10
            next
            edit 2
                set header "Traffic"
				set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "Top-10-Interested-Applications-by-Number-of-Users"
        set disp-name "Top 10 Interested Applications by Number of Users"
        set category "Traffic"
        set description "Top 10 Interested Applications by Number of Users"
        set dataset "Top-Interested-Apps-by-Number-of-Users"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "Application"
                set data-binding "app"
                set data-top 10
            next
            edit 2
                set data-type aggregate
                set column-attr count
                set data-binding "number"
            next
        end
        set protected enable
    next
    edit "Top-10-User-by-Session"
        set disp-name "Top 10 User by Session"
        set category "Traffic"
        set description "Top 10 User by Session"
        set dataset "Top-User-By-Sessions"
        set include-other disable
        set chart-type donut
        set chart-style "{\"legend-format\":\"${name}: ${val}\", \"show-header\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "user_src"
                set data-top 10
            next
            edit 2
                set header "Sessions"
                set data-type aggregate
                set data-binding "sessions"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Top-10-Interested-Apps-by-Session"
        set disp-name "Top 10 Interested Apps by Session"
        set category "Traffic"
        set description "Top 10 Interested Apps by Session"
        set dataset "Top-Interested-Apps-By-Bandwidth"
        set include-other disable
        set chart-type donut
        set chart-style "{\"legend-format\":\"${name}: ${val}\", \"legend-width\":\"200\", \"show-header\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "app"
                set data-top 10
            next
            edit 2
                set header "Sessions"
                set data-type aggregate
                set data-binding "sessions"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Interested-Applications-by-Risk-Level"
        set disp-name "Interested Applications by Risk Level"
        set category "Traffic"
        set description "Interested Applications by Risk Level"
        set dataset "Interested-Applications-by-Risk-Level"
        set chart-type table
        config table-columns
            edit 1
                set header "Application Name"
                set data-binding "id"
                set data-top 25
                set column-attr app-id
                set column-span 2
                set column-width 20
            next
            edit 2
                set data-binding "app"
            next
            edit 3
                set header "Category"
                set data-binding "appcat"
                set column-attr appcat
                set column-width 0
            next
            edit 4
                set header "Risk"
                set data-binding "d_risk"
                set column-span 2
                set column-attr severity
                set data-top 30
                set column-width 0
            next
            edit 5
                set data-binding "risk_level"
            next
            edit 6
                set header "Sessions"
                set data-binding "sessions"
                set column-span 2
                set column-graph-type bar
                set legend "Sent"
                set column-width 0
            next
            edit 7
                set data-binding "sessions"
            next
            edit 8
                set header "Bytes"
                set data-binding "sent"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 0
            next
            edit 9
                set data-binding "received"
                set column-span 1
                set column-graph-type bar
                set legend "Received"
                set column-width 0
            next
            edit 10
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "Top-App-Category-by-Bandwidth"
        set disp-name "Top App Categories by Bandwidth"
        set category "Traffic"
        set description "Top 3 App Categories by Bandwidth"
        set dataset "Top-App-Category-by-Bandwidth"
        set include-other enable
        set chart-type donut
        set chart-style "{\"legend-format\":\"${name}: ${val}\", \"show-header\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "appcat"
                set data-top 3
            next
            edit 2
                set header "Traffic"
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "Top-Interested-Apps-by-Number-of-Users"
        set disp-name "Top Interested Apps by Number of Users"
        set category "Traffic"
        set description "Top 10 Interested Apps by Number of Users"
        set dataset "Top-Interested-Apps-by-Number-of-Users"
        set include-other disable
        set chart-type donut
        set chart-style "{\"legend-format\":\"${name}: ${val}\", \"legend-width\":\"200\", \"show-header\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "app"
                set data-top 10
            next
            edit 2
                set header "Users"
                set data-type aggregate
                set data-binding "number"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Top-Interested-App-Users-By-Bandwidth-Timeline"
        set disp-name "Top Interested Application Users Bandwidth Usage Timeline"
        set description "Top Interested Application Users Bandwidth Usage Timeline"
        set dataset "Top-Interested-App-Users-By-Bandwidth-Timeline"
        set category "Traffic"
        set chart-type area
        set chart-style "{\"legend-position\": \"right\"}"
        config table-columns
            edit 1
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "user_src"
                set column-attr none
                set data-type drilldown
                set data-top 10
            next
            edit 3
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "soc-Event-vs-Incident-Today-Trend"
        set disp-name "Events vs Incidents Today Trend"
        set category "Events/Incidents"
        set description "Events vs Incidents Today Trend"
        set dataset "soc-Event-vs-Incident-Today-Trend"
        set chart-type table
        config table-columns
            edit 1
                set header "Item"
                set data-binding "item"
            next
            edit 2
                set header "Today"
                set data-binding "num_cur"
                set column-attr count
            next
            edit 3
                set header "Yesterday"
                set data-binding "num_pre"
                set column-attr count
            next
            edit 4
                set header "Trend"
                set data-binding "num_diff"
                set column-attr trend
            next
        end
        set protected enable
    next
    edit "soc-Event-vs-Incident-History-Trend"
        set disp-name "Events vs Incidents History Trend"
        set category "Events/Incidents"
        set description "Events vs Incidents History Trend"
        set dataset "soc-Event-vs-Incident-History-Trend"
        set chart-type table
        config table-columns
            edit 1
                set header "Item"
                set data-binding "item"
            next
            edit 2
                set header "This Period"
                set data-binding "num_cur"
                set column-attr count
            next
            edit 3
                set header "Last Period"
                set data-binding "num_pre"
                set column-attr count
            next
            edit 4
                set header "Trend"
                set data-binding "num_diff"
                set column-attr trend
            next
        end
        set protected enable
    next
    edit "soc-Event-vs-Incident-Trend"
        set disp-name "Events vs Incidents Trend"
        set category "Events/Incidents"
        set description "Events vs Incidents Trend"
        set dataset "soc-Event-vs-Incident-Trend"
        set chart-type table
        config table-columns
            edit 1
                set header "Item"
                set data-binding "item"
            next
            edit 2
                set header "Today"
                set data-binding "num_today"
                set column-attr count
            next
            edit 3
                set header "Yesterday"
                set data-binding "num_yesterday"
                set column-attr count
            next
            edit 4
                set header "Trend"
                set data-binding "num_diff1"
                set column-attr trend
            next
            edit 5
                set header "This Period"
                set data-binding "num_this_period"
                set column-attr count
            next
            edit 6
                set header "Last Period"
                set data-binding "num_last_period"
                set column-attr count
            next
            edit 7
                set header "Trend"
                set data-binding "num_diff2"
                set column-attr trend
            next
        end
        set protected enable
    next
    edit "soc-Total-Event-by-Severity-History"
        set disp-name "Total Events by Severity History"
        set category "Events/Incidents"
        set description "Total Events by Severity History"
        set dataset "soc-Total-Event-by-Severity-History"
        set chart-type bar
        set order-by "dom"
        config table-columns
            edit 1
                set header "Day"
                set data-binding "dom"
                set data-top 30
            next
            edit 2
                set header "Severity"
                set data-binding "sev"
                set data-type drilldown
                set data-top 5
            next
            edit 3
                set header "Total Number"
                set data-binding "num_events"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "soc-Total-Event-by-Severity-Category"
        set disp-name "Total Events Count by Severity and Category"
        set category "Events/Incidents"
        set description "Total Events Count by Severity and Category"
        set dataset "soc-Total-Event-by-Severity-Category"
        set chart-type table
        config table-columns
            edit 1
                set header "Severity"
                set data-binding "sev"
                set data-top 0
            next
            edit 2
                set header "Event Name"
                set data-type drilldown
                set data-binding "triggername"
            next
            edit 3
                set header "Events Occurrences"
                set data-type aggregate
                set data-binding "num_events"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "soc-Total-Incident-by-Severity"
        set disp-name "Total Incidents by Severity"
        set category "Events/Incidents"
        set description "Total Incidents by Severity"
        set dataset "soc-Total-Incident-by-Severity"
        set chart-type donut
        config table-columns
            edit 1
                set data-binding "severity"
                set data-top 5
            next
            edit 2
                set header "Total Number"
                set data-type aggregate
                set data-binding "num_inc"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "soc-Total-Event-vs-Incident-History"
        set disp-name "Total Events vs Incidents History"
        set category "Events/Incidents"
        set description "Total Events vs Incidents History"
        set dataset "soc-Total-Event-vs-Incident-History"
        set chart-type line
        config table-columns
            edit 1
                set header "Time"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "num_inc_total"
                set column-graph-type line-up
                set legend "Incidents"
            next
            edit 3
                set data-binding "num_event_high"
                set column-graph-type line-up
                set legend "Critical/High Events"
            next
        end
        set protected enable
    next
    edit "soc-Incident-by-Severity"
        set disp-name "Incidents by Severity"
        set category "Events/Incidents"
        set description "Incidents by Severity"
        set dataset "soc-Incident-by-Severity"
        set chart-type donut
        set chart-style "{\"inner-content\": \"summary\", \"show-header\": \"enable\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "severity"
            next
            edit 2
                set header "Incidents"
                set data-type aggregate
                set data-binding "incnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "soc-Incident-by-Status"
        set disp-name "Incidents by Status"
        set category "Events/Incidents"
        set description "Incidents by Status"
        set dataset "soc-Incident-by-Status"
        set chart-type donut
        set chart-style "{\"inner-content\": \"summary\", \"show-header\": \"enable\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "status"
            next
            edit 2
                set header "Incidents"
                set data-type aggregate
                set data-binding "incnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "soc-Incident-by-Category-Unresolved"
        set disp-name "Unresolved Incidents by Category"
        set category "Events/Incidents"
        set description "Unresolved Incidents by Category"
        set dataset "soc-Incident-by-Category-Unresolved"
        set chart-type donut
        set chart-style "{\"inner-content\": \"summary\", \"show-header\": \"enable\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "category"
            next
            edit 2
                set header "Incidents"
                set data-type aggregate
                set data-binding "incnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "soc-Incident-by-Severity-Unresolved"
        set disp-name "Unresolved Incidents by Severity"
        set category "Events/Incidents"
        set description "Unresolved Incidents by Severity"
        set dataset "soc-Incident-by-Severity-Unresolved"
        set chart-type donut
        set chart-style "{\"inner-content\": \"summary\", \"show-header\": \"enable\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "severity"
            next
            edit 2
                set header "Incidents"
                set data-type aggregate
                set data-binding "incnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "soc-Incident-Timeline-by-Category"
        set disp-name "Incidents Timeline by Category"
        set category "Events/Incidents"
        set description "Incidents Timeline by Category"
        set dataset "soc-Incident-Timeline-by-Category"
        set chart-type line
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
            next
            edit 2
                set data-binding "num_cat1"
                set column-graph-type line-up
                set legend "Unauthorized Access"
            next
            edit 3
                set data-binding "num_cat2"
                set column-graph-type line-up
                set legend "Denial of Service (DoS)"
            next
            edit 4
                set data-binding "num_cat3"
                set column-graph-type line-up
                set legend "Malicious Code"
            next
            edit 5
                set data-binding "num_cat4"
                set column-graph-type line-up
                set legend "Improper Usage"
            next
            edit 6
                set data-binding "num_cat5"
                set column-graph-type line-up
                set legend "Scans/Probes/Attempted Access"
            next
            edit 7
                set data-binding "num_cat6"
                set column-graph-type line-up
                set legend "Uncategorized"
            next
        end
        set protected enable
    next
    edit "soc-Incident-List-Unresolved"
        set disp-name "List of Unresolved Incidents"
        set category "Events/Incidents"
        set description "List of Unresolved Incidents"
        set dataset "soc-Incident-List-Unresolved"
        set chart-type table
        config table-columns
            edit 1
                set header "Incident#"
                set data-binding "incnum"
                set data-top 100
                set column-width 12
            next
            edit 2
                set header "Timestamp"
                set data-binding "timestamp"
                set column-width 18
            next
            edit 3
                set header "Severity"
                set data-binding "severity"
                set column-span 2
                set column-attr severity
                set column-width 15
            next
            edit 4
                set data-binding "severity"
            next
            edit 5
                set header "Status"
                set data-binding "status"
                set column-span 2
                set column-attr inc-status
                set column-width 15
            next
            edit 6
                set data-binding "status"
            next
            edit 7
                set header "Endpoint"
                set data-binding "endpoint"
                set column-width 20
            next
            edit 8
                set header "Description"
                set data-binding "description"
                set column-width 20
            next
        end
        set protected enable
    next
    edit "fex-RSRQ-timeline"
        set disp-name "FortiExtender RSRQ Timeline"
        set description "FortiExtender RSRQ Timeline"
        set dataset "fex-RSRQ-timeline"
        set chart-type table
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set data-top 30
            next
            edit 2
                set header "RSRQ"
                set data-binding "rsrq"
            next
        end
        set protected enable
    next
    edit "fex-SINR-timeline"
        set disp-name "FortiExtender SINR Timeline"
        set description "FortiExtender SINR Timeline"
        set dataset "fex-SINR-timeline"
        set chart-type table
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set data-top 30
            next
            edit 2
                set header "SINR"
                set data-binding "sinr"
            next
        end
        set protected enable
    next
    edit "fgt-device-monitoring-inventory"
        set disp-name "FortiGate Device Monitoring Inventory"
        set description "FortiGate Device Monitoring Inventory"
        set dataset "fgt-device-monitoring-inventory"
        set category "Event"
        set chart-type table
        config table-columns
            edit 1
                set header "Device Name"
                set data-binding "devname"
                set data-top 0
            next
            edit 2
                set header "Hardware Model"
                set data-binding "platform"
            next
            edit 3
                set header "Monitoring Access IP"
                set data-binding "ip"
            next
            edit 4
                set header "Device Version"
                set data-binding "os"
            next
            edit 5
                set header "Serial Number"
                set data-binding "id_devid"
            next
            edit 6
                set header "Count"
                set data-binding "total_num"
            next
        end
        set protected enable
    next

    edit "fgt-inventory-hardware"
        set disp-name "FortiGate Monitoring Inventory Hardware"
        set description "FortiGate Monitoring Inventory Hardware"
        set dataset "fgt-inventory-hardware"
        set category "Event"
        set chart-type table
        config table-columns
            edit 1
                set header "Hardware Model"
                set data-binding "platform"
                set data-top 0
            next
            edit 2
                set header "Count"
                set data-binding "total_num"
                set column-span 2
                set column-graph-type bar
            next
            edit 3
                set data-binding "total_num"
            next
        end
        set protected enable
        set hidden disable
    next

    edit "fgt-inventory-software"
        set disp-name "FortiGate Monitoring Inventory Software"
        set description "FortiGate Monitoring Inventory Software"
        set dataset "fgt-inventory-software"
        set category "Event"
        set chart-type table
        config table-columns
            edit 1
                set header "Software Name"
                set data-binding "sf_name"
                set data-top 0
            next
            edit 2
                set header "Firmware Version"
                set data-binding "firmware"
            next
            edit 3
                set header "Count"
                set data-binding "total_num"
                set column-span 2
                set column-graph-type bar
            next
            edit 4
                set data-binding "total_num"
            next
        end
        set protected enable
        set hidden disable
    next

    edit "cup-utilization-timeline-for-each-device"
        set disp-name "Resource CPU Utilization for Each Device"
        set description "Top 10 CPU Utilization By Device [Average]"
        set dataset "fgt-resource-utilization-timeline"
        set category "Event"
        set hidden enable
        set chart-type line
        config table-columns
            edit 1
                set header "Time"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "devid"
                set column-attr none
                set data-type drilldown
            next
            edit 3
                set data-binding "cpu_ave"
                set column-attr percent
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "status-timeline-by-device-cpu-utilization"
        set disp-name "Top 10 FGT CPU Utilization Over Time"
        set description "Top 10 CPU Utilization Over Time By Device"
        set dataset "resource-summary-view-cpu"
        set category "Events/Resources"
        set hidden disable
        set chart-type table
        config table-columns
            edit 1
                set header "Device Name"
                set data-binding "devid"
                set data-top 10
            next
        end
        config drill-down-table
            edit 1
                set chart "cup-utilization-timeline-for-each-device"
                set show-title enable
            next
        end
        set drill-down-agg enable
        set protected enable
    next

    edit "event-cpu-utilization-dev"
        set disp-name "CPU Utilization by Device"
        set description "CPU Utilization by Device"
        set dataset "resource-summary-view-cpu"
        set category "Event"
        set chart-type table
        config table-columns
            edit 1
                set header "Device Name"
                set data-binding "devid"
                set data-top 0
                set column-width 40
            next
            edit 2
                set header "Max CPU Utilization"
                set data-binding "cpu_peak"
                set column-attr percent
                set column-width 30
            next
            edit 3
                set header "Average CPU Utilization"
                set data-binding "cpu_ave"
                set column-attr percent
                set column-width 30
            next
        end
        set protected enable
    next

    edit "memory-utilization-timeline-for-each-device"
        set disp-name "Resource Memory Utilization for Each Device"
        set description "Top 10 Memory Utilization By Device [Average]"
        set dataset "fgt-resource-utilization-timeline"
        set category "Event"
        set hidden enable
        set chart-type line
        config table-columns
            edit 1
                set header "Time"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "devid"
                set column-attr none
                set data-type drilldown
            next
            edit 3
                set data-binding "mem_ave"
                set column-attr percent
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "status-timeline-by-device-mem-utilization"
        set disp-name "Top 10 FGT Memory Utilization Over Time"
        set description "Top 10 Memory Utilization Over Time By Device"
        set dataset "resource-summary-view-memory"
        set category "Events/Resources"
        set hidden disable
        set chart-type table
        config table-columns
            edit 1
                set header "Device Name"
                set data-binding "devid"
                set data-top 10
            next
        end
        config drill-down-table
            edit 1
                set chart "memory-utilization-timeline-for-each-device"
                set show-title enable
            next
        end
        set drill-down-agg enable
        set protected enable
    next

    edit "event-mem-utilization-dev"
        set disp-name "Memory Utilization by Device"
        set description "Memory Utilization by Device"
        set dataset "resource-summary-view-memory"
        set category "Event"
        set chart-type table
        config table-columns
            edit 1
                set header "Device Name"
                set data-binding "devid"
                set data-top 0
                set column-width 40
            next
            edit 2
                set header "Max Memory Utilization"
                set data-binding "mem_peak"
                set column-attr percent
                set column-width 30
            next
            edit 3
                set header "Average Memory Utilization"
                set data-binding "mem_ave"
                set column-attr percent
                set column-width 30
            next
        end
        set protected enable
    next

    edit "disk-utilization-timeline-for-each-device"
        set disp-name "Resource Disk Utilization for Each Device"
        set description "Top 10 Disk Utilization By Device [Average]"
        set dataset "fgt-resource-utilization-timeline"
        set category "Event"
        set hidden enable
        set chart-type line
        config table-columns
            edit 1
                set header "Time"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "devid"
                set column-attr none
                set data-type drilldown
            next
            edit 3
                set data-binding "disk_ave"
                set column-attr percent
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "status-timeline-by-device-disk-utilization"
        set disp-name "Top 10 FGT Disk Utilization Over Time"
        set description "Top 10 Disk Utilization Over Time By Device"
        set dataset "resource-summary-view-disk"
        set category "Events/Resources"
        set hidden disable
        set chart-type table
        config table-columns
            edit 1
                set header "Device Name"
                set data-binding "devid"
                set data-top 10
            next
        end
        config drill-down-table
            edit 1
                set chart "disk-utilization-timeline-for-each-device"
                set show-title enable
            next
        end
        set drill-down-agg enable
        set protected enable
    next

    edit "event-disk-utilization-dev"
        set disp-name "Disk Utilization by Device"
        set description "Disk Utilization by Device"
        set dataset "resource-summary-view-disk"
        set category "Event"
        set chart-type table
        config table-columns
            edit 1
                set header "Device Name"
                set data-binding "devid"
                set data-top 0
                set column-width 40
            next
            edit 2
                set header "Max Disk Utilization"
                set data-binding "disk_peak"
                set column-attr percent
                set column-width 30
            next
            edit 3
                set header "Average Disk Utilization"
                set data-binding "disk_ave"
                set column-attr percent
                set column-width 30
            next
        end
        set protected enable
    next

    edit "event-total-session-summary"
        set disp-name "Top 10 Firewall Total Session Summary"
        set description "Top 10 Firewall Total Session Summary"
        set dataset "fgt-session-total-summary"
        set category "Event"
        set chart-type bar
        config table-columns
            edit 1
                set data-binding "devid"
                set data-top 10
            next
            edit 2
                set data-binding "max_session"
            next
        end
        set protected enable
    next
    edit "event-session-rate-summary"
        set disp-name "Top 10 Firewall Session Rate Summary"
        set description "Top 10 Firewall Session Rate Summary"
        set dataset "fgt-session-rate-summary"
        set category "Event"
        set chart-type bar
        config table-columns
            edit 1
                set data-binding "devid"
                set data-top 10
            next
            edit 2
                set data-binding "max_rate"
            next
        end
        set protected enable
    next
    edit "event-session-summary-dev"
        set disp-name "Firewall Session Summary by Device"
        set description "Firewall Session Summary by Device"
        set dataset "fgt-session-total-summary"
        set category "Event"
        set chart-type table
        config table-columns
            edit 1
                set header "Device Name"
                set data-binding "devid"
                set data-top 0
                set column-width 30
            next
            edit 2
                set header "Max Firewall Session Count"
                set data-binding "max_session"
                set column-width 15
            next
            edit 3
                set header "Max Firewall Session Rate"
                set data-binding "cps_peak"
                set column-width 15
            next
            edit 4
                set header "Average Firewall Session Count"
                set data-binding "sessions"
                set column-width 15
            next
            edit 5
                set header "Average Firewall Session Rate"
                set data-binding "cps_ave"
                set column-width 15
            next
        end
        set protected enable
    next

    edit "fgt-intf-down-timeline-for-each-device"
        set disp-name "Fortigate Interface Down for Each Device"
        set description "Top 10 Network Interface Availability Faults By Device"
        set dataset "fgt-intf-down-timeline"
        set category "Event"
        set hidden enable
        set chart-type line
        config table-columns
            edit 1
                set header "Time"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "devid"
                set data-type drilldown
            next
            edit 3
                set data-binding "total_num"
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "fgt-intf-down-timeline-by-device"
        set disp-name "Top 10 FortiGate Interface Down Count Over Time"
        set description "Top 10 FortiGate Interface Down Count Over Time"
        set dataset "fgt-intf-down-dev"
        set category "Events/Resources"
        set hidden disable
        set chart-type table
        config table-columns
            edit 1
                set header "Device Name"
                set data-binding "devid"
                set data-top 10
            next
        end
        config drill-down-table
            edit 1
                set chart "fgt-intf-down-timeline-for-each-device"
                set show-title enable
            next
        end
        set drill-down-agg enable
        set protected enable
    next
    edit "fgt-intf-down-dev-donut"
        set disp-name "FortiGate Interface Down Donut"
        set description "FortiGate Interface Down Donut"
        set category "Event"
        set dataset "fgt-intf-down-dev"
        set chart-type donut
        config table-columns
            edit 1
                set data-binding "devid"
                set data-top 10
            next
            edit 2
                set data-binding "total_num"
                set data-type aggregate
                set column-attr percent
            next
        end
        set protected enable
    next
    edit "fgt-intf-down-dev-tbl"
        set disp-name "FortiGate Interface Down by Device"
        set description "FortiGate Interface Down by Deivce"
        set dataset "fgt-intf-down-dev"
        set category "Event"
        set chart-type table
        config table-columns
            edit 1
                set header "Device Name"
                set data-binding "devid"
                set data-top 0
            next
            edit 2
                set header "Status"
                set data-binding "status"
            next
            edit 3
                set header "Quantity Observed"
                set data-binding "total_num"
            next
        end
        set protected enable
    next

    edit "intf-sent-timeline-for-each-device"
        set disp-name "Resource Interface Sent Bit Rate for Each Device"
        set description "Top 10 Sent Bit Rate (kbps) By Device [Average]"
        set dataset "fgt-resource-utilization-timeline"
        set category "Event"
        set hidden enable
        set chart-type line
        config table-columns
            edit 1
                set header "Time"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "devid"
                set column-attr none
                set data-type drilldown
            next
            edit 3
                set data-binding "sent_kbps"
                set column-attr none
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "status-timeline-by-device-intf-sent"
        set disp-name "Top 10 FGT Interface Sent Bit Rate Over Time"
        set description "Top 10 Interface Sent Bit Rate Over Time By Device"
        set dataset "resource-summary-view-intf"
        set category "Events/Resources"
        set hidden disable
        set chart-type table
        config table-columns
            edit 1
                set header "Device Name"
                set data-binding "devid"
                set data-top 10
            next
        end
        config drill-down-table
            edit 1
                set chart "intf-sent-timeline-for-each-device"
                set show-title enable
            next
        end
        set drill-down-agg enable
        set protected enable
    next
    edit "intf-recv-timeline-for-each-device"
        set disp-name "Resource Interface Received Bit Rate for Each Device"
        set description "Top 10 Received Bit Rate (kbps) By Device [Average]"
        set dataset "fgt-resource-utilization-timeline"
        set category "Event"
        set hidden enable
        set chart-type line
        config table-columns
            edit 1
                set header "Time"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "devid"
                set column-attr none
                set data-type drilldown
            next
            edit 3
                set data-binding "recv_kbps"
                set column-attr none
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "status-timeline-by-device-intf-recv"
        set disp-name "Top 10 FGT Interface Received Bit Rate Over Time"
        set description "Top 10 Interface Received Bit Rate Over Time By Device"
        set dataset "resource-summary-view-intf"
        set category "Events/Resources"
        set hidden disable
        set chart-type table
        config table-columns
            edit 1
                set header "Device Name"
                set data-binding "devid"
                set data-top 10
            next
        end
        config drill-down-table
            edit 1
                set chart "intf-recv-timeline-for-each-device"
                set show-title enable
            next
        end
        set drill-down-agg enable
        set protected enable
    next
    edit "event-intf-summary-dev"
        set disp-name "Interface Summary by Device"
        set description "Interface Summary by Device"
        set dataset "resource-summary-view-intf"
        set category "Event"
        set chart-type table
        config table-columns
            edit 1
                set header "Device Name"
                set data-binding "devid"
                set data-top 0
                set column-width 40
            next
            edit 2
                set header "Max Transmit (kbps)"
                set data-binding "transmit_kbps_peak"
                set column-attr none
                set column-width 15
            next
            edit 3
                set header "Average Transmit (kbps)"
                set data-binding "transmit_kbps"
                set column-attr none
                set column-width 15
            next
            edit 4
                set header "Receive (kbps)"
                set data-binding "recv_kbps"
                set column-attr none
                set column-width 15
            next
            edit 5
                set header "Sent (kbps)"
                set data-binding "sent_kbps"
                set column-attr none
                set column-width 15
            next
        end
        set protected enable
    next

    edit "fgt-intf-stats-timeline-util-in-each"
        set disp-name "Top 10 Interface Received Utilization Each"
        set description "Top 10 Interface of Received Utilization"
        set dataset "fgt-intf-stats-timeline"
        set category "Event"
        set hidden enable
        set chart-type line
        config table-columns
            edit 1
                set header "Time"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "dev_intf"
                set column-attr none
                set data-type drilldown
            next
            edit 3
                set data-binding "util_in_avg"
                set column-attr none
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "fgt-intf-stats-timeline-util-in"
        set disp-name "Top 10 Interface Received Utilization Timeline"
        set description "Top 10 Interface Received Utilization Over Time"
        set dataset "fgt-intf-stats-summary-rcvd-util"
        set category "Events/Resources"
        set hidden disable
        set chart-type table
        config table-columns
            edit 1
                set header "Device Interface Name"
                set data-binding "dev_intf"
                set data-top 10
            next
        end
        config drill-down-table
            edit 1
                set chart "fgt-intf-stats-timeline-util-in-each"
                set show-title enable
            next
        end
        set drill-down-agg enable
        set protected enable
    next

    edit "fgt-intf-stats-timeline-util-out-each"
        set disp-name "Top 10 Interface Sent Utilization Each"
        set description "Top 10 Interface of Sent Utilization"
        set dataset "fgt-intf-stats-timeline"
        set category "Event"
        set hidden enable
        set chart-type line
        config table-columns
            edit 1
                set header "Time"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "dev_intf"
                set column-attr none
                set data-type drilldown
            next
            edit 3
                set data-binding "util_out_avg"
                set column-attr none
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "fgt-intf-stats-timeline-util-out"
        set disp-name "Top 10 Interface Sent Utilization Timeline"
        set description "Top 10 Interface Sent Utilization Over Time"
        set dataset "fgt-intf-stats-summary-sent-util"
        set category "Events/Resources"
        set hidden disable
        set chart-type table
        config table-columns
            edit 1
                set header "Device Interface Name"
                set data-binding "dev_intf"
                set data-top 10
            next
        end
        config drill-down-table
            edit 1
                set chart "fgt-intf-stats-timeline-util-out-each"
                set show-title enable
            next
        end
        set drill-down-agg enable
        set protected enable
    next

    edit "fgt-intf-stats-timeline-bit-rate-in-each"
        set disp-name "Top 10 Interface Received Bit Rate Each"
        set description "Top 10 Interface of Received Bit Rate"
        set dataset "fgt-intf-stats-timeline"
        set category "Event"
        set hidden enable
        set chart-type line
        config table-columns
            edit 1
                set header "Time"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "dev_intf"
                set column-attr none
                set data-type drilldown
            next
            edit 3
                set data-binding "kbps_in_avg"
                set column-attr none
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "fgt-intf-stats-timeline-bit-rate-in"
        set disp-name "Top 10 Interface Received Bit Rate Timeline"
        set description "Top 10 Interface Received Bit Rate Over Time"
        set dataset "fgt-intf-stats-summary-rcvd-bps"
        set category "Events/Resources"
        set hidden disable
        set chart-type table
        config table-columns
            edit 1
                set header "Device Interface Name"
                set data-binding "dev_intf"
                set data-top 10
            next
        end
        config drill-down-table
            edit 1
                set chart "fgt-intf-stats-timeline-bit-rate-in-each"
                set show-title enable
            next
        end
        set drill-down-agg enable
        set protected enable
    next

    edit "fgt-intf-stats-timeline-bit-rate-out-each"
        set disp-name "Top 10 Interface Sent Bit Rate Each"
        set description "Top 10 Interface of Sent Bit Rate"
        set dataset "fgt-intf-stats-timeline"
        set category "Event"
        set hidden enable
        set chart-type line
        config table-columns
            edit 1
                set header "Time"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "dev_intf"
                set data-type drilldown
            next
            edit 3
                set data-binding "kbps_out_avg"
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "fgt-intf-stats-timeline-bit-rate-out"
        set disp-name "Top 10 Interface Sent Bit Rate Timeline"
        set description "Top 10 Interface Sent Bit Rate Over Time"
        set dataset "fgt-intf-stats-summary-sent-bps"
        set category "Events/Resources"
        set hidden disable
        set chart-type table
        config table-columns
            edit 1
                set header "Device Interface Name"
                set data-binding "dev_intf"
                set data-top 10
            next
        end
        config drill-down-table
            edit 1
                set chart "fgt-intf-stats-timeline-bit-rate-out-each"
                set show-title enable
            next
        end
        set drill-down-agg enable
        set protected enable
    next

    edit "fgt-intf-stats-summary-view"
        set disp-name "Interface Summary by Device Interface"
        set description "Interface Summary by Device Interface"
        set dataset "fgt-intf-stats-summary-rcvd-util"
        set category "Event"
        set chart-type table
        config table-columns
            edit 1
                set header "Device Interface"
                set data-binding "dev_intf"
                set data-top 500
                set column-width 40
            next
            edit 2
                set header "Received Utilization"
                set data-binding "util_in_avg"
                set column-attr percent
                set column-width 15
            next
            edit 3
                set header "Sent Utilization"
                set data-binding "util_out_avg"
                set column-attr percent
                set column-width 15
            next
            edit 4
                set header "Received Bit Rate (kbps)"
                set data-binding "kbps_in_avg"
                set column-attr none
                set column-width 15
            next
            edit 5
                set header "Sent Bit Rate (kbps)"
                set data-binding "kbps_out_avg"
                set column-attr none
                set column-width 15
            next
        end
        set protected enable
    next

    edit "fgt-ha-failure-timeline"
        set disp-name "FortiGate HA Cluster Failure Count Over Time"
        set description "FortiGate HA Cluster Failure Count Over Time"
        set dataset "fgt-ha-failure-timeline"
        set category "Event"
        set chart-type line
        config table-columns
            edit 1
                set header "Time"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "total_num"
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "fgt-ha-failure-summary"
        set disp-name "FortiGate HA Cluster Failure Summary"
        set description "FortiGate HA Cluster Failure Summary"
        set dataset "fgt-ha-failure-summary"
        set category "Event"
        set chart-type table
        config table-columns
            edit 1
                set header "Date/Time"
                set data-binding "time_s"
                set column-width 25
                set data-top 30
            next
            edit 2
                set header "Device Name"
                set data-binding "devid"
                set column-width 25
            next
            edit 3
                set header "Status"
                set data-binding "msg_desc"
                set column-width 50
            next
        end
        set protected enable
    next

    edit "fgt-env-faults-power"
        set disp-name "FortiGate Power Supply Faults"
        set description "FortiGate Power Supply Faults"
        set dataset "fgt-faults-power"
        set category "Event"
        set chart-type table
        config table-columns
            edit 1
                set header "Date/Time"
                set data-binding "time_s"
                set column-width 25
                set data-top 30
            next
            edit 2
                set header "Device Name"
                set data-binding "devid"
                set column-width 25
            next
            edit 3
                set header "Status"
                set data-binding "msg_desc"
                set column-width 50
            next
        end
        set protected enable
    next
    edit "fgt-env-faults-fan"
        set disp-name "FortiGate Fan Faults"
        set description "FortiGate Fan Faults"
        set dataset "fgt-faults-fan"
        set category "Event"
        set chart-type table
        config table-columns
            edit 1
                set header "Date/Time"
                set data-binding "time_s"
                set column-width 25
                set data-top 30
            next
            edit 2
                set header "Device Name"
                set data-binding "devid"
                set column-width 25
            next
            edit 3
                set header "Status"
                set data-binding "msg_desc"
                set column-width 50
            next
        end
        set protected enable
    next
    edit "fgt-env-faults-temperature"
        set disp-name "FortiGate Power High Temperature"
        set description "FortiGate Power High Temperature"
        set dataset "fgt-faults-temperature"
        set category "Event"
        set chart-type table
        config table-columns
            edit 1
                set header "Date/Time"
                set data-binding "time_s"
                set column-width 25
                set data-top 30
            next
            edit 2
                set header "Device Name"
                set data-binding "devid"
                set column-width 25
            next
            edit 3
                set header "Status"
                set data-binding "msg_desc"
                set column-width 50
            next
        end
        set protected enable
    next
    edit "Behaviour-Banned-Application"
        set disp-name "Behaviour (Banned) Application"
        set category "Traffic"
        set description "Behaviour (Banned) Application"
        set dataset "chat-search-and-message-logging-by-platform"
        set chart-type donut
        set chart-style "{\"legend-position\":\"right\", \"inner-content\":\"summary\", \"show-header\": \"enable\", \"show-value\":\"enable\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "Application or Service"
                set data-binding "app"
                set data-top 10
            next
            edit 2
                set header "Events"
                set data-binding "requests"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Behaviour-Banned-User"
        set disp-name "Behaviour (Banned) User"
        set category "Traffic"
        set description "Behaviour (Banned) User"
        set dataset "chat-search-and-message-logging-by-user"
        set chart-type donut
        set chart-style "{\"legend-position\":\"right\", \"inner-content\":\"summary\", \"show-header\": \"enable\", \"show-value\":\"enable\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "User(or IP)"
                set data-binding "user_src"
                set data-top 10
            next
            edit 2
                set header "Events"
                set data-binding "requests"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Behaviour-Banned-User-Drilldown"
        set disp-name "Behaviour (Banned) User Drilldown"
        set category "Traffic"
        set description "Behaviour (Banned) User Drilldown"
        set dataset "user-chat-search-and-message-logging"
        set chart-type table
        set chart-style "{\"table-scheme\": \"dark\", \"show-sum-0\": \"enable\", \"show-total\": \"disable\", \"show-others\": \"disable\", \"show-percent\": \"disable\"}"
        config table-columns
            edit 1
                set header "User(or IP)"
                set data-binding "user_src"
                set data-top 10
                set column-width 25
            next
            edit 2
                set header "Bad Term or Phrase"
                set data-binding "filename"
                set data-type drilldown
                set data-top 5
                set column-width 35
            next
            edit 3
                set header "Requests"
                set data-binding "requests"
                set data-type aggregate
                set column-attr count
                set column-style "{\"align\":\"left\",\"width\":25}"
                set column-span 2
                set column-width 40
            next
            edit 4
                set data-binding "requests"
                set column-graph-type bar
                set column-style "{\"width\":75}"
                set column-attr none
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "Behaviour-Banned-User-Drilldown-per-App"
        set disp-name "Behaviour (Banned) User Drilldown for a Specific App"
        set category "Traffic"
        set description "Behaviour (Banned) User Drilldown for a Specific App"
        set dataset "user-chat-search-and-message-logging"
        set chart-type bubble-ring
        set chart-style "{\"show-value\":\"enable\", \"height\":\"550\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "User(or IP)"
                set data-binding "user_src"
                set data-top 10
            next
            edit 2
                set header "Bad Term or Phrase"
                set data-binding "filename"
                set data-type drilldown
                set data-top 6
            next
            edit 3
                set data-binding "requests"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "behaviour-banned"
        set disp-name "Behaviour (Banned)"
        set category "Traffic"
        set description "Behaviour (Banned)"
        set dataset "chat-search-and-message-logging"
        set chart-type table
        set chart-style "{\"table-scheme\": \"dark\", \"show-sum-0\": \"enable\", \"show-total\": \"disable\", \"show-others\": \"disable\", \"show-percent\": \"disable\"}"
        config table-columns
            edit 1
                set header "Bad Term or Phrase"
                set data-binding "filename"
                set data-top 50
            next
            edit 2
                set header "Application or Service"
                set data-binding "id"
                set column-attr app-id
                set column-span 2
                set data-top 5
                set column-width 25
            next
            edit 3
                set data-binding "app_agg"
            next
            edit 4
                set header "User(or IP)"
                set data-binding "user_agg"
                set column-span 1
                set column-width 15
            next
            edit 5
                set header "Date/Time"
                set data-binding "itime_agg"
                set column-style "{\"max-text-length\":203}"
                set column-width 15
            next
            edit 6
                set header "Number of Requests"
                set data-binding "requests"
                set data-type aggregate
                set column-attr count
                set column-style "{\"align\":\"left\",\"width\":25}"
                set column-span 2
                set column-width 20
            next
            edit 7
                set data-binding "requests"
                set column-graph-type bar
                set column-style "{\"width\":75}"
                set column-attr none
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "Self-Harm-Behaviour-Banned-User-Pie"
        set disp-name "Self-Harm Behaviour (Banned) User Pie"
        set category "Application"
        set description "Self-Harm Behaviour (Banned) User Pie"
        set dataset "self-harm-chat-search-and-message-logging"
        set chart-type pie
        set include-other enable
        config table-columns
            edit 1
                set header "User(or IP)"
                set data-binding "user_agg"
                set data-top 10
            next
            edit 2
                set header "Number of Indicators"
                set data-type aggregate
                set data-binding "requests"
                set column-attr none
            next
        end
        set protected enable
    next
    edit "Self-Harm-Behaviour-Banned-Application-Pie"
        set disp-name "Self-Harm Behaviour (Banned) Application Pie"
        set category "Application"
        set description "Self-Harm Behaviour (Banned) Application Pie"
        set dataset "self-harm-chat-search-and-message-logging"
        set chart-type pie
        set include-other enable
        config table-columns
            edit 1
                set header "Application or Service"
                set data-binding "app_agg"
                set data-top 10
            next
            edit 2
                set header "Number of Indicators"
                set data-type aggregate
                set data-binding "requests"
                set column-attr none
            next
        end
        set protected enable
    next
    edit "Self-Harm-Behaviour-Banned-User-Bar"
        set disp-name "Self-Harm Behaviour (Banned) User Bar"
        set category "Application"
        set description "Self-Harm Behaviour (Banned) User Bar"
        set dataset "self-harm-chat-search-and-message-logging"
        set chart-type bar
        config table-columns
            edit 1
                set header "User(or IP)"
                set data-binding "user_agg"
                set data-top 10
            next
            edit 2
                set header "Number of Risky Terms"
                set data-type aggregate
                set data-binding "requests"
            next
        end
        set protected enable
    next
    edit "Self-Harm-Behaviour-Banned-User-Drilldown"
        set disp-name "Self-Harm Behaviour (Banned) User Drilldown"
        set category "Application"
        set description "Self-Harm Behaviour (Banned) User Drilldown"
        set dataset "self-harm-chat-search-and-message-logging"
        set chart-type table
        config table-columns
            edit 1
                set header "User and Group"
                set data-binding "user_agg"
                set column-span 2
                set data-top 10
            next
            edit 2
                set data-binding "group_agg"
            next
            edit 3
                set header "Self-Harm or Risky Term"
                set data-binding "filename"
                set data-type drilldown
                set data-top 5
                set column-width 35
            next
            edit 4
                set header "Requests"
                set data-binding "requests"
                set data-type aggregate
                set column-width 15
            next
        end
        set protected enable
    next
    edit "Self-Harm-behaviour-banned"
        set disp-name "Self-Harm Behaviour Banned"
        set category "Application"
        set description "Self-Harm Behaviour Banned"
        set dataset "self-harm-chat-search-and-message-logging"
        set chart-type table
        set chart-style "{\"show-total\": \"disable\", \"show-others\": \"disable\", \"show-percent\": \"disable\"}"
        config table-columns
            edit 1
                set header "Self-Harm or Risky Term"
                set data-binding "filename"
                set data-top 50
                set column-width 27
            next
            edit 2
                set header "Application or Service"
                set data-binding "app_agg"
                set data-type drilldown
                set data-top 5
                set column-width 25
            next
            edit 3
                set header "User and Group"
                set data-binding "user_agg"
                set column-span 2
                set column-width 27
            next
            edit 4
                set data-binding "group_agg"
            next
            edit 5
                set header "Number of Indicators"
                set data-binding "requests"
                set data-type aggregate
                set column-attr count
                set column-style "{\"align\":\"left\"}"
                set column-span 2
                set column-width 21
            next
            edit 6
                set data-binding "requests"
                set column-graph-type bar
                set column-attr none
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "self-harm-Risky-Terms-By-App"
        set disp-name "Self-Harm Risky Terms by APP"
        set category "Application"
        set description "Self-Harm Risky Terms by APP"
        set dataset "self-harm-Chat-Search-And-Message-Logging-By-Platform"
        set chart-type donut
        set chart-style "{\"legend-width\": \"180\"}"
        set include-other enable
        config table-columns
            edit 1
                set header "Application"
                set data-binding "app"
                set data-top 10
            next
            edit 2
                set header "Number of Indicators"
                set data-type aggregate
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "self-harm-Risky-Terms-Timeline"
        set disp-name "Self-Harm Risky Terms Timeline"
        set category "Application"
        set description "Self-Harm Risky Terms Timeline"
        set dataset "self-harm-Chat-Search-And-Message-Logging-Timeline"
        set chart-type line
        set chart-style "{\"fill-area\": \"enable\", \"y-title\":\"Number of Risky Terms\"}"
        config table-columns
            edit 1
                set header "Time"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set column-graph-type line-up
                set column-attr count
                set data-binding "requests"
                set legend "Number of Risky Terms"
            next
        end
        set protected enable
    next
    edit "self-harm-Risky-Term-User-Drilldown"
        set disp-name "Self-Harm Risky Term User Drilldown"
        set category "Application"
        set description "Self Harm Risky Term User Drilldown"
        set dataset "self-harm-Chat-Search-And-Message-Logging-By-User"
        set chart-type bubble-ring
        set chart-style "{\"show-value\":\"enable\", \"height\":\"550\"}"
        set include-other enable
        config table-columns
            edit 1
                set header "User(or IP)"
                set data-binding "user_src"
                set data-top 10
            next
            edit 2
                set header "Bad Term or Phrase"
                set data-binding "filename"
                set data-type drilldown
                set data-top 4
            next
            edit 3
                set data-binding "requests"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Browsing-Time-per-Social-Media"
        set disp-name "Browsing Time per Social Media"
        set category "Traffic"
        set description "Browsing Time per Social Media"
        set dataset "Browsing-Time-vs-Domain"
        set chart-type pie
        config table-columns
            edit 1
                set header "Platform"
                set data-binding "domain"
                set data-top 5
            next
            edit 2
                set header "Browsing Time"
                set data-type aggregate
                set data-binding "browsetime"
                set column-attr percent
            next
        end
        set protected enable
    next
    edit "Social-Networking-Bar-Graph"
        set disp-name "Social Networking Bar Graph"
        set description "Social Networking Bar Graph"
        set dataset "Social-Networking-Browsing-Time"
        set chart-type donut
        config table-columns
            edit 1
                set header ""
                set data-binding "f_user"
                set data-top 5
            next
            edit 2
                set data-binding "bandwidth"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "Top-Social-Networking-Durations-Sources-Drilldown"
        set disp-name "Top Social Networking Durations from Sources Drilldown"
        set category "Traffic"
        set description "Top Social Networking Durations from Sources Drilldown"
        set dataset "Social-Networking-Durations-Sources-Drilldown"
        set chart-type table
        config table-columns
            edit 1
                set header "User(or IP)"
                set data-binding "f_user"
                set column-span 1
                set data-top 10
                set column-width 20
            next
            edit 2
                set header "Browsing Time (hh:mm:ss)"
                set column-graph-type bar
                set column-span 2
                set data-binding "browsetime"
            next
            edit 3
                set header "Browsing Time"
                set data-binding "browsetime"
                set column-attr timespan
            next
        end
        set protected enable
    next
    edit "Top-Social-Networking-Durations-Domains-Drilldown"
        set disp-name "Top Social Networking Durations from Domains Drilldown"
        set category "Traffic"
        set description "Top Social Networking Durations from Domains Drilldown"
        set dataset "Browsing-Time-vs-Domain"
        set chart-type table
        config table-columns
            edit 1
                set header "Domain"
                set data-binding "domain"
                set data-top 10
            next
            edit 2
                set header "Browsing Time (hh:mm:ss)"
                set data-binding "browsetime"
                set column-graph-type bar
                set column-span 2
            next
            edit 3
                set header "Browsing Time"
                set data-binding "browsetime"
                set column-attr timespan
            next
        end
        set protected enable
    next
    edit "Facebook-Posts"
        set disp-name "Facebook Posts"
        set category "Traffic"
        set description "Facebook Posts"
        set dataset "Facebook-Posts"
        set chart-type table
        config table-columns
            edit 1
                set header "Date/Time"
                set data-binding "i_time"
                set data-top 50
                set column-width 17
            next
            edit 2
                set header "User(or IP)"
                set data-binding "f_user"
                set column-span 1
                set column-width 18
            next
            edit 3
                set header "Source IP"
                set data-binding "srcip"
                set column-width 15
            next
            edit 4
                set header "Post"
                set data-binding "filename"
            next
        end
        set protected enable
    next
    edit "Facebook-Chats"
        set disp-name "Facebook Chats"
        set category "Traffic"
        set description "Facebook Chats"
        set dataset "Facebook-Chats"
        set chart-type table
        config table-columns
            edit 1
                set header "Message"
                set data-binding "filename"
                set data-top 50
            next
            edit 2
                set header "User(or IP)"
                set data-binding "user_agg"
                set column-span 1
                set column-width 23
            next
            edit 3
                set header "Source IP"
                set data-binding "srcip_agg"
                set column-width 15
            next
            edit 4
                set header "Time Happened"
                set data-binding "itime_agg"
                set column-width 17
            next
        end
        set protected enable
    next
    edit "Twitter-Posts"
        set disp-name "Twitter Posts"
        set category "Traffic"
        set description "Twitter Posts"
        set dataset "Twitter-Posts"
        set chart-type table
        config table-columns
            edit 1
                set header "Date/Time"
                set data-binding "i_time"
                set column-width 17
                set data-top 50
            next
            edit 2
                set header "User(or IP)"
                set data-binding "f_user"
                set column-span 1
                set column-width 23
            next
            edit 3
                set header "Source IP"
                set data-binding "srcip"
                set column-width 15
            next
            edit 4
                set header "Tweet"
                set data-binding "filename"
            next
        end
        set protected enable
    next
    edit "LinkedIn-Posts-and-Comments"
        set disp-name "LinkedIn Posts and Comments"
        set category "Traffic"
        set description "LinkedIn Posts and Comments"
        set dataset "LinkedIn-Posts-and-Comments"
        set chart-type table
        config table-columns
            edit 1
                set header "Post or Comment"
                set data-binding "filename"
                set data-top 50
            next
            edit 2
                set header "User(or IP)"
                set data-binding "user_agg"
                set column-span 1
                set column-width 23
            next
            edit 3
                set header "Source IP"
                set data-binding "srcip_agg"
                set column-width 15
            next
            edit 4
                set header "Time Happened"
                set data-binding "itime_agg"
                set column-width 17
            next
        end
        set protected enable
    next
    edit "sdwan-fw-Device-Interface-Quality_Bibandwidth-drilldown"
        set disp-name "SD-WAN Top Device WAN Link Quality Drilldown"
        set description "SD-WAN Top Device WAN Link Quality Drilldown"
        set category "SD-WAN"
        set hidden disable
        set dataset "sdwan-fw-Device-Interface-Stat_Bibandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Device Name"
                set data-binding "devid"
                set data-top 10
            next
        end
        config drill-down-table
            edit 1
                set chart "sdwan-Device-Interface-Latency-Line"
                set show-title enable
            next
            edit 2
                set chart "sdwan-Device-Interface-Jitter-Line"
                set show-title enable
            next
            edit 3
                set chart "sdwan-Device-Interface-Packetloss-Line"
                set show-title enable
            next
        end
        set drill-down-layout "<div style=\"page-break-inside:avoid;\"><h2><strong>Device - ${var.title.\"Device Name\"}</strong></h2>${chart.id.1}</div>${chart.id.2}${chart.id.3}"
        set protected enable
    next
    edit "sdwan-Device-Interface-Latency-Line"
        set disp-name "SD-WAN Device-Interface Latency Line"
        set category "SD-WAN"
        set description "Latency by WAN Link Over Time (ms)"
        set dataset "sdwan-Device-Interface-Latency-Timeline"
        set chart-type line
        config table-columns
            edit 1
                set header "Date"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "interface"
                set column-attr none
                set data-type drilldown
                set data-top 10
            next
            edit 3
                set data-binding "latency"
                set column-attr none
                set column-graph-type line-up
            next

        end
        set protected enable
    next
    edit "sdwan-Device-Interface-Jitter-Line"
        set disp-name "SD-WAN Device-Interface Jitter Line"
        set category "SD-WAN"
        set description "Jitter by WAN Link Over Time (ms)"
        set dataset "sdwan-Device-Interface-Jitter-Timeline"
        set chart-type line
        config table-columns
            edit 1
                set header "Date"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "interface"
                set column-attr none
                set data-type drilldown
                set data-top 10
            next
            edit 3
                set data-binding "jitter"
                set column-attr none
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "sdwan-Device-Interface-Packetloss-Line"
        set disp-name "SD-WAN Device-Interface Packet Loss Line"
        set category "SD-WAN"
        set description "Packet Loss by WAN Link Over Time"
        set dataset "sdwan-Device-Interface-Packetloss-Timeline"
        set chart-type line
        config table-columns
            edit 1
                set header "Date"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "interface"
                set column-attr none
                set data-type drilldown
                set data-top 10
            next
            edit 3
                set data-binding "packetloss"
                set column-attr percent
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "sdwan-Device-Latency-Line"
        set disp-name "SD-WAN Device Latency Line"
        set category "SD-WAN"
        set description "Latency After SD-WAN Implementation (ms)"
        set dataset "sdwan-Device-Latency-Timeline"
        set chart-type line
        config table-columns
            edit 1
                set header "Date"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "latency"
                set column-attr none
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "sdwan-Device-Jitter-Line"
        set disp-name "SD-WAN Device Jitter Line"
        set category "SD-WAN"
        set description "Jitter After SD-WAN Implementation (ms)"
        set dataset "sdwan-Device-Jitter-Timeline"
        set chart-type line
        config table-columns
            edit 1
                set header "Date"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "jitter"
                set column-attr none
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "sdwan-Device-Packetloss-Line"
        set disp-name "SD-WAN Device Packet Loss Line"
        set category "SD-WAN"
        set description "Packet Loss After SD-WAN Implementation"
        set dataset "sdwan-Device-Packetloss-Timeline"
        set chart-type line
        config table-columns
            edit 1
                set header "Date"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "packetloss"
                set column-attr percent
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "sdwan-Device-Interface-Summary-by-Bibandwidth"
        set disp-name "SD-WAN Device Interface Summary by Bandwidth"
        set category "SD-WAN"
        set description "SD-WAN Device Interface Summary by Bandwidth"
        set dataset "sdwan-Device-Interface-Summary-by-Bibandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Device Name"
                set data-binding "devid"
                set data-top 20
                set column-width 18
            next
            edit 2
                set header "WAN Link"
                set data-binding "interface"
                set column-width 10
            next
            edit 3
                set header "Latency (min.)"
                set data-binding "latency_min"
                set column-attr none
            next
            edit 4
                set header "Latency (avg.)"
                set data-binding "latency_avg"
            next
            edit 5
                set header "Latency (max.)"
                set data-binding "latency_max"
            next

            edit 6
                set header "Jitter (min.)"
                set data-binding "jitter_min"
            next
            edit 7
                set header "Jitter (avg.)"
                set data-binding "jitter_avg"
            next
            edit 8
                set header "Jitter (max.)"
                set data-binding "jitter_max"
            next
            edit 9
                set header "Packet Loss (min.)"
                set data-binding "packetloss_min"
                set column-attr percent
            next
            edit 10
                set header "Packet Loss (avg.)"
                set data-binding "packetloss_avg"
                set column-attr percent
            next
            edit 11
                set header "Packet Loss (max.)"
                set data-binding "packetloss_max"
                set column-attr percent
            next
        end
        set protected enable
    next
    edit "sdwan-Top-App-By-Bandwidth"
        set disp-name "SD-WAN Top Application by bandwidth"
        set category "SD-WAN"
        set description "SD-WAN Top Application by bandwidth"
        set dataset "sdwan-Top-App-By-Bandwidth"
        set chart-type donut
        set include-other enable
        set chart-style "{\"legend-position\": \"right\", \"inner-content\": \"summary-value\"}"
        config table-columns
            edit 1
                set header "Application"
                set data-binding "app_group"
                set column-attr none
                set data-top 5
            next
            edit 2
                set header " "
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "sdwan-Top-App-By-Bandwidth-Sankey"
        set disp-name "SD-WAN Top Applications by Bandwidth Sankey"
        set category "SD-WAN"
        set description "SD-WAN Top Application by bandwidth Sankey"
        set dataset "sdwan-Top-App-By-Bandwidth-Sankey"
        set chart-type sankey
        config table-columns
            edit 1
                set data-binding "summary"
                set data-top 20
            next
            edit 2
                set data-binding "app_group"
            next
            edit 3
                set data-binding "devid"
            next
            edit 4
                set data-binding "interface"
            next
            edit 5
                set data-binding "bandwidth"
            next
        end
    next
    edit "sdwan-Device-Interface-bandwidth-Drilldown"
        set disp-name "SD-WAN Device Interface Bandwidth Drilldown"
        set description "SD-WAN Device Interface Bandwidth Drilldown"
        set category "SD-WAN"
        set dataset "sdwan-fw-Device-Stat_by_Bibandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Device Name"
                set data-binding "devid"
                set data-top 10
            next
        end
        config drill-down-table
            edit 1
                set chart "sdwan-Device-Rules-Donut-Bandwidth"
                set show-title enable
            next
            edit 2
                set chart "sdwan-device-interface-bandwidth"
                set show-title enable
            next
            edit 3
                set chart "sdwan-Device-Intfe-traffic-bandwidth-Line"
                set show-title enable
            next
            edit 4
                set chart "sdwan-Device-Intf-Outbandwidth-Timeline"
                set show-title enable
            next
            edit 5
                set chart "sdwan-Device-Intf-Inbandwidth-Timeline"
                set show-title enable
            next
        end
        set drill-down-layout "<div style=\"page-break-inside:avoid;\"><h2><strong>Device - ${var.title.\"Device Name\"}</strong></h2><table style=\"width:100%\"><tr><td>${chart.id.1}</td><td>${chart.id.2}</td></tr></table></div>${chart.id.3}${chart.id.4}${chart.id.5}"
        set protected enable
    next
    edit "sdwan-Device-Rules-Donut-Bandwidth"
        set disp-name "SD-WAN Device Rules Donut Bandwidth"
        set category "SD-WAN"
        set description "Traffic Utilization by SD-WAN Rule"
        set dataset "sdwan-Device-Rules-Bandwidth"
        set chart-type donut
        set include-other enable
        set chart-style "{\"legend-position\": \"right\", \"inner-content\": \"summary-value\"}"
        config table-columns
            edit 1
                set header "SD-WAN Rule"
                set data-binding "rulename"
                set data-top 5
            next
            edit 2
                set header " "
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "sdwan-device-interface-bandwidth"
        set disp-name "SD-WAN Device Link Bandwidth"
        set category "SD-WAN"
        set description "Traffic Distribution Over SD-WAN Member"
        set dataset "sdwan-device-interface-bandwidth"
        set chart-type donut
        set include-other enable
        set chart-style "{\"legend-position\": \"right\", \"inner-content\": \"summary-value\"}"
        config table-columns
            edit 1
                set header ""
                set data-binding "interface"
                set data-top 5
            next
            edit 2
                set header " "
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "sdwan-Top-Application-Session-Bandwidth"
        set disp-name "SD-WAN Top Applications by Traffic Volume and Session"
        set category "SD-WAN"
        set description "SD-WAN Top Applications by Traffic Volume and Session"
        set hidden disable
        set dataset "sdwan-Top-App-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Application"
                set data-binding "appid"
                set column-attr app-id
                set data-top 10
                set column-span 2
            next
            edit 2
                set data-binding "app_group"
            next
            edit 3
                set header "Sessions"
                set data-binding "sessions"
                set column-span 2
                set column-graph-type bar
            next
            edit 4
                set data-binding "sessions"
                set column-attr count
            next
            edit 5
                set header "Bytes"
                set data-binding "bandwidth"
                set column-span 2
                set column-graph-type bar
            next
            edit 6
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "sdwan-Top-Users-By-Bandwidth-Bar"
        set disp-name "Top SD-WAN Users by Bandwidth Bar"
        set category "SD-WAN"
        set description "Top SD-WAN Users by Bandwidth"
        set dataset "sdwan-Top-Users-By-Bandwidth"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set data-top 20
            next
            edit 2
                set header "Bytes"
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "sdwan-top-user-app-Drilldown"
        set disp-name "SD-WAN Top User and Application over Bandwidth"
        set category "SD-WAN"
        set description "Top SD-WAN User and Application over Bandwidth"
        set dataset "sdwan-Top-Users-Application-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set data-top 10
            next
            edit 2
                set header "Application"
                set data-binding "app_group"
                set data-type drilldown
                set data-top 3
                set column-width 15
            next
            edit 3
                set header "Bytes"
                set data-binding "bandwidth"
                set data-type aggregate
                set column-attr bandwidth
                set column-width 15
            next
        end
        set protected enable
    next
    edit "sdwan-Device-Intfe-traffic-out-bandwidth-Line"
        set disp-name "SD-WAN Link Traffic Outbandwidth Line"
        set category "SD-WAN"
        set description "Traffic Sent by SD-WAN Members Over Time"
        set dataset "sdwan-Device-Intfe-traffic-out-bandwidth-Timeline"
        set chart-type line
        config table-columns
            edit 1
                set header "Date"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "interface"
                set column-attr none
                set data-type drilldown
                set data-top 10
            next
            edit 3
                set data-binding "bandwidth"
                set column-attr none
                set column-graph-type line-up
            next
        end
        set drill-down-agg enable
        set protected enable
    next
    edit "sdwan-Device-Intfe-traffic-in-bandwidth-Line"
        set disp-name "SD-WAN Link Traffic Inbandwidth Line"
        set category "SD-WAN"
        set description "Traffic Received by SD-WAN Members Over Time"
        set dataset "sdwan-Device-Intfe-traffic-in-bandwidth-Timeline"
        set chart-type line
        config table-columns
            edit 1
                set header "Date"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "interface"
                set column-attr none
                set data-type drilldown
                set data-top 10
            next
            edit 3
                set data-binding "bandwidth"
                set column-attr none
                set column-graph-type line-up
            next
        end
        set drill-down-agg enable
        set protected enable
    next
    edit "sdwan-Device-Intfe-traffic-bandwidth-Line"
        set disp-name "SD-WAN Link Traffic Bandwidth Line"
        set category "SD-WAN"
        set description "Traffic Utilization by SD-WAN Members Over Time"
        set dataset "sdwan-Device-Intfe-traffic-out-bandwidth-Timeline"
        set chart-type line
        config table-columns
            edit 1
                set header "Date"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "interface"
                set column-attr none
                set data-type drilldown
                set data-top 10
            next
            edit 3
                set data-binding "bandwidth"
                set column-attr none
                set column-graph-type line-up
            next
        end
        set drill-down-agg enable
        set protected enable
    next
    edit "sdwan-Device-SLA-Interface-bandwidth-Drilldown"
        set disp-name "SD-WAN Device SLA Rule Drilldown"
        set description "SD-WAN Device SLA Rule Drilldown"
        set category "SD-WAN"
        set hidden disable
        set dataset "sdwan-fw-Device-Stat_by_Bibandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Device Name"
                set data-binding "devid"
                set data-top 10
            next
        end
        config drill-down-table
            edit 1
                set chart "sdwan-device-sla-intf-latency-pass-percent"
                set show-title enable
            next
            edit 2
                set chart "sdwan-device-sla-intf-jitter-pass-percent"
                set show-title enable
            next
            edit 3
                set chart "sdwan-device-sla-intf-packetloss-pass-percent"
                set show-title enable
            next
            edit 4
                set chart "sdwan-Device-SLA-Rule-Latency-Line"
                set show-title enable
            next
            edit 5
                set chart "sdwan-Device-SLA-Rule-Jitter-Line"
                set show-title enable
            next
            edit 6
                set chart "sdwan-Device-SLA-Rule-Packetloss-Line"
                set show-title enable
            next
        end
        set drill-down-layout "<div style=\"page-break-inside:avoid;\"><h2><strong>Device - ${var.title.\"Device Name\"}</strong></h2>${chart.id.1}</div>${chart.id.2}${chart.id.3}${chart.id.4}${chart.id.5}${chart.id.6}"
        set protected enable
    next
    edit "sdwan-Device-SLA-Rule-Latency-Line"
        set disp-name "SD-WAN Device-Link-SLA-Rule Latency Line"
        set category "SD-WAN"
        set description "Latency by Link and SLA Rule Over Time (ms)"
        set dataset "sdwan-Device-SLA-Rule-Latency-Line"
        set chart-type line
        config table-columns
            edit 1
                set header "Date"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "intf_sla"
                set column-attr none
                set data-type drilldown
                set data-top 10
            next
            edit 3
                set data-binding "latency"
                set column-attr none
                set column-graph-type line-up
            next

        end
        set protected enable
    next
    edit "sdwan-Device-SLA-Rule-Jitter-Line"
        set disp-name "SD-WAN Device-Link-SLA-Rule Jitter Line"
        set category "SD-WAN"
        set description "Jitter by Link and SLA Rule Over Time (ms)"
        set dataset "sdwan-Device-SLA-Rule-Jitter-Line"
        set chart-type line
        config table-columns
            edit 1
                set header "Date"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "intf_sla"
                set column-attr none
                set data-type drilldown
                set data-top 10
            next
            edit 3
                set data-binding "jitter"
                set column-attr none
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "sdwan-Device-SLA-Rule-Packetloss-Line"
        set disp-name "SD-WAN Device-Link-SLA-Rule Packet Loss Line"
        set category "SD-WAN"
        set description "Packet Loss by Link and SLA Rule Over Time"
        set dataset "sdwan-Device-SLA-Rule-Packetloss-Line"
        set chart-type line
        config table-columns
            edit 1
                set header "Date"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "intf_sla"
                set column-attr none
                set data-type drilldown
                set data-top 10
            next
            edit 3
                set data-binding "packetloss"
                set column-attr percent
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "sdwan-device-sla-intf-latency-pass-percent"
        set disp-name "SLA Rules Link Percentage Within Latency Threshold"
        set category "Event"
        set description "SLA Rules Link Percentage Within Latency Threshold"
        set dataset "sdwan-device-sla-intf-latency-pass-percent"
        set chart-type table
        config table-columns
            edit 1
                set header "SLA Rules"
                set data-binding "sla_rule"
                set column-span 1
                set data-top 10
            next
            edit 2
                set header "Links"
                set data-binding "interface"
                set data-type drilldown
                set data-top 5
                set column-width 20
            next
            edit 3
                set header "Latency Within Threshold"
                set data-binding "latency"
                set data-type aggregate
                set column-attr percent
                set column-width 30
            next
        end
        set protected enable
    next
    edit "sdwan-device-sla-intf-jitter-pass-percent"
        set disp-name "SLA Rules Link Percentage Within Jitter Threshold"
        set category "Event"
        set description "SLA Rules Link Percentage Within Jitter Threshold"
        set dataset "sdwan-device-sla-intf-jitter-pass-percent"
        set chart-type table
        config table-columns
            edit 1
                set header "SLA Rules"
                set data-binding "sla_rule"
                set column-span 1
                set data-top 10
            next
            edit 2
                set header "Links"
                set data-binding "interface"
                set data-type drilldown
                set data-top 5
                set column-width 20
            next
            edit 3
                set header "Jitter Within Threshold"
                set data-binding "jitter"
                set data-type aggregate
                set column-attr percent
                set column-width 30
            next
        end
        set protected enable
    next
    edit "sdwan-device-sla-intf-packetloss-pass-percent"
        set disp-name "SLA Rules Link Percentage Within Packet Loss Threshold"
        set category "Event"
        set description "SLA Rules Link Percentage Within Packet Loss Threshold"
        set dataset "sdwan-device-sla-intf-packetloss-pass-percent"
        set chart-type table
        config table-columns
            edit 1
                set header "SLA Rules"
                set data-binding "sla_rule"
                set column-span 1
                set data-top 10
            next
            edit 2
                set header "Links"
                set data-binding "interface"
                set data-type drilldown
                set data-top 5
                set column-width 20
            next
            edit 3
                set header "Packet Loss Within Threshold"
                set data-binding "packetloss"
                set data-type aggregate
                set column-attr percent
                set column-width 30
            next
        end
        set protected enable
    next
    edit "sdwan-Device-Intf-List-by-Availability"
        set disp-name "SD-WAN Device-Interface List by Availability"
        set description "SD-WAN Device-Interface List by Availability"
        set category "SD-WAN"
        set dataset "sdwan-Device-Intf-List-by-Availability"
        set chart-type table
        set order-by "dev_intf"
        config table-columns
            edit 1
                set header "Device Link"
                set data-binding "dev_intf"
                set data-top 20
            next
        end
        config drill-down-table
            edit 1
                set chart "sdwan-Device-Intf-Updown-Timeline"
            next
        end
        set drill-down-layout "<div style=\"page-break-inside:avoid;\"><p>${var.title.\"Device Link\"}</p>${chart.id.1}</div>"
        set protected enable
    next
    edit "sdwan-Device-Intf-Updown-Timeline"
        set disp-name "SD-WAN Device Interface Updown Time Line"
        set category "SD-WAN"
        set description "SD-WAN Device Interface Updown Time Line"
        set dataset "sdwan-Device-Intf-Updown-Timeline"
        set chart-type line
        config table-columns
            edit 1
                set header "Date"
                set data-binding "hodex"
                set column-attr time
            next
            edit 2
                set data-binding "sdwan_status"
                set column-attr percent
                set column-graph-type line-up
            next
        end
        set protected enable
    next

    edit "sdwan-Device-Availability-status"
        set disp-name "SD-WAN Device Availability Status"
        set description "SD-WAN Device Availability Status"
        set category "SD-WAN"
        set dataset "sdwan-fw-Device-Stat_by_Bibandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Device Name"
                set data-binding "devid"
                set data-top 10
            next
        end
        config drill-down-table
            edit 1
                set chart "sdwan-device-intf-availability-percentage-donut"
                set show-title enable
            next
            edit 2
                set chart "sdwan-Device-Intf-Avail-Percentage-Timeline"
            next
            edit 3
                set chart "sdwan-Device-Latency-Line"
                set show-title enable
            next
            edit 4
                set chart "sdwan-Device-Jitter-Line"
                set show-title enable
            next
            edit 5
                set chart "sdwan-Device-Packetloss-Line"
                set show-title enable
            next
        end
        set drill-down-layout "<div style=\"page-break-inside:avoid;\"><h2><strong>Overview of Device - ${var.title.\"Device Name\"}</strong></h2>${chart.id.1}</div>${chart.id.2}${chart.id.3}${chart.id.4}${chart.id.5}"
        set protected enable
    next
    edit "sdwan-device-intf-availability-percentage-bar"
        set disp-name "SD-WAN Device Interface Availability Percentage Bar"
        set description "SD-WAN Availability"
        set dataset "sdwan-device-intf-availability-percentage"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\", \"bar-color\": \"#69c13f\"}"
        config table-columns
            edit 1
                set header "WAN Overall and Each Link Availability"
                set data-binding "interface"
                set data-top 11
            next
            edit 2
                set data-binding "available"
                set data-type aggregate
                set column-attr percent
            next
        end
        set protected enable
    next
    edit "sdwan-device-intf-availability-percentage-donut"
        set disp-name "SD-WAN Device Interface Availability Percentage Donut"
        set description "SD-WAN Availability"
        set dataset "sdwan-device-intf-availability-percentage-donut"
        set chart-type donut
        set chart-style "{\"legend-display\": \"disable\", \"cluster-chart\": \"enable\", \"inner-content\": \"first-value\", \"colors\": \"#69c13f,#C0C0C0\" }"
        config table-columns
            edit 1
                set header "Interface"
                set data-binding "interface"
                set data-top 0
            next
            edit 2
                set header "Availability"
                set data-binding "avail"
            next
            edit 3
                set data-binding "val"
            next
            edit 4
                set data-binding "val"
                set column-attr percent
            next
        end
        set protected enable
    next
    edit "sdwan-Device-Application-sdwan-Rules-and-Ports-drilldown"
        set disp-name "SD-WAN Application From Rules and Ports"
        set description "SD-WAN Traffic Distribution From Rules and Ports"
        set category "SD-WAN"
        set hidden disable
        set dataset "sdwan-fw-Device-Stat_by_Bibandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Device Name"
                set data-binding "devid"
                set data-top 10
            next
        end
        config drill-down-table
            edit 1
                set chart "sdwan-Device-Interface-Application-Traffic-Sankey"
                set show-title enable
            next
        end
        set drill-down-layout "<div style=\"page-break-inside:avoid;\"><h2><strong>Device - ${var.title.\"Device Name\"}</strong></h2>${chart.id.1}</div>"
        set protected enable
    next
    edit "sdwan-Device-Interface-Application-Traffic-Sankey"
        set disp-name "SD-WAN Device Traffic Distribution by Interface and Application"
        set category "SD-WAN"
        set description "SD-WAN Device Traffic Distribution by Interface and Application"
        set dataset "sdwan-Device-Interface-Application-Traffic-Sankey"
        set chart-type sankey
        config table-columns
            edit 1
                set data-binding "summary"
                set data-top 20
            next
            edit 2
                set data-binding "rule_name"
            next
            edit 3
                set data-binding "interface"
            next
            edit 4
                set data-binding "app_group"
            next
            edit 5
                set data-binding "bandwidth"
            next
        end
        set protected enable
    next
    edit "sdwan-fw-Device-Interface-test2"
        set disp-name "SD-WAN Top Device WAN Link test2"
        set description "SD-WAN Top Device WAN Link test"
        set category "SD-WAN"
        set hidden disable
        set dataset "sdwan-fw-Device-Interface-Stat_Bibandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Device Name"
                set data-binding "devid"
                set data-top 10
            next
        end
        config drill-down-table
            edit 1
                set chart "sdwan-Device-Intf-Avail-Percentage-Timeline"
                set show-title enable
            next
        end
        set drill-down-layout "<div style=\"page-break-inside:avoid;\"><h2><strong>Device - ${var.title.\"Device Name\"}</strong></h2>${chart.id.1}</div>"
    next
    edit "sdwan-Device-Intf-Avail-Percentage-Timeline"
        set disp-name "SD-WAN Device Interface Availability Percentage Timeline"
        set category "SD-WAN"
        set description "SD-WAN Device Interface Availability Over Time"
        set dataset "sdwan-Device-Intf-Avail-Percentage-Timeline"
        set chart-type heatmap
        set chart-style "{\"colormap\":[{\"#FF5722\": [ 0, 30 ]},{\"#FF9800\": [ 30, 50 ]},{\"#FFC107\": [ 50, 70 ]},{\"#FFEB3B\": [ 70, 90 ]},{\"#CDDC39\": [ 90, 99 ]},{\"#8BC34A\": [ 99, 99.9 ]},{\"#4CAF50\": [ 99.9, 101 ]}] }"
        set hidden enable
        config table-columns
            edit 1
                set header "Date"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "interface"
                set column-attr none
                set data-type drilldown
            next
            edit 3
                set data-binding "available"
                set column-attr percent
                set column-graph-type line-up
            next
        end
    next
    edit "sdwan-Device-Intf-Inbandwidth-Timeline"
        set disp-name "SD-WAN Device-Interface Inbandwidth Line"
        set category "SD-WAN"
        set description "Received(bps)"
        set dataset "sdwan-Device-Intf-Inbandwidth-Timeline"
        set chart-type line
        config table-columns
            edit 1
                set header "Time"
                set data-binding "time"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "interface"
                set column-attr none
                set data-type drilldown
                set data-top 10
            next
            edit 3
                set data-binding "inbandwidth"
                set column-attr bandwidth
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "sdwan-Device-Intf-Outbandwidth-Timeline"
        set disp-name "SD-WAN Device-Interface Outbandwidth Line"
        set category "SD-WAN"
        set description "Sent(bps)"
        set dataset "sdwan-Device-Intf-Outbandwidth-Timeline"
        set chart-type line
        config table-columns
            edit 1
                set header "Time"
                set data-binding "time"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "interface"
                set column-attr none
                set data-type drilldown
                set data-top 10
            next
            edit 3
                set data-binding "outbandwidth"
                set column-attr bandwidth
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "Top-Web-Sites-by-Bandwidth"
        set disp-name "Top Hostname by Traffic"
        set description "Top Hostname by Traffic"
        set category "Web"
        set dataset "Top-Web-Sites-by-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Hostname"
                set data-binding "domain"
                set data-top 10
            next
            edit 2
                set header "Traffic"
                set data-binding "bandwidth"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "Top-App-Category-by-Session"
        set disp-name "Top Application Category by Count"
        set description "Top Application Category by Count"
        set category "Traffic"
        set dataset "Top-App-Category-by-Session"
        set chart-type table
        config table-columns
            edit 1
                set header "Application Category"
                set data-binding "appcat"
                set data-top 10
            next
            edit 2
                set header "Count"
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Top-Region-Name-by-Traffic"
        set disp-name "Top Region Names by Traffic"
        set description "Top Region Names by Traffic"
        set category "Traffic"
        set dataset "Top-Region-Name-by-Traffic"
        set chart-type table
        config table-columns
            edit 1
                set header "Region"
                set data-binding "dstcountry"
                set data-top 10
            next
            edit 2
                set header "Traffic"
                set data-binding "bandwidth"
                set column-attr bandwidth
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "Top-App-By-Bandwidth-Chart"
        set disp-name "Top Application by Traffic Chart"
        set description "Top Application by Traffic"
        set category "Traffic"
        set dataset "Top-App-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Application Name"
                set data-binding "app_group"
                set data-top 10
            next
            edit 2
                set header "Traffic"
                set data-binding "bandwidth"
                set column-attr bandwidth
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "Top-Protocols-By-Traffic"
        set disp-name "Top Protocols by Traffic"
        set description "Top Protocols by Traffic"
        set category "Traffic"
        set dataset "Top-Protocols-By-Traffic"
        set chart-type table
        config table-columns
            edit 1
                set header "Protocol"
                set data-binding "service"
                set data-top 10
            next
            edit 2
                set header "Traffic"
                set data-binding "bandwidth"
                set column-attr bandwidth
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "Top-Web-Sites-by-Sessions"
        set disp-name "Top Websites by Count"
        set description "Top Websites by Count"
        set category "Web"
        set dataset "Top-Web-Sites-by-Sessions"
        set chart-type table
        config table-columns
            edit 1
                set header "Website"
                set data-binding "domain"
                set data-top 10
            next
            edit 2
                set header "Visits (Count)"
                set data-binding "sessions"
                set column-attr count
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "Top-Attacks-by-Count"
        set disp-name "Top Attacks by Count"
        set description "Top Attacks by Count"
        set category "Threat"
        set dataset "Top-Attacks-by-Count"
        set chart-type table
        config table-columns
            edit 1
                set header "Attack"
                set data-binding "attack"
                set data-top 10
            next
            edit 2
                set header "Events (Count)"
                set data-binding "totalnum"
                set column-attr count
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "Top-Spams-by-Count"
        set disp-name "Top Spams by Count"
        set description "Top Spams by Count"
        set category "Email"
        set dataset "Top-Spams-by-Count"
        set chart-type table
        config table-columns
            edit 1
                set header "Source"
                set data-binding "user_src"
                set data-top 10
            next
            edit 2
                set header "Events (Count)"
                set data-binding "totalnum"
                set column-attr count
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "utm-Top-Virus-Count"
        set disp-name "Top Viruses by Count"
        set description "Top Viruses by Count"
        set category "Virus"
        set dataset "utm-Top-Virus"
        set chart-type table
        config table-columns
            edit 1
                set header "virus"
                set data-binding "virusid"
                set column-attr url
                set column-span 2
                set data-top 10
            next
            edit 2
                set header "virus"
                set data-binding "virus"
                set column-attr virus
            next
            edit 3
                set header "Events (Count)"
                set data-binding "totalnum"
                set column-attr count
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "security-Antivirus-Inspections"
        set disp-name "Antivirus Inspections"
        set description "Antivirus Inspections"
        set category "Virus"
        set dataset "security-Antivirus-Inspections"
        set chart-type table
        config table-columns
            edit 1
                set header "Action"
                set data-binding "action"
                set data-top 10
            next
            edit 2
                set header "Inspections (Count)"
                set data-binding "totalnum"
                set column-attr count
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "Top-DLP-by-Count"
        set disp-name "Top DLP by Count"
        set description "Top DLP by Count"
        set category "Security"
        set dataset "Top-DLP-by-Count"
        set chart-type table
        config table-columns
            edit 1
                set header "DLP Name"
                set data-binding "profile"
                set data-top 10
            next
            edit 2
                set header "DLP (Count)"
                set data-binding "total_num"
                set column-attr count
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "wifi-Top-AP-By-Client"
        set disp-name "Top FAPs(Wireless) by Max Client Count"
        set description "Top FAPs(Wireless) by Max Client Count"
        set category "Traffic"
        set dataset "wifi-Top-AP-By-Client"
        set chart-type table
        config table-columns
            edit 1
                set header "Wireless AP"
                set data-binding "srcintf"
                set data-top 10
            next
            edit 2
                set header "Clients (Count)"
                set data-binding "totalnum"
                set column-attr count
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "wifi-Top-AP-By-Bandwidth"
        set disp-name "Top FAPs(Wireless) by Max Bandwidth"
        set description "Top FAPs(Wireless) by Max Bandwidth"
        set category "Traffic"
        set dataset "wifi-Top-AP-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Wireless AP"
                set data-binding "ap_srcintf"
                set data-top 10
            next
            edit 2
                set header "Traffic"
                set data-binding "bandwidth"
                set column-attr bandwidth
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "wifi-Top-SSID-By-Bandwidth"
        set disp-name "Top SSIDs(Wireless) by Max Traffic"
        set description "Top SSIDs(Wireless) by Max Traffic"
        set category "Traffic"
        set dataset "wifi-Top-SSID-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "SSID"
                set data-binding "srcssid"
                set data-top 10
            next
            edit 2
                set header "Traffic"
                set data-binding "bandwidth"
                set column-attr bandwidth
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "sdwan-CTAP-Total-Bandwidth-Internal-And-External"
        set disp-name "CTAP SD-WAN Internal and External Bandwidth"
        set description "CTAP SD-WAN Internal and External Bandwidth"
        set dataset "sdwan-CTAP-Total-Bandwidth-Internal-And-External"
        set category "Traffic"
        set include-other disable
        set chart-type donut
        set chart-style "{\"legend-position\": \"right\", \"inner-content\": \"summary-value\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "interface"
                set data-top 10
            next
            edit 2
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "sdwan-CTAP-Total-Bandwidth-External-Business-nonBusiness-Network"
        set disp-name "CTAP SD-WAN Bandwidth of External Business and nonBusiness"
        set description "CTAP SD-WAN Bandwidth of External Business and nonBusiness"
        set dataset "sdwan-CTAP-Total-Bandwidth-External-Business-nonBusiness-Network"
        set category "Traffic"
        set include-other disable
        set chart-type donut
        set chart-style "{\"legend-position\": \"right\", \"inner-content\": \"summary-value\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "app_cat"
                set data-top 10
            next
            edit 2
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "sdwan-CTAP-Top-Appcat-Appgroup-By-Bandwidth-Sankey"
        set disp-name "CTAP SD-WAN Top SD-WAN application by bandwidth usage"
        set category "Traffic"
        set description "CTAP SD-WAN Top SD-WAN application by bandwidth usage"
        set dataset "sdwan-CTAP-Top-Appcat-Appgroup-By-Bandwidth-Sankey"
        set chart-type sankey
        set chart-style "{\"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "summary"
                set data-top 20
            next
            edit 2
                set data-binding "appcat"
            next
            edit 3
                set data-binding "app_group"
            next
            edit 4
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "sdwan-CTAP-Business-Apps-Bandwidth"
        set disp-name "CTAP SD-WAN Business Application with Bandwidth"
        set description "CTAP SD-WAN Business Application with Bandwidth"
        set category "SD-WAN"
        set dataset "sdwan-CTAP-Business-Apps-Bandwidth"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\", \"bar-size\": \"small\"}"
        set include-other disable
        config table-columns
            edit 1
                set header ""
                set data-binding "app_group"
                set data-top 10
            next
            edit 2
                set header ""
                set data-binding "bandwidth"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "sdwan-CTAP-Cloud-IT-Apps-Bandwidth"
        set disp-name "CTAP SD-WAN Cloud IT Application Bandwidth"
        set description "CTAP SD-WAN Cloud IT Application Bandwidth"
        set category "SD-WAN"
        set dataset "sdwan-CTAP-Cloud-IT-Apps-Bandwidth"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\", \"bar-size\": \"small\"}"
        set include-other disable
        config table-columns
            edit 1
                set header ""
                set data-binding "app_group"
            next
            edit 2
                set header ""
                set data-binding "bandwidth"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "sdwan-CTAP-Storage-Backup-Apps-Bandwidth"
        set disp-name "CTAP SD-WAN Storage Backup Application Bandwidth"
        set description "CTAP SD-WAN Storage Backup Application Bandwidth"
        set category "SD-WAN"
        set dataset "sdwan-CTAP-Storage-Backup-Apps-Bandwidth"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\", \"bar-size\": \"small\"}"
        set include-other disable
        config table-columns
            edit 1
                set header ""
                set data-binding "app_group"
            next
            edit 2
                set header ""
                set data-binding "bandwidth"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "sdwan-CTAP-Collaboration-Apps-Bandwidth"
        set disp-name "CTAP SD-WAN Collaboration Application Bandwidth"
        set description "CTAP SD-WAN Collaboration Application Bandwidth"
        set category "SD-WAN"
        set dataset "sdwan-CTAP-Collaboration-Apps-Bandwidth"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\", \"bar-size\": \"small\"}"
        set include-other disable
        config table-columns
            edit 1
                set header ""
                set data-binding "app_group"
            next
            edit 2
                set header ""
                set data-binding "bandwidth"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "sdwan-CTAP-Top-Streaming-App-By-Bandwidth"
        set disp-name "CTAP SD-WAN Top Streaming Application by Bandwidth"
        set description "CTAP SD-WAN Top Streaming Application by Bandwidth"
        set category "SD-WAN"
        set dataset "sdwan-CTAP-Top-Streaming-App-By-Bandwidth"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\", \"bar-size\": \"small\"}"
        set include-other disable
        config table-columns
            edit 1
                set header ""
                set data-binding "app_group"
            next
            edit 2
                set header ""
                set data-binding "bandwidth"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "sdwan-CTAP-Top-SocialMedia-App-By-Bandwidth"
        set disp-name "CTAP SD-WAN Top SocialMedia Application by Bandwidth"
        set description "CTAP SD-WAN Top SocialMedia Application by Bandwidth"
        set category "SD-WAN"
        set dataset "sdwan-CTAP-Top-SocialMedia-App-By-Bandwidth"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\", \"bar-size\": \"small\"}"
        set include-other disable
        config table-columns
            edit 1
                set header ""
                set data-binding "app_group"
            next
            edit 2
                set header ""
                set data-binding "bandwidth"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "sdwan-CTAP-App-Risk-Reputation-Top-Devices-By-Scores"
        set disp-name "CTAP SD-WAN Reputation Top Devices By-Scores"
        set description "CTAP SD-WAN Reputation Top Devices By-Scores"
        set category "SD-WAN"
        set dataset "CTAP-App-Risk-Reputation-Top-Devices-By-Scores"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\"}"
        set include-other disable
        config table-columns
            edit 1
                set header ""
                set data-binding "dev_src"
            next
            edit 2
                set header ""
                set data-binding "scores"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "sdwan-CTAP-SB-Top-Sandbox-Files"
        set disp-name "CTAP SD-WAN Sandbox Top Sandbox Files"
        set description "CTAP SD-WAN Sandbox Top Sandbox Files"
        set category "SD-WAN"
        set dataset "sdwan-CTAP-SB-Top-Sandbox-Files"
        set chart-type table
        config table-columns
            edit 1
                set header "Filename"
                set data-binding "filename"
                set column-width 25
            next
            edit 2
                set header "Service"
                set data-binding "service"
                set column-width 10
            next
            edit 3
                set header "Risk"
                set data-binding "risk"
                set column-width 13
            next
            edit 4
                set header "Checksum"
                set data-binding "analyticscksum"
            next
            edit 5
                set header "Count"
                set data-binding "total_num"
                set column-attr count
                set column-width 8
            next
            edit 6
                set header "Risk"
                set data-binding "risk_level"
                set column-attr severity
                set column-width 5
            next
        end
        set protected enable
    next
    edit "sdwan-CTAP-SB-Total-Number-of-Malicious-Suspicious-Files"
        set disp-name "CTAP SD-WAN Sandbox Malicious Suspicious Files Number"
        set description "CTAP SD-WAN Sandbox Malicious Suspicious Files Number"
        set category "SD-WAN"
        set dataset "sdwan-CTAP-SB-Total-Number-of-Malicious-Suspicious-Files"
        set chart-type donut
        set chart-style "{\"legend-position\": \"right\", \"inner-content\": \"summary-value\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set header ""
                set data-binding "risk"
            next
            edit 2
                set header ""
                set data-binding "total_num"
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "sdwan-CTAP-Top-Source-Countries"
        set disp-name "CTAP SD-WAN Top Source Countries"
        set description "CTAP SD-WAN Top Source Countries"
        set category "SD-WAN"
        set dataset "sdwan-CTAP-Top-Source-Countries"
        set chart-type table
        config table-columns
            edit 1
                set header "Country"
                set data-binding "srccountry"
            next
            edit 2
                set header "Bytes"
                set data-binding "bandwidth"
                set column-span 2
                set column-graph-type bar
            next
            edit 3
                set header "Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "sdwan-CTAP-Average-Bandwidth-Day-Hour"
        set disp-name "CTAP SD-WAN Average Bandwidth by Day of Week and Hour"
        set description "CTAP SD-WAN Average Bandwidth by Day of Week and Hour"
        set category "SD-WAN"
        set dataset "sdwan-CTAP-Average-Bandwidth-Day-Hour"
        set chart-style "{\"time-display\": \"hour-only\", \"colormap\":[\"#fad7a0\", \"#f8c471\", \"#f5b041\", \"#f39c12\", \"#d68910\", \"#b9770e\"] }"
        set chart-type heatmap
        set hidden enable
        config table-columns
            edit 1
                set header "Hours"
                set data-binding "hourstamp"
                set column-attr time
                set data-top 0
            next
            edit 2
                set column-attr none
                set data-binding "daystamp"
                set data-type drilldown
            next
            edit 3
                set header "Bytes"
                set data-binding "bandwidth"
                set column-graph-type line-up
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "sdwan-CTAP-Average-Log-Rate-By-Hour"
        set disp-name "CTAP SD-WAN Average Log Rate by Hour"
        set description "CTAP SD-WAN Average Log Rate by Hour"
        set category "SD-WAN"
        set dataset "sdwan-CTAP-Avg-Log-Rate-Hour"
        set chart-type area
        set chart-style "{\"time-display\": \"hour-only\"}"
        config table-columns
            edit 1
                set header "Hour"
                set column-attr time
                set data-binding "hourstamp"
                set data-top 24
            next
            edit 2
                set header "log rate"
                set data-binding "log_rate"
                set column-graph-type line-up
                set column-attr count
            next
        end
        set protected enable
    next
    edit "sdwan-CTAP-CPU-Usage-Per-Hour"
        set disp-name "CTAP SD-WAN CPU Usage Per Hour"
        set description "CTAP SD-WAN CPU Usage Per Hour"
        set category "SD-WAN"
        set dataset "event-Usage-CPU"
        set chart-type area
        set chart-style "{\"time-display\": \"hour-only\"}"
        config table-columns
            edit 1
                set header "Hour"
                set column-attr time
                set data-binding "hourstamp"
                set data-top 24
            next
            edit 2
                set header "CPU Usage"
                set data-binding "cpu_avg_usage"
                set column-graph-type line-up
                set data-type raw
                set column-attr percent
            next
        end
        set protected enable
    next
    edit "sdwan-CTAP-Memory-Usage-Per-Hour"
        set disp-name "CTAP SD-WAN Memory Usage Per Hour"
        set description "CTAP SD-WAN Memory Usage Per Hour"
        set category "SD-WAN"
        set dataset "event-Usage-Mem"
        set chart-type area
        set chart-style "{\"time-display\": \"hour-only\"}"
        config table-columns
            edit 1
                set header "Hour"
                set column-attr time
                set data-binding "hourstamp"
                set data-top 24
            next
            edit 2
                set header "Memory Usage"
                set data-binding "mem_avg_usage"
                set column-graph-type line-up
                set data-type raw
                set column-attr percent
            next
        end
        set protected enable
    next
    edit "Top-Destination-Addresses-By-Bandwidth-Bar"
        set disp-name "Top Destinations by Bandwidth Bar"
        set category "SD-WAN"
        set description "Top 10 destination addresses by bandwidth usage"
        set dataset "Top-Destinations-By-Bandwidth"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\"}"
        set include-other disable
        config table-columns
            edit 1
                set header ""
                set data-binding "domain"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header ""
                set data-binding "bandwidth"
                set column-attr bandwidth
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "intf-Timeline-Sampling"
        set disp-name "Interface Timeline by Data Sampling"
        set category "Network Usage"
        set description "Interface Timeline by Data Sampling"
        set dataset "intf-Util-Timeline-Sampling"
        set chart-type line
        config table-columns
            edit 1
                set header "Date"
                set data-binding "tmstamp"
                set column-attr none
            next
            edit 2
                set data-binding "rcvdbps"
                set column-graph-type line-up
                set legend "5 Minute Data Rate (Mbps)"
                set column-style "{\"line-style\":\"fill\", \"line-color\": \"#285A9B\", \"line-width\": \"1px\"}"
            next
            edit 3
                set data-binding "ref_val"
                set column-graph-type line-up
                set legend "95th Percentile"
                set column-style "{\"line-style\": \"dash\", \"line-color\": \"darkred\", \"line-width\": \"1px\", \"show-value\": \"enable\"}"
            next
        end
        set protected enable
    next
    edit "intf-Util-Histogram"
        set disp-name "Interface Utilization Histogram"
        set category "Network Usage"
        set description "Interface Utilization Histogram"
        set dataset "intf-Util-Distribution"
        set chart-type line
        set x-axis-label "Received bps"
        config table-columns
            edit 1
                set header "Received bps"
                set data-binding "value"
                set column-attr count
                set data-top 100
            next
            edit 2
                set data-binding "cnt"
                set column-graph-type line-up
                set legend "Data Samples (Count)"
                set column-style "{\"line-style\": \"histogram\", \"line-color\": \"#285A9B\"}"
            next
        end
        set protected enable
    next
    edit "intf-Sorted-Line"
        set disp-name "Interface Sorted Line Chart"
        set category "Network Usage"
        set description "Interface Sorted Line Chart"
        set dataset "intf-Util-Sortline"
        set chart-type line
        config table-columns
            edit 1
                set header "Percentile of Total Samples"
                set data-binding "n_perc"
            next
            edit 2
                set data-binding "rcvdbps"
                set column-graph-type line-up
                set legend "5 Minute Data Rate (Mbps)"
                set column-style "{\"line-color\": \"#285A9B\", \"line-style\": \"fill\", \"line-width\": \"1px\"}"
            next
            edit 3
                set data-binding "ref_val"
                set column-graph-type line-up
                set legend "95th Percentile"
                set column-style "{\"line-style\": \"dash\", \"line-color\": \"darkred\", \"line-width\": \"1px\", \"show-value\": \"enable\"}"
            next
        end
        set protected enable
    next
    edit "intf-Data-Analysis-Table"
        set disp-name "Interface Throughput Analysis"
        set description "Interface Throughput Analysis"
        set category "Network Usage"
        set dataset "intf-Util-Analysis"
        set chart-type table
        config table-columns
            edit 1
                set header "Min Throughput (Mbps)"
                set data-binding "min_mbps"
            next
            edit 2
                set header "5th Percentile (Mbps)"
                set data-binding "low_ref_mbps"
            next
            edit 3
                set header "Mean Throughput (Mbps)"
                set data-binding "mean_mbps"
            next
            edit 4
                set header "95th Percentile (Mbps)"
                set data-binding "ref_mbps"
            next
            edit 5
                set header "Max Throughput (Mbps)"
                set data-binding "peak_mbps"
            next
            edit 6
                set header "Actual Data (GB)"
                set data-binding "actual_gb"
            next
        end
        set protected enable
    next
    edit "intf-Device-Summary"
        set disp-name "Interface Throughput Device Summary"
        set category "Network Usage"
        set description "Interface Throughput Device Summary Chart"
        set dataset "intf-Device-Summary"
        set chart-type table
        config table-columns
            edit 1
                set header "Device Name"
                set data-binding "devname"
                set data-top 0
            next
            edit 2
                set header "Interface"
                set data-binding "intfname"
                set data-type drilldown
                set data-top 50
            next
            edit 3
                set header "Data Utilization (GB)"
                set data-binding "rcvd_gb"
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "daily-Summary-Traffic-Bandwidth-Line"
        set disp-name "Daily Summary Top Traffic Line"
        set category "Network Usage"
        set description "Traffic Bandwidth"
        set dataset "daily-Summary-Traffic-Bandwidth-Line"
        set chart-type area
        set chart-style "{\"size\":\"compact\", \"y-title\":\"Traffic\", \"legend-position\":\"top\"}"
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "time"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "traffic_out"
                set column-graph-type line-up
                set column-attr bandwidth
                set legend "Sent"
            next
            edit 3
                set data-binding "traffic_in"
                set column-graph-type line-up
                set column-attr bandwidth
                set legend "Received"
            next
        end
        set protected enable
    next
    edit "daily-Summary-Top-User"
        set disp-name "Daily Summary Top User by Traffic"
        set description "Top User"
        set category "Network Usage"
        set dataset "daily-Summary-Top-User"
        set include-other disable
        set chart-type bar
        set chart-style "{\"size\":\"compact\", \"show-value\":\"enable\", \"fixed-bar-width\":\"6\"}"
        config table-columns
            edit 1
                set header "User Name"
                set data-binding "f_user"
                set column-attr none
                set data-top 8
            next
            edit 2
                set header "Bytes"
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "daily-Summary-Top-Domain"
        set disp-name "Daily Summary Top Website by Traffic"
        set description "Top Website"
        set category "Network Usage"
        set dataset "daily-Summary-Top-Domain"
        set include-other disable
        set chart-type pie
        set chart-style "{\"size\":\"compact\"}"
        config table-columns
            edit 1
                set data-binding "domain"
                set data-top 6
            next
            edit 2
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "daily-Summary-Top-Appcat-Bandwidth"
        set disp-name "Daily Summary Top App Category by Bandwidth"
        set description "Top App Category"
        set dataset "daily-Summary-Top-Appcat-Bandwidth"
        set category "Network Usage"
        set include-other disable
        set chart-type donut
        set chart-style "{\"size\":\"compact\", \"inner-content\":\"empty\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "appcat"
                set data-top 6
            next
            edit 2
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "daily-Summary-Top-App"
        set disp-name "Daily Summary Top Application by Severity"
        set category "Traffic"
        set description "Top Application"
        set dataset "daily-Summary-Top-App"
        set chart-type table
        config table-columns
            edit 1
                set header "Application"
                set data-binding "app_group"
                set column-attr app-id
                set column-span 2
                set column-width 25
                set column-style "{\"max-text-length\":20}"
                set data-top 5
            next
            edit 2
                set data-binding "app_group"
            next
            edit 3
                set header "Category"
                set data-binding "appcat"
                set column-attr appcat
                set column-width 20
            next
            edit 4
                set header "Risk"
                set data-binding "risk"
                set column-attr severity
                set column-width 5
            next
            edit 5
                set header "Sessions"
                set data-binding "sessions"
                set column-attr count
                set column-span 3
                set column-width 25
            next
            edit 6
                set data-binding "session_block"
                set column-graph-type bar
                set legend "Blocked"
            next
            edit 7
                set data-binding "session_pass"
                set column-graph-type bar
                set legend "Allowed"
            next
            edit 8
                set header "Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-span 3
                set column-width 25
            next
            edit 9
                set data-binding "traffic_out"
                set column-graph-type bar
                set legend "Sent"
            next
            edit 10
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
        end
        set protected enable
    next
    edit "daily-Summary-Top-Threats"
        set disp-name "Daily Summary Top Threats by Risk"
        set category "Traffic"
        set description "Top Threat"
        set dataset "daily-Summary-Top-Threats"
        set chart-type table
        config table-columns
            edit 1
                set header "Threat"
                set data-binding "threat"
                set data-top 5
                set column-width 32
                set column-attr obf-url
                set column-style "{\"max-text-length\":30}"
            next
            edit 2
                set header "Category"
                set data-binding "threattype"
                set column-width 18
            next
            edit 3
                set header "Threat Score"
                set data-binding "threatweight"
                set column-attr count
                set column-span 3
                set column-width 26
            next
            edit 4
                set data-binding "threat_block"
                set column-graph-type bar
                set legend "Blocked"
            next
            edit 5
                set data-binding "threat_pass"
                set column-graph-type bar
                set legend "Allowed"
            next
            edit 6
                set header "Incidents"
                set data-binding "incidents"
                set column-attr count
                set column-span 3
                set column-width 24
            next
            edit 7
                set data-binding "incident_block"
                set column-graph-type bar
                set legend "Blocked"
            next
            edit 8
                set data-binding "incident_pass"
                set column-graph-type bar
                set legend "Allowed"
            next
        end
        set protected enable
    next
    edit "daily-Summary-Top-Compromised-Hosts"
        set disp-name "Daily Summary Compromised Host by Number of Threat"
        set category "Threat"
        set description "Compromised Host"
        set dataset "daily-Summary-Top-Compromised-Hosts"
        set include-other disable
        set chart-type bar
        set chart-style "{\"size\":\"compact\", \"fixed-bar-width\":\"6\", \"bar-color\":\"#4e79a7\"}"
        config table-columns
            edit 1
                set header "Host Name"
                set data-binding "epname"
                set column-attr none
                set data-top 8
            next
            edit 2
                set header "# of Threats"
                set data-type aggregate
                set data-binding "threat_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "daily-Summary-Incidents-by-Severity"
        set disp-name "Daily Summary Compacted Total Incidents by Severity"
        set category "Events/Incidents"
        set description "Daily Incidents by Severity"
        set dataset "soc-Incident-by-Severity"
        set chart-type donut
        set chart-style "{\"size\":\"compact\", \"inner-content\": \"summary\", \"show-value\": \"enable\", \"legend-position\":\"bottom\"}"
        config table-columns
            edit 1
                set data-binding "severity"
            next
            edit 2
                set header "Total Incidents"
                set data-type aggregate
                set data-binding "incnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "ueba-Asset-Count-by-Detecttype"
        set disp-name "Asset Count by Detection Type"
        set description "Asset Count by Detection Type"
        set dataset "ueba-Asset-Count-by-Detecttype"
        set category "Asset"
        set include-other disable
        set chart-type donut
        set chart-style "{\"size\":\"compact\", \"donut-radius\":\"40\", \"inner-content\":\"summary\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "detecttype"
                set data-top 6
            next
            edit 2
                set data-type aggregate
                set data-binding "count"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "ueba-Asset-Identification"
        set disp-name "Asset Count by Identification"
        set description "Asset Count by Identification"
        set dataset "ueba-Asset-Identification"
        set category "Asset"
        set include-other disable
        set chart-type donut
        set chart-style "{\"size\":\"compact\", \"donut-radius\":\"40\", \"inner-content\":\"summary\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "type"
                set data-top 6
            next
            edit 2
                set data-type aggregate
                set data-binding "count"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "ueba-Asset-Count-by-HWOS"
        set disp-name "Asset Count by Hardware OS"
        set category "Asset"
        set description "Asset Count by Hardware OS"
        set hidden disable
        set dataset "ueba-Asset-Count-by-HWOS"
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\", \"bar-size\": \"compact\"}"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "HW OS"
                set data-binding "osname"
                set data-top 8
            next
            edit 2
                set header "# of Endpoint"
                set data-type aggregate
                set data-binding "count"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "ueba-Asset-Count-by-Device-and-Detecttype"
        set disp-name "Asset Count by Source and Detection Type"
        set category "Asset"
        set description "Asset Count by Source and Detection Type"
        set dataset "ueba-Asset-Count-by-Device-and-Detecttype"
        set chart-type bar
        set chart-style "{\"size\":\"compact\", \"y-title\":\"Count\", \"legend-position\":\"top\"}"
        config table-columns
            edit 1
                set header "Device Name"
                set data-binding "devname"
                set data-top 8
            next
            edit 2
                set header "Detection Type"
                set data-binding "detecttype"
                set data-type drilldown
                set data-top 5
            next
            edit 3
                set header "Count"
                set data-binding "count"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "ueba-User-Count-by-Usergroup"
        set disp-name "User Count by User Group"
        set description "User Count by User Group"
        set dataset "ueba-User-Count-by-Usergroup"
        set category "Asset"
        set include-other disable
        set chart-type donut
        set chart-style "{\"size\":\"compact\", \"donut-radius\":\"40\", \"inner-content\":\"summary\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "eugroup"
                set data-top 6
            next
            edit 2
                set data-type aggregate
                set data-binding "count"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "ueba-Asset-User-Count-by-Device"
        set disp-name "Asset and User Count by Device"
        set category "Asset"
        set description "Asset and User Count by Device"
        set dataset "ueba-Asset-User-Count-by-Device"
        set chart-style "{\"cluster-chart\":\"enable\", \"size\":\"compact\", \"y-title\":\"Count\", \"legend-position\":\"top\"}"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "Device Name"
                set data-binding "devname"
                set data-top 8
            next
            edit 2
                set header "Count of "
                set data-type drilldown
                set data-binding "cnt_for"
                set data-top 2
            next
            edit 3
                set header "Count"
                set data-type aggregate
                set data-binding "count"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "ueba-Asset-User-Count-by-Device-Interface-and-Detectiontype"
        set disp-name "Asset and User Count by Source Device Interface and Detection Method"
        set category "Asset"
        set description "Asset and User Count by Source Device Interface and Detection Method"
        set dataset "ueba-Asset-User-Count-by-Device-Interface-and-Detectiontype"
        set chart-type table
        set chart-style "{\"show-sum-0\": \"enable\", \"show-total\": \"disable\", \"show-others\": \"disable\", \"show-percent\": \"disable\"}"
        config table-columns
            edit 1
                set header "Device Name"
                set data-binding "devname"
                set data-top 30
                set column-width 20
            next
            edit 2
                set header "Interface"
                set data-binding "srcintf"
                set data-type drilldown
                set data-top 5
                set column-width 15
            next
            edit 3
                set header "# of Endpoints by Detection Methods"
                set data-binding "mac_cnt"
                set legend "MAC"
                set column-span 3
                set data-type calculated
                set data-calc-func sum
                set column-graph-type bar
                set column-width 45
            next
            edit 4
                set data-binding "ip_cnt"
                set legend "IP"
                set data-type calculated
                set data-calc-func sum
                set column-graph-type bar
            next
            edit 5
                set data-binding "ep_count"
                set data-type calculated
                set data-calc-func sum
                set column-attr count
            next
            edit 6
                set header "# of Users"
                set column-span 2
                set column-graph-type bar
                set data-binding "eu_count"
                set data-type aggregate
                set column-attr count
                set column-width 20
            next
            edit 7
                set header "# of Users"
                set data-binding "eu_count"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "ueba-Asset-User-Discovery-by-Time"
        set disp-name "Asset and User Count by Discovery Time"
        set category "Asset"
        set description "Asset and User Count by Discovery Time"
        set dataset "ueba-Asset-User-Discovery-by-Time"
        set chart-type line
        set chart-style "{\"size\":\"compact\", \"y-title\":\"# of Discovery\", \"legend-position\": \"top\"}"
        config table-columns
            edit 1
                set header "Time"
                set data-binding "time"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "ep_count"
                set column-graph-type line-up
                set legend "Endpoint"
            next
            edit 3
                set data-binding "eu_count"
                set column-graph-type line-up
                set legend "User"
            next
        end
        set protected enable
    next
    edit "dns-Security-Domain-Count-by-Threat-Level"
        set disp-name "Domain Count by Threat level"
        set description "Domain Count by Threat level"
        set category "DNS/Security"
        set dataset "dns-Security-Domain-Count-by-Threat-Level"
        set chart-type donut
        set chart-style "{\"inner-content\": \"summary\", \"show-header\": \"enable\", \"show-value\": \"enable\", \"ioc-license-check\":\"enable\"}"
        config table-columns
            edit 1
                set header ""
                set data-binding "threat_level"
                set data-top 10
            next
            edit 2
                set header " "
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "dns-Top-Queried-Domain-Bar"
        set disp-name "Top Queried Domain bar"
        set description "Top Queried Domain bar"
        set category "DNS/Security"
        set dataset "dns-Top-Queried-Domain"
        set chart-type bar
        set chart-style "{\"y-title\": \"Visits\", \"fixed-bar-width\": \"6\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "Queried Domain"
                set data-binding "qname"
                set data-top 10
            next
            edit 2
                set header "Visits"
                set data-type aggregate
                set data-binding "total_num"
            next
        end
        set protected enable
    next
    edit "dns-Security-Top-Visited-Domain-Categories"
        set disp-name "Top Visited Domain Categories"
        set description "Top Visited Domain Categories"
        set category "DNS/Security"
        set dataset "dns-Security-Top-Visited-Domain-Categories"
        set chart-type bar
        set chart-style "{\"y-title\": \"Visits\", \"x-label\": \"wrapping\", \"fixed-bar-width\": \"6\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "Category"
                set data-binding "catdesc"
                set data-top 10
            next
            edit 2
                set header "Visits"
                set data-type aggregate
                set data-binding "total_num"
            next
        end
        set protected enable
    next
    edit "dns-Security-Top-Visited-High-Risk-Domain-Categories"
        set disp-name "Top Visited High Risk Domain Categories"
        set category "DNS/Security"
        set description "Top Visited High Risk Domain Categories"
        set dataset "dns-Security-Top-Visited-High-Risk-Domain-Categories"
        set chart-type donut
        set include-other disable
        set chart-style "{\"inner-content\": \"summary\", \"show-header\": \"enable\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "catdesc"
            next
            edit 2
                set header " "
                set data-type aggregate
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "dns-Security-Top-Domain-with-Botnet-CC-Detected"
        set disp-name "Top Domain with Botnet Command-and-Control Detected"
        set category "DNS/Security"
        set description "Top Domain with Botnet C&C Detected"
        set dataset "dns-Security-Top-Domain-with-Botnet-CC-Detected"
        set chart-type donut
        set include-other disable
        set chart-style "{\"inner-content\": \"summary\", \"show-header\": \"enable\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "qname"
            next
            edit 2
                set header " "
                set data-type aggregate
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "dns-Security-FortiGate-with-Top-Domain-Visited-by_Source-IP"
        set disp-name "FortiGate with Top Domain Visited by Source IP"
        set category "DNS/Security"
        set description "FortiGate with Top Domain Visited by Source IP"
        set dataset "dns-Security-FortiGate-with-Top-Domain-Visited-by_Source-IP"
        set chart-type table
        set include-other enable
        config table-columns
            edit 1
                set header "Device Name"
                set data-binding "devname"
                set data-top 15
                set column-width 20
            next
            edit 2
                set header "Source IP"
                set data-binding "srcip"
                set data-top 10
                set data-type drilldown
                set column-width 15
            next
            edit 3
                set header "Domain"
                set data-binding "qname"
                set data-type drilldown
                set data-top 10
                set column-width 25
            next
            edit 4
                set header "Category"
                set data-binding "category"
                set data-type calculated
                set data-calc-func max
                set column-width 20
            next
            edit 5
                set header "Visits"
                set data-binding "total_num"
                set column-graph-type bar
                set column-span 2
                set data-type aggregate
                set column-attr none
                set column-width 20
            next
            edit 6
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "dns-Security-Top-Domain-Lookup-Failure-by-Count"
        set disp-name "Top Domain Lookup Failures by Count"
        set description "Top Domain Lookup Failures by Count"
        set category "DNS/Security"
        set dataset "dns-Security-Top-Domain-Lookup-Failure-by-Count"
        set chart-type bar
        set chart-style "{\"y-title\": \"Visits\", \"fixed-bar-width\": \"6\"}"
        set include-other enable
        config table-columns
            edit 1
                set header "Domain"
                set data-binding "qname"
                set data-top 10
            next
            edit 2
                set header "Visits"
                set data-type aggregate
                set data-binding "total_num"
            next
        end
        set protected enable
    next
    edit "dns-Security-Top-Source-IP-by-Destination-Count"
        set disp-name "Top Source IP by Destination Count"
        set description "Top Source IP by Destination Count"
        set category "DNS/Security"
        set dataset "dns-Security-Top-Source-IP-by-Destination-Count"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\", \"bar-size\": \"small\"}"
        set include-other disable
        config table-columns
            edit 1
                set header ""
                set data-binding "srcip"
                set data-top 10
            next
            edit 2
                set header ""
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "dns-Security-Top-Destination-IP-by-Source-Count"
        set disp-name "Top Destination IP by Source Count"
        set description "Top Destination IP by Source Count"
        set category "DNS/Security"
        set dataset "dns-Security-Top-Destination-IP-by-Source-Count"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\", \"bar-size\": \"small\"}"
        set include-other disable
        config table-columns
            edit 1
                set header ""
                set data-binding "dstip"
                set data-top 10
            next
            edit 2
                set header ""
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "dns-Security-Severity-by-High-Risk-Source-IPs-Count"
        set disp-name "Severity by High Risk Source IPs Count"
        set description "Severity by High Risk Source IPs Count"
        set category "DNS/Security"
        set dataset "dns-Security-Severity-by-High-Risk-Source-IPs-Count"
        set chart-type donut
        set include-other disable
        set chart-style "{\"inner-content\": \"summary\", \"show-header\": \"enable\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set header ""
                set data-binding "severity"
                set data-top 5
            next
            edit 2
                set header " "
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "dns-Security-Top-DNS-High-Risk-Source-IP"
        set disp-name "Top DNS High Risk Source IP"
        set category "DNS/Security"
        set description "Top DNS High Risk Source IP"
        set dataset "dns-Security-Top-DNS-High-Risk-Source-IP"
        set chart-type table
        config table-columns
            edit 1
                set header "Source IP"
                set data-binding "srcip"
                set data-top 20
                set column-width 20
            next
            edit 2
                set header "Critical"
                set data-binding "num_cri"
                set column-span 2
                set column-graph-type bar
                set column-width 20
                set column-style "{\"color\": \"#EC3E3F\"}"
            next
            edit 3
                set data-binding "num_cri"
                set column-attr count
            next
            edit 4
                set header "High"
                set data-binding "num_hig"
                set column-span 2
                set column-graph-type bar
                set column-width 20
                set column-style "{\"color\": \"#F79B2B\"}"
            next
            edit 5
                set data-binding "num_hig"
                set column-attr count
            next
            edit 6
                set header "Medium"
                set data-binding "num_med"
                set column-span 2
                set column-graph-type bar
                set column-width 20
                set column-style "{\"color\": \"#F5D800\"}"
            next
            edit 7
                set data-binding "num_med"
                set column-attr count
            next
            edit 8
                set header "Total"
                set data-binding "total_num"
                set column-span 2
                set column-graph-type bar
                set column-width 20
            next
            edit 9
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "dns-Security-Top-Infected-Domain-by-Count"
        set disp-name "Top Infected Domain by Count"
        set description "Top Infected Domain by Count"
        set category "DNS/Security"
        set dataset "dns-Security-Top-Infected-Domain-by-Count"
        set chart-type bar
        set chart-style "{\"y-title\": \"Count\", \"fixed-bar-width\": \"6\", \"ioc-license-check\":\"enable\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "Domain"
                set data-binding "qname"
                set data-top 10
            next
            edit 2
                set header "Count"
                set data-type aggregate
                set data-binding "total_num"
            next
        end
        set protected enable
    next
    edit "dns-Security-Top-Blocked-Domains-by-Reason"
        set disp-name "Top Blocked Domains by Reason"
        set category "DNS/Security"
        set description "Top Blocked Domains by Reason"
        set dataset "dns-Security-Top-Blocked-Domains-by-Reason"
        set chart-type table
        config table-columns
            edit 1
                set header "Domain"
                set data-binding "qname"
                set data-top 30
                set column-width 25
            next
            edit 2
                set header "Message"
                set data-binding "msg"
                set column-width 75
            next
        end
        set protected enable
    next
    edit "dns-Security-Top-Users-by-Infected-Domain-Visits"
        set disp-name "Top Users by Infected Domain Visits"
        set description "Top Users by Infected Domain Visits"
        set category "DNS/Security"
        set dataset "dns-Security-Top-Users-by-Infected-Domain-Visits"
        set chart-type donut
        set include-other disable
        set chart-style "{\"inner-content\": \"summary\", \"show-header\": \"enable\", \"show-value\": \"enable\", \"ioc-license-check\": \"enable\"}"
        config table-columns
            edit 1
                set header ""
                set data-binding "user_src"
                set data-top 10
            next
            edit 2
                set header " "
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "dns-Security-Top-Users-and-Infected-Domain-by-Visit-Count"
        set disp-name "Top Users and Infected Domain by Visit Count"
        set category "DNS/Security"
        set description "Top Users and Infected Domain by Visit Count"
        set dataset "dns-Security-Top-Users-and-Infected-Domain-by-Visit-Count"
        set chart-type table
        set chart-style "{\"ioc-license-check\": \"enable\"}"
        config table-columns
            edit 1
                set header "User"
                set data-binding "user_src"
                set data-top 20
                set column-width 30
            next
            edit 2
                set header "Domain"
                set data-binding "qname"
                set column-width 70
            next
        end
        set protected enable
    next
    edit "dns-Security-Top-Users-by-Visited-Domain-Category-Count"
        set disp-name "Top Users by Visited Domain Category Count"
        set description "Top Users by Visited Domain Category Count"
        set category "DNS/Security"
        set dataset "dns-Security-Top-Users-by-Visited-Domain-Category-Count"
        set chart-type donut
        set include-other disable
        set chart-style "{\"inner-content\": \"summary\", \"show-header\": \"enable\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set header ""
                set data-binding "user_src"
                set column-attr user
                set data-top 10
            next
            edit 2
                set header " "
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "dns-Security-Top-Users-and-Visited-Domain-Category-by-Count"
        set disp-name "Top Users and Visited Domain Category by Count"
        set category "DNS/Security"
        set description "Top Users and Visited Domain Category by Count"
        set dataset "dns-Security-Top-Users-and-Visited-Domain-Category-by-Count"
        set chart-type table
        config table-columns
            edit 1
                set header "User"
                set column-attr user
                set data-binding "user_src"
                set data-top 20
            next
            edit 2
                set header "Category"
                set data-binding "catdesc"
            next
            edit 3
                set header "Source IP"
                set data-binding "srcip"
            next
        end
        set protected enable
    next

    edit "dns-Security-Top-Newly-Detected-Domain-by-Count"
        set disp-name "Top Newly Detected Domain by Count"
        set description "Top Newly Detected Domain by Count"
        set category "DNS/Security"
        set dataset "dns-Security-Top-Newly-Detected-Domain-by-Count"
        set chart-type donut
        set include-other disable
        set chart-style "{\"inner-content\": \"summary\", \"show-header\": \"enable\", \"show-value\": \"enable\", \"ioc-license-check\": \"enable\"}"
        config table-columns
            edit 1
                set header "Domain"
                set data-binding "qname"
                set data-top 10
            next
            edit 2
                set header " "
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "dns-Security-Top-Newly-Detected-Domain-and-Source-IP-with-First-Seen-and-Last-Seen"
        set disp-name "Top Newly Detected Domain and Source IP with First Seen and Last Seen"
        set category "DNS/Security"
        set description "Top Newly Detected Domain and Source IP with First Seen and Last Seen"
        set dataset "dns-Security-Top-Newly-Detected-Domain-and-Source-IP-with-First-Seen-and-Last-Seen"
        set chart-type table
        set chart-style "{\"ioc-license-check\": \"enable\"}"
        config table-columns
            edit 1
                set header "Domain"
                set data-binding "qname"
                set data-top 20
                set column-width 25
            next
            edit 2
                set header "Source IP"
                set data-binding "srcip"
                set column-width 25
            next
            edit 3
                set header "First Seen"
                set data-binding "first_seen"
                set column-width 25
            next
            edit 4
                set header "Last Seen"
                set data-binding "last_seen"
                set column-width 25
            next
        end
        set protected enable
    next
    edit "web-Usage-Top-User-Category-By-Count"
        set disp-name "Top Web User and Category by Count"
        set category "Web"
        set description "Top Web User and Category by Count"
        set dataset "web-Usage-Top-User-Category-By-Count"
        set chart-type bubble-ring
        set chart-style "{\"show-value\":\"enable\" }"
        set include-other disable
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set data-top 10
            next
            edit 2
                set header "Category"
                set data-type drilldown
                set data-binding "catdesc"
                set data-top 5
            next
            edit 3
                set data-binding "requests"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "web-Usage-Top-User-Category-by-Browsing-Time"
        set disp-name "Web Usage Top User and Category by Browsing Time"
        set category "Web"
        set description "Web Usage Top User and Category by Browsing Time"
        set dataset "web-Usage-Top-User-Category-by-Browsing-Time"
        set chart-type bubble-ring
        set include-other disable
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set data-top 10
            next
            edit 2
                set header "Category"
                set data-type drilldown
                set data-binding "catdesc"
                set data-top 5
            next
            edit 3
                set data-binding "browsetime"
                set data-type aggregate
                set column-attr timespan
            next
        end
        set protected enable
    next
    edit "web-Usage-Count-By-Allowed-Blocked"
        set disp-name "Web Usage Allowed and Blocked Count"
        set description "Web Usage Allowed and Blocked Count"
        set category "Web"
        set dataset "web-Usage-Count-By-Allowed-Blocked"
        set chart-type donut
        set chart-style "{\"legend-position\":\"right\", \"inner-content\":\"summary\", \"show-header\": \"enable\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "Type"
                set data-binding "allow_block"
                set data-top 10
            next
            edit 2
                set header "Requests"
                set data-binding "totoal_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "web-Usage-Top-Web-Users-By-Allowed-Requests"
        set disp-name "Web Usage Top Web Users by Allowed Requests"
        set description "Web Usage Top Web Users by Allowed Requests"
        set category "Web"
        set dataset "web-Usage-Top-Web-Users-By-Allowed-Requests"
        set chart-type donut
        set chart-style "{\"legend-format\":\"${pct} ${name} (${val})\", \"legend-position\":\"right\", \"inner-content\":\"summary\", \"show-header\": \"enable\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "User"
                set data-binding "user_src"
                set data-top 10
            next
            edit 2
                set header "Requests"
                set data-binding "requests"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "web-Usage-Top-Web-Users-By-Blocked-Requests"
        set disp-name "Web Usage Top Web Users by Blocked Requests"
        set description "Web Usage Top Web Users by Blocked Requests"
        set category "Web"
        set dataset "web-Usage-Top-Web-Users-By-Blocked-Requests"
        set chart-type donut
        set chart-style "{\"legend-format\":\"${pct} ${name} (${val})\", \"legend-position\":\"right\", \"inner-content\":\"summary\", \"show-header\": \"enable\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "User"
                set data-binding "user_src"
                set data-top 10
            next
            edit 2
                set header "Requests"
                set data-binding "requests"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "web-Usage-Request-Summary-Timeline"
        set disp-name "Web Usage Request Summary Timeline"
        set category "Web"
        set description "Web Usage Request Summary Timeline"
        set dataset "webfilter-Web-Activity-Summary-By-Requests"
        set chart-type line
        set chart-style "{\"legend-position\":\"top\", \"y-title\":\"Request Count\"}"
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "allowed_request"
                set column-graph-type line-up
                set legend "Allowed Request"
            next
            edit 3
                set data-binding "blocked_request"
                set column-graph-type line-up
                set legend "Blocked Request"
            next
        end
        set protected enable
    next
    edit "web-Usage-Bandwidth-Timeline"
        set disp-name "Web Usage Bandwidth Timeline"
        set category "web"
        set description "Web Usage Bandwidth Timeline"
        set dataset "web-Usage-Bandwidth-Timeline"
        set chart-type area
        set chart-style "{\"legend-position\":\"top\", \"y-up-title\":\"Sent\", \"y-down-title\":\"Received\"}"
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "traffic_out"
                set column-graph-type line-up
                set column-attr bandwidth
            next
            edit 3
                set data-binding "traffic_in"
                set column-graph-type line-down
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "web-Usage-Top-Web-Users-By-Requests"
        set disp-name "Web Usage Top Web Users by Requests"
        set description "Web Usage Top Web Users by Requests"
        set category "Web"
        set dataset "web-Usage-Top-Web-Users-By-Requests"
        set chart-type donut
        set chart-style "{\"legend-format\":\"${pct} ${name} (${val})\", \"legend-position\":\"right\", \"inner-content\":\"summary\", \"show-header\": \"enable\", \"legend-columns\":\"2\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "User"
                set data-binding "user_src"
                set data-top 10
            next
            edit 2
                set header "Requests"
                set data-binding "requests"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "web-Usage-Top-Web-Users-By-Requests-Timeline"
        set disp-name "Web Usage top Web Users by Requests Timeline"
        set category "web"
        set description "Web Usage top Web Users by Requests Timeline"
        set dataset "web-Usage-Top-Web-Users-By-Requests-Timeline"
        set chart-type line
        set chart-style "{\"legend-position\":\"top\", \"y-title\":\"Request Count\"}"
        config table-columns
            edit 1
                set header "Date"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "user_src"
                set column-attr none
                set data-top 10
                set data-type drilldown
            next
            edit 3
                set data-binding "requests"
                set column-attr count
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "web-Usage-Top-Category-Sites-By-Session"
        set disp-name "Top Web Category and Sites by Session"
        set category "Web"
        set description "Top Web Category and Sites by Session"
        set dataset "web-Top-User-Visted-Websites-by-Session"
        set chart-type bubble-ring
        set chart-style "{\"show-value\":\"enable\" }"
        set include-other disable
        config table-columns
            edit 1
                set header "Categories"
                set data-binding "catdesc"
                set data-top 10
            next
            edit 2
                set header "Website"
                set data-type drilldown
                set data-binding "website"
                set data-top 5
            next
            edit 3
                set data-binding "sessions"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "web-Usage-Top-User-Browsing-Time"
        set disp-name "Web Usage Top User Browsing Time"
        set category "web"
        set description "Web Usage Top User Browsing Time"
        set dataset "web-Usage-Top-User-Browsing-Time"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\", \"height\":\"440\", \"bar-color\": \"bubble-ring\" }"
        config table-columns
            edit 1
                set header "User"
                set data-binding "user_src"
                set data-top 10
            next
            edit 2
                set header "Browsing Time"
                set data-binding "browsetime"
                set column-attr timespan
            next
        end
        set protected enable
    next
    edit "web-Usage-Top-Category-By-Website-Browsetime"
        set disp-name "Top Category By Website Browsetime"
        set description "Top Category By Website Browsetime"
        set category "Web"
        set dataset "web-Usage-Top-Category-By-Website-Browsetime"
        set chart-type donut
        set chart-style "{\"legend-position\":\"right\", \"inner-content\":\"summary\", \"show-header\": \"enable\", \"legend-columns\":\"2\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "Categories"
                set data-binding "catdesc"
                set data-top 10
            next
            edit 2
                set header "Browsing Time"
                set data-binding "browsetime"
                set data-type aggregate
                set column-attr timespan
            next
        end
        set protected enable
    next
    edit "web-Usage-Top-Sites-By-Browsing-Time"
        set disp-name "Web Usage Top Websites by Browsing Time"
        set category "Web"
        set description "Web Usage Top Websites by Browsing Time"
        set dataset "web-Usage-Top-Sites-By-Browsing-Time"
        set chart-type table
        set chart-style "{\"table-scheme\":\"dark\"}"
        config table-columns
            edit 1
                set header "Sites"
                set data-binding "website"
                set data-top 20
                set column-width 30
            next
            edit 2
                set header "Category"
                set data-binding "catdesc"
                set column-attr web-cat
                set column-width 30
            next
            edit 3
                set header "Browsing Time (hh:mm:ss)"
                set data-binding "browsetime"
                set column-attr timespan
                set column-style "{\"align\":\"left\",\"width\":24}"
                set column-span 2
                set column-width 40
            next
            edit 4
                set data-binding "browsetime"
                set column-graph-type bar
                set column-style "{\"width\":74}"
            next
        end
        set protected enable
    next
    edit "web-Usage-Top-User-By-Bandwidth"
        set disp-name "Web Usage Top User By Bandwidth"
        set description "Web Usage Top User By Bandwidth"
        set category "Web"
        set dataset "web-Usage-Top-User-By-Bandwidth"
        set chart-type donut
        set chart-style "{\"legend-position\":\"right\", \"inner-content\":\"summary-value\", \"legend-columns\":\"2\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "User"
                set data-binding "user_src"
                set data-top 10
            next
            edit 2
                set header "Bytes"
                set data-binding "bandwidth"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "web-Usage-Top-User-By-Bandwidth-Timeline"
        set disp-name "Web Usage Top User By Bandwidth Timeline"
        set category "web"
        set description "Web Usage Top User By Bandwidth Timeline"
        set dataset "web-Usage-Top-User-By-Bandwidth-Timeline"
        set chart-type area
        set chart-style "{\"legend-position\":\"top\", \"y-title\":\"Traffic\"}"
        config table-columns
            edit 1
                set header "Date"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "user_src"
                set column-attr none
                set data-top 10
                set data-type drilldown
            next
            edit 3
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "web-Usage-Top-Category-Website-By-Bandwidth"
        set disp-name "Web Usage Top Web Category and Websites by Bandwidth"
        set category "Web"
        set description "Web Usage Top Web Category and Websites by Bandwidth"
        set dataset "web-Usage-Top-Category-and-Websites-by-Bandwidth"
        set chart-type bubble-ring
        set chart-style "{\"show-value\":\"enable\" }"
        set include-other disable
        config table-columns
            edit 1
                set header "Category"
                set data-binding "catdesc"
                set data-top 10
            next
            edit 2
                set header "Website"
                set data-type drilldown
                set data-binding "website"
                set data-top 5
            next
            edit 3
                set data-binding "bandwidth"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "web-Usage-Top-Blocked-User-Category-By-Request"
        set disp-name "Web Usage Top Blocked Web User and Category by Request"
        set category "web"
        set description "Web Usage Top Blocked Web User and Category by Request"
        set dataset "web-Usage-Top-Blocked-User-Category-By-Request"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\", \"show-header\": \"enable\", \"legend-position\":\"top\", \"height\":\"360\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "User"
                set data-binding "user_src"
                set data-top 5
            next
            edit 2
                set header "Category"
                set data-binding "catdesc"
                set data-type drilldown
                set data-top 3
            next
            edit 3
                set header "Requests"
                set data-binding "requests"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "web-Usage-Top-Web-Users-By-Blocked-Requests-Timeline"
        set disp-name "Web Usage Top Web Users Timeline by Blocked Requests"
        set category "web"
        set description "Web Usage Top Web Users Timeline by Blocked Requests"
        set dataset "web-Usage-Top-Web-Users-By-Blocked-Requests-Timeline"
        set chart-type line
        set chart-style "{\"legend-position\":\"top\", \"y-title\":\"Blocked Request Count\"}"
        config table-columns
            edit 1
                set header "Date"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "user_src"
                set column-attr none
                set data-top 5
                set data-type drilldown
            next
            edit 3
                set data-binding "requests"
                set column-attr count
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "web-Usage-Top-Blocked-Web-Categories-by-Request"
        set disp-name "Web Usage Top Blocked Web Categories by Request"
        set category "Web"
        set description "Web Usage Top Blocked Web Categories by Request"
        set dataset "web-Usage-Top-Blocked-Web-Categories-by-Request"
        set chart-type table
        set chart-style "{\"table-scheme\":\"dark\", \"show-sum-0\": \"enable\", \"show-total\": \"disable\", \"show-others\": \"disable\", \"show-percent\": \"disable\"}"
        config table-columns
            edit 1
                set header "Category"
                set data-binding "catdesc"
                set column-attr web-cat
                set data-top 3
                set column-width 30
            next
            edit 2
                set header "Sites"
                set data-binding "hostname"
                set data-type drilldown
                set data-top 5
                set column-width 30
            next
            edit 3
                set header "Requests"
                set data-binding "requests"
                set data-type aggregate
                set column-attr count
                set column-style "{\"align\":\"left\",\"width\":24}"
                set column-span 2
                set column-width 40
            next
            edit 4
                set data-binding "requests"
                set column-graph-type bar
                set column-style "{\"width\":74}"
                set column-attr none
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "web-Usage-Browsing-Time-Summary-Timeline"
        set disp-name "Web Usage Browsing Time Summary Timeline"
        set category "Web"
        set description "Estimated browsing time by HTTP/HTTPs duration of traffic session"
        set dataset "traffic-Browsing-Time-Summary"
        set chart-type line
        set chart-style "{\"y-title\":\"Browsing Time (Min)\"}"
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "browsetime"
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "360-security-Rating-Asset-Endpoint-HWOS-Count"
        set disp-name "Asset Endpoint Count by OS"
        set category "Asset"
        set description "Asset Endpoint Count by OS"
        set dataset "360-security-Rating-Asset-Endpoint-HWOS-Count"
        set chart-type donut
        set chart-style "{\"inner-content\":\"summary\", \"show-header\": \"enable\"}"
        config table-columns
            edit 1
                set header "OS"
                set data-binding "osname"
                set data-top 7
                set column-width 50
            next
            edit 2
                set header "Total endpoints"
                set data-binding "count"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "360-security-daily-Summary-Traffic-Session-Line"
        set disp-name "360 Security Daily Summary Top Traffic Session Line"
        set category "Network Usage"
        set description "360 Security Daily Summary Top Traffic Session Line"
        set dataset "daily-Summary-Traffic-Bandwidth-Line"
        set chart-type line
        set chart-style "{\"size\":\"compact\", \"y-title\":\"Session\", \"legend-position\":\"top\"}"
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "time"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "session_block"
                set column-graph-type line-up
                set column-attr bandwidth
                set legend "Block"
            next
            edit 3
                set data-binding "session_pass"
                set column-graph-type line-up
                set column-attr bandwidth
                set legend "Pass"
            next
        end
        set protected enable
    next
    edit "360-security-wifi-WiFi-Client-Number-Timeline"
        set disp-name "360 Security Daily Summary WiFi Client Number Line"
        set category "WiFi"
        set description "360 Security Daily Summary WiFi Client Number Line"
        set dataset "wifi-WiFi-Client-Number-Timeline"
        set chart-type area
        set chart-style "{\"x-label\": \"flat\", \"y-title\":\"Client Count\", \"legend-position\":\"top\"}"
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "g5"
                set column-graph-type line-up
                set column-attr count
                set legend "5G Band"
            next
            edit 3
                set data-binding "g2"
                set column-graph-type line-up
                set column-attr count
                set legend "2.4G Band"
            next
        end
        set protected enable
    next
    edit "360-security-ueba-Asset-Count-by-HWOS-Donut"
        set disp-name "360 Security Asset Count by Hardware OS Donut"
        set description "360 Security Asset Count by Hardware OS Donut"
        set dataset "ueba-Asset-Count-by-HWOS"
        set category "Asset"
        set include-other disable
        set chart-type donut
        set chart-style "{\"inner-content\":\"summary\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "osname"
                set data-top 6
            next
            edit 2
                set data-type aggregate
                set data-binding "count"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "360-security-Rating-Posture-Stats-Status-Count"
        set disp-name "Posture Security Rating Statistic Status Count"
        set description "Posture Security Rating Statistic Status Count"
        set dataset "360-security-Rating-Posture-Stats-Status-Count"
        set category "Rating"
        set include-other disable
        set chart-type donut
        set chart-style "{\"size\": \"medium\", \"legend-format\":\"${pct} ${name} (${val})\", \"legend-width\": \"120\", \"legend-font-size\": \"10px\", \"inner-content\":\"summary\", \"show-header\": \"enable\", \"colormap\": {\"Failed\": \"#D43527\", \"Passed\": \"#499258\", \"Unmet\": \"#F3BB2D\", \"Exempt\": \"#186093\"} }"
        config table-columns
            edit 1
                set data-binding "stats"
                set data-top 4
            next
            edit 2
                set header "Total"
                set data-type aggregate
                set data-binding "value"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "360-security-Rating-Coverage-Stats-Status-Count"
        set disp-name "Coverage Security Rating Statistic Status Count"
        set description "Coverage Security Rating Statistic Status Count"
        set dataset "360-security-Rating-Coverage-Stats-Status-Count"
        set category "Rating"
        set include-other disable
        set chart-type donut
        set chart-style "{\"size\": \"medium\",\"legend-format\":\"${pct} ${name} (${val})\",  \"legend-width\": \"120\", \"legend-font-size\": \"10px\", \"inner-content\":\"summary\", \"show-header\": \"enable\", \"colormap\": {\"Failed\": \"#D43527\", \"Passed\": \"#499258\", \"Unmet\": \"#F3BB2D\", \"Exempt\": \"#186093\"} }"
        config table-columns
            edit 1
                set data-binding "stats"
                set data-top 4
            next
            edit 2
                set header "Total"
                set data-type aggregate
                set data-binding "value"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "360-security-Rating-Optimize-Stats-Status-Count"
        set disp-name "Optimization Security Rating Statistic Status Count"
        set description "Optimization Security Rating Statistic Status Count"
        set dataset "360-security-Rating-Optimize-Stats-Status-Count"
        set category "Rating"
        set include-other disable
        set chart-type donut
        set chart-style "{\"size\": \"medium\", \"legend-format\":\"${pct} ${name} (${val})\", \"legend-width\": \"120\", \"legend-font-size\": \"10px\", \"inner-content\":\"summary\", \"show-header\": \"enable\", \"colormap\": {\"Failed\": \"#D43527\", \"Passed\": \"#499258\", \"Unmet\": \"#F3BB2D\", \"Exempt\": \"#186093\"} }"
        config table-columns
            edit 1
                set data-binding "stats"
                set data-top 4
            next
            edit 2
                set header "Total"
                set data-type aggregate
                set data-binding "value"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "360-security-Rating-Asset-Count-by-HWVendor"
        set disp-name "Asset Count by Hardware Vendor"
        set description "Asset Count by Hardware Vendor"
        set dataset "360-security-Rating-Asset-Count-by-HWVendor"
        set category "Asset"
        set include-other enable
        set chart-type donut
        set chart-style "{\"inner-content\":\"summary\", \"show-header\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "vendor"
                set data-top 10
            next
            edit 2
                set header "Devices"
                set data-type aggregate
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "360-security-Rating-Asset-Count-by-HWOS-List"
        set disp-name "Asset Count by Hardware OS List"
        set description "Asset Count by Hardware OS List"
        set dataset "360-security-Rating-Asset-Count-by-HWOS-List"
        set category "Asset"
        set include-other enable
        set chart-type donut
        set chart-style "{\"inner-content\":\"summary\", \"show-header\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "osname"
                set data-top 10
            next
            edit 2
            set header "Count"
                set data-type aggregate
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "360-security-Rating-Asset-Count-by-Interface"
        set disp-name "Asset Count by Interface"
        set description "Asset Count by Interface"
        set dataset "360-security-Rating-Asset-Count-by-Interface"
        set category "Asset"
        set include-other enable
        set chart-type donut
        set chart-style "{\"inner-content\":\"summary\", \"show-header\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "srcintf"
                set data-top 10
            next
            edit 2
                set header "Count"
                set data-type aggregate
                set data-binding "count"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "360-security-Rating-Asset-List-From-Fortinet"
        set disp-name "Asset List from Fortinet"
        set category "Asset"
        set description "Asset List from Fortinet"
        set dataset "360-security-Rating-Asset-List-From-Fortinet"
        set chart-type table
        set chart-style "{\"table-scheme\":\"dark\"}"
        config table-columns
            edit 1
                set header "Device"
                set data-binding "devtype"
                set column-span 2
                set column-attr dev-type
                set data-top 10
                set column-width 20
            next
            edit 2
                set header "Device"
                set data-binding "ep_name"
                set data-top 10
            next
            edit 3
                set header "Address"
                set data-binding "addr"
                set column-width 30
            next
            edit 4
                set header "Software OS"
                set data-binding "osname"
                set column-width 20
            next
            edit 5
                set header "Device Family"
                set data-binding "hwfamily"
                set column-width 15
            next
            edit 6
                set header "Hardware Version"
                set data-binding "hwversion"
                set column-width 15
            next
        end
        set protected enable
    next
    edit "360-security-Rating-Asset-List-From-Other-Identified-Device"
        set disp-name "Asset List from Other Identified Device"
        set category "Asset"
        set description "Asset List from Other Identified Device"
        set dataset "360-security-Rating-Asset-List-From-Other-Identified-Device"
        set chart-type table
        set chart-style "{\"table-scheme\":\"dark\"}"
        config table-columns
            edit 1
                set header "Device"
                set data-binding "devtype"
                set column-span 2
                set column-attr dev-type
                set data-top 15
                set column-width 20
            next
            edit 2
                set header "Device"
                set data-binding "ep_name"
                set data-top 15
            next
            edit 3
                set header "Address"
                set data-binding "addr"
                set column-width 30
            next
            edit 4
                set header "Software OS"
                set data-binding "osname"
                set column-width 20
            next
            edit 5
                set header "Device Family"
                set data-binding "hwfamily"
                set column-width 15
            next
            edit 6
                set header "Hardware Version"
                set data-binding "hwversion"
                set column-width 15
            next
        end
        set protected enable
    next
    edit "360-security-wifi-AP-WaitingAuth-Online-Offline-Count"
        set disp-name "WiFi AP count by Waiting Auth Online and Offline Status"
        set category "Network Usage"
        set description "WiFi AP count by Waiting Auth Online and Offline Status"
        set dataset "360-security-wifi-AP-WaitingAuth-Online-Offline-Count"
        set chart-type donut
        set chart-style "{\"inner-content\":\"summary\", \"show-header\": \"enable\", \"colormap\": {\"Offline\": \"#EC3E3F\", \"Online\": \"#5CBC49\"} }"
        config table-columns
            edit 1
                set header "AP Status"
                set data-binding "ap_status"
                set data-top 10
            next
            edit 2
                set header "FortiAPs"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
     next
    edit "360-security-wifi-Top-AP-By-Client"
        set disp-name "WiFi Top Access Point by Client"
        set category "Network Usage"
        set description "WiFi Top Access Point by Client"
        set dataset "360-security-wifi-Top-AP-By-Client"
        set chart-type donut
        set chart-style "{\"inner-content\":\"summary\", \"show-header\": \"enable\"}"
        config table-columns
            edit 1
                set header "AP Name"
                set data-binding "ap"
                set data-top 10
            next
            edit 2
                set header "Radios"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
     next
    edit "360-security-wifi-Signal-By-Client"
        set disp-name "WiFi Signal by Client"
        set category "Network Usage"
        set description "WiFi Signal by Client"
        set dataset "360-security-wifi-Signal-By-Client"
        set chart-type donut
        set chart-style "{\"inner-content\":\"summary\", \"show-header\": \"enable\"}"
        config table-columns
            edit 1
                set header "Signal"
                set data-binding "sig_status"
                set data-top 10
            next
            edit 2
                set header "Clients"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
     next
    edit "360-security-wifi-Auth-Failure-Event"
        set disp-name "WiFi Authentication Failure Event"
        set category "Network Usage"
        set description "WiFi Authentication Failure Event"
        set dataset "360-security-wifi-Auth-Failure-Event"
        set chart-type table
        set chart-style "{\"table-scheme\":\"dark\"}"
        config table-columns
            edit 1
                set header "Time"
                set data-binding "last"
                set data-top 10
                set column-width 50
            next
            edit 2
                set header "SSID"
                set data-binding "ssid"
                set column-width 50
            next
        end
        set protected enable
    next
    edit "360-security-Top-Policy-Bandwidth-Timeline"
        set disp-name "Top Policy Bandwidth Timeline"
        set category "Security"
        set description "Top Policy Bandwidth Timeline"
        set dataset "360-security-Top-Policy-Bandwidth-Timeline"
        set chart-type line
        set chart-style "{\"legend-position\":\"top\", \"y-title\": \"Traffic\"}"
        config table-columns
            edit 1
                set header "Time"
                set data-binding "timestamp"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "policy"
                set column-attr none
                set data-type drilldown
                set data-top 10
            next
            edit 3
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "360-security-Policy-by-Bandwidth"
        set disp-name "Top Policy by Bandwidth"
        set category "Security"
        set description "Top Policy by Bandwidth"
        set dataset "360-security-Policy-by-Bandwidth"
        set chart-type donut
        set include-other disable
        set chart-style "{\"legend-format\":\"${name} (${val})\", \"legend-position\":\"right\", \"inner-content\":\"summary\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set header "Policy"
                set data-binding "policy"
                set data-top 10
            next
            edit 2
                set header "Bytes"
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
     next
    edit "360-security-Policy-by-Session"
        set disp-name "Top Policy by Session"
        set category "Security"
        set description "Top Policy by Session"
        set dataset "360-security-Policy-by-Session"
        set chart-type donut
        set include-other disable
        set chart-style "{\"legend-format\":\"${name} (${val})\", \"legend-position\":\"right\", \"inner-content\":\"summary\", \"show-value\": \"enable\", \"show-header\": \"enable\"}"
        config table-columns
            edit 1
                set header "Policy"
                set data-binding "policy"
                set data-top 10
            next
            edit 2
                set header "Sessions"
                set data-type aggregate
                set data-binding "sessions"
                set column-attr count
            next
        end
        set protected enable
     next
    edit "360-security-Policy-Details"
        set disp-name "Top Policy with Details by Bandwidth"
        set category "Security"
        set description "Top Policy with Details by Bandwidth"
        set dataset "360-security-Policy-Details"
        set chart-type table
        set chart-style "{\"table-scheme\": \"dark\"}"
        config table-columns
            edit 1
                set header "Policy"
                set data-binding "policy"
                set data-top 10
                set column-width 10
            next
            edit 2
                set header "Policy Type"
                set data-binding "policytype"
                set column-width 7
            next
            edit 3
                set header "Source Interface"
                set data-binding "srcintf"
                set column-style "{\"max-text-length\":256}"
                set column-width 20
            next
            edit 4
                set header "Destination Interface"
                set data-binding "dstintf"
                set column-style "{\"max-text-length\":256}"
                set column-width 20
            next
            edit 5
                set header "Device Name"
                set data-binding "devname"
                set column-width 10
            next
            edit 6
                set header "VDOM"
                set data-binding "vd"
                set column-width 7
            next
            edit 7
                set header "Sessions"
                set data-binding "sessions"
                set column-attr count
                set column-width 8
            next
            edit 8
                set header "Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-width 8
            next
            edit 9
                set header "Last Used"
                set data-binding "time_stamp"
                set column-width 10
            next
        end
        set protected enable
    next
    edit "360-security-Top-Source-Session-Timeline"
        set disp-name "Top Source Session Timeline"
        set category "Traffic"
        set description "Top Source Session Timeline"
        set dataset "360-security-Top-Source-Session-Timeline"
        set chart-type line
        set chart-style "{\"legend-position\":\"top\", \"y-title\": \"Session\"}"
        config table-columns
            edit 1
                set header "Time"
                set data-binding "timestamp"
                set column-attr time
                set data-top 0
            next
            edit 2
                set legend "Block"
                set data-binding "session_block"
                set column-attr count
                set column-graph-type line-up
            next
            edit 3
                set legend "Pass"
                set data-binding "session_pass"
                set column-attr count
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "360-security-Top-Source-Details"
        set disp-name "Top Source with Details by Bandwidth"
        set category "Traffic"
        set description "Top Source with Details by Bandwidth"
        set dataset "360-security-Top-Source-Details"
        set chart-type table
        set chart-style "{\"table-scheme\": \"dark\"}"
        config table-columns
            edit 1
                set header "Source"
                set data-binding "f_user"
                set data-top 10
                set column-width 20
            next
            edit 2
                set header "Source Interface"
                set data-binding "srcintf"
                set column-width 15
            next
            edit 3
                set header "Device"
                set data-binding "dev_src"
                set column-width 25
            next
            edit 4
                set header "Threat Score"
                set data-binding "threatweight"
                set column-attr count
                set column-width 10
            next
            edit 5
                set header "Sessions"
                set data-binding "sessions"
                set column-attr count
                set column-width 15
            next
            edit 6
                set header "Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-width 15
            next
        end
        set protected enable
    next

    edit "360-security-Top-Destination-Bandwidth-Timeline"
        set disp-name "Top Destination Bandwidth Timeline"
        set category "Traffic"
        set description "Top Destination Bandwidth Timeline"
        set dataset "360-security-Top-Destination-Bandwidth-Timeline"
        set chart-type line
        set chart-style "{\"legend-position\":\"top\", \"y-title\": \"Traffic\"}"
        config table-columns
            edit 1
                set header "Time"
                set data-binding "timestamp"
                set column-attr time
                set data-top 0
            next
            edit 2
                set legend "Received"
                set data-binding "traffic_in"
                set column-attr bandwidth
                set column-graph-type line-up
            next
            edit 3
                set legend "Sent"
                set data-binding "traffic_out"
                set column-attr bandwidth
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "360-security-Top-Destination-Details"
        set disp-name "Top Destination with Details by Bandwidth"
        set category "Traffic"
        set description "Top Destination with Details by Bandwidth"
        set dataset "360-security-Top-Destination-Details"
        set chart-type table
        set chart-style "{\"table-scheme\": \"dark\"}"
        config table-columns
            edit 1
                set header "Destination"
                set data-binding "dstip"
                set data-top 10
                set column-width 25
            next
            edit 2
                set header "Applications"
                set data-binding "app_num"
                set column-attr count
                set column-width 15
            next
            edit 3
                set header "Sessions"
                set data-binding "sessions"
                set column-attr count
                set column-span 2
                set column-style "{\"align\":\"left\",\"width\":25}"
                set column-width 30
            next
            edit 4
                set data-binding "sessions"
                set column-graph-type bar
                set column-style "{\"align\":\"left\",\"width\":75}"
            next
            edit 5
                set header "Bytes"
                set data-binding "bandwidth"
                set column-span 2
                set column-attr bandwidth
                set column-style "{\"align\":\"left\",\"width\":25}"
                set column-width 30
            next
            edit 6
                set data-binding "bandwidth"
                set column-graph-type bar
                set column-style "{\"align\":\"left\",\"width\":75}"
            next
        end
        set protected enable
    next
    edit "360-security-High-Risk-Application-By-Category"
        set disp-name "360 Security High Risk Application By Category"
        set category "Application"
        set description "360 Security High Risk Application By Category"
        set dataset "security-High-Risk-Application-By-Category"
        set chart-type donut
        set chart-style "{\"legend-position\": \"right\", \"inner-content\": \"summary-value\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set header "Category"
                set data-binding "app_cat"
                set data-top 10
            next
            edit 2
                set header "Count"
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "360-security-Apprisk-Ctrl-High-Risk-Application-Behavioral"
        set disp-name "360 Security Application Behavioral Characteristics"
        set category "Application"
        set description "360 Security Application Behavioral Characteristics"
        set dataset "apprisk-ctrl-High-Risk-Apps-Behavioral"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\", \"bar-size\": \"compact\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "Behavior"
                set data-binding "behavior"
                set data-top 5
            next
            edit 2
                set header "Percentage"
                set data-type aggregate
                set column-attr percent
                set data-binding "percentage"
            next
        end
        set protected enable
    next
    edit "360-security-Top10-App-Category-Group-By-Bandwidth"
        set disp-name "360 Security Top App Categories By Bandwidth Usage"
        set category "Application"
        set description "360 Security Top App Categories By Bandwidth Usage"
        set dataset "apprisk-ctrl-Category-Breakdown-By-Bandwidth"
        set chart-type table
        set chart-style "{\"table-scheme\": \"dark\"}"
        config table-columns
            edit 1
                set header "Category"
                set data-binding "appcat"
                set data-top 10
                set column-width 30
            next
            edit 2
                set header "Application"
                set data-binding "app_num"
                set column-attr count
                set column-width 15
            next
            edit 3
                set header "User"
                set data-binding "user_num"
                set column-attr count
                set column-width 15
            next
            edit 4
                set header "Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-width 20
            next
            edit 5
                set header "Session"
                set data-binding "num_session"
                set column-attr count
                set column-width 20
            next
        end
        set protected enable
    next
    edit "360-security-Applications-By-Bandwidth"
        set disp-name "360 Security Top Applications by Bandwidth"
        set description "360 Security Top Applications by Bandwidth"
        set category "Web"
        set dataset "security-Web-Applications-By-Bandwidth"
        set chart-type table
        set chart-style "{\"table-scheme\": \"dark\"}"
        config table-columns
            edit 1
                set header "Risk"
                set data-binding "d_risk"
                set column-attr severity
                set column-style "{\"align\":\"middle\"}"
                set data-top 10
                set column-width 5
            next
            edit 2
                set header "Application Name"
                set data-binding "name"
                set column-width 20
            next
            edit 3
                set header "Category"
                set data-binding "app_cat"
                set column-width 15
            next
            edit 4
                set header "Technology"
                set data-binding "technology"
                set column-width 15
            next
            edit 5
                set header "User"
                set data-binding "users"
                set column-attr count
                set column-width 8
            next
            edit 6
                set header "Session"
                set data-binding "sessions"
                set column-attr count
                set column-width 10
            next
            edit 7
                set header "Total Bytes"
                set data-binding "bandwidth"
                set column-span 2
                set column-attr bandwidth
                set column-style "{\"align\":\"left\",\"width\":40}"
                set column-width 26
            next
            edit 8
                set data-binding "bandwidth"
                set column-graph-type bar
                set column-style "{\"align\":\"left\",\"width\":60}"
            next
        end
        set protected enable
    next
    edit "360-security-Top-Web-Categories-Visited"
        set disp-name "360 Security Most Commonly Visited Web Categories"
        set category "Application"
        set description "360 Security Top Web Categories Visited"
        set dataset "360-security-Top-Category-User-By-Count"
        set chart-type bubble-ring
        set chart-style "{\"show-value\":\"enable\" }"
        set include-other disable
        config table-columns
            edit 1
                set header "Category"
                set data-binding "catdesc"
                set data-top 10
            next
            edit 2
                set header "User"
                set data-binding "user_src"
                set data-type drilldown
                set data-top 5
            next
            edit 3
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "360-security-Top5-Malware-Virus-Botnet-Spyware"
        set disp-name "360 Security Top virus Botnet Spyware Adware Phishing Website"
        set category "Virus"
        set description "360 Security Top virus Botnet Spyware Adware Phishing Website"
        set dataset "360-security-Malware-Virus-Botnet-Spyware"
        set chart-type bubble-ring
        set chart-style "{\"show-value\":\"enable\" }"
        set include-other disable
        config table-columns
            edit 1
                set header "Type"
                set data-binding "malware_type"
                set data-top 5
            next
            edit 2
                set header "Victim"
                set data-binding "virus_s"
                set data-type drilldown
                set data-top 10
            next
            edit 3
                set data-binding "type_total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "360-security-Top5-Victims-of-Malware"
        set disp-name "360 Security Victims of Malware"
        set category "Virus"
        set description "360 Security Victims of Malware"
        set dataset "security-Victims-of-Malware"
        set chart-type table
        set include-other disable
        set chart-style "{\"table-scheme\": \"dark\", \"show-sum-0\": \"enable\", \"show-total\": \"disable\", \"show-others\": \"disable\", \"show-percent\": \"disable\"}"
        config table-columns
            edit 1
                set header "User (IP)"
                set data-binding "user_src"
                set data-top 5
            next
            edit 2
                set header "Malware"
                set data-binding "malware"
                set data-type drilldown
                set data-top 5
            next
            edit 3
                set header "Count"
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "360-security-Top5-Victims-of-Phishing-Site"
        set disp-name "360 Security Victims of Phishing Site"
        set category "Virus"
        set description "360 Security Victims of Phishing Site"
        set dataset "security-Victims-of-Phishing-Site"
        set chart-type table
        set include-other disable
        set chart-style "{\"table-scheme\": \"dark\", \"show-sum-0\": \"enable\", \"show-total\": \"disable\", \"show-others\": \"disable\", \"show-percent\": \"disable\"}"
        config table-columns
            edit 1
                set header "User (IP)"
                set data-binding "user_src"
                set data-top 5
                set column-width 25
            next
            edit 2
                set header "Phishing Site"
                set data-binding "phishing_site"
                set data-type drilldown
                set data-top 5
                set column-width 60
                set column-attr obf-url
            next
            edit 3
                set header "Count"
                set data-binding "total_num"
                set data-type aggregate
                set column-width 15
                set column-attr count
            next
        end
        set protected enable
    next
    edit "360-security-Top5-Malicious-Phishing-Sites"
        set disp-name "360 Security Malicious Phishing Sites"
        set category "Virus"
        set description "360 Security Malicious Phishing Sites"
        set dataset "360-security-Victims-of-Phishing-Site-by-Count"
        set chart-type bubble-ring
        set chart-style "{\"show-value\":\"enable\" }"
        set include-other disable
        config table-columns
            edit 1
                set header "Phishing Site"
                set data-binding "phishing_site"
                set column-attr obf-url2
                set data-top 5
            next
            edit 2
                set header "Victim"
                set data-binding "user_src"
                set data-type drilldown
                set data-top 5
            next
            edit 3
                set data-binding "user_total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "360-security-Application-Vulnerability"
        set disp-name "360 Security Application Vulnerability Discovered"
        set category "Application"
        set description "360 Security Application vulnerabilities discovered on the network"
        set dataset "apprisk-ctrl-Application-Vulnerability"
        set chart-type table
        set chart-style "{\"table-scheme\": \"dark\"}"
        config table-columns
            edit 1
                set header "Risk"
                set data-binding "severity_number"
                set column-attr severity
                set column-style "{\"align\":\"middle\"}"
                set data-top 10
                set column-width 5
            next
            edit 2
                set header "Malware Name"
                set data-binding "attackid"
                set column-attr url
                set column-span 2
                set column-width 33
            next
            edit 3
                set data-binding "attack"
                set column-attr attack
            next
            edit 4
                set header "Malware Type"
                set data-binding "vuln_type"
                set column-width 20
            next
            edit 5
                set header "CVE-ID"
                set data-binding "cve"
                set column-width 16
            next
            edit 6
                set header "Victim"
                set data-binding "victims"
                set column-attr count
                set column-width 8
            next
            edit 7
                set header "Source"
                set data-binding "sources"
                set column-attr count
                set column-width 8
            next
            edit 8
                set header "Count"
                set data-binding "totalnum"
                set column-attr count
                set column-width 10
            next
        end
        set protected enable
    next
    edit "360-security-Files-Analyzed-By-FortiCloud-Sandbox"
        set disp-name "360 Security Files analyzed by FortiCloud Sandbox"
        set category "Application"
        set description "360 Security Files analyzed by FortiCloud Sandbox"
        set dataset "security-Files-Analyzed-By-FortiCloud-Sandbox"
        set chart-type bar
        set include-other disable
        set order-by "dow"
        set order-desc disable
        set chart-style "{\"x-label\": \"flat\", \"y-title\":\"Count\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set header "Day"
                set data-binding "dow"
                set data-top 7
            next
            edit 2
                set header "Count"
                set data-type aggregate
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "360-security-Apprisk-Ctrl-Malicious-Files-Detected-By-FortiCloud-Sandbox"
        set disp-name "360 Security Malicious Files Detected by FortiCloud Sandbox"
        set category "Application"
        set description "360 Security Files detected by FortiCloud Sandbox"
        set dataset "apprisk-ctrl-Malicious-Files-Detected-By-FortiCloud-Sandbox"
        set chart-type table
        set chart-style "{\"table-scheme\": \"dark\"}"
        config table-columns
            edit 1
                set header "Malware Name"
                set data-binding "filename"
                set data-top 5
                set column-width 35
            next
            edit 2
                set header "MD5"
                set data-binding "analyticscksum"
                set column-width 35
            next
            edit 3
                set header "Victim"
                set data-binding "victims"
                set column-attr count
                set column-width 15
            next
            edit 4
                set header "Source"
                set data-binding "source"
                set column-attr count
                set column-width 15
            next
        end
        set protected enable
    next
    edit "360-security-Data-Loss-Incidents-By-Severity"
        set disp-name "360 Security Data loss incidents summary by severity"
        set category "Event"
        set description "360 Security Data loss incidents summary by severity"
        set dataset "security-Data-Loss-Incidents-By-Severity"
        set chart-type donut
        set chart-style "{\"size\": \"big\", \"legend-position\": \"right\", \"inner-content\": \"summary\", \"show-value\": \"enable\", \"show-header\" :\"enable\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "Severity"
                set data-binding "s_severity"
                set data-top 5
            next
            edit 2
                set header "Incidents"
                set data-type aggregate
                set data-binding "total_num"
            next
        end
        set protected enable
    next
    edit "360-security-Data-Loss-Files-By-Service"
        set disp-name "360 Security Data Loss Files By Service"
        set category "Event"
        set description "360 Security Data Loss Files By Service"
        set dataset "security-Data-Loss-Files-By-Service"
        set chart-type table
        set chart-style "{\"table-scheme\": \"dark\"}"
        config table-columns
            edit 1
                set header "File Name"
                set data-binding "filename"
                set data-top 10
                set column-width 30
            next
            edit 2
                set header "Upload/Download"
                set data-binding "action"
                set column-width 20
            next
            edit 3
                set header "Service Name"
                set data-binding "service"
                set column-width 30
            next
            edit 4
                set header "File Size"
                set data-binding "filesize"
                set column-attr bandwidth
                set column-width 20
            next
        end
        set protected enable
    next
    edit "360-security-Endpoint-Security-Events-Summary"
        set disp-name "360 Security Endpoint Security Events summary"
        set category "Event"
        set description "360 Security Endpoint Security Events summary"
        set dataset "security-Endpoint-Security-Events-Summary"
        set chart-type donut
        set chart-style "{\"size\": \"big\", \"legend-position\": \"right\", \"inner-content\": \"summary\", \"show-value\": \"enable\", \"show-header\" :\"enable\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "Security Event"
                set data-binding "events"
                set data-top 5
            next
            edit 2
                set header "Events"
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "360-security-Top-Endpoing-Running-High-Risk-Application"
        set disp-name "360 Security Endpoints Running High Risk Application"
        set category "Event"
        set description "360 Security Endpoints Running High Risk Application"
        set dataset "security-Top-Endpoing-Running-High-Risk-Application"
        set chart-type table
        set chart-style "{\"table-scheme\": \"dark\"}"
        config table-columns
            edit 1
                set header "Risk"
                set data-binding "d_risk"
                set column-width 10
            next
            edit 2
                set header "User"
                set data-binding "f_user"
                set data-top 10
                set column-width 25
            next
            edit 3
                set header "Host Name"
                set data-binding "host_name"
                set column-width 25
            next
            edit 4
                set header "Application Name"
                set data-binding "app"
                set column-width 25
            next
            edit 5
                set header "Category"
                set data-binding "appcat"
                set column-width 15
            next
        end
        set protected enable
    next
    edit "soc-Total-Event-by-Severity"
        set disp-name "Total Events by Severity"
        set category "Events/Incidents"
        set description "Total Events by Severity"
        set dataset "soc-Total-Event-by-Severity"
        set chart-type donut
        set chart-style "{\"show-header\" :\"enable\", \"show-value\": \"enable\"}"
        set include-other enable
        config table-columns
            edit 1
                set data-binding "sev"
                set data-top 5
            next
            edit 2
                set header "Events"
                set data-binding "num_events"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "soc-summary-Total-Event-by-Severity-Category"
        set disp-name "Total Events Count by Severity and Category Bubble-ring Chart"
        set category "Events/Incidents"
        set description "Total Events Count by Severity and Category Bubble-ring Chart"
        set dataset "soc-Total-Event-by-Severity-Category"
        set chart-type bubble-ring
        set chart-style "{\"show-value\":\"enable\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "Severity"
                set data-binding "sev"
                set data-top 10
            next
            edit 2
                set header "Category"
                set data-binding "triggername"
                set data-type drilldown
                set data-top 5
            next
            edit 3
                set data-binding "num_events"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "soc-summary-Affected-Endpoint-by-HWOS"
        set disp-name "Total Affected Endpoints by OS"
        set category "Events/Incidents"
        set description "Total Affected Endpoints by OS"
        set dataset "soc-summary-Affected-Endpoint-by-HWOS"
        set chart-type donut
        set chart-style "{\"show-header\" :\"enable\", \"legend-font-size\": \"8px\", \"legend-width\":\"165\"}"
        set include-other disable
        config table-columns
            edit 1
                set data-binding "osname"
                set data-top 5
            next
            edit 2
                set header "Endpoint"
                set data-binding "count"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "soc-summary-Incident-by-Category"
        set disp-name "Total Incidents by Category"
        set category "Events/Incidents"
        set description "Total Incidents by Category"
        set dataset "soc-summary-Incident-by-Category"
        set chart-type donut
        set chart-style "{\"inner-content\": \"row-count\",  \"show-header\" :\"enable\", \"legend-font-size\": \"8px\", \"legend-width\":\"165\"}"
        set include-other disable
        config table-columns
            edit 1
                set data-binding "cat"
                set data-top 5
            next
            edit 2
                set header "Category"
                set data-binding "num_cat"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "soc-summary-Incident-by-Status"
        set disp-name "Total Incidents by Status"
        set category "Events/Incidents"
        set description "Total Incidents by Status"
        set dataset "soc-Incident-by-Status"
        set chart-type donut
        set chart-style "{\"inner-content\": \"row-count\",  \"show-header\" :\"enable\", \"legend-font-size\": \"8px\", \"legend-width\":\"165\"}"
        set include-other disable
        config table-columns
            edit 1
                set data-binding "status"
                set data-top 5
            next
            edit 2
                set header "Status"
                set data-binding "incnum"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "soc-Incident-List"
        set disp-name "List of Incidents"
        set category "Events/Incidents"
        set description "List of Incidents"
        set dataset "soc-Incident-List"
        set chart-type table
        config table-columns
            edit 1
                set header "Incident Number"
                set data-binding "incnum"
                set data-top 20
                set column-width 13
            next
            edit 2
                set header "Timestamp"
                set data-binding "timestamp"
                set column-width 20
            next
            edit 3
                set header "Category"
                set data-binding "category"
                set column-span 2
                set column-attr inc-category
                set column-width 20
            next
            edit 4
                set data-binding "category"
            next
            edit 5
                set header "Severity"
                set data-binding "severity"
                set column-span 2
                set column-attr severity
                set column-width 11
            next
            edit 6
                set data-binding "severity"
            next
            edit 7
                set header "Status"
                set data-binding "status"
                set column-span 2
                set column-attr inc-status
                set column-width 19
            next
            edit 8
                set data-binding "status"
            next
            edit 9
                set header "Affected Endpoint"
                set data-binding "endpoint"
                set column-width 17
            next
        end
        set protected enable
    next

    edit "Apprisk-Ctrl-Severe-High-Risk-Application"
        set disp-name "High Risk Application Visibility and Control"
        set category "Application"
        set description "High Risk Application Visibility and Control"
        set dataset "apprisk-ctrl-Severe-High-Risk-Apps"
        set chart-type donut
        set chart-style "{\"legend-format\":\"${name} ${val}\", \"show-header\": \"enable\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set header "High Risk Apps"
                set data-binding "appcat"
                set data-top 5
            next
            edit 2
                set header "Apps"
                set data-type aggregate
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Apprisk-Ctrl-Threats-Prevention"
        set disp-name "Threats Detection and Prevention"
        set category "Application"
        set description "Threats Detection and Prevention"
        set dataset "apprisk-ctrl-Threats-Prevention"
        set chart-type donut
        set chart-style "{\"legend-format\":\"${name} ${val}\", \"show-header\": \"enable\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set header "Threat"
                set data-binding "threat_name"
                set data-top 5
            next
            edit 2
                set header "Threats"
                set data-type aggregate
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Apprisk-Ctrl-Top-High-Risk-Application"
        set disp-name "Top High Risk Applications Crossing The Network"
        set category "Application"
        set description "Top 10 High Risk Applications Crossing the Network"
        set dataset "apprisk-ctrl-High-Risk-Application"
        set chart-type table
        config table-columns
            edit 1
                set header "Risk"
                set data-binding "d_risk"
                set column-attr severity
                set data-top 10
                set column-width 5
            next
            edit 2
                set header "Application Name"
                set data-binding "id"
                set column-attr app-id
                set column-span 2
                set column-width 25
            next
            edit 3
                set data-binding "name"
            next
            edit 4
                set header "Category"
                set data-binding "app_cat"
                set column-attr appcat
                set column-width 20
            next
            edit 5
                set header "Technology"
                set data-binding "technology"
                set column-width 20
            next
            edit 6
                set header "User"
                set data-binding "users"
                set column-attr count
                set column-width 10
            next
            edit 7
                set header "Total Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-width 10
            next
            edit 8
                set header "Session"
                set data-binding "sessions"
                set column-attr count
                set column-width 10
            next
        end
        set protected enable
    next
    edit "Apprisk-Ctrl-High-Risk-Application-Behavioral-Pie-Chart"
        set disp-name "Application Behavioral Characteristics Pie Chart"
        set category "Application"
        set description "Application Behavioral Characteristics Pie Chart"
        set dataset "apprisk-ctrl-High-Risk-Apps-Behavioral"
        set chart-type pie
        set chart-style "{\"legend-format\":\"${name} ${pct}\"}"
        config table-columns
            edit 1
                set header "Behavior"
                set data-binding "behavior"
                set data-top 5
            next
            edit 2
                set header "Percentage"
                set data-type aggregate
                set column-attr percent
                set data-binding "percentage"
            next
        end
        set protected enable
    next
    edit "Apprisk-Ctrl-High-Risk-Apps-Behavioral-Timeline"
        set disp-name "Application Behavioral Timeline"
        set category "Application"
        set description "Application Behavioral Timeline"
        set dataset "apprisk-ctrl-High-Risk-Apps-Behavioral-Timeline"
        set chart-type area
        set chart-style "{\"legend-position\":\"top\", \"y-title\":\"Number of Sessions\"}"
        config table-columns
            edit 1
                set header "Date"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "behavior"
                set column-attr none
                set data-top 5
                set data-type drilldown
            next
            edit 3
                set data-binding "total_num"
                set column-graph-type line-up
                set column-attr count
            next
        end
        set protected enable
    next
    edit "Apprisk-Ctrl-Top-High-Risk-Application-By-Bandwidth"
        set disp-name "High Risk Applications by Bandwidth"
        set category "Application"
        set description "Top 15 High Risk Applications by Bandwidth"
        set dataset "apprisk-ctrl-High-Risk-Application-by-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Risk"
                set data-binding "d_risk"
                set column-attr severity
                set data-top 15
                set column-width 5
            next
            edit 2
                set header "Application Name"
                set data-binding "id"
                set column-attr app-id
                set column-span 2
                set column-width 20
            next
            edit 3
                set data-binding "name"
            next
            edit 4
                set header "Category"
                set data-binding "app_cat"
                set column-attr appcat
                set column-width 15
            next
            edit 5
                set header "Technology"
                set data-binding "technology"
                set column-width 15
            next
            edit 6
                set header "User"
                set data-binding "users"
                set column-attr count
                set column-width 10
            next
            edit 7
                set header "Session"
                set data-binding "sessions"
                set column-attr count
                set column-width 10
            next
            edit 8
                set header "Total Bytes"
                set data-binding "bandwidth"
                set column-span 2
                set column-attr bandwidth
                set column-style "{\"align\":\"left\",\"width\":40}"
                set column-width 25
            next
            edit 9
                set data-binding "bandwidth"
                set column-graph-type bar
                set column-style "{\"align\":\"left\",\"width\":60}"
            next
        end
        set protected enable
    next
    edit "Apprisk-Ctrl-Top-Web-Applications"
        set disp-name "Top Web Applications by Bandwidth"
        set category "Application"
        set description "Top 15 Web Applications by Bandwidth"
        set dataset "apprisk-ctrl-Top-Web-Applications-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Risk"
                set data-binding "d_risk"
                set column-attr severity
                set data-top 15
                set column-width 5
            next
            edit 2
                set header "Application Name"
                set data-binding "id"
                set column-attr app-id
                set column-span 2
                set column-width 20
            next
            edit 3
                set data-binding "name"
            next
            edit 4
                set header "Technology"
                set data-binding "technology"
                set column-width 15
            next
            edit 5
                set header "User"
                set data-binding "user_num"
                set column-attr count
                set column-width 10
            next
            edit 6
                set header "Session"
                set data-binding "num_session"
                set column-attr count
                set column-width 10
            next
            edit 7
                set header "Total Bytes"
                set data-binding "bandwidth"
                set column-span 2
                set column-attr bandwidth
                set column-style "{\"align\":\"left\",\"width\":40}"
                set column-width 25
            next
            edit 8
                set data-binding "bandwidth"
                set column-graph-type bar
                set column-style "{\"align\":\"left\",\"width\":60}"
            next
        end
        set protected enable
    next
    edit "Apprisk-Ctrl-Top-Visited-Web-Categories"
        set category "Application"
        set disp-name "Top Web Categories Visited"
        set category "Application"
        set description "Top 15 Web Categories Visited"
        set dataset "apprisk-ctrl-Top-Web-Categories-Visited"
        set chart-type table
        config table-columns
            edit 1
                set header "URL Category"
                set data-binding "catdesc"
                set column-attr web-cat
                set data-top 15
                set column-width 35
            next
            edit 2
                set header "Users"
                set data-binding "user_num"
                set column-attr count
                set column-width 15
            next
            edit 3
                set header "Bytes"
                set data-binding "bandwidth"
                set column-attr bandwidth
                set column-width 15
            next
            edit 4
                set header "Count"
                set data-binding "sessions"
                set column-span 2
                set column-attr count
                set column-style "{\"align\":\"left\",\"width\":40}"
                set column-width 35
            next
            edit 5
                set data-binding "sessions"
                set column-graph-type bar
                set column-style "{\"align\":\"left\",\"width\":60}"
            next
        end
        set protected enable
    next
    edit "Apprisk-Ctrl-Top-Application-Vulnerability"
        set disp-name "Top Application Vulnerability Exploits by Serverity"
        set category "Application"
        set description "Top Application Vulnerability Exploits by Serverity"
        set dataset "apprisk-ctrl-Application-Vulnerability"
        set chart-type table
        config table-columns
            edit 1
                set header "Risk"
                set data-binding "severity_number"
                set column-attr severity
                set data-top 15
                set column-width 5
            next
            edit 2
                set header "Threat Name"
                set data-binding "attackid"
                set column-attr url
                set column-span 2
                set column-width 25
            next
            edit 3
                set data-binding "attack"
                set column-attr attack
            next
            edit 4
                set header "Type"
                set data-binding "vuln_type"
                set column-width 20
            next
            edit 5
                set header "CVE-ID"
                set data-binding "cve"
                set column-width 15
            next
            edit 6
                set header "Victim"
                set data-binding "victims"
                set column-attr count
                set column-width 5
            next
            edit 7
                set header "Source"
                set data-binding "sources"
                set column-attr count
                set column-width 5
            next
            edit 8
                set header "Count"
                set data-binding "totalnum"
                set column-attr count
                set column-span 2
                set column-style "{\"align\":\"left\",\"width\":40}"
                set column-width 20
            next
            edit 9
                set data-binding "totalnum"
                set column-graph-type bar
                set column-style "{\"align\":\"left\",\"width\":60}"
            next
        end
        set protected enable
    next
    edit "Apprisk-Ctrl-Files-FortiCloud-Sandbox-Analyzed"
        set disp-name "App Risk Control Files Analyzed by FortiCloud Sandbox"
        set category "Application"
        set description "App Risk Control Files analyzed by FortiCloud Sandbox"
        set dataset "apprisk-ctrl-Files-FortiCloud-Sandbox-Analyzed"
        set chart-type area
        set chart-style "{\"y-title\":\"Count\"}"
        config table-columns
            edit 1
                set header "Date"
                set data-binding "dom"
                set column-attr time
                set data-top 0
            next
            edit 2
                set header "Count"
                set column-graph-type line-up
                set data-binding "total_num"
            next
        end
        set protected enable
    next
    edit "Apprisk-Ctrl-Malicious-Files-Detected-By-FortiCloud-Sandbox"
        set disp-name "Malicious Files Detected by FortiCloud Sandbox"
        set category "Application"
        set description "Files detected by FortiCloud Sandbox"
        set dataset "apprisk-ctrl-Malicious-Files-Detected-By-FortiCloud-Sandbox"
        set chart-type table
        config table-columns
            edit 1
                set header "File Name"
                set data-binding "filename"
                set data-top 5
                set column-width 35
            next
            edit 2
                set header "MD5"
                set data-binding "analyticscksum"
                set column-width 35
            next
            edit 3
                set header "Victim"
                set data-binding "victims"
                set column-attr count
                set column-width 15
            next
            edit 4
                set header "Source"
                set data-binding "source"
                set column-attr count
                set column-width 15
            next
        end
        set protected enable
    next
    edit "Apprisk-Ctrl-High-Risk-Category-App-by-Bandwidth"
        set disp-name "High Risk App Categories and Apps by Bandwidth"
        set category "Application"
        set description "High Risk App Categories and Apps by Bandwidth"
        set dataset "apprisk-ctrl-High-Risk-Category-and-App-by-Bandwidth"
        set chart-type bubble-ring
        set chart-style "{\"show-value\":\"enable\" }"
        set include-other disable
        config table-columns
            edit 1
                set header "Category"
                set data-binding "app_cat"
                set data-top 10
            next
            edit 2
                set header "App"
                set data-type drilldown
                set data-binding "name"
                set data-top 5
            next
            edit 3
                set data-binding "bandwidth"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "Apprisk-Ctrl-Malware-Virus-Botnet-Spyware-by-Count"
        set disp-name "Malware: Virus Botnet Spyware and Adware by Count"
        set category "Application"
        set description "Malware: Virus, Botnet, Spyware, Adware by Count"
        set dataset "security-Malware-Virus-Botnet-Spyware-by-Count"
        set chart-type bubble-ring
        set chart-style "{\"show-value\":\"enable\" }"
        set include-other disable
        config table-columns
            edit 1
                set header "Category"
                set data-binding "malware_type"
                set data-top 10
            next
            edit 2
                set header "Virus"
                set data-type drilldown
                set data-binding "virus"
                set data-top 5
            next
            edit 3
                set data-binding "totalnum"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
end


config sql-report macro

    edit "Application-with-Highest-Bandwidth"
        set disp-name "Application with Highest Bandwidth"
        set description "Application with the highest bandwidth usage"
        set dataset "Top-App-By-Bandwidth"
        set data-binding "app_group"
        set protected enable
    next

    edit "Highest-Bandwidth-Consumed-Application"
        set disp-name "Highest Bandwidth by Application"
        set description "Highest bandwidth consumed by application"
        set dataset "Top-App-By-Bandwidth"
        set data-binding "bandwidth"
        set data-attr bandwidth
        set protected enable
    next

    edit "Application-with-Highest-Session-Count"
        set disp-name "Application with Highest Session Count"
        set description "Applications with the highest session count"
        set dataset "Top-App-By-Sessions"
        set data-binding "app_group"
        set protected enable
    next

    edit "Highest-Session-Count-Application"
        set disp-name "Highest Session Count by Application"
        set description "Highest session count by application"
        set dataset "Top-App-By-Sessions"
        set data-binding "sessions"
        set data-attr count
        set protected enable
    next

    edit "Highest-Bandwidth-Consumed-App-Category"
        set disp-name "Highest Bandwidth by Application Category"
        set description "Highest bandwidth consumed by application category"
        set dataset "App-Risk-App-Usage-By-Category"
        set data-binding "bandwidth"
        set data-attr bandwidth
        set protected enable
    next

    edit "App-Category-with-Highest-Session-Count"
        set disp-name "Application Category with Highest Session Count"
        set description "Application category with the highest session count"
        set dataset "App-Sessions-By-Category"
        set data-binding "appcat"
        set protected enable
    next

    edit "Highest-Session-Count-App-Category"
        set disp-name "Highest Session Count by Application Category"
        set description "Highest session count by application category"
        set dataset "App-Sessions-By-Category"
        set data-binding "sessions"
        set data-attr count
        set protected enable
    next

    edit "P2P-Application-with-Highest-Bandwidth"
        set disp-name "P2P Application with Highest Bandwidth"
        set description "P2P applications with the highest bandwidth usage"
        set dataset "Top-P2P-App-By-Bandwidth"
        set data-binding "app_group"
        set protected enable
    next

    edit "Highest-Bandwidth-Consumed-P2P-Application"
        set disp-name "Highest Bandwidth by P2P Application"
        set description "Highest bandwidth consumed by P2P application"
        set dataset "Top-P2P-App-By-Bandwidth"
        set data-binding "bandwidth"
        set data-attr bandwidth
        set protected enable
    next

    edit "P2P-Application-with-Highest-Session-Count"
        set disp-name "P2P Application with Highest Session Count"
        set description "P2P applications with the highest session count"
        set dataset "Top-P2P-App-By-Sessions"
        set data-binding "app_group"
        set protected enable
    next

    edit "Highest-Session-Count-P2P-Application"
        set disp-name "Highest Session Count by P2P Application"
        set description "Highest session count by P2P application"
        set dataset "Top-P2P-App-By-Sessions"
        set data-binding "sessions"
        set data-attr count
        set protected enable
    next

    edit "Highest-Risk-Application-with-Highest-Bandwidth"
        set disp-name "Highest Risk Application with Highest Bandwidth"
        set description "Highest risk application with the highest bandwidth usage"
        set dataset "High-Risk-Application-By-Bandwidth"
        set data-binding "name"
        set protected enable
    next

    edit "Highest-Risk-Application-with-Highest-Session-Count"
        set disp-name "Highest Risk Application with Highest Session Count"
        set description "Highest risk application with the highest session count"
        set dataset "High-Risk-Application-By-Sessions"
        set data-binding "name"
        set protected enable
    next

    edit "Source-with-Highest-Bandwidth"
        set disp-name "Source with Highest Bandwidth"
        set description "Source with the highest bandwidth usage"
        set dataset "Top-Users-By-Bandwidth"
        set data-binding "user_src"
        set protected enable
    next

    edit "Highest-Bandwidth-Consumed-Source"
        set disp-name "Highest Bandwidth by Source"
        set description "Highest bandwidth consumed by source"
        set dataset "Top-Users-By-Bandwidth"
        set data-binding "bandwidth"
        set data-attr bandwidth
        set protected enable
    next

    edit "Source-with-Highest-Session-Count"
        set disp-name "Source with Highest Session Count"
        set description "Source with the highest session count"
        set dataset "Top-User-Source-By-Sessions"
        set data-binding "user_src"
        set protected enable
    next

    edit "Highest-Session-Count-Source"
        set disp-name "Highest Session Count by Source"
        set description "Highest session count by source"
        set dataset "Top-User-Source-By-Sessions"
        set data-binding "sessions"
        set data-attr count
        set protected enable
    next

    edit "Destination-with-Highest-Bandwidth"
        set disp-name "Destination with Highest Bandwidth"
        set description "Destination with the highest bandwidth usage"
        set dataset "Top-Destinations-By-Bandwidth"
        set data-binding "domain"
        set protected enable
    next

    edit "Highest-Bandwidth-Consumed-Destination"
        set disp-name "Highest Bandwidth by Destination"
        set description "Highest bandwidth consumed by destination"
        set dataset "Top-Destinations-By-Bandwidth"
        set data-binding "bandwidth"
        set data-attr bandwidth
        set protected enable
    next

    edit "Destination-with-Highest-Session-Count"
        set disp-name "Destination with Highest Session Count"
        set description "Destination with the highest session count"
        set dataset "Top-Destinations-By-Sessions"
        set data-binding "domain"
        set protected enable
    next

    edit "Highest-Session-Count-Destination"
        set disp-name "Highest Session Count by Destination"
        set description "Highest session count by destination"
        set dataset "Top-Destinations-By-Sessions"
        set data-binding "sessions"
        set data-attr count
        set protected enable
    next

    edit "Website-with-Highest-Bandwidth"
        set disp-name "Website with Highest Bandwidth"
        set description "Website with the highest bandwidth usage"
        set dataset "Top-Web-Sites-by-Bandwidth"
        set data-binding "domain"
        set protected enable
    next

    edit "Highest-Bandwidth-Consumed-Website"
        set disp-name "Highest Bandwidth by Website"
        set description "Highest bandwidth consumed by website"
        set dataset "Top-Web-Sites-by-Bandwidth"
        set data-binding "bandwidth"
        set data-attr bandwidth
        set protected enable
    next

    edit "Website-with-Highest-Session-Count"
        set disp-name "Website with Highest Session Count"
        set description "Website with the highest session count"
        set dataset "Top-Web-Sites-by-Sessions"
        set data-binding "domain"
        set protected enable
    next

    edit "Highest-Session-Count-Website"
        set disp-name "Highest Session Count by Website"
        set description "Highest session count by website"
        set dataset "Top-Web-Sites-by-Sessions"
        set data-binding "sessions"
        set data-attr count
        set protected enable
    next

    edit "Web-Category-with-Highest-Bandwidth"
        set disp-name "Web Category with Highest Bandwidth"
        set description "Web filtering category with the highest bandwidth usage"
        set dataset "Top-Web-Category-by-Bandwidth"
        set data-binding "catdesc"
        set protected enable
    next

    edit "Highest-Bandwidth-Consumed-Web-Category"
        set disp-name "Highest Bandwidth by Web Category"
        set description "Highest bandwidth consumed by website category"
        set dataset "Top-Web-Category-by-Bandwidth"
        set data-binding "bandwidth"
        set data-attr bandwidth
        set protected enable
    next

    edit "Web-Category-with-Highest-Session-Count"
        set disp-name "Web Category with Highest Session Count"
        set description "Web filtering category with the highest session count"
        set dataset "Top-Web-Category-by-Sessions"
        set data-binding "catdesc"
        set protected enable
    next

    edit "Highest-Session-Count-Web-Category"
        set disp-name "Highest Session Count by Web Category"
        set description "Highest session count by website category"
        set dataset "Top-Web-Category-by-Sessions"
        set data-binding "sessions"
        set data-attr count
        set protected enable
    next

    edit "Attack-with-Highest-Session-Count"
        set disp-name "Attack with Highest Session Count"
        set description "Attack with highest session count"
        set dataset "utm-Top-Attack-Source"
        set data-binding "user_src"
        set protected enable
    next

    edit "Highest-Session-Count-Attack"
        set disp-name "Highest Session Count by Attack"
        set description "Highest session count by attack"
        set dataset "utm-Top-Attack-Source"
        set data-binding "totalnum"
        set data-attr count
        set protected enable
    next

    edit "Highest-Severity-Attack-with-Highest-Session-Count"
        set disp-name "Highest Severity Attack with Highest Session Count"
        set description "Highest severity attack with the highest session count"
        set dataset "threat-Attacks-By-Severity"
        set data-binding "severity"
        set protected enable
    next

    edit "Highest-Session-Count-Highest-Severity-Attack"
        set disp-name "Highest Session Count by Highest Severity Attack"
        set description "Highest session count by highest severity attack"
        set dataset "threat-Attacks-By-Severity"
        set data-binding "totalnum"
        set data-attr count
        set protected enable
    next

    edit "Total-Number-of-Attacks"
        set disp-name "Total Number of Attacks"
        set description "Total number of attacks detected"
        set dataset "Total-Attack-Source"
        set data-binding "totalnum"
        set data-attr count
        set protected enable
    next

    edit "Virus-with-Highest-Session-Count"
        set disp-name "Virus with Highest Session Count"
        set description "Virus with the highest session count"
        set dataset "utm-Top-Virus"
        set data-binding "virus"
        set protected enable
    next

    edit "Highest-Session-Count-Virus"
        set disp-name "Highest Session Count by Virus"
        set description "Highest session count by virus"
        set dataset "utm-Top-Virus"
        set data-binding "totalnum"
        set data-attr count
        set protected enable
    next

    edit "Total-Number-of-Viruses"
        set disp-name "Total Number of Viruses"
        set description "Total number of viruses detected"
        set dataset "Total-Number-of-Viruses"
        set data-binding "totalnum"
        set data-attr count
        set protected enable
    next

    edit "Botnet-with-Highest-Session-Count"
        set disp-name "Botnet with Highest Session Count"
        set description "Botnet with the highest session count"
        set dataset "Detected-Botnet"
        set data-binding "app"
        set protected enable
    next

    edit "Highest-Session-Count-Botnet"
        set disp-name "Highest Session Count by Botnet"
        set description "Highest session count by botnet"
        set dataset "Detected-Botnet"
        set data-binding "events"
        set data-attr count
        set protected enable
    next

    edit "Total-Number-of-Botnet-Events"
        set disp-name "Total Number of Botnet Events"
        set description "Total number of botnet events"
        set dataset "Total-Number-of-Botnet-Events"
        set data-binding "events"
        set data-attr count
        set protected enable
    next

    edit "Botnet-and-Malware-Infections"
        set disp-name "Botnet and Malware Infections"
        set description "Botnet and Malware Infections"
        set dataset "Botnet-and-Malware-Infections"
        set data-binding "events"
        set data-attr count
        set protected enable
    next


    edit "traffic-User-Detail"
        set disp-name "User Details"
        set description "User details of traffic"
        set dataset "traffic-User-Detail"
        set data-binding "user_detail"
        set protected enable
    next

    edit "Total-Number-of-Botnet-Infections"
        set disp-name "Total Number of Botnet Infections"
        set description "Total number of botnet Infections"
        set dataset "Total-Number-of-Botnet-Infections"
        set data-binding "app_num"
        set data-attr count
        set protected enable
    next

    edit "Total-Number-of-Evasive-Applications"
        set disp-name "Total Number of Evasive Applications"
        set description "Total number of evasive applications"
        set dataset "Total-Number-of-Evasive-Applications"
        set data-binding "number"
        set data-attr count
        set protected enable
    next

    edit "Total-Number-of-P2P-Applications"
        set disp-name "Total Number of P2P Applications"
        set description "Total number of P2P applications"
        set dataset "Total-Number-of-P2P-Applications"
        set data-binding "number"
        set data-attr count
        set protected enable
    next

    edit "Total-Number-of-Bandwidth-Consuming-Applications"
        set disp-name "Total Number of Bandwidth Consuming Applications"
        set description "Total number of bandwidth consuming applications"
        set dataset "Total-Number-of-Bandwidth-Consuming-Applications"
        set data-binding "number"
        set data-attr count
        set protected enable
    next

    edit "Percent-of-Compliance-for-PCI-DSS-Requirement"
        set disp-name "Percent of Compliance for PCI DSS Requirement"
        set description "Percent of Compliance for PCI DSS Requirement"
        set dataset "pci-dss-Compliance-Summary"
        set data-binding "percent"
        set protected enable
    next

    edit "Percent-of-Passed-Fortinet-Security-Best-Practices"
        set disp-name "Percent of Passed Fortinet Security Best Practices"
        set description "Percent of Passed Fortinet Security Best Practices"
        set dataset "pci-dss-Fortinet-Security-Best-Practice-Summary"
        set data-binding "percent"
        set protected enable
    next

    edit "CTAP-Total-Malware-Botnet-Detected"
        set disp-name "CTAP Total Malware Botnet Detected"
        set description "Total Malware Botnet Detected"
        set dataset "CTAP-Total-Malware-Botnet-Detected"
        set data-binding "totalnum"
        set protected enable
    next

    edit "CTAP-Total-High-Risk-Used"
        set disp-name "CTAP Total High Risk Used"
        set description "Total High Risk Used"
        set dataset "CTAP-Total-High-Risk-Used"
        set data-binding "totalnum"
        set protected enable
    next

    edit "CTAP-Total-Apps-Detected"
        set disp-name "CTAP Total Apps Detected"
        set description "Total Apps Detected"
        set dataset "CTAP-Total-Apps-Detected"
        set data-binding "totalnum"
        set protected enable
    next

    edit "CTAP-Top-Used-Application"
        set disp-name "CTAP Top Used Application"
        set description "Top Used Application"
        set dataset "CTAP-Top-Used-Application"
        set data-binding "appname"
        set protected enable
    next

    edit "CTAP-App-Sessions-By-Category"
        set disp-name "CTAP Application Category with Highest Session Count"
        set description "Application category with the highest session count"
        set dataset "CTAP-App-Sessions-By-Category"
        set data-binding "appcat"
        set protected enable
    next

    edit "CTAP-Total-Websites-Visited"
        set disp-name "CTAP Total Websites Visited"
        set description "Total Websites Visited"
        set dataset "CTAP-Total-Websites-Visited"
        set data-binding "totalnum"
        set protected enable
    next

    edit "CTAP-Total-Bandwidth"
        set disp-name "CTAP Total Bandwidth"
        set description "Total Bandwidth"
        set dataset "CTAP-Total-Bandwidth"
        set data-binding "totalnum"
        set protected enable
    next

    edit "CTAP-SB-Total-Number-of-Files-Detected"
        set disp-name "CTAP SB Total Number of Files Detected"
        set description "Total number of files detected"
        set dataset "CTAP-SB-Total-Number-of-Files-Detected"
        set data-binding "total_num"
        set protected enable
    next

    edit "CTAP-SB-Total-Number-of-Files-Could-be-Executed"
        set disp-name "CTAP SB Total Number of Files Could be Executed"
        set description "Total number of files could be executed"
        set dataset "CTAP-SB-Total-Number-of-Files-Could-be-Executed"
        set data-binding "total_num"
        set protected enable
    next

    edit "CTAP-SB-Total-Number-of-Exe-Files-Analyzed"
        set disp-name "CTAP SB Total Number of Exe Files Analyzed"
        set description "Total number of exe files analyzed"
        set dataset "CTAP-SB-Total-Number-of-Exe-Files-Analyzed"
        set data-binding "total_num"
        set protected enable
    next

    edit "CTAP-SB-Malicious-Exes-Found"
        set disp-name "CTAP SB Malicious Exes Found"
        set description "Malicious exes found"
        set dataset "CTAP-SB-Malicious-Exes-Found"
        set data-binding "total_num"
        set protected enable
    next

    edit "CTAP-Total-App-Vuln-Detected"
        set disp-name "CTAP Total App Vuln Detected"
        set description "Total App Vuln Detected"
        set dataset "CTAP-Total-App-Vuln-Detected"
        set data-binding "totalnum"
        set protected enable
    next

    edit "CTAP-Total-Malware-Detected"
        set disp-name "CTAP Total Malware Detected"
        set description "Total Malware Detected"
        set dataset "CTAP-Total-Malware-Detected"
        set data-binding "totalnum"
        set protected enable
    next

    edit "CTAP-Total-Malicious-Websites-Detected"
        set disp-name "CTAP Total Malicious Websites Detected"
        set description "Total Malicious Websites Detected"
        set dataset "CTAP-Total-Malicious-Websites-Detected"
        set data-binding "totalnum"
        set protected enable
    next

    edit "CTAP-Total-Phishing-Websites-Detected"
        set disp-name "CTAP Total Phishing Websites Detected"
        set description "Total Phishing Websites Detected"
        set dataset "CTAP-Total-Phishing-Websites-Detected"
        set data-binding "totalnum"
        set protected enable
    next

    edit "CTAP-Total-Proxy-Applications-Detected"
        set disp-name "CTAP Total Proxy Applications Detected"
        set description "Total Proxy Applications Detected"
        set dataset "CTAP-Total-Proxy-Applications-Detected"
        set data-binding "totalnum"
        set protected enable
    next

    edit "CTAP-Total-RAS-Applications-Detected"
        set disp-name "CTAP Total RAS Applications Detected"
        set description "Total RAS Applications Detected"
        set dataset "CTAP-Total-RAS-Applications-Detected"
        set data-binding "totalnum"
        set protected enable
    next

    edit "saas-SaaS-Application-Percentage"
        set disp-name "SaaS Application Percentage"
        set description "SaaS Application Percentage"
        set dataset "saas-SaaS-Application-Percentage"
        set data-binding "saas_perc"
        set data-attr percent
        set protected enable
    next

    edit "saas-Unsanctioned-SaaS-Application-Percentage"
        set disp-name "Unsanctioned SaaS Application Percentage"
        set description "Unsanctioned SaaS Application Percentage"
        set dataset "saas-Unsanctioned-SaaS-Application-Percentage"
        set data-binding "unsanctioned_saas_perc"
        set data-attr percent
        set protected enable
    next
    edit "Total-Number-of-P2P-Apps"
        set disp-name "Total Number of P2P Application"
        set description "Total number of P2P application"
        set dataset "Total-Number-of-P2P-Apps"
        set data-binding "number"
        set data-attr count
        set protected enable
    next
    edit "Total-Number-of-P2P-Application-Users"
        set disp-name "Total Number of P2P Application Users"
        set description "Total Number of P2P Application Users"
        set dataset "Total-Number-of-P2P-Users"
        set data-binding "number"
        set data-attr count
        set protected enable
    next
    edit "Total-Usage-of-P2P-Applications"
        set disp-name "Total Usage of P2P Applications"
        set description "Total Usage of P2P Applications"
        set dataset "Total-Usage-of-P2P-Applications"
        set data-binding "bandwidth"
        set data-attr bandwidth
        set protected enable
    next
    edit "Total-Sessions-of-P2P-Applications"
        set disp-name "Total Sessions of P2P Applications"
        set description "Total Sessions of P2P Applications"
        set dataset "Total-Sessions-of-P2P-Applications"
        set data-binding "total_num"
        set data-attr count
        set protected enable
    next
    edit "Total-Number-of-File-Sharing-Applications"
        set disp-name "Total Number of File Sharing Applications"
        set description "Total Number of File Sharing Applications"
        set dataset "Total-Number-of-file-sharing-Applications"
        set data-binding "number"
        set data-attr count
        set protected enable
    next
    edit "Total-Number-of-File-Sharing-Application-Users"
        set disp-name "Total Number of File Sharing Application Users"
        set description "Total Number of File Sharing Application Users"
        set dataset "Total-Number-of-file-sharing-Users"
        set data-binding "number"
        set data-attr count
        set protected enable
    next
    edit "Total-Usage-of-File-Sharing-Applications"
        set disp-name "Total Usage of File Sharing Applications"
        set description "Total Usage of File Sharing Applications"
        set dataset "Total-Usage-of-file-sharing-Applications"
        set data-binding "bandwidth"
        set data-attr bandwidth
        set protected enable
    next
    edit "Total-Sessions-of-File-Sharing-Applications"
        set disp-name "Total Sessions of File Sharing Applications"
        set description "Total Sessions of File Sharing Applications"
        set dataset "Total-Sessions-of-file-sharing-Applications"
        set data-binding "total_num"
        set data-attr count
        set protected enable
    next
    edit "Total-number-of-Video-and-Audio-applications"
        set disp-name "Total number of Video and Audio applications"
        set description "Total number of Video and Audio applications"
        set dataset "Total-Number-of-Video-Audio-Applications"
        set data-binding "number"
        set data-attr count
        set protected enable
    next
    edit "Total-Number-of-Video-and-Audio-Application-Users"
        set disp-name "Total Number of Video and Audio Application Users"
        set description "Total Number of Video and Audio Application Users"
        set dataset "Total-Number-of-Video-Audio-Users"
        set data-binding "number"
        set data-attr count
        set protected enable
    next
    edit "Total-Usage-of-Video-and-Audio-Applications"
        set disp-name "Total Usage of Video and Audio Applications"
        set description "Total Usage of Video and Audio Applications"
        set dataset "Total-Usage-of-Video-Audio-Applications"
        set data-binding "bandwidth"
        set data-attr bandwidth
        set protected enable
    next
    edit "Total-Sessions-of-Video-and-Audio-Applications"
        set disp-name "Total Sessions of Video and Audio Applications"
        set description "Total Sessions of Video and Audio Applications"
        set dataset "Total-Sessions-of-Video-Audio-Applications"
        set data-binding "total_num"
        set data-attr count
        set protected enable
    next
    edit "Total-Number-of-Applications"
        set disp-name "Total Number of Applications"
        set description "Total Number of Applications"
        set dataset "Total-Number-of-Apps"
        set data-binding "num_app"
        set data-attr count
        set protected enable
    next
    edit "Total-Number-of-App-Category"
        set disp-name "Total Number of Application Categories"
        set description "Total number of application Categories"
        set dataset "Total-Number-of-App-Category"
        set data-binding "num_appcat"
        set data-attr count
        set protected enable
    next
    edit "Total-Usage-of-Applications"
        set disp-name "Total Usage of Applications"
        set description "Total Usage of Applications"
        set dataset "Total-Usage-of-Applications"
        set data-binding "bandwidth"
        set data-attr bandwidth
        set protected enable
    next
    edit "Total-Usage-of-Applications-Per-Day"
        set disp-name "Total Usage of Applications Per Day"
        set description "Total Usage of Applications Per Day"
        set dataset "Total-Usage-of-Applications-Per-Day"
        set data-binding "bandwidth_perday"
        set data-attr bandwidth
        set protected enable
    next
    edit "Total-Number-of-Application-Users"
        set disp-name "Total Number of Application Users"
        set description "Total Number of Application Users"
        set dataset "Total-Number-of-App-Users"
        set data-binding "num_user"
        set data-attr count
        set protected enable
    next
    edit "sdwan-device-availability-percentage"
        set disp-name "SD-WAN Device Availability Percentage"
        set description "SD-WAN Device Availability Percentage"
        set dataset "sdwan-device-availability-percentage"
        set data-binding "available"
        set data-attr percent
        set protected enable
    next
    edit "sdwan-total-bandwidth"
        set disp-name "SD-WAN Total Bandwidth"
        set description "SD-WAN Total Bandwidth"
        set dataset "sdwan-total-bandwidth"
        set data-binding "bandwidth"
        set data-attr bandwidth
        set chart-style "{\"unit-style\": \"font-size: 50%;\"}"
        set protected enable
    next
    edit "sdwan-CTAP-Total-DIA-Applications-Detected"
        set disp-name "CTAP SD-WAN Total DIA Applications Detected"
        set description "CTAP SD-WAN Total DIA Applications Detected"
        set dataset "sdwan-CTAP-Total-DIA-Applications-Detected"
        set data-binding "totalnum"
        set data-attr count
        set protected enable
    next
    edit "sdwan-CTAP-Total-Bandwidth-Cloud-IT"
        set disp-name "CTAP SD-WAN Total Bandwidth of Cloud-IT Application"
        set description "CTAP SD-WAN Total Bandwidth of Cloud-IT Application"
        set dataset "sdwan-CTAP-Total-Bandwidth-Cloud-IT"
        set data-binding "bandwidth"
        set data-attr bandwidth
        set chart-style "{\"unit-style\": \"font-size: 50%;\"}"
        set protected enable
    next
    edit "sdwan-CTAP-Total-Bandwidth-VoIP-Video-Audio"
        set disp-name "CTAP SD-WAN Total Bandwidth of VoIP-Video-Audio Application"
        set description "CTAP SD-WAN Total Bandwidth of VoIP-Video-Audio Application"
        set dataset "sdwan-CTAP-Total-Bandwidth-VoIP-Video-Audio"
        set data-binding "bandwidth"
        set data-attr bandwidth
        set chart-style "{\"unit-style\": \"font-size: 50%;\"}"
        set protected enable
    next
    edit "sdwan-CTAP-Total-Bandwidth"
        set disp-name "CTAP SD-WAN Total Bandwidth"
        set description "CTAP SD-WAN Total Bandwidth"
        set dataset "sdwan-CTAP-Total-Bandwidth"
        set data-binding "totalnum"
        set data-attr bandwidth
        set chart-style "{\"unit-style\": \"font-size: 50%;\"}"
        set protected enable
    next
    edit "sdwan-CTAP-Total-Bandwidth-nonBusiness"
        set disp-name "CTAP SD-WAN Total nonBusiness Bandwidth"
        set description "CTAP SD-WAN Total nonBusiness Bandwidth"
        set dataset "sdwan-CTAP-Total-Bandwidth-nonBusiness"
        set data-binding "totalnum"
        set data-attr bandwidth
        set chart-style "{\"unit-style\": \"font-size: 50%;\"}"
        set protected enable
    next
    edit "sdwan-CTAP-HTTPS-SSL-Bandwidth"
        set disp-name "CTAP SD-WAN Total Business Bandwidth"
        set description "CTAP SD-WAN Total Business Bandwidth"
        set dataset "sdwan-CTAP-HTTPS-SSL-Bandwidth"
        set data-binding "totalnum"
        set data-attr bandwidth
        set chart-style "{\"unit-style\": \"font-size: 50%;\"}"
        set protected enable
    next
    edit "sdwan-CTAP-Total-Bandwidth-Internal"
        set disp-name "CTAP SD-WAN Total Internal Bandwidth"
        set description "CTAP SD-WAN Total Internal Bandwidth"
        set dataset "sdwan-CTAP-Total-Bandwidth-Internal"
        set data-binding "totalnum"
        set data-attr bandwidth
        set chart-style "{\"unit-style\": \"font-size: 50%;\"}"
        set protected enable
    next
    edit "sdwan-CTAP-Total-Bandwidth-External"
        set disp-name "CTAP SD-WAN Total External Bandwidth"
        set description "CTAP SD-WAN Total External Bandwidth"
        set dataset "sdwan-CTAP-Total-Bandwidth-External"
        set data-binding "totalnum"
        set data-attr bandwidth
        set chart-style "{\"unit-style\": \"font-size: 50%;\"}"
        set protected enable
    next
    edit "sdwan-CTAP-Total-Bandwidth-Business-External"
        set disp-name "CTAP SD-WAN External Bandwidth of Business"
        set description "CTAP SD-WAN External Bandwidth of Business"
        set dataset "sdwan-CTAP-Total-Bandwidth-Business-External"
        set data-binding "totalnum"
        set data-attr bandwidth
        set chart-style "{\"unit-style\": \"font-size: 50%;\"}"
        set protected enable
    next
    edit "sdwan-CTAP-Total-Bandwidth-nonBusiness-External"
        set disp-name "CTAP SD-WAN External Bandwidth of nonBusiness"
        set description "CTAP SD-WAN External Bandwidth of nonBusiness"
        set dataset "sdwan-CTAP-Total-Bandwidth-nonBusiness-External"
        set data-binding "totalnum"
        set data-attr bandwidth
        set chart-style "{\"unit-style\": \"font-size: 50%;\"}"
        set protected enable
    next
    edit "sdwan-CTAP-Total-Bandwidth-Network-Service-External"
        set disp-name "CTAP SD-WAN External Bandwidth of Network Service"
        set description "CTAP SD-WAN External Bandwidth of Network Service"
        set dataset "sdwan-CTAP-Total-Bandwidth-Network-Service-External"
        set data-binding "totalnum"
        set data-attr bandwidth
        set chart-style "{\"unit-style\": \"font-size: 50%;\"}"
        set protected enable
    next
    edit "sdwan-CTAP-App-With-Highest-Bandwidth"
        set disp-name "CTAP SD-WAN Application with Highest Bandwidth"
        set description "CTAP SD-WAN Application with Highest Bandwidth"
        set dataset "sdwan-CTAP-App-With-Highest-Bandwidth"
        set data-binding "app_group"
        set protected enable
    next
    edit "sdwan-CTAP-Appcat-With-Highest-Bandwidth"
        set disp-name "CTAP SD-WAN Application Category with Highest Bandwidth"
        set description "CTAP SD-WAN Application Category with Highest Bandwidth"
        set dataset "sdwan-CTAP-Appcat-With-Highest-Bandwidth"
        set data-binding "appcat"
        set protected enable
    next
    edit "sdwan-CTAP-SB-Number-of-Suspicious-Files"
        set disp-name "CTAP SD-WAN Sandbox Suspicious Files Number"
        set description "CTAP SD-WAN Sandbox Suspicious Files Number"
        set dataset "sdwan-CTAP-SB-Number-of-Suspicious-Files"
        set data-binding "total_num"
        set data-attr count
        set protected enable
    next
    edit "sdwan-CTAP-SB-Analyzed-Files-Number"
        set disp-name "CTAP SD-WAN Sandbox Analyzed Files Number"
        set description "CTAP SD-WAN Sandbox Analyzed Files Number"
        set dataset "sdwan-CTAP-SB-Analyzed-Files-Number"
        set data-binding "total_num"
        set data-attr count
        set protected enable
    next
    edit "sdwan-CTAP-Top-User-Source-By-Sessions"
        set disp-name "CTAP SD-WAN Top User Source by Session Count"
        set description "CTAP SD-WAN Top User Source by Session Count"
        set dataset "sdwan-CTAP-Top-User-Source-By-Sessions"
        set data-binding "user_src"
        set protected enable
    next
    edit "sdwan-CTAP-Top-User-Source-By-Bandwidth"
        set disp-name "CTAP SD-WAN Top User Source by Bandwidth"
        set description "CTAP SD-WAN Top User Source by Bandwidth"
        set dataset "sdwan-CTAP-Top-User-Source-By-Bandwidth"
        set data-binding "user_src"
        set protected enable
    next
    edit "sdwan-CTAP-Top-Bandwidth-Day"
        set disp-name "CTAP SD-WAN Top Day of Bandwidth Usage"
        set description "CTAP SD-WAN Top Day of Bandwidth Usage"
        set dataset "sdwan-CTAP-Top-Bandwidth-Day"
        set data-binding "hour_span"
        set protected enable
    next
    edit "sdwan-CTAP-Avg-Log-Rate-Overall"
        set disp-name "CTAP SD-WAN Overall Average Log Rate"
        set description "CTAP SD-WAN Overall Average Log Rate"
        set dataset "sdwan-CTAP-Avg-Log-Rate-Overall"
        set data-binding "log_rate"
        set data-attr count
        set protected enable
    next
    edit "sdwan-CTAP-event-Usage-CPU-Overall"
        set disp-name "CTAP SD-WAN Overall Average CPU Usage"
        set description "CTAP SD-WAN Overall Average CPU Usage"
        set dataset "sdwan-CTAP-event-Usage-CPU-Overall"
        set data-binding "cpu_avg_usage"
        set data-attr percent
        set protected enable
    next
    edit "sdwan-CTAP-event-Usage-Mem-Overall"
        set disp-name "CTAP SD-WAN Overall Average Memory Usage"
        set description "CTAP SD-WAN Overall Average Memory Usage"
        set dataset "sdwan-CTAP-event-Usage-Mem-Overall"
        set data-binding "mem_avg_usage"
        set data-attr percent
        set protected enable
    next
    edit "intf-Total-Samples"
        set disp-name "Interface Total Number of Samples"
        set description "Interface Total Number of Samples"
        set dataset "intf-Util-Analysis"
        set data-binding "total"
        set protected enable
    next
    edit "intf-95th-mbps"
        set disp-name "Interface 95th Mbps"
        set description "Interface 95th Mbps"
        set dataset "intf-Util-Analysis"
        set data-binding "ref_mbps"
        set protected enable
    next
    edit "daily-Summary-Total-Bandwidth"
        set disp-name "Daily Summary Total Bandwidth"
        set description "Daily Summary Total Bandwidth"
        set dataset "daily-Summary-Total-Bandwidth"
        set data-binding "totalnum"
        set data-attr bandwidth
        set chart-style "{\"unit-style\": \"font-size: 50%;\"}"
        set protected enable
    next
    edit "ueba-User-Count"
        set disp-name "User Total Count"
        set description "User Total Count"
        set dataset "ueba-User-Count"
        set data-binding "count"
        set data-attr count
        set protected enable
    next
    edit "dns-Security-Top-Queried-Domain"
        set disp-name "Mostly Queried Domain"
        set description "Mostly Queried Domain"
        set dataset "dns-Top-Queried-Domain"
        set data-binding "qname"
        set protected enable
    next
    edit "dns-Security-Top-Malicious-IP"
        set disp-name "Top Malicious IP"
        set description "Top Malicious IP"
        set dataset "dns-Security-Top-Malicious-IP"
        set data-binding "srcip"
        set protected enable
    next
    edit "dns-Security-Count-of-Domains-Blocked"
        set disp-name "Count of Domains Blocked"
        set description "Count of Domains Blocked"
        set dataset "dns-Security-Count-of-Domains-Blocked"
        set data-binding "total_num"
        set data-attr count
        set protected enable
    next
    edit "dns-Security-Top-Domain-with-Botnet-CC-Detected"
        set disp-name "Top Domain with Botnet Command-and-Control Detected"
        set description "Top Domain with Botnet C&C Detected"
        set dataset "dns-Security-Top-Domain-with-Botnet-CC-Detected"
        set data-binding "qname"
        set protected enable
    next
    edit "dns-Security-Top-One-DNS-High-Risk-Source-IP"
        set disp-name "Top One DNS High Risk Source IP"
        set description "Top One DNS High Risk Source IP"
        set dataset "dns-Security-Top-DNS-High-Risk-Source-IP"
        set data-binding "srcip"
        set protected enable
    next
    edit "360-security-Rating-Asset-Endpoint-Total-Count"
        set disp-name "Asset Endpoint Total Count"
        set description "Asset Endpoint Total Count"
        set dataset "360-security-Rating-Asset-Endpoint-Total-Count"
        set data-binding "total_num"
        set protected enable
    next
    edit "360-security-Rating-Posture-Stats-Average-Total-Score"
        set disp-name "Posture Security Rating Statistic Average Total Score"
        set description "Posture Security Rating Statistic Average Total Score"
        set dataset "360-security-Rating-Posture-Stats-Average-Total-Score"
        set data-binding "avg_score"
        set protected enable
    next
    edit "360-security-Rating-Coverage-Stats-Average-Total-Score"
        set disp-name "Coverage Security Rating Statistic Average Total Score"
        set description "Coverage Security Rating Statistic Average Total Score"
        set dataset "360-security-Rating-Coverage-Stats-Average-Total-Score"
        set data-binding "avg_score"
        set protected enable
    next
    edit "360-security-Rating-Optimize-Stats-Average-Total-Score"
        set disp-name "Optimization Security Rating Statistic Average Total Score"
        set description "Optimization Security Rating Statistic Average Total Score"
        set dataset "360-security-Rating-Optimize-Stats-Average-Total-Score"
        set data-binding "avg_score"
        set protected enable
    next
    edit "360-security-Rating-Posture-Stats-Average-Total-Grade"
        set disp-name "Posture Security Rating Statistic Average Total Grade"
        set description "Posture Security Rating Statistic Average Total Grade"
        set dataset "360-security-Rating-Posture-Stats-Average-Total-Grade"
        set data-binding "total_grade"
        set data-attr security-grade
        set protected enable
    next
    edit "360-security-Rating-Coverage-Stats-Average-Total-Grade"
        set disp-name "Coverage Security Rating Statistic Average Total Grade"
        set description "Coverage Security Rating Statistic Average Total Grade"
        set dataset "360-security-Rating-Coverage-Stats-Average-Total-Grade"
        set data-binding "total_grade"
        set data-attr security-grade
        set protected enable
    next
    edit "360-security-Rating-Optimize-Stats-Average-Total-Grade"
        set disp-name "Optimization Security Rating Statistic Average Total Grade"
        set description "Optimization Security Rating Statistic Average Total Grade"
        set dataset "360-security-Rating-Optimize-Stats-Average-Total-Grade"
        set data-binding "total_grade"
        set data-attr security-grade
        set protected enable
    next
    edit "360-security-Rating-Posture-fabricHardening-Avg-Grade"
        set disp-name "Posture Fabric Security Hardening Statistic Average Grade"
        set description "Posture Fabric Security Hardening Statistic Average Grade"
        set dataset "360-security-Rating-Posture-fabricHardening-Avg-Grade"
        set data-binding "grade_value"
        set data-attr security-grade
        set protected enable
    next
    edit "360-security-Rating-Posture-auditLoggingMonitoring-Avg-Grade"
        set disp-name "Posture Audit Logging and Monitoring Statistic Average Grade"
        set description "Posture Audit Logging and Monitoring Statistic Average Grade"
        set dataset "360-security-Rating-Posture-auditLoggingMonitoring-Avg-Grade"
        set data-binding "grade_value"
        set data-attr security-grade
        set protected enable
    next
    edit "360-security-Rating-Posture-threatManagement-Avg-Grade"
        set disp-name "Posture Threat and Vulnerability Management Statistic Average Grade"
        set description "Posture Threat and Vulnerability Management Statistic Average Grade"
        set dataset "360-security-Rating-Posture-threatManagement-Avg-Grade"
        set data-binding "grade_value"
        set data-attr security-grade
        set protected enable
    next
    edit "360-security-Rating-Posture-networkDesign-Avg-Grade"
        set disp-name "Posture Network Design and Policies Statistic Average Grade"
        set description "Posture Network Design and Policies Statistic Average Grade"
        set dataset "360-security-Rating-Posture-networkDesign-Avg-Grade"
        set data-binding "grade_value"
        set data-attr security-grade
        set protected enable
    next
    edit "360-security-Rating-Posture-endpointManagement-Avg-Grade"
        set disp-name "Posture Endpoint Management Statistic Average Grade"
        set description "Posture Endpoint Management Statistic Average Grade"
        set dataset "360-security-Rating-Posture-endpointManagement-Avg-Grade"
        set data-binding "grade_value"
        set data-attr security-grade
        set protected enable
    next
    edit "360-security-Rating-Posture-firmwareSubscriptions-Avg-Grade"
        set disp-name "Posture Firmware and Subscriptions Statistic Average Grade"
        set description "Posture Firmware and Subscriptions Statistic Average Grade"
        set dataset "360-security-Rating-Posture-firmwareSubscriptions-Avg-Grade"
        set data-binding "grade_value"
        set data-attr security-grade
        set protected enable
    next
    edit "360-security-Rating-Coverage-firmwareSubscriptions-Avg-Grade"
        set disp-name "Coverage Firmware and Subscriptions Statistic Average Grade"
        set description "Coverage Firmware and Subscriptions Statistic Average Grade"
        set dataset "360-security-Rating-Coverage-firmwareSubscriptions-Avg-Grade"
        set data-binding "grade_value"
        set data-attr security-grade
        set protected enable
    next
    edit "360-security-Rating-Coverage-auditLoggingMonitoring-Avg-Grade"
        set disp-name "Coverage Audit Logging and Monitoring Statistic Average Grade"
        set description "Coverage Audit Logging and Monitoring Statistic Average Grade"
        set dataset "360-security-Rating-Coverage-auditLoggingMonitoring-Avg-Grade"
        set data-binding "grade_value"
        set data-attr security-grade
        set protected enable
    next
    edit "360-security-Rating-Coverage-threatManagement-Avg-Grade"
        set disp-name "Coverage Threat and Vulnerability Management Statistic Average Grade"
        set description "Coverage Threat and Vulnerability Management Statistic Average Grade"
        set dataset "360-security-Rating-Coverage-threatManagement-Avg-Grade"
        set data-binding "grade_value"
        set data-attr security-grade
        set protected enable
    next
    edit "360-security-Rating-Coverage-networkDesign-Avg-Grade"
        set disp-name "Coverage Network Design and Policies Statistic Average Grade"
        set description "Coverage Network Design and Policies Statistic Average Grade"
        set dataset "360-security-Rating-Coverage-networkDesign-Avg-Grade"
        set data-binding "grade_value"
        set data-attr security-grade
        set protected enable
    next
    edit "360-security-Rating-Optimize-performanceOptimization-Avg-Grade"
        set disp-name "Optimization Performance Optimization Statistic Average Grade"
        set description "Optimization Performance Optimization Statistic Average Grade"
        set dataset "360-security-Rating-Optimize-performanceOptimization-Avg-Grade"
        set data-binding "grade_value"
        set data-attr security-grade
        set protected enable
    next
    edit "360-security-Rating-Optimize-networkDesign-Avg-Grade"
        set disp-name "Optimization Network Design and Policies Statistic Average Grade"
        set description "Optimization Network Design and Policies Statistic Average Grade"
        set dataset "360-security-Rating-Optimize-networkDesign-Avg-Grade"
        set data-binding "grade_value"
        set data-attr security-grade
        set protected enable
    next
    edit "360-security-Rating-Optimize-firmwareSubscriptions-Avg-Grade"
        set disp-name "Optimization Firmware and Subscriptions Statistic Average Grade"
        set description "Optimization Firmware and Subscriptions Statistic Average Grade"
        set dataset "360-security-Rating-Optimize-firmwareSubscriptions-Avg-Grade"
        set data-binding "grade_value"
        set data-attr security-grade
        set protected enable
    next
    edit "360-security-Incidents-Total-Count"
        set disp-name "Incidents Total Count"
        set description "Incidents Total Count"
        set dataset "360-security-Incidents-Total-Count"
        set data-binding "total_num"
        set protected enable
    next
    edit "360-security-App-Visibility-Control-Total-Count"
        set disp-name "Application Visibility and Control Total Count"
        set description "Application Visibility and Control Total Count"
        set dataset "360-security-App-Visibility-Control-Total-Count"
        set data-binding "total_num"
        set protected enable
    next
    edit "360-security-Total-Malware-Detected"
        set disp-name "360-Security Total Malware Detected"
        set description "360-Security Total Malware Detected"
        set dataset "360-security-Total-Malware-Detected"
        set data-binding "total_num"
        set protected enable
    next
    edit "web-Usage-Request-Count"
        set disp-name "Web Usage Request Count"
        set description "Web Usage Request Count"
        set dataset "web-Usage-Request-Count"
        set data-binding "requests"
        set data-attr count
        set protected enable
    next
    edit "web-Usage-Application-Count"
        set disp-name "Web Usage Application Count"
        set description "Web Usage Application Count"
        set dataset "web-Usage-Application-Count"
        set data-binding "total_num"
        set data-attr count
        set protected enable
    next
    edit "web-Usage-Category-Count"
        set disp-name "Web Usage Category Count"
        set description "Web Usage Category Count"
        set dataset "web-Usage-Category-Count"
        set data-binding "total_num"
        set data-attr count
        set protected enable
    next
    edit "web-Usage-User-Count"
        set disp-name "Web Usage User Count"
        set description "Web Usage User Count"
        set dataset "web-Usage-User-Count"
        set data-binding "total_num"
        set data-attr count
        set protected enable
    next
    edit "web-Usage-Malicious-Websites-Count"
        set disp-name "web Usage Total Malicious Websites Count"
        set description "web Usage Total Malicious Websites Count"
        set dataset "CTAP-Total-Malicious-Websites-Detected"
        set data-binding "totalnum"
        set data-attr count
        set protected enable
    next
    edit "Apprisk-Ctrl-Total-Count"
        set disp-name "High Risk Applications Total Count"
        set description "High Risk Applications Total Count"
        set dataset "apprisk-ctrl-Total-High-Risk-Apps"
        set data-binding "total_num"
        set data-attr count
        set chart-style "{\"unit-style\": \"font-size: 50%;\"}"
        set protected enable
    next
    edit "Apprisk-Ctrl-Total-Threats"
        set disp-name "Application Risk Threats Total Count"
        set description "Application Risk Threats Total Count"
        set dataset "apprisk-ctrl-Total-Threats-Prevention"
        set data-binding "total_num"
        set data-attr count
        set chart-style "{\"unit-style\": \"font-size: 50%;\"}"
        set protected enable
    next
    edit "Apprisk-Ctrl-Malware-Total-Count"
        set disp-name "Application Risk Malware Total Count"
        set description "Application Risk Malware Total Count"
        set dataset "apprisk-Malware-Total-Count"
        set data-binding "totalnum"
        set data-attr count
        set chart-style "{\"unit-style\": \"font-size: 50%;\"}"
        set protected enable
    next
    edit "Apprisk-Ctrl-Total-Bandwidth"
        set disp-name "Application Risk Total Bandwidth"
        set description "Application Risk Total Bandwidth"
        set dataset "apprisk-ctrl-Total-Bandwidth"
        set data-binding "bandwidth"
        set data-attr bandwidth
        set chart-style "{\"unit-style\": \"font-size: 50%;\"}"
        set protected enable
    next
    edit "soc-summary-Event-Count"
        set disp-name "Security Event Count"
        set description "Security Event Count"
        set dataset "soc-summary-Event-Count"
        set data-binding "num_events"
        set data-attr count
        set protected enable
    next
    edit "soc-summary-Analyzed-Event-Count"
        set disp-name "Analyzed Security Event Count"
        set description "Analyzed Security Event Count"
        set dataset "soc-summary-Analyzed-Event-Count"
        set data-binding "num_analyzed"
        set data-attr count
        set protected enable
    next
    edit "soc-summary-Incident-Count"
        set disp-name "Incident Count"
        set description "Incident Count"
        set dataset "soc-summary-Incident-Count"
        set data-binding "num_inc"
        set data-attr count
        set protected enable
    next
    edit "soc-summary-Affected-Endpoint-Count"
        set disp-name "Affected Endpoint Count"
        set description "Affected Endpoint Count"
        set dataset "soc-summary-Affected-Endpoint-Count"
        set data-binding "num_ep"
        set data-attr count
        set protected enable
    next
    edit "vpn-Login-Connection-Count"
        set disp-name "VPN Login Connection Count"
        set description "VPN Login Connection Count"
        set dataset "vpn-Login-Connection-Count"
        set data-binding "total_num"
        set data-attr count
        set protected enable
    next
    edit "vpn-Login-User-Count"
        set disp-name "VPN Login User Count"
        set description "VPN Login User Count"
        set dataset "vpn-Login-User-Count"
        set data-binding "num_user"
        set data-attr count
        set protected enable
    next
    edit "vpn-Total-Login-Attempt-Count"
        set disp-name "VPN Login Attempt Count"
        set description "VPN Login Attempt Count"
        set dataset "vpn-Total-Login-Attempt-Count"
        set data-binding "total_num"
        set data-attr count
        set protected enable
    next
    edit "vpn-Failed-Login-Attempt-Count"
        set disp-name "VPN Failed Login Attempts"
        set description "VPN Failed Login Attempts"
        set dataset "vpn-Failed-Login-Attempt-Count"
        set data-binding "total_num"
        set data-attr count
        set protected enable
    next
    edit "vpn-Login-Total-Bandwidth-Used"
        set disp-name "VPN Login Total Bandwidth Used"
        set description "VPN Login Total Bandwidth Used"
        set dataset "vpn-Login-Total-Bandwidth-Used"
        set data-binding "total_bandwidth"
        set data-attr bandwidth
        set protected enable
    next
    edit "bandwidth-app-Total-Application-Count"
        set disp-name "Total Application Count"
        set description "Total Application Count"
        set dataset "bandwidth-app-Detailed-Traffic-Statistics"
        set data-binding "total_app"
        set data-attr count
        set protected enable
    next
    edit "bandwidth-app-Total-Application-Category-Count"
        set disp-name "Total Application Category Count"
        set description "Total Application Category Count"
        set dataset "bandwidth-app-Detailed-Traffic-Statistics"
        set data-binding "total_appcat"
        set data-attr count
        set protected enable
    next
    edit "bandwidth-app-Top-Application-Category"
        set disp-name "Application Category with Highest Bandwidth"
        set description "Application Category with Highest Bandwidth"
        set dataset "bandwidth-app-App-Category-by-Avg-Bandwidth"
        set data-binding "appcat"
        set protected enable
    next
    edit "bandwidth-app-Total-User-Count"
        set disp-name "Total User Count"
        set description "Total User Count"
        set dataset "bandwidth-app-Detailed-Traffic-Statistics"
        set data-binding "total_users"
        set data-attr count
        set protected enable
    next
    edit "bandwidth-app-Total-Endpoint-Count"
        set disp-name "Total Endpoint Count"
        set description "Total Endpoint Count"
        set dataset "bandwidth-app-Detailed-Traffic-Statistics"
        set data-binding "total_endpoint"
        set data-attr count
        set protected enable
    next
    edit "bandwidth-app-Total-Destination-Count"
        set disp-name "Total Destination Count"
        set description "Total Destination Count"
        set dataset "bandwidth-app-Detailed-Traffic-Statistics"
        set data-binding "total_dest"
        set data-attr count
        set protected enable
    next
    edit "bandwidth-app-Total-Session-Count"
        set disp-name "Total Session Count"
        set description "Total Session Count"
        set dataset "bandwidth-app-Detailed-Traffic-Statistics"
        set data-binding "total_sessions"
        set data-attr count
        set protected enable
    next
    edit "bandwidth-app-Average-Session-Count"
        set disp-name "Average Session Count"
        set description "Average Session Count"
        set dataset "bandwidth-app-Detailed-Traffic-Statistics"
        set data-binding "ave_session"
        set data-attr count
        set protected enable
    next
    edit "bandwidth-app-Most-Active-Date"
        set disp-name "Most Active Date by Sessions"
        set description "Most Active Date by Sessions"
        set dataset "bandwidth-app-Most-Active-Date-by-Sessions"
        set data-binding "active_date"
        set protected enable
    next
    edit "bandwidth-app-Total-Bandwidth"
        set disp-name "Total Application Traffic Usage"
        set description "Total Application Traffic Usage"
        set dataset "bandwidth-app-Detailed-Traffic-Statistics"
        set data-binding "total_bandwidth"
        set data-attr bandwidth
        set protected enable
    next
    edit "bandwidth-app-Average-Bandwidth"
        set disp-name "Daily Application Traffic Usage"
        set description "Daily Application Traffic Usage"
        set dataset "bandwidth-app-Detailed-Traffic-Statistics"
        set data-binding "ave_bandwidth"
        set data-attr bandwidth
        set protected enable
    next
    edit "bandwidth-app-Top-App-Category-Average-Bandwidth"
        set disp-name "Daily Traffic Usage of Most Bandwidth Application Category"
        set description "Daily Traffic Usage of Most Bandwidth Application Category"
        set dataset "bandwidth-app-App-Category-by-Avg-Bandwidth"
        set data-binding "ave_bandwidth"
        set data-attr bandwidth
        set protected enable
    next
    edit "self-harm-Risky-Term-User-Count"
        set disp-name "User Count of Self-Harm Risky Terms"
        set description "User Count of Self-Harm Risky Terms"
        set dataset "self-harm-Risky-Term-User-Count"
        set data-binding "num_user"
        set protected enable
    next
    edit "self-harm-Risky-Term-Indicator-Count"
        set disp-name "Indicator Count of Self-Harm Risky Terms"
        set description "Indicator Count of Self-Harm Risky Terms"
        set dataset "self-harm-Risky-Term-Indicator-Count"
        set data-binding "requests"
        set protected enable
    next
    edit "self-harm-Risky-Term-App-Count"
        set disp-name "App Count of Self-Harm Risky Terms"
        set description "App Count of Self-Harm Risky Terms"
        set dataset "self-harm-Risky-Term-App-Count"
        set data-binding "num_app"
        set protected enable
    next
end



config sql-report layout
    edit 1000050001
        set is-template enable
        set category "Security"
        set title "Template - Security Analysis"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Security Analysis of traffic, application, user, destination, bandwidth and sessions. DHCP, Wifi, traffic history. Web usage by users, categories and sites. Top email by senders, recipients. Malware, botnet, intrusion detections, victims and sources. VPN usage. Admin Login and system events."
        set body "<h1>Bandwidth and Applications</h1><fazchart mkey=\"Traffic-Bandwidth-Summary-Day-Of-Month\" title=\"Traffic Bandwidth\" width=\"100%\"></fazchart><fazchart mkey=\"Session-Summary-Day-Of-Month\" title=\"Number of Sessions\" width=\"100%\"></fazchart><fazchart mkey=\"Top-App-By-Bandwidth\" title=\"Top Applications by Bandwidth\" width=\"100%\"></fazchart><fazchart mkey=\"Top-App-By-Sessions\" title=\"Top Applications by Sessions\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Users-By-Bandwidth\" title=\"{default}\" width=\"100%\"></fazchart><fazchart mkey=\"Top-User-Source-By-Sessions\" title=\"{default}\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Destination-Addresses-By-Bandwidth\" title=\"Top Destination by Bandwidth\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Destination-Addresses-By-Sessions\" title=\"Top Destination by Sessions\" width=\"100%\"></fazchart><fazchart mkey=\"DHCP-Summary-By-Port\" title=\"DHCP Summary\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Wifi-Client-By-Bandwidth\" title=\"Top Wifi Client by Bandwidth\" width=\"100%\"></fazchart><fazchart mkey=\"Traffic-History-By-Active-User\" title=\"Traffic History by Number of Active Users\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Web Usage</h1><fazchart mkey=\"webfilter-Top-Web-Users-By-Allowed-Requests\" title=\"Top 20 Most Active Users\" width=\"100%\"></fazchart><fazchart mkey=\"webfilter-Top-Allowed-Web-Categories\" title=\"Top 20 Most Visited Categories\" width=\"100%\"></fazchart><fazchart mkey=\"webfilter-Top-Allowed-Web-Sites-By-Requests\" title=\"Top 50 Most Visited Sites\" width=\"100%\"></fazchart><fazchart mkey=\"Top-10-Users-Browsing-Time\" title=\"Top 10 Online Users\" width=\"100%\"></fazchart><fazchart mkey=\"traffic-Top-10-Categories-By-Browsing-Time\" title=\"Top 10 Categories\" width=\"100%\"></fazchart><fazchart mkey=\"traffic-Top-50-Sites-By-Browsing-Time\" title=\"Top 50 Sites By Browsing Time\" width=\"100%\"></fazchart><fazchart mkey=\"Top-20-Web-Users-By-Bandwidth\" title=\"{default}\" width=\"100%\"></fazchart><fazchart mkey=\"Top-20-Categories-By-Bandwidth\" title=\"Top 20 Categories By Bandwidth\" width=\"100%\"></fazchart><fazchart mkey=\"Top-50-Websites-By-Bandwidth\" title=\"Top 50 Sites (and Category) by Bandwidth\" width=\"100%\"></fazchart><fazchart mkey=\"webfilter-Top-Web-Users-By-Blocked-Requests\" title=\"Top 20 Most Blocked Users\" width=\"100%\"></fazchart><fazchart mkey=\"webfilter-Top-Blocked-Web-Categories\" title=\"Top 20 Most Blocked Categories\" width=\"100%\"></fazchart><fazchart mkey=\"webfilter-Top-Blocked-Web-Sites-By-Requests\" title=\"Top 50 Most Blocked Sites\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Emails</h1><fazchart mkey=\"Top-Email-Senders-By-Count\" title=\"Top Senders by Number of Emails\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Email-Receivers-By-Count\" title=\"Top Recipients by Number of Emails\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Email-Senders-By-Bandwidth\" title=\"Top Senders by Combined Email Size\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Email-Receivers-By-Bandwidth\" title=\"Top Recipients by Combined Email Size\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Threats</h1><fazchart mkey=\"Top-Malware-By-Name\" title=\"Malware Detected\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Virus-Victim\" title=\"Malware Victims\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Virus-Source\" title=\"Malware Source\" width=\"100%\"></fazchart><fazchart mkey=\"Detected-Botnet\" title=\"Botnet Detected\" width=\"100%\"></fazchart><fazchart mkey=\"Botnet-Victims\" title=\"{default}\" width=\"100%\"></fazchart><fazchart mkey=\"Botnet-Sources\" title=\"Botnet C&C\" width=\"100%\"></fazchart><fazchart mkey=\"Dns-Detected-Botnet\" title=\"Botnet C&C Detected by DNS Filtering\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Attacks-Detected\" title=\"Intrusions Detected\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Attack-Victim\" title=\"Intrusion Victims\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Attack-Source\" title=\"Intrusion Sources\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>VPN Usage</h1><fazchart mkey=\"vpn-Traffic-Usage-Trend-VPN-Summary\" title=\"{default}\" width=\"100%\"></fazchart><fazchart mkey=\"vpn-User-Login-history\" title=\"VPN User Logins\" width=\"100%\"></fazchart><fazchart mkey=\"vpn-Authenticated-Logins\" title=\"Authenticated Logins\" width=\"100%\"></fazchart><fazchart mkey=\"vpn-Failed-Login-Atempts\" title=\"Failed Login Attempts\" width=\"100%\"></fazchart><fazchart mkey=\"vpn-Top-Dial-Up-VPN-Users-By-Duration\" title=\"Top Dial-up VPN Users\" width=\"100%\"></fazchart><fazchart mkey=\"default-Top-Sources-Of-SSL-VPN-Tunnels-By-Bandwidth\" title=\"Top Sources of SSL VPN Tunnels by Bandwidth\" width=\"100%\"></fazchart><fazchart mkey=\"Top-SSL-VPN-Tunnel-Users-By-Bandwidth\" title=\"Top SSL VPN Tunnel Users by Bandwidth\" width=\"100%\"></fazchart><fazchart mkey=\"Top-SSL-VPN-Web-Mode-Users-By-Duration\" title=\"Top SSL VPN Web Mode Users by Duration\" width=\"100%\"></fazchart><fazchart mkey=\"Top-SSL-VPN-Users-By-Duration\" title=\"Top SSL VPN Users by Duration\" width=\"100%\"></fazchart><fazchart mkey=\"default-Top-IPSEC-Vpn-Dial-Up-User-By-Bandwidth\" title=\"Top Users of IPsec VPN Dial-up Tunnel by Bandwidth\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Static-IPSEC-Tunnels-By-Bandwidth\" title=\"{default}\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Dial-Up-IPSEC-Tunnels-By-Bandwidth\" title=\"{default}\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Dial-Up-IPSEC-Users-By-Bandwidth\" title=\"{default}\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Dial-Up-IPSEC-Users-By-Duration\" title=\"{default}\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Admin Login and System Events</h1><fazchart mkey=\"Admin-Login-Summary\" title=\"Login Summary\" width=\"100%\"></fazchart><fazchart mkey=\"Admin-Login-Summary-By-Date\" title=\"Login Summary By Date\" width=\"100%\"></fazchart><fazchart mkey=\"Admin-Failed-Login-Summary\" title=\"List of Failed Logins\" width=\"100%\"></fazchart><fazchart mkey=\"System-Summary-By-Severity\" title=\"Events by Severity\" width=\"100%\"></fazchart><fazchart mkey=\"System-Summary-By-Date\" title=\"Events by Date\" width=\"100%\"></fazchart><fazchart mkey=\"System-Critical-Severity-Events\" title=\"Critical Severity Events\" width=\"100%\"></fazchart><fazchart mkey=\"System-High-Severity-Events\" title=\"High Severity Events\" width=\"100%\"></fazchart><fazchart mkey=\"System-Medium-Severity-Events\" title=\"Medium Severity Events\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90203
                next
            end
        set protected enable
    next
    edit 1000050002
        set is-template enable
        set category "User"
        set title "Template - Client Reputation"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Client and user network behaviour, incidents by user, devices, threat summary."
        set body "<h1>Summary for Users and Devices</h1><fazchart mkey=\"Score-Summary-For-All-Users-Devices\" title=\"Score Summary for All Users\/Devices\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Users-By-Reputation-Scores\" title=\"Top Users by Reputation Scores\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Users-With-Increased-Scores\" title=\"Top Users with Increased Scores for Last 2 Periods\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"Number-Of-Incidents-For-All-Users-Devices\" title=\"Number of Incidents for All Users\/Devices\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Devices-By-Reputation-Scores\" title=\"Top Devices by Reputation Scores\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Devices-With-Increased-Scores\" title=\"Top Devices with Increased Scores for Last 2 Periods\" filter-logic=\"and\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90203
                next
            end
        set protected enable
    next
    edit 1000050003
        set is-template enable
        set category "Security"
        set title "Template - Wireless PCI Compliance"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Managed, unclassified, AP Detection summary. On-wire and off-wire - rogue, suppressed, accepted, unclassified APs."
        set body "<h1>Report Overview</h1><p> This report is designed to help meet the PCI DSS 3.1 section 11 requirement: Regularly test security systems and processes.<br/><br/> Section 11.1 of the PCI DSS 3.1 standard provides the following guidance:</p><p style=\"margin-left: 40px;\"> Implementation and/or exploitation of wireless technology within a network are some of the most common paths for malicious users to gain access to the network and cardholder data. If a wireless device or network is installed without a company&#39;s knowledge, it can allow an attacker to easily and &quot;invisibly&quot; enter the network.</p><p style=\"margin-left: 40px;\"> Unauthorized wireless devices may be hidden within or attached to a computer or other system component, or be attached directly to a network port or network device, such as a switch or router. Any such unauthorized device could result in an unauthorized access point into the environment.</p><p style=\"margin-left: 40px;\"> Knowing which wireless devices are authorized can help administrators quickly identify non-authorized wireless devices, and responding to the identification of unauthorized wireless access points helps to proactively minimize exposure of CDE to malicious individuals.</p><p style=\"margin-left: 40px;\"> Due to the ease with which a wireless access point can be attached to a network, the difficulty in detecting their presence, and the increased risk presented by unauthorized wireless devices, these processes must be performed even when a policy exists prohibiting the use of wireless technology.</p><p> Source: https://www.pcisecuritystandards.org/documents/PCI_DSS_v3.pdf<br/><br/> Wireless access points can be a vector for attacks on your systems. Your organization needs to know the status of your access points and discover any unauthorized access points. This report provides detailed information on the status of your wireless infrastructure by reporting on Rogue APs, Suppressed APs, Accepted APs and Unclassified APs.</p><p><strong>Rogue Wireless APs</strong> are unauthorized APs attached to your wired networks. The On-Wire detection technique determines which unknown APs are rogues.<br/> In addition to monitoring rogue APs, you can actively prevent your users from connecting to them. When <strong>suppression</strong> is activated against an AP, the FortiGate WiFi controller sends deauthentication messages to the rogue AP&#39;s clients, posing as the rogue AP, and also sends deauthentication messages to the rogue AP, posing as its clients.<br/><br/><strong>Accepted Wireless APs</strong> are authorized part of your network or are neighboring APs that are not a security threat.<br/><br/><strong>Unclassified APs</strong> are the initial status of a discovered AP. You can change an AP back to unclassified if you have mistakenly marked it as Rogue or Accepted.</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Summary</h1><fazchart mkey=\"default-Managed-AP-Summary_table\" title=\"Managed AP Summary\" width=\"100%\"></fazchart><fazchart mkey=\"default-AP-Detection-Summary-by-Status-OnWire_table\" title=\"AP Detection Summary (On-Wire)\" width=\"100%\"></fazchart><fazchart mkey=\"default-AP-Detection-Summary-by-Status-OffWire_table\" title=\"AP Detection Summary (Off-Wire)\" width=\"100%\"></fazchart><fazchart mkey=\"default-Unclassified-AP-Summary_table\" title=\"Unclassified AP Summary (On-Wire + Off-Wire)\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>On-Wire APs</h1><fazchart mkey=\"event-Wireless-Rogue-Onwire\" title=\"Rogue Wireless APs\" width=\"100%\"></fazchart><fazchart mkey=\"event-Wireless-Suppressed-Onwire\" title=\"Suppressed Wireless APs\" width=\"100%\"></fazchart><fazchart mkey=\"event-Wireless-Accepted-Onwire\" title=\"Accepted Wireless APs\" width=\"100%\"></fazchart><fazchart mkey=\"event-Wireless-Unclassified-Onwire\" title=\"Unclassified Wireless APs\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Off-Wire APs</h1><fazchart mkey=\"event-Wireless-Rogue-Offwire\" title=\"Rogue Wireless APs\" width=\"100%\"></fazchart><fazchart mkey=\"event-Wireless-Suppressed-Offwire\" title=\"Suppressed Wireless APs\" width=\"100%\"></fazchart><fazchart mkey=\"event-Wireless-Accepted-Offwire\" title=\"Accepted Wireless APs\" width=\"100%\"></fazchart><fazchart mkey=\"event-Wireless-Unclassified-Offwire\" title=\"Unclassified Wireless APs\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90204
                next
            end
        set protected enable
    next
    edit 1000050004
        set is-template enable
        set category "Security"
        set title "Template - VPN Report"
        set description "VPN Traffic, authenticated and failed User logins, top VPN users. SSL VPN tunnels and IPsec VPN, users, web mode by bandwidth and duration."
        set body "<div style=\"height:15px;\"></div><h2><span style=\"font-size:18px; font-family:Lato; color:black\"> SUMMARY</span></h2><h2><span style=\"font-size:17px; font-family:Lato;\"> VPN USAGE SUMMARY</span></h2><div style=\"height:20px;\"></div><div style=\"display: -webkit-box; -webkit-box-pack: justify; width: 1000px;\"><div style=\"white-space: nowrap;\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/Connections.png\" style=\"height:24px; width:24px;\" /><b><span style=\"font-size:24px\"><fazmacro mkey=\"vpn-Login-Connection-Count\"></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato\"> Connections</span></div><div style=\"white-space: nowrap;\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/web_users.png\" style=\"height:24px; width:24px\" /><b><span style=\"font-size:24px\"><fazmacro mkey=\"vpn-Login-User-Count\"></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato\"> Users</span></div><div style=\"white-space: nowrap;\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/Login-Attempts.png\" style=\"height:24px; width:24px\" /><b><span style=\"font-size:24px\"><fazmacro mkey=\"vpn-Total-Login-Attempt-Count\"></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato\"> Login Attempts</span></div><div style=\"white-space: nowrap;\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/Failed-Logins.png\" style=\"height:24px; width:24px\" /><b><span style=\"font-size:24px\"><fazmacro mkey=\"vpn-Failed-Login-Attempt-Count\"></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato\"> Failed Logins</span></div><div style=\"white-space: nowrap;\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/Bandwidth-usage.png\" style=\"height:24px; width:24px\" /><b><span style=\"font-size:24px\"><fazmacro mkey=\"vpn-Login-Total-Bandwidth-Used\"></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato\"> Used</span></div></div><div style=\"height:35px;\"></div><table cellpadding=\"0\" cellspacing=\"0\"><tr><td><fazchart width=\"480px\" title=\"Total Connections by VPN Type\" mkey=\"vpn-Login-Connection-Count-by-Type\"></fazchart></td><td><fazchart width=\"480px\" title=\"Total Bandwidth Used by VPN Type\" mkey=\"vpn-Login-Total-Bandwidth-by-Type\"></fazchart></td></tr></table><div style=\"height:35px;\"></div><table cellpadding=\"0\" cellspacing=\"0\"><tr><td><fazchart width=\"480px\" title=\"Total Users by VPN Type\" mkey=\"vpn-Login-User-Count-by-Type\"></fazchart></td><td><fazchart width=\"480px\" title=\"Total Login Attempts\" mkey=\"vpn-Login-Attempt-by-Type\"></fazchart></td></tr></table><div style=\"page-break-after: always\"></div><div style=\"height:5px;\"></div><fazchart width=\"100%\" title=\"VPN TRAFFIC USAGE TREND\" mkey=\"vpn-Traffic-Usage-Trend\"></fazchart><div style=\"height:15px;\"></div><fazchart width=\"100%\" title=\"VPN USER LOGINS\" mkey=\"vpn-User-Login-history\"></fazchart><div style=\"page-break-after: always\"></div><div style=\"height:5px;\"></div><h2><span style=\"font-size:18px; font-family:Lato; color:black\"> AUTHENTICATED LOGINS</span></h2><div style=\"height:10px;\"></div><fazchart width=\"1000px\" title=\"Top 15 Authenticated Logins by VPN Connections\" mkey=\"vpn-Authenticated-Logins\"></fazchart><div style=\"page-break-after: always\"></div><div style=\"height:5px;\"></div><table cellpadding=\"0\" cellspacing=\"0\"><tr><td style=\"vertical-align:top\"><fazchart width=\"400px\" title=\"Failed Login Attempts by User\" mkey=\"vpn-Failed-Login-Attempt-by-User\"></fazchart></td><td style=\"vertical-align:top\"><fazchart width=\"580px\" title=\"Failed Login Attempts Time Line\" mkey=\"vpn-Failed-Login-Timeline\"></fazchart></td></tr></table><div style=\"height:5px;\"></div><fazchart width=\"1000px\" title=\"Top 10 Dial-up VPN Users\" mkey=\"vpn-Top-Dial-Up-VPN-Users-By-Duration\"></fazchart><div style=\"page-break-after: always\"></div><div style=\"height:10px;\"></div><h2><span style=\"font-size:18px; font-family:Lato; color:black\"> SSL VPN</span></h2><div style=\"height:25px;\"></div><table cellpadding=\"0\" cellspacing=\"0\"><tr><td style=\"vertical-align:top\"><fazchart width=\"450px\" title=\"Top 5 SSL VPN Tunnel Users by Duration\" mkey=\"vpn-Top-SSL-VPN-Tunnel-Duration-By-Users\"></fazchart></td><td style=\"vertical-align:top\"><fazchart width=\"550px\" title=\"Top 5 SSL VPN Tunnel Users by Bandwidth\" mkey=\"vpn-Top-SSL-VPN-Tunnel-Users-By-Traffic-Directions\"></fazchart></td></tr></table><div style=\"height:25px;\"></div><table cellpadding=\"0\" cellspacing=\"0\"><tr><td style=\"vertical-align:top\"><fazchart width=\"450px\" title=\"Top 5 SSL VPN Web Mode Users by Duration\" mkey=\"vpn-Top-SSL-VPN-Web-Mode-Users-By-Duration\"></fazchart></td><td style=\"vertical-align:top\"><fazchart width=\"550px\" title=\"Top 5 SSL VPN Web Mode Users by Bandwidth\" mkey=\"vpn-Top-SSL-VPN-Web-Mode-Users-By-Traffic-Directions\"></fazchart></td></tr></table><div style=\"page-break-after: always\"></div><div style=\"height:10px;\"></div><h2><span style=\"font-size:18px; font-family:Lato; color:black\"> IPSEC VPN</span></h2><div style=\"height:25px;\"></div><table cellpadding=\"0\" cellspacing=\"0\"><tr><td style=\"vertical-align:top\"><fazchart width=\"450px\" title=\"Top 5 Users of IPsec VPN Dial-up Tunnel by Bandwidth\" mkey=\"vpn-Top-IPsec-Vpn-Dial-Up-User-By-Bandwidth\"></fazchart></td><td style=\"vertical-align:top\"><fazchart width=\"550px\" title=\"Top 5 Site-to-Site IPsec Tunnels by Bandwidth\" mkey=\"vpn-Top-Static-IPsec-Tunnels-By-Traffic-Directions\"></fazchart></td></tr></table><div style=\"height:25px;\"></div><table cellpadding=\"0\" cellspacing=\"0\"><tr><td style=\"vertical-align:top\"><fazchart width=\"450px\" title=\"Top 5 Dial-up IPsec Users by Duration\" mkey=\"vpn-Top-Dial-Up-IPsec-Users-By-Duration\"></fazchart></td><td style=\"vertical-align:top\"><fazchart width=\"550px\" title=\"Top 5 Dial-up IPsec Tunnels by Bandwidth\" mkey=\"vpn-Top-Dial-Up-IPsec-Tunnels-By-Traffic-Directions\"></fazchart></td></tr></table>"
            config header
                edit 1
                    set type graphic
                    set graphic "header_webusage_bg.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90201
                next
            end
        set report-tag "concise"
        set protected enable
    next
    edit 1000050005
        set is-template enable
        set category "Security"
        set title "Template - Web Usage Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Web usage requests, browsing and bandwidth summary. Top active users, sites categories. Top bandwidth and most blocked."
        set body "<h1>Web Usage Summary</h1><fazchart mkey=\"webfilter-Web-Activity-Summary-By-Requests\" title=\"Requests Summary\" width=\"100%\"></fazchart><fazchart mkey=\"traffic-Browsing-Time-Summary\" title=\"Browsing Time Summary\" width=\"100%\"></fazchart><fazchart mkey=\"Traffic-Bandwidth-Summary-Day-Of-Month\" title=\"{default}\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Web Activity</h1><fazchart mkey=\"webfilter-Top-Web-Users-By-Allowed-Requests\" title=\"Top 20 Most Active Users\" width=\"100%\"></fazchart><fazchart mkey=\"webfilter-Top-Allowed-Web-Categories\" title=\"Top 20 Most Visited Categories\" width=\"100%\"></fazchart><fazchart mkey=\"webfilter-Top-Allowed-Web-Sites-By-Requests\" title=\"Top 50 Most Visited Sites\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Web Browsing</h1><fazchart mkey=\"Top-10-Users-Browsing-Time\" title=\"Top 10 Online Users\" width=\"100%\"></fazchart><fazchart mkey=\"traffic-Top-10-Categories-By-Browsing-Time\" title=\"Top 10 Categories\" width=\"100%\"></fazchart><fazchart mkey=\"traffic-Top-50-Sites-By-Browsing-Time\" title=\"Top 50 Sites By Browsing Time\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Internet Bandwidth Usage</h1><fazchart mkey=\"Top-20-Web-Users-By-Bandwidth\" title=\"{default}\" width=\"100%\"></fazchart><fazchart mkey=\"Top-20-Categories-By-Bandwidth\" title=\"Top 20 Categories By Bandwidth\" width=\"100%\"></fazchart><fazchart mkey=\"Top-50-Websites-By-Bandwidth\" title=\"Top 50 Sites (and Category) by Bandwidth\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Most Blocked</h1><fazchart mkey=\"webfilter-Top-Web-Users-By-Blocked-Requests\" title=\"Top 20 Most Blocked Users\" width=\"100%\"></fazchart><fazchart mkey=\"webfilter-Top-Blocked-Web-Categories\" title=\"Top 20 Most Blocked Categories\" width=\"100%\"></fazchart><fazchart mkey=\"webfilter-Top-Blocked-Web-Sites-By-Requests\" title=\"Top 50 Most Blocked Sites\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
            end
        set protected enable
    next
    edit 1000050007
        set is-template enable
        set category "Security"
        set title "Template - WiFi Network Summary"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "WiFi data transferred, distinct clients. Top APs, SSID, Application, OS, Device type, clients by usage."
        set body "<h1>Network Summary</h1><fazchart mkey=\"wifi-Overall-Traffic\" title=\"Overall Data Transferred\" width=\"100%\"></fazchart><fazchart mkey=\"wifi-Num-Distinct-Client\" title=\"Number of Distinct Clients\" width=\"100%\"></fazchart><h1>Wireless Usage and Clients</h1><fazchart mkey=\"wifi-Top-AP-By-Bandwidth\" title=\"Top APs by Usage\" width=\"100%\"></fazchart><fazchart mkey=\"wifi-Top-SSID-By-Bandwidth\" title=\"SSID Usage\" width=\"100%\"></fazchart><fazchart mkey=\"wifi-Top-App-By-Bandwidth\" title=\"Top Application by Usage\" width=\"100%\"></fazchart><fazchart mkey=\"wifi-Top-OS-By-Bandwidth\" title=\"Top Operating Systems by Usage\" width=\"100%\"></fazchart><fazchart mkey=\"wifi-Top-Device-By-Bandwidth\" title=\"Top Device Type by Usage\" width=\"100%\"></fazchart><fazchart mkey=\"wifi-Top-AP-By-Client\" title=\"Top APs by Number of Clients\" width=\"100%\"></fazchart><fazchart mkey=\"wifi-Top-SSID-By-Client\" title=\"Top SSID By Number of Clients\" width=\"100%\"></fazchart><fazchart mkey=\"wifi-Top-Client-By-Bandwidth\" title=\"Top Clients by Usage\" width=\"100%\"></fazchart><fazchart mkey=\"wifi-Top-OS-By-WiFi-Client\" title=\"Top Operating Systems by Number of WiFi Clients\" width=\"100%\"></fazchart><fazchart mkey=\"wifi-Top-Device-By-Client\" title=\"Top Device Type by Number of Clients\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90201
                next
            end
        set protected enable
    next
    edit 1000060000
        set is-template enable
        set category "User"
        set title "Template - User Security Analysis"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "User Security Analysis of Blocked and Allowed sites, categories. Top attacks by severity. Top Viruses and receivers by email. Spam counts and sources."
        set body "<h1>User Security Analysis</h1><fazchart mkey=\"user-drilldown-Top-Blocked-Web-Sites-By-Requests\" title=\"Top Blocked Web Sites\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"user-drilldown-Top-Allowed-Web-Sites-By-Requests\" title=\"Top Allowed Web Sites\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"user-drilldown-Top-Blocked-Web-Categories\" title=\"Top Blocked Web Categories\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"user-drilldown-Top-Allowed-Web-Categories\" title=\"Top Allowed Web Categories\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"user-drilldown-Top-Attacks\" title=\"Top Attacks\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"user-drilldown-Top-Attacks-High-Severity\" title=\"Top Attacks with High Severity\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"user-drilldown-Top-Virus-By-Name\" title=\"Top Viruses\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"user-drilldown-Top-Virus-Receivers-Over-Email\" title=\"Top Virus Receivers Over Email\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"user-drilldown-Count-Spam-Activity-by-Hour-of-Day\" title=\"Count of Spam Activity by Hour of Day\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"user-drilldown-Top-Spam-Sources\" title=\"Top Spam Sources\" filter-logic=\"and\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90202
                next
                edit 90203
                next
            end
        set protected enable
    next
    edit 1000060002
        set is-template enable
        set category "Application"
        set title "Template - Bandwidth and Applications Report"
        set description "Traffic, Bandwidth, Sessions, Destinations summaries - by users and applications"
        set body "<div style=\"height:5px\"></div><h2><span style=\"font-size:18px; font-family:Lato; color:black\"> SUMMARY</span></h2><h2><span style=\"font-size:14px\">Fortinet Bandwidth Application Report provides visibility for identifying the applications and users on your network that are consuming the most bandwidth and introducing the most risk. This report summarizes the findings and provides an overall risk assessment with recommended actions.</span></h2><div style=\"height:25px\"></div><h2><span style=\"font-size:18px; font-family:Lato; color:black\">TRAFFIC STATISTIC</span></h2><div style=\"height:5px\"></div><table style=\"width:100%\" align=\"center\" cellpadding=\"10px\" cellspacing=\"5px\"><tr><td style=\"width:25%; vertical-align:top\"><div style=\"width:100%; height:195px; border-width:2px; border-style:solid; border-color:lightgray; border-image-source:initial; border-image-slice:initial; border-image-width:initial; border-image-outset:initial; border-image-repeat:initial; border-top-left-radius:10px; border-top-right-radius:10px; border-bottom-right-radius:10px; border-bottom-left-radius:10px\"><div style=\"padding-top:10px; padding-left:7px; padding-right:5px\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/band_app_application.png\" style=\"width:28px; height:28px; float:left;\" /><span style=\"padding-left:8px; position:relative; bottom:0px; font-size:26px; font-family:Lato; color:black\"><fazmacro mkey=\"bandwidth-app-Total-Application-Count\"></fazmacro></span></div><div style=\"padding-top:0px; padding-left:40px; padding-right:5px\"><span style=\"font-size:15px; font-family:Lato; color:black\">Applications</span></div><div style=\"padding-top:20px; padding-left:40px; padding-right:5px\"><span style=\"padding-left:2px; position:relative; bottom:0px; font-size:18px; font-family:Lato; color:black\"><fazmacro mkey=\"bandwidth-app-Total-Application-Category-Count\"></fazmacro></span></div><div style=\"padding-top:0px; padding-left:40px; padding-right:5px\"><span style=\"font-size:12.5px; font-family:Lato; color:black\">Categories</span></div><div style=\"padding-top:10px; padding-left:40px; padding-right:5px\"><span style=\"padding-left:2px; position:relative; bottom:0px; font-size:18px; font-family:Lato; color:black\"><fazmacro mkey=\"bandwidth-app-Top-Application-Category\"><fazfilters><fazfilter field=\"appcat\" oper=\"neq\" value=\"Not.Scanned\"></fazfilter><fazfilter field=\"appcat\" oper=\"neq\" value=\"unscanned\"></fazfilter></fazfilters></fazmacro></span></div><div style=\"padding-top:0px; padding-left:40px; padding-right:5px\"><span style=\"font-size:12.5px; font-family:Lato; color:black\">Used Most Bandwidth</span></div></div></td><td style=\"width:25%; vertical-align:top\"><div style=\"width:100%; height:195px; border-width:2px; border-style:solid; border-color:lightgray; border-image-source:initial; border-image-slice:initial; border-image-width:initial; border-image-outset:initial; border-image-repeat:initial; border-top-left-radius:10px; border-top-right-radius:10px; border-bottom-right-radius:10px; border-bottom-left-radius:10px\"><div style=\"padding-top:10px; padding-left:7px; padding-right:5px\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/web_users.png\" style=\"width:28px; height:28px; float:left;\" /><span style=\"padding-left:8px; position:relative; bottom:0px; font-size:26px; font-family:Lato; color:black\"><fazmacro mkey=\"bandwidth-app-Total-User-Count\"></fazmacro></span></div><div style=\"padding-top:0px; padding-left:40px; padding-right:5px\"><span style=\"font-size:15px; font-family:Lato; color:black\">Users</span></div><div style=\"padding-top:20px; padding-left:40px; padding-right:5px\"><span style=\"padding-left:2px; position:relative; bottom:0px; font-size:18px; font-family:Lato; color:black\"><fazmacro mkey=\"bandwidth-app-Total-Endpoint-Count\"></fazmacro></span></div><div style=\"padding-top:0px; padding-left:40px; padding-right:5px\"><span style=\"font-size:12.5px; font-family:Lato; color:black\">Endpoints</span></div><div style=\"padding-top:10px; padding-left:40px; padding-right:5px\"><span style=\"padding-left:2px; position:relative; bottom:0px; font-size:18px; font-family:Lato; color:black\"><fazmacro mkey=\"bandwidth-app-Total-Destination-Count\"></fazmacro></span></div><div style=\"padding-top:0px; padding-left:40px; padding-right:5px\"><span style=\"font-size:12.5px; font-family:Lato; color:black\">Destinations</span></div></div></td><td style=\"width:25%; vertical-align:top\"><div style=\"width:100%; height:195px; border-width:2px; border-style:solid; border-color:lightgray; border-image-source:initial; border-image-slice:initial; border-image-width:initial; border-image-outset:initial; border-image-repeat:initial; border-top-left-radius:10px; border-top-right-radius:10px; border-bottom-right-radius:10px; border-bottom-left-radius:10px\"><div style=\"padding-top:10px; padding-left:7px; padding-right:5px\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/band_app_sessions.png\" style=\"width:28px; height:28px; float:left;\" /><span style=\"padding-left:8px; position:relative; bottom:0px; font-size:26px; font-family:Lato; color:black\"><fazmacro mkey=\"bandwidth-app-Total-Session-Count\"></fazmacro></span></div><div style=\"padding-top:0px; padding-left:40px; padding-right:5px\"><span style=\"font-size:15px; font-family:Lato; color:black\">Sessions</span></div><div style=\"padding-top:20px; padding-left:40px; padding-right:5px\"><span style=\"padding-left:2px; position:relative; bottom:0px; font-size:18px; font-family:Lato; color:black\"><fazmacro mkey=\"bandwidth-app-Average-Session-Count\"></fazmacro></span></div><div style=\"padding-top:0px; padding-left:40px; padding-right:5px\"><span style=\"font-size:12.5px; font-family:Lato; color:black\">Average Sessions Per Day</span></div><div style=\"padding-top:10px; padding-left:40px; padding-right:5px\"><span style=\"padding-left:2px; position:relative; bottom:0px; font-size:18px; font-family:Lato; color:black\"><fazmacro mkey=\"bandwidth-app-Most-Active-Date\"></fazmacro></span></div><div style=\"padding-top:0px; padding-left:40px; padding-right:5px\"><span style=\"font-size:12.5px; font-family:Lato; color:black\">Most Active Date By Sessions</span></div></div></td><td style=\"width:25%; vertical-align:top\"><div style=\"width:100%; height:195px; border-width:2px; border-style:solid; border-color:lightgray; border-image-source:initial; border-image-slice:initial; border-image-width:initial; border-image-outset:initial; border-image-repeat:initial; border-top-left-radius:10px; border-top-right-radius:10px; border-bottom-right-radius:10px; border-bottom-left-radius:10px\"><div style=\"padding-top:10px; padding-left:7px; padding-right:5px\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/band_app_bytes_transferred.png\" style=\"width:28px; height:28px; float:left;\" /><span style=\"padding-left:8px; position:relative; bottom:0px; font-size:26px; font-family:Lato; color:black\"><fazmacro mkey=\"bandwidth-app-Total-Bandwidth\"></fazmacro></span></div><div style=\"padding-top:0px; padding-left:40px; padding-right:5px\"><span style=\"font-size:15px; font-family:Lato; color:black\">Bytes Transferred</span></div><div style=\"padding-top:20px; padding-left:40px; padding-right:5px\"><span style=\"padding-left:2px; position:relative; bottom:0px; font-size:18px; font-family:Lato; color:black\"><fazmacro mkey=\"bandwidth-app-Average-Bandwidth\"></fazmacro></span></div><div style=\"padding-top:0px; padding-left:40px; padding-right:5px\"><span style=\"font-size:12.5px; font-family:Lato; color:black\">Average Bytes Per Day</span></div><div style=\"padding-top:10px; padding-left:40px; padding-right:5px\"><span style=\"padding-left:2px; position:relative; bottom:0px; font-size:18px; font-family:Lato; color:black\"><fazmacro mkey=\"bandwidth-app-Top-App-Category-Average-Bandwidth\"><fazfilters><fazfilter field=\"appcat\" oper=\"neq\" value=\"Not.Scanned\"></fazfilter><fazfilter field=\"appcat\" oper=\"neq\" value=\"unscanned\"></fazfilter></fazfilters></fazmacro></span></div><div style=\"padding-top:0px; padding-left:40px; padding-right:5px\"><span style=\"font-size:12.5px; font-family:Lato; color:black\">Average per Day from <fazmacro mkey=\"bandwidth-app-Top-Application-Category\"><fazfilters><fazfilter field=\"appcat\" oper=\"neq\" value=\"Not.Scanned\"></fazfilter><fazfilter field=\"appcat\" oper=\"neq\" value=\"unscanned\"></fazfilter></fazfilters></fazmacro></span></div></div></td></tr></table><div style=\"height:15px\"></div><table style=\"width:100%\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\"><tr><td style=\"vertical-align:top; width:500px\"><fazchart width=\"500px\" title=\"BANDWIDTH SUMMARY\" mkey=\"bandwidth-app-Bandwidth-Usage-Summary\"></fazchart></td><td style=\"vertical-align:top; width:500px\"><fazchart width=\"500px\" title=\"SESSIONS SUMMARY\" mkey=\"bandwidth-app-Sessions-Summary\"></fazchart></td></tr></table><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height:5px\"></div><h2><span style=\"font-size:18px; font-family:Lato; color:black\">APPLICATION TRAFFIC</span><span></span></h2><div><fazchart width=\"1000px\" title=\"TOP 15 APPLICATIONS BY BANDWIDTH\" mkey=\"bandwidth-app-Top-App-Bandwidth-Usage\"><fazfilters><fazfilter field=\"appcat\" oper=\"neq\" value=\"Not.Scanned\"></fazfilter><fazfilter field=\"appcat\" oper=\"neq\" value=\"unscanned\"></fazfilter></fazfilters></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height:5px\"></div><div><fazchart width=\"1000px\" title=\"TOP 10 APPLICATION CATEGORIES BY BANDWIDTH\" mkey=\"bandwidth-app-Top-App-Category-By-Bandwidth\"><fazfilters><fazfilter field=\"appcat\" oper=\"neq\" value=\"Not.Scanned\"></fazfilter><fazfilter field=\"appcat\" oper=\"neq\" value=\"unscanned\"></fazfilter></fazfilters></fazchart></div><div style=\"page-break-after: always\"></div><div style=\"height:15px\"></div><h2><span style=\"font-size:18px; font-family:Lato; color:black\"> USERS</span></h2><div style=\"height:5px\"></div><div><fazchart width=\"1000px\" title=\"TOP 10 BANDWIDTH USERS\" mkey=\"bandwidth-app-Top-Bandwidth-Users\"></fazchart></div><div style=\"height:30px\"></div><div><fazchart width=\"1000px\" title=\"TOP 10 SESSIONS USERS\" mkey=\"bandwidth-app-Top-Session-Users\"></fazchart></div><div style=\"page-break-after: always\"></div><div style=\"height:25px\"></div><div><fazchart width=\"1000px\" title=\"Active Users\" mkey=\"bandwidth-app-Active-User-Count-Timeline\"></fazchart></div><div style=\"height:35px\"></div><h2><span style=\"font-size:18px; font-family:Lato; color:black\">DESTINATIONS</span></h2><div style=\"height:5px\"></div><table style=\"width:100%\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\"><tr><td style=\"vertical-align:top\"><fazchart width=\"490px\" title=\"Top 10 Destinations by Bandwidth\" mkey=\"bandwidth-app-Top-Dest-By-Bandwidth\"></fazchart></td><td style=\"vertical-align:top\"><fazchart width=\"490px\" title=\"Top 10 Destinations by Sessions\" mkey=\"bandwidth-app-Top-Dest-By-Session\"></fazchart></td></tr></table>"
            config header
                edit 1
                    set type graphic
                    set graphic "header_webusage_bg.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90200
                next
                edit 90201
                next
            end
        set report-tag "concise"
        set protected enable
    next
    edit 1000060003
        set is-template enable
        set category "Security"
        set title "Template - Email Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Email Senders and Recipients by Total Number and Size of emails."
        set body "<h1>Email Report</h1><fazchart mkey=\"Top-Email-Senders-By-Count\" title=\"Top Senders by Number of Emails\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Email-Receivers-By-Count\" title=\"Top Recipients by Number of Emails\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Email-Senders-By-Bandwidth\" title=\"Top Senders by Combined Email Size\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Email-Receivers-By-Bandwidth\" title=\"Top Recipients by Combined Email Size\" filter-logic=\"and\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90200
                next
            end
        set protected enable
    next
    edit 1000060004
        set is-template enable
        set category "System"
        set title "Template - Admin and System Events Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Admin login and failed login attempts and system severity event counts."
        set body "<h1>Admin Login</h1><fazchart mkey=\"Admin-Login-Summary\" uid=\"18be303f59e24d9da8b6b9712120ab78\" title=\"Login Summary\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"Admin-Login-Summary-By-Date\" uid=\"c91192eb3c4f43f6a3b6fb3c77841b1d\" title=\"Login Summary By Date\" filter-logic=\"and\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><fazchart mkey=\"Admin-Failed-Login-Summary\" uid=\"44722f5155124f5ba625baaef7b98962\" title=\"List of Failed Logins\" filter-logic=\"and\" width=\"100%\"></fazchart><h1>System Events</h1><fazchart mkey=\"System-Summary-By-Severity\" uid=\"f182054f74714f7b8abb811df39cd4d3\" title=\"Events by Severity\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"Important-System-Summary-By-Date\" uid=\"5594ea6cd1a9483b8923eb89e7b6f2d7\" title=\"Critical High and Medium Events by Date\" filter-logic=\"and\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><fazchart mkey=\"System-Critical-Severity-Events\" uid=\"5efb13b821734416a0fcc82765cb9650\" title=\"Critical Severity Events\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"System-High-Severity-Events\" uid=\"a67ad849b539494c81d17e89b3c6a0f3\" title=\"High Severity Events\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"System-Medium-Severity-Events\" uid=\"b450e3eb65cb4748bdcbe2c4d51fa04a\" title=\"Medium Severity Events\" filter-logic=\"and\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
            end
        set protected enable
    next
    edit 1000060006
        set is-template enable
        set category "Security"
        set title "Template - Threat Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Malware, Botnets - detected, victims and sources. Intrusions detected, sources, blocked severity and timeline."
        set body "<h1>Malware</h1><fazchart mkey=\"Top-Malware-By-Name\" title=\"Malware Detected\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Virus-Victim\" title=\"Malware Victims\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Virus-Source\" title=\"Malware Source\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"Virus-Time-Line\" title=\"Malware Timeline\" filter-logic=\"and\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Botnets</h1><fazchart mkey=\"Detected-Botnet\" title=\"Botnet Detected\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"Botnet-Victims\" title=\"Botnet Victims\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"Botnet-Sources\" title=\"Botnet C&amp;C\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"Dns-Detected-Botnet\" title=\"Botnet C&C Detected by DNS Filtering\" width=\"100%\"></fazchart><fazchart mkey=\"Botnet-Timeline\" title=\"Botnet Timeline\" filter-logic=\"and\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Intrusions</h1><fazchart mkey=\"Top-Attacks-Detected\" title=\"Intrusions Detected\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Attack-Victim\" title=\"Intrusion Victims\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Attack-Source\" title=\"Intrusion Sources\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"Attacks-By-Severity\" title=\"Intrusions By Severity\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Attacks-Blocked\" title=\"Intrusions Blocked\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"Intrusion-in-Last-7-Days\" title=\"Intrusion Timeline\" filter-logic=\"and\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90203
                next
            end
        set protected enable
    next

    edit 1000060007
        set is-template enable
        set category "Security"
        set title "Template - IPS Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Intrusions detected by type, severity, victims, sources, blocked, monitored, attacks over http-https."
        set body "<h1>Summary</h1><fazchart mkey=\"Attacks-By-Severity\" title=\"Intrusions By Severity\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"Important-Intrusions-Timeline-By-Severity\" title=\"Critical High and Medium Intrusions Timeline\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Intrusions-By-Types\" title=\"Intrusions By Types\" filter-logic=\"and\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Intrusions Detected</h1><fazchart mkey=\"Critical-Severity-Intrusions\" title=\"Critical Severity Intrusions\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"High-Severity-Intrusions\" title=\"High Severity Intrusions\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"Medium-Severity-Intrusions\" title=\"Medium Severity Intrusions\" filter-logic=\"and\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><fazchart mkey=\"Top-Intrusion-Victims\" title=\"Intrusion Victims\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Intrusion-Sources\" title=\"Intrusion Sources\" filter-logic=\"and\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><fazchart mkey=\"Top-Blocked-Intrusions\" title=\"Intrusions Blocked\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Monitored-Intrusions\" title=\"Intrusions Monitored\" filter-logic=\"and\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><fazchart mkey=\"Attacks-Over-HTTP-HTTPs\" title=\"Attacks Over HTTP/HTTPs\" filter-logic=\"and\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90203
                next
            end
        set protected enable
    next

    edit 1000060008
        set is-template enable
        set category "Application"
        set title "Template - Detailed Application Usage and Risk"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Application Risk - botnet, proxy avoidance, peer-to-peer, remote access, email. Backup and storage, general access. Includes risk category examples."
        set body "<h1><span style=\"color:#FF0000\">Risk 5: Botnet</span></h1><p style=\"text-align:start\">Applications in this category are known as botnets - that is, malware that communicates with command and control servers on the public Internet and may perform malicious functions including but not limited to mass mailing, DDoS attacks or data exfiltration. This application control category generally detects and may log or block the command and control traffic.</p><p style=\"text-align:start\">The presence of entries in this list indicates that the target environment may have Botnet infections and while FortiGate can effectively block attempts to communicate to C&amp;C servers, it would be highly recommended to identity the botnet traffic sources in order to clean the infected hosts. This can be done by enabling an event handler to flag botnet detection incidents or by filtering the logs using &quot;appcat=Botnet&quot;.</p><p style=\"text-align:start\">Sample applications in this category include:</p><ul><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/32447\">Zeroaccess.Botnet</a></li><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/35282\">Andromeda.Botnet</a></li><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/34567\">Jeefo.Botnet</a></li><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/37089\">Cryptolocker.Botnet</a></li><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/18118\">Torpig.Mebroot.Botnet</a></li></ul><p style=\"text-align:start\">For more information, visit http://www.fortiguard.com.</p><fazchart mkey=\"Application-Session-History\" title=\"{default}\" width=\"100%\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"Botnet\"></fazfilter></fazfilters></fazchart><p><em>Note: The above graph presents the application category&#39;s usage during the time period category,&nbsp;<strong>hourly</strong>, up to a maximum resolution of 20 days (500 time periods).</em></p><fazchart mkey=\"Application-Usage-List\" title=\"{default}\" width=\"100%\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"Botnet\"></fazfilter></fazfilters></fazchart><p><em>Note: The above list presents the application&nbsp;<strong>combined total usage</strong>&nbsp;for the time period of this report.</em></p><fazchart mkey=\"dns-Botnet-Usage\" title=\"Botnet C&C Usage Detected by DNS Filtering\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1><span style=\"color:#FF0000\">Risk 5: Proxy Avoidance</span></h1><p style=\"text-align:start\">Applications in this category are known to be used to bypass content control and security solutions like FortiGate. These applications are commonly used to anonymize Internet browsing activities and/or bypass Internet filtering controls, with the goals ranging from browsing normally blocked content or conducting malicious activities.</p><p style=\"text-align:start\">The presence of entries in this list indicates that the target environment may have users or malware actively using proxy evasion tools. While these may be blocked by your policy, it would usually be a good practice to review why the offending sources are making use of these tools as they may either violate the organization&#39;s code of conduct or may be used by malware to bypass internet filtering controls.</p><p style=\"text-align:start\">Sample applications in this category include:</p><ul><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/16771\">Freegate.Searching</a></li><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/15565\">Tor</a></li><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/15701\">Ultrasurf</a></li><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/16706\">Hotspot.Shield</a></li><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/32642\">Psiphon3</a></li></ul><p style=\"text-align:start\">For more information, visit http://www.fortiguard.com.</p><fazchart mkey=\"Application-Session-History\" title=\"{default}\" width=\"100%\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"Proxy\"></fazfilter></fazfilters></fazchart><p><em>Note: The above graph presents the application category&#39;s usage during the time period category,&nbsp;<strong>hourly</strong>, up to a maximum resolution of 20 days (500 time periods).</em></p><fazchart mkey=\"Application-Usage-List\" title=\"{default}\" width=\"100%\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"Proxy\"></fazfilter></fazfilters></fazchart><p><em>Note: The above list presents the application&nbsp;<strong>combined total usage</strong>&nbsp;for the time period of this report.</em></p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1><span style=\"color:#FFA500\">Risk 4: Peer To Peer</span></h1><p style=\"text-align:start\">Applications in this category are peer to peer applications. The vast majority of applications in this category tend to be used for file exchanges and/or to maintain decentralized data exchange networks. Common risks associated with peer to peer applications include the legal implications of allowing piracy (common over many peer to peer networks) along with the generally high bandwidth consumption and session rates generated by these applications.</p><p style=\"text-align:start\">The presence of entries in this list, depending on the applications identified, may warrant investigation. FortiGate may be configured to block applications found to be used for file piracy or that are resulting in bandwidth abuse.</p><p style=\"text-align:start\">Sample applications in this category include:</p><ul><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/26038\">BitTorrent_HTTP.Track</a></li><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/35348\">BitTorrent_Sync</a></li><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/12183\">Ares</a></li></ul><p style=\"text-align:start\">For more information, visit http://www.fortiguard.com.</p><fazchart mkey=\"Application-Session-History\" title=\"{default}\" width=\"100%\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"P2P\"></fazfilter></fazfilters></fazchart><p><em>Note: The above graph presents the application category&#39;s usage during the time period category,&nbsp;<strong>hourly</strong>, up to a maximum resolution of 20 days (500 time periods).</em></p><fazchart mkey=\"Application-Usage-List\" title=\"{default}\" width=\"100%\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"P2P\"></fazfilter></fazfilters></fazchart><p><em>Note: The above list presents the application&nbsp;<strong>combined total usage</strong>&nbsp;for the time period of this report.</em></p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1><span style=\"color:#FFA500\">Risk 4: Remote.Access</span></h1><p style=\"text-align:start\">Applications in this category are used as remote access tools, either by using various VPN techniques (such as OpenVPN) or by having software installed to provide screen sharing (such as TeamViewer). These applications present a level of risk due to their use not being commonly sponsored by the organization. Because their data is typically encrypted, it evades common threat inspection such as what is offered by FortiGate and as such, limiting their use to groups of individuals that legitimately need them is common best practice.&nbsp;&nbsp;&nbsp;&nbsp;</p><p style=\"text-align:start\">Sample applications in this category include:</p><ul><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/15921\">Teamviewer</a></li><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/15511\">RDP</a></li><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/15891\">LogMeIn</a></li><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/16395\">GoToMyPC</a></li><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/15510\">VNC</a></li></ul><p style=\"text-align:start\">For more information, visit http://www.fortiguard.com.</p><fazchart mkey=\"Application-Session-History\" title=\"{default}\" width=\"100%\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"Remote.Access\"></fazfilter></fazfilters></fazchart><p><em>Note: The above graph presents the application category&#39;s usage during the time period category,&nbsp;<strong>hourly</strong>, up to a maximum resolution of 20 days (500 time periods).</em></p><fazchart mkey=\"Application-Usage-List\" title=\"{default}\" width=\"100%\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"Remote.Access\"></fazfilter></fazfilters></fazchart><p><em>Note: The above list presents the application&nbsp;<strong>combined total usage</strong>&nbsp;for the time period of this report.</em></p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1><span style=\"color:#FFD700\">Risk 3: Email</span></h1><p style=\"text-align:start\">Applications in this category are used for email purposes. This category contains both common email transport protocols (like POP3, SMTP and IMAP) along with a number of common cloud email provider services.</p><p style=\"text-align:start\">Email inherits intermediate risk ratings given that on one end, its use is commonly allowed on corporate network while on the other end, email is and remains one of the primary threat vectors for malware infections. Most of the protocols in this category can be decrypted effectively, making inspection of the exchanged content and files usually effective.</p><p style=\"text-align:start\">Sample applications in this category include:</p><ul><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/27783\">IMAPS</a>,&nbsp;<a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/16103\">IMAP</a></li><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/15817\">Gmail</a>,&nbsp;<a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/15839\">Yahoo.Mail</a></li><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/16074\">SMTP</a>,&nbsp;<a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/27559\">SMTPS</a></li><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/16104\">POP3</a>,&nbsp;<a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/27561\">POP3S</a></li><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/24747\">Outlook.Web.App</a></li></ul><p style=\"text-align:start\">For more information, visit http://www.fortiguard.com.</p><fazchart mkey=\"Application-Session-History\" title=\"{default}\" width=\"100%\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"Email\"></fazfilter></fazfilters></fazchart><p><em>Note: The above graph presents the application category&#39;s usage during the time period category,&nbsp;<strong>hourly</strong>, up to a maximum resolution of 20 days (500 time periods).</em></p><fazchart mkey=\"Application-Usage-List\" title=\"{default}\" width=\"100%\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"Email\"></fazfilter></fazfilters></fazchart><p><em>Note: The above list presents the application&nbsp;<strong>combined total usage</strong>&nbsp;for the time period of this report.</em></p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1><span style=\"color:#FFD700\">Risk 3: Storage and Backup</span></h1><p style=\"text-align:start\">Applications in this category are used for storage and backup purposes, with a number of popular applications being cloud providers. These applications are commonly found on organizational networks, but their use is commonly not sponsored, especially for cloud providers. Furthermore, a number of cloud provider desktop software uses hardcoded trust authorities, rendering decryption impossible which results in having to make a policy call of either to allow or deny these applications with no possibility of decrypting their content. It is recommended to followup with users that are found to heavily use cloud storage providers if their use is not sponsored - their use may present various risks, ranging from poor credential security to replication of corporate sensititive data on non-corporate, insecure assets (e.g. home computers).</p><p style=\"text-align:start\">Sample applications in this category include:</p><ul><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/17459\">Dropbox</a>, <a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/23382\">OneDrive</a></li><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/29880\">iCloud</a></li><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/16303\">NFS</a>,&nbsp;<a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/16719\">Rsync</a></li></ul><p style=\"text-align:start\">For more information, visit http://www.fortiguard.com.</p><fazchart mkey=\"Application-Session-History\" title=\"{default}\" width=\"100%\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"Storage.Backup\"></fazfilter></fazfilters></fazchart><p><em>Note: The above graph presents the application category&#39;s usage during the time period category,&nbsp;<strong>hourly</strong>, up to a maximum resolution of 20 days (500 time periods).</em></p><fazchart mkey=\"Application-Usage-List\" title=\"{default}\" width=\"100%\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"Storage.Backup\"></fazfilter></fazfilters></fazchart><p><em>Note: The above list presents the application&nbsp;<strong>combined total usage</strong>&nbsp;for the time period of this report.</em></p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1><span style=\"color:#000080\">Risk 2: General Access Categories</span></h1><p><span style=\"background-color:rgb(255, 255, 255); color:rgb(0, 0, 0); font-family:helvetica; font-size:12px\">(Game, Collaboration, Social.Media, Video/Audio, Voip, Industrial, General.Interest, Network.Service, Web.Client)</span></p><p style=\"text-align:start\">Applications in these categories are commonly seen on corporate networks and are unlikely - to a few exceptions - to present a security threat to the organization. They may however result in loss productivity and/or excessive bandwidth consumption, hence it is advisable to review the top bandwidth consuming applications in these categories periodically to ensure their usage is not the result of misconduct or genuine threats.</p><p style=\"text-align:start\">Of note within these applications are DNS and SSL. Statistically excessive DNS traffic may be indicative of botnet traffic or DoS attacks, whereas the risks associated with SSL are bound to the fact that this traffic is not currently decrypted by FortiGate and may therefore be used maliciously.</p><p style=\"text-align:start\">Sample applications in these combined categories:</p><ul><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/16195\">DNS</a>,&nbsp;<a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/15895\">SSL</a>,&nbsp;<a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/16208\">NBSS</a>,&nbsp;<a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/16206\">ICMP</a>,<a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/25843\">OCSP</a>&nbsp;</li><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/15832\">Facebook</a>,&nbsp;<a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/16001\">Twitter</a>,&nbsp;<a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/31349\">Pinterest</a>,&nbsp;<a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/16331\">LinkedIn</a></li><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/31077\">Youtube</a>,&nbsp;<a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/15880\">HTTP.Video</a>,&nbsp;<a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/15879\">HTTP.Audio</a></li></ul><p style=\"text-align:start\">For more information, visit http://www.fortiguard.com.</p><fazchart mkey=\"Application-Session-History\" title=\"{default}\" width=\"100%\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"General.Interest||Game||Collaboration||Social.Media||Video/Audio||Voip||Industrial|General.Interest||Network.Service||Web.Client\"></fazfilter></fazfilters></fazchart><p><em>Note: The above graph presents the application category&#39;s usage during the time period category,&nbsp;<strong>hourly</strong>, up to a maximum resolution of 20 days (500 time periods).</em></p><fazchart mkey=\"Application-Usage-List\" title=\"{default}\" width=\"100%\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"General.Interest||Game||Collaboration||Social.Media||Video/Audio||Voip||Industrial|General.Interest||Network.Service||Web.Client\"></fazfilter></fazfilters></fazchart><p><em>Note: The above list presents the application&nbsp;<strong>combined total usage</strong>&nbsp;for the time period of this report.</em></p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1><span style=\"color:#008000\">Risk 1: Reduced Risk Categories</span></h1><p><span style=\"background-color:rgb(255, 255, 255); color:rgb(0, 0, 0); font-family:helvetica; font-size:16px\">(Business, Update)</span></p><p style=\"text-align:start\">Applications in these categories have been identified as being purely related to business conduct or software updates and as such, their risk level are low.</p><p style=\"text-align:start\">Sample applications in these combined categories:</p><ul><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/16009\">MS.Windows.Update</a>, <a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/16985\">Google.Chrome.Update</a>,&nbsp;<a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/16983\">Firefox.Update</a></li><li><a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/15888\">Oracle.TNS</a>,&nbsp;<a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/15886\">MySQL</a>,&nbsp;<a style=\"color: blue !important; text-decoration: underline !important; cursor: text !important;\" href=\"http://fortiguard.com/appcontrol/16035\">Google.Analytics</a></li></ul><p style=\"text-align:start\">For more information, visit http://www.fortiguard.com.</p><fazchart mkey=\"Application-Session-History\" title=\"{default}\" width=\"100%\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"Business||Update\"></fazfilter></fazfilters></fazchart><p><em>Note: The above graph presents the application category&#39;s usage during the time period category,&nbsp;<strong>hourly</strong>, up to a maximum resolution of 20 days (500 time periods).</em></p><fazchart mkey=\"Application-Usage-List\" title=\"{default}\" width=\"100%\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"Business||Update\"></fazfilter></fazfilters></fazchart><p><em>Note: The above list presents the application&nbsp;<strong>combined total usage</strong>&nbsp;for the time period of this report.</em></p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Browser Usage Breakdown</h1><fazchart mkey=\"Application-Usage-List\" title=\"{default}\" width=\"100%\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"Web.Others||Web.Client\"></fazfilter></fazfilters></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90200
                next
                edit 90203
                next
            end
        set protected enable
    next

    edit 1000060009
        set is-template enable
        set category "Application"
        set title "Template - Top 20 Categories and Applications (Bandwidth)"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Top 20 Categories and Applications (Bandwidth)"
        set body "<fazchart mkey=\"app-Top-20-Category-and-Applications-by-Bandwidth\" title=\"Top 20 Categories and Applications (Bandwidth)\" width=\"100%\"><fazfilters><fazfilter field=\"appcat\" oper=\"neq\" value=\"Not.Scanned\"></fazfilter><fazfilter field=\"appcat\" oper=\"neq\" value=\"unscanned\"></fazfilter></fazfilters></fazchart><p><span style=\"font-size:20px\">Notes</span></p><p><em>Traffic sessions that are not scanned by the Application Control engine are excluded from this report. Please enable Application Control to allow application traffic to be properly identified/secured on your network.</em></p><p>&nbsp;</p>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90200
                next
                edit 90201
                next
            end
        set protected enable
    next

    edit 1000060010
        set is-template enable
        set category "Application"
        set title "Template - Top 20 Categories and Applications (Session)"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Top 20 Categories and Applications (Session)"
        set body "<fazchart mkey=\"app-Top-20-Category-and-Applications-by-Session\" title=\"Top 20 Categories and Applications (Session)\" width=\"100%\"><fazfilters><fazfilter field=\"appcat\" oper=\"neq\" value=\"Not.Scanned\"></fazfilter><fazfilter field=\"appcat\" oper=\"neq\" value=\"unscanned\"></fazfilter></fazfilters></fazchart><p><span style=\"font-size:20px\">Notes</span></p><p><em>Traffic sessions that are not scanned by the Application Control engine are excluded from this report. Please enable Application Control to allow application traffic to be properly identified/secured on your network.</em></p>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90200
                next
                edit 90201
                next
            end
        set protected enable
    next

    edit 1000060011
        set is-template enable
        set category "Application"
        set title "Template - Top Allowed and Blocked with Timestamps"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Top Allowed Applications by Session and Top Blocked Applications by Bandwidth with Timestamps"
        set body "<fazchart mkey=\"app-Top-500-Allowed-Applications-by-Bandwidth\" title=\"{default}\" width=\"100%\"><fazfilters><fazfilter field=\"appcat\" oper=\"neq\" value=\"Not.Scanned\"></fazfilter><fazfilter field=\"appcat\" oper=\"neq\" value=\"unscanned\"></fazfilter></fazfilters></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><fazchart mkey=\"app-Top-500-Blocked-Applications-by-Session\" title=\"Top 500 Blocked Applications by Session\" width=\"100%\"><fazfilters><fazfilter field=\"appcat\" oper=\"neq\" value=\"Not.Scanned\"></fazfilter><fazfilter field=\"appcat\" oper=\"neq\" value=\"unscanned\"></fazfilter></fazfilters></fazchart><p><span style=\"font-size:20px\">Notes</span></p><p><em>Traffic sessions that are not scanned by the Application Control engine are excluded from this report. Please enable Application Control to allow application traffic to be properly identified/secured on your network.</em></p>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90200
                next
                edit 90202
                next
                edit 90203
                next
            end
        set protected enable
    next

    edit 1000060012
        set is-template enable
        set category "User"
        set title "Template - User Detailed Browsing Log"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Detailed Web Browsing Log by Users"
        set body "<p><fazmacro mkey=\"traffic-User-Detail\"></fazmacro>&nbsp;</p><fazchart mkey=\"web-Detailed-Website-Browsing-Log\" title=\"{default}\" filter-logic=\"and\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90200
                next
                edit 90201
                next
                edit 90202
                next
            end
        set protected enable
    next

    edit 1000060013
        set is-template enable
        set category "Web"
        set title "Template - Hourly Website Hits"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Hourly Website Hits"
        set body "<fazchart mkey=\"web-Hourly-Category-and-Website-Hits-Action\" title=\"Hourly Website Hits\" filter-logic=\"and\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90200
                next
                edit 90201
                next
                edit 90202
                next
            end
        set protected enable
    next

    edit 1000060014
        set is-template enable
        set category "Web"
        set title "Template - Top 20 Category and Websites (Bandwidth)"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Top 20 Category and Websites (Bandwidth)"
        set body "<fazchart mkey=\"web-Top-20-Category-and-Websites-by-Bandwidth\" title=\"Top 20 Category and Websites (Bandwidth)\" filter-logic=\"and\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90200
                next
                edit 90201
                next
            end
        set protected enable
    next

    edit 1000060015
        set is-template enable
        set category "Web"
        set title "Template - Top 20 Category and Websites (Session)"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Top 20 Category and Websites (Session)"
        set body "<fazchart mkey=\"web-Top-20-Category-and-Websites-by-Session\" title=\"Top 20 Category and Websites (Session)\" filter-logic=\"and\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90200
                next
                edit 90201
                next
            end
        set protected enable
    next

    edit 1000060016
        set is-template enable
        set category "Web"
        set title "Template - Top 500 Sessions by Bandwidth"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Top 500 Sessions by Bandwidth"
        set body "<fazchart mkey=\"web-Top-500-Website-Sessions-by-Bandwidth\" title=\"{default}\" filter-logic=\"and\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90200
                next
                edit 90201
                next
            end
        set protected enable
    next

    edit 1000060017
        set is-template enable
        set category "User"
        set title "Template - User Top 500 Websites by Bandwidth"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Top 500 Websites visited by Users by Bandwidth"
        set body "<fazchart mkey=\"web-Top-500-User-Visted-Websites-by-Bandwidth\" title=\"Top 500 Websites Visited by Users (Bandwidth)\" filter-logic=\"and\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90200
                next
                edit 90201
                next
                edit 90202
                next
            end
        set protected enable
    next

    edit 1000060018
        set is-template enable
        set category "User"
        set title "Template - User Top 500 Websites by Session"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Top 500 Websites visited by Users by Session"
        set body "<fazchart mkey=\"web-Top-500-User-Visted-Websites-by-Session\" title=\"Top 500 Websites Visited by Users (Session)\" filter-logic=\"and\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90201
                next
                edit 90202
                next
            end
        set protected enable
    next
    edit 1000060019
        set is-template enable
        set category "Application"
        set hide-rowid 1
        set title "Template - Application Risk and Control"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Application risk, categories, bandwidth by app, web categories, vulnerability exploits, virus, botnet, adware malicious attacks, file transfers."
        set body "<div style=\"height: 25px\"></div><h2><span style=\"font-family: Lato; font-size: 14pt; color: black\"> Application Visibility and Threats</span></h2><div style=\"height: 25px\"></div><div style=\"display: -webkit-box; -webkit-box-pack: justify; width: 95%;\"><div><img data-local=\"true\" src=\"/resource/images/fazrpt_external/web_applications.png\" style=\"height:24px; width:24px;\" /><b><span style=\"font-size:24px\"><fazmacro mkey=\"Apprisk-Ctrl-Total-Count\"></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato\"> High Risk Apps</span></div><div><img data-local=\"true\" src=\"/resource/images/fazrpt_external/web_threat.png\" style=\"height:24px; width:24px\" /><b><span style=\"font-size:24px\"><fazmacro mkey=\"Apprisk-Ctrl-Total-Threats\"></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato\"> Threats</span></div><div><img data-local=\"true\" src=\"/resource/images/fazrpt_external/web_total_byte.png\" style=\"height:24px; width:24px\" /><b><span style=\"font-size:24px\"><fazmacro mkey=\"Apprisk-Ctrl-Total-Bandwidth\"></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato\"> Total Bytes</span></div><div><img data-local=\"true\" src=\"/resource/images/fazrpt_external/web_malware.png\" style=\"height:24px; width:24px\" /><b><span style=\"font-size:24px\"><fazmacro mkey=\"Apprisk-Ctrl-Malware-Total-Count\"></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato\"> Malware</span></div></div><div style=\"height: 25px\"></div><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\" style=\"font-family: Lato; width:100%\"><tbody><tr><td style=\"vertical-align:top\"><fazchart mkey=\"Apprisk-Ctrl-Severe-High-Risk-Application\" title=\"High Risk Apps Visibility and Control\" width=\"500px\"></fazchart></td><td style=\"vertical-align:top\"><fazchart mkey=\"Apprisk-Ctrl-Threats-Prevention\" title=\"Threat Detection and Prevention\" width=\"500px\"></fazchart></td></tr></tbody></table><div style=\"height: 40px\"></div><h2><span style=\"font-family: Lato; font-size: 14pt; color: black\"> Application Risk Definition</span></h2><div style=\"height: 20px\"></div><table border=\"0\" cellspacing=\"5\" cellpadding=\"0\" align=\"center\" style=\"font-family: Lato; width:100%\"><tbody><tr><td style=\"width: 180px; vertical-align:top;\"><div style=\"width: 180px; height: 205px; border: 2px solid lightgray; border-radius: 10px;\"><div style=\"padding-top: 10px; padding-left: 8px; padding-right: 5px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/app_risk_5.png\" style=\"height:20px; width:20px;\"/><span style=\"font-family: Lato; font-size: 10.5pt; color: black; padding-left: 8px; position: relative; bottom: 5px;\">SEVERE</span></div><div style=\"padding-top: 2px; padding-left: 8px; padding-right: 5px; font-size: 10pt;\"><span > Malicious applications or the applications that can bypass security.</span></div><div style=\"padding-top: 10px; padding-left: 8px; padding-right: 5px; font-size: 10pt;\"><span style=\"color: gray;\"> Examples:</span></div><div style=\"padding-top: 1px; padding-left: 8px; padding-right: 5px; font-size: 10pt;\"><span style=\"color: black;\"> Botnet, Proxy</span></div></div></td><td style=\"width: 180px; vertical-align:top;\"><div style=\"width: 180px; height: 205px; border: 2px solid lightgray; border-radius: 10px;\"><div style=\"padding-top: 10px; padding-left: 8px; padding-right: 5px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/app_risk_4.png\" style=\"height:20px; width:20px;\"/><span style=\"font-family: Lato; font-size: 10.5pt; color: black; padding-left: 8px; position: relative; bottom: 5px;\">HIGH</span></div><div style=\"padding-top: 2px; padding-left: 8px; padding-right: 5px; font-size: 10pt;\"><span > Applications that can cause malware infection or data leakage: often these applications are used for personal file-sharing or tunnelling other apps.</span></div><div style=\"padding-top: 10px; padding-left: 8px; padding-right: 5px; font-size: 10pt;\"><span style=\"color: gray;\"> Examples:</span></div><div style=\"padding-top: 1px; padding-left: 8px; padding-right: 5px; font-size: 10pt;\"><span style=\"color: black;\"> P2P, Remote.Access</span></div></div></td><td style=\"width: 180px; vertical-align:top;\"><div style=\"width: 180px; height: 205px; border: 2px solid lightgray; border-radius: 10px;\"><div style=\"padding-top: 10px; padding-left: 8px; padding-right: 5px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/app_risk_3.png\" style=\"height:20px; width:20px;\"/><span style=\"font-family: Lato; font-size: 10.5pt; color: black; padding-left: 8px; position: relative; bottom: 5px;\">ELEVATED</span></div><div style=\"padding-top: 2px; padding-left: 8px; padding-right: 5px; font-size: 10pt;\"><span > Applications are used for personal communication or have known vulnerabilities.</span></div><div style=\"padding-top: 10px; padding-left: 8px; padding-right: 5px; font-size: 10pt;\"><span style=\"color: gray;\"> Examples:</span></div><div style=\"padding-top: 1px; padding-left: 8px; padding-right: 5px; font-size: 10pt;\"><span style=\"color: black;\"> IM, Email, Storage.Backup</span></div></div></td><td style=\"width: 180px; vertical-align:top;\"><div style=\"width: 180px; height: 205px; border: 2px solid lightgray; border-radius: 10px;\"><div style=\"padding-top: 10px; padding-left: 8px; padding-right: 5px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/app_risk_2.png\" style=\"height:20px; width:20px;\"/><span style=\"font-family: Lato; font-size: 10.5pt; color: black; padding-left: 8px; position: relative; bottom: 5px;\">GUARDED</span></div><div style=\"padding-top: 2px; padding-left: 8px; padding-right: 5px; font-size: 10pt;\"><span > Applications consume bandwidth or affect productivity.</span></div><div style=\"padding-top: 10px; padding-left: 8px; padding-right: 5px; font-size: 10pt;\"><span style=\"color: gray;\"> Examples:</span></div><div style=\"padding-top: 1px; padding-left: 8px; padding-right: 5px; font-size: 10pt;\"><span style=\"color: black;\"> Game, Social.Media, Video or Audio apps</span></div></div></td><td style=\"width: 180px; vertical-align:top;\"><div style=\"width: 180px; height: 205px; border: 2px solid lightgray; border-radius: 10px;\"><div style=\"padding-top: 10px; padding-left: 8px; padding-right: 5px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/app_risk_1.png\" style=\"height:20px; width:20px;\"/><span style=\"font-family: Lato; font-size: 10.5pt; color: black; padding-left: 8px; position: relative; bottom: 5px;\">LOW</span></div><div style=\"padding-top: 2px; padding-left: 8px; padding-right: 5px; font-size: 10pt;\"><span > Business applications or software update applications.</span></div><div style=\"padding-top: 10px; padding-left: 8px; padding-right: 5px; font-size: 10pt;\"><span style=\"color: gray;\"> Examples:</span></div><div style=\"padding-top: 1px; padding-left: 8px; padding-right: 5px; font-size: 10pt;\"><span style=\"color: black;\"> Update or Business apps</span></div></div></td></tr></tbody></table><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height: 5px\"></div><h2><span style=\"font-family: Lato; font-size: 14pt; color: black\"> Top 10 High Risk Applications</span></h2><fazchart mkey=\"Apprisk-Ctrl-Top-High-Risk-Application\" title=\"\" width=\"100%\"></fazchart><table border=\"0\" cellspacing=\"5px\" cellpadding=\"0\" align=\"center\" style=\"font-family: Lato; width:100%\"><tbody><tr><td style=\"vertical-align:top\"><fazchart mkey=\"Apprisk-Ctrl-High-Risk-Application-Behavioral-Pie-Chart\" title=\"Application Behavioral Characteristics\" width=\"350px\"></fazchart></td><td style=\"vertical-align:top\"><fazchart mkey=\"Apprisk-Ctrl-High-Risk-Apps-Behavioral-Timeline\" title=\"Application Behavioral Characteristics History\" width=\"650px\"></fazchart></td></tr></tbody></table><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height: 5px\"></div><h2><span style=\"font-family: Lato; font-size: 14pt; color: black\"> Key Applications Crossing the Network</span></h2><fazchart mkey=\"Apprisk-Ctrl-Top-High-Risk-Application-By-Bandwidth\" title=\"Top 15 High Risk Applications by Bandwidth\" width=\"1000px\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><fazchart mkey=\"Apprisk-Ctrl-High-Risk-Category-App-by-Bandwidth\" title=\"Top 10 App Categories by Bandwidth Usage\" width=\"1000px\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height: 5px\"></div><h2><span style=\"font-family: Lato; font-size: 14pt; color: black\"> Web Applications</span></h2><fazchart mkey=\"Apprisk-Ctrl-Top-Web-Applications\" title=\"Top 15 Applications by Bandwidth\" width=\"1000px\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height: 5px\"></div><h2><span style=\"font-family: Lato; font-size: 14pt; color: black\"> Web Categories in Use</span></h2><fazchart mkey=\"Apprisk-Ctrl-Top-Visited-Web-Categories\" title=\"Top 15 Web Categories Visited\" width=\"1000px\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height: 5px\"></div><h2><span style=\"font-family: Lato; font-size: 14pt; color: black\"> Application Vulnerabibility Exploits</span></h2><fazchart mkey=\"Apprisk-Ctrl-Top-Application-Vulnerability\" title=\"Top 15 Threat by Count\" width=\"1000px\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><fazchart mkey=\"Apprisk-Ctrl-Malware-Virus-Botnet-Spyware-by-Count\" title=\"Malware: Viruses, Bots, Spyware/Adware\" width=\"1000px\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height: 5px\"></div><h2><span style=\"font-family: Lato; font-size: 14pt; color: black\"> Zero-day Attacks Detected on the Network</span></h2><div style=\"height: 5px\"></div><fazchart mkey=\"Apprisk-Ctrl-Files-FortiCloud-Sandbox-Analyzed\" title=\"Files Analyzed by FortiCloud Sandbox\" width=\"1000px\"></fazchart><div style=\"height: 5px\"></div><fazchart mkey=\"Apprisk-Ctrl-Malicious-Files-Detected-By-FortiCloud-Sandbox\" title=\"Examples of the Malicious Files Detected by FortiCloud Sandbox\" width=\"1000px\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "header_webusage_bg.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90200
                next
                edit 90203
                next
            end
        set report-tag "concise"
        set protected enable
    next


    edit 1000060020
        set is-template enable
        set category "Security"
        set title "Template - FortiClient Default Report from FortiGate"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Summaries for Installation, OS, Device, FCT version and client summary. Threat summary by AV threats, infected devices, detections, WF violations, AP firewall, errors and alerts, total threats found."
        set body "<h1>Endpoint Summary</h1><p>FortiClient helps to secure your network's endpoint PCs, laptops, tablets, and mobile devices.<br /><br />The following report helps you monitor and manage FortiClient detections of anti-malware, blocked applications, web filter violations, vulnerabilities and remediations, remote access and compliance.</p><fazchart mkey=\"fct-Installed-Feature-Summary\" title=\"Installed Feature Summary\" filter-logic=\"and\" width=\"720\"></fazchart><fazchart mkey=\"fct-Device-by-Operating-System\" title=\"Device by OS\" filter-logic=\"and\" width=\"720\"></fazchart><fazchart mkey=\"fct-Endpoints-by-FortiGate\" title=\"Endpoints by FortiGate\" filter-logic=\"and\" width=\"720\"></fazchart><h2>FortiClient Version Installed</h2><p>The following lists a count of the FortiClient versions installed on the network.</p><fazchart mkey=\"fct-Installed-FortiClient-Version\" title=\" \" filter-logic=\"and\" width=\"720\"></fazchart><h2>Endpoint Profile Deployment</h2><p>The following shows the endpoint profiles deployed by host.</p><fazchart mkey=\"fct-Endpoint-Profile-Deployment\" title=\"\" filter-logic=\"and\" width=\"720\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Compliance</h1><h2>FortiGates Enforcing Compliance</h2><p>The following are the list of FortiGate devices on the network that enforce compliance and the number of associated devices.</p><fazchart mkey=\"fct-Compliance-by-FortiGate\" title=\" \" filter-logic=\"and\" width=\"720\"></fazchart><h2>Endpoint Compliance</h2><p>The following are the number of compliant, non-compliant and exempt endpoints on the network.</p><fazchart mkey=\"fct-Compliance-Status\" title=\" \" filter-logic=\"and\" width=\"720\"></fazchart><h2>Non Compliant Endpoints</h2><p>The following are endpoints identified as non-compliant with the FortiGates enforcing compliance on the network.</p><fazchart mkey=\"fct-Non-Compliant-Endpoints\" title=\" \" filter-logic=\"and\" width=\"720\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Threat Summary</h1><fazchart mkey=\"fct-Threats-by-Top-Devices\" title=\"Top 10 Devices by Threats\" filter-logic=\"and\" width=\"720\"></fazchart><fazchart mkey=\"fct-Top-Malware-Detections\" title=\"Anti-Malware Detections\" filter-logic=\"and\" width=\"720\"></fazchart><fazchart mkey=\"fct-Top10-Malware-Detections\" title=\"Top 10 Malware Detections\" filter-logic=\"and\" width=\"720\"></fazchart><fazchart mkey=\"fct-Devices-with-Botnet\" title=\"Devices with Botnet C&C\" filter-logic=\"and\" width=\"720\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2>Endpoint Vulnerabilities</h2><p>The following is a list of the vulnerabilities detected and suggested remediation actions.</p><fazchart mkey=\"fct-vuln-Device-Vulnerabilities\" title=\"Vulnerabilities by Severity\" width=\"100%\"></fazchart><fazchart mkey=\"fct-vuln-Category-Type-Vulnerabilities\" title=\"Vulnerabilities by Category\" width=\"100%\"></fazchart><fazchart mkey=\"fct-vuln-Vulnerability-by-Hostname\" title=\"Endpoint Vulnerabilities by Hostname\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2>Web Violations</h2><fazchart mkey=\"fct-Users-With-Web-Violations\" title=\"Top 20 Users with Web Violations\" filter-logic=\"and\" width=\"720\"></fazchart><fazchart mkey=\"fct-Web-Filter-Violations\" title=\"Top 20 User Web Filter Violations by Count\" filter-logic=\"and\" width=\"720\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2>Events & System Updates</h2><fazchart mkey=\"fct-Errors-and-Alerts\" title=\"Errors and Alerts\" filter-logic=\"and\" width=\"720\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Web Traffic Summary</h1><p>&nbsp;</p><fazchart mkey=\"fct-Traffic-Web-Hits\" title=\"Web Traffic Trend Over Time\" width=\"100%\"></fazchart><p>&nbsp;</p><fazchart mkey=\"fct-Traffic-Top-Allowed-Web-Cat\" title=\"Top Visited Web Categories\" width=\"100%\"></fazchart><p>&nbsp;</p><fazchart mkey=\"fct-Traffic-Top-Allowed-Website\" title=\"Top Visited Websites\" width=\"100%\"></fazchart><p>&nbsp;</p><fazchart mkey=\"fct-Traffic-Top-Category-By-Website-Session\" title=\"Top Web Categories by Website and Session\" width=\"100%\"></fazchart><p>&nbsp;</p><fazchart mkey=\"fct-Traffic-Top-Web-Users-By-Website\" title=\"Top Browsing Users by Website\" width=\"100%\"></fazchart><p>&nbsp;</p><p>&nbsp;</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Appendix 1</h1><h2>Client Summary</h2><p>The following is a detailed list of hosts by FortiClient Version installed.</p><fazchart mkey=\"fct-Client-Summary\" title=\"\" filter-logic=\"and\" width=\"720\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Appendix 2</h1><h2>Vulnerability Remediation Details</h2><p>The following lists the remediation actions for the vulnerablities detected.</p><fazchart mkey=\"fct-vuln-Details-by-Device-User\" title=\"\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
            end
        set protected enable
    next

    edit 1000060024
        set category "Security"
        set hide-rowid 1
        set is-template enable
        set title "Template - FortiClient Vulnerability Scan Report from FortiGate"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "The vulnerabilities detected through Forticlient scans across the network"
        set body "<h1>Summary</h1><p>The following report provides a summary of the vulnerabilities detected through FortiClient scans across the network.</p><p>&nbsp;</p><h2>Device Vulnerabilities</h2><p>The following are vulnerabilities detected by user/device.</p><fazchart mkey=\"fct-vuln-Device-Vulnerabilities\" title=\" \" width=\"100%\"></fazchart><h2>Category Type Vulnerabilities</h2><p>The following are vulnerabilities detected by category type.</p><fazchart mkey=\"fct-vuln-Category-Type-Vulnerabilities\" title=\" \" width=\"100%\"></fazchart><h2>Vulnerabilities by OS</h2><p>The following are the OS vulnerabilities detected.</p><fazchart mkey=\"fct-vuln-Vulnerabilities-by-OS\" title=\" \" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2># Vulnerabilities by Risk Level</h2><p>The following chart displays the number of vulnerabilities by risk level.</p><fazchart mkey=\"fct-vuln-Vulnerabilities-by-Risk-Level\" title=\" \" width=\"100%\"></fazchart><h2># Devices by Vulnerability Risk Level.</h2><p>The following table displays the number of vulnerabilities on the net work by device and risk level.</p><fazchart mkey=\"fct-vuln-Device-by-Risk-Level\" title=\" \" width=\"100%\"></fazchart><h2>Vulnerability Trend</h2><p>The following chart displays the vulnerability trend over the report period.</p><fazchart mkey=\"fct-vuln-Vulnerability-Trend\" title=\" \" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2>Vulnerabilities by Risk Level Details</h2><p>The following provides details of the vulnerabilities for each risk level by device.</p><fazchart mkey=\"fct-vuln-Details-by-Risk-Level-Device\" title=\"Devices with Critical Vulnerabilities\" width=\"100%\"><fazfilters><fazfilter field=\"vulnseverity\" oper=\"eq\" value=\"Critical\"></fazfilter></fazfilters></fazchart><fazchart mkey=\"fct-vuln-Details-by-Risk-Level-Device\" title=\"Devices with High Vulnerabilities\" width=\"100%\"><fazfilters><fazfilter field=\"vulnseverity\" oper=\"eq\" value=\"High\"></fazfilter></fazfilters></fazchart><fazchart mkey=\"fct-vuln-Details-by-Risk-Level-Device\" title=\"Devices with Medium Vulnerabilities\" width=\"100%\"><fazfilters><fazfilter field=\"vulnseverity\" oper=\"eq\" value=\"Medium\"></fazfilter></fazfilters></fazchart><fazchart mkey=\"fct-vuln-Details-by-Risk-Level-Device\" title=\"Devices with Low Vulnerabilities\" width=\"100%\"><fazfilters><fazfilter field=\"vulnseverity\" oper=\"eq\" value=\"Low\"></fazfilter></fazfilters></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2>Vulnerability Details by Device User</h2><p>The following provides details of the vulnerabilities by device user.</p><fazchart mkey=\"fct-vuln-Details-by-Device-User\" title=\" \" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2>Remediation Actions by Device</h2><p>The following is a list of actions required to remediate the vulnerabilities found on devices in the network.</p><fazchart mkey=\"fct-vuln-Remediation-by-Device\" title=\" \" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2>Remediation by Vulnerability</h2><fazchart mkey=\"fct-vuln-Remediation-by-Vulnerability\" title=\" \" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2>Top 30 Targeted High Risk Vulnerabilities</h2><p>The following is an overview of the highest risk software vulnerabilities that are being exploited to target critical infrastructure organizations, along with mitigation recommendations.</p><fazchart mkey=\"fct-vuln-Top-30-Targeted-High-Risk-Vulnerabilities\" title=\" \" width=\"100%\"></fazchart><p>&nbsp;</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Resources</h1><p>&nbsp;</p><p><strong>FortiClient</strong></p><p>&nbsp;</p><p>FortiClient is an industry certified all-in-one personal security suite. It includes Anti-Virus, Web Filtering, Application Firewall, VLN and more.</p><p>http://www.forticlient.com/</p><p>&nbsp;</p><p><strong>Online Virus Scan</strong></p><p>&nbsp;</p><p>Upload a suspicious file for scanning by FortiGuard AV Online Scanner.</p><p>http://www.fortiguard.com/virusscanner</p><p>&nbsp;</p><p><strong>Malware Removal Tools</strong></p><p>&nbsp;</p><p>Suspect your PC is already infected? View our malware removal tools.</p><p>http://www.fortiguard.com/malwareremoval</p><p>&nbsp;</p><p>&nbsp;</p>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
            end
        set protected enable
    next

    edit 1000060021
        set category "Security"
        set title "Template - 360-Degree Security Review"
        set is-template enable
        set hide-rowid 1
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Security review of Application Visibility and Control, Threat Detection, Data Exfiltration Detection, Endpoint Detection, Prevention and Recommended Actions."
        set body "<h1>Summary</h1><p>This report provides the findings of the comprehensive security review that Fortinet conducted for your network. Fortinet next generation firewall FortiGate 1500D is used for this analysis. This report begins with a summary of these findings, followed by details of the threats, applications and type of content found and closes with a set of recommended actions.</p><p><span style=\"font-size:14px\">Application Visibility and Control</span></p><fazchart mkey=\"360-degree-security-Application-Visiblity-and-Control-Summary\" title=\" \" width=\"100%\"><fazfilters><fazfilter field=\"appcat\" oper=\"neq\" value=\"Not.Scanned\"></fazfilter><fazfilter field=\"appcat\" oper=\"neq\" value=\"unscanned\"></fazfilter></fazfilters></fazchart><p><span style=\"font-size:14px\">&nbsp;Threat Detection and Prevention</span></p><fazchart mkey=\"360-degree-security-Threats-Detection-and-Prevention-Summary\" title=\" \" width=\"100%\"></fazchart><p><span style=\"font-size:14px\">Data Exfiltration Detection and Prevention</span></p><fazchart mkey=\"360-degree-security-Data-Exfiltration-Detection-and-Prevention-Summary\" title=\" \" width=\"100%\"></fazchart><p><span style=\"font-size:14px\">Endpoint Protection</span></p><fazchart mkey=\"360-degree-security-Endpoint-Protection-Summary\" title=\" \" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>1. Application Visibility and Control</h1><p>The following sections provide findings on high risk applications identified on your network. It has been determined by FortiGuard Lab that these applications represent possible vectors for data compromise, network intrusion, or a reduction in network performance.</p><h2>High Risk Applications in Use</h2><p>Top 20 high risk applications are listed below. These applications have the risk rating of 5(severe risk) or 4(high risk). Each application is listed with its respective category, technology, number of users, total bytes and sessions.</p><fazchart mkey=\"security-Top20-High-Risk-Application-In-Use\" title=\" \" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2>High Risk Application by Category</h2><p>Breakdown of the high risk applications by application category</p><fazchart mkey=\"security-High-Risk-Application-By-Category\" title=\"  \" width=\"100%\"><fazfilters><fazfilter field=\"appcat\" oper=\"neq\" value=\"Not.Scanned\"></fazfilter><fazfilter field=\"appcat\" oper=\"neq\" value=\"unscanned\"></fazfilter></fazfilters></fazchart><p>Behavioural characteristics of the high risk applications</p><fazchart mkey=\"Apprisk-Ctrl-High-Risk-Application-Behavioral\" title=\" \" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2>Application Risk Definition</h2><p>The FortiGuard research team assigns a risk rating of 1 to 5 to an application based on the application behavioural characteristics. The risk rating can help administrators to identify the high risk applications quickly and make a better decision on the application control policy.</p><table><thead><tr><td style=\"background-color:rgb(220, 220, 220); text-align:left; width:12%\"><span style=\"font-size:12px\">Risk Rating</span></td><td style=\"background-color:rgb(220, 220, 220); text-align:left; width:58%\"><span style=\"font-size:12px\">Behavior Characteristics</span></td><td style=\"background-color:rgb(220, 220, 220); text-align:left; width:30%\"><span style=\"font-size:12px\">Examples</span></td></tr></thead><tbody><tr><td><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/5.jpg\" /> <span style=\"font-size:12px\">Severe</span></td><td><span style=\"font-size:12px\">Malicious applications or the applications that can bypass security</span></td><td><span style=\"font-size:12px\">Botnet or Proxy applications</span></td></tr><tr><td style=\"background-color:rgb(242, 241, 239)\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/4.jpg\" /> <span style=\"font-size:12px\">High</span></td><td style=\"background-color:rgb(242, 241, 239)\"><span style=\"font-size:12px\">Applications that can cause malware infection or data leakage: often these applications are used for personal file-sharing or tunnelling other applications</span></td><td style=\"background-color:rgb(242, 241, 239)\"><span style=\"font-size:12px\">P2P or Remote.Access applications</span></td></tr><tr><td><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/3.jpg\" /><span style=\"font-size:12px\"> Elevated</span></td><td><span style=\"font-size:12px\">Applications are used for personal communication or have known vulnerabilities</span></td><td><span style=\"font-size:12px\">IM,Email,Storage.Backup applications</span></td></tr><tr><td style=\"background-color:rgb(242, 241, 239)\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/2.jpg\" /> <span style=\"font-size:12px\">Guarded</span></td><td style=\"background-color:rgb(242, 241, 239)\"><span style=\"font-size:12px\">Applications consume bandwidth or affect productivity</span></td><td style=\"background-color:rgb(242, 241, 239)\"><span style=\"font-size:12px\">Game,Social.Media,Video/Audio applications</span></td></tr><tr><td><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/1.jpg\" /><span style=\"font-size:12px\"> Low</span></td><td><span style=\"font-size:12px\">Business applications or software update applications</span></td><td><span style=\"font-size:12px\">Update or Business applications</span></td></tr></tbody></table><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2>Application Categories</h2><p>The FortiGuard research team categorized applications into different categories based on the application behavioural characteristics, underlying technology, and the related traffic transaction characteristics. The categories allow for better application management. For application category details, see: http://www.fortiguard.com/encyclopedia/applications.&nbsp;</p><p>The following section shows the application category breakdown of all the applications on the network, sorted by bandwidth. This information helps network administrator to identify where the bandwidth is used, and how many applications use it. Armed with this information, the administrators can effectively prioritize the applications based on the business needs: for example, allow business applications but traffic shape the applications for personal use.</p><p style=\"text-align:center\"><span style=\"font-size:11px\">Top 10 application categories by bandwidth usage</span></p><fazchart mkey=\"security-Top10-Application-Categories-By-Bandwidth\" title=\" \" width=\"100%\"><fazfilters><fazfilter field=\"appcat\" oper=\"neq\" value=\"Not.Scanned\"></fazfilter><fazfilter field=\"appcat\" oper=\"neq\" value=\"unscanned\"></fazfilter></fazfilters></fazchart><p style=\"text-align:center\"><span style=\"font-size:11px\">Category breakdown of all applications, sorted by bandwidth usage</span></p><fazchart mkey=\"Security-Category-Breakdown-By-Bandwidth\" title=\" \" width=\"100%\"><fazfilters><fazfilter field=\"appcat\" oper=\"neq\" value=\"Not.Scanned\"></fazfilter><fazfilter field=\"appcat\" oper=\"neq\" value=\"unscanned\"></fazfilter></fazfilters></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2>Web Application</h2><p>Web applications allow users to submit and retrieve content over the internet and they pose a great security risk to the business. Sensitive customer data or confidential business trade secrets can be leaked by employees using vulnerable web applications; applications that can be exploited by attackers using code injection to trick users and redirect them towards.&nbsp;</p><p>The following section shows the top 25 web applications with their application risk ratings, sorted by bandwidth usage.</p><fazchart mkey=\"security-Top25-Web-Applications-By-Bandwidth\" title=\" \" width=\"100%\"><fazfilters></fazfilters></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2>Web Categories</h2><p>Identifying which web categories and websites are accessed by applications provides additional data points for administrators to understand the network traffic usage. Defining appropriate application policies along with web filtering policies will greatly reduce the business risk.&nbsp;</p><p>Fortinet&#39;s proprietary web filtering database is developed by the FortiGuard research team. The database contains more than 47 million rated websites with real-time updates; the websites are categorized into 76 web categories to allow highly-granular web filtering policies. For web filter categories see:http://www.fortiguard.com/static/webfiltering.html&nbsp;</p><p>The following section shows the most commonly visited web categories with their respective bandwidth usage.</p><fazchart mkey=\"Security-Top25-Web-Categories-Visited\" title=\" \" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>2. Threat Detection and Prevention</h1><p>The rise of modern malware has reshaped the threat landscape. These modern threats bypass traditional anti-malware strategies and establish a foothold within the enterprise. They are used by criminals and nation-states to steal sensitive information and attack assets.&nbsp;</p><p>Fortinet next generation firewall provides multi-level protection to combat these advanced persistent threat - the reliable visibility and control of all traffic on the nerwork regardless of evasive tactic. The FortiGuard AntiVirus Service employs advanced virus, spyware, and heuristic detection engines to enable FortiGate systems to detect and prevent both new and evolving threats. For AntiVirus see: http://www.fortiguard.com/antivirus/</p><h2>Malware: Viruses, Bots, Spyware/Adware, Phishing Sites</h2><p>The table below show the common viruses discovered, the botnet C&amp;C communications detected and the spyware/adware and phishing sites found.</p><p>Top 10 Malware, Virus or Spyware</p><fazchart mkey=\"security-Top10-Malware-Virus-Spyware\" title=\" \" width=\"100%\"></fazchart><p>Top 10 Malware Botnet</p><fazchart mkey=\"security-Top10-Malware-Botnet\" title=\" \" width=\"100%\"></fazchart><p>Top 10 Botnet C&C Domains and IPs Detected by DNS Filtering</p><fazchart mkey=\"Top10-dns-Botnet-Domain-IP\" title=\" \" width=\"100%\"></fazchart><p>Top 10 Victims of Malware</p><fazchart mkey=\"security-Top10-Victims-of-Malware\" title=\" \" width=\"100%\"></fazchart><p>Top 10 Victims of Phishing Site</p><fazchart mkey=\"security-Top10-Victims-of-Phishing-Site\" title=\" \" width=\"100%\"></fazchart><p>Top 25 Malicious Phishing Sites</p><fazchart mkey=\"security-Top25-Malicious-Phishing-Sites\" title=\" \" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2>Intrusion and Attacks</h2><p>An application vulnerability could be exploited to compromise the security of the network. Once an application vulnerability has been found, the attacker can exploit it to facilitate a cyber crime. The visibility into application vulnerability exploits enables the administrator to take immediate action against a threat and to protect business assets.&nbsp;</p><p>The FortiGuard Intrusion Prevention Service(IPS) provides Fortinet customers with the latest defences against stealthy network-level threats. It uses a customizable database of more than 5,100 known threats to stop attacks that evade traditional firewall systems. It also provides behaviour based heuristics analysis to enable the FortiGate systems to recognize zero-day attacks. For application Vulnerability and IPS see: http://www.fortiguard.com/static/intrusionprevention.html &nbsp;</p><p>The section below shows application vulnerabilities discovered on the network, ranked by severity and count.</p><fazchart mkey=\"security-Application-Vulnerability\" title=\" \" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2>Advanced Threats</h2><p>A zero-day vulnerability is a previously unknown threat that does not yet have a patch available from the vendor. Commonly used applications such as web browsers and e-mail client applications are often targeted for the zero-day exploits because of their widespread distribution and usage; for example, attacks can send a zero-day malware as e-mail attachments which exploit vulnerabilities in the application opening the attachment.&nbsp;</p><p>FortiGuard research team proactively monitors threat landscape and looks for zero-day vulnerabilities; once a zero-day vulnerability is identified, an advanced signature(s) is developed and pushed out to the customers before a vendor&#39;s patch release is available. These signatures are unique to Fortinet and play an critical role in the fight against advanced persistent threats(APTs).&nbsp;</p><p>The section below provides a summary of the files analyzed by FortiCloud Sandbox during the last period.</p><fazchart mkey=\"security-Files-Analyzed-By-FortiCloud-Sandbox\" title=\" \" width=\"100%\"></fazchart><p>The list below provides some examples of the malicious files detected by FortiCloud Sandbox.</p><fazchart mkey=\"Apprisk-Ctrl-Malicious-Files-Detected-By-FortiCloud-Sandbox\" title=\" \" width=\"100%\"></fazchart><p>Zero-day malware detected on the network by the on-box AntiVirus scanning, sorted by count.</p><fazchart mkey=\"Security-Zero-Day-Detected-On-Network\" title=\" \" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>3. Data Exfiltration Detection and Prevention</h1><p>Applications that have ability to transfer files can pose a significant risk of data loss: company&#39;s customer data, intellectual property and confidential business trade secrets can be sent out of the organization via these applications. Knowing which types of files and content are transferred crossing the network can help administrators to mitigate the risk by setting up appropriate application policies along with data leak prevention rules on the Fortinet next generation firewall system.</p><p>Data loss incidents summary by severity</p><fazchart mkey=\"security-Data-Loss-Incidents-By-Severity\" title=\" \" width=\"100%\"></fazchart><p><span style=\"font-size:12px\">The section below lists the most common files and file types along with the service type.</span></p><fazchart mkey=\"security-Data-Loss-Files-By-Service\" title=\" \" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>4. Endpoint Detection and Prevention</h1><p>FortiClient protects your endpoints with an extra layer of security; it&#39;s engineered to defeat the latest and most dangerous malware and provides real-time protection on the company&#39;s desktops and mobile devices. FortiClient together with Fortinet next generation Firewall delivers fully managed and layered security defences.</p><p><span style=\"font-size:12px\">Security Events Summary</span></p><fazchart mkey=\"security-Endpoint-Security-Events-Summary\" title=\" \" width=\"100%\"></fazchart><p><span style=\"font-size:12px\">Endpoints Running High Risk Applications</span></p><fazchart mkey=\"security-Top-Endpoing-Running-High-Risk-Application\" title=\" \" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><p><span style=\"font-size:12px\">Endpoints Infected with Malware</span></p><fazchart mkey=\"security-Top-Endpoints-Infected-With-Malware\" title=\" \" width=\"100%\"></fazchart><p><span style=\"font-size:12px\">Top Endpoints with Web Violations</span></p><fazchart mkey=\"security-Top-Endpoints-With-Web-Violateions\" title=\" \" width=\"100%\"></fazchart><p><span style=\"font-size:12px\">Top Endpoints with Data Loss Incidents</span></p><fazchart mkey=\"security-Top-Endpoints-With-Data-Loss-Incidents\" title=\" \" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>5. Recommended Actions</h1><p><span style=\"font-size:14px\">Botnet and Malware Infections</span><span style=\"color:#4FC3FE\"><span style=\"font-size:18px\"></span></span><span style=\"color:#3399cc\"><span style=\"font-size:18px\"><span style=\"font-size:14px\"><fazmacro mkey=\"Botnet-and-Malware-Infections\"></fazmacro></span></span></span><span style=\"color:#4FC3FE\"><span style=\"font-size:18px\">&nbsp;</span></span></p><p>Bots can be used for launching denial-of-service(Dos) attacks, distributing spam, spyware and adware, propagating malicious code, and harvesting confidential information which can lead to serious financial and legal consequences.&nbsp;Botnet infections need to be taken seriously and immediate action is required. Identify botnet infected computers and clean-up the computers using AntiVirus software. Fortinet AntiVirus product FortiClient can be used to scan the infected computers and remote botnets from the computer.</p><p><span style=\"font-size:14px\">Evasive Applications</span><span style=\"color:#3399cc\"><span style=\"font-size:14px\"><fazmacro mkey=\"Total-Number-of-Evasive-Applications\"></fazmacro></span></span></p><p>Proxy applications are often used to conceal their activity and bypass the security control. This represents both business and security risks to your organization. Implement the application policies to dictate the use of these applications.</p><p><span style=\"font-size:14px\">P2P Applications</span><span style=\"color:#3399cc\"><span style=\"font-size:14px\"><fazmacro mkey=\"Total-Number-of-P2P-Applications\"></fazmacro></span></span></p><p>These applications can be used to bypass existing content controls and lead to unauthorized data transfer and data policy violations. Policies on appropriate use of these applications need to be implemented.</p><p><span style=\"font-size:14px\">Bandwidth Consuming Applications<span style=\"color:#3399cc\"><fazmacro mkey=\"Total-Number-of-Bandwidth-Consuming-Applications\"></fazmacro></span></span></p><p>Applying application policies to regain control in the use of these applications. Once of the options would be a traffic shaping rule to limit consumption.</p><p><span style=\"font-size:14px\">Deploy a Fortinet Next Generation Firewall</span></p><p>Fortinet next-generation firewalls enable organizations to gain visibility on all application traffic and deliver scalable and secure application control for enterprises. Deploying a Fortinet firewall in your organization and creating secure application policies to ensure that your network is being used according to the organization&#39;s priorities.</p>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90203
                next
            end
        set protected enable
    next

    edit 1000060022
        set is-template enable
        set category "Security"
        set title "Template - Data Loss Prevention Detailed Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Violation Summary and Activity Details of Email, Web, and FTP."
        set body "<h1>DLP Violation Summary</h1><fazchart mkey=\"Email-DLP-Chart\" title=\"Email DLP Violations\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"Web-DLP-Chart\" title=\"Web DLP Violations\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"FTP-DLP-Chart\" title=\"FTP DLP Violations\" filter-logic=\"and\" width=\"100%\"></fazchart><h1>DLP Activity Details</h1><fazchart mkey=\"DLP-Email-Activity-Details\" title=\"Email\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"DLP-Web-Activity-Details\" title=\"Web\" filter-logic=\"and\" width=\"100%\"></fazchart><fazchart mkey=\"DLP-FTP-Activity-Details\" title=\"FTP\" filter-logic=\"and\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90203
                next
            end
        set protected enable
    next

    edit 1000060023
        set is-template enable
        set category "Security"
        set title "Template - PCI-DSS Compliance Review"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set hide-rowid 1
        set description "Summaries for PCI DSS Compliance and Regulatory Requirements, Related Best Security Practices, PCI DSS 3.1 Regulation Details."
        set body "<h1>PCI-DSS Compliance Review</h1><p>This report is designed to help meet PCI-DSS requirements by providing a view of compliant and non-compliant security systems and processes that are regularly tested under Fortinet Best Practice controls. The validations in this report are in accordance with the requirements for PCI-DSS version 3.1</p><h2>About PCI DSS</h2><p>The Payment Card Industry Data Security Standard (PCI-DSS) is a set of policies and procedures, mandated by the four major credit-card companies: Visa, MasterCard, Discover and American Express, with the intention of improving the security of credit and debit card transactions and protect cardholders against theft and misuse of their personal information.&nbsp; Any company that is involved in the transmission, processing or storage of credit card data, must be compliant with PCI-DSS.</p><p>PCI is divided into 12 main requirements, and further broken down into approximately 200 control areas.</p><table align=\"left\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"height:286px; width:100%\"><tbody><tr><td style=\"background-color:rgb(220, 220, 220); width:30%\"><span style=\"font-size:11px\"><strong>Goals</strong></span></td><td style=\"background-color:rgb(220, 220, 220); width:0%\"><span style=\"font-size:11px\"><strong>PCI DSS Requirements</strong></span></td></tr><tr><td><span style=\"font-size:11px\">Build and Maintain a Secure Network</span></td><td><span style=\"font-size:11px\">1. Install and maintain a firewall configuration to protect cardholder data<br />2. Do not use vendor-supplied defaults for system passwords and other security parameters</span></td></tr><tr><td style=\"background-color:rgb(242, 241, 239)\"><span style=\"font-size:11px\">Protect Cardholder Data</span></td><td style=\"background-color:rgb(242, 241, 239)\"><span style=\"font-size:11px\">3. Protect stored cardholder data<br />4. Encrypt transmission of cardholder data across open, public networks</span></td></tr><tr><td><span style=\"font-size:11px\">Maintain a Vulnerability Management Program</span></td><td><span style=\"font-size:11px\">5. Use and regularly update anti-virus software or programs<br />6. Develop and maintain secure systems and applications</span></td></tr><tr><td style=\"background-color:rgb(242, 241, 239)\"><span style=\"font-size:11px\">Implement Strong Access Control Measure</span></td><td style=\"background-color:rgb(242, 241, 239)\"><span style=\"font-size:11px\">7. Restrict access to cardholder data by business need-to-know<br />8. Assign a unique ID to each person with computer access<br />9. Restrict physical access to cardholder data</span></td></tr><tr><td><span style=\"font-size:11px\">Regularly Monitor and Test Networks</span></td><td><span style=\"font-size:11px\">10. Track and monitor all access to network resources and cardholder data<br />11. Regularly test security systems and processes</span></td></tr><tr><td style=\"background-color:rgb(242, 241, 239)\"><span style=\"font-size:11px\">Maintain an Information Security Policy</span></td><td style=\"background-color:rgb(242, 241, 239)\"><span style=\"font-size:11px\">12. Maintain a policy that addresses information security for employees and contractors</span></td></tr></tbody></table><p>&nbsp;</p><p>There are different levels of PCI Compliance depending on the number of transactions that are being processed by the company.</p><ul><li><p>PCI Compliance Level 1<br />Over 6 million Visa and/or MasterCard transactions processed per year</p></li><li><p>PCI Compliance Level 2<br />1 million to 6 million Visa and/or MasterCard transactions processed per year</p></li></ul><ul><li><p>PCI Compliance Level 3<br />20,000 to 1 million Visa and/or MasterCard e-commerce transactions processed per year</p></li></ul><ul><li><p>PCI Compliance Level 4<br />Less than 20,000 to 1 million Visa and/or MasterCard e-commerce transactions processed per year</p></li></ul><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>PCI-DSS Requirements Compliance</h1><h2><br />PCI Compliance Summary</h2><p>&nbsp;</p><table border=\"0\" align=\"left\" cellspacing=\"0\" cellpadding=\"0\" style=\"width:100%\"><tbody><tr><td style=\"width:10%\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/pci_dss_compliant.png\" style=\"height:58px; width:136px\" /></td><td><span style=\"color:#00cc00\"><fazmacro mkey=\"Percent-of-Compliance-for-PCI-DSS-Requirement\"></fazmacro>%</span><span style=\"color:#000000\">Compliant</span></td></tr></tbody></table><p>&nbsp;</p><fazchart mkey=\"PCI-DSS-Compliance-Summary\" title=\"  \" width=\"100%\"></fazchart><h2>Non-Compliant Requirements by Severity</h2><p>The following provides a summary of the number of PCI requirements that are non-compliant, by Fortinet Security Best Practice Severities.</p><fazchart mkey=\"PCI-DSS-Non-Compliant-Requirements-By-Severity\" title=\" \" width=\"100%\"></fazchart><h2><span style=\"color:#3366ff\"><span style=\"color:#3366ff\"></span></span><br />Compliant Requirements by Severity</h2><p>The following provides a summary of the number of PCI requirements that are compliant, by Fortinet Security Best Practice Severities.</p><fazchart mkey=\"PCI-DSS-Compliant-Requirements-By-Severity\" title=\" \" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Fortinet Security Best Practice</h1><h2>&nbsp;</h2><h2>Fortinet Security Best Practice Summary</h2><p>&nbsp;</p><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"width:100%\"><tbody><tr><td style=\"text-align:center; vertical-align:middle; width:3%\"><img data-local=\"true\" alt=\"\" src=\"/resource/images/fazrpt_external/pci_dss_practice.png\" /></td><td style=\"text-align:left; vertical-align:middle\"><span style=\"color:#00cc00\"><fazmacro mkey=\"Percent-of-Passed-Fortinet-Security-Best-Practices\"></fazmacro>%</span><span style=\"color:#000000\">Passed</span></td></tr></tbody></table><fazchart mkey=\"PCI-DSS-Fortinet-Security-Best-Practice-Summary\" title=\" \" width=\"100%\"></fazchart><p>&nbsp;</p><h2>Failed Fortinet Security Best Practices by Severity</h2><p>The following are the Fortinet Security Best Practice requirements that did not passed verification, by Severity Level.</p><fazchart mkey=\"PCI-DSS-Failed-Fortinet-Security-Best-Practices-By-Severity\" title=\"  \" width=\"100%\"></fazchart><p>&nbsp;</p><h2>Passed Fortinet Security Best Practices by Severity</h2><p>The following are the Fortinet Security Best Practice requirements that passed verification, by Severity Level.</p><fazchart mkey=\"PCI-DSS-Passed-Fortinet-Security-Best-Practices-By-Severity\" title=\"  \" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>PCI-DSS Requirements Compliance Details</h1><p>The following provides a breakdown of the standards that are compliant and non-compliant with PCI requirements, as verified by Fortinet Best Practice controls.</p><fazchart mkey=\"PCI-DSS-Requirements-Compliance-Details\" title=\" \" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Fortinet Security Best Practice Details</h1><fazchart mkey=\"PCI-DSS-Fortinet-Security-Best-Practice-Details\" title=\" \" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end

            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90204
                next
            end
        set protected enable
    next

    edit 1000060025
        set is-template enable
        set category "Security"
        set title "Template - Cyber Threat Assessment"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set hide-rowid 1
        set description "Cyber Threat review of Application Visibility and Control, Threat Detection, Prevention and Recommended Actions."
        set body "<p><span style=\"font-size:28px\">Executive Summary</span></p><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"height:121px; width:710px\"><tbody><tr><td colspan=\"2\" style=\"height:100px; vertical-align:bottom\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/ctar_sec_threat.jpg\" style=\"height:90px; width:706px\" /></td></tr><tr><td style=\"width:352px\"><span style=\"font-size:14px\"><strong>IPS Attacks Detected:</strong>&nbsp;<fazmacro mkey=\"Total-Number-of-Attacks\"></fazmacro></span></td><td style=\"width:352px\"><span style=\"font-size:14px\"><strong>Malware/Botnets Detected:&nbsp;</strong><fazmacro mkey=\"CTAP-Total-Malware-Botnet-Detected\"></fazmacro></span></td></tr><tr><td><span style=\"font-size:14px\"><strong>High-Risk Applications Used:</strong>&nbsp;<fazmacro mkey=\"CTAP-Total-High-Risk-Used\"></fazmacro></span></td><td><span style=\"font-size:14px\"><strong>Malicious Websites Detected:</strong>&nbsp;<fazmacro mkey=\"CTAP-Total-Malicious-Websites-Detected\"></fazmacro></span></td></tr></tbody></table><p><span style=\"font-size:12px\">Last year, over 2,100 enterprises were breached as a result of poor internal security practices and latent vendor content security. The average cost of a corporate security breach is estimated at $3.5 million USD and is rising at 15% year over year. Intrusions, malware/botnets and malicious applications collectively comprise a massive risk to your enterprise network. These attack mechanisms can give attackers access to your most sensitive files and database information. FortiGuard Labs mitigates these risks by providing award-winning content security and is consistently rated among industry leaders by objective third parties such as NSS Labs, VB 100 and AV Comparatives.</span></p><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"height:121px; width:710px\"><tbody><tr><td colspan=\"3\" style=\"border-color:rgb(255, 255, 255); width:50px\"><img data-local=\"true\" alt=\"\" src=\"/resource/images/fazrpt_external/ctar_user_prod.jpg\" style=\"height:90px; width:706px\" /></td></tr><tr><td colspan=\"2\" style=\"width:352px\"><span style=\"font-size:14px\"><strong>Applications Detected:</strong>&nbsp;<fazmacro mkey=\"CTAP-Total-Apps-Detected\"></fazmacro></span></td><td style=\"width:352px\"><span style=\"font-size:14px\"><strong>Top Used Application:</strong>&nbsp;<fazmacro mkey=\"CTAP-Top-Used-Application\"></fazmacro></span></td></tr><tr><td colspan=\"2\"><span style=\"font-size:14px\"><strong>Top Application Category:</strong>&nbsp;<fazmacro mkey=\"CTAP-App-Sessions-By-Category\"></fazmacro></span></td><td><span style=\"font-size:14px\"><strong>Websites Visited:</strong>&nbsp;<fazmacro mkey=\"CTAP-Total-Websites-Visited\"></fazmacro></span></td></tr><tr><td colspan=\"2\"><span style=\"font-size:14px\"><strong>Top Website:</strong>&nbsp;<fazmacro mkey=\"Website-with-Highest-Session-Count\"></fazmacro></span></td><td><span style=\"font-size:14px\"><strong>Top Web Category:</strong>&nbsp;<fazmacro mkey=\"Web-Category-with-Highest-Session-Count\"></fazmacro></span></td></tr></tbody></table><p><span style=\"font-size:12px\">User application usage and browsing habits can not only be indicative of inefficient use of corporate resources, but can also indicate a lack of proper enforcement of corporate usage policies. Most enterprises recognize that personal use of corporate resources is acceptable. But there are many grey areas that businesses must keep a close eye on including: use of proxy avoidance/peer to peer applications, inappropriate web browsing, phishing websites, and potentially illegal activity - all of which expose your company to undue liability and potential damages. With over 5,800 application control rules and 250 million categorized websites, FortiGuard Labs provides telemetry that FortiOS uses to keep your business running effectively.</span></p><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"height:109px; width:710px\"><tbody><tr><td colspan=\"4\" style=\"border-color:rgb(255, 255, 255); width:50px\"><img data-local=\"true\" alt=\"\" src=\"/resource/images/fazrpt_external/ctar_net_util.jpg\" style=\"height:90px; width:706px\" /></td></tr><tr><td style=\"width:352px\"><span style=\"font-size:14px\"><strong>Total Bandwidth:&nbsp;</strong><fazmacro mkey=\"CTAP-Total-Bandwidth\"></fazmacro></span></td><td style=\"width:352px\"><span style=\"font-size:14px\"><strong>Top Host by Bandwidth:&nbsp;</strong><fazmacro mkey=\"Source-with-Highest-Bandwidth\"></fazmacro></span></td></tr><tr><td style=\"width:352px\">&nbsp;</td><td style=\"width:352px\">&nbsp;</td></tr></tbody></table><p><span style=\"font-size:12px\">Performance effectiveness is an often undervalued aspect of security devices, but firewalls must keep up with the line speeds that today&rsquo;s next generation switches operate at. A recent survey by Infonetics indicates that 77% of decision-makers at large organizations feel that they must upgrade their network security performance (100+ Gbps aggregate throughput) in the coming year. FortiGates leverage FortiASICs to accelerate CPU intensive functions such as packet forwarding and pattern matching. This offloading typically results in a 5-10X performance increase when measured against competitive solutions.</span></p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><p><br /><span style=\"font-size:28px\">Sandbox Analysis</span></p><p><span style=\"font-size:12px\">Today&rsquo;s increasingly sophisticated threats can mask their maliciousness and bypass traditional antimalware security. Conventional antimalware engines are, in the time afforded and to the certainty required, often unable to classify certain payloads as either good or bad; in fact, their intent is unknown. Sandboxing helps solve this problem &ndash; it entices unknown files to execute in a protected environment, observes its resultant behavior and classifies its risk based on that behavior. With this functionality enabled for your assessment, we have taken a closer look at files traversing your network.</span></p><h2><span style=\"font-size:24px\">Organizational File Usage</span></h2><p><span style=\"font-size:14px\">Total Files Detected&nbsp;(&nbsp;<fazmacro mkey=\"CTAP-SB-Total-Number-of-Files-Detected\"></fazmacro>&nbsp;)<br /><span style=\"font-size:12px\">During the assessment period, we monitored the total number of files that were sent across your network. These files could have been email attachments, files uploaded to file sharing services, downloads from the Internet, etc. This number will give you an idea of the sheer amount of file-based activity either inbound or outbound.</span></span></p><p><span style=\"font-size:14px\">Subset of Files Which Could be Sent for Sandbox Inspection&nbsp;(&nbsp;<fazmacro mkey=\"CTAP-SB-Total-Number-of-Files-Could-be-Executed\"></fazmacro>&nbsp;)<br /><span style=\"font-size:12px\">While some file types like .png files are extremely low risk in nature, others can be executed or contain macros and other active code that could exhibit malicious behaviors. Common files types such as exe, doc, xls, and zip should be inspected for their potential to deliver threats to your network. Fortinet&#39;s sandboxing technologies can inspect more than 50 different file types even while obfuscated within multiple layers of compression.</span></span></p><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"width:710px\"><tbody><tr><td style=\"vertical-align:top\"><fazchart mkey=\"ctap-SB-Files-Needing-Inspection-vs-Others\" title=\"Files Needing Inspection\" width=\"350px\"></fazchart></td><td style=\"vertical-align:top\"><fazchart mkey=\"ctap-SB-Breakdown-of-File-Types\" title=\"Breakdown of File Types\" width=\"350px\"></fazchart></td></tr></tbody></table><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2><span style=\"font-size:24px\">Results of Executable Sandbox Analysis</span></h2><p><span style=\"font-size:14px\">Total EXE Files Analyzed&nbsp;(&nbsp;<fazmacro mkey=\"CTAP-SB-Total-Number-of-Exe-Files-Analyzed\"></fazmacro>&nbsp;)<br /><span style=\"font-size:12px\">As a highest risk file type, we started with executables which, after a standard anti-malware check on the FortiGate, were sent to the sandbox for further inspection. The number here represents the subset of executables that were sent to the sandbox for additional scrutiny.</span></span></p><p><span style=\"font-size:14px\">Total Malicious EXEs Found&nbsp;(&nbsp;<fazmacro mkey=\"CTAP-SB-Malicious-Exes-Found\"></fazmacro>&nbsp;)<br /><span style=\"font-size:12px\">Of the Total EXE Files Analyzed, certain files may have tested positive for malicious threat payloads upon further inspection. Often times this subsequent identification is due to later stage downloads or communications that are known to be malicious. This is the number of malicious files that were discovered during our executable analysis.</span></span></p><fazchart mkey=\"ctap-SB-Top-Sandbox-Malicious-Exes\" title=\"Top Sandbox-identified Malicious EXEs\" width=\"100%\"></fazchart><fazchart mkey=\"ctap-SB-Sources-of-Sandbox-Discovered-Malware\" title=\"Top Sources of Sandbox Discovered Malware\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1><span style=\"font-size:28px\"></span><span style=\"font-size:28px\">Recommended Actions</span></h1><p style=\"text-align:left\"><span style=\"font-size:14px\">Application Vulnerability Attacks Detected&nbsp;(<fazmacro mkey=\"CTAP-Total-App-Vuln-Detected\"></fazmacro></span><span style=\"font-size:14px\">)</span><br /><span style=\"font-size:12px\">Application vulnerabilities (also known as IPS attacks) act as entry points used to bypass security infrastructure and allow attackers a foothold into your organization. These vulnerabilities are often exploited due to an overlooked update or lack of patch management process. Identification of any unpatched hosts is the key to protecting against application vulnerability attacks.</span></p><p><span style=\"font-size:14px\">Malware Detected&nbsp;(<fazmacro mkey=\"CTAP-Total-Malware-Detected\"></fazmacro> )</span><br /><span style=\"font-size:12px\">Malware can take many forms: viruses, trojans, spyware/adware, etc. Any instances of malware detected moving laterally across the network could also indicate a threat vector originating from inside the organization, albeit unwittingly. Through a combination of signature and behavioral analysis, malware can usually be prevented from executing and exposing your network to malicious activity. Augmenting your network with APT/sandboxing technology (e.g. FortiSandbox) can also prevent previously unknown malware (zero-day threats) from propagating within your network.</span></p><p><span style=\"font-size:14px\">Botnet Infections&nbsp;(<fazmacro mkey=\"Total-Number-of-Botnet-Infections\"></fazmacro> )</span><br /><span style=\"font-size:12px\">Bots can be used for launching denial-of-service (DoS) attacks, distributing spam, spyware and adware, propagating malicious code, and harvesting confidential information which can lead to serious financial and legal consequences. Botnet infections need to be taken seriously and immediate action is required. Identify botnet infected computers and clean them up using antivirus software. Fortinet&#39;s FortiClient can be used to scan and remove botnets from the infected hosts.</span></p><p><span style=\"font-size:14px\">Malicious Websites Detected&nbsp;(<fazmacro mkey=\"CTAP-Total-Malicious-Websites-Detected\"></fazmacro>)</span><br /><span style=\"font-size:12px\">Malicious websites are sites known to host software/malware that is designed to covertly collect information, damage the host computer or otherwise manipulate the target machine without the user&#39;s consent. Generally visiting a malicious website is a precursor to infection and represents the initial stages of the kill chain. Blocking malicious sites and/or instructing employees not to visit/install software from unknown websites is the best form of prevention here.</span></p><p><span style=\"font-size:14px\">Phishing Websites Detected&nbsp;(<fazmacro mkey=\"CTAP-Total-Phishing-Websites-Detected\"></fazmacro>)</span><br /><span style=\"font-size:12px\">Similar to malicious websites, phishing websites emulate the webpages of legitimate websites in an effort to collect personal or private (logins, passwords, etc.) information from end users. Phishing websites are often linked to within unsolicited emails sent to your employees. A skeptical approach to emails asking for personal information and hovering over links to determine validity can prevent most phishing attacks.</span></p><p><span style=\"font-size:14px\">Proxy Applications Detected&nbsp;(<fazmacro mkey=\"CTAP-Total-Proxy-Applications-Detected\"></fazmacro>)</span><br /><span style=\"font-size:12px\">These applications are used (usually intentionally) to bypass in-place security measures. For instance, users may circumvent the firewall by disguising or encrypting external communications. In many cases, this can be considered a willful act and a violation of corporate use policies.</span></p><p><span style=\"font-size:14px\">Remote Access Applications Detected&nbsp;(<fazmacro mkey=\"CTAP-Total-RAS-Applications-Detected\"></fazmacro>)</span><br /><span style=\"font-size:12px\">Remote access applications are often used to access internal hosts remotely, thus bypassing NAT or providing a secondary access path (backdoor) to internal hosts. In the worst case scenario, remote access can be used to facilitate data exfiltration and corporate espionage activity. Many times, the use of remote access is unrestricted and internal corporate use changes should be put into practice.</span></p><p><span style=\"font-size:14px\">P2P and Filesharing Applications&nbsp;(<fazmacro mkey=\"Total-Number-of-P2P-Applications\"></fazmacro>)</span><br /><span style=\"font-size:12px\">These applications can be used to bypass existing content controls and lead to unauthorized data transfer and data policy violations. Policies on appropriate use of these applications need to be implemented.</span></p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1><span style=\"font-size:28px\">Security and Threat Prevention</span></h1><h2><span style=\"font-size:24px\">High Risk Applications</span></h2><p><span style=\"font-size:12px\">The FortiGuard research team assigns a risk rating of 1 to 5 to an application based on the application behavioral characteristics. The risk rating can help administrators to identify the high risk applications quickly and make a better decision on the application control policy. Applications listed below were assigned a risk rating of 4 or higher.</span></p><fazchart mkey=\"ctap-apprisk-ctrl-High-Risk-Application\" title=\"High Risk Applications\" width=\"100%\"></fazchart><p style=\"text-align:center\"><span style=\"font-size:12px\">Figure 1: Highest risk applications sorted by risk and sessions</span></p><h2><span style=\"font-size:24px\">Application Vulnerability Exploits</span></h2><p><span style=\"font-size:12px\">Application vulnerabilities can be exploited to compromise the security of your network. The FortiGuard research team analyzes these vulnerabilities and then develops signatures to detect them. FortiGuard currently leverages a database of more than 5,800 known application threats to detect attacks that evade traditional firewall systems. For more information on application vulnerabilities, please refer to FortiGuard at: <a href=\"http://www.fortiguard.com/intrusion\">http://www.fortiguard.com/intrusion</a>.</span></p><fazchart mkey=\"ctap-apprisk-ctrl-Application-Vulnerability\" title=\"Top Application Vulnerability Exploits Detected\" width=\"100%\"></fazchart><p style=\"text-align:center\"><span style=\"font-size:12px\">Figure 2: Top vulnerabilities identified, sorted by severity and count</span></p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2><span style=\"font-size:24px\">Malware, Botnets and Spyware/Adware</span></h2><p><span style=\"font-size:12px\">There are numerous channels that cybercriminals use to distribute malware. Most common methods motivate users to open an infected file in an email attachment, download an infected file, or click on a link leading to a malicious site. During the security assessment, Fortinet identified a number of malware and botnet-related events which indicate malicious file downloads or connections to botnet command and control sites.</span></p><fazchart mkey=\"ctap-apprisk-ctrl-Common-Virus-Botnet-Spyware\" title=\"Top Malware, Botnets and Spyware/Adware Detected\" width=\"100%\"></fazchart><p style=\"text-align:center\"><span style=\"font-size:12px\">Figure 3: Common Malware, Botnets, Spyware and Adware detected</span></p><h2><span style=\"font-size:24px\">At-Risk Devices and Hosts</span></h2><p><span style=\"font-size:12px\">Based on the types of activity exhibited by an individual host, we can approximate the trustworthiness of each individual client. This client reputation is based on key factors such as websites browsed, applications used and inbound/outbound destinations utilized. Ultimately, we can create an overall threat score by looking at the aggregated activity used by each individual host.</span></p><fazchart mkey=\"ctap-App-Risk-Reputation-Top-Devices-By-Scores\" title=\"Most At-Risk Devices and Hosts\" width=\"100%\"></fazchart><p style=\"text-align:center\"><span style=\"font-size:12px\">Figure 4: These devices should be audited for malware and intrusion susceptibility</span></p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2><span style=\"font-size:24px\">Encrypted Web Traffic</span></h2><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tbody><tr><td style=\"vertical-align:top; width:350px\"><p><span style=\"font-size:12px\">From a security perspective, it&#39;s important to visualize how much of your web-based traffic is encrypted. Encrypted traffic poses very real challenges for enterprises who want to ensure that those same applications are not being used for malicious purposes, including data exfiltration. Ideally, your firewall can inspect encrypted traffic at high speeds - this is why performance and hardware/ASIC offloading are key when evaluating a firewall.</span></p></td><td style=\"vertical-align:top; width:10px\">&nbsp;</td><td rowspan=\"2\" style=\"vertical-align:top; width:350px\"><fazchart mkey=\"ctap-HTTP-SSL-Traffic-Ratio\" title=\"HTTPS vs. HTTP Traffic Ratio\" width=\"350px\"></fazchart></td></tr></tbody></table><h2><span style=\"font-size:24px\">Top Source Country/Region</span></h2><p><span style=\"font-size:12px\">By looking at IP source traffic, we can determine the originating country/region of any particular request. Certain botnets, command and control functions, and even remote access can be session heavy and indicative of targeted attacks or persistent threats from nation-states. This chart is representative of country-based traffic - activity from specific originating nations may be anomalous and warrant further investigation.</span></p><fazchart mkey=\"ctap-Top-Source-Countries\" title=\"Top Source Country/Region\" width=\"100%\"></fazchart><p style=\"text-align:center\"><span style=\"font-size:12px\">Figure 5: Activity originating from these country/region should be audited for expected traffic sources</span></p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1><span style=\"font-size:28px\">User Productivity</span></h1><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tbody><tr><td style=\"vertical-align:top; width:350px\"><h2><span style=\"font-size:24px\">Application Usage</span></h2><p><span style=\"font-size:12px\">The FortiGuard research team categorizes applications into different categories based on the application behavioral characteristics, underlying technology, and the related traffic transaction characteristics. The categories allow for better application control. FortiGuard maintains thousands of application sensors and can even perform deep application inspection. For example, IT managers can get unprecedented visibility into filenames sent to the cloud or the titles of videos being streamed.</span></p><p><span style=\"font-size:12px\">For application category details, see: <a href=\"http://www.fortiguard.com/encyclopedia/application\">http://www.fortiguard.com/encyclopedia/application</a></span></p></td><td style=\"vertical-align:top; width:10px\">&nbsp;</td><td style=\"vertical-align:top; width:350px\"><fazchart mkey=\"Apprisk-Ctrl-Risk-Application-Usage-By-Category-With-Pie\" title=\"App Categories\" width=\"350px\"><fazfilters><fazfilter field=\"appcat\" oper=\"neq\" value=\"Not.Scanned,unscanned\"></fazfilter></fazfilters></fazchart></td></tr></tbody></table><p><span style=\"font-size:12px\">With the proliferation of cloud-based computing, enterprises are increasingly reliant on third parties for infrastructure plumbing. Unfortunately for enterprises, this means that their information is only as secure as the cloud provider&#39;s security. In addition, it can often introduce redundancy (if services are already available internally) and increase costs (if not monitored properly).</span></p><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tbody><tr><td style=\"vertical-align:top; width:350px\"><fazchart mkey=\"ctap-SaaS-Apps\" title=\"Cloud Usage (SaaS)\" width=\"350px\"></fazchart></td><td style=\"vertical-align:top; width:10px\">&nbsp;</td><td style=\"vertical-align:top; width:350px\"><p><span style=\"font-size:12px\">IT managers are often unaware of how many cloud-based services are in use within their organization. Sometimes, these applications can be used to circumvent or even replace corporate infrastructure already available to users in lieu of ease of use. Unfortunately, a potential side effect of this is that your sensitive corporate information could be transferred to the cloud. Accordingly, your data could be exposed if the cloud provider&#39;s security infrastructure is breached.</span></p></td></tr><tr><td style=\"vertical-align:top\"><p><span style=\"font-size:12px\">The adoption of &quot;infrastructure as a service&quot; (IaaS) platforms is popular and can be very useful when compute resources are limited or have specialized requirements. That said, the effective outsourcing of your infrastructure must be well regulated to prevent misuse. The occasional auditing of IaaS applications can be a useful exercise not only for security purposes, but also to minimize organizational costs associated with pay per use models or recurring subscription fees.</span></p></td><td style=\"vertical-align:top\">&nbsp;</td><td style=\"vertical-align:top\"><fazchart mkey=\"ctap-IaaS-Apps\" title=\"Cloud Usage (IaaS)\" width=\"350px\"></fazchart></td></tr></tbody></table><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2><span style=\"font-size:24px\">Application Category Breakdowns</span></h2><p><span style=\"font-size:12px\">Understanding application subcategories can give invaluable insights into how efficiently your corporate network is operating. Certain application types (such as P2P or gaming applications) are not necessarily conducive to corporate environments and can be blocked or limited in their scope. Other applications may have dual purpose uses (such as video/audio streaming or social media apps) and can be managed accordingly. These charts illustrate application categories sorted by the amount of bandwidth they used during the discovery period.</span></p><table align=\"left\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tbody><tr><td style=\"vertical-align:top; width:350px\"><fazchart mkey=\"ctap-RAS-Apps\" title=\"Remote Access Applications\" width=\"350px\"></fazchart></td><td style=\"vertical-align:top; width:10px\">&nbsp;</td><td style=\"vertical-align:top; width:350px\"><fazchart mkey=\"ctap-Proxy-Apps\" title=\"Proxy Applications\" width=\"350px\"></fazchart></td></tr><tr><td style=\"vertical-align:top\"><fazchart mkey=\"ctap-Top-SocialMedia-App-By-Bandwidth\" title=\"Top Social Media Applications\" width=\"350px\"></fazchart></td><td style=\"vertical-align:top\">&nbsp;</td><td style=\"vertical-align:top\"><fazchart mkey=\"ctap-Top-Streaming-App-By-Bandwidth\" title=\"Top Video/Audio Streaming Applications\" width=\"350px\"></fazchart></td></tr><tr><td style=\"vertical-align:top\"><fazchart mkey=\"ctap-Top-Game-App-By-Bandwidth\" title=\"Top Gaming Applications\" width=\"350px\"></fazchart></td><td style=\"vertical-align:top\">&nbsp;</td><td style=\"vertical-align:top\"><fazchart mkey=\"ctap-Top-P2P-App-By-Bandwidth\" title=\"Top Peer to Peer Applications\" width=\"350px\"></fazchart></td></tr></tbody></table><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2><span style=\"font-size:24px\">Web Usage</span></h2><p><span style=\"font-size:12px\">Web browsing habits can not only be indicative of inefficient use of corporate resources, but can also indicate an inefficient optimization of web filtering policies. It can also give some insight into the general web browsing habits of corporate users and assist in defining corporate compliance guidelines.</span></p><fazchart mkey=\"ctap-apprisk-ctrl-Top-Web-Categories-Visited\" title=\"Top Web Categories\" width=\"100%\"></fazchart><p><span style=\"font-size:12px\">In today&rsquo;s network environments, many applications leverage HTTP for communications &ndash; even some you wouldn&rsquo;t normally expect. The primary benefit of HTTP is that communication is ubiquitous, universally accepted and (generally) open on most firewalls. For most business-related and whitelisted applications this typically augments communication, but some non-business applications also use HTTP in either unproductive or potentially nefarious ways.</span></p><fazchart mkey=\"ctap-App-Risk-Applications-Running-Over-HTTP\" title=\"Top Web Applications\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2><span style=\"font-size:24px\">Websites Frequented</span></h2><p><span style=\"font-size:12px\">Websites browsed are strong indicators of how employees utilizing corporate resources and how applications communicate with specific websites. Analyzing domains accessed can lead to changes in corporate infrastructure such as website blocking, deep application inspection of cloud-based apps and implementation of web traffic acceleration technologies.</span></p><fazchart mkey=\"ctap-App-Risk-Web-Browsing-Activity-Hostname-Category\" title=\"Most Visited Web Domains\" width=\"100%\"></fazchart><p><span style=\"font-size:12px\">Estimated browsing times for individual websites can be useful when trying to get an accurate picture of popular websites. Typically, these represent internal web resources such as intranets, but they can occasionally be indicative of excessive behavior. Browse times can be employed to justify the implementation of web caching technologies or help shape organizational corporate use policies.</span></p><fazchart mkey=\"ctap-Top-Sites-By-Browsing-Time\" title=\"Top Websites by Browsing Time\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1><span style=\"font-size:28px\">Network Utilization</span></h1><h2><span style=\"font-size:24px\">Bandwidth</span></h2><p><span style=\"font-size:12px\">By looking at bandwidth usage when distributed over an average day, administrators can better understand their organizational ISP connection and interface speed requirements. Bandwidth can also be optimized on an application basis (using throttling), specific users can be prioritized during peak traffic times, and updates can be rescheduled outside of working hours.</span></p><fazchart mkey=\"ctap-Average-Bandwidth-Hour\" title=\"Average Bandwidth by Hour\" width=\"100%\"></fazchart><p><span style=\"font-size:12px\">One of the most telling ways to analyze bandwidth is by looking at destinations and sources generating the most traffic. Common destination sites (e.g. external websites), such as those for OS/firmware updates, can be throttled to allow prioritized, business critical traffic. Internally, high traffic hosts can be optimized through traffic shaping or corporate use policies.</span></p><fazchart mkey=\"ctap-Top-Bandwidth-Hosts\" title=\"Top Bandwidth Consuming Sources/Destinations\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1><span style=\"font-size:20px\">FortiGuard Security and Services</span></h1><p><span style=\"font-size:12px\">Knowledge of the threat landscape combined with the ability to respond quickly at multiple levels is the foundation for providing effective security. Hundreds of researchers at FortiGuard Labs scour the cyber landscape every day to discover emerging threats and develop effective countermeasures to protect organizations around the world. They are the reason FortiGuard is credited with over 250 zero-day and vulnerability discoveries and why Fortinet security solutions score so high in real-world security effectiveness tests at NSS Labs, Virus Bulletin, AV Comparatives, and more.</span></p><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"width:100%\"><tbody><tr><td style=\"vertical-align:top; width:60px\"><p><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/fgservice_appctrl_sm.png\" style=\"height:64px; width:50px\" /></p></td><td style=\"vertical-align:top\"><p><strong>Next Generation Application Control &amp; IPS</strong><br /><span style=\"font-size:12px\">Application control and intrusion prevention (IPS) are foundational security technologies in a next generation firewall like the FortiGate. Organizations worldwide use FortiGuard application control and IPS in the FortiGate platform to manage their applications and block network intrusions (every minute of every day FortiGuard blocks ~470,000 intrusion attempts). FortiGates running application control and IPS are tested for effectiveness in industry comparison tests by NSS Labs and consistently receive Recommended ratings.</span></p></td></tr><tr><td style=\"vertical-align:top\"><p><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/fgservice_webfilter_sm.png\" style=\"height:63px; width:50px\" /></p></td><td style=\"vertical-align:top\"><p><strong>Web Filtering</strong><br /><span style=\"font-size:12px\">Every minute of every day FortiGuard Labs processes approximately 43M URL categorization requests and blocks 160k malicious websites. The Web Filtering service rates over 250M websites and delivers nearly 1.5M new URL ratings every week. FortiGuard is the only VBWeb certified web filtering solution - blocking 97.7% of direct malware downloads in 2016 tests.</span></p></td></tr><tr><td style=\"vertical-align:top\"><p><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/fgservice_antivirus_sm.png\" style=\"height:64px; width:50px\" /></p></td><td style=\"vertical-align:top\"><p><strong>AntiVirus and Mobile Security</strong><br /><span style=\"font-size:12px\">Every minute of every day FortiGuard Labs neutralizes approximately 95,000 malware programs targeting traditional, mobile and IoT platforms. Patented technologies enable FortiGuard antivirus to identify thousands of current and future malware variants with a single signature &ndash; optimizing both security effectiveness and performance. Fortinet consistently receives superior effectiveness results in industry testing with Virus Bulletin and AV Comparatives</span></p></td></tr><tr><td style=\"vertical-align:top\"><p><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/fgservice_antispam_sm.png\" style=\"height:64px; width:50px\" /></p></td><td style=\"vertical-align:top\"><p><strong>AntiSpam</strong><br /><span style=\"font-size:12px\">Every minute of every day FortiGuard Labs blocks approximately 21,000 spam emails and each week the Labs deliver approximately 46M new and updated spam rules. Email is the #1 vector for the start of an advanced attack on an organization so highly effective antispam is a key part of a security strategy.</span></p></td></tr><tr><td style=\"vertical-align:top\"><p><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/fgservice_atp_sm.png\" style=\"height:63px; width:50px\" /></p></td><td style=\"vertical-align:top\"><p><strong>Advanced Threat Protection (FortiSandbox)</strong><br /><span style=\"font-size:12px\">Thousands of organizations around the world leverage FortiSandbox to identify advanced threats. FortiSandbox consistently receives a Recommended rating for breach detection systems from NSS Labs in industry tests and in 2015 NSS Labs tests achieved a 97%+ breach detection rating.</span></p></td></tr><tr><td style=\"vertical-align:top\"><p><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/fgservice_ipreputation_sm.png\" style=\"height:64px; width:50px\" /></p></td><td style=\"vertical-align:top\"><p><strong>IP Reputation</strong><br /><span style=\"font-size:12px\">Every minute of every day FortiGuard Labs blocks approximately 32,000 botnet command &amp; control communication attempts. A key part of the attack kill chain on an organization is when the threat communicates with a command &amp; control server &ndash; either to download additional threats or to exfiltrate stolen data. IP and Domain address reputation blocks this communication, neutralizing threats.</span></p></td></tr></tbody></table>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end

            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90203
                next
            end
        set protected enable
    next

    edit 1000060026
        set is-template enable
        set category "Application"
        set title "Template - SaaS Application Usage Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Summarizes the usage of SaaS apps compared to all applications, Sanctioned vs Unsancationed SaaS applications, and total bandwidth by SaaS Sanctioned and Unsanctioned apps."
        set body "<h1><span style=\"color:#0000CD\">Summary</span></h1><p>The following is a representation of the SaaS Application usage on the network. This includes the usage of SaaS apps compared to all applications, Sanctioned vs Unsanctioned SaaS applications, and total bandwidth by SaaS Sanctioned and Unsanctioned apps.<br />&nbsp;</p><p><span style=\"font-size:14px\"><strong>Key Findings</strong></span></p><div><div style=\"display:inline-block;width: 160px; height: 20px; position: relative; background: rgb(94,99,191); box-shadow: inset 0 -1px 1px rgba(255,255,255,0.3); padding:0px; margin-right: 16px;\"><span style=\"background-color:rgb(79,195,254); display:block; height:100%; min-width:2px; overflow:hidden; position:relative; width:&lt;fazmacro mkey='saas-SaaS-Application-Percentage'&gt;&lt;/fazmacro&gt;\"></span></div><span style=\"font-size:12px; vertical-align:text-top\"><strong><fazmacro mkey=\"saas-SaaS-Application-Percentage\"></fazmacro></strong>of applications on the network are SaaS</span></div><div><div style=\"display:inline-block;width: 160px; height: 20px; position: relative; background: rgb(0,204,255); box-shadow: inset 0 -1px 1px rgba(255,255,255,0.3); padding:0px; margin-right: 16px;\"><span style=\"background-color:rgb(204, 51, 51); display:block; height:100%; min-width:1px; overflow:hidden; position:relative; width:&lt;fazmacro mkey='saas-Unsanctioned-SaaS-Application-Percentage'&gt;&lt;/fazmacro&gt;\"></span></div><span style=\"font-size:12px; vertical-align:text-top\"><strong><fazmacro mkey=\"saas-Unsanctioned-SaaS-Application-Percentage\"></fazmacro></strong>of SaaS applications on the network are unsanctioned</span></div><h1><span style=\"color:#0000CD\"><br />SaaS Categories</span></h1><table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"border-spacing:0 6px; height:68px; width:100%\"><tbody><tr><td style=\"background-color:rgb(0, 204, 255); height:40px; text-align:center; width:158px\"><span style=\"font-size:14px\"><span style=\"color:rgb(255, 255, 255)\">Sanctioned</span></span></td><td style=\"width:20px\">&nbsp;</td><td><span style=\"font-size:12px\">Applications used by the business and therefore allowed. however, need to have visibility and control into how they&rsquo;re used.</span></td></tr><tr><td style=\"background-color:rgb(204, 51, 51); height:40px; text-align:center; width:100px\"><span style=\"font-size:14px\"><span style=\"color:rgb(255, 255, 255)\">Unsanctioned</span></span></td><td>&nbsp;</td><td><span style=\"font-size:12px\">Dangerous, known to host malware. Block access.</span></td></tr></tbody></table><h1><span style=\"color:rgb(0, 0, 205)\"><br />Applications</span></h1><table cellspacing=\"1\" cellpadding=\"1\" border=\"0\" style=\"width:100%\"><tbody><tr><td style=\"width:50%\"><fazchart mkey=\"saas-Application-Discovered\" title=\"{default}\" width=\"100%\"></fazchart><p>&nbsp;</p></td><td><fazchart mkey=\"saas-SaaS-Application-by-Category\" title=\"{default}\" width=\"100%\"></fazchart><p>&nbsp;</p></td></tr></tbody></table><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1><span style=\"color:#0000CD\"></span><span style=\"color:#0000CD\">SaaS Users</span></h1><table cellspacing=\"1\" cellpadding=\"1\" border=\"0\" style=\"width:100%\"><tbody><tr><td style=\"width:50%\"><fazchart mkey=\"saas-SaaS-App-Users-vs-Others\" title=\"{default}\" width=\"100%\"></fazchart><p>&nbsp;</p></td><td><fazchart mkey=\"saas-SaaS-App-Users\" title=\"{default}\" width=\"100%\"></fazchart><p>&nbsp;</p></td></tr></tbody></table><fazchart mkey=\"saas-Top-SaaS-User-by-Bandwidth-Session\" title=\"{default}\" width=\"100%\"></fazchart><h2>&nbsp;</h2><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2>Top 10 Categories - SaaS Application Usage</h2><p>The following graph shows the SaaS Sanctioned and Unsanctioned applications by Category.</p><fazchart mkey=\"saas-Top-Category-by-SaaS-Application-Usage\" title=\"\" width=\"100%\"></fazchart><h2>Top 10 SaaS Categories by Number of Users</h2><p>The following graph displays the number of Users of Sanctioned and Unsanctioned SaaS Applications by Category.</p><fazchart mkey=\"saas-Top-SaaS-Category-by-Number-of-User\" title=\"\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2>Top 10 Users by Number of SaaS Applications</h2><p>The following graph shows the Top users by number of SaaS Applications.</p><fazchart mkey=\"saas-Top-User-by-Number-of-SaaS-Application\" title=\"\" width=\"100%\"></fazchart><fazchart mkey=\"saas-Top-SaaS-Application-by-Bandwidth-Session\" title=\"{default}\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><fazchart mkey=\"saas-Top-File-Sharing-SaaS-Application\" title=\"{default}\" width=\"100%\"></fazchart><fazchart mkey=\"saas-Top-File-Sharing-SaaS-Application-Drilldown\" title=\"Top 5 File Sharing Applications Detail\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90200
                next
                edit 90201
                next
            end
        set protected enable
    next

    edit 1000060027
        set is-template enable
        set category "Security"
        set title "Template - What is New Report"
        set coverpage-background-image "{sys_img_path}/Security_Fabric_Cover.png"
        set description "What is New on your Security Fabric"
        set body "<fazchart mkey=\"newthing-New-Users\" title=\"{default}\" width=\"100%\"></fazchart><fazchart mkey=\"newthing-New-Devices\" title=\"{default}\" width=\"100%\"></fazchart><fazchart mkey=\"newthing-New-Software-Installed\" title=\"{default}\" width=\"100%\"></fazchart><h2>New Security Threats</h2><fazchart mkey=\"newthing-New-Security-Threats-Timeline\" title=\"\" width=\"100%\"></fazchart><fazchart mkey=\"newthing-New-Security-Threats\" title=\"\" width=\"100%\"></fazchart><fazchart mkey=\"newthing-dns-Botnet-Domain-IP\" title=\"New Botnet C&C Detected by DNS Filtering\" width=\"100%\"></fazchart><h2>New Vulnerabilities</h2><fazchart mkey=\"newthing-New-Vulnerability-Graph\" title=\"\" width=\"50%\"></fazchart><fazchart mkey=\"newthing-New-Vulnerability\" title=\"\" width=\"100%\"></fazchart><fazchart mkey=\"newthing-System-Alerts\" title=\"{default}\" width=\"100%\"></fazchart><fazchart mkey=\"newthing-Configuration-Changes\" title=\"{default}\" width=\"100%\"></fazchart><fazchart mkey=\"newthing-FortiGate-Upgrades\" title=\"{default}\" width=\"100%\"></fazchart><fazchart mkey=\"newthing-User-Upgrades\" title=\"{default}\" width=\"100%\"></fazchart><p>&nbsp;</p>"
            config header
                edit 1
                    set type graphic
                    set graphic "Security_Fabric_header.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90100
                next
                edit 90101
                next
                edit 90202
                next
                edit 90203
                next
            end
        set hide-report-title 1
        set report-tag "fabric"
        set protected enable
    next

    edit 1000060028
        set is-template enable
        set category "System"
        set title "Template - GTP Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "GTP Report."
        set body "<fazchart mkey=\"GTP-List-of-APN-Used\" title=\"{default}\" width=\"100%\"></fazchart><fazchart mkey=\"GTP-Top-APN-by-Bytes\" title=\"{default}\" width=\"100%\"></fazchart><fazchart mkey=\"GTP-Top-APN-by-Duration\" title=\"{default}\" width=\"100%\"></fazchart><fazchart mkey=\"GTP-Top-APN-by-Packets\" title=\"{default}\" width=\"100%\"></fazchart><p>&nbsp;</p>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90200
                next
                edit 90201
                next
            end
        set protected enable
    next

    edit 1000060029
        set is-template enable
        set category "System"
        set title "Template - DNS Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Summarizes the suspicious or high risk DNS activity on the network."
        set body "<fazchart mkey=\"dns-Botnet-Domain-IP\" title=\"Botnet C&C Detected by DNS Filtering\" width=\"100%\"></fazchart><p>&nbsp;</p><fazchart mkey=\"dns-High-Risk-Source\" title=\"{default}\" width=\"100%\"></fazchart><p>&nbsp;</p><fazchart mkey=\"dns-DNS-Request-Over-Time\" title=\"{default}\" width=\"100%\"></fazchart><p>&nbsp;</p><fazchart mkey=\"dns-Top-Queried-Domain\" title=\"{default}\" width=\"100%\"></fazchart><p>&nbsp;</p><fazchart mkey=\"dns-Top-Domain-Lookup-Failure-Bar\" title=\"Top Domain Lookup Failures\" width=\"100%\"></fazchart><fazchart mkey=\"dns-Top-Domain-Lookup-Failure-Table\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><fazchart mkey=\"dns-Query-Timeout\" title=\"{default}\" width=\"100%\"></fazchart><p>&nbsp;</p><fazchart mkey=\"dns-Blocked-Query\" title=\"{default}\" width=\"100%\"></fazchart><p>&nbsp;</p>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
            end
        set protected enable
    next

    edit 1000060030
        set is-template enable
        set category "System"
        set title "Template - FortiGate Performance Statistics Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "FortiGate Performance Statistics Report."
        set body "<fazchart mkey=\"perf-stat-usage-summary-average\" title=\"{default}\" width=\"100%\"></fazchart><fazchart mkey=\"perf-stat-usage-summary-peak\" title=\"{default}\" width=\"100%\"></fazchart><p>&nbsp;</p><div style=\"page-break-before: always\"><span style=\"display:none\">&nbsp;</span></div><fazchart mkey=\"perf-stat-usage-details-drilldown-master\" title=\"{default}\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
            end
        set protected enable
    next
    edit 1000060031
        set is-template enable
        set category "Application"
        set title "Template - High Bandwidth Application Usage Report"
        set description "High Bandwidth Application Usage Report."
        set body "<div style=\"height:15px\"></div><h2><span style=\"font-size:18px; font-family:Lato; color:black\"> SUMMARY</span></h2><h2><span style=\"font-size:14px\">Fortinet High Bandwidth Application Usage Report provides visibility for identifying the applications and users on your network that are consuming the most bandwidth and </span><span style=\"font-size:14px\">introducing the most risk. This report summarizes the </span><span style=\"font-size:14px\">findings and provides an overall risk assessment with recommended actions.</span></h2><h2><span></span></h2><h2><span style=\"font-size:18px; font-family:Lato; color:black\">KEY FINDINGS</span><span></span></h2><table style=\"padding-top:5px; width:100%\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\"><tr><td style=\"vertical-align:bottom; width:28px\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/app_applications.png\" style=\"height:24px; width:24px\" /></td><td style=\"vertical-align:bottom\"><b><span style=\"font-size:24px\"><fazmacro mkey=\"Total-Number-of-Applications\"><fazfilters><fazfilter field=\"appcat\" oper=\"neq\" value=\"Not.Scanned\"></fazfilter><fazfilter field=\"appcat\" oper=\"neq\" value=\"unscanned\"></fazfilter></fazfilters></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato\"> Applications</span></td><td style=\"vertical-align:bottom; width:28px\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/app_categories.png\" style=\"height:24px; width:24px\" /></td><td style=\"vertical-align:bottom\"><b><span style=\"font-size:24px\"><fazmacro mkey=\"Total-Number-of-App-Category\"><fazfilters><fazfilter field=\"appcat\" oper=\"neq\" value=\"Not.Scanned\"></fazfilter><fazfilter field=\"appcat\" oper=\"neq\" value=\"unscanned\"></fazfilter></fazfilters></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato\">Categories</span></td><td style=\"vertical-align:bottom; width:28px\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/app_bandwidth_usage.png\" style=\"height:15px; width:24px\" /></td><td style=\"vertical-align:bottom\"><b><span style=\"font-size:24px\"><fazmacro mkey=\"Total-Usage-of-Applications\"><fazfilters><fazfilter field=\"appcat\" oper=\"neq\" value=\"Not.Scanned\"></fazfilter><fazfilter field=\"appcat\" oper=\"neq\" value=\"unscanned\"></fazfilter></fazfilters></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato\"> Total Bytes</span></td><td style=\"vertical-align:bottom; width:27px\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/app_per_day.png\" style=\"height:24px; width:24px\" /></td><td style=\"vertical-align:bottom\"><b><span style=\"font-size:24px\"><fazmacro mkey=\"Total-Usage-of-Applications-Per-Day\"><fazfilters><fazfilter field=\"appcat\" oper=\"neq\" value=\"Not.Scanned\"></fazfilter><fazfilter field=\"appcat\" oper=\"neq\" value=\"unscanned\"></fazfilter></fazfilters></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato\"> per Day</span></td><td style=\"vertical-align:bottom; width:28px\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/app_users.png\" style=\"height:24px; width:24px\" /></td><td style=\"vertical-align:bottom\"><b><span style=\"font-size:24px\"><fazmacro mkey=\"Total-Number-of-Application-Users\"><fazfilters><fazfilter field=\"appcat\" oper=\"neq\" value=\"Not.Scanned\"></fazfilter><fazfilter field=\"appcat\" oper=\"neq\" value=\"unscanned\"></fazfilter></fazfilters></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato\"> Users</span></td></tr></table><div style=\"height:25px\"></div><p></p><fazchart width=\"924px\" title=\"Top 3 Application Categories by Bandwidth\" mkey=\"Top-App-Category-by-Bandwidth\"><fazfilters><fazfilter field=\"appcat\" oper=\"neq\" value=\"Not.Scanned\"></fazfilter><fazfilter field=\"appcat\" oper=\"neq\" value=\"unscanned\"></fazfilter></fazfilters></fazchart><h2></h2><div style=\"page-break-after: always\"></div><h2><span><span style=\"font-size:17px; font-family:Lato\">PEER-TO-PEER APPLICATIONS</span></span><span></span></h2><h2><span></span><span style=\"font-size:16px\">The following is a summary of the most used P2P applications, identifying those with the most usage by bandwidth, session, number of users and highest risk.</span></h2><div style=\"height:20px\"></div><div style=\"display:-webkit-box; -webkit-box-pack:justify; width:1000px\"><div style=\"white-space: nowrap;\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/app_applications.png\" style=\"height:24px; width:24px\" /><b><span style=\"font-size:24px\"><fazmacro mkey=\"Total-Number-of-P2P-Apps\"></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato\"> P2P Applications</span></div><div style=\"white-space: nowrap;\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/app_users.png\" style=\"height:24px; width:24px\" /><b><span style=\"font-size:24px\"><fazmacro mkey=\"Total-Number-of-P2P-Application-Users\"></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato\"> Users</span></div><div style=\"white-space: nowrap;\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/app_bandwidth_usage.png\" style=\"height:15px; width:24px\" /><b><span style=\"font-size:24px\"><fazmacro mkey=\"Total-Usage-of-P2P-Applications\"></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato\"> Total Bytes</span></div><div style=\"white-space: nowrap;\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/app_sessions.png\" style=\"height:24px; width:24px\" /><b><span style=\"font-size:24px\"><fazmacro mkey=\"Total-Sessions-of-P2P-Applications\"></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato\"> Sessions</span></div></div><div style=\"height:35px\"></div><table cellpadding=\"0\" cellspacing=\"0\"><tr><td><fazchart width=\"500px\" title=\"Top 10 P2P Apps by Bandwidth\" mkey=\"Top-10-Interested-Apps-by-Bandwidth\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"P2P\"></fazfilter></fazfilters></fazchart></td><td><fazchart width=\"500px\" title=\"Top 10 P2P Apps by Sessions\" mkey=\"Top-10-Interested-Apps-by-Session\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"P2P\"></fazfilter></fazfilters></fazchart></td></tr><tr><td><fazchart width=\"500px\" title=\"Top 10 P2P Apps by Number of Users\" mkey=\"Top-Interested-Apps-by-Number-of-Users\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"P2P\"></fazfilter></fazfilters></fazchart></td><td><fazchart width=\"500px\" title=\"Top 10 P2P Users by Bandwidth\" mkey=\"Top-Interested-App-Users-by-Bandwidth\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"P2P\"></fazfilter></fazfilters></fazchart></td></tr></table><div style=\"height:5px\"><h2><span></span></h2></div><div style=\"height:15px\"></div><div style=\"height:10px\"></div><div style=\"page-break-after: always\"></div><div style=\"height:15px\"></div><table cellpadding=\"0\" cellspacing=\"0\"><tr><td style=\"vertical-align:top\"><fazchart width=\"400px\" title=\"Top 10 P2P Users by Sessions\" mkey=\"Top-10-User-by-Session\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"P2P\"></fazfilter></fazfilters></fazchart></td><td style=\"vertical-align:top\"><fazchart width=\"600px\" title=\"Top 10 P2P Traffic Usage History\" mkey=\"Top-Interested-App-Users-By-Bandwidth-Timeline\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"P2P\"></fazfilter></fazfilters></fazchart></td></tr></table><fazchart width=\"1000px\" title=\"Peer to Peer Applications\" mkey=\"Interested-Applications-by-Risk-Level\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"P2P\"></fazfilter></fazfilters></fazchart><div style=\"page-break-after: always\"></div><div style=\"height:10px\"></div><h2><span style=\"font-size:17px; font-family:Lato\"> FILE SHARING APPLICATIONS</span></h2><h2><span></span><span style=\"font-size:16px\">The following provides a summary of the most used File Sharing and Storage applications used on the network, identifying those that are high risk as well as most bandwidth consumption.</span></h2><div style=\"height:20px\"></div><div style=\"display:-webkit-box; -webkit-box-pack:justify; width:1000px\"><div style=\"white-space: nowrap;\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/app_applications.png\" style=\"height:24px; width:24px\" /><b><span style=\"font-size:24px\"><fazmacro mkey=\"Total-Number-of-File-Sharing-Applications\"></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato\"> File Sharing and Storage Applications</span></div><div style=\"white-space: nowrap;\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/app_users.png\" style=\"height:24px; width:24px\" /><b><span style=\"font-size:24px\"><fazmacro mkey=\"Total-Number-of-File-Sharing-Application-Users\"></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato\"> Users</span></div><div style=\"white-space: nowrap;\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/app_bandwidth_usage.png\" style=\"height:15px; width:24px\" /><b><span style=\"font-size:24px\"><fazmacro mkey=\"Total-Usage-of-File-Sharing-Applications\"></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato\"> Total Bytes</span></div><div style=\"white-space: nowrap;\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/app_sessions.png\" style=\"height:24px; width:24px\" /><b><span style=\"font-size:24px\"><fazmacro mkey=\"Total-Sessions-of-File-Sharing-Applications\"></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato\"> Sessions</span></div></div><div style=\"height:35px\"></div><table cellpadding=\"0\" cellspacing=\"0\"><tr><td><fazchart width=\"500px\" title=\"Top 10 File Sharing Apps by Bandwidth\" mkey=\"Top-10-Interested-Apps-by-Bandwidth\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"Storage.Backup,File.Sharing\"></fazfilter></fazfilters></fazchart></td><td><fazchart width=\"500px\" title=\"Top 10 File Sharing Apps by Sessions\" mkey=\"Top-10-Interested-Apps-by-Session\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"Storage.Backup,File.Sharing\"></fazfilter></fazfilters></fazchart></td></tr><tr><td><fazchart width=\"500px\" title=\"Top 10 File Sharing Apps by Number of Users\" mkey=\"Top-Interested-Apps-by-Number-of-Users\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"Storage.Backup,File.Sharing\"></fazfilter></fazfilters></fazchart></td><td><fazchart width=\"500px\" title=\"Top 10 File Sharing Users by Bandwidth\" mkey=\"Top-Interested-App-Users-by-Bandwidth\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"Storage.Backup,File.Sharing\"></fazfilter></fazfilters></fazchart></td></tr></table><div style=\"height:5px\"><h2><span></span></h2></div><div style=\"height:15px\"></div><div style=\"height:10px\"></div><div style=\"page-break-after: always\"></div><div style=\"height:15px\"></div><table style=\"height:170px\" cellpadding=\"0\" cellspacing=\"0\"><tr><td style=\"vertical-align:top\"><fazchart width=\"400px\" title=\"Top 10 File Sharing Users by Sessions\" mkey=\"Top-10-User-by-Session\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"Storage.Backup,File.Sharing\"></fazfilter></fazfilters></fazchart></td><td style=\"vertical-align:top\"><fazchart width=\"600px\" title=\"Top 10 File Sharing Traffic Usage History\" mkey=\"Top-Interested-App-Users-By-Bandwidth-Timeline\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"Storage.Backup,File.Sharing\"></fazfilter></fazfilters></fazchart></td></tr></table><fazchart width=\"1000px\" title=\"File Sharing and Storage Applications\" mkey=\"Interested-Applications-by-Risk-Level\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"Storage.Backup,File.Sharing\"></fazfilter></fazfilters></fazchart><div style=\"page-break-after: always\"></div><h2><span style=\"font-size:17px; font-family:Lato\"> VIDEO AND AUDIO APPLICATIONS</span></h2><h2><span></span><span style=\"font-size:16px\">Increased usage of Video and Audio bandwidth often results in performance degradation on a network, and restricting uses from engaging in \"non-permissible\" bandwidth-intensive activities, such as file sharing or movie downloading, is sometimes necessary. The following details the Video and Audio usage on the network:</span></h2><div style=\"height:20px\"></div><div style=\"display:-webkit-box; -webkit-box-pack:justify; width:1000px\"><div style=\"white-space: nowrap;\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/app_applications.png\" style=\"height:24px; width:24px\" /><b><span style=\"font-size:24px\"><fazmacro mkey=\"Total-number-of-Video-and-Audio-applications\"></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato\"> Video and Audio Applications</span></div><div style=\"white-space: nowrap;\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/app_users.png\" style=\"height:24px; width:24px\" /><b><span style=\"font-size:24px\"><fazmacro mkey=\"Total-Number-of-Video-and-Audio-Application-Users\"></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato\"> Users</span></div><div style=\"white-space: nowrap;\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/app_bandwidth_usage.png\" style=\"height:15px; width:24px\" /><b><span style=\"font-size:24px\"><fazmacro mkey=\"Total-Usage-of-Video-and-Audio-Applications\"></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato\"> Total Bytes</span></div><div style=\"white-space: nowrap;\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/app_sessions.png\" style=\"height:24px; width:24px\" /><b><span style=\"font-size:24px\"><fazmacro mkey=\"Total-Sessions-of-Video-and-Audio-Applications\"></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato\"> Sessions</span></div></div><div style=\"height:35px\"></div><table cellpadding=\"0\" cellspacing=\"0\"><tr><td><fazchart width=\"500px\" title=\"Top 10 Video/Audio Apps by Bandwidth\" mkey=\"Top-10-Interested-Apps-by-Bandwidth\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"Video/Audio\"></fazfilter></fazfilters></fazchart></td><td><fazchart width=\"500px\" title=\"Top 10 Video/Audio Apps by Sessions\" mkey=\"Top-10-Interested-Apps-by-Session\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"Video/Audio\"></fazfilter></fazfilters></fazchart></td></tr><tr><td><fazchart width=\"500px\" title=\"Top 10 Video/Audio Apps by Number of Users\" mkey=\"Top-Interested-Apps-by-Number-of-Users\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"Video/Audio\"></fazfilter></fazfilters></fazchart></td><td><fazchart width=\"500px\" title=\"Top 10 Video/Audio Users by Bandwidth\" mkey=\"Top-Interested-App-Users-by-Bandwidth\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"Video/Audio\"></fazfilter></fazfilters></fazchart></td></tr></table><div style=\"height:5px\"><h2><span></span></h2></div><div style=\"height:15px\"></div><div style=\"height:10px\"></div><div style=\"page-break-after: always\"></div><div style=\"height:15px\"></div><table cellpadding=\"0\" cellspacing=\"0\"><tr><td style=\"vertical-align:top\"><fazchart width=\"400px\" title=\"Top 10 Video/Audio Users by Sessions\" mkey=\"Top-10-User-by-Session\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"Video/Audio\"></fazfilter></fazfilters></fazchart></td><td style=\"vertical-align:top\"><fazchart width=\"600px\" title=\"Top 10 Video/Audio Traffic Usage History\" mkey=\"Top-Interested-App-Users-By-Bandwidth-Timeline\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"Video/Audio\"></fazfilter></fazfilters></fazchart></td></tr></table><fazchart width=\"1000px\" title=\"Video and Audio Applications\" mkey=\"Interested-Applications-by-Risk-Level\"><fazfilters><fazfilter field=\"appcat\" oper=\"eq\" value=\"Video/Audio\"></fazfilter></fazfilters></fazchart><p>&nbsp;</p>"
            config header
                edit 1
                    set type graphic
                    set graphic "header_webusage_bg.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90200
                next
                edit 90201
                next
            end
        set report-tag "concise"
        set protected enable
    next

    edit 1000060032
        set is-template enable
        set category "Security"
        set title "Template - Situation Awareness Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Provide awareness of your current security posture, and allow for a better understanding of the 'big picture' which will help anticipate what may happen to networks and systems enabling the security team to provide corrective measures avoiding costly breaches or mishaps."
        set body "<p><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/header_Header-Dark-blue-summary.png\" style=\"height:78px; width:730px\" /></p><h2><span style=\"color:#2f77b6\"><span style=\"font-size:18px\">Report Purpose</span></span></h2><p>The intent of this report is to provide awareness of your current security posture. The report is divided into four key functional areas. Prepare, Protect, Detect and Respond/Recover. Each area will have a breakdown of security categories which will provide more detailed information including an overview, high level risk statement, findings and high level recommendations. The report will allow for a better understanding of the &ldquo;big picture&rdquo; which will help anticipate what may happen to networks and systems enabling the security team to provide corrective measures avoiding costly breaches or mishaps.</p><p>&nbsp;</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><p>&nbsp;</p><p><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/header_Header-Dark-blue-review.png\" style=\"height:78px; width:730px\" /></p><h2><span style=\"color:#2f77b6\"><span style=\"font-size:18px\">Situation Awareness Report Sections</span></span></h2><p>The following is a brief description of each functional area and its importance to a strong security posture.</p><table cellspacing=\"2\" cellpadding=\"5\" border=\"0\" style=\"width:700px\"><tbody><tr><td style=\"background-color:rgb(71, 142, 204); text-align:center; width:240px\"><span style=\"font-size:16px\"><span style=\"color:#FFFFFF\">Prepare</span></span></td><td style=\"text-align:left\"><span style=\"font-size:10px\">If you don&rsquo;t know what is on your network how can you begin to adequately protect it. The prepare functional area is focused on assisting with continuous understanding your cyber environment and critical areas. This includes providing awareness of your cyber assets such as endpoints and servers, applications including SAAS, network topology and user accounts accessing security devices.</span></td></tr><tr><td style=\"background-color:rgb(102, 187, 106); text-align:center\"><span style=\"font-size:16px\"><span style=\"color:#FFFFFF\">Protect</span></span></td><td style=\"text-align:left\"><span style=\"font-size:10px\">Once you have a good understand of your cyber environment you can now start to protect your cyber assets. The Protect functional area is focused on assisting you with the continuous protection of your cyber assets allowing you to limit or reduce the potential impact of a cybersecurity event. This includes providing awareness of your baseline security configuration, change control, vulnerabilities and remediation efforts and remote access to internal cyber assets.</span></td></tr><tr><td style=\"background-color:rgb(247, 143, 30); text-align:center\"><span style=\"font-size:16px\"><span style=\"color:#FFFFFF\">Detect</span></span></td><td style=\"text-align:left\"><span style=\"font-size:10px\">As the attack surface increases so does the volumes of threats making it important to detect events in a timely manner and understand the potential impact. The Detect Functional area is focused on assisting you with continuous monitoring to understand threats detected against your network. This includes providing awareness on your data flows, top attack targets, top malware detected, security events and compliance violations and ensuing log integrity.</span></td></tr><tr><td style=\"background-color:rgb(228, 84, 38); text-align:center\"><span style=\"font-size:16px\"><span style=\"color:#FFFFFF\">Respond &amp; Recover</span></span></td><td style=\"text-align:left\"><span style=\"font-size:10px\">As evasion techniques continue to increase in sophistication it is becoming more important to not only quickly identify threats, but also respond to and recover from them. The Respond/Recover functional area is focused on assisting you with responding to and recovering from an identified breach within your network. This includes providing continuous awareness of unknown threats identified within the network and containment of those threats.</span></td></tr></tbody></table><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><p><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/header_Header-light-blue-prepare.png\" style=\"height:78px; width:730px\" /></p><h1><span style=\"color:#2f77b6\">Prep-1 Network Topology and Device Inventory</span></h1><h2><span style=\"color:#478ecc\">Prep-1.1 Device Inventory</span></h2><p><span style=\"font-size:16px\"><span style=\"color:#478ecc\">Overview</span></span><br />This category provides awareness of all endpoint devices on the network including its profile. The initial endpoint view will provide total number of devices with breakdown of New, Unseen and Seen devices along with a trending chart of new devices discovered by month. For a complete detailed list of endpoint devices please see Appendix.</p><p><span style=\"font-size:16px\"><span style=\"color:rgb(71, 142, 204)\">Risk</span></span><br />No ability to determine physical devices on the network will drastically reduce the ability to comprehensively address vulnerabilities and will increase the potential for system compromise, downtime and data loss/exposure.</p><p><span style=\"font-size:16px\"><span style=\"color:#478ecc\">Recommendations</span></span><br />Review the new devices discovered and verify if they are authorized to be on the network. If they are not authorized take appropriate action to remove and investigate how the device gained access to the network. You list of authorized devices should record IP address, machine name, purpose of the system (profile), asset owner and department as well as if device is portable and or a personally owned device. In addition review the trending graph as it can be used to build a baseline and will help you correlate with current company projects or initiatives to understand the increase or decrease of devices month over month.</p><p><span style=\"font-size:16px\"><span style=\"color:#2f77b6\">Endpoint Devices on Network</span></span></p><fazchart mkey=\"aware-Network-Endpoint-Devices\" title=\"\" width=\"60%\"></fazchart><h3><span style=\"font-size:16px\"><span style=\"color:#2f77b6\">Top 3 New Endpoint Devices</span></span></h3><fazchart mkey=\"aware-New-Endpoint-Devices\" title=\"\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><p><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/header_Header-light-blue-prepare.png\" style=\"height:78px; width:730px\" /></p><h3><span style=\"font-size:16px\"><span style=\"color:#2f77b6\">New Endpoint Devices Trend</span></span></h3><fazchart mkey=\"aware-New-Endpoint-Devices-Trend\" title=\"\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><p><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/header_Header-light-blue-prepare.png\" style=\"height:78px; width:730px\" /></p><h1><span style=\"color:#2f77b6\">Prep-2 Application Inventory</span></h1><h1><span style=\"font-size:16px\"><span style=\"color:rgb(71, 142, 204)\">Overview</span></span></h1><p>This category provides awareness to the operating systems and applications that reside on the endpoint devices with FortiClient installed. The charts below shows the top 5 operating systems and top 5 applications on both Windows and Macintosh systems. For a complete detailed list of applications please see Appendix.</p><p><span style=\"font-size:16px\"><span style=\"color:rgb(71, 142, 204)\">Risk</span></span><br />No ability to determine operating systems and software on the network will drastically reduce the ability to comprehensively address vulnerabilities and will increase the potential for system compromise, downtime and data loss/exposure</p><p><span style=\"color:#478ecc\"><span style=\"font-size:16px\">Recommendations</span></span></p><p>Review the operating systems and applications installed to ensure they are authorized to exist on the endpoint devices. If they are not authorized take appropriate action to remove and investigate how the operating system or application was installed on the network. If you don&rsquo;t have an authorized list of applications use this information to review which applications are needed for business use. This will limit your attack surface and help reduce the overall risk of potential compromise.</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/header_Header-light-blue-prepare.png\" style=\"height:78px; width:730px\" /></h1><h3><span style=\"color:#2f77b6\"><span style=\"font-size:16px\">Top 5 Operating Systems</span></span></h3><fazchart mkey=\"aware-Top-Endpoint-Operating-Systems\" title=\"\" width=\"100%\"></fazchart><table cellspacing=\"1\" cellpadding=\"1\" border=\"0\" style=\"width:730px\"><tbody><tr><td style=\"vertical-align:top; width:50%\"><span style=\"font-size:16px\"><span style=\"color:#2f77b6\">Top 5 Applications - Windows</span></span><fazchart mkey=\"aware-Top-Endpoint-Applications-Windows\" title=\"\" width=\"100%\"></fazchart></td><td style=\"vertical-align:top\"><span style=\"color:#2f77b6\"><span style=\"font-size:16px\">Top 5 Applications - Mac</span></span><fazchart mkey=\"aware-Top-Endpoint-Applications-Mac\" title=\"\" width=\"100%\"></fazchart></td></tr></tbody></table><p>&nbsp;</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><p>&nbsp;</p><p><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/header_Header-light-blue-prepare.png\" style=\"height:78px; width:730px\" /></p><h1><span style=\"color:#2f77b6\">Prep-3 SaaS Services - External Services</span></h1><p><span style=\"color:#478ecc\"><span style=\"font-size:16px\">Overview</span></span><br />This category provides awareness of the external applications being used by employees. The chart below shows the top 10 external services used by company employees. For a complete detailed list of external services please see Appendix.</p><p><span style=\"font-size:16px\"><span style=\"color:rgb(71, 142, 204)\">Risk</span></span><br />Limited understanding of external systems (third parties) could result in unwanted access to confidential data and resources.</p><p><span style=\"color:#478ecc\"><span style=\"font-size:16px\">Recommendations</span></span><br />Review each external service to determine if it&rsquo;s been authorized to use on the network. If they are not authorized take appropriate action remove and investigate how the external services were installed on the network. As a first step you can block the service at the egress point of your network by using an application control policy on the firewall. If you don&rsquo;t have an authorized list of external services use this information to review which external services are needed for business purposes. This list should include the external service name, location, contact, reason for using, type of service and or data being used, any contracts and length of service use.</p><p><span style=\"color:#2f77b6\"><span style=\"font-size:16px\">External SaaS</span></span></p><fazchart mkey=\"aware-Top-SaaS-Application-by-Number-of-Users\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/header_Header-green-protect.png\" style=\"height:78px; width:730px\" /></h2><h1><span style=\"color:#2f77b6\">Pro-1 Change Control - Security Policy Changes</span></h1><p><span style=\"color:#478ecc\"><span style=\"font-size:16px\">Overview</span></span><br />This category provides awareness to all changes made to your security policy across the entire Cooperative Security Fabric. The information will list the overall number of changes, breakdown by change type and changes to policy by security zone. It includes the zone name, date/time of the change, user making the change, user interfaced used, action performed and any comments.</p><p><span style=\"color:#478ecc\"><span style=\"font-size:16px\">Risk</span></span><br />Not implementing change control processes can result in reduced ability to ensure devices have not been modified in an unauthorized manner and could increase potential for system compromise and data exposure</p><p><span style=\"color:#478ecc\"><span style=\"font-size:16px\">Recommendations</span></span><br />Review each change in this report and cross-reference with change request/authorization forms to ensure the change was documented and approved by management. If you do not have a change control process it&rsquo;s recommend that you create one. It can be a simple document outlining the change steps. At a minimum it should document how to request a change, how to record the change, how will the change effect the organization, how will the change be evaluated for approval and how will the change be implemented if approved including test planning and back out procedures.</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/header_Header-green-protect.png\" style=\"height:78px; width:730px\" /></h2><h3><span style=\"color:#2f77b6\"><span style=\"font-size:16px\">Summary of Changes</span></span></h3><fazchart mkey=\"aware-Summary-Of-Changes\" title=\"\" width=\"100%\"></fazchart><h3><span style=\"color:#2f77b6\"><span style=\"font-size:16px\">Change Details</span></span></h3><fazchart mkey=\"aware-Change-Details\" title=\"\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/header_Header-green-protect.png\" style=\"height:78px; width:730px\" /></h2><h1><span style=\"color:#2f77b6\">Pro-2 Vulnerabilities &amp; Remediation</span></h1><p><span style=\"color:#478ecc\"><span style=\"font-size:16px\">Overview</span></span></p><p>This category provides awareness of all endpoint device vulnerabilities discovered by FortiClient within the network along with remediation steps. The information shows the vulnerabilities by severity, by security zone and provides visibility into the vulnerability trends month over month. Also included is a list of top 10 critical vulnerabilities for this week as well as existing vulnerabilities from last week and devices not scanned by FortiClient. For a complete detailed list of vulnerabilities and remediation steps please see Appendix.</p><p><span style=\"color:#478ecc\"><span style=\"font-size:16px\">Risk</span></span><br />Without a vulnerability &amp; patch management plan in place there is potential for increased risk of unmitigated exposures and increase damages to systems and sensitive data loss when a breach occurs which could also lead to legal obligations not being met.</p><p><span style=\"color:#478ecc\"><span style=\"font-size:16px\">Recommendations</span></span><br />Review and analyze the vulnerabilities and remediation steps discovered and take the appropriate action. To determine the appropriate action take into consideration the criticality of the device affected, the business impact, the probability of exploit and any mitigating controls to reduce the risk. Patches should be tested and evaluated before they are installed on a production system. Use the trending chart and list of vulnerabilities from prior week to determine remediation timeframes. Also review the devices not scanned and determine the feasibility of installing FortiClient to provide better visibility into your endpoint vulnerabilities.</p><h3><span style=\"color:#2f77b6\"><span style=\"font-size:16px\">Vulnerabilities by Severity</span></span></h3><fazchart mkey=\"aware-Vulnerabilities-By-Severity\" title=\"\" width=\"60%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><p><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/header_Header-green-protect.png\" style=\"height:78px; width:730px\" /></p><h3><span style=\"font-size:16px\"><span style=\"color:#2f77b6\">Vulnerabilities Trend</span></span></h3><fazchart mkey=\"aware-Vulnerabilities-Trend\" title=\"\" width=\"100%\"></fazchart><h3><span style=\"color:#2f77b6\"><span style=\"font-size:16px\">Top 10 Critical Vulnerabilities</span></span>&nbsp;</h3><fazchart mkey=\"aware-Top-Critical-Vulnerabilities\" title=\"\" width=\"100%\"></fazchart><h3><span style=\"color:#2f77b6\"><span style=\"font-size:16px\">Top 10 Vulnerabilities in Last Period</span></span></h3><fazchart mkey=\"aware-Top-Vulnerabilities-Last-Period\" title=\"\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><p><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/header_Header-green-protect.png\" style=\"height:78px; width:730px\" /></p><h3><span style=\"color:#2f77b6\"><span style=\"font-size:16px\">Top 10 New Vulnerabilities</span></span></h3><fazchart mkey=\"aware-Top-New-Vulnerabilities\" title=\"\" width=\"100%\"></fazchart><h3><span style=\"color:#2f77b6\"><span style=\"font-size:16px\">Top 10 Users with Critical Vulnerabilities</span></span></h3><fazchart mkey=\"aware-Top-User-With-Critical-Vulnerabilities\" title=\"\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><p><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/header_Header-orange-detect.png\" style=\"height:78px; width:730px\" /></p><h1><span style=\"color:#2f77b6\">Det-1 Data Flow - Security Zones</span></h1><p><span style=\"color:#478ecc\"><span style=\"font-size:16px\">Overview</span></span><br />This category provides awareness of the various data flows from security zone to security zone. The information shows the top 10 application flows from zone to zone as well as the top applications entering and leaving each security zones.</p><p><span style=\"color:#478ecc\"><span style=\"font-size:16px\">Risk</span></span><br />Not having a good understanding of data flows within your network will increase the chances of unanticipated software failures which could lead to application compromise and data exposure.</p><p><span style=\"color:#478ecc\"><span style=\"font-size:16px\">Recommendations</span></span><br />Review the current application flows from zone to zone and validate flows are meeting security policies. If unexpected flows are identified, investigate the business case for the application flow and determine appropriate action. If the application flow is determined to be not authorized, you can use the application filtering at the edge of each zone block the flow.</p><h3><span style=\"color:#2f77b6\"><span style=\"font-size:16px\">Top 10 Ingress Data Flow by Zone</span></span></h3><fazchart mkey=\"aware-Ingress-Data-Flow-By-Zone\" title=\"\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><p><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/header_Header-orange-detect.png\" style=\"height:78px; width:730px\" /></p><h3><span style=\"color:#2f77b6\"><span style=\"font-size:16px\">Top 10 Egress Data Flow by Zone</span></span>&nbsp;</h3><fazchart mkey=\"aware-Egress-Data-Flow-By-Zone\" title=\"\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><p><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/header_Header-orange-detect.png\" style=\"height:78px; width:730px\" /></p><h1><span style=\"color:#2f77b6\">Det-2 Top Attack Targets</span></h1><p><span style=\"color:#478ecc\"><span style=\"font-size:16px\">Overview</span></span><br />This category will provide awareness to the top targets attacked within the network. The information shows the top devices attacked as well as the top applications attacked. The attack information includes the device target, Ip address, OS, Intrusion attempts, severity and CVE number associated with the exploit used for the attack.</p><p><span style=\"color:#478ecc\"><span style=\"font-size:16px\">Risk</span></span><br />Limited or no detection processes and capabilities will drastically reduce the ability to proactively identify, analyze, categorize and remediate attacks leading to undetected system compromise, data exposure or business disruption</p><p><span style=\"color:#478ecc\"><span style=\"font-size:16px\">Recommendations</span></span><br />Review top attacks and their targets to determine patterns or trends over time. If certain targets usually make the top attack list provide more focused monitoring to those devices. Also use the information found in earlier sections of this report to determine the criticality of the device and what access the attacker may have if those top targets happen to be compromised. Where could they jump to next? Also review the top applications attacked and make sure the devices running those applications have protections particularly endpoint protection such as FortiClient.</p><h3><span style=\"color:#2f77b6\"><span style=\"font-size:16px\">Top Attack Targets</span></span>&nbsp;</h3><fazchart mkey=\"aware-Top-Attack-Targets\" title=\"\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/header_Header-orange-detect.png\" style=\"height:78px; width:730px\" /></h2><h1><span style=\"color:#2f77b6\">Det-3 Aggregate Threat View</span></h1><p><span style=\"color:#478ecc\"><span style=\"font-size:16px\">Overview</span></span><br />This category provides awareness of the top threats seen across the network including Malware, Intrusion attempts (Exploits) and Botnets. The information shows the total number of threats and break down by type and by day.</p><p><span style=\"color:#478ecc\"><span style=\"font-size:16px\">Risk</span></span><br />Limited or no detection processes and capabilities will drastically reduce the ability to proactively identify, analyze, categorize and remediate attacks leading to undetected system compromise, data exposure or business disruption</p><p><span style=\"color:#478ecc\"><span style=\"font-size:16px\">Recommendations</span></span><br />Review the threats especially the critical and high to get an idea of the volumes of threats thwarted daily. The threats by day should also be reviewed. Over time this information should enable you to build a baseline to try and identify any patterns or trends. As an example if you see more threats on Thursday you may want to elevate your monitoring focus for that day.</p><h3><span style=\"color:#2f77b6\"><span style=\"font-size:16px\">Threats by Severity</span></span></h3><fazchart mkey=\"aware-Threats-By-Severity\" title=\"\" width=\"60%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/header_Header-orange-detect.png\" style=\"height:78px; width:730px\" /></h2><h3><span style=\"color:#2f77b6\"><span style=\"font-size:16px\">Threats Type by Severity</span></span>&nbsp;</h3><fazchart mkey=\"aware-Threats-Type-By-Severity\" title=\"\" width=\"100%\"></fazchart><h3><span style=\"color:#2f77b6\"><span style=\"font-size:16px\">Threats by Day&nbsp;</span></span></h3><fazchart mkey=\"aware-Threats-By-Day-Radar\" title=\"\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/header_Header-orange-detect.png\" style=\"height:78px; width:730px\" /></h2><h1><span style=\"color:#2f77b6\">Det-4 Top Malware Detection</span></h1><p><span style=\"color:#478ecc\"><span style=\"font-size:16px\">Overview</span></span><br />This category provided awareness to the top malware events seen across the network. This information shows top 10 malware events and top applications malware is targeting. The information is further broken down to show malware name, type, criticality, how it was delivered, number of victims, sources and count.</p><p><span style=\"color:#478ecc\"><span style=\"font-size:16px\">Risk</span></span><br />Limited or no detection processes and capabilities will drastically reduce the ability to proactively identify, analyze, categorize and remediate attacks leading to undetected system compromise, data exposure or business disruption.</p><p><span style=\"color:#478ecc\"><span style=\"font-size:16px\">Recommendations</span></span><br />Review the top malware events detected and top applications being targeted. Over time this information should enable you to build a baseline to try and identify any patterns or trends. To find out more information about the malware event such as its more analysis and recommendations you can use the FortiGuard Encyclopedia found on FortiGuard.com website. In addition use the top applications targeted information and cross-reference with the amount of installs on the network to get an idea of the total attack surface and potential impact.</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/header_Header-orange-detect.png\" style=\"height:78px; width:730px\" /></h2><h3><span style=\"color:#2f77b6\"><span style=\"font-size:16px\">Count of Malware Events</span></span></h3><fazchart mkey=\"aware-Count-Of-Malware-Events\" title=\"\" width=\"100%\"></fazchart><h3><span style=\"color:#2f77b6\"><span style=\"font-size:16px\">Top 10 Malware by Count</span></span></h3><fazchart mkey=\"aware-Top-Malware-By-Count\" title=\"\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/header_Header-orange-detect.png\" style=\"height:78px; width:730px\" /></h2><h3><span style=\"color:#2f77b6\"><span style=\"font-size:16px\">Top 10 Source Affected by Botnet</span></span></h3><fazchart mkey=\"aware-Botnet-IP\" title=\"\" width=\"100%\"></fazchart><h3><span style=\"color:#2f77b6\"><span style=\"font-size:16px\">Top 10 Botnet by Domain</span></span></h3><fazchart mkey=\"aware-Botnet-Domain\" title=\"\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/header_Header-orange-detect.png\" style=\"height:78px; width:730px\" /></h2><h3><span style=\"color:#2f77b6\"><span style=\"font-size:16px\">Top 20 Categories of High Risk URL</span></span></h3><fazchart mkey=\"aware-High-Risk-URL-Category\" title=\"\" width=\"100%\"></fazchart><h3><span style=\"color:#2f77b6\"><span style=\"font-size:16px\">Top 30 Malicious Virus Files</span></span></h3><fazchart mkey=\"aware-Malicious-Files\" title=\"\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/header_Header-orange-detect.png\" style=\"height:78px; width:730px\" /></h2><h1><span style=\"color:#2f77b6\">Det-5 Security Event Details</span></h1><p><span style=\"font-size:16px\"><span style=\"color:rgb(71, 142, 204)\">Overview</span></span><br />This category provided awareness of the security events seen across the network including compliance violations. This information will show top 5 failed login attempts and authentication attempts, denied connections and compliance checks.</p><p><span style=\"font-size:16px\"><span style=\"color:rgb(71, 142, 204)\">Risk</span></span><br />Limited or no detection processes and capabilities will drastically reduce the ability to proactively identify, analyze, categorize and remediate attacks leading to undetected system compromise, data exposure and or legal obligations not being met which could result in penalties and fines.</p><p><span style=\"font-size:16px\"><span style=\"color:rgb(71, 142, 204)\">Recommendations</span></span><br />Review all top events from each category and determine the root cause. Many times these events could shed light on miss-configurations within the network that when addressed can help streamline your network and can reduce the white noise making it easier to identify real security events. These events could also be an indication that an attacker is trying a brute force attack on devices within your network. Failed compliance checks should be addressed immediately as they could you environment is out of compliance.</p><h2><span style=\"color:rgb(47, 119, 182)\">Security Devices</span></h2><h3><span style=\"color:#2f77b6\"><span style=\"font-size:16px\">Top 5 Failed Login Attempts</span></span></h3><fazchart mkey=\"aware-Top-Failed-Login-Attempts\" title=\"\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h3><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/header_Header-orange-detect.png\" style=\"height:78px; width:730px\" /></h3><h3><span style=\"color:#2f77b6\"><span style=\"font-size:16px\">Top 5 Failed Authentication Attempts</span></span>&nbsp;</h3><fazchart mkey=\"aware-Top-Failed-Authentication-Attempts\" title=\"\" width=\"100%\"></fazchart><h3><span style=\"color:#2f77b6\"><span style=\"font-size:16px\">Top 5 Denied Connections</span></span></h3><fazchart mkey=\"aware-Top-Denied-Connections\" title=\"\" width=\"100%\"></fazchart><h2><span style=\"color:#2f77b6\">Compliance Checks</span></h2><h3><span style=\"color:#2f77b6\"><span style=\"font-size:16px\">Failed Compliance Checks by Device</span></span></h3><fazchart mkey=\"aware-Failed-Compliance-Checked-By-Device\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><p>&nbsp;</p><h2><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/header_Header-red-respond.png\" style=\"height:78px; width:730px\" /></h2><h1><span style=\"color:#2f77b6\">Res-1 Breach Detection</span></h1><p><span style=\"color:#478ecc\"><span style=\"font-size:16px\">Overview</span></span><br />This category will provide awareness for all breaches detected within the network. The information is broken down by security zones and by day of the week and will contain the victim, the type of threat, security zone, severity and number of events detected.</p><p><span style=\"color:#478ecc\"><span style=\"font-size:16px\">Risk</span></span><br />Not having good response capabilities can result in drastically reduced ability to perform adequate incident triage and mitigation which could in turn increase the impact damage of a breach to critical systems and sensitive data. It could also lead to inability to meet legal and compliance liabilities which could result in fines and reputation loss.</p><p><span style=\"color:#478ecc\"><span style=\"font-size:16px\">Recommendations</span></span><br />Review the breach information particularity the sensitive security zoned and determine the root cause. Over time this information should enable you to build a baseline to try to identify any patterns, trends and anomalies. For example you may be able to identify frequent breach endpoint victims which may be an indication that additional user awareness training is needed.</p><h3><span style=\"color:#2f77b6\"><span style=\"font-size:16px\">Breaches by Source</span></span></h3><fazchart mkey=\"aware-Ioc-Blacklist-Summary\" title=\"\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><p><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/header_Header-red-respond.png\" style=\"height:78px; width:730px\" /></p><h3><span style=\"color:#2f77b6\"><span style=\"font-size:16px\">Potential Breach by Day</span></span></h3><fazchart mkey=\"aware-Ioc-Potential-Breach-By-Day\" title=\"\" width=\"100%\"></fazchart><h3><span style=\"color:#2f77b6\"><span style=\"font-size:16px\">Top 10 Potential Breach</span></span>&nbsp;</h3><fazchart mkey=\"aware-Ioc-Suspicion-Summary\" title=\"\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90100
                next
                edit 90101
                next
                edit 90203
                next
            end
        set protected enable
    next

    edit 1000060034
        set is-template enable
        set category "System"
        set title "Template - 360 Protection Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Present a brief summary of hardware/software inventory of the FortiGate devices over a 30 day period."
        set body "<p>This document summarizes the findings of the FortiGate devices over a 30 day period, together with recommendations and observations for follow up action where applicable.</p><p>&nbsp;</p><h1><span style=\"color:#2f77b6\">1 ANALYSIS SCOPE</span></h1><h2>1.1 Serviced Devices Inventory</h2><p>The devices under monitoring and support are as follows:</p><fazchart mkey=\"fgt-device-monitoring-inventory\" title=\"FortiCare 360 Cloud Analytics Monitoring Inventory\" width=\"100%\"></fazchart><p><strong>Recommendations</strong><br />It is recommended to refer to the lifecycle status of each model which can be consulted at the Product Life Cycle link under the hardware tab: <a href=\"https://support.fortinet.com/Information/ProductLifeCycle.aspx\">https://support.fortinet.com/Information/ProductLifeCycle.aspx</a>.<br /><br />If the End of Life of a device has been announced, it is recommended to review upgrade or replacement options.<br />*The standard hardware upgrade path is shown, however to plan the most appropriate hardware upgrade it is recommended to consult your sales representative.</p><p>&nbsp;</p><h2>1.2 Serviced Devices Hardware Details</h2><p>The hardware versions of the devices under management are as follows: <br /></p><fazchart mkey=\"fgt-inventory-hardware\" title=\"Fortinet Hardware Inventory\" width=\"100%\"></fazchart><p>&nbsp;</p><h2>1.3 Serviced Devices Software Summary</h2><p>The software versions of the devices under monitoring are as follows:<br /></p><fazchart mkey=\"fgt-inventory-software\" title=\"Fortinet Software Inventory\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1><span style=\"color:#2f77b6\">2 DEVICE UTILIZATION</span></h1><h2>2.1 CPU Utilization</h2><p>The graph and table below illustrate the average and maximum CPU utilization trend.</p><fazchart mkey=\"status-timeline-by-device-cpu-utilization\" title=\"Top 10 CPU Utilization By Device [Average]\" width=\"100%\"></fazchart><fazchart mkey=\"event-cpu-utilization-dev\" title=\"\" width=\"100%\"></fazchart><p><strong>Recommendations</strong><br />CPU Utilization is expected to follow a trend aligned to business schedules. Multiple high usage peaks that breach thresholds should be investigated for possible causes such as certain traffic peaks or specific traffic types, or even DDOS attacks; also by investigating CPU utilization per process with monitoring tools.</p><p>&nbsp;</p><h2>2.2 Memory Utilization</h2><p>The graph and table below illustrate the average and maximum memory utilization trend.</p><fazchart mkey=\"status-timeline-by-device-mem-utilization\" title=\"Top 10 Memory Utilization By Device [Average]\" width=\"100%\"></fazchart><fazchart mkey=\"event-mem-utilization-dev\" title=\"\" width=\"100%\"></fazchart><p><strong>Recommendations</strong><br />Memory utilization is expected to follow a trend aligned to business schedules. Multiple high usage peaks that breach thresholds should be investigated by reviewing memory utilization per process.All FortiGate devices need to normally operate below 80% memory utilization, as the FortiGate begins selfpreservation actions as the memory utilization increases beyond 80%.</p><p>&nbsp;</p><h2>2.3 Disk Utilization</h2><p>The graph and table below shows the current disk utilization and free disk values of the devices.</p><fazchart mkey=\"status-timeline-by-device-disk-utilization\" title=\"Top 10 Disk Utilization By Device [Average]\" width=\"100%\"></fazchart><fazchart mkey=\"event-disk-utilization-dev\" title=\"\" width=\"100%\"></fazchart><p><strong>Recommendations</strong><br />High disk utilization, or reduced free disk trends may be a result of device logging and log data storage; it is recommended to review logging configuration and retention policy. If you notice an abrupt change in the disk utilization, please consider correlated configuration changes.</p><p>&nbsp;</p><h2>2.4 Firewall Session Counts</h2><p>The table below illustrates lowest, average and maximum firewall session counts for each firewall device measured.</p><fazchart mkey=\"event-total-session-summary\" title=\"Top 10 Max Firewall Concurrent Session Count\" width=\"100%\"></fazchart><fazchart mkey=\"event-session-rate-summary\" title=\"Top 10 Max Firewall Session Rate Count\" width=\"100%\"></fazchart><fazchart mkey=\"event-session-summary-dev\" title=\"\" width=\"100%\"></fazchart><p><strong>Recommendations</strong><br />The measured session data for each device should be compared against the devices specified performance data. If the measured session data is tending towards these performance limits, then the solution capacity should be reviewed together with your technical and sales representatives. Performance data is available on device datasheets.</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1><span style=\"color:#2f77b6\">3 INTERFACE PERFORMANCE</span></h1><p>The data in this section represents the devices network interface behavior.</p><p>&nbsp;</p><h2>3.1 Interface Down Events</h2><p>The graphs and table below illustrate the interface down alert events trends over the last 30 days.</p><fazchart mkey=\"fgt-intf-down-timeline-by-device\" title=\"Top 10 Network Interface Availability Faults By Device\" width=\"100%\"></fazchart><fazchart mkey=\"fgt-intf-down-dev-donut\" title=\"Top 10 Percentage Distribution Across Devices\" width=\"100%\"></fazchart><fazchart mkey=\"fgt-intf-down-dev-tbl\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><h2>3.2 Interface Utilization</h2><p>The table below illustrates the interfaces average utilization and average bit rate values for both send and receive traffic.</p><fazchart mkey=\"fgt-intf-stats-timeline-bit-rate-out\" title=\"Top 10 Interface Sent Bit Rate (kbps) [Average]\" width=\"100%\"></fazchart><fazchart mkey=\"fgt-intf-stats-timeline-util-out\" title=\"Top 10 Sent Interface Utilization [Average]\" width=\"100%\"></fazchart><fazchart mkey=\"fgt-intf-stats-timeline-bit-rate-in\" title=\"Top 10 Interface Received Bit Rate (kbps) [Average]\" width=\"100%\"></fazchart><fazchart mkey=\"fgt-intf-stats-timeline-util-in\" title=\"Top 10 Received Interface Utilization [Average]\" width=\"100%\"></fazchart><fazchart mkey=\"fgt-intf-stats-summary-view\" title=\"\" width=\"100%\"></fazchart><p><strong>Recommendations</strong><br />This interface reporting represents the device network activity, interface down or high interface utilization may indicate network related events, or that increased throughput is required. Investigate any recurring events or trend information taking into consideration the network environment. It is recommended to consider capacity planning and performance management that includes current services and what is planned in the future.</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1><span style=\"color:#2f77b6\">4 OPERATIONAL FAULTS</span></h1><p>This report section includes the observed operational faults during the reporting period.</p><p>&nbsp;</p><h2>4.1 High Availability Performance</h2><p>The graph below illustrates the High Availability Clustering failure, state change, or recovery.</p><fazchart mkey=\"fgt-ha-failure-timeline\" title=\"High Availability Clustering Failure\" width=\"100%\"></fazchart><fazchart mkey=\"fgt-ha-failure-summary\" title=\"\" width=\"100%\"></fazchart><p><strong>Recommendations</strong><br />If HA failover events are observed, especially if they occur regularly or on multiple devices it is recommended to investigate further by correlating network incidents and networks device failures that would cause a network failover.</p><p>&nbsp;</p><h2>Other Environmental Faults</h2><p>If device environmental related events were reported over the last 30 day period they are outlined in the sections below. The devices are expected to operate in stable environmental conditions; any unexpected reported events should be investigated. These may include warnings related to temperature, PSU failure, voltage variations etc.</p><fazchart mkey=\"fgt-env-faults-power\" title=\"Power Supply Faults Observed During The Reporting Period\" width=\"100%\"></fazchart><fazchart mkey=\"fgt-env-faults-fan\" title=\"Cooling Fan Faults Observed During The Reporting Period\" width=\"100%\"></fazchart><fazchart mkey=\"fgt-env-faults-temperature\" title=\"High Temperature Observed During The Reporting Period\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90100
                next
                edit 90101
                next
                edit 90203
                next
            end
        set protected enable
    next
    edit 1000060035
        set is-template enable
        set category "Application"
        set title "Template - Cyber-Bullying Indicators Report"
        set description "Cyber-Bullying Indicators Report."
        set body "<div style=\"height:5px;\"></div><h2 style=\"font-family: Lato; font-size: 17px; color: black;\"> OVERVIEW OF CYBER-BULLYING INDICATORS AND BAD TERMS OF PHRASES USED WITHIN THE ENVIRONMENT</h2><div style=\"height:5px;\"></div><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\" style=\"font-family: Lato; width:100%\"><tbody><tr><td style=\"vertical-align:top; width: 500px;\"><fazchart mkey=\"Behaviour-Banned-Application\" title=\"Offensive or Threatening Phrases Distribution By Platforms\" width=\"480px\"></fazchart></td><td style=\"vertical-align:top; width: 500px;\"><fazchart mkey=\"Behaviour-Banned-User\" title=\"Offensive or Threatening Phrases Distribution By Users\" width=\"480px\"></fazchart></td></tr></tbody></table><div style=\"height:5px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"Behaviour-Banned-User-Drilldown\" title=\"Top 10 Users by Offensive or Threatening Phrases\" width=\"1000px\"></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height:15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"behaviour-banned\" title=\"Top 50 Offensive or Threatening Phrases for Last Period\" width=\"1000px\"></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height:10px;\"></div><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"font-family: Lato; width: 100%;\"><tbody><tr><td style=\"vertical-align:middle; text-align: left; width:35px\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/Google_logo.png\" style=\"height:25px;\"/></td><td style=\"vertical-align:middle; text-align: left; width:35px\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/Bing_logo.png\" style=\"height:25px;\"/></td><td style=\"vertical-align: middle; text-align: left; width:830px\"><h2 style=\"font-family: Lato; font-size: 17px; color: black;\"> SEARCH TERMS WHICH MAY INDICATE CYBER-BULLYING</h2></td></tr></tbody></table><div style=\"height:5px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"Behaviour-Banned-User-Drilldown-per-App\" title=\"Top 10 Users with Bad Terms or Phrases in Searches\" width=\"1000px\"><fazfilters><fazfilter field=\"app\" oper=\"eq\" value=\"Google.Search_Search.Phrase, Bing.Search_Search.Phrase\"></fazfilter></fazfilters></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height:15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"behaviour-banned\" title=\"Top 50 Bad Terms used in Searches\" width=\"1000px\"><fazfilters><fazfilter field=\"app\" oper=\"eq\" value=\"Google.Search_Search.Phrase, Bing.Search_Search.Phrase\"></fazfilter></fazfilters></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height:10px;\"></div><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"font-family: Lato; width: 100%;\"><tbody><tr><td style=\"vertical-align:middle; text-align: left; width: 35px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/facebooklogo.png\" style=\"height:25px;\"/></td><td style=\"vertical-align: middle; text-align: left; width: 850px;\"><h2 style=\"font-family: Lato; font-size: 17px; color: black;\"> FACEBOOK USAGE WHICH MAY INDICATE CYBER-BULLYING</h2></td></tr></tbody></table><div style=\"height:5px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"Behaviour-Banned-User-Drilldown-per-App\" title=\"Top 10 Users with Bad Terms or Phrases in Facebook\" width=\"1000px\"><fazfilters><fazfilter field=\"app\" oper=\"eq\" value=\"Facebook_Post,  Facebook_Chat\"></fazfilter></fazfilters></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height:15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"behaviour-banned\" title=\"Top 50 Bad Terms used in Facebook\" width=\"1000px\"><fazfilters><fazfilter field=\"app\" oper=\"eq\" value=\"Facebook_Post, Facebook_Chat\"></fazfilter></fazfilters></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height:10px;\"></div><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"font-family: Lato; width: 100%;\"><tbody><tr><td style=\"vertical-align:middle; text-align: left; width: 35px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/twitterlogo.png\" style=\"height:25px;\"/></td><td style=\"vertical-align: middle; text-align: left; width: 850px;\"><h2 style=\"font-family: Lato; font-size: 17px; color: black;\"> TWITTER USAGE WHICH MAY INDICATE CYBER-BULLYING</h2></td></tr></tbody></table><div style=\"height:5px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"Behaviour-Banned-User-Drilldown-per-App\" title=\"Top 10 Users with Bad Terms or Phrases in Tweets\" width=\"1000px\"><fazfilters><fazfilter field=\"app\" oper=\"eq\" value=\"Twitter_Post\"></fazfilter></fazfilters></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height:15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"behaviour-banned\" title=\"Top 50 Bad Terms used in Tweets\" width=\"1000px\"><fazfilters><fazfilter field=\"app\" oper=\"eq\" value=\"Twitter_Post\"></fazfilter></fazfilters></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height:10px;\"></div><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"font-family: Lato; width: 100%;\"><tbody><tr><td style=\"vertical-align:middle; text-align: left; width: 40px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/gmail.png\" style=\"height:25px;\"/></td><td style=\"vertical-align: middle; text-align: left; width: 850px;\"><h2 style=\"font-family: Lato; font-size: 17px; color: black;\"> GMAIL AND GOOGLE CHAT USAGE WHICH MAY INDICATE CYBER-BULLYING</h2></td></tr></tbody></table><div style=\"height:5px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"Behaviour-Banned-User-Drilldown-per-App\" title=\"Top 10 Users with Bad Terms used in Gmail Subjects and Google Chat\" width=\"1000px\"><fazfilters><fazfilter field=\"app\" oper=\"eq\" value=\"Gmail_Chat, Gmail_Send.Message\"></fazfilter></fazfilters></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height:15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"behaviour-banned\" title=\"Top 50 Bad Terms used in Gmail Subjects and Google Chat Messages\" width=\"1000px\"><fazfilters><fazfilter field=\"app\" oper=\"eq\" value=\"Gmail_Chat, Gmail_Send.Message\"></fazfilter></fazfilters></fazchart></div>"
            config header
                edit 1
                    set type graphic
                    set graphic "header_webusage_bg.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
            end
        set report-tag "concise"
        set protected enable
    next
    edit 1000060036
        set is-template enable
        set category "Application"
        set hide-rowid 1
        set title "Template - Social Media Usage Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Social Media Usage Report."
        set body "<p>&nbsp;</p><p><span><span style=\"font-size:18px\">Overall Social Network Usage</span></span></p><p>&nbsp;</p><table cellspacing=\"1\" cellpadding=\"1\" border=\"0\" align=\"center\" style=\"height:147px; width:440px\"><tbody><tr><td><fazchart mkey=\"ctap-Top-SocialMedia-App-By-Bandwidth\" title=\"Social Media by Bandwidth\" width=\"100%\"></fazchart><p>&nbsp;</p></td><td><fazchart mkey=\"Browsing-Time-per-Social-Media\" title=\"Social Media by Time Spent\" width=\"100%\"></fazchart><p>&nbsp;</p></td></tr></tbody></table><fazchart mkey=\"Social-Networking-Bar-Graph\" title=\"Top 5 Users by Bandwidth\" width=\"100%\"></fazchart><p>&nbsp;</p><fazchart mkey=\"Top-Social-Networking-Durations-Sources-Drilldown\" title=\"Top 10 Users with the most Time Spent on Social Media\" width=\"100%\"></fazchart><fazchart mkey=\"Top-Social-Networking-Durations-Domains-Drilldown\" title=\"Top Social Networking Platforms by Duration\" width=\"100%\"></fazchart><p>&nbsp;</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1><span style=\"font-family:open sans\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/facebooklogo.png\" style=\"height:120px; width:120px\" /></span></h1><p><span><span style=\"font-size:18px\">Facebook Usage in the Network</span></span></p><fazchart mkey=\"Facebook-Posts\" title=\"Last 50 Facebook Posts\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><p>&nbsp;</p><fazchart mkey=\"Facebook-Chats\" title=\"Top 50 Facebook Chat Messages\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><p><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/twitterlogo.png\" style=\"height:120px; width:120px\" /></p><p><span><span style=\"font-size:18px\">Twitter Usage in the Network</span></span></p><fazchart mkey=\"Twitter-Posts\" title=\"Last 50 Twitter Posts\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><p><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/linkedinlogo.png\" style=\"height:120px; width:120px\" /></p><p><span><span style=\"font-size:18px\">LinkedIn Usage in the Network</span></span></p><fazchart mkey=\"LinkedIn-Posts-and-Comments\" title=\"Top 50 LinkedIn Posts and Comments\" width=\"100%\"></fazchart><p>&nbsp;</p>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
            end
        set protected enable
    next
    edit 1000060037
        set is-template enable
        set category "System"
        set title "Template - Secure SD-WAN Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver2.png"
        set description "Secure SD-WAN Report."
        set body "<h1>Introduction Secure SD-WAN</h1><p>As the use of business-critical, cloud-based applications and tools continue to increase, distributed organizations with multiple remote offices are switching from performance inhibited WANs to SD-WAN architectures. SD-WAN offers business application steering, cost savings, and performance for Software-as-a-Service (SaaS) applications, as well as unified communication services. However, SD-WAN has its own shortcomings&mdash;especially when it comes to security with direct internet access.</p><p>While the highlights are listed below, a more detailed information of each device follows.</p><p>&nbsp;</p><table border=\"0\" cellspacing=\"2\" cellpadding=\"1\" align=\"center\" style=\"width:800px\"><tbody><tr><td style=\"width:100px\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/icons_availability.png\" style=\"height:120px; width:120px\" /></td><td style=\"width:200px\"><p><span style=\"font-size:26px\"><strong><fazmacro mkey=\"sdwan-device-availability-percentage\"></fazmacro></strong></span></p><p><strong><span style=\"font-size:14px\">SD-WAN Availability</span></strong></p></td><td style=\"width:100px\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/icons_bandwidth.png\" style=\"height:120px; width:120px\" /></td><td style=\"width:200px\"><p><span style=\"font-size:26px\"><strong><fazmacro mkey=\"sdwan-total-bandwidth\"></fazmacro></strong></span></p><p><strong><span style=\"font-size:14px\">SD-WAN Bandwidth</span></strong></p></td></tr></tbody></table><p>&nbsp;</p><p>Application usage should have a strong influence on your network architecture. Understanding which types of applications are used and specifically business application performance can improve user experience and productivity. Following chart illustrates a breakout of applications specific to your network as ranked by traffic volume. These applications can be prioritized by leveraging SD-WAN application steering strategies and Service Level Agreements (SLAs) in order to engineer their optimal path to the Internet.</p><p>&nbsp;</p><fazchart mkey=\"sdwan-Top-App-By-Bandwidth-Sankey\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>SD-WAN Performance</h1><p>Multi-path technology can automatically fail over to the best available link when the primary WAN path degrades. This automation is built into the FortiGate, which reduces complexity for end-users while improving their experience and productivity.</p><fazchart mkey=\"sdwan-Device-Availability-status\" title=\"\" width=\"100%\"></fazchart><h2>SD-WAN Link Health Status</h2><p><strong>Link Uptime</strong></p><fazchart mkey=\"sdwan-Device-Intf-List-by-Availability\" title=\"\" width=\"100%\"></fazchart><h2>SD-WAN Link Quality</h2><p><strong>Link Quality Status Summary</strong></p><p>Link quality plays an important role in link selection for SD-WAN, the link quality status of SD-WAN members should be monitored and any prolonged issues with packet loss, latency, and jitter have to be investigated to ensure that your network doesn&#39;t experience degraded performance or an outage. SD WAN uses pre-defined SLA strategies to route traffic through the SD-WAN interfaces that meet the latency, jitter, and packet loss criteria configured in the SLA targets associated with the SD-WAN rules. SD-WAN constantly monitors network traffic metrics, such as latency, packet loss and jitter. Based on the measured data, the SD-WAN is able to respond proactively to real-time network conditions, selecting the optimal path for traffic.</p><fazchart mkey=\"sdwan-Device-Interface-Summary-by-Bibandwidth\" title=\"\" width=\"100%\"></fazchart><h2>&nbsp;</h2><fazchart mkey=\"sdwan-fw-Device-Interface-Quality_Bibandwidth-drilldown\" title=\"{default}\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2>Service Level Agreements&nbsp;(SLAs)</h2><p><strong>Performance SLA by WAN Link</strong></p><p>Performance link monitoring measures the health of links that are connected to SD-WAN member interfaces by sending probing signals through each link to a server and measuring the link quality based on latency, jitter, and packet loss. If a link is broken, the routes on that link are removed, and traffic is routed through other links. When the link is working again, the routes are re-enabled. This prevents traffic being sent to a broken link and lost.</p><fazchart mkey=\"sdwan-Device-SLA-Interface-bandwidth-Drilldown\" title=\"{default}\" width=\"100%\"></fazchart><h1>SD-WAN Utilization</h1><p>FortiGate can be set to recognize applications by business criticality. Business-critical applications, general productivity applications, and social media can be given different routing priorities. Unique policies can be applied at a deeper level for sub-applications. This broad application-level visibility into traffic patterns and utilization offers a better position to allocate WAN resources according to business needs. Fortinet Secure SD-WAN identifies and classifies applications&mdash;even encrypted cloud application traffic&mdash;from the very first packet. In addition to individual applications, understanding overall utilization can help with capacity planning, circuit selection, and streamlining network traffic over time. This awareness can also help reduce operational costs associated with backhauling traffic over more expensive WAN links (such as MPLS).</p><fazchart mkey=\"sdwan-Device-Interface-bandwidth-Drilldown\" title=\"{default}\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2>SD-WAN Applications</h2><fazchart mkey=\"sdwan-Top-App-By-Bandwidth\" title=\"Traffic Distribution Over Application\" width=\"100%\"></fazchart><fazchart mkey=\"sdwan-Top-Application-Session-Bandwidth\" title=\"{default}\" width=\"100%\"></fazchart><fazchart mkey=\"sdwan-Device-Application-sdwan-Rules-and-Ports-drilldown\" title=\"{default}\" width=\"100%\"></fazchart><h2>SD-WAN Users</h2><p>By looking at source traffic, we can determine the originating source of any particular traffic. Certain botnets, command and control functions, and even remote access can be session heavy and indicative of targeted attacks or persistent threats. Following charts representative of source traffic activity that may need further investigation.</p><fazchart mkey=\"sdwan-Top-Users-By-Bandwidth-Bar\" title=\"SD-WAN Top Source by Traffic Volume\" width=\"100%\"></fazchart><fazchart mkey=\"sdwan-top-user-app-Drilldown\" title=\"SD-WAN Top Source by Application and Traffic Volume\" width=\"100%\"></fazchart><p>&nbsp;</p>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90200
                next
                edit 90201
                next
                edit 90203
                next
            end
        set report-tag "sdwan"
        set protected enable
    next
    edit 1000060038
        set is-template enable
        set category "Application"
        set hide-rowid 1
        set title "Template - Self-Harm and Risk Indicators Report"
        set description "Self-Harm and Risk Indicators Report."
        set body "<div style=\"height:5px;\"></div><h2 style=\"font-family: Lato; font-size: 17.5px; color: black;\"> SUMMARY</h2><div style=\"height:5px;\"></div><h2 style=\"font-family: Lato; font-size: 16.5px;\"> SELF-HARM AND RISK INDICATORS SUMMARY</h2><div style=\"height:15px;\"></div><div style=\"display: -webkit-box; -webkit-box-pack: justify; width: 1000px;\"><div style=\"white-space: nowrap;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/web_users.png\" style=\"height:24px; width:24px;\" /><b><span style=\"font-size:24px; vertical-align: 3.5px;\"><fazmacro mkey=\"self-harm-Risky-Term-User-Count\"></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato; vertical-align: 3.5px;\"> Users</span></div><div style=\"white-space: nowrap;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/self_harm_terms.png\" style=\"height:24px; width:24px;\" /><b><span style=\"font-size:24px; vertical-align: 3.5px;\"><fazmacro mkey=\"self-harm-Risky-Term-Indicator-Count\"></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato; vertical-align: 3.5px;\"> Risky Terms or Phrases</span></div><div style=\"white-space: nowrap;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/self_harm_search_platform.png\" style=\"height:24px; width:24px;\" /><b><span style=\"font-size:24px; vertical-align: 3.5px;\"><fazmacro mkey=\"self-harm-Risky-Term-App-Count\"><fazfilters><fazfilter field=\"app\" oper=\"eq\" value=\"Google.Search_Search.Phrase, Bing.Search_Search.Phrase\"></fazfilter></fazfilters></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato; vertical-align: 3.5px;\"> Search Platform</span></div><div style=\"white-space: nowrap;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/self_harm_social_media.png\" style=\"height:24px; width:24px;\" /><b><span style=\"font-size:24px; vertical-align: 3.5px;\"><fazmacro mkey=\"self-harm-Risky-Term-App-Count\"><fazfilters><fazfilter field=\"app\" oper=\"eq\" value=\"Facebook_Post, Facebook_Chat, Twitter_Post, YouTube_Video.Access, Gmail_Chat, Gmail_Send.Message, Linkedin_Post, Vimeo_Video.Access\"></fazfilter></fazfilters> </fazmacro></span></b><span style=\"font-size:16px; font-family:Lato; vertical-align: 3.5px;\"> Social Media APPs Used</span></div></div><div style=\"height:25px;\"></div><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\" style=\"font-family: Lato; width:100%\"><tbody><tr><td style=\"vertical-align:top; width: 500px;\"><fazchart mkey=\"self-harm-Risky-Terms-By-App\" title=\"Risky Terms Used in Search Platform\" width=\"500px\"><fazfilters><fazfilter field=\"app\" oper=\"eq\" value=\"Google.Search_Search.Phrase, Bing.Search_Search.Phrase\"></fazfilter></fazfilters></fazchart></td><td style=\"vertical-align:top; width: 500px;\"><fazchart mkey=\"self-harm-Risky-Terms-By-App\" title=\"Risky Terms Used in Social Media\" width=\"500px\"><fazfilters><fazfilter field=\"app\" oper=\"eq\" value=\"Facebook_Post, Facebook_Chat, Twitter_Post, YouTube_Video.Access, Gmail_Chat, Gmail_Send.Message, Linkedin_Post, Vimeo_Video.Access\"></fazfilter></fazfilters> </fazchart></td></tr></tbody></table><div style=\"height:25px;\"></div><h2 style=\"font-family: Lato; font-size: 16.5px;\"> SELF-HARM AND RISK INDICATORS TIMELINE</h2><div style=\"height:5px;\"></div><fazchart width=\"1000px\" title=\" \" mkey=\"self-harm-Risky-Terms-Timeline\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height:10px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"self-harm-Risky-Term-User-Drilldown\" title=\"TOP 10 USERS WITH RISKY TERMS OR PHRASES\" width=\"1000px\"></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height:15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"Self-Harm-behaviour-banned\" title=\"TOP 50 RISKY TERMS ACROSS THE TIME FRAME\" width=\"1000px\"></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height:10px;\"></div><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"font-family: Lato; width: 100%;\"><tbody><tr><td style=\"vertical-align:middle; text-align: left; width:35px\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/Google_logo.png\" style=\"height:25px;\"/></td><td style=\"vertical-align:middle; text-align: left; width:35px\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/Bing_logo.png\" style=\"height:25px;\"/></td><td style=\"vertical-align: middle; text-align: left; width:830px\"><h2 style=\"font-family: Lato; font-size: 17px; color: black;\"> SEARCH TERMS WHICH MAY INDICATE SELF-HARM OR HARM</h2></td></tr></tbody></table><div style=\"height:5px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"self-harm-Risky-Term-User-Drilldown\" title=\"TOP 10 USERS WITH RISKY TERMS OR PHRASES IN SEARCHES\" width=\"1000px\"><fazfilters><fazfilter field=\"app\" oper=\"eq\" value=\"Google.Search_Search.Phrase, Bing.Search_Search.Phrase\"></fazfilter></fazfilters></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height:15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"Self-Harm-behaviour-banned\" title=\"TOP 50 RISKY TERMS USED IN SEARCHES\" width=\"1000px\"><fazfilters><fazfilter field=\"app\" oper=\"eq\" value=\"Google.Search_Search.Phrase, Bing.Search_Search.Phrase\"></fazfilter></fazfilters></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height:10px;\"></div><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"font-family: Lato; width: 100%;\"><tbody><tr><td style=\"vertical-align:middle; text-align: left; width: 35px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/facebooklogo.png\" style=\"height:25px;\"/></td><td style=\"vertical-align: middle; text-align: left; width: 850px;\"><h2 style=\"font-family: Lato; font-size: 17px; color: black;\"> FACEBOOK USAGE WHICH MAY INDICATE SELF-HARM OR HARM</h2></td></tr></tbody></table><div style=\"height:5px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"self-harm-Risky-Term-User-Drilldown\" title=\"TOP 10 USERS WITH RISKY TERMS OR PHRASES IN FACEBOOK\" width=\"1000px\"><fazfilters><fazfilter field=\"app\" oper=\"eq\" value=\"Facebook_Post,  Facebook_Chat\"></fazfilter></fazfilters></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height:15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"Self-Harm-behaviour-banned\" title=\"TOP 50 RISKY TERMS USED IN FACEBOOK\" width=\"1000px\"><fazfilters><fazfilter field=\"app\" oper=\"eq\" value=\"Facebook_Post, Facebook_Chat\"></fazfilter></fazfilters></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height:10px;\"></div><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"font-family: Lato; width: 100%;\"><tbody><tr><td style=\"vertical-align:middle; text-align: left; width: 35px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/twitterlogo.png\" style=\"height:25px;\"/></td><td style=\"vertical-align: middle; text-align: left; width: 850px;\"><h2 style=\"font-family: Lato; font-size: 17px; color: black;\"> TWITTER USAGE WHICH MAY INDICATE SELF-HARM OR HARM</h2></td></tr></tbody></table><div style=\"height:5px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"self-harm-Risky-Term-User-Drilldown\" title=\"TOP 10 USERS WITH RISKY TERMS USED IN TWEETS\" width=\"1000px\"><fazfilters><fazfilter field=\"app\" oper=\"eq\" value=\"Twitter_Post\"></fazfilter></fazfilters></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height:15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"Self-Harm-behaviour-banned\" title=\"TOP 50 RISKY TERMS USED IN TWEETS\" width=\"1000px\"><fazfilters><fazfilter field=\"app\" oper=\"eq\" value=\"Twitter_Post\"></fazfilter></fazfilters></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height:10px;\"></div><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"font-family: Lato; width: 100%;\"><tbody><tr><td style=\"vertical-align:middle; text-align: left; width: 40px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/gmail.png\" style=\"height:25px;\"/></td><td style=\"vertical-align: middle; text-align: left; width: 850px;\"><h2 style=\"font-family: Lato; font-size: 17px; color: black;\"> GMAIL AND GOOGLE CHAT USAGE WHICH MAY INDICATE SELF-HARM OR HARM</h2></td></tr></tbody></table><div style=\"height:5px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"self-harm-Risky-Term-User-Drilldown\" title=\"TOP 10 USERS WITH RISK TERMS USED IN GMAIL SUBJECTS AND GOOGLE CHAT\" width=\"1000px\"><fazfilters><fazfilter field=\"app\" oper=\"eq\" value=\"Gmail_Chat, Gmail_Send.Message\"></fazfilter></fazfilters></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height:15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"Self-Harm-behaviour-banned\" title=\"TOP 50 RISKY TERMS USED IN GMAIL SUBJECTS AND GOOGLE CHAT MESSAGES\" width=\"1000px\"><fazfilters><fazfilter field=\"app\" oper=\"eq\" value=\"Gmail_Chat, Gmail_Send.Message\"></fazfilter></fazfilters></fazchart></div>"
            config header
                edit 1
                    set type graphic
                    set graphic "header_webusage_bg.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
            end
        set report-tag "concise"
        set report-style "{\"color-scheme\": \"spring\"}"
        set protected enable
    next
    edit 1000060039
        set is-template enable
        set category "Security"
        set title "Template - SOC Incident Report"
        set description "Present a brief summary of SOC Incidents."
        set body "<h1><span style=\"font-size:28px\"><span style=\"color:#1f77b4\">SOC Incident Report</span></span></h1><p><span style=\"font-size:11px\">This report provides a summary of the SOC incidents ${timeperiod}.</span><br />&nbsp;</p><table border=\"0\" cellspacing=\"1\" cellpadding=\"1\" align=\"center\" style=\"width:100%\"><tbody><tr><td><fazchart mkey=\"soc-Incident-by-Severity\" title=\"{default}\" width=\"100%\"></fazchart></td><td><fazchart mkey=\"soc-Incident-by-Status\" title=\"{default}\" width=\"100%\"></fazchart></td></tr><tr><td><fazchart mkey=\"soc-Incident-by-Category-Unresolved\" title=\"{default}\" width=\"100%\"></fazchart></td><td><fazchart mkey=\"soc-Incident-by-Severity-Unresolved\" title=\"{default}\" width=\"100%\"></fazchart></td></tr></tbody></table><p style=\"text-align:center\">&nbsp;</p><fazchart mkey=\"soc-Incident-Timeline-by-Category\" title=\"Count of Incident Type over Time\" width=\"100%\"></fazchart><p>&nbsp;</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><fazchart mkey=\"soc-Incident-List-Unresolved\" title=\"List of Unresolved Incidents\" width=\"100%\"></fazchart><p>&nbsp;</p><p>&nbsp;</p>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90203
                next
            end
        set protected enable
    next
    edit 1000060040
        set is-template enable
        set category "System"
        set title "Template - Secure SD-WAN Assessment Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Secure SD-WAN Assessment Report."
        set body "<h1><span style=\"font-size:24px\"><strong>Executive Summary</strong></span></h1><p>We&nbsp;aggregated key findings from our Secure SD-WAN assessment within the Executive Summary below. While the highlights are listed below, a more detailed view of each section follows. Be sure to review the Recommended Actions page at the end of this report as well for actionable steps your organization can take to optimize your network for Direct Internet Access, protect your organization from external/branch office threats, and ultimately save money.</p><h2><span style=\"font-size:20px\"><strong>Application</strong></span></h2><table border=\"0\" cellspacing=\"1\" cellpadding=\"1\" align=\"center\" style=\"height:110px; width:720px\"><tbody><tr><td style=\"text-align:left; width:110px\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/icons_availability.png\" style=\"margin-left:10px; margin-right:10px; width:90px; height:90px;\" /></td><td style=\"text-align:left; vertical-align:top; width:160px\"><p><span style=\"font-size:24px\"><strong><fazmacro mkey=\"sdwan-CTAP-Total-DIA-Applications-Detected\"></fazmacro></strong></span></p><p style=\"text-align:left\"><span style=\"font-size:14px\">External (Potential DIA) Applications</span></p></td><td style=\"text-align:left; width:110px\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/application_Cloud_IT.png\" style=\"margin-left:10px; margin-right:10px; width:90px; height:90px;\" /></td><td style=\"text-align:left; vertical-align:top; width:160px\"><p><span style=\"font-size:24px\"><strong><fazmacro mkey=\"sdwan-CTAP-Total-Bandwidth-Cloud-IT\"></fazmacro></strong></span></p><p style=\"text-align:left\"><span style=\"font-size:14px\">Total Cloud IT Traffic</span></p></td><td style=\"text-align:left; width:110px\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/application_Audio.png\" style=\"margin-left:10px; margin-right:10px; width:90px; height:90px;\" /></td><td style=\"text-align:left; vertical-align:top; width:160px\"><p><span style=\"font-size:24px\"><strong><fazmacro mkey=\"sdwan-CTAP-Total-Bandwidth-VoIP-Video-Audio\"></fazmacro></strong></span></p><p style=\"text-align:left\"><span style=\"font-size:14px\">Total VoIP/Audio/ Video Traffic</span></p></td></tr></tbody></table><p>Application usage should have a strong influence on your network architecture. Understanding which types of applications are used and specifically business application performance can improve user experience and productivity.</p><hr /><h2><span style=\"font-size:20px\"><strong>Security</strong></span></h2><table border=\"0\" align=\"center\" cellspacing=\"1\" cellpadding=\"1\" style=\"height:110px; width:720px\"><tbody><tr><td style=\"width:110px\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/attacks.png\" style=\"margin-left:15px; margin-right:15px; width:80px; height:80px;\" /></td><td style=\"vertical-align:top; width:160px\"><p><span style=\"font-size:24px\"><strong><fazmacro mkey=\"CTAP-Total-App-Vuln-Detected\"></fazmacro></strong></span></p><p style=\"text-align:left\"><span style=\"font-size:14px\">Application Vulnerability Attacks Detected</span></p></td><td style=\"width:110px\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/malware.png\" style=\"margin-left:10px; margin-right:10px; width:90px; height:90px;\" /></td><td style=\"text-align:left; vertical-align:top; width:160px\"><p><span style=\"font-size:24px\"><strong><fazmacro mkey=\"CTAP-Total-Malware-Botnet-Detected\"></fazmacro></strong></span></p><p style=\"text-align:left\"><span style=\"font-size:14px\">Malware and/or Botnet Detected</span></p></td><td style=\"width:110px\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/high_risk_app.png\" style=\"margin-left:10px; margin-right:10px; width:90px; height:90px;\" /></td><td style=\"text-align:left; vertical-align:top; width:160px\"><p><span style=\"font-size:24px\"><strong><fazmacro mkey=\"CTAP-Total-High-Risk-Used\"></fazmacro></strong></span></p><p style=\"text-align:left\"><span style=\"font-size:14px\">High Risk Applications Detected</span></p></td></tr></tbody></table><p>Maintaining a full security stack at the WAN edge is critical in any SD-WAN deployment where public Internet circuits are leveraged. Note that any threats observed within this report have effectively bypassed your existing network security gateway, so they should be considered active and may lead to increased risk (such as a data breach).</p><hr /><h2><span style=\"font-size:20px\"><strong>Utilization</strong></span></h2><table border=\"0\" align=\"center\" cellspacing=\"1\" cellpadding=\"1\" style=\"height:110px; width:720px\"><tbody><tr><td style=\"width:110px\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/icons_bandwidth.png\" style=\"margin-left:10px; margin-right:10px; width:90px; height:90px;\" /></td><td style=\"text-align:left; vertical-align:top; width:160px\"><p><span style=\"font-size:24px\"><strong><fazmacro mkey=\"sdwan-CTAP-Total-Bandwidth\"></fazmacro></strong></span></p><p style=\"text-align:left\"><span style=\"font-size:14px\">Total Bandwidth Used</span></p></td><td style=\"width:110px\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/non-business.png\" style=\"margin-left:10px; margin-right:10px; width:90px; height:90px;\" /></td><td style=\"text-align:left; vertical-align:top; width:160px\"><p><span style=\"font-size:24px\"><strong><fazmacro mkey=\"sdwan-CTAP-Total-Bandwidth-nonBusiness\"></fazmacro></strong></span></p><p style=\"text-align:left\"><span style=\"font-size:14px\">Total Non-Business Traffic</span></p></td><td style=\"width:110px\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/SSL-encrypt.png\" style=\"margin-left:15px; margin-right:15px; width:80px; height:80px;\" /></td><td style=\"text-align:left; vertical-align:top; width:160px\"><p><span style=\"font-size:24px\"><strong><fazmacro mkey=\"sdwan-CTAP-HTTPS-SSL-Bandwidth\"></fazmacro></strong></span></p><p style=\"text-align:left\"><span style=\"font-size:14px\">Total SSL Encrypted Traffic</span></p></td></tr></tbody></table><p>In addition to individual applications, understanding overall utilization can help with capacity planning, circuit selection, and streamlining network traffic over time. This awareness can also help reduce operational costs associated with backhauling traffic over more expensive WAN links (such as MPLS).</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1><span style=\"font-size:24px\"><strong>Applications</strong></span></h1><table border=\"0\" cellspacing=\"1\" cellpadding=\"1\" align=\"center\" style=\"width:740px; line-height:1.2;\"><tbody><tr><td style=\"text-align:center; vertical-align:top; width:80px\"><p style=\"text-align:center\">Quick Stats<img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/stats.png\" style=\"height:70px; width:70px\" /></p></td><td style=\"text-align:left; vertical-align:top; width:330px\"><ul><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"sdwan-CTAP-Total-DIA-Applications-Detected\"></fazmacro></strong>external (potential DIA) applications</span></li><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"sdwan-CTAP-Total-Bandwidth-External\"></fazmacro></strong>external traffic</span></li><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"sdwan-CTAP-Total-Bandwidth-Cloud-IT\"></fazmacro></strong>Cloud IT traffic</span></li></ul></td><td style=\"text-align:left; vertical-align:top\"><ul><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"sdwan-CTAP-Total-Bandwidth-VoIP-Video-Audio\"></fazmacro></strong>VoIP/Audio/Video traffic</span></li><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"sdwan-CTAP-App-With-Highest-Bandwidth\"></fazmacro></strong>is the most used external application</span></li><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"sdwan-CTAP-Appcat-With-Highest-Bandwidth\"></fazmacro></strong>is the top application category</span></li></ul></td></tr></tbody></table><table border=\"0\" align=\"center\" cellspacing=\"2\" cellpadding=\"1\" style=\"height:240px; width:730px\"><tbody><tr><td style=\"height:240px; text-align:left; width:360px\"><fazchart mkey=\"sdwan-CTAP-Total-Bandwidth-Internal-And-External\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p></td><td style=\"height:240px; text-align:left; width:10px\">&nbsp;</td><td style=\"height:240px; text-align:justify; vertical-align:middle; width:360px\"><h2><strong>Internal vs. External Traffic</strong></h2><p>Before setting up an SD-WAN architecture, it&#39;s useful to understand high-level traffic flows. By examining applications that are communicating externally, you can begin to calculate costs associated with WAN links (such as typically more costly MPLS lines). Network traffic with either a source or destination address to an external IP address can generally be considered external traffic which is how we&#39;ve calculated the chart to the left. External traffic can benefit greatly from utilizing broadband circuits for Direct Internet Access.</p></td></tr></tbody></table><table border=\"0\" cellspacing=\"0\" cellpadding=\"1\" align=\"center\" style=\"height:240px; width:730px\"><tbody><tr><td style=\"height:240px; text-align:justify; vertical-align:middle; width:360px\"><h2><strong>External Traffic Breakout</strong></h2><p>By categorizing internal hosts communicating with external servers, you can get a general sense for bandwidth requirements and how you may want to prioritize Direct Internet Access (DIA) applications within an SD-WAN deployment. Business applications that communicate directly with the Internet could be routed through a broadband circuit instead of backhauling to the datacenter through a dedicated link such as MPLS. This can result in significant savings not to mention increased throughput and lower latency. Non-business and network applications communicating externally can similarly be prioritized and routed.</p></td><td style=\"height:240px; text-align:justify; vertical-align:middle; width:10px\">&nbsp;</td><td style=\"height:240px; text-align:justify; vertical-align:middle; width:360px\"><fazchart mkey=\"sdwan-CTAP-Total-Bandwidth-External-Business-nonBusiness-Network\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p></td></tr></tbody></table><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2><strong>Potentially DIA Business Applications</strong></h2><p style=\"text-align:justify\">This chart illustrates a breakout of important business applications specific to your network as ranked by bandwidth and grouped by the top five application categories. It does not include non-business (such as YouTube, Spotify, etc.) or Network Service (such as DNS, NTP, etc.) applications which could impact overall bandwidth. Instead, these are applications which can be prioritized by leveraging SD-WAN application steering strategies and Service Level Agreements (SLAs) in order to engineer their optimal path to the Internet.&nbsp;</p><fazchart mkey=\"sdwan-CTAP-Top-Appcat-Appgroup-By-Bandwidth-Sankey\" title=\"\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><p>&nbsp;</p><table border=\"0\" cellspacing=\"1\" cellpadding=\"1\" align=\"center\" style=\"height:720px; width:720px\"><tbody><tr><td style=\"height:240px; text-align:left; vertical-align:top; width:360px\"><h2><strong>&nbsp;Top Business Applications</strong></h2><fazchart mkey=\"sdwan-CTAP-Business-Apps-Bandwidth\" title=\"\" width=\"350px\"></fazchart></td><td style=\"height:240px; vertical-align:top; width:360px\"><h2><strong>&nbsp;Top Cloud IT Applications</strong></h2><fazchart mkey=\"sdwan-CTAP-Cloud-IT-Apps-Bandwidth\" title=\"\" width=\"350px\"></fazchart></td></tr><tr><td style=\"height:240px; vertical-align:top; width:360px\"><h2><strong>Top Storage Backup Applications&nbsp;</strong></h2><fazchart mkey=\"sdwan-CTAP-Storage-Backup-Apps-Bandwidth\" title=\"\" width=\"350px\"></fazchart></td><td style=\"height:240px; vertical-align:top; width:360px\"><h2><strong>Top Collaboration Applications&nbsp;</strong></h2><fazchart mkey=\"sdwan-CTAP-Collaboration-Apps-Bandwidth\" title=\"\" width=\"350px\"></fazchart></td></tr><tr><td style=\"height:240px; vertical-align:top; width:360px\"><h2><strong>&nbsp;Top VoIP/Audio/Video Applications</strong></h2><fazchart mkey=\"sdwan-CTAP-Top-Streaming-App-By-Bandwidth\" title=\"\" width=\"350px\"></fazchart></td><td style=\"height:240px; vertical-align:top; width:360px\"><h2>&nbsp;<strong>Top Social Media Applications</strong></h2><fazchart mkey=\"sdwan-CTAP-Top-SocialMedia-App-By-Bandwidth\" title=\"\" width=\"350px\"></fazchart></td></tr></tbody></table><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1><span style=\"font-size:24px\"><strong>Security</strong></span></h1><table border=\"0\" align=\"center\" cellspacing=\"1\" cellpadding=\"1\" style=\"width:740px;line-height:1.2\"><tbody><tr><td style=\"text-align:center; vertical-align:top; width:80px\"><p style=\"text-align:center\">Quick Stats<img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/stats.png\" style=\"height:70px; width:70px\" /></p></td><td style=\"text-align:left; vertical-align:top; width:330px\"><ul><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"CTAP-Total-App-Vuln-Detected\"></fazmacro></strong>application vulnerability attacks detected</span></li><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"CTAP-Total-Malware-Botnet-Detected\"></fazmacro></strong>&nbsp;known botnet detected</span></li><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"CTAP-Total-Malicious-Websites-Detected\"></fazmacro></strong>malicious websites detected</span></li><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"CTAP-Total-High-Risk-Used\"></fazmacro></strong>high risk applications detected</span></li></ul></td><td style=\"text-align:left; vertical-align:top; width:330px\"><ul><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"CTAP-Total-Phishing-Websites-Detected\"></fazmacro></strong>&nbsp;phishing websites detected</span></li><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"CTAP-Total-Malware-Detected\"></fazmacro></strong>&nbsp;known malware detected</span></li><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"sdwan-CTAP-SB-Analyzed-Files-Number\"></fazmacro></strong>files analyzed by sandbox</span></li><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"sdwan-CTAP-SB-Number-of-Suspicious-Files\"></fazmacro></strong>suspicious files detected by sandbox</span></li></ul></td></tr></tbody></table><h2><strong>High Risk Applications</strong></h2><p>The FortiGuard research team assigns a risk rating of 1 to 5 to an application based on the application behavioral characteristics. The risk rating can help administrators to identify the high risk applications quickly and make a better decision on the application control policy. Applications listed below were assigned a risk rating of 4 or higher.</p><fazchart mkey=\"ctap-apprisk-ctrl-High-Risk-Application\" title=\"\" width=\"100%\"></fazchart><h2>&nbsp;</h2><h2><strong>Top Application Vulnerability Exploits Detected</strong></h2><p style=\"text-align:justify\">The performance gains and cost savings from leveraging public Internet circuits in an SD-WAN deployment need to be protected by a full security stack at the WAN edge. Application vulnerabilities at the branch can be exploited to compromise the security of your entire network. The FortiGuard research team analyzes these vulnerabilities and then develops signatures to detect them. FortiGuard currently leverages a database of more than 5,800 known application threats to detect attacks that evade traditional firewall systems. For more information on application vulnerabilities, please refer to FortiGuard at: http://www.fortiguard.com/intrusion.</p><fazchart mkey=\"ctap-apprisk-ctrl-Application-Vulnerability\" title=\"\" width=\"100%\"></fazchart><h2><strong>Top Malware, Botnets and Spyware/Adware Detected</strong></h2><p>There are numerous channels that cybercriminals use to distribute malware. Most common methods motivate users to open an infected file in an email attachment, download an infected file, or click on a link leading to a malicious site. During the security assessment, Fortinet identified a number of malware and botnet-related events which indicate malicious file downloads or connections to botnet command and control sites.</p><fazchart mkey=\"ctap-apprisk-ctrl-Common-Virus-Botnet-Spyware\" title=\"\" width=\"100%\"></fazchart><h2>&nbsp;</h2><h2><strong>At-Risk Devices and Hosts</strong></h2><p style=\"text-align:justify\">Based on the types of activity exhibited by an individual host, we can approximate the trustworthiness of each individual client. This client reputation is based on key factors such as websites browsed, applications used and inbound/outbound destinations utilized. Ultimately, we can create an overall threat score by looking at the aggregated activity used by each individual host.&nbsp;</p><fazchart mkey=\"sdwan-CTAP-App-Risk-Reputation-Top-Devices-By-Scores\" title=\"\" width=\"100%\"></fazchart><h2><strong>Unknown Malware</strong></h2><p>Today&rsquo;s increasingly sophisticated threats can mask their maliciousness and bypass traditional antimalware security. Conventional antimalware engines are, in the time afforded and to the certainty required, often unable to classify certain payloads as either good or bad; in fact, their intent is unknown. Sandboxing helps solve this problem &ndash; it entices unknown files to execute in a protected environment, observes its resultant behavior and classifies its risk based on that behavior. With this functionality enabled for your assessment, we have taken a closer look at files traversing your network.&nbsp;</p><fazchart mkey=\"sdwan-CTAP-SB-Top-Sandbox-Files\" title=\"\" width=\"100%\"></fazchart><table border=\"0\" align=\"center\" cellspacing=\"1\" cellpadding=\"1\" style=\"height:240px; width:730px\"><tbody><tr><td style=\"text-align:justify; vertical-align:top; width:360px\"><h2><strong>Malicious and Suspicious Files</strong></h2><p>The results of behavioral analysis are usually categorized in one of three ways: clean, suspicious, or malicious. A designation of clean means that no abnormal behaviors were observed and the file can be considered safe. Suspicious activities are potentially dangerous and may warrant further attention &ndash; for instance, a high suspicion file may try to replicate itself whereas a low suspicion file may only create abnormal registry settings. A malicious designation should be considered a legitimate threat to your network and requires immediate attention. The chart rendered here shows malicious and suspicious files (e.g. it does not include files designated as clean).</p></td><td style=\"text-align:justify; vertical-align:top; width:10px\">&nbsp;</td><td style=\"vertical-align:middle; padding-top:30px; width:360px\"><fazchart mkey=\"sdwan-CTAP-SB-Total-Number-of-Malicious-Suspicious-Files\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p></td></tr></tbody></table><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1><span style=\"font-size:24px\"><strong>Utilization</strong></span></h1><table border=\"0\" align=\"center\" cellspacing=\"1\" cellpadding=\"1\" style=\"width:740px; line-height:1.2\"><tbody><tr><td style=\"text-align:center; vertical-align:top; width:80px\"><p style=\"text-align:center\">Quick Stats<img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/stats.png\" style=\"height:70px; width:70px\" /></p></td><td style=\"text-align:left; vertical-align:top; width:330px\"><ul><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"sdwan-CTAP-Total-Bandwidth\"></fazmacro></strong>total bandwidth used</span></li><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"sdwan-CTAP-Total-Bandwidth-nonBusiness\"></fazmacro></strong>non-Business traffic</span></li><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"sdwan-CTAP-HTTPS-SSL-Bandwidth\"></fazmacro></strong>SSL encrypted traffic</span></li><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"sdwan-CTAP-Top-Bandwidth-Day\"></fazmacro></strong>is the highest daily peak usage</span></li><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"sdwan-CTAP-Top-User-Source-By-Bandwidth\"></fazmacro></strong>is the highest session bandwidth source</span></li></ul></td><td style=\"text-align:left; vertical-align:top; width:330px\"><ul><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"sdwan-CTAP-Top-User-Source-By-Sessions\"></fazmacro></strong>is the highest session count source</span></li><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"sdwan-CTAP-Avg-Log-Rate-Overall\"></fazmacro></strong>average log rate</span></li><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"sdwan-CTAP-event-Usage-CPU-Overall\"></fazmacro></strong>average FortiGate CPU usage</span></li><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"sdwan-CTAP-event-Usage-Mem-Overall\"></fazmacro></strong>average FortiGate memory usage</span></li></ul></td></tr></tbody></table><h2><strong>Top Source Locations</strong></h2><p style=\"text-align:justify\">By looking at IP source traffic, we can determine the originating country of any particular request. Certain botnets, command and control functions, and even remote access can be session heavy and indicative of targeted attacks or persistent threats from nation-states. This chart is representative of country-based traffic - activity from specific originating nations may be anomalous and warrant further investigation.</p><fazchart mkey=\"sdwan-CTAP-Top-Source-Countries\" title=\"\" width=\"100%\"></fazchart><h2><strong>Top Bandwidth Consuming Sources/Destinations</strong></h2><p>One of the most telling ways to analyze bandwidth is by looking at destinations and sources generating the most traffic. Common destination sites (e.g. external websites), such as those for OS/firmware updates, can be throttled to allow prioritized, business critical traffic. Internally, high traffic hosts can be optimized through traffic shaping or corporate use policies.</p><fazchart mkey=\"Top-Destination-Addresses-By-Bandwidth-Bar\" title=\"\" width=\"100%\"></fazchart><h2><strong>Average Bandwidth by Hour</strong></h2><p style=\"text-align:justify\">By looking at bandwidth usage when distributed over an average day, administrators can better understand their organizational ISP connection and interface speed requirements. Bandwidth can also be optimized on an application basis (using throttling), specific users can be prioritized during peak traffic times, and updates can be rescheduled outside of working hours.</p><fazchart mkey=\"sdwan-CTAP-Average-Bandwidth-Day-Hour\" title=\"\" width=\"100%\"></fazchart><h2><strong>Average Log Rate by Hour</strong></h2><p>Understanding average log rates is extremely beneficial when sizing a security environment from a performance standpoint. Higher average log rates applied to specific hours usually indicate peak traffic usage and throughput. Calculating enterprisewide log rates can also help when sizing for upstream logging/analytics devices such as FortiAnalyzer. Keep in mind, the log rates presented here are with the full logging capabilities of the FortiGate enabled and will include all log types (traffic, antivirus, application, IPS, web and system events).&nbsp;</p><fazchart mkey=\"sdwan-CTAP-Average-Log-Rate-By-Hour\" title=\"\" width=\"100%\"></fazchart><h2>&nbsp;</h2><h2><strong>Average FortiGate CPU Usage by Hour</strong></h2><p>CPU usage of a FortiGate is often used to size a final solution properly. By looking at an hourly breakdown of CPU utlilization statistics, it&#39;s easy to get a good idea about how FortiGates will perform in the target network. Typically, with higher throughput, more logs are generated. If 75% or more utilization is sustained over a long period of time, either a more powerful model or revised architecture may be required for final implementation.</p><fazchart mkey=\"sdwan-CTAP-CPU-Usage-Per-Hour\" title=\"\" width=\"100%\"></fazchart><h2>&nbsp;</h2><h2><strong>Average FortiGate Memory Usage by Hour</strong></h2><p>Similarly, memory usage over time is an indicator of the FortiGate&#39;s sustainability in the target network environment. Memory usage may remain high even when throughput is relatively low due to logging activity (or queued logging activity) over time.</p><fazchart mkey=\"sdwan-CTAP-Memory-Usage-Per-Hour\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90201
                next
                edit 90203
                next
            end
        set protected enable
    next
    edit 1000060041
        set is-template enable
        set category "System"
        set hide-rowid 1
        set title "Template - Throughput Utilization Billing Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver3.png"
        set description "Interface Throughput Utilization Billing Report."
        set body "<h2><span style=\"font-size:20px\"><strong>Introduction</strong></span></h2><p>This report provides consumption based billing information through interface bandwidth utilization data logged by FortiOS. This information will help to monitor throughput utilization of all interfaces on all devices as well as throughput utilization per VDOM tenants. Throughput utilization is measured on any device to monitor the 95th percentile of throughput that the device is processing over a period of time.</p><table border=\"0\" align=\"center\" cellspacing=\"2\" cellpadding=\"1\" style=\"width:700px\"><tbody><tr><td style=\"text-align:left; width:100px\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/icons_days.png\" style=\"margin-left:10px; margin-right:10px; margin-bottom:20px; height:90px; width:90px\" /></td><td style=\"text-align:left; vertical-align:top; width:200px\"><p><span style=\"font-size:14px\"><strong>Number of Days:</strong></span></p><p><strong><span style=\"font-size:24px\">${timendays}</span></strong></p></td><td style=\"text-align:left; width:100px\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/icons_billing.png\" style=\"margin-left:10px; margin-right:10px; margin-bottom:20px; height:90px; width:90px\" /></td><td style=\"text-align:left; vertical-align:top; width:200px\"><p><span style=\"font-size:14px\"><strong>Billing Method:</strong></span></p><p><span style=\"font-size:24px\"><strong>95th</strong></span></p></td></tr><tr><td style=\"text-align:left; width:100px\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/icons_samples.png\" style=\"margin-left:10px; margin-right:10px; margin-bottom:10px; height:90px; width:90px\" /></td><td style=\"text-align:left; vertical-align:top; width:200px\"><p><span style=\"font-size:14px\"><strong>Total Number of Samples:</strong></span></p><strong><span style=\"font-size:24px\"><fazmacro mkey=\"intf-Total-Samples\"></fazmacro></span></strong></td><td style=\"text-align:left; width:100px\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/icons_analysis.png\" style=\"margin-left:10px; margin-right:10px; margin-bottom:10px; height:90px; width:90px\" /></td><td style=\"text-align:left; vertical-align:top; width:200px\"><p><span style=\"font-size:14px\"><strong>Utilized Throughput:</strong></span></p><p><strong><span style=\"font-size:24px\"><fazmacro mkey=\"intf-95th-mbps\"></fazmacro></span><span style=\"font-size:24px\">&nbsp;Mbps</span></strong></p></td></tr></tbody></table><p></p><h2><span style=\"font-size:20px\"><strong>Interface Throughput Over Time</strong></span></h2><p>Following chart displays interface throughput utilization measured at every 5 minutes over time.</p><fazchart mkey=\"intf-Timeline-Sampling\" title=\"\" width=\"100%\"></fazchart><p>Following table displays historical information of the throughput utilization for the lifecycle of the consumption contract.</p><fazchart mkey=\"intf-Data-Analysis-Table\" title=\"\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2><span style=\"font-size:20px\"><strong>Interface Throughput Distribution</strong></span></h2><p>Following chart displays the number of samples over the range of throughput utilization.</p><fazchart mkey=\"intf-Util-Histogram\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><h2><span style=\"font-size:20px\"><strong>Interface Throughput Data Rate</strong></span></h2><p>This chart shows interface throughput utilization measured at every 5 minutes over the Percentile of Total Samples.</p><fazchart mkey=\"intf-Sorted-Line\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><h2><span style=\"font-size:20px\"><strong>Interface Throughput Device Summary</strong></span></h2><p>This chart shows interface throughput utilization summary by devices.</p><fazchart mkey=\"intf-Device-Summary\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
                edit 90201
                next
            end
        set report-tag "billing"
        set protected enable
    next
    edit 1000060042
        set is-template enable
        set category "Security"
        set title "Template - Daily Summary Report"
        set description "Present a brief summary report about traffic, threat, app, user, incident, compromised host and so on."
        set body "<div style=\"width:100%\"><h1><span style=\"float:left; font-size:20px\">Daily Summary Report</span></h1><span style=\"color:grey; font-size:10px; padding-left:10px\">Data ${timeperiod}</span></div><table style=\"width:100%\"><tbody><tr><td style=\"vertical-align:top\"><fazchart mkey=\"daily-Summary-Traffic-Bandwidth-Line\" title=\"\" width=\"850px\"></fazchart></td><td style=\"vertical-align:top; width:200px;\"><p><span style=\"font-size:26px\"><fazmacro mkey=\"daily-Summary-Total-Bandwidth\"></fazmacro></span></p><p><span style=\"font-size:18px\">Traffic Usage</span></p></td></tr></tbody></table><table style=\"width:100%\"><tbody><tr><td><fazchart mkey=\"daily-Summary-Top-App\" title=\"Top Application by Severity\" width=\"700px\"></fazchart></td><td><fazchart mkey=\"daily-Summary-Top-Appcat-Bandwidth\" title=\"Top Application Category\" width=\"350px\"></fazchart></td></tr></tbody></table><table style=\"width:100%\"><tbody><tr><td style=\"vertical-align:top\"><fazchart mkey=\"daily-Summary-Top-Threats\" title=\"Top Threat\" width=\"700px\"></fazchart></td><td style=\"vertical-align:top\"><fazchart mkey=\"daily-Summary-Top-Domain\" title=\"Top Website by Traffic\" width=\"350px\"></fazchart></td></tr></tbody></table><table style=\"width:100%\"><tbody><tr><td style=\"vertical-align:top\"><fazchart mkey=\"daily-Summary-Incidents-by-Severity\" title=\"Incidents by Severity\" width=\"200px\"></fazchart></td><td style=\"vertical-align:top\"><div style=\"width: 20px;\"></div></td><td style=\"vertical-align:top\"><fazchart mkey=\"daily-Summary-Top-Compromised-Hosts\" title=\"Compromised Host\" width=\"400px\"></fazchart></td><td style=\"vertical-align:top\"><fazchart mkey=\"daily-Summary-Top-User\" title=\"Top User by Traffic\" width=\"400px\"></fazchart></td></tr></tbody></table>"
            config folders
                edit 99999
                next
            end
        set report-tag "compact"
        set protected enable
    next
    edit 1000060043
        set is-template enable
        set category "Assets"
        set hide-rowid 1
        set title "Template - Asset and Identity Report"
        set description "Present a brief summary report on assets and their users, vulnerabilities, software installed as well as running processes."
        set body "<div style=\"width:100%\"><h1><span style=\"float:left; font-size:20px\">Asset and Identity Report</span></h1><span style=\"color:grey; font-size:10px; padding-left:10px\">Data ${timeperiod}</span></div><table style=\"padding-top:10px; width:100%\"><tbody><tr><td style=\"vertical-align:top\"><fazchart mkey=\"ueba-Asset-User-Discovery-by-Time\" title=\"\" width=\"780px\"></fazchart></td></tr></tbody></table><table style=\"padding-top:20px; width:100%\"><tbody><tr><td style=\"vertical-align:top\"><fazchart mkey=\"ueba-Asset-Count-by-Detecttype\" title=\"Asset by Detection Method\" width=\"260px\"></fazchart></td><td style=\"vertical-align:top\"><fazchart mkey=\"ueba-Asset-Identification\" title=\"Asset by Identification\" width=\"260px\"></fazchart></td><td style=\"vertical-align:top\"><fazchart mkey=\"ueba-User-Count-by-Usergroup\" title=\"User by User Group\" width=\"260px\"></fazchart></td></tr></tbody></table><table style=\"padding-top:20px; width:100%\"><tbody><tr><td style=\"vertical-align:top\"><fazchart mkey=\"ueba-Asset-Count-by-HWOS\" title=\"Asset by Hardware OS\" width=\"260px\"></fazchart></td><td style=\"vertical-align:top\"><fazchart mkey=\"ueba-Asset-Count-by-Device-and-Detecttype\" title=\"Device by Detection Method\" width=\"260px\"></fazchart></td><td style=\"vertical-align:top\"><fazchart mkey=\"ueba-Asset-User-Count-by-Device\" title=\"Device by Asset and User\" width=\"260px\"></fazchart></td></tr></tbody></table><fazchart mkey=\"ueba-Asset-User-Count-by-Device-Interface-and-Detectiontype\" title=\"Asset and User by Device Interface\" width=\"770px\"></fazchart>"
            config folders
                edit 90101
                next
                edit 90202
                next
            end
        set report-tag "compact"
        set protected enable
    next
    edit 1000060044
        set is-template enable
        set category "Security"
        set title "Template - DNS Security Report"
        set description "Present a brief summary report about DNS Security."
        set body "<h1><strong>Executive Summary</strong></h1><p style=\"text-align:justify\">The DNS Security report provides organizations a snapshot of their current security posture based on known and unknown malware found in the network. Through the use of sandbox, organizations can better understand the benefits of using sandbox to uncover potential vulnerabilities in their security architecture and policies and review the details of these threats.</p><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"width:100%\"><tbody><tr><td><table border=\"0\" cellspacing=\"20\" cellpadding=\"0\"><tbody><tr><td><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/Top_Botnet_CC_Domain.png\" style=\"height:60px; width:60px\" /></td><td><div style=\"width: 240px;\"><strong><span style=\"font-size:16px; word-wrap: break-word;\"><fazmacro mkey=\"dns-Security-Top-Domain-with-Botnet-CC-Detected\"></fazmacro></span></strong><p>Top Botnet C&C Domain</p></div></td></tr><tr><td><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/Top_DNS_High_Risk_Source_IP.png\" style=\"height:60px; width:60px\" /></td><td><div style=\"width: 240px;\"><strong><span style=\"font-size:16px; word-wrap: break-word;\"><fazmacro mkey=\"dns-Security-Top-One-DNS-High-Risk-Source-IP\"></fazmacro></span></strong><p>Top DNS High Risk Source IP</p></div></td></tr><tr><td><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/Top_Malicious_IP.png\" style=\"height:60px; width:60px\" /></td><td><div style=\"width: 250px\"><strong><span style=\"font-size:16px; word-wrap: break-word;\"><fazmacro mkey=\"dns-Security-Top-Malicious-IP\"></fazmacro></span></strong><p>Top Malicious IP</p></div></td></tr><tr><td><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/Count_Domains_Blocked.png\" style=\"height:60px; width:60px\" /></td><td><div style=\"width: 240px;\"><span style=\"font-size:16px; word-wrap: break-word;\"><strong><fazmacro mkey=\"dns-Security-Count-of-Domains-Blocked\"></fazmacro></strong></span><p>Count Domains Blocked</p></div></td></tr><tr><td><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/Top_Queried_Domain.png\" style=\"height:60px; width:60px\" /></td><td><div style=\"width: 240px;\"><strong><span style=\"font-size:16px; word-wrap: break-word;\"><fazmacro mkey=\"dns-Security-Top-Queried-Domain\"></fazmacro></span></strong><p>Top Queried Domain</p></div></td></tr></tbody></table></td><td style=\"vertical-align: top; width: 350px;\"><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"width:350px;\"><tbody><tr><td style=\"width: 350px;\"><p style=\"text-align:justify\">As DNS traffic is generally permitted to pass freely through networks devices and firewalls, this makes it a popular target for hackers and cyber-criminals to try to gain access. It is important for network security teams to implement policies and measures to monitor DNS security.</p></td></tr><tr><td style=\"width: 350px;\"><h2><strong>Top Botnet C&C Detected Domains</strong></h2><fazchart mkey=\"dns-Security-Top-Domain-with-Botnet-CC-Detected\" title=\"\" width=\"350px\"></fazchart></td></tr></tbody></table></td></tr></tbody></table><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"width:100%\"><tbody><tr><td style=\"width: 350px; vertical-align: top;\"><h2><strong>Top High Risk Domain Categories</strong></h2><p>The following chart shows a count of vistied high risk or malicious domain categories.</p><fazchart mkey=\"dns-Security-Top-Visited-High-Risk-Domain-Categories\" title=\"\" width=\"350px\"></fazchart></td><td style=\"width: 20px; vertical-align: top;\"></td><td style=\"width: 350px; vertical-align: top;\"><h2><strong>Domain Count by Threat Level</strong></h2><p>The following chart shows a count of domains identified in the DNS logs by the threat level.</p><fazchart mkey=\"dns-Security-Domain-Count-by-Threat-Level\" title=\"\" width=\"350px\"></fazchart></td></tr></tbody></table><div style=\"page-break-after: always\"><span style=\"display:none\"></span></div><h2><strong>Top Visited Domains by Count</strong></h2><fazchart mkey=\"dns-Top-Queried-Domain-Bar\" title=\"\" width=\"100%\"></fazchart><h2><strong>Top Visited Domain Categories by Count</strong></h2><fazchart mkey=\"dns-Security-Top-Visited-Domain-Categories\" title=\"\" width=\"100%\"></fazchart><h2><strong>Top Domain Visited by Device</strong></h2><fazchart mkey=\"dns-Security-FortiGate-with-Top-Domain-Visited-by_Source-IP\" title=\"\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\"></span></div><h2><strong>Top Domain Lookup Failures</strong></h2><fazchart mkey=\"dns-Security-Top-Domain-Lookup-Failure-by-Count\" title=\"\" width=\"100%\"></fazchart><h2><strong>Top 10 Source IP by Destination Count</strong></h2><fazchart mkey=\"dns-Security-Top-Source-IP-by-Destination-Count\" title=\"\" width=\"100%\"></fazchart><h2><strong>Top 10 Destination IP by Source Count</strong></h2><fazchart mkey=\"dns-Security-Top-Destination-IP-by-Source-Count\" title=\"\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\"></span></div><h2><strong>DNS High Risk Source IPs</strong></h2><fazchart mkey=\"dns-Security-Severity-by-High-Risk-Source-IPs-Count\" title=\"\" width=\"100%\"></fazchart><fazchart mkey=\"dns-Security-Top-DNS-High-Risk-Source-IP\" title=\"\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\"></span></div><h2><strong>Infected Domains by Source</strong></h2><fazchart mkey=\"dns-Security-Top-Infected-Domain-by-Count\" title=\"\" width=\"100%\"></fazchart><h2><strong>Blocked Domains</strong></h2><fazchart mkey=\"dns-Security-Top-Blocked-Domains-by-Reason\" title=\"\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\"></span></div><h2><strong>Top Users by Infected Domains</strong></h2><fazchart mkey=\"dns-Security-Top-Users-by-Infected-Domain-Visits\" title=\"\" width=\"100%\"></fazchart><fazchart mkey=\"dns-Security-Top-Users-and-Infected-Domain-by-Visit-Count\" title=\"\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\"></span></div><h2><strong>Users by Category Visited</strong></h2><fazchart mkey=\"dns-Security-Top-Users-by-Visited-Domain-Category-Count\" title=\"\" width=\"100%\"></fazchart><fazchart mkey=\"dns-Security-Top-Users-and-Visited-Domain-Category-by-Count\" title=\"\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\"></span></div><h2><strong>Newly Observed Domains</strong></h2><fazchart mkey=\"dns-Security-Top-Newly-Detected-Domain-by-Count\" title=\"\" width=\"100%\"></fazchart><fazchart mkey=\"dns-Security-Top-Newly-Detected-Domain-and-Source-IP-with-First-Seen-and-Last-Seen\" title=\"\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
            end
        set protected enable
    next
    edit 1000060045
        set is-template enable
        set category "Security"
        set title "Template - Web Usage Summary Report"
        set description "Present a brief summary report about web usage."
        set body "<div style=\"height:10px;\"></div><h2 style=\"font-family: Lato; font-size: 18px; color: black;\"> WEB USAGE SUMMARY</h2><table border=\"0\" cellspacing=\"5px\" cellpadding=\"0\" align=\"center\" style=\"font-family: Lato; padding-top:5px; width:100%\"><tbody><tr><td style=\"vertical-align: bottom; width: 28px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/web_requestes.png\" style=\"height:25px; width:25px;\"/></td><td style=\"vertical-align: bottom;\"><strong><span style=\"font-size:26px;\"><fazmacro mkey=\"web-Usage-Request-Count\"></fazmacro></span></strong><span style=\"font-size:18px;\"> Requests</span></td><td style=\"vertical-align: bottom; width: 28px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/web_applications.png\" style=\"height:25px; width:25px;\"/></td><td style=\"vertical-align: bottom;\"><strong><span style=\"font-size:26px;\"><fazmacro mkey=\"web-Usage-Application-Count\"></fazmacro></span></strong><span style=\"font-size:18px;\"> Applications</span></td><td style=\"vertical-align: bottom; width: 28px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/web_categories.png\" style=\"height:25px; width:25px;\"/></td><td style=\"vertical-align: bottom;\"><strong><span style=\"font-size:26px;\"><fazmacro mkey=\"web-Usage-Category-Count\"></fazmacro></span></strong><span style=\"font-size:18px;\"> Categories</span></td><td style=\"vertical-align: bottom; width: 27px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/web_users.png\" style=\"height:25px; width:25px;\"/></td><td style=\"vertical-align: bottom;\"><strong><span style=\"font-size:26px;\"><fazmacro mkey=\"web-Usage-User-Count\"></fazmacro></span></strong><span style=\"font-size:18px;\"> Users</span></td><td style=\"vertical-align: bottom; width: 28px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/web_malicious-sites.png\" style=\"height:25px; width:25px;\"/></td><td style=\"vertical-align: bottom;\"><strong><span style=\"font-size:26px;\"><fazmacro mkey=\"web-Usage-Malicious-Websites-Count\"></fazmacro></span></strong><span style=\"font-size:18px;\"> Malicious Sites</span></td></tr></tbody></table><div style=\"height:25px;\"></div><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\" style=\"font-family: Lato; width:100%\"><tbody><tr><td style=\"vertical-align:top; width: 350px;\"><fazchart mkey=\"web-Usage-Count-By-Allowed-Blocked\" title=\"Total Requests\" width=\"350px\"></fazchart></td><td style=\"vertical-align:top; width: 350px;\"><fazchart mkey=\"web-Usage-Top-Web-Users-By-Allowed-Requests\" title=\"Top 10 Users by Allowed Requests\" width=\"350px\"></fazchart></td><td style=\"vertical-align:top; width: 350px;\"><fazchart mkey=\"web-Usage-Top-Web-Users-By-Blocked-Requests\" title=\"Top 10 Users by Blocked Requests\" width=\"350px\"></fazchart></td></tr></tbody></table><div style=\"height:25px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"web-Usage-Request-Summary-Timeline\" title=\"Requests Summary\" width=\"1000px\"></fazchart></div><div style=\"height:20px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"web-Usage-Browsing-Time-Summary-Timeline\" title=\"Browsing Time Summary\" width=\"1000px\"></fazchart></div><div style=\"height:15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"web-Usage-Bandwidth-Timeline\" title=\"Bandwidth Summary\" width=\"1000px\"></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height:15px;\"></div><h2 style=\"font-family: Lato; font-size: 18px; color: black;\"> WEB ACTIVITY</h2><div style=\"font-family: Lato;\"><fazchart mkey=\"web-Usage-Top-Web-Users-By-Requests\" title=\"Top 10 Users by Requests\" width=\"1000px\"></fazchart></div><div style=\"height:20px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"web-Usage-Top-Web-Users-By-Requests-Timeline\" title=\"Top 10 Users over Time\" width=\"1000px\"></fazchart></div><div style=\"height:15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"web-Usage-Top-User-Category-By-Count\" title=\"Top 10 Users by Visited Categories\" width=\"1000px\"></fazchart></div><div style=\"font-family: Lato;\"><fazchart mkey=\"web-Usage-Top-Category-Sites-By-Session\" title=\"Top 10 Visited Categories by Sites\" width=\"1000px\"></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height:15px;\"></div><h2 style=\"font-family: Lato; font-size: 18px; color: black;\"> WEB BROWSING</h2><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\" style=\"font-family: Lato; width:100%\"><tbody><tr><td style=\"vertical-align:top\"><fazchart mkey=\"web-Usage-Top-User-Browsing-Time\" title=\"Top 10 Online Users by Browsing Time\" width=\"350px\"></fazchart></td><td style=\"vertical-align:top\"><fazchart mkey=\"web-Usage-Top-User-Category-by-Browsing-Time\" title=\"Top 10 Online Users by Categories\" width=\"650px\"></fazchart></td></tr></tbody></table><div style=\"height:15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"web-Usage-Top-Category-By-Website-Browsetime\" title=\"Top 10 Categories by Browsing Time\" width=\"1000px\"></fazchart></div><div style=\"height:15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"web-Usage-Top-Sites-By-Browsing-Time\" title=\"Top 20 Sites by Browsing Time\" width=\"1000px\"></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height:15px;\"></div><h2 style=\"font-family: Lato; font-size: 18px; color: black;\"> INTERNET BANDWIDTH USAGE</h2><div style=\"font-family: Lato;\"><fazchart mkey=\"web-Usage-Top-User-By-Bandwidth\" title=\"Top 10 Bandwidth Users\" width=\"1000px\"></fazchart></div><div style=\"height:20px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"web-Usage-Top-User-By-Bandwidth-Timeline\" title=\"Top 10 Bandwidth Users over Time\" width=\"1000px\"></fazchart></div><div style=\"height:10px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"web-Usage-Top-Category-Website-By-Bandwidth\" title=\"Top 10 Categories and Sites by Bandwidth\" width=\"1000px\"></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height:15px;\"></div><h2 style=\"font-family: Lato; font-size: 18px; color: black;\"> MOST BLOCKED</h2><div style=\"font-family: Lato;\"><fazchart mkey=\"web-Usage-Top-Blocked-User-Category-By-Request\" title=\"Top 5 Most Blocked Users and Visited Categories\" width=\"1000px\"></fazchart></div><div style=\"height:15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"web-Usage-Top-Web-Users-By-Blocked-Requests-Timeline\" title=\"Top 5 Most Blocked Users over Time\" width=\"1000px\"></fazchart></div><div style=\"height:15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"web-Usage-Top-Blocked-Web-Categories-by-Request\" title=\"Top 3 Most Blocked Categories by Sites\" width=\"1000px\"></fazchart></div>"
            config header
                edit 1
                    set type graphic
                    set graphic "header_webusage_bg.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
            end
        set report-tag "concise"
        set protected enable
    next
    edit 1000060046
        set is-template enable
        set category "Security"
        set title "Template - 360 Security Report"
        set description "Present a brief summary report about traffic, threat, app, user, incident, compromised host and so on."
        set body "<div style=\"height: 5px\"></div><h2><span style=\"font-family: Lato; font-size: 14pt; color: black\">USERS & DEVICES</span></h2><table border=\"0\" cellspacing=\"5px\" cellpadding=\"0\" align=\"center\" style=\"font-family: Lato; width:100%\"><tbody><tr><td style=\"vertical-align:top\"><fazchart mkey=\"360-security-Rating-Asset-Count-by-HWVendor\" title=\"Hardware Vendors\" width=\"330px\"></fazchart></td><td style=\"vertical-align:top\"><fazchart mkey=\"360-security-Rating-Asset-Count-by-HWOS-List\" title=\"Top 10 Software OS\" width=\"330px\"></fazchart></td><td style=\"vertical-align:top\"><fazchart mkey=\"360-security-Rating-Asset-Count-by-Interface\" title=\"Top 10 Interfaces\" width=\"330px\"></fazchart></td></tr></tbody></table><div style=\"height: 10px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"360-security-Rating-Asset-List-From-Fortinet\" title=\"Top 10 Assets from Fortinet by Session\" width=\"1000px\"></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height: 10px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"360-security-Rating-Asset-List-From-Other-Identified-Device\" title=\"Top 15 Assets from Other Vendors by Session\" width=\"1000px\"></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2><span style=\"font-family: Lato; font-size: 14pt; color: black\">SECURITY RATING</span></h2><div style=\"height: 10px;\"></div><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"font-family: Lato; border-collapse: collapse; width:100%;\"><tbody><tr><td style=\"width: 30px; vertical-align: top;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/security_posture.png\" style=\"width: 30px; height: 28px;\"></td><td style=\"width: 980px; vertical-align: top;\"><div style=\"font-size: 14px; background-color: lightgray;\"><span style=\"line-height: 2.0; display: inline-block; vertical-align: middle; padding-left: 15px; width: 110px;\"> Security Posture</span><span style=\"font-size: 12.25px; line-height: 2.0; display: inline-block; vertical-align: middle; padding-left: 10px; width: 600px;\"> Identity configuration weaknesses and best practice violations in deployment.</span></div></td></tr></tbody></table><table style=\"font-family: Lato; width: 100%; border: 1px solid lightgray; border-collapse: collapse; margin-top: -5px;\"><tbody><tr><td style=\"vertical-align:top; width: 400px; height: 168px;\"><fazchart mkey=\"360-security-Rating-Posture-Stats-Status-Count\" title=\"\" width=\"400px\"></fazchart></td><td style=\"vertical-align:top;\"><table style=\"border-spacing: 5px; width:100%;\"><tbody><tr><td colspan=\"2\"><div style=\"height: 10px;\"></div><span style=\"margin-top: 5px;\"> Score <strong><fazmacro mkey=\"360-security-Rating-Posture-Stats-Average-Total-Score\"></fazmacro></strong></span></td><td colspan=\"2\"><div style=\"height: 10px;\"></div><span style=\"margin-top: 5px; padding-right: 6px;\"> Overall Grade<div style=\"display: inline; position: relative; top: -1px;\"><fazmacro mkey=\"360-security-Rating-Posture-Stats-Average-Total-Grade\"></fazmacro></div></span></td></tr><tr><td colspan=\"4\"><span style=\"margin-top: 3px; margin-bottom: 2px;\">Grades</span></td></tr><tr style=\"font-size: 15px;\"><td style=\"width: 20px;\"><fazmacro mkey=\"360-security-Rating-Posture-fabricHardening-Avg-Grade\"></fazmacro></td><td style=\"width: 300px;\"><span style=\"font-size:13px; padding-left:3px\"> Fabric Security Hardening</span></td><td style=\"width: 20px;\"><fazmacro mkey=\"360-security-Rating-Posture-auditLoggingMonitoring-Avg-Grade\"></fazmacro></td><td style=\"width: 210px;\"><span style=\"font-size:13px; padding-left:3px\"> Audit Logging & Monitoring</span></td></tr><tr style=\"font-size: 15px;\"><td><fazmacro mkey=\"360-security-Rating-Posture-threatManagement-Avg-Grade\"></fazmacro></td><td><span style=\"font-size:13px; padding-left:3px\"> Threat & Vulnerability Management</span></td><td><fazmacro mkey=\"360-security-Rating-Posture-networkDesign-Avg-Grade\"></fazmacro></td><td><span style=\"font-size:13px; padding-left:3px\"> Network Design & Policies</span></td></tr><tr><td><fazmacro mkey=\"360-security-Rating-Posture-endpointManagement-Avg-Grade\"></fazmacro></td><td><span style=\"font-size:13px; padding-left:3px\"> Endpoint Management</span></td><td><fazmacro mkey=\"360-security-Rating-Posture-firmwareSubscriptions-Avg-Grade\"></fazmacro></td><td><span style=\"font-size:13px; padding-left:3px\"> Firmware & Subscription</span></td></tr></tbody></table></td></tr></tbody></table><div style=\"height: 15px;\"></div><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"font-family: Lato; border-collapse: collapse; width:100%;\"><tbody><tr><td style=\"width: 30px; vertical-align: top;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/security_fabric.png\" style=\"width: 30px; height: 28px;\"></td><td style=\"width: 980px; vertical-align: top;\"><div style=\"font-size: 14px; background-color: lightgray;\"><span style=\"line-height: 2.0; display: inline-block; vertical-align: middle; padding-left: 15px; width: 110px;\"> Fabric Coverage</span><span style=\"font-size: 12.25px; line-height: 2.0; display: inline-block; vertical-align: middle; padding-left: 10px; width: 600px;\"> Identity in the overall network, where Security Fabric can enhance visibility and control.</span></div></td></tr></tbody></table><table style=\"font-family: Lato; width: 100%; border: 1px solid lightgray; border-collapse: collapse; margin-top: -5px;\"><tbody><tr><td style=\"vertical-align:top; width: 400px; height: 168px;\"><fazchart mkey=\"360-security-Rating-Coverage-Stats-Status-Count\" title=\"\" width=\"400px\"></fazchart></td><td style=\"vertical-align:top;\"><table style=\"border-spacing: 5px; width:100%;\"><tbody><tr><td colspan=\"2\"><div style=\"height: 10px;\"></div><span style=\"margin-top: 5px;\"> Score <strong><fazmacro mkey=\"360-security-Rating-Coverage-Stats-Average-Total-Score\"></fazmacro></strong></span></td><td colspan=\"2\"><div style=\"height: 10px;\"></div><span style=\"margin-top: 5px; padding-right: 6px;\"> Overall Grade<div style=\"display: inline; position: relative; top: -1px;\"><fazmacro mkey=\"360-security-Rating-Coverage-Stats-Average-Total-Grade\"></fazmacro></div></span></td></tr><tr><td colspan=\"4\"><span style=\"margin-top: 3px; margin-bottom: 2px;\">Grades</span></td></tr><tr><td style=\"width: 20px;\"><fazmacro mkey=\"360-security-Rating-Coverage-firmwareSubscriptions-Avg-Grade\"></fazmacro></td><td style=\"width: 300px;\"><span style=\"font-size:13px; padding-left:3px\"> Firmware & Subscription</span></td><td style=\"width: 20px;\"><fazmacro mkey=\"360-security-Rating-Coverage-auditLoggingMonitoring-Avg-Grade\"></fazmacro></td><td style=\"width: 210px;\"><span style=\"font-size:13px; padding-left:3px\"> Audit Logging & Monitoring</span></td></tr><tr><td><fazmacro mkey=\"360-security-Rating-Coverage-threatManagement-Avg-Grade\"></fazmacro></td><td><span style=\"font-size:13px; padding-left:3px\"> Threat & Vulnerability Management</span></td><td><fazmacro mkey=\"360-security-Rating-Coverage-networkDesign-Avg-Grade\"></fazmacro></td><td><span style=\"font-size:13px; padding-left:3px\"> Network Design & Policies</span></td></tr></tbody></table></td></tr></tbody></table><div style=\"height: 15px;\"></div><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"font-family:Lato; border-collapse: collapse; width:100%;\"><tbody><tr><td style=\"width: 30px; vertical-align: top;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/security_optimization.png\" style=\"width: 30px; height: 28px;\"></td><td style=\"width: 980px; vertical-align: top;\"><div style=\"font-size: 14px; background-color: lightgray;\"><span style=\"line-height: 2.0; display: inline-block; vertical-align: middle; padding-left: 15px; width: 90px;\"> Optimization</span><span style=\"font-size: 12.25px; line-height: 2.0; display: inline-block; vertical-align: middle; padding-left: 10px; width: 600px;\"> Optimize fabric development.</span></div></td></tr></tbody></table><table style=\"font-family: Lato; width: 100%; border: 1px solid lightgray; border-collapse: collapse; margin-top: -5px;\"><tbody><tr><td style=\"vertical-align:top; width: 400px; height: 168px;\"><fazchart mkey=\"360-security-Rating-Optimize-Stats-Status-Count\" title=\"\" width=\"400px\"></fazchart></td><td style=\"vertical-align:top;\"><table style=\"border-spacing: 5px; width:100%;\"><tbody><tr><td colspan=\"2\"><div style=\"height: 10px;\"></div><span style=\"margin-top: 5px;\"> Score <strong><fazmacro mkey=\"360-security-Rating-Optimize-Stats-Average-Total-Score\"></fazmacro></strong></span></td><td colspan=\"2\"><div style=\"height: 10px;\"></div><span style=\"margin-top: 5px; padding-right: 6px;\"> Overall Grade<div style=\"display: inline; position: relative; top: -1px;\"><fazmacro mkey=\"360-security-Rating-Optimize-Stats-Average-Total-Grade\"></fazmacro></div></span></td></tr><tr><td colspan=\"4\"><span style=\"margin-top: 3px; margin-bottom: 2px;\">Grades</span></td></tr><tr><td style=\"width: 20px;\"><fazmacro mkey=\"360-security-Rating-Optimize-performanceOptimization-Avg-Grade\"></fazmacro></td><td style=\"width: 300px;\"><span style=\"font-size:13px; padding-left:3px\"> Performance Optimization</span></td><td style=\"width: 20px;\"><fazmacro mkey=\"360-security-Rating-Optimize-networkDesign-Avg-Grade\"></fazmacro></td><td style=\"width: 210px;\"><span style=\"font-size:13px; padding-left:3px\"> Network Design & Policies</span></td></tr><tr><td><fazmacro mkey=\"360-security-Rating-Optimize-firmwareSubscriptions-Avg-Grade\"></fazmacro></td><td><span style=\"font-size:13px; padding-left:3px\"> Firmware & Subscription</span></td><td></td><td></td></tr></tbody></table></td></tr></tbody></table><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height: 15px;\"></div><h2><span style=\"font-family: Lato; font-size: 14pt; color: black\">WiFi</span></h2><table border=\"0\" cellspacing=\"5px\" cellpadding=\"0\" align=\"center\" style=\"font-family: Lato; width:100%\"><tbody><tr><td style=\"vertical-align:top\"><fazchart mkey=\"360-security-wifi-AP-WaitingAuth-Online-Offline-Count\" title=\"FortiAP Status\" width=\"330px\"></fazchart></td><td style=\"vertical-align:top\"><fazchart mkey=\"360-security-wifi-Top-AP-By-Client\" title=\"Channel Utillization\" width=\"330px\"></fazchart></td><td style=\"vertical-align:top\"><fazchart mkey=\"360-security-wifi-Signal-By-Client\" title=\"Clients By FortiAP\" width=\"330px\"></fazchart></td></tr></tbody></table><div style=\"height: 15px;\"></div><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\" style=\"font-family: Lato; width:100%\"><tbody><tr><td style=\"vertical-align:top\"><fazchart mkey=\"360-security-wifi-WiFi-Client-Number-Timeline\" title=\"WiFi Clients\" width=\"650px\"></fazchart></td><td style=\"vertical-align:top\"><fazchart mkey=\"360-security-wifi-Auth-Failure-Event\" title=\"Login Failures\" width=\"350px\"></fazchart></td></tr></tbody></table><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\" style=\"font-family: Lato; width:100%\"><tbody><tr><td style=\"vertical-align:top\"><fazchart mkey=\"360-security-Policy-by-Bandwidth\" title=\"Top 10 Policy by Bandwidth\" width=\"500px\"></fazchart></td><td style=\"vertical-align:top\"><fazchart mkey=\"360-security-Policy-by-Session\" title=\"Top 10 Policy by Session\" width=\"500px\"></fazchart></td></tr></tbody></table><div style=\"height: 20px;\"></div><p></p><div style=\"font-family: Lato;\"><fazchart mkey=\"360-security-Top-Policy-Bandwidth-Timeline\" title=\"Top Policy Bandwidth Timeline\" width=\"1000px\"></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"font-family: Lato;\"><fazchart mkey=\"360-security-Policy-Details\" title=\"Top 10 Policy Details\" width=\"1000px\"></fazchart></div><div style=\"height: 15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"360-security-Top-Source-Session-Timeline\" title=\"Top Source Session Timeline\" width=\"1000px\"></fazchart></div><div style=\"height: 15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"360-security-Top-Destination-Bandwidth-Timeline\" title=\"Top Destination Bandwidth Timeline\" width=\"1000px\"></fazchart></div><div style=\"height: 15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"360-security-Top-Source-Details\" title=\"Top Source Details\" width=\"1000px\"></fazchart></div><div style=\"height: 15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"360-security-Top-Destination-Details\" title=\"Top Destination Details\" width=\"1000px\"></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height: 15px;\"></div><h2><span style=\"font-family: Lato; font-size: 18px; color: black\">APPLICATION VISIBILITY AND THREATS</span></h2><table border=\"0\" cellspacing=\"5px\" cellpadding=\"0\" align=\"center\" style=\"padding-top:10px; padding-left: 15px; width:100%\"><tbody><tr><td style=\"vertical-align: bottom; width: 28px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/web_applications.png\" style=\"height:25px; width:25px;\"/></td><td style=\"vertical-align: bottom;\"><strong><span style=\"font-size:26px;\"><fazmacro mkey=\"360-security-App-Visibility-Control-Total-Count\"></fazmacro></span></strong><span style=\"font-size:18px;\"> Applications</span></td> <td style=\"vertical-align: bottom; width: 28px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/web_malware.png\" style=\"height:25px; width:25px;\"/></td><td style=\"vertical-align: bottom;\"><strong><span style=\"font-size:26px;\"><fazmacro mkey=\"360-security-Total-Malware-Detected\"></fazmacro></span></strong><span style=\"font-size:18px;\"> Malwares</span></td><td style=\"vertical-align: bottom; width: 28px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/web_incidents.png\" style=\"height:25px; width:25px;\"/></td><td style=\"vertical-align: bottom;\"><strong><span style=\"font-size:26px;\"><fazmacro mkey=\"360-security-Incidents-Total-Count\"></fazmacro></span></strong><span style=\"font-size:18px;\"> Incidents</span></td><td style=\"vertical-align: bottom; width: 28px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/web_endpoints.png\" style=\"height:25px; width:25px;\"/></td><td style=\"vertical-align: bottom;\"><strong><span style=\"font-size:26px;\"><fazmacro mkey=\"360-security-Rating-Asset-Endpoint-Total-Count\"></fazmacro></span></strong><span style=\"font-size:18px;\"> Endpoints</span></td></tr></tbody></table><div style=\"height: 40px;\"></div><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\" style=\"font-family: Lato; width:100%\"><tbody><tr><td style=\"vertical-align:top\"><fazchart mkey=\"360-degree-security-Application-Visiblity-and-Control-Summary\" title=\"Application Visibility and Control\" width=\"490px\"></fazchart></td><td style=\"vertical-align:top\"><fazchart mkey=\"360-degree-security-Threats-Detection-and-Prevention-Summary\" title=\"Threat Detection and Prevention\" width=\"490px\"></fazchart></td></tr><tr><td style=\"height: 10px;\"></td><td></td></tr><tr><td style=\"vertical-align:top\"><fazchart mkey=\"360-degree-security-Data-Exfiltration-Detection-and-Prevention-Summary\" title=\"Data Exfiltration Detection and Prevention\" width=\"490px\"></fazchart></td><td style=\"vertical-align:top\"><fazchart mkey=\"360-degree-security-Endpoint-Protection-Summary\" title=\"Endpoint Protection\" width=\"490px\"></fazchart></td></tr></tbody></table><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height: 5px;\"></div><h2><span style=\"font-family: Lato; font-size: 14pt; color: black\">APPLICATION VISIBILITY AND CONTROL</span></h2><div style=\"height: 10px;\"></div><table border=\"0\" cellspacing=\"5\" cellpadding=\"0\" align=\"center\" style=\"font-family: Lato; width:100%\"><tbody><tr><td style=\"width: 180px; vertical-align:top;\"><div style=\"width: 180px; height: 205px; border: 2px solid lightgray; border-radius: 10px;\"><div style=\"padding-top: 10px; padding-left: 8px; padding-right: 5px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/app_risk_5.png\" style=\"height:20px; width:20px;\"/><span style=\"font-family: Lato; font-size: 10.5pt; color: black; padding-left: 8px; position: relative; bottom: 5px;\">SEVERE</span></div><div style=\"padding-top: 2px; padding-left: 8px; padding-right: 5px; font-size: 10pt;\"><span > Malicious applications or the applications that can bypass security.</span></div><div style=\"padding-top: 10px; padding-left: 8px; padding-right: 5px; font-size: 10pt;\"><span style=\"color: gray;\"> Examples:</span></div><div style=\"padding-top: 1px; padding-left: 8px; padding-right: 5px; font-size: 10pt;\"><span style=\"color: black;\"> Botnet, Proxy</span></div></div></td><td style=\"width: 180px; vertical-align:top;\"><div style=\"width: 180px; height: 205px; border: 2px solid lightgray; border-radius: 10px;\"><div style=\"padding-top: 10px; padding-left: 8px; padding-right: 5px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/app_risk_4.png\" style=\"height:20px; width:20px;\"/><span style=\"font-family: Lato; font-size: 10.5pt; color: black; padding-left: 8px; position: relative; bottom: 5px;\">HIGH</span></div><div style=\"padding-top: 2px; padding-left: 8px; padding-right: 5px; font-size: 10pt;\"><span > Applications that can cause malware infection or data leakage: often these applications are used for personal file-sharing or tunnelling other apps.</span></div><div style=\"padding-top: 10px; padding-left: 8px; padding-right: 5px; font-size: 10pt;\"><span style=\"color: gray;\"> Examples:</span></div><div style=\"padding-top: 1px; padding-left: 8px; padding-right: 5px; font-size: 10pt;\"><span style=\"color: black;\"> P2P, Remote.Access</span></div></div></td><td style=\"width: 180px; vertical-align:top;\"><div style=\"width: 180px; height: 205px; border: 2px solid lightgray; border-radius: 10px;\"><div style=\"padding-top: 10px; padding-left: 8px; padding-right: 5px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/app_risk_3.png\" style=\"height:20px; width:20px;\"/><span style=\"font-family: Lato; font-size: 10.5pt; color: black; padding-left: 8px; position: relative; bottom: 5px;\">ELEVATED</span></div><div style=\"padding-top: 2px; padding-left: 8px; padding-right: 5px; font-size: 10pt;\"><span > Applications are used for personal communication or have known vulnerabilities.</span></div><div style=\"padding-top: 10px; padding-left: 8px; padding-right: 5px; font-size: 10pt;\"><span style=\"color: gray;\"> Examples:</span></div><div style=\"padding-top: 1px; padding-left: 8px; padding-right: 5px; font-size: 10pt;\"><span style=\"color: black;\"> IM, Email, Storage.Backup</span></div></div></td><td style=\"width: 180px; vertical-align:top;\"><div style=\"width: 180px; height: 205px; border: 2px solid lightgray; border-radius: 10px;\"><div style=\"padding-top: 10px; padding-left: 8px; padding-right: 5px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/app_risk_2.png\" style=\"height:20px; width:20px;\"/><span style=\"font-family: Lato; font-size: 10.5pt; color: black; padding-left: 8px; position: relative; bottom: 5px;\">GUARDED</span></div><div style=\"padding-top: 2px; padding-left: 8px; padding-right: 5px; font-size: 10pt;\"><span > Applications consume bandwidth or affect productivity.</span></div><div style=\"padding-top: 10px; padding-left: 8px; padding-right: 5px; font-size: 10pt;\"><span style=\"color: gray;\"> Examples:</span></div><div style=\"padding-top: 1px; padding-left: 8px; padding-right: 5px; font-size: 10pt;\"><span style=\"color: black;\"> Game, Social.Media, Video or Audio apps</span></div></div></td><td style=\"width: 180px; vertical-align:top;\"><div style=\"width: 180px; height: 205px; border: 2px solid lightgray; border-radius: 10px;\"><div style=\"padding-top: 10px; padding-left: 8px; padding-right: 5px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/app_risk_1.png\" style=\"height:20px; width:20px;\"/><span style=\"font-family: Lato; font-size: 10.5pt; color: black; padding-left: 8px; position: relative; bottom: 5px;\">LOW</span></div><div style=\"padding-top: 2px; padding-left: 8px; padding-right: 5px; font-size: 10pt;\"><span > Business applications or software update applications.</span></div><div style=\"padding-top: 10px; padding-left: 8px; padding-right: 5px; font-size: 10pt;\"><span style=\"color: gray;\"> Examples:</span></div><div style=\"padding-top: 1px; padding-left: 8px; padding-right: 5px; font-size: 10pt;\"><span style=\"color: black;\"> Update or Business apps</span></div></div></td></tr></tbody></table><div style=\"height: 5px;\"></div><p></p><div style=\"font-family: Lato;\"><fazchart mkey=\"360-security-Applications-By-Bandwidth\" title=\"Top 10 High Risk Applications\" width=\"1000px\"></fazchart></div><div style=\"height: 15px;\"></div><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\" style=\"font-family: Lato; width:100%\"><tbody><tr><td style=\"vertical-align:top\"><fazchart mkey=\"360-security-High-Risk-Application-By-Category\" title=\"Breakdown of High Risk Apps by Category\" width=\"490px\"></fazchart></td><td style=\"vertical-align:top\"><fazchart mkey=\"360-security-Apprisk-Ctrl-High-Risk-Application-Behavioral\" title=\"Behavioural Characteristics of Hight Risk Apps\" width=\"490px\"></fazchart></td></tr></tbody></table><div style=\"height: 15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"360-security-Top10-App-Category-Group-By-Bandwidth\" title=\"Top 10 App Categories by Bandwidth\" width=\"1000px\"></fazchart></div><div style=\"font-family: Lato;\"><fazchart mkey=\"360-security-Top-Web-Categories-Visited\" title=\"Top 10 Web Categories by Visited\" width=\"1000px\"></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><!-- <div style=\"height: 5px;\"></div> --><!-- <h2><span style=\"font-family: Lato; font-size: 14pt; color: black\">THREAT DETECTION AND PREVENTION</span></h2> --><div style=\"font-family: Lato;\"><fazchart mkey=\"360-security-Top5-Malware-Virus-Botnet-Spyware\" title=\"Top 5 Viruses, Bots, Spyware or Adware, Phishing Sites\" width=\"1000px\"></fazchart></div><!-- <div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div> --><div style=\"height: 15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"360-security-Top5-Victims-of-Malware\" title=\"Top 5 Victims of Malware\" width=\"1000px\"></fazchart></div><!-- <div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div> --><div style=\"height: 15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"360-security-Top5-Victims-of-Phishing-Site\" title=\"Top 5 Victims of Phishing Sites\" width=\"1000px\"></fazchart></div><!-- <div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div> --><div style=\"height: 15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"360-security-Top5-Malicious-Phishing-Sites\" title=\"Top 5 Malicious Phishing Sites\" width=\"1000px\"></fazchart></div><!-- <div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div> --><div style=\"height: 15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"360-security-Application-Vulnerability\" title=\"Application Vulnerabilities\" width=\"1000px\"></fazchart></div><!-- <div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div> --><div style=\"height: 15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"360-security-Files-Analyzed-By-FortiCloud-Sandbox\" title=\"Summary of the files analyzed by FortiCloud Sandbox\" width=\"1000px\"></fazchart></div><!-- <div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div> --><div style=\"height: 15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"360-security-Apprisk-Ctrl-Malicious-Files-Detected-By-FortiCloud-Sandbox\" title=\"Examples of the malicious files detected by FortiCloud Sandbox\" width=\"1000px\"></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height: 15px;\"></div><h2><span style=\"font-family: Lato; font-size: 14pt; color: black\">DATA EXFILTRATION DETECTION AND PREVENTION</span></h2><div style=\"height: 15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"360-security-Data-Loss-Incidents-By-Severity\" title=\"Data Loss Incidents Summary by Severity\" width=\"1000px\"></fazchart></div><div style=\"height: 15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"360-security-Data-Loss-Files-By-Service\" title=\"Most Common Files with Service Type\" width=\"1000px\"></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height: 15px;\"></div><h2><span style=\"font-family: Lato; font-size: 14pt; color: black\">ENDPOINT DETECTION AND PREVENTION</span></h2><div style=\"height: 15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"360-security-Endpoint-Security-Events-Summary\" title=\"Security Events Summary\" width=\"1000px\"></fazchart></div><div style=\"height: 15px;\"></div><div style=\"font-family: Lato;\"><fazchart mkey=\"360-security-Top-Endpoing-Running-High-Risk-Application\" title=\"Endpoints Running High Risk Applications\" width=\"1000px\"></fazchart></div>"
            config header
                edit 1
                    set type graphic
                    set graphic "header_webusage_bg.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90101
                next
            end
        set report-tag "concise"
        set protected enable
    next
end

config sql-report layout-folder
    edit 99999
        set folder-name "Default Templates"
        set protected enable
    next

    edit 90100
        set folder-name "Fabric Reports Templates"
        set parent-id 99999
        set protected enable
    next

    edit 90101
        set folder-name "FortiGate Reports Templates"
        set parent-id 99999
        set protected enable
    next

    edit 90200
        set folder-name "Application Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90201
        set folder-name "Network Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90202
        set folder-name "Asset and User Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90203
        set folder-name "SOC Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90204
        set folder-name "Compliance Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90205
        set folder-name "Outbreak Alert Reports Templates"
        set parent-id 99999
        set protected enable
    next
end

config sql-report schedule
    edit "1000050004"
         set is-template enable
         set description "VPN Report"
         set status disable
         set include-coverpage disable
         set display-table-contents disable
         set output-format pdf
         set schedule-color "#5484ED"
         set resolve-hostname disable
         set device-list-type none
         set orientation landscape
         config report-layout
             edit 1000050004
             next
         end
         config devices
            edit All_FortiGate
            next
         end
    next
    edit "1000060002"
         set is-template enable
         set description "Bandwidth and Applications Report"
         set status disable
         set include-coverpage disable
         set display-table-contents disable
         set output-format pdf
         set schedule-color "#5484ED"
         set resolve-hostname disable
         set device-list-type none
         set orientation landscape
         config report-layout
             edit 1000060002
             next
         end
         config devices
            edit All_FortiGate
            next
         end
    next
    edit "1000060012"
         set is-template enable
         set description "Websites Report"
         set schedule-type every-n-weeks
         set schedule-frequency 1
         set schedule-valid-start 00:00 2012/10/01
         set time-period last-7-days
         set display-table-contents enable
         set output-format pdf
         set schedule-color "#5484ED"
         set filter-type user
         set resolve-hostname disable
         config report-layout
             edit 1000060012
             next
         end

         config devices
            edit All_FortiGate
            next
         end
    next

    edit "1000060017"
         set is-template enable
         set description "Websites Report"
         set schedule-type every-n-weeks
         set schedule-frequency 1
         set schedule-valid-start 00:00 2012/10/01
         set time-period last-7-days
         set display-table-contents enable
         set output-format pdf
         set schedule-color "#5484ED"
         set filter-type user
         set resolve-hostname disable
         config report-layout
             edit 1000060017
             next
         end

         config devices
            edit All_FortiGate
            next
         end
    next

    edit "1000060018"
         set is-template enable
         set description "Websites Report"
         set schedule-type every-n-weeks
         set schedule-frequency 1
         set schedule-valid-start 00:00 2012/10/01
         set time-period last-7-days
         set display-table-contents enable
         set output-format pdf
         set schedule-color "#5484ED"
         set filter-type user
         set resolve-hostname disable
         config report-layout
             edit 1000060018
             next
         end

         config devices
            edit All_FortiGate
            next
         end
    next

    edit "1000060019"
         set is-template enable
         set description "Application Risk and Control Report"
         set status disable
         set include-coverpage disable
         set display-table-contents disable
         set output-format pdf
         set schedule-color "#5484ED"
         set resolve-hostname disable
         set device-list-type none
         set orientation landscape
         config report-layout
             edit 1000060019
             next
         end
         config devices
            edit All_FortiGate
            next
         end
    next

    edit "1000060025"
         set is-template enable
         set description "Cyber Threat Assessment"
         set schedule-type every-n-weeks
         set schedule-frequency 1
         set schedule-valid-start 03:00 2012/10/01
         set time-period last-7-days
         set display-table-contents enable
         set output-format pdf
         set schedule-color "#5484ED"
         set resolve-hostname disable
         config report-layout
             edit 1000060025
             next
         end

         config devices
            edit All_FortiGate
            next
         end
    next

    edit "1000060031"
         set is-template enable
         set description "High Bandwidth Application Usage Report"
         set status disable
         set include-coverpage disable
         set display-table-contents disable
         set output-format pdf
         set schedule-color "#5484ED"
         set resolve-hostname disable
         set device-list-type none
         set orientation landscape
         config report-layout
             edit 1000060031
             next
         end
         config devices
            edit All_FortiGate
            next
         end
    next

    edit "1000060035"
         set is-template enable
         set description "Cyber-Bullying Indicators Report"
         set status disable
         set include-coverpage disable
         set display-table-contents disable
         set output-format pdf
         set schedule-color "#5484ED"
         set resolve-hostname disable
         set device-list-type none
         set orientation landscape
         config report-layout
             edit 1000060035
             next
         end
         config devices
            edit All_FortiGate
            next
         end
    next
    edit "1000060037"
         set is-template enable
         set description "Secure SD-WAN Report"
         set schedule-type every-n-weeks
         set schedule-frequency 1
         set schedule-valid-start 03:00 2012/10/01
         set time-period last-7-days
         set display-table-contents enable
         set output-format pdf
         set schedule-color "#5484ED"
         set resolve-hostname disable
         config report-layout
             edit 1000060037
             next
         end

         config devices
            edit All_FortiGate
            next
         end
    next
    edit "1000060038"
         set is-template enable
         set description "Self-Harm and Risk Indicators Report"
         set status disable
         set include-coverpage disable
         set display-table-contents disable
         set output-format pdf
         set schedule-color "#5484ED"
         set resolve-hostname disable
         set device-list-type none
         set orientation landscape
         config report-layout
             edit 1000060038
             next
         end
         config devices
            edit All_FortiGate
            next
         end
    next
    edit "1000060039"
         set is-template enable
         set description "SOC Incident Report"
         set status disable
         set resolve-hostname disable
         set include-coverpage disable
         set display-table-contents disable
         set output-format pdf
         set schedule-color "#5484ED"
         set resolve-hostname disable
         set device-list-type none
         config report-layout
             edit 1000060039
             next
         end
         config devices
            edit All_FortiGate
            next
         end
    next
    edit "1000060041"
         set is-template enable
         set description "Throughput Utilization Billing Report"
         set status disable
         set resolve-hostname disable
         set include-coverpage enable
         set display-table-contents disable
         set output-format pdf
         set schedule-color "#5484ED"
         set resolve-hostname disable
         set device-list-type detailed
         config report-layout
             edit 1000060041
             next
         end
         config devices
            edit All_FortiGate
            next
         end
    next
    edit "1000060042"
         set is-template enable
         set description "Daily Summary Report"
         set schedule-type every-n-days
         set schedule-frequency 1
         set schedule-valid-start 03:00 2021/03/01
         set time-period yesterday
         set status enable
         set include-coverpage disable
         set display-table-contents disable
         set output-format pdf
         set schedule-color "#5484ED"
         set resolve-hostname disable
         set device-list-type none
         set auto-hcache enable
         set orientation landscape
         config report-layout
             edit 1000060042
             next
         end
         config devices
            edit All_FortiGate
            next
         end
    next
    edit "1000060043"
         set is-template enable
         set description "Asset and Identity Report"
         set status disable
         set include-coverpage disable
         set display-table-contents disable
         set output-format pdf
         set schedule-color "#5484ED"
         set resolve-hostname disable
         set device-list-type none
         set auto-hcache disable
         config report-layout
             edit 1000060043
             next
         end
         config devices
            edit All_FortiGate
            next
         end
    next
    edit "1000060045"
         set is-template enable
         set description "Web Usage Summary Report"
         set status disable
         set include-coverpage disable
         set display-table-contents disable
         set output-format pdf
         set schedule-color "#5484ED"
         set resolve-hostname disable
         set device-list-type none
         set auto-hcache disable
         set orientation landscape
         config report-layout
             edit 1000060045
             next
         end
         config devices
            edit All_FortiGate
            next
         end
    next
    edit "1000060046"
         set is-template enable
         set description "360 Security Report"
         set status disable
         set include-coverpage disable
         set display-table-contents disable
         set output-format pdf
         set schedule-color "#5484ED"
         set resolve-hostname disable
         set device-list-type none
         set auto-hcache disable
         set orientation landscape
         config report-layout
             edit 1000060046
             next
         end
         config devices
            edit All_FortiGate
            next
         end
    next
end
config sql-report schedule
    edit "1000060034"
         set is-template enable
         set description "360 Protection Report"
         set schedule-type every-n-weeks
         set schedule-frequency 1
         set schedule-valid-start 03:00 2012/10/01
         set time-period last-7-days
         set display-table-contents enable
         set output-format pdf
         set schedule-color "#5484ED"
         set resolve-hostname disable
         set status enable
         set auto-hcache enable
         config report-layout
             edit 1000060034
             next
         end

         config devices
            edit All_FortiGate
            next
         end
    next
end
config alert data-selector
    edit 10046
        set selector-id "10046"
        set name "Default Intrusion Selector For Malicious Code Detection"
        set device-specify all-devices
        set protected enable
        config device
            edit 1
                set name "All_FortiGates"
                set type all-devices
            next
        end
        config rule
            edit 1
                set name "Intrusion"
                set devtype FortiGate
                set logtype "ips"
                set filter-relation 0
                set filter-expr "attack!~Botnet and logid~041901638[4-6]"
            next
        end
    next
    edit 10047
        set selector-id "10047"
        set name "Default Malicious File Selector For Malicious File Detection"
        set device-specify all-devices
        set protected enable
        config device
            edit 1
                set name "All_FortiGates"
                set type all-devices
            next
        end
        config rule
            edit 1
                set name "Malicious_File"
                set devtype FortiGate
                set logtype "virus"
                set filter-relation 0
                set filter-expr "logid~021100819[2-5]"
            next
        end
    next
    edit 10050
        set selector-id "10050"
        set name "Default Risky App Selector For Risky App Detection"
        set device-specify all-devices
        set protected enable
        config device
            edit 1
                set name "All_FortiGates"
                set type all-devices
            next
        end
        config rule
            edit 1
                set name "Risky_App"
                set devtype FortiGate
                set logtype "app-ctrl"
                set filter-relation 0
                set filter-expr "apprisk~\"critical|high\""
            next
        end
    next
    edit 30015
        set selector-id "30015"
        set name "Default IP Scanning Selector For Recon Activity Detection"
        set device-specify all-devices
        set protected enable
        config device
            edit 1
                set name "All_FortiGates"
                set type all-devices
            next
        end
        config rule
            edit 1
                set name "IP_scanning"
                set devtype FortiGate
                set logtype "traffic"
                set filter-relation 0
                set filter-expr "(action~\"client-rst|timeout|deny\") and srcintfrole!=wan and dstintfrole!=wan"
            next
        end
    next
end

config alert basic-handler
    edit 10041
        set name "Default-Botnet-Communication-Detection-By-Endpoint"
        set description "Default event handler to detect botnet communication in network grouped by endpoint"
        config rule
            edit 1
                set name "Traffic to Botnet CnC blocked in virus log"
                set devtype FortiGate
                set severity high
                set logtype "virus"
                set extrainfo "C&C: ${dstip}:${dstport}, Reference: ${ref}"
                set extrainfo-type custom
                set subject "Traffic to Botnet C&C $groupby2 blocked"
                set groupby1 "endpoint"
                set groupby2 "virus"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Botnet,IP,C&C"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0202009248"
            next
            edit 2
                set name "Traffic to Botnet CnC detected in virus log"
                set devtype FortiGate
                set severity critical
                set logtype "virus"
                set extrainfo "C&C: ${dstip}:${dstport}, Reference: ${ref}"
                set extrainfo-type custom
                set subject "Traffic to Botnet C&C $groupby2 detected"
                set groupby1 "endpoint"
                set groupby2 "virus"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Botnet,IP,C&C"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0202009249"
            next
            edit 3
                set name "DNS traffic to Botnet CnC blocked"
                set devtype FortiGate
                set severity high
                set logtype "dns"
                set extrainfo "Traffic path: ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "DNS traffic to Botnet C&C $groupby2 blocked"
                set groupby1 "endpoint"
                set groupby2 "qname"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Botnet,Domain,C&C"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==1501054601 OR logid==1501054600"
            next
            edit 4
                set name "Traffic to Botnet CnC detected in ips log 1"
                set devtype FortiGate
                set severity critical
                set logtype "ips"
                set extrainfo "C&C: ${dstip}:${dstport}, Traffic path: ${devname} (Policy ID:${policyid})\\${dstintf}, Reference: ${ref}"
                set extrainfo-type custom
                set subject "Traffic to Botnet C&C $groupby2 detected"
                set groupby1 "endpoint"
                set groupby2 "attack"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Botnet,Signature,C&C"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "attack ~ Botnet and direction=incoming and (action=='detected' or action=='pass session')"
            next
            edit 5
                set name "Traffic to Botnet CnC blocked in ips log 1"
                set devtype FortiGate
                set severity high
                set logtype "ips"
                set extrainfo "C&C: ${dstip}:${dstport}, Traffic path: ${devname} (Policy ID:${policyid})\\${dstintf}, Reference: ${ref}"
                set extrainfo-type custom
                set subject "Traffic to Botnet C&C $groupby2 blocked"
                set groupby1 "endpoint"
                set groupby2 "attack"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Botnet,Signature,C&C"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "attack ~ Botnet and direction=incoming and action!='detected' and action!='pass session'"
            next
            edit 6
                set name "Traffic from Botnet CnC detected in ips log"
                set devtype FortiGate
                set severity critical
                set logtype "ips"
                set extrainfo "C&C: ${srcip}:${srcport}, Traffic path: ${devname} (Policy ID:${policyid})\\${srcintf}, Reference: ${ref}"
                set extrainfo-type custom
                set subject "Traffic from Botnet C&C $groupby2 detected"
                set groupby1 "dstendpoint"
                set groupby2 "attack"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Botnet,Signature,C&C"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "attack ~ Botnet and direction=outgoing and (action=='detected' or action=='pass session')"
            next
            edit 7
                set name "Traffic from Botnet CnC blocked in ips log"
                set devtype FortiGate
                set severity high
                set logtype "ips"
                set extrainfo "C&C: ${srcip}:${srcport}, Traffic path: ${devname} (Policy ID:${policyid})\\${srcintf}, Reference: ${ref}"
                set extrainfo-type custom
                set subject "Traffic from Botnet C&C $groupby2 blocked"
                set groupby1 "dstendpoint"
                set groupby2 "attack"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Botnet,Signature,C&C"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "attack ~ Botnet and direction=outgoing and action!='detected' and action!='pass session'"
            next
            edit 8
                set name "Traffic to Botnet CnC blocked in ips log 2"
                set devtype FortiGate
                set severity high
                set logtype "ips"
                set extrainfo "C&C: ${dstip}:${dstport}, Reference: ${ref}"
                set extrainfo-type custom
                set subject "Traffic to Botnet CnC $groupby2 blocked"
                set groupby1 "endpoint"
                set groupby2 "attack"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Botnet,IP,C&C"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0422016400"
            next
            edit 9
                set name "Traffic to Botnet CnC detected in ips log 2"
                set devtype FortiGate
                set severity critical
                set logtype "ips"
                set extrainfo "C&C: ${dstip}:${dstport}, Reference: ${ref}"
                set extrainfo-type custom
                set subject "Traffic to Botnet CnC $groupby2 detected"
                set groupby1 "endpoint"
                set groupby2 "attack"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Botnet,IP,C&C"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0422016401"
            next
        end
        set enable enable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 10042
        set name "Default-Sandbox-Detections-By-Endpoint"
        set description "Default handler to track file submission and Malware detection by FortiSandbox grouped by endpoint"
        config rule
            edit 1
                set name "Malware detected"
                set devtype FortiGate
                set severity critical
                set logtype "virus"
                set extrainfo "Malware:${virus} with severity:${crlevel} found in file:${filename} from ${dstip}:${dstport}, Reference: ${ref}"
                set extrainfo-type custom
                set subject "Malware $groupby2 detected"
                set groupby1 "endpoint"
                set groupby2 "virus"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Sandbox,Signature,Malware"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0211009235 or logid==0211009237"
            next
            edit 2
                set name "Malware blocked"
                set devtype FortiGate
                set severity critical
                set logtype "virus"
                set extrainfo "Malware:${virus} with severity:${crlevel} found in file:${filename} from ${dstip}:${dstport}, Reference: ${ref}"
                set extrainfo-type custom
                set subject "Malware $groupby2 blocked"
                set groupby1 "endpoint"
                set groupby2 "virus"
                set eventstatus "mitigated"
                set tags "Default,By_Endpoint,Sandbox,Signature,Malware"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0211009234 or logid==0211009236"
            next
            edit 3
                set name "Sandbox detected Malware"
                set devtype FortiGate
                set severity critical
                set logtype "virus"
                set extrainfo "File:${filename}, Traffic path: ${dstintf}(Policy:${policyid})\\${dstip}:${dstport}, Checksum:${analyticscksum}"
                set extrainfo-type custom
                set subject "Sandbox detected Malware"
                set groupby1 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Sandbox,Malware"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0201009238 and fsaverdict==malicious"
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 10043
        set name "Default-Compromised Host-Detection-IOC-By-Endpoint"
        set description "Default event handler to detect compromised hosts by FortiAnalyzer IOC feature grouped by endpoint"
        config rule
            edit 1
                set name "Traffic to CnC detected"
                set devtype FortiGate
                set severity critical
                set logtype "traffic"
                set extrainfo "${tdtype}: ${dstip} :${dstport}, Traffic path: ${devname} (Policy ID:${policyid})\\${dstintf}"
                set extrainfo-type custom
                set subject "Compromised host detected"
                set groupby1 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Endpoint,IP,C&C,Ioc_Rescan"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "tdtype~infected"
            next
            edit 2
                set name "Web traffic to CnC detected"
                set devtype FortiGate
                set severity critical
                set logtype "webfilter"
                set extrainfo "${tdtype}: ${hostname}, Traffic path: ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "Compromised host detected"
                set groupby1 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Endpoint,C&C,URL,Ioc_Rescan"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "tdtype~infected"
            next
            edit 3
                set name "DNS trafic to CnC detected"
                set devtype FortiGate
                set severity critical
                set logtype "dns"
                set extrainfo "${tdtype}: ${qname}, Traffic path: ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "Compromised host detected"
                set groupby1 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Endpoint,C&C,Domain,Ioc_Rescan"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "tdtype~infected"
            next
        end
        set enable enable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 10044
        set name "Default-Risky-Destination-Detection-By-Endpoint"
        set description "Default event handler to detect network traffic to malicious or suspicious destinations grouped by endpoint"
        config rule
            edit 1
                set name "Web request to malicious destination blocked"
                set devtype FortiGate
                set severity medium
                set logtype "webfilter"
                set extrainfo "Domain:${hostname}, Referrer:${referralurl}, ${devname} (Policy ID:${policyid})\\${dstintf}"
                set extrainfo-type custom
                set subject "Web request to $groupby2 blocked"
                set groupby1 "endpoint"
                set groupby2 "catdesc"
                set eventstatus "mitigated"
                set tags "Default,By_Endpoint,Risky,URL"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "action"
                        set value "blocked"
                        set oper equal
                    next
                end
                set filter-expr "(catdesc=='Malicious Websites' or catdesc=='Phishing' or catdesc=='Spam URLs' or catdesc=='Newly Observed Domain' or catdesc=='Newly Registered Domain' or catdesc~'Dynamic DNS' or catdesc=='Proxy Avoidance' or catdesc=='Unrated')"
            next
            edit 2
                set name "Web request to malicious destination detected"
                set devtype FortiGate
                set severity high
                set logtype "webfilter"
                set extrainfo "Domain:${hostname}, Referrer:${referralurl}, ${devname} (Policy ID:${policyid})\\${dstintf}"
                set extrainfo-type custom
                set subject "Web request to $groupby2 detected"
                set groupby1 "endpoint"
                set groupby2 "catdesc"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Risky,URL"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "action"
                        set value "blocked"
                        set oper not-equal
                    next
                end
                set filter-expr "(catdesc=='Malicious Websites' or catdesc=='Phishing' or catdesc=='Spam URLs')"
            next
            edit 3
                set name "Web request to suspicious destination detected"
                set devtype FortiGate
                set severity medium
                set logtype "webfilter"
                set extrainfo "Domain:${hostname}, Referrer:${referralurl}, ${devname} (Policy ID:${policyid})\\${dstintf}"
                set extrainfo-type custom
                set subject "Web request to $groupby2 detected"
                set groupby1 "endpoint"
                set groupby2 "catdesc"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Risky,URL"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "action"
                        set value "blocked"
                        set oper not-equal
                    next
                end
                set filter-expr "(catdesc=='Newly Observed Domain' or catdesc=='Newly Registered Domain' or catdesc~'Dynamic DNS' or catdesc=='Proxy Avoidance' or catdesc=='Unrated')"
            next
            edit 4
                set name "DNS request to malicious destination detected"
                set devtype FortiGate
                set severity high
                set logtype "dns"
                set extrainfo "Domain:${hostname}, Referrer:${referralurl}, ${devname} (Policy ID:${policyid})\\${dstintf}"
                set extrainfo-type custom
                set subject "DNS request to $groupby2 detected"
                set groupby1 "endpoint"
                set groupby2 "catdesc"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Risky,Domain"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==1501054802 and (catdesc=='Malicious Websites' or catdesc=='Phishing' or catdesc=='Spam URLs')"
            next
            edit 5
                set name "Web request to malicious destination blocked in ips log"
                set devtype FortiGate
                set severity medium
                set logtype "ips"
                set extrainfo "Domain:${hostname}, ${devname} (Policy ID:${policyid})\\${dstintf}"
                set extrainfo-type custom
                set subject "Web request to malicious URL blocked"
                set groupby1 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Endpoint,Risky,URL"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0421016399"
            next
            edit 6
                set name "DNS request to suspicious destination detected"
                set devtype FortiGate
                set severity medium
                set logtype "dns"
                set extrainfo "Domain:${qname}, Resolved IP: ${ipaddr}, ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "DNS request to $groupby2 detected"
                set groupby1 "endpoint"
                set groupby2 "catdesc"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Risky,Domain"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==1501054802 and (catdesc=='Newly Observed Domain' or catdesc=='Newly Registered Domain' or catdesc~'Dynamic DNS' or catdesc=='Proxy Avoidance' or catdesc=='Unrated')"
            next
            edit 7
                set name "DNS request to malicious destination blocked"
                set devtype FortiGate
                set severity medium
                set logtype "dns"
                set extrainfo "Domain:${qname}, Resolved IP: ${ipaddr}, ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "DNS request to $groupby2 blocked"
                set groupby1 "endpoint"
                set groupby2 "catdesc"
                set eventstatus "mitigated"
                set tags "Default,By_Endpoint,Risky,Domain"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==1501054803 and (catdesc=='Malicious Websites' or catdesc=='Phishing' or catdesc=='Spam URLs' or catdesc=='Newly Observed Domain' or catdesc=='Newly Registered Domain' or catdesc~'Dynamic DNS' or catdesc=='Proxy Avoidance' or catdesc=='Unrated')"
            next
            edit 8
                set name "Insecure SSL connection detected"
                set devtype FortiGate
                set severity medium
                set logtype "ssl"
                set extrainfo "${msg} with reason: ${reason} from ${srcip} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Insecure SSL connection detected"
                set groupby1 "endpoint"
                set groupby2 "msg"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Risky,SSL"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssl-anomaly"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper equal
                    next
                end
            next
            edit 9
                set name "Insecure SSL connection blocked"
                set devtype FortiGate
                set severity low
                set logtype "ssl"
                set extrainfo "${msg} with reason: ${reason} from ${srcip} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Insecure SSL connection blocked"
                set groupby1 "endpoint"
                set groupby2 "msg"
                set eventstatus "mitigated"
                set tags "Default,By_Endpoint,Risky,SSL"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssl-anomaly"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper not-equal
                    next
                end
            next
            edit 10
                set name "SSL connection exempted"
                set devtype FortiGate
                set severity low
                set logtype "ssl"
                set extrainfo "SSL connection from ${srcip} to ${dstip}:${dstport} exempt with reason: ${reason}"
                set extrainfo-type custom
                set subject "$groupby2"
                set groupby1 "endpoint"
                set groupby2 "msg"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Risky,SSL"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssl-exempt"
                        set oper equal
                    next
                end
            next
            edit 11
                set name "SSH channel detected"
                set devtype FortiGate
                set severity medium
                set logtype "ssh"
                set extrainfo "SSH channel by user: ${login} from ${srcip} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "SSH channel detected"
                set groupby1 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Risky,SSH"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssh-channel"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper equal
                    next
                end
            next
            edit 12
                set name "SSH channel blocked"
                set devtype FortiGate
                set severity low
                set logtype "ssh"
                set extrainfo "SSH channel by user: ${login} from ${srcip} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "SSH channel blocked"
                set groupby1 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Endpoint,Risky,SSH"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssh-channel"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper not-equal
                    next
                end
            next
            edit 13
                set name "SSH command detected"
                set devtype FortiGate
                set severity medium
                set logtype "ssh"
                set extrainfo "SSH Command: ${command} by user: ${login} from ${srcip} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "SSH command detected"
                set groupby1 "endpoint"
                set tags "Default,By_Endpoint,Risky,SSH"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssh-command"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper equal
                    next
                end
            next
            edit 14
                set name "SSH command blocked"
                set devtype FortiGate
                set severity low
                set logtype "ssh"
                set extrainfo "SSH Command: ${command} by user: ${login} from ${srcip} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "SSH command blocked"
                set groupby1 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Endpoint,Risky,SSH"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssh-command"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper not-equal
                    next
                end
            next
            end
        set enable enable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 10045
        set name "Default-Suspicious-File-Detection-By-Endpoint"
        set description "Default Handler to detect suspicious files in network traffic"
        config rule
            edit 1
                set name "Archive file detected"
                set devtype FortiGate
                set severity medium
                set logtype "virus"
                set extrainfo "File:${filename} over ${service}, Traffic path:  ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "Archive file detected"
                set groupby1 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Risky,File"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0262008961 OR logid==0262008963 OR logid==0262008965 OR logid==0262008967 OR logid==0262008969 OR logid==0262008971 OR logid==0262008973"
            next
            edit 2
                set name "Archive file blocked"
                set devtype FortiGate
                set severity low
                set logtype "virus"
                set extrainfo "File:${filename} over ${service}, Traffic path: ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "Archive file blocked"
                set groupby1 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Endpoint,Risky,File"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0262008960 OR logid==0262008962 OR logid==0262008964 OR logid==0262008966 OR logid==0262008968 OR logid==0262008970 OR  logid==0262008972"
            next
            edit 3
                set name "Executable MIME blocked"
                set devtype FortiGate
                set severity low
                set logtype "virus"
                set extrainfo "File:${filename} over ${service}, Traffic path: ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "Executable MIME blocked"
                set groupby1 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Endpoint,Risky,File"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0203008200"
            next
            edit 4
                set name "Executable MIME detected"
                set devtype FortiGate
                set severity medium
                set logtype "virus"
                set extrainfo "File:${filename} over ${service}, Traffic path: ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "Executable MIME detected"
                set groupby1 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Risky,File"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0203008201"
            next
            edit 5
                set name "Fragmented MIME blocked"
                set devtype FortiGate
                set severity low
                set logtype "virus"
                set extrainfo "File:${filename} over ${service}, Traffic path: ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "Fragmented MIME blocked"
                set groupby1 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Endpoint,Risky,File"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0261008450"
            next
            edit 6
                set name "Oversize file detected"
                set devtype FortiGate
                set severity medium
                set logtype "virus"
                set extrainfo "File:${filename} over ${service}, Traffic path: ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "Oversize file detected"
                set groupby1 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Risky,File"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0213008705"
            next
            edit 7
                set name "Oversize file blocked"
                set devtype FortiGate
                set severity low
                set logtype "virus"
                set extrainfo "File:${filename} over ${service}, Traffic path: ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "Oversize file blocked"
                set groupby1 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Endpoint,Risky,File"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0213008704"
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 10046
        set name "Default-Malicious-Code-Detection-By-Endpoint"
        set description "Default event handler to detect attacks and malicious codes in network traffic grouped by endpoint"
        set data-selector "10046"
        config rule
            edit 1
                set name "Intrusion detected group by endpoint"
                set devtype FortiGate
                set severity critical
                set logtype "ips"
                set extrainfo "${direction} intrusion, Source: ${srcintf} (${srcintfrole})\\${srcip}, Destination: ${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "Intrusion $groupby2 detected"
                set groupby1 "endpoint"
                set groupby2 "attack"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Intrusion,Signature,WAN"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "(srcintfrole==wan or dstintfrole==wan) and (action=='detected' or action=='pass session')"
            next
            edit 2
                set name "Intrusion blocked group by endpoint"
                set devtype FortiGate
                set severity high
                set logtype "ips"
                set extrainfo "${direction} intrusion, Source: ${srcintf} (${srcintfrole})\\${srcip}, Destination: ${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "Intrusion $groupby2 blocked"
                set groupby1 "endpoint"
                set groupby2 "attack"
                set eventstatus "mitigated"
                set tags "Default,By_Endpoint,Intrusion,Signature,WAN"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "(srcintfrole==wan or dstintfrole==wan) and (action!='detected' and action!='pass session')"
            next
            edit 3
                set name "Internal intrusion detected group by endpoint"
                set devtype FortiGate
                set severity high
                set logtype "ips"
                set extrainfo "${direction} internal intrusion, Source: ${srcintf} (${srcintfrole})\\${srcip}, Destination: ${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "Internal intrusion $groupby2 detected"
                set groupby1 "endpoint"
                set groupby2 "attack"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Intrusion,Signature,Internal"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "srcintfrole!=wan and dstintfrole!=wan and (action=='detected' or action=='pass session')"
            next
            edit 4
                set name "Internal intrusion blocked group by endpoint"
                set devtype FortiGate
                set severity medium
                set logtype "ips"
                set extrainfo "${direction} internal intrusion, Source: ${srcintf} (${srcintfrole})\\${srcip}, Destination: ${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "Internal intrusion $groupby2 blocked"
                set groupby1 "endpoint"
                set groupby2 "attack"
                set eventstatus "mitigated"
                set tags "Default,By_Endpoint,Intrusion,Signature,Internal"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "srcintfrole!=wan and dstintfrole!=wan and (action!='detected' and action!='pass session')"
            next
            edit 5
                set name "Intrusion detected group by dstendpoint"
                set devtype FortiGate
                set severity critical
                set logtype "ips"
                set extrainfo "${direction} intrusion, Source: ${srcintf} (${srcintfrole})\\${srcip}, Destination: ${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "Intrusion $groupby2 detected"
                set groupby1 "dstendpoint"
                set groupby2 "attack"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Intrusion,Signature,WAN"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "(srcintfrole==wan or dstintfrole==wan) and (action=='detected' or action=='pass session')"
            next
            edit 6
                set name "Intrusion blocked group by dstendpoint"
                set devtype FortiGate
                set severity high
                set logtype "ips"
                set extrainfo "${direction} intrusion, Source: ${srcintf} (${srcintfrole})\\${srcip}, Destination: ${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "Intrusion $groupby2 blocked"
                set groupby1 "dstendpoint"
                set groupby2 "attack"
                set eventstatus "mitigated"
                set tags "Default,By_Endpoint,Intrusion,Signature,WAN"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "(srcintfrole==wan or dstintfrole==wan) and (action!='detected' and action!='pass session')"
            next
            edit 7
                set name "Internal intrusion detected group by dstendpoint"
                set devtype FortiGate
                set severity high
                set logtype "ips"
                set extrainfo "${direction} internal intrusion, Source: ${srcintf} (${srcintfrole})\\${srcip}, Destination: ${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "Internal intrusion $groupby2 detected"
                set groupby1 "dstendpoint"
                set groupby2 "attack"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Intrusion,Signature,Internal"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "srcintfrole!=wan and dstintfrole!=wan and (action=='detected' or action=='pass session')"
            next
            edit 8
                set name "Internal intrusion blocked group by dstendpoint"
                set devtype FortiGate
                set severity medium
                set logtype "ips"
                set extrainfo "${direction} internal intrusion, Source: ${srcintf} (${srcintfrole})\\${srcip}, Destination: ${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "Internal intrusion $groupby2 blocked"
                set groupby1 "dstendpoint"
                set groupby2 "attack"
                set eventstatus "mitigated"
                set tags "Default,By_Endpoint,Intrusion,Signature,Internal"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "srcintfrole!=wan and dstintfrole!=wan and (action!='detected' and action!='pass session')"
            next
        end
        set enable enable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 10047
        set name "Default-Malicious-File-Detection-By-Endpoint"
        set description "Default event handler to detect malicious files in network traffic grouped by endpoint"
        set data-selector "10047"
        config rule
            edit 1
                set name "Malware internal upload detected group by endpoint"
                set devtype FortiGate
                set severity critical
                set logtype "virus"
                set extrainfo "File:${filename} from URL:${url} through ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "Malware $groupby2 internal upload detected"
                set groupby1 "endpoint"
                set groupby2 "virus"
                set eventstatus "open"
                set tags "Default,Malware,Internal,Upload,Attacker,Signature,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "srcintfrole!=wan and dstintfrole!=wan and (logid~\"021100819[3|5]\") and direction=='outgoing'"
            next
            edit 2
                set name "Malware internal download detected group by dstendpoint"
                set devtype FortiGate
                set severity critical
                set logtype "virus"
                set extrainfo "File:${filename} from URL:${url} through ${devname} (Policy ID:${policyid})\\${srcintf}\\${srcip}"
                set extrainfo-type custom
                set subject "Malware $groupby2 internal download detected"
                set groupby1 "dstendpoint"
                set groupby2 "virus"
                set eventstatus "open"
                set tags "Default,Malware,Internal,Download,Attacker,Signature,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "srcintfrole!=wan and dstintfrole!=wan and (logid~\"021100819[3|5]\") and direction=='incoming'"
            next
            edit 3
                set name "Malware internal download detected group by endpoint"
                set devtype FortiGate
                set severity critical
                set logtype "virus"
                set extrainfo "File:${filename} from URL:${url} through ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "Malware $groupby2 internal download detected"
                set groupby1 "endpoint"
                set groupby2 "virus"
                set eventstatus "open"
                set tags "Default,Malware,Internal,Download,Victim,Signature,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "srcintfrole!=wan and dstintfrole!=wan and (logid~\"021100819[3|5]\") and direction=='incoming'"
            next
            edit 4
                set name "Malware internal upload detected group by dstendpoint"
                set devtype FortiGate
                set severity critical
                set logtype "virus"
                set extrainfo "File:${filename} from URL:${url} through ${devname} (Policy ID:${policyid})\\${srcintf}\\${srcip}"
                set extrainfo-type custom
                set subject "Malware $groupby2 internal upload detected"
                set groupby1 "dstendpoint"
                set groupby2 "virus"
                set eventstatus "open"
                set tags "Default,Malware,Internal,Upload,Victim,Signature,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "srcintfrole!=wan and dstintfrole!=wan and (logid~\"021100819[3|5]\") and direction=='outgoing'"
            next
            edit 5
                set name "Malware internal upload blocked group by endpoint"
                set devtype FortiGate
                set severity high
                set logtype "virus"
                set extrainfo "File:${filename} from URL:${url} through ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "Malware $groupby2 internal upload blocked"
                set groupby1 "endpoint"
                set groupby2 "virus"
                set eventstatus "mitigated"
                set tags "Default,Malware,Internal,Upload,Attacker,Signature,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "srcintfrole!=wan and dstintfrole!=wan and (logid~\"021100819[2|4]\") and direction=='outgoing'"
            next
            edit 6
                set name "Malware internal download blocked group by dstendpoint"
                set devtype FortiGate
                set severity high
                set logtype "virus"
                set extrainfo "File:${filename} from URL:${url} through ${devname} (Policy ID:${policyid})\\${srcintf}\\${srcip}"
                set extrainfo-type custom
                set subject "Malware $groupby2 internal download blocked"
                set groupby1 "dstendpoint"
                set groupby2 "virus"
                set eventstatus "mitigated"
                set tags "Default,Malware,Internal,Download,Attacker,Signature,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "srcintfrole!=wan and dstintfrole!=wan and (logid~\"021100819[2|4]\") and direction=='incoming'"
            next
            edit 7
                set name "Malware internal download blocked group by endpoint"
                set devtype FortiGate
                set severity high
                set logtype "virus"
                set extrainfo "File:${filename} from URL:${url} through ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "Malware $groupby2 internal download blocked"
                set groupby1 "endpoint"
                set groupby2 "virus"
                set eventstatus "mitigated"
                set tags "Default,Malware,Internal,Download,Victim,Signature,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "srcintfrole!=wan and dstintfrole!=wan and (logid~\"021100819[2|4]\") and direction=='incoming'"
            next
            edit 8
                set name "Malware internal upload blocked group by dstendpoint"
                set devtype FortiGate
                set severity high
                set logtype "virus"
                set extrainfo "File:${filename} from URL:${url} through ${devname} (Policy ID:${policyid})\\${srcintf}\\${srcip}"
                set extrainfo-type custom
                set subject "Malware $groupby2 internal upload blocked"
                set groupby1 "dstendpoint"
                set groupby2 "virus"
                set eventstatus "mitigated"
                set tags "Default,Malware,Internal,Upload,Victim,Signature,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "srcintfrole!=wan and dstintfrole!=wan and (logid~\"021100819[2|4]\") and direction=='outgoing'"
            next
            edit 9
                set name "Malware upload to WAN detected group by endpoint"
                set devtype FortiGate
                set severity medium
                set logtype "virus"
                set extrainfo "File:${filename} from URL:${url} through ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "Malware $groupby2 upload to WAN detected"
                set groupby1 "endpoint"
                set groupby2 "virus"
                set eventstatus "open"
                set tags "Default,Malware,To_WAN,Upload,Attacker,Signature,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "dstintfrole==wan and (logid~\"021100819[3|5]\") and direction=='outgoing'"
            next
            edit 10
                set name "Malware provided on WAN detected group by dstendpoint"
                set devtype FortiGate
                set severity high
                set logtype "virus"
                set extrainfo "File:${filename} from URL:${url} through ${devname} (Policy ID:${policyid})\\${srcintf}\\${srcip}"
                set extrainfo-type custom
                set subject "Malware $groupby2 provided on WAN detected"
                set groupby1 "dstendpoint"
                set groupby2 "virus"
                set eventstatus "open"
                set tags "Default,Malware,To_WAN,Download,Attacker,Signature,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "dstintfrole==wan and (logid~\"021100819[3|5]\") and direction=='incoming'"
            next
            edit 11
                set name "Malware download from WAN detected group by endpoint"
                set devtype FortiGate
                set severity high
                set logtype "virus"
                set extrainfo "File:${filename} from URL:${url} through ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "Malware $groupby2 download from WAN detected"
                set groupby1 "endpoint"
                set groupby2 "virus"
                set eventstatus "open"
                set tags "Default,Malware,To_WAN,Download,Victim,Signature,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "dstintfrole==wan and (logid~\"021100819[3|5]\") and direction=='incoming'"
            next
            edit 12
                set name "Malware upload to WAN detected group by dstendpoint 1"
                set devtype FortiGate
                set severity medium
                set logtype "virus"
                set extrainfo "File:${filename} from URL:${url} through ${devname} (Policy ID:${policyid})\\${srcintf}\\${srcip}"
                set extrainfo-type custom
                set subject "Malware $groupby2 upload to WAN detected"
                set groupby1 "dstendpoint"
                set groupby2 "virus"
                set eventstatus "open"
                set tags "Default,Malware,To_WAN,Upload,Victim,Signature,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "dstintfrole==wan and (logid~\"021100819[3|5]\") and direction=='outgoing'"
            next
            edit 13
                set name "Malware upload to WAN blocked group by endpoint"
                set devtype FortiGate
                set severity low
                set logtype "virus"
                set extrainfo "File:${filename} from URL:${url} through ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "Malware $groupby2 upload to WAN blocked"
                set groupby1 "endpoint"
                set groupby2 "virus"
                set eventstatus "mitigated"
                set tags "Default,Malware,To_WAN,Upload,Attacker,Signature,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "dstintfrole==wan and (logid~\"021100819[2|4]\") and direction=='outgoing'"
            next
            edit 14
                set name "Malware provided on WAN blocked group by dstendpoint"
                set devtype FortiGate
                set severity medium
                set logtype "virus"
                set extrainfo "File:${filename} from URL:${url} through ${devname} (Policy ID:${policyid})\\${srcintf}\\${srcip}"
                set extrainfo-type custom
                set subject "Malware $groupby2 provided on WAN blocked"
                set groupby1 "dstendpoint"
                set groupby2 "virus"
                set eventstatus "mitigated"
                set tags "Default,Malware,To_WAN,Download,Attacker,Signature,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "dstintfrole==wan and (logid~\"021100819[2|4]\") and direction=='incoming'"
            next
            edit 15
                set name "Malware download from WAN blocked group by endpoint"
                set devtype FortiGate
                set severity medium
                set logtype "virus"
                set extrainfo "File:${filename} from URL:${url} through ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "Malware $groupby2 download from WAN blocked"
                set groupby1 "endpoint"
                set groupby2 "virus"
                set eventstatus "mitigated"
                set tags "Default,Malware,To_WAN,Download,Victim,Signature,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "dstintfrole==wan and (logid~\"021100819[2|4]\") and direction=='incoming'"
            next
            edit 16
                set name "Malware upload to WAN blocked group by dstendpoint"
                set devtype FortiGate
                set severity low
                set logtype "virus"
                set extrainfo "File:${filename} from URL:${url} through ${devname} (Policy ID:${policyid})\\${srcintf}\\${srcip}"
                set extrainfo-type custom
                set subject "Malware $groupby2 upload to WAN blocked"
                set groupby1 "dstendpoint"
                set groupby2 "virus"
                set eventstatus "mitigated"
                set tags "Default,Malware,To_WAN,Upload,Victim,Signature,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "dstintfrole==wan and (logid~\"021100819[2|4]\") and direction=='outgoing'"
            next
            edit 17
                set name "Malware upload from WAN detected group by dstendpoint 2"
                set devtype FortiGate
                set severity high
                set logtype "virus"
                set extrainfo "File:${filename} from URL:${url} through ${devname} (Policy ID:${policyid})\\${srcintf}\\${srcip}"
                set extrainfo-type custom
                set subject "Malware $groupby2 upload from WAN detected"
                set groupby1 "dstendpoint"
                set groupby2 "virus"
                set eventstatus "open"
                set tags "Default,Malware,From_WAN,Upload,Attacker,Signature,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "srcintfrole==wan and (logid~\"021100819[3|5]\") and direction=='outgoing'"
            next
            edit 18
                set name "Malware provided to WAN detected group by dstendpoint"
                set devtype FortiGate
                set severity critical
                set logtype "virus"
                set extrainfo "File:${filename} from URL:${url} through ${devname} (Policy ID:${policyid})\\${srcintf}\\${srcip}"
                set extrainfo-type custom
                set subject "Malware $groupby2 provided to WAN detected"
                set groupby1 "dstendpoint"
                set groupby2 "virus"
                set eventstatus "open"
                set tags "Default,Malware,From_WAN,Download,Attacker,Signature,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "srcintfrole==wan and (logid~\"021100819[3|5]\") and direction=='incoming'"
            next
            edit 19
                set name "Malware download on WAN detected group by dstendpoint"
                set devtype FortiGate
                set severity medium
                set logtype "virus"
                set extrainfo "File:${filename} from URL:${url} through ${devname} (Policy ID:${policyid})\\${srcintf}\\${srcip}"
                set extrainfo-type custom
                set subject "Malware $groupby2 download on WAN detected"
                set groupby1 "dstendpoint"
                set groupby2 "virus"
                set eventstatus "open"
                set tags "Default,Malware,From_WAN,Download,Victim,Signature,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "srcintfrole==wan and (logid~\"021100819[3|5]\") and direction=='incoming'"
            next
            edit 20
                set name "Malware upload from WAN detected group by dstendpoint"
                set devtype FortiGate
                set severity critical
                set logtype "virus"
                set extrainfo "File:${filename} from URL:${url} through ${devname} (Policy ID:${policyid})\\${srcintf}\\${srcip}"
                set extrainfo-type custom
                set subject "Malware $groupby2 upload from WAN detected"
                set groupby1 "dstendpoint"
                set groupby2 "virus"
                set eventstatus "open"
                set tags "Default,Malware,From_WAN,Upload,Victim,Signature,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "srcintfrole==wan and (logid~\"021100819[3|5]\") and direction=='outgoing'"
            next
            edit 21
                set name "Malware upload on WAN blocked group by endpoint"
                set devtype FortiGate
                set severity medium
                set logtype "virus"
                set extrainfo "File:${filename} from URL:${url} through ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "Malware $groupby2 upload on WAN blocked"
                set groupby1 "endpoint"
                set groupby2 "virus"
                set eventstatus "mitigated"
                set tags "Default,Malware,From_WAN,Upload,Attacker,Signature,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "srcintfrole==wan and (logid~\"021100819[2|4]\") and direction=='outgoing'"
            next
            edit 22
                set name "Malware provided to WAN blocked group by dstendpoint"
                set devtype FortiGate
                set severity high
                set logtype "virus"
                set extrainfo "File:${filename} from URL:${url} through ${devname} (Policy ID:${policyid})\\${srcintf}\\${srcip}"
                set extrainfo-type custom
                set subject "Malware $groupby2 provided to WAN blocked"
                set groupby1 "dstendpoint"
                set groupby2 "virus"
                set eventstatus "mitigated"
                set tags "Default,Malware,From_WAN,Download,Attacker,Signature,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "srcintfrole==wan and (logid~\"021100819[2|4]\") and direction=='incoming'"
            next
            edit 23
                set name "Malware download on WAN blocked group by endpoint"
                set devtype FortiGate
                set severity low
                set logtype "virus"
                set extrainfo "File:${filename} from URL:${url} through ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "Malware $groupby2 download on WAN blocked"
                set groupby1 "endpoint"
                set groupby2 "virus"
                set eventstatus "mitigated"
                set tags "Default,Malware,From_WAN,Download,Victim,Signature,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "srcintfrole==wan and (logid~\"021100819[2|4]\") and direction=='incoming'"
            next
            edit 24
                set name "Malware upload from WAN blocked group by dstendpoint"
                set devtype FortiGate
                set severity high
                set logtype "virus"
                set extrainfo "File:${filename} from URL:${url} through ${devname} (Policy ID:${policyid})\\${srcintf}\\${srcip}"
                set extrainfo-type custom
                set subject "Malware $groupby2 upload from WAN blocked"
                set groupby1 "dstendpoint"
                set groupby2 "virus"
                set eventstatus "mitigated"
                set tags "Default,Malware,From_WAN,Upload,Victim,Signature,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "srcintfrole==wan and (logid~\"021100819[2|4]\") and direction=='outgoing'"
            next
        end
        set enable enable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 10048
        set name "Default-Risky-App-Detection-By-Endpoint"
        set description "Default Handler to detect high-risk App usage"
        config rule
            edit 1
                set name "Critical risk App blocked"
                set devtype FortiGate
                set severity medium
                set logtype "app-ctrl"
                set extrainfo "AppID:${appid} from Category:${appcat} with Risk:${apprisk} to: ${hostname}(${dstip}:${dstport})"
                set extrainfo-type custom
                set subject "Risky App $groupby2 blocked"
                set groupby1 "endpoint"
                set groupby2 "app"
                set eventstatus "mitigated"
                set tags "Default,By_Endpoint,Risky,App,Signature"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "action"
                        set value "block"
                        set oper equal
                    next
                    edit 2
                        set key "apprisk"
                        set value "critical"
                        set oper equal
                    next
                end
            next
            edit 2
                set name "Critical risk App detected"
                set devtype FortiGate
                set severity high
                set logtype "app-ctrl"
                set extrainfo "AppID:${appid} from Category:${appcat} with Risk:${apprisk} to: ${hostname}(${dstip}:${dstport})"
                set extrainfo-type custom
                set subject "Risky App $groupby2 detected"
                set groupby1 "endpoint"
                set groupby2 "app"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Risky,App,Signature"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "action"
                        set value "block"
                        set oper not-equal
                    next
                    edit 2
                        set key "apprisk"
                        set value "critical"
                        set oper equal
                    next
                end
            next
            edit 3
                set name "High risk App blocked"
                set devtype FortiGate
                set severity low
                set logtype "app-ctrl"
                set extrainfo "AppID:${appid} from Category:${appcat} with Risk:${apprisk} to: ${hostname}(${dstip}:${dstport})"
                set extrainfo-type custom
                set subject "Risky App $groupby2 blocked"
                set groupby1 "endpoint"
                set groupby2 "app"
                set eventstatus "mitigated"
                set tags "Default,By_Endpoint,Risky,App,Signature"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "action"
                        set value "block"
                        set oper equal
                    next
                    edit 2
                        set key "apprisk"
                        set value "high"
                        set oper equal
                    next
                end
            next
            edit 4
                set name "High risk App detected"
                set devtype FortiGate
                set severity medium
                set logtype "app-ctrl"
                set extrainfo "AppID:${appid} from Category:${appcat} with Risk:${apprisk} to: ${hostname}(${dstip}:${dstport})"
                set extrainfo-type custom
                set subject "Risky App $groupby2 detected"
                set groupby1 "endpoint"
                set groupby2 "app"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Risky,App,Signature"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "action"
                        set value "block"
                        set oper not-equal
                    next
                    edit 2
                        set key "apprisk"
                        set value "high"
                        set oper equal
                    next
                end
            next
        end
        set enable enable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 10049
        set name "Default-Malicious-File-Detection-By-Threat"
        set description "Default UTM Antivirus event handler"
        set data-selector "10047"
        config rule
            edit 1
                set name "Malware uploaded group by endpoint"
                set devtype FortiGate
                set severity high
                set logtype "virus"
                set extrainfo "Malware ${virus}, Reference: ${ref}, Traffic path: PolicyID ${policyid}\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Malware uploaded by $groupby2"
                set groupby1 "virus"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Malware,Signature,Attacker"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction=outgoing and (logid~\"021100819[3|5]\")"
            next
            edit 2
                set name "Malware upload blocked group by endpoint"
                set devtype FortiGate
                set severity medium
                set logtype "virus"
                set extrainfo "Malware ${virus}, Reference: ${ref}, Traffic path: PolicyID ${policyid}\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Malware upload by $groupby2 blocked"
                set groupby1 "virus"
                set groupby2 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Threat,Malware,Signature,Attacker"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction=outgoing and (logid~\"021100819[2|4]\")"
            next
            edit 3
                set name "Malware downloaded group by endpoint"
                set devtype FortiGate
                set severity high
                set logtype "virus"
                set extrainfo "Malware ${virus}, Reference: ${ref}, Traffic path: PolicyID ${policyid}\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Malware downloaded to $groupby2"
                set groupby1 "virus"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Malware,Signature,Victim"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction=incoming and (logid~\"021100819[3|5]\")"
            next
            edit 4
                set name "Malware download blocked group by endpoint"
                set devtype FortiGate
                set severity medium
                set logtype "virus"
                set extrainfo "Malware ${virus}, Reference: ${ref}, Traffic path: PolicyID ${policyid}\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Malware download to $groupby2 blocked"
                set groupby1 "virus"
                set groupby2 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Threat,Malware,Signature,Victim"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction=incoming and (logid~\"021100819[2|4]\")"
            next
            edit 5
                set name "Malware uploaded group by dstendpoint"
                set devtype FortiGate
                set severity high
                set logtype "virus"
                set extrainfo "Malware ${virus}, Reference: ${ref}, Traffic path: PolicyID ${policyid}\\${srcip}:${srcport}"
                set extrainfo-type custom
                set subject "Malware uploaded to $groupby2"
                set groupby1 "virus"
                set groupby2 "dstendpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Malware,Signature,Victim"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction=outgoing and (logid~\"021100819[3|5]\")"
            next
            edit 6
                set name "Malware upload blocked group by dstendpoint"
                set devtype FortiGate
                set severity medium
                set logtype "virus"
                set extrainfo "Malware ${virus}, Reference: ${ref}, Traffic path: PolicyID ${policyid}\\${srcip}:${srcport}"
                set extrainfo-type custom
                set subject "Malware upload to $groupby2 blocked"
                set groupby1 "virus"
                set groupby2 "dstendpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Threat,Malware,Signature,Victim"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction=outgoing and (logid~\"021100819[2|4]\")"
            next
            edit 7
                set name "Malware provided group by dstendpoint"
                set devtype FortiGate
                set severity high
                set logtype "virus"
                set extrainfo "Malware ${virus}, Reference: ${ref}, Traffic path: PolicyID ${policyid}\\${srcip}:${srcport}"
                set extrainfo-type custom
                set subject "Malware provided by $groupby2"
                set groupby1 "virus"
                set groupby2 "dstendpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Malware,Signature,Attacker"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction=incoming and (logid~\"021100819[3|5]\")"
            next
            edit 8
                set name "Malware provided blocked group by dstendpoint"
                set devtype FortiGate
                set severity medium
                set logtype "virus"
                set extrainfo "Malware ${virus}, Reference: ${ref}, Traffic path: PolicyID ${policyid}\\${srcip}:${srcport}"
                set extrainfo-type custom
                set subject "Malware provided by $groupby2 blocked"
                set groupby1 "virus"
                set groupby2 "dstendpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Threat,Malware,Signature,Attacker"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction=incoming and (logid~\"021100819[2|4]\")"
            next
        end
        set enable enable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 10050
        set name "Default-Risky-App-Detection-By-Threat"
        set description "Default UTM Application Control event handler"
        set data-selector "10050"
        config rule
            edit 1
                set name "Risky App usage detected"
                set devtype FortiGate
                set severity high
                set logtype "app-ctrl"
                set extrainfo "App:${app} from Category:${appcat} with Risk:${apprisk}, PolicyID ${policyid} "
                set extrainfo-type custom
                set subject "Risky App usage by $groupby2 detected"
                set groupby1 "app"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Risky,App,Signature"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "action"
                        set value "block"
                        set oper not-equal
                    next
                end
            next
            edit 2
                set name "Risky App usage blocked"
                set devtype FortiGate
                set severity medium
                set logtype "app-ctrl"
                set extrainfo "App:${app} from Category:${appcat} with Risk:${apprisk},  PolicyID ${policyid} "
                set extrainfo-type custom
                set subject "Risky App usage by $groupby2 blocked"
                set groupby1 "app"
                set groupby2 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Threat,Risky,App,Signature"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "action"
                        set value "block"
                        set oper equal
                    next
                end
            next
        end
        set enable enable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 10051
        set name "Default-Risky-Destination-Detection-By-Threat"
        set description "Default event handler to detect network traffic to malicious or suspicious destinations grouped by threat"
        config rule
            edit 1
                set name "Web request to malicious destination detected"
                set devtype FortiGate
                set severity high
                set logtype "webfilter"
                set extrainfo "Domain:${hostname} from category: ${catdesc}, Traffic path: PolicyID ${policyid}(Profile ${profile})\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Web request to malicious destination from $groupby2 detected"
                set groupby1 "hostname"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Risky,URL"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "action"
                        set value "blocked"
                        set oper not-equal
                    next
                end
                set filter-expr "(catdesc=='Malicious Websites' or catdesc=='Phishing' or catdesc=='Spam URLs')"
            next
            edit 2
                set name "Web request to malicious destination blocked"
                set devtype FortiGate
                set severity medium
                set logtype "webfilter"
                set extrainfo "Domain:${hostname} from category: ${catdesc}, Traffic path: PolicyID ${policyid}(Profile ${profile})\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Web request to malicious destination from $groupby2 blocked"
                set groupby1 "hostname"
                set groupby2 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Threat,Risky,URL"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "action"
                        set value "blocked"
                        set oper equal
                    next
                end
                set filter-expr "(catdesc=='Malicious Websites' or catdesc=='Phishing' or catdesc=='Spam URLs')"
            next
            edit 3
                set name "DNS request to malicious destination detected"
                set devtype FortiGate
                set severity high
                set logtype "dns"
                set extrainfo "Domain:${qname} from category: ${catdesc}, Traffic path: PolicyID ${policyid}(Profile ${profile})\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "DNS request to malicious destination from $groupby2 detected"
                set groupby1 "qname"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Risky,Domain"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==1501054802 and (catdesc=='Malicious Websites' or catdesc=='Phishing' or catdesc=='Spam URLs')"
            next
            edit 4
                set name "DNS request to malicious destination blocked"
                set devtype FortiGate
                set severity medium
                set logtype "dns"
                set extrainfo "Domain:${qname} from category: ${catdesc}, Traffic path: PolicyID ${policyid}(Profile ${profile})\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "DNS request to malicious destination from $groupby2 blocked"
                set groupby1 "qname"
                set groupby2 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Threat,Risky,Domain"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==1501054803 and (catdesc=='Malicious Websites' or catdesc=='Phishing' or catdesc=='Spam URLs')"
            next
            edit 5
                set name "Web request to suspicious destination detected"
                set devtype FortiGate
                set severity medium
                set logtype "webfilter"
                set extrainfo "Domain:${hostname} from category: ${catdesc}, Traffic path: PolicyID ${policyid}(Profile ${profile})\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Web request to suspicious destination from $groupby2 detected"
                set groupby1 "hostname"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Risky,URL"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "action"
                        set value "blocked"
                        set oper not-equal
                    next
                end
                set filter-expr "(catdesc=='Newly Observed Domain' or catdesc=='Newly Registered Domain' or catdesc~'Dynamic DNS' or catdesc=='Proxy Avoidance' or catdesc=='Unrated')"
            next
            edit 6
                set name "Web request to suspicious destination blocked"
                set devtype FortiGate
                set severity low
                set logtype "webfilter"
                set extrainfo "Domain:${hostname} from category: ${catdesc}, Traffic path: PolicyID ${policyid}(Profile ${profile})\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Web request to suspicious destination from $groupby2 blocked"
                set groupby1 "hostname"
                set groupby2 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Threat,Risky,URL"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "action"
                        set value "blocked"
                        set oper equal
                    next
                end
                set filter-expr "(catdesc=='Newly Observed Domain' or catdesc=='Newly Registered Domain' or catdesc~'Dynamic DNS' or catdesc=='Proxy Avoidance' or catdesc=='Unrated')"
            next
            edit 7
                set name "DNS request to suspicious destination detected"
                set devtype FortiGate
                set severity medium
                set logtype "dns"
                set extrainfo "Domain:${qname} from category: ${catdesc}, Traffic path: PolicyID ${policyid}(Profile ${profile})\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "DNS request to suspicious destination from $groupby2 detected"
                set groupby1 "qname"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Risky,Domain"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==1501054802 and (catdesc=='Newly Observed Domain' or catdesc=='Newly Registered Domain' or catdesc~'Dynamic DNS' or catdesc=='Proxy Avoidance' or catdesc=='Unrated')"
            next
            edit 8
                set name "DNS request to suspicious destination blocked"
                set devtype FortiGate
                set severity low
                set logtype "dns"
                set extrainfo "Domain:${qname} from category: ${catdesc}, Traffic path: PolicyID ${policyid}(Profile ${profile})\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "DNS request to suspicious destination from $groupby2 blocked"
                set groupby1 "qname"
                set groupby2 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Threat,Risky,Domain"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==1501054803 and (catdesc=='Newly Observed Domain' or catdesc=='Newly Registered Domain' or catdesc~'Dynamic DNS' or catdesc=='Proxy Avoidance' or catdesc=='Unrated')"
            next
            edit 9
                set name "Web request to malicious destination blocked in ips log"
                set devtype FortiGate
                set severity medium
                set logtype "ips"
                set extrainfo "URL:${hostname}\\${url}, Traffic path: PolicyID ${policyid}(Profile ${profile})\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Web request to malicious destination from $groupby2 blocked"
                set groupby1 "hostname"
                set groupby2 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Threat,Risky,URL"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0421016399"
            next
            edit 10
                set name "Insecure SSL Connection detected"
                set devtype FortiGate
                set severity medium
                set logtype "ssl"
                set extrainfo "${msg} with reason: ${reason} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Insecure SSL Connection detected from $groupby2"
                set groupby1 "dstip"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Risky,SSL"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssl-anomaly"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper equal
                    next
                end
            next
            edit 11
                set name "Insecure SSL Connection blocked"
                set devtype FortiGate
                set severity low
                set logtype "ssl"
                set extrainfo "${msg} with reason: ${reason} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Insecure SSL Connection blocked from $groupby2"
                set groupby1 "dstip"
                set groupby2 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Threat,Risky,SSL"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssl-anomaly"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper not-equal
                    next
                end
            next
            edit 12
                set name "SSH channel detected"
                set devtype FortiGate
                set severity medium
                set logtype "ssh"
                set extrainfo "SSH channel by user: ${login} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "SSH channel detected from $groupby2"
                set groupby1 "dstip"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Risky,SSH"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssh-channel"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper equal
                    next
                end
            next
            edit 13
                set name "SSH channel blocked"
                set devtype FortiGate
                set severity low
                set logtype "ssh"
                set extrainfo "SSH channel by user: ${login} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "SSH channel blocked from $groupby2"
                set groupby1 "dstip"
                set groupby2 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Threat,Risky,SSH"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssh-channel"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper not-equal
                    next
                end
            next
            edit 14
                set name "SSH command detected"
                set devtype FortiGate
                set severity medium
                set logtype "ssh"
                set extrainfo "SSH command: ${command} by user: ${login}  to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "SSH command detected from $groupby2"
                set groupby1 "dstip"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Risky,SSH"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssh-command"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper equal
                    next
                end
            next
            edit 15
                set name "SSH command blocked"
                set devtype FortiGate
                set severity low
                set logtype "ssh"
                set extrainfo "SSH command: ${command} by user: ${login} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "SSH command blocked from $groupby2"
                set groupby1 "dstip"
                set groupby2 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Threat,Risky,SSH"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssh-command"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper not-equal
                    next
                end
            next
        end
        set enable enable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 10052
        set name "Default-Malicious-Code-Detection-By-Threat"
        set description "Default event handler to detect attacks and malicious codes in network traffic grouped by threat"
        set data-selector "10046"
        config rule
            edit 1
                set name "Intrusion detected group by endpoint"
                set devtype FortiGate
                set severity high
                set logtype "ips"
                set extrainfo "Intrusion: ${attack} with severity:${severity}, Reference: ${ref}, Traffic path: PolicyID ${policyid}\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Intrusion from $groupby2 detected"
                set groupby1 "attack"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Intrusion,Signature,Attacker"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction=outgoing and (action=='detected' or action=='pass session')"
            next
            edit 2
                set name "Intrusion blocked group by endpoint"
                set devtype FortiGate
                set severity medium
                set logtype "ips"
                set extrainfo "Intrusion: ${attack} with severity:${severity}, Reference: ${ref}, Traffic path: PolicyID ${policyid}\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Intrusion from $groupby2 blocked"
                set groupby1 "attack"
                set groupby2 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Threat,Intrusion,Signature,Attacker"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction=outgoing and (action!='detected' and action!='pass session')"
            next
            edit 3
                set name "Intrusion detected group by dstendpoint"
                set devtype FortiGate
                set severity high
                set logtype "ips"
                set extrainfo "Intrusion: ${attack} with severity:${severity}, Reference: ${ref}, Traffic path: PolicyID ${policyid}\\${srcip}:${srcport}"
                set extrainfo-type custom
                set subject "Intrusion to $groupby2 detected"
                set groupby1 "attack"
                set groupby2 "dstendpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Intrusion,Signature,Victim"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction=outgoing and (action=='detected' or action=='pass session')"
            next
            edit 4
                set name "Intrusion blocked group by dstendpoint"
                set devtype FortiGate
                set severity medium
                set logtype "ips"
                set extrainfo "Intrusion: ${attack} with severity:${severity}, Reference: ${ref}, Traffic path: PolicyID ${policyid}\\${srcip}:${srcport}"
                set extrainfo-type custom
                set subject "Intrusion to $groupby2 blocked"
                set groupby1 "attack"
                set groupby2 "dstendpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Threat,Intrusion,Signature,Victim"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction=outgoing and (action!='detected' and action!='pass session')"
            next
            edit 5
                set name "Incoming Intrusion detected group by endpoint"
                set devtype FortiGate
                set severity high
                set logtype "ips"
                set extrainfo "Intrusion: ${attack} with severity:${severity}, Reference: ${ref}, Traffic path: PolicyID ${policyid}\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Incoming Intrusion to $groupby2 detected"
                set groupby1 "attack"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Intrusion,Signature,Victim"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction=incoming and (action=='detected' or action=='pass session')"
            next
            edit 6
                set name "Incoming Intrusion blocked group by endpoint"
                set devtype FortiGate
                set severity medium
                set logtype "ips"
                set extrainfo "Intrusion: ${attack} with severity:${severity}, Reference: ${ref}, Traffic path: PolicyID ${policyid}\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Incoming Intrusion to $groupby2 blocked"
                set groupby1 "attack"
                set groupby2 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Threat,Intrusion,Signature,Victim"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction=incoming and (action!='detected' and action!='pass session')"
            next
            edit 7
                set name "Incoming Intrusion detected group by dstendpoint"
                set devtype FortiGate
                set severity high
                set logtype "ips"
                set extrainfo "Intrusion: ${attack} with severity:${severity}, Reference: ${ref}, Traffic path: PolicyID ${policyid}\\${srcip}:${srcport}"
                set extrainfo-type custom
                set subject "Incoming Intrusion from $groupby2 detected"
                set groupby1 "attack"
                set groupby2 "dstendpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Intrusion,Signature,Attacker"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction=incoming and (action=='detected' or action=='pass session')"
            next
            edit 8
                set name "Incoming Intrusion blocked group by dstendpoint"
                set devtype FortiGate
                set severity medium
                set logtype "ips"
                set extrainfo "Intrusion: ${attack} with severity:${severity}, Reference: ${ref}, Traffic path: PolicyID ${policyid}\\${srcip}:${srcport}"
                set extrainfo-type custom
                set subject "Incoming Intrusion from $groupby2 blocked"
                set groupby1 "attack"
                set groupby2 "dstendpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Threat,Intrusion,Signature,Attacker"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction=incoming and (action!='detected' and action!='pass session')"
            next
        end
        set enable enable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 10053
        set name "Default-Sandbox-Detections-By-Threat"
        set description "Default handler to track file submission and Malware detection by FortiSandbox grouped by threat"
        config rule
            edit 1
                set name "Malware uploaded (Sandbox) group by endpoint"
                set devtype FortiGate
                set severity high
                set logtype "virus"
                set extrainfo "Malware:${virus} with severity:${crlevel} found in file:${filename}, Traffic path: PolicyID ${policyid}\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Malware uploaded by $groupby2 (Sandbox)"
                set groupby1 "virus"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,Sandbox,Signature,By_Threat,Malware,Attacker"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction=outgoing and (logid==0211009235 or logid==0211009237)"
            next
            edit 2
                set name "Malware upload blocked (Sandbox) group by endpoint"
                set devtype FortiGate
                set severity medium
                set logtype "virus"
                set extrainfo "Malware:${virus} with severity:${crlevel} found in file:${filename}, Traffic path: PolicyID ${policyid}\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Malware upload by $groupby2 blocked (Sandbox)"
                set groupby1 "virus"
                set groupby2 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,Sandbox,Signature,By_Threat,Malware,Attacker"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction=outgoing and (logid==0211009234 or logid==0211009236)"
            next
            edit 3
                set name "Malware downloaded (Sandbox) group by endpoint"
                set devtype FortiGate
                set severity high
                set logtype "virus"
                set extrainfo "Malware:${virus} with severity:${crlevel} found in file:${filename}, Traffic path: PolicyID ${policyid}\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Malware downloaded to $groupby2 (Sandbox)"
                set groupby1 "virus"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,Sandbox,Signature,By_Threat,Malware,Victim"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction=incoming and (logid==0211009235 or logid==0211009237)"
            next
            edit 4
                set name "Malware download blocked (Sandbox) group by endpoint"
                set devtype FortiGate
                set severity medium
                set logtype "virus"
                set extrainfo "Malware:${virus} with severity:${crlevel} found in file:${filename}, Traffic path: PolicyID ${policyid}\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Malware download to $groupby2 blocked (Sandbox)"
                set groupby1 "virus"
                set groupby2 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,Sandbox,Signature,By_Threat,Malware,Victim"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction=incoming and (logid==0211009234 or logid==0211009236)"
            next
            edit 5
                set name "Malware uploaded (Sandbox) group by dstendpoint"
                set devtype FortiGate
                set severity high
                set logtype "virus"
                set extrainfo "Malware:${virus} with severity:${crlevel} found in file:${filename}, Traffic path: PolicyID ${policyid}\\${srcip}:${srcport}"
                set extrainfo-type custom
                set subject "Malware uploaded to $groupby2 (Sandbox)"
                set groupby1 "virus"
                set groupby2 "dstendpoint"
                set eventstatus "open"
                set tags "Default,Sandbox,Signature,By_Threat,Malware,Victim"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction=outgoing and (logid==0211009235 or logid==0211009237)"
            next
            edit 6
                set name "Malware upload blocked (Sandbox) group by dstendpoint"
                set devtype FortiGate
                set severity medium
                set logtype "virus"
                set extrainfo "Malware:${virus} with severity:${crlevel} found in file:${filename}, Traffic path: PolicyID ${policyid}\\${srcip}:${srcport}"
                set extrainfo-type custom
                set subject "Malware upload to $groupby2 blocked (Sandbox)"
                set groupby1 "virus"
                set groupby2 "dstendpoint"
                set eventstatus "mitigated"
                set tags "Default,Sandbox,Signature,By_Threat,Malware,Victim"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction=outgoing and (logid==0211009234 or logid==0211009236)"
            next
            edit 7
                set name "Malware provided (Sandbox) group by endpoint"
                set devtype FortiGate
                set severity high
                set logtype "virus"
                set extrainfo "Malware:${virus} with severity:${crlevel} found in file:${filename}, Traffic path: PolicyID ${policyid}\\${srcip}:${srcport}"
                set extrainfo-type custom
                set subject "Malware provided by $groupby2 (Sandbox)"
                set groupby1 "virus"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,Sandbox,Signature,By_Threat,Malware,Attacker"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction=incoming and (logid==0211009235 or logid==0211009237)"
            next
            edit 8
                set name "Malware provided blocked (Sandbox) group by dstendpoint"
                set devtype FortiGate
                set severity medium
                set logtype "virus"
                set extrainfo "Malware:${virus} with severity:${crlevel} found in file:${filename}, Traffic path: PolicyID ${policyid}\\${srcip}:${srcport}"
                set extrainfo-type custom
                set subject "Malware provided by $groupby2 blocked (Sandbox)"
                set groupby1 "virus"
                set groupby2 "dstendpoint"
                set eventstatus "mitigated"
                set tags "Default,Sandbox,Signature,By_Threat,Malware,Attacker"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction=incoming and (logid==0211009234 or logid==0211009236)"
            next
            edit 9
                set name "Sandbox detected Malware in traffic group by endpoint"
                set devtype FortiGate
                set severity critical
                set logtype "virus"
                set extrainfo "Checksum:${analyticscksum}, Traffic to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Sandbox detected Malware in traffic from $groupby2"
                set groupby1 "filename"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,Sandbox,By_Threat,Malware"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0201009238 and fsaverdict==malicious"
            next
            edit 10
                set name "Sandbox detected Malware in traffic group by dstendpoint"
                set devtype FortiGate
                set severity critical
                set logtype "virus"
                set extrainfo "Checksum:${analyticscksum}, Traffic from ${srcip}:${srcport}"
                set extrainfo-type custom
                set subject "Sandbox detected Malware in traffic to $groupby2"
                set groupby1 "filename"
                set groupby2 "dstendpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Sandbox,Malware"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 30
                set filter-expr "logid==0201009238 and fsaverdict==malicious"
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 10054
        set name "Default-Data-Leak-Detection-By-Threat"
        set description "Default Data Leak Detection Handler Grouped by Threat"
        config rule
            edit 1
                set name "Data leak detected"
                set devtype FortiGate
                set severity medium
                set logtype "dlp"
                set extrainfo "File:${filename} (Type:${filetype}, Size:${filesize}), Traffic path: PolicyID ${policyid}\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Data leak from $groupby2 detected"
                set groupby1 "filtercat"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Signature,Leak"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "action==log-only or action==allow"
            next
            edit 2
                set name "Data leak blocked"
                set devtype FortiGate
                set severity low
                set logtype "dlp"
                set extrainfo "File:${filename} (Type:${filetype}, Size:${filesize}), Traffic path: PolicyID ${policyid}\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Data leak from $groupby2 blocked"
                set groupby1 "filtercat"
                set groupby2 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Threat,Signature,Leak"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "action!=log-only and action!=allow"
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 10055
        set name "Default-Compromised Host-Detection-IOC-By-Threat"
        set description "Default event handler to detect compromised hosts by FortiAnalyzer IOC feature grouped by threat"
        config rule
            edit 1
                set name "Traffic to CnC detected"
                set devtype FortiGate
                set severity critical
                set logtype "traffic"
                set extrainfo "Traffic to C&C:${dstip}, Traffic path: PolicyID ${policyid}\\${dstintf}\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Traffic to C&C from $groupby2 detected"
                set groupby1 "dstip"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,IP,C&C,Ioc_Rescan"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "tdtype~infected"
            next
            edit 2
                set name "Web traffic to CnC detected"
                set devtype FortiGate
                set severity critical
                set logtype "webfilter"
                set extrainfo "Traffic to C&C:${hostname}, Traffic path: PolicyID ${policyid}\\${dstintf}\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Web traffic to C&C from $groupby2 detected"
                set groupby1 "hostname"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,C&C,URL,Ioc_Rescan"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "tdtype~infected"
            next
            edit 3
                set name "DNS traffic to CnC detected"
                set devtype FortiGate
                set severity critical
                set logtype "dns"
                set extrainfo "Traffic to C&C:${qname}, Traffic path: PolicyID ${policyid}\\${dstintf}\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "DNS traffic to C&C from $groupby2 detected"
                set groupby1 "qname"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,C&C,Domain,Ioc_Rescan"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "tdtype~infected"
            next
            edit 4
                set name "Traffic to CnC event detected by FortiGate"
                set devtype FortiGate
                set severity critical
                set logtype "event"
                set extrainfo "FGT detected traffic to IOC location, from the source ip:${srcip}"
                set extrainfo-type custom
                set subject "Traffic to C&C from $groupby1 detected"
                set groupby1 "srcip"
                set eventstatus "open"
                set tags "Default,By_Threat,C&C"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0100020214"
            next
        end
        set enable enable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 10056
        set name "Default-Botnet-Communication-Detection-By-Threat"
        set description "Default event handler to detect botnet communication in network grouped by threat"
        config rule
            edit 1
                set name "Traffic to Botnet CnC blocked in virus log"
                set devtype FortiGate
                set severity high
                set logtype "virus"
                set extrainfo "Traffic to Botnet C&C ${virus},  Reference: ${ref}, Traffic path: PolicyID ${policyid}\\${dstintf}\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Traffic to Botnet C&C from $groupby2 blocked"
                set groupby1 "virus"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Botnet,IP,C&C"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0202009248"
            next
            edit 2
                set name "Traffic to Botnet CnC detected in virus log"
                set devtype FortiGate
                set severity critical
                set logtype "virus"
                set extrainfo "Traffic to Botnet C&C ${virus}, Reference: ${ref}, Traffic path: PolicyID ${policyid}\\${dstintf}\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Traffic to Botnet C&C from $groupby2 detected"
                set groupby1 "virus"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Botnet,IP,C&C"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0202009249"
            next
            edit 3
                set name "DNS traffic to Botnet CnC blocked"
                set devtype FortiGate
                set severity high
                set logtype "dns"
                set extrainfo "Traffic to Botnet C&C domain: ${qname}, Traffic path: PolicyID ${policyid}\\${dstintf}\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "DNS traffic to Botnet C&C from $groupby2 blocked"
                set groupby1 "qname"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Botnet,Domain,C&C"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==1501054601 OR logid==1501054600"
            next
            edit 4
                set name "Traffic to Botnet CnC detected in ips log 1"
                set devtype FortiGate
                set severity critical
                set logtype "ips"
                set extrainfo "Traffic to Botnet C&C ${attack}, Reference: ${ref}, Traffic path: PolicyID ${policyid}\\${dstintf}\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Traffic to Botnet C&C from $groupby2 detected"
                set groupby1 "attack"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Botnet,Signature,C&C"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "attack ~ Botnet and direction=incoming and (action=='detected' or action=='pass session')"
            next
            edit 5
                set name "Traffic to Botnet CnC blocked in ips log 1"
                set devtype FortiGate
                set severity high
                set logtype "ips"
                set extrainfo "Traffic to Botnet C&C ${attack}, Reference: ${ref}, Traffic path: PolicyID ${policyid}\\${dstintf}\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Traffic to Botnet C&C from $groupby2 blocked"
                set groupby1 "attack"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Botnet,Signature"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "attack ~ Botnet and direction=incoming and action!='detected' and action!='pass session'"
            next
            edit 6
                set name "Traffic from Botnet CnC detected in ips log"
                set devtype FortiGate
                set severity critical
                set logtype "ips"
                set extrainfo "Traffic from Botnet C&C ${attack}, Reference: ${ref}, Traffic path: PolicyID ${policyid}\\${srcintf}\\${srcip}:${srcport}"
                set extrainfo-type custom
                set subject "Traffic from Botnet C&C to $groupby2 detected"
                set groupby1 "attack"
                set groupby2 "dstendpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Botnet,Signature,C&C"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "attack ~ Botnet and direction=outgoing and (action=='detected' or action=='pass session')"
            next
            edit 7
                set name "Traffic from Botnet CnC blocked in ips log"
                set devtype FortiGate
                set severity high
                set logtype "ips"
                set extrainfo "Traffic from Botnet C&C ${attack}, Reference: ${ref}, Traffic path: PolicyID ${policyid}\\${srcintf}\\${srcip}:${srcport}"
                set extrainfo-type custom
                set subject "Traffic from Botnet C&C to $groupby2 blocked"
                set groupby1 "attack"
                set groupby2 "dstendpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Botnet,Signature,C&C"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "attack ~ Botnet and direction=outgoing and action!='detected' and action!='pass session'"
            next
            edit 8
                set name "Traffic to Botnet CnC blocked in ips log 2"
                set devtype FortiGate
                set severity high
                set logtype "ips"
                set extrainfo "Traffic to C&C:${dstip}, Reference: ${ref}, Traffic path: PolicyID:${policyid}\\${dstintf}"
                set extrainfo-type custom
                set subject "Traffic to Botnet $groupby1 from $groupby2 blocked"
                set groupby1 "attack"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Botnet,IP,C&C"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0422016400"
            next
            edit 9
                set name "Traffic to Botnet CnC detected in ips log 2"
                set devtype FortiGate
                set severity critical
                set logtype "ips"
                set extrainfo "Traffic to C&C:${dstip}, Reference: ${ref}, Traffic path: PolicyID:${policyid}\\${dstintf}"
                set extrainfo-type custom
                set subject "Traffic to Botnet $groupby1 from $groupby2 detected"
                set groupby1 "attack"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Botnet,IP,C&C"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0422016401"
            next
        end
        set enable enable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 10057
        set name "Default FOS System Events"
        set description "Default event handler for selected FortiOS system event logs grouped by device"
        config rule
            edit 1
                set name "Important events"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set utmevent "_any_"
                set subject "$groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,System"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "pri"
                        set value "4"
                        set oper equal
                    next
                    edit 2
                        set key "pri"
                        set value "3"
                        set oper equal
                    next
                end
            next
            edit 2
                set name "Critical events"
                set devtype FortiGate
                set severity critical
                set logtype "event"
                set utmevent "_any_"
                set subject "$groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,System"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "pri"
                        set value "2"
                        set oper great-or-equal
                    next
                end
            next
            edit 3
                set name "Wireless event log id matched"
                set devtype FortiGate
                set severity low
                set logtype "event"
                set utmevent "wireless"
                set subject "$groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,System"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0104043521 or logid==0104043530 or logid==0104043531 or logid==0104043532 or logid==0104043533 or logid==0104043534 or logid==0104043535 or logid==0104043542 or logid==0104043544 or logid==0104043546 or logid==0104043548 or logid==0104043552 or logid==0104043553 or logid==0104043555 or logid==0104043557 or logid==0104043558 or logid==0104043560 or logid==0104043563 or logid==0104043564 or logid==0104043565 or logid==0104043566 or logid==0104043571 or logid==0104043573 or logid==0104043575 or logid==0104043577 or logid==0104043613 or logid==0104043614 or logid==0104043615"
            next
            edit 4
                set name "Event log id matched 1"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set utmevent "_any_"
                set subject "$groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,System"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0109045152 or logid==0107045082 or logid==0107045110 or logid==0110052000 or logid==0100032044"
            next
            edit 5
                set name "Event log id matched 2"
                set devtype FortiGate
                set severity low
                set logtype "event"
                set utmevent "_any_"
                set subject "$groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,System"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0108037892 or logid==0100020117 or logid==0100020220 or logid==0100020221 or logid==0100022017 or logid==0100022018 or logid==0100022917 or logid==0100032023 or logid==0100032103 or logid==0100032140 or logid==0100032141 or logid==0100032142 or logid==0100032146 or logid==0100032149 or logid==0100032158 or logid==0100032159 or logid==0100032231 or logid==0100032232 or logid==0100032233 or logid==0100032238 or logid==0100032241 or logid==0100032564 or logid==0100032602 or logid==0100032603 or logid==0100032605 or logid==0101041989 or logid==0101041990 or logid==0105040960"
            next
            edit 6
                set name "Event log id matched 3"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set utmevent "_any_"
                set subject "$groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,System"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0100020005 or logid==0100020006 or logid==0100020090 or logid==0100022901 or logid==0100022902 or logid==0100022912 or logid==0100022913 or logid==0100022915 or logid==0101023101 or logid==0101023102 or logid==0101039424 or logid==0101039425 or logid==0101039940 or logid==0101039943 or logid==0101039947 or logid==0101039948 or logid==0101039952 or logid==0101039953 or logid==0101040001 or logid==0101040002 or logid==0101040019 or logid==0101040038 or logid==0101040039 or logid==0101040101 or logid==0101040102 or logid==0101040118 or logid==0101037139"
            next
            edit 7
                set name "Event log id matched 4"
                set devtype FortiGate
                set severity low
                set logtype "event"
                set utmevent "_any_"
                set subject "$groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,System"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0100022950 or logid==0100022951 or logid==0100029002 or logid==0100029003 or logid==0100032001 or logid==0100032003 or logid==0102038031 or logid==0102038032 or logid==0102043008 or logid==0102043009 or logid==0102043014 or logid==0102043015 or logid==0102043016 or logid==0102043017 or logid==0102043025 or logid==0102043026 or logid==0102043039 or logid==0102043040 or logid==0102043045 or logid==0102043046"
            next
            edit 8
                set name "Event log id matched 5"
                set devtype FortiGate
                set severity low
                set logtype "event"
                set utmevent "_any_"
                set subject "$groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,System"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0107045114 or logid==0107045115 or logid==0107045116 or logid==0100022850 or logid==0100022851 or logid==0100043776 or logid==0100043777 or logid==0100046600"
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 30000
        set name "Default-Botnet-Communication-Detection"
        set description "Default event handler to detect botnet communication and report to FortiGate"
        set automation-stitch enable
        config rule
            edit 1
                set name "Traffic to Botnet CnC blocked in virus log"
                set devtype FortiGate
                set severity high
                set logtype "virus"
                set extrainfo "C&C: ${dstip}:${dstport}, Reference: ${ref}"
                set extrainfo-type custom
                set subject "Traffic to Botnet C&C $groupby2 blocked"
                set groupby1 "endpoint"
                set groupby2 "virus"
                set eventstatus "open"
                set tags "Default,Botnet,IP,C&C"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0202009248"
            next
            edit 2
                set name "Traffic to Botnet CnC detected in virus log"
                set devtype FortiGate
                set severity critical
                set logtype "virus"
                set extrainfo "C&C: ${dstip}:${dstport}, Reference: ${ref}"
                set extrainfo-type custom
                set subject "Traffic to Botnet C&C $groupby2 detected"
                set groupby1 "endpoint"
                set groupby2 "virus"
                set eventstatus "open"
                set tags "Default,Botnet,IP,C&C"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0202009249"
            next
            edit 3
                set name "DNS traffic to Botnet CnC blocked"
                set devtype FortiGate
                set severity high
                set logtype "dns"
                set extrainfo "Traffic path: ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "DNS traffic to Botnet C&C $groupby2 blocked"
                set groupby1 "endpoint"
                set groupby2 "qname"
                set eventstatus "open"
                set tags "Default,Botnet,Domain,C&C"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==1501054601 OR logid==1501054600"
            next
            edit 4
                set name "Traffic to Botnet CnC detected in ips log 1"
                set devtype FortiGate
                set severity critical
                set logtype "ips"
                set extrainfo "C&C: ${dstip}:${dstport}, Traffic path: ${devname} (Policy ID:${policyid})\\${dstintf}, Reference: ${ref}"
                set extrainfo-type custom
                set subject "Traffic to Botnet C&C $groupby2 detected"
                set groupby1 "endpoint"
                set groupby2 "attack"
                set eventstatus "open"
                set tags "Default,Botnet,Signature,C&C,Incoming"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "attack ~ Botnet and direction=incoming and (action=='detected' or action=='pass session')"
            next
            edit 5
                set name "Traffic to Botnet CnC blocked in ips log 1"
                set devtype FortiGate
                set severity high
                set logtype "ips"
                set extrainfo "C&C: ${dstip}:${dstport}, Traffic path: ${devname} (Policy ID:${policyid})\\${dstintf}, Reference: ${ref}"
                set extrainfo-type custom
                set subject "Traffic to Botnet C&C $groupby2 blocked"
                set groupby1 "endpoint"
                set groupby2 "attack"
                set eventstatus "open"
                set tags "Default,Botnet,Signature,C&C,Incoming"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "attack ~ Botnet and direction=incoming and action!='detected' and action!='pass session'"
            next
            edit 6
                set name "Traffic from Botnet CnC detected in ips log"
                set devtype FortiGate
                set severity critical
                set logtype "ips"
                set extrainfo "C&C: ${srcip}:${srcport}, Traffic path: ${devname} (Policy ID:${policyid})\\${srcintf}, Reference: ${ref}"
                set extrainfo-type custom
                set subject "Traffic from Botnet C&C $groupby2 detected"
                set groupby1 "dstendpoint"
                set groupby2 "attack"
                set eventstatus "open"
                set tags "Default,Botnet,Signature,C&C,Outgoing"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "attack ~ Botnet and direction=outgoing and (action=='detected' or action=='pass session')"
            next
            edit 7
                set name "Traffic from Botnet CnC blocked in ips log"
                set devtype FortiGate
                set severity high
                set logtype "ips"
                set extrainfo "C&C: ${srcip}:${srcport}, Traffic path: ${devname} (Policy ID:${policyid})\\${srcintf}, Reference: ${ref}"
                set extrainfo-type custom
                set subject "Traffic from Botnet C&C $groupby2 blocked"
                set groupby1 "dstendpoint"
                set groupby2 "attack"
                set eventstatus "open"
                set tags "Default,Botnet,Signature,C&C,Outgoing"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "attack ~ Botnet and direction=outgoing and action!='detected' and action!='pass session'"
            next
            edit 8
                set name "Traffic to Botnet CnC blocked in ips log 2"
                set devtype FortiGate
                set severity high
                set logtype "ips"
                set extrainfo "C&C: ${dstip}:${dstport}, Reference: ${ref}"
                set extrainfo-type custom
                set subject "Traffic to Botnet C&C $groupby2 blocked"
                set groupby1 "endpoint"
                set groupby2 "attack"
                set eventstatus "open"
                set tags "Default,Botnet,IP,C&C"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0422016400"
            next
            edit 9
                set name "Traffic to Botnet CnC detected in ips log 2"
                set devtype FortiGate
                set severity critical
                set logtype "ips"
                set extrainfo "C&C: ${dstip}:${dstport}, Reference: ${ref}"
                set extrainfo-type custom
                set subject "Traffic to Botnet C&C $groupby2 detected"
                set groupby1 "endpoint"
                set groupby2 "attack"
                set eventstatus "open"
                set tags "Default,Botnet,IP,C&C"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 30
                set filter-expr "logid==0422016401"
            next
        end
        set enable enable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 30001
        set name "Default-IPS-Signature-On-Hold"
        set description "Default Event Handler to show IPS signatures that are currently on-hold in FortiGate due to hold time settings."
        config rule
            edit 1
                set name "Signature is on hold"
                set devtype FortiGate
                set severity high
                set logtype "ips"
                set extrainfo "${msg}"
                set extrainfo-type custom
                set subject "Signature [ $groupby2 ] is on hold"
                set groupby1 "hostname"
                set groupby2 "attack"
                set tags "Default,IPS,Signature,Hold"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "msg~\"signature is on hold\" and (logid==0419016384)"
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 30002
        set name "Default-NOC-SD-WAN-Events"
        set description "Default handler for NoC sd-wan events"
        config rule
            edit 1
                set name "SLA failed for jitter"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set extrainfo "On ${devname} the SLA  for the ${healthcheck} failed for ${metric} with the current value of ${jitter} which violates the target ID ${slatargetid}.  "
                set extrainfo-type custom
                set utmevent "sdwan"
                set subject "$groupby1 SLA failed for $groupby2"
                set groupby1 "devname"
                set groupby2 "healthcheck"
                set eventstatus "auto"
                set tags "Default,NOC,SD-WAN"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "subtype==\"sdwan\" AND metric==\"jitter\" AND msg~\"SLA failed\""
            next
            edit 2
                set name "SLA failed for latency"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set extrainfo "On ${devname} the SLA  for the ${healthcheck} failed for ${metric} with the current value of ${latency} which violates the target ID ${slatargetid}.  "
                set extrainfo-type custom
                set utmevent "sdwan"
                set subject "$groupby1 SLA failed for $groupby2"
                set groupby1 "devname"
                set groupby2 "healthcheck"
                set eventstatus "auto"
                set tags "Default,NOC,SD-WAN"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "subtype==\"sdwan\" AND metric==\"latency\" AND msg~\"SLA failed\""
            next
            edit 3
                set name "SLA failed for packetloss"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set extrainfo "On ${devname} the SLA  for the ${healthcheck} failed for ${metric} with the current value of ${packetloss} which violates the target ID ${slatargetid}.  "
                set extrainfo-type custom
                set utmevent "sdwan"
                set subject "$groupby1 SLA failed for $groupby2"
                set groupby1 "devname"
                set groupby2 "healthcheck"
                set eventstatus "auto"
                set tags "Default,NOC,SD-WAN"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "subtype==\"sdwan\" AND metric==\"packetloss\" AND msg~\"SLA failed\""
            next
            edit 4
                set name "Device status changed to die"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "Device: ${devname} with status ${newvalue}. ${msg}."
                set extrainfo-type custom
                set utmevent "sdwan"
                set subject "$groupby1 $groupby2 status changed to die."
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,SD-WAN"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid=\"0113022925\" AND  newvalue=\"die\""
            next
            edit 5
                set name "Device status changed to alive."
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "Device: ${devname} with status ${newvalue}. ${msg}."
                set extrainfo-type custom
                set utmevent "sdwan"
                set subject "$groupby1 $groupby2 status changed to alive."
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,SD-WAN"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid=\"0113022925\" AND newvalue=\"alive\""
            next
            edit 6
                set name "Device status is up"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "Device: ${devname} ${msg} status is ${status}. "
                set extrainfo-type custom
                set utmevent "sdwan"
                set subject "$groupby1 health check for $groupby2 status up."
                set groupby1 "devname"
                set groupby2 "healthcheck"
                set eventstatus "auto"
                set tags "Default,NOC,SD-WAN"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid=\"0113022925\" AND status==\"up\""
            next
            edit 7
                set name "Device status is down"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "Device: ${devname} ${msg} status is ${status}. "
                set extrainfo-type custom
                set utmevent "sdwan"
                set subject "$groupby1 health check for $groupby2 status down."
                set groupby1 "devname"
                set groupby2 "healthcheck"
                set eventstatus "auto"
                set tags "Default,NOC,SD-WAN"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid=\"0113022925\" AND status==\"down\""
            next
            edit 8
                set name "Number of pass member changed"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "${msg} from ${oldvalue} to ${newvalue} for ${devname}"
                set extrainfo-type custom
                set utmevent "sdwan"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,SD-WAN"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid=\"0113022923\" AND msg=\"Number of pass member changed.\" "
            next
            edit 9
                set name "Member status changed"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "${msg}. Member is now ${member} on ${devname}"
                set extrainfo-type custom
                set utmevent "sdwan"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,SD-WAN"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid=\"0113022923\" AND msg=\"Member status changed. Member out-of-sla.\""
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 30003
        set name "Default-NOC-VPN-Events"
        set description "Default handler for NoC VPN events"
        config rule
            edit 1
                set name "User SSL VPN login failed"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set extrainfo "${logdesc} due to: ${reason}"
                set extrainfo-type custom
                set utmevent "vpn"
                set subject "$groupby1 SSL VPN login failed for user $groupby2"
                set groupby1 "devname"
                set groupby2 "enduser"
                set eventstatus "auto"
                set tags "Default,NOC,VPN"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==\"0101039426\" and action==\"ssl-login-fail\""
            next
            edit 2
                set name "IPsec phase 1 error or status fail detected"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set extrainfo "${logdesc} due to: ${status} with reason: ${reason}"
                set extrainfo-type custom
                set utmevent "vpn"
                set subject "$groupby1 $groupby2 detected"
                set groupby1 "devname"
                set groupby2 "msg"
                set eventstatus "auto"
                set tags "Default,NOC,VPN"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "(logid==\"0101037124\" OR logid==\"0101037120\") and (logdesc==\"IPsec phase 1 error\" OR status=\"fail\")"
            next
            edit 3
                set name "IPsec ESP error detected"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set extrainfo "${status} on: ${devname}, ${error_num}"
                set extrainfo-type custom
                set utmevent "vpn"
                set subject "$groupby1 $groupby2 error detected"
                set groupby1 "devname"
                set groupby2 "msg"
                set eventstatus "auto"
                set tags "Default,NOC,VPN"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==\"0101037131\" and logdesc==\"IPsec ESP\""
            next
            edit 4
                set name "IPsec DPD failed"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set extrainfo "${msg} on device: ${devname}"
                set extrainfo-type custom
                set utmevent "vpn"
                set subject "$groupby1 has experienced $groupby2"
                set groupby1 "devname"
                set groupby2 "msg"
                set eventstatus "auto"
                set tags "Default,NOC,VPN"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==\"0101037136\" and logdesc==\"IPsec DPD failed\" "
            next
            edit 5
                set name "Device tunnel-up or tunnel-down detected"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set extrainfo "${msg} due to: ${action}"
                set extrainfo-type custom
                set utmevent "vpn"
                set subject "$groupby1 status changed to $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,VPN"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid=\"0101037138\" and (action=\"tunnel-up\" or action= \"tunnel-down\") "
            next
            edit 6
                set name "IPsec phase 2 error detected"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set extrainfo "${logdesc} due to: ${reason}"
                set extrainfo-type custom
                set utmevent "vpn"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "msg"
                set eventstatus "auto"
                set tags "Default,NOC,VPN"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==\"0101037125\" and logdesc==\"IPsec phase 2 error\""
            next
            edit 7
                set name "Device phase2-up or phase2-down detected"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "${logdesc} due to: ${action}"
                set extrainfo-type custom
                set utmevent "vpn"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "msg"
                set eventstatus "auto"
                set tags "Default,NOC,VPN"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==\"0101037139\" and (action==\"phase2-up\" OR action==\"phase2-down\")"
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 30004
        set name "Default-NOC-System-Events"
        set description "Default handler for NoC system events"
        config rule
            edit 1
                set name "Device shutdown detected"
                set devtype FortiGate
                set severity critical
                set logtype "event"
                set extrainfo "${devname} experienced $logdesc with message: ${msg}"
                set extrainfo-type custom
                set utmevent "system"
                set subject "$groupby1 experienced a $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,System,Power,CPU,Memory,Storage"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logdesc=\"Device shutdown\""
            next
            edit 2
                set name "Device conserve mode detected"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set extrainfo "${logdesc} on Device: ${devname} with message ${msg}"
                set extrainfo-type custom
                set utmevent "system"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,System,Power,CPU,Memory,Storage"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logdesc==\"conserve mode\""
            next
            edit 3
                set name "Disk or memory is full"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set extrainfo "Device: ${devname} ${logdesc} with message: ${msg}"
                set extrainfo-type custom
                set utmevent "system"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,System,Power,CPU,Memory,Storage"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logdesc==\"Disk log full over first warning\" OR logdesc==\"Memory log full over first warning level\" OR logdesc==\"Memory log full over second warning level\" OR logdesc==\"Memory log full over final warning level\" OR logdesc==\"Disk full\" OR logdesc==\"Disk log rolled\" OR  logdesc==\"Log disk full\""
            next
            edit 4
                set name "Device high CPU consumption detected"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set extrainfo "${devid} performance cpu: ${cpu}"
                set extrainfo-type custom
                set utmevent "system"
                set subject "$groupby1 $groupby2 for CPU is high"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set tags "Default,NOC,System,Power,CPU,Memory,Storage"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "cpu>=\"80\" "
            next
            edit 5
                set name "Device high memory consumption detected"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "${devid} performance memory: ${memory}"
                set utmevent "system"
                set subject "$groupby1 $groupby2 for memory is high"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,System,Power,CPU,Memory,Storage"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "mem>=\"75\""
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 30005
        set name "Default-NOC-Fabric-Events"
        set description "Default handler for NoC Fabric events"
        config rule
            edit 1
                set name "Device offline detected"
                set devtype FortiAnalyzer
                set severity high
                set logtype "appevent"
                set utmevent "_any_"
                set extrainfo "${logdev_id} is offline"
                set extrainfo-type custom
                set subject "$groupby1 $groupby2"
                set groupby1 "logdev_name"
                set groupby2 "msg"
                set eventstatus "auto"
                set tags "Default,NOC,Fabric"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "desc=\"Device offline\""
            next
            edit 2
                set name "FortiAnalyzer connection down detected"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set utmevent "system"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "msg"
                set eventstatus "auto"
                set tags "Default,NOC,Fabric"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logdesc=\"FortiAnalyzer connection down\""
            next
            edit 3
                set name "Connection with authorized CSF member terminated"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set extrainfo "${logdesc} on: ${devid} due to: ${reason}"
                set extrainfo-type custom
                set utmevent "system"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "msg"
                set eventstatus "auto"
                set tags "Default,NOC,Fabric"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logdesc=\"Connection with authorized CSF member terminated\""
            next
            edit 4
                set name "Automation stitch triggered"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "${logdesc} on: ${devname} with message: ${msg} and stitch action: ${stitchaction}"
                set extrainfo-type custom
                set utmevent "system"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,Fabric"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logdesc=\"Automation stitch triggered\""
            next
            edit 5
                set name "Device license failed or expiring detected"
                set devtype FortiGate
                set severity critical
                set logtype "event"
                set extrainfo "${logdesc} on: ${devid} "
                set extrainfo-type custom
                set utmevent "system"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "msg"
                set eventstatus "auto"
                set tags "Default,NOC,Fabric"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logdesc~\"license failed\"  OR logdesc~\"license expiring\""
            next
            edit 6
                set name "System update or failure detected"
                set devtype FortiGate
                set severity critical
                set logtype "event"
                set extrainfo "${logdesc} on: ${devname} with message: ${msg}"
                set extrainfo-type custom
                set utmevent "system"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "msg"
                set eventstatus "auto"
                set tags "Default,NOC,Fabric"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logdesc~\"update\" AND logdesc~\"failed\""
            next
            edit 7
                set name "Security fabric settings change detected"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "Device: ${devname} change with message: ${msg}"
                set extrainfo-type custom
                set utmevent "system"
                set subject "$groupby1 security fabric settings change: $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,Fabric"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logdesc==\"Settings modified by Security Fabric service\" OR logdesc==\"Looped configuration in Security Fabric service\" OR logdesc==\"Connection with CSF member established and authorized\" OR logdesc==\"Connection with authorized CSF member terminated\" OR logdesc==\"Serial number of upstream is changed\""
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 30006
        set name "Default-NOC-Security-Events"
        set description "Default handler for NoC security events"
        config rule
            edit 1
                set name "Admin login failed or desabled"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set extrainfo "${logdesc} for ${user} on device: ${devname} due to: ${reason} with message: ${msg}"
                set extrainfo-type custom
                set utmevent "system"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,Security,Login,Password"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logdesc==\"Admin login failed\" OR logdesc==\"Admin login disabled\"OR logdesc==\"SSL VPN login fail\""
            next
            edit 2
                set name "Admin password expired"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set extrainfo "Device: ${devname} ${logdesc} with message: ${msg}"
                set extrainfo-type custom
                set utmevent "system"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC, Security,Login,Password"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logdesc==\"Admin password expired\""
            next
            edit 3
                set name "Admin disconnected"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set extrainfo "${logdesc} on device: ${devname} with message: ${msg}"
                set extrainfo-type custom
                set utmevent "system"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,Security,Login,Password"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logdesc==\"Admin disconnected\" OR logdesc==\"Admin monitor disconnected\" "
            next
            edit 4
                set name "AV or IPS change detected"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set extrainfo "Device: ${devname} ${logdesc} with message: ${msg}"
                set extrainfo-type custom
                set utmevent "system"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,Security,Login,Password"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logdesc==\"AV updated by admin\" OR logdesc==\"IPS package - Admin update successful\" OR logdesc==\"AV package update by SCP failed\" OR logdesc==\"IPS package failed to update via SCP\" OR logdesc==\"IPS custom signatures backup failed\""
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 30007
        set name "Default-NOC-Wireless-Events"
        set description "Default handler for NoC wireless events"
        config rule
            edit 1
                set name "Fake AP detected"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "${logdesc}. SN: ${sndetected}"
                set extrainfo-type custom
                set utmevent "wireless"
                set subject "$groupby1 Fake AP detected with SSID: $groupby2"
                set groupby1 "devname"
                set groupby2 "ssid"
                set eventstatus "auto"
                set tags "Default,NOC,Wireless,Wifi,AP"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid=\"0104043567\" AND logdesc==\"Fake AP detected\""
            next
            edit 2
                set name "Rogue AP detected"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "${logdesc}. SN: ${sndetected} with message: ${msg}"
                set extrainfo-type custom
                set utmevent "wireless"
                set subject "$groupby1 Rogue AP detected with SSID: $groupby2"
                set groupby1 "devname"
                set groupby2 "ssid"
                set eventstatus "auto"
                set tags "Default,NOC,Wireless,Wifi,AP"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==\"0104043563\" AND logdesc==\"Rogue AP detected\""
            next
            edit 3
                set name "Wireless event log id matched"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "${logdesc}. of AP: ${ap}"
                set extrainfo-type custom
                set utmevent "wireless"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "msg"
                set eventstatus "auto"
                set tags "Default,NOC,Wireless,Wifi,AP"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "subtype=\"wireless\" AND (logid==\"0104043551\" OR logid==\"0104043552\" OR logid==\"0104043553\")"
            next
            edit 4
                set name "Wireless client activity detected"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "${logdesc} for ${ssid} with message: ${msg}"
                set extrainfo-type custom
                set utmevent "wireless"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,Wireless,Wifi,AP"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "(logdesc==\"Wireless client associated\" OR logdesc==\"Wireless client authenticated\" OR logdesc==\"Wireless client disassociated\" OR logdesc==\"Wireless client deauthenticated\" OR logdesc==\"Wireless client idle\" OR logdesc==\"Wireless client denied\" OR logdesc==\"Wireless client kicked\" OR logdesc=\"Wireless client IP assigned\" OR logdesc==\"Wireless client left WTP\" OR logdesc==\"Wireless client WTP disconnected\")"
            next
            edit 5
                set name "Signal-to-noise ratio is poor"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "SSID ${ssid}. has a poor quality SNR at ${snr} dB."
                set extrainfo-type custom
                set utmevent "wireless"
                set subject "Signal-to-noise ratio on $groupby1 is poor"
                set groupby1 "devname"
                set eventstatus "auto"
                set tags "Default,NOC,Wireless,Wifi,AP"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "snr<=\"24\""
            next
            edit 6
                set name "Signal-to-noise ratio is fair"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "SSID ${ssid}. has fair quality SNR at ${snr} dB."
                set extrainfo-type custom
                set utmevent "wireless"
                set subject "Signal-to-noise ratio on $groupby1 is fair"
                set groupby1 "devname"
                set eventstatus "auto"
                set tags "Default,NOC,Wireless,Wifi,AP"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "snr>=\"25\" and snr<=\"40\""
            next
            edit 7
                set name "Signal-to-noise ratio on is excellent"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "SSID ${ssid}. has excellent quality SNR at ${snr} dB."
                set extrainfo-type custom
                set utmevent "wireless"
                set subject "Signal-to-noise ratio on $groupby1 is excellent"
                set groupby1 "devname"
                set eventstatus "auto"
                set tags "Default,NOC,Wireless,Wifi,AP"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "snr>=\"41\" "
            next
            edit 8
                set name "Physical AP radio ssid up"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "Device ${sn} SSID status change with message ${msg}."
                set extrainfo-type custom
                set utmevent "wireless"
                set subject "$groupby2 for $groupby1"
                set groupby1 "ssid"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,Wireless,Wifi,AP"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logdesc=\"Physical AP radio ssid up\" and action=\"ssid-up\""
            next
            edit 9
                set name "Physical AP radio ssid down"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "Device ${sn} SSID status change with message ${msg}."
                set extrainfo-type custom
                set utmevent "wireless"
                set subject "$groupby2 for $groupby1"
                set groupby1 "ssid"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,Wireless,Wifi,AP"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logdesc=\"Physical AP radio ssid down\" and action=\"ssid-down\""
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 30008
        set name "Default-NOC-HA-Events"
        set description "Default handler for NoC HA Cluster events"
        config rule
            edit 1
                set name "HA device interface failed"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set utmevent "ha"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "msg"
                set eventstatus "auto"
                set tags "Default,NOC,HA,Cluster"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logdesc==\"HA device interface failed\" and logid==\"0108037898\""
            next
            edit 2
                set name "Device set as HA primary"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set extrainfo "Device: ${devname} has been set to HA Primary with msg: ${msg}"
                set extrainfo-type custom
                set utmevent "ha"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,HA,Cluster"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logdesc==\"Device set as HA primary\""
            next
            edit 3
                set name "Cluster state moved or Heartbeat device interface down"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set extrainfo "Device: ${devname}  ${logdesc} with HA role: ${ha_role}"
                set extrainfo-type custom
                set utmevent "ha"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,HA,Cluster"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logdesc==\"Virtual cluster member state moved\" OR logdesc==\"Heartbeat device interface down\""
            next
            edit 4
                set name "Synchronization activity detected"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set extrainfo "HA synchronization status for Device: ${devname} ${logdesc}. Message: ${msg}. Status is: ${sync_status} "
                set extrainfo-type custom
                set utmevent "ha"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,HA,Cluster"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logdesc==\"HA secondary synchronization failed\" OR logdesc==\"Secondary sync failed\" OR logdesc=\"Synchronization status with master\""
            next
            edit 5
                set name "FortiAnalyzer connection up"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "Device ${devname} ${msg}."
                set extrainfo-type custom
                set utmevent "system"
                set subject "$groupby2 for $groupby1"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,HA,Cluster"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "action=\"connect\" and  status=\"success\" and logdesc=\"FortiAnalyzer connection up\""
            next
            edit 6
                set name "FortiAnalyzer connection failed"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set extrainfo "Device ${devname} ${msg}."
                set extrainfo-type custom
                set utmevent "system"
                set subject "$groupby2 for $groupby1"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,HA,Cluster"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "action=\"connect\" and status=\"failure\" and logdesc=\"FortiAnalyzer connection failed\""
            next
            edit 7
                set name "Upstream connection with CSF member established and authorized"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "Device ${devname} ${msg}."
                set extrainfo-type custom
                set utmevent "system"
                set subject "$groupby2 for device $groupby1"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,HA,Cluster"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction=\"upstream\" and logdesc=\"Connection with CSF member established and authorized\""
            next
            edit 8
                set name "Upstream connection with authorized CSF member terminated"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set extrainfo "Device ${devname} ${msg}."
                set extrainfo-type custom
                set utmevent "system"
                set subject "$groupby2 for device $groupby1"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,HA,Cluster"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction=\"upstream\" and logdesc=\"Connection with authorized CSF member terminated\""
            next
            edit 9
                set name "FortiManager tunnel connection up"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "Device ${devname} ${logdesc} with message - ${msg}."
                set extrainfo-type custom
                set utmevent "system"
                set subject "$groupby2 for device $groupby1"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,HA,Cluster"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "action=\"connect\" and status=\"success\" and logdesc=\"FortiManager tunnel connection up\""
            next
            edit 10
                set name "FortiManager tunnel connection down"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set extrainfo "Device ${devname} ${logdesc} with message - ${msg}."
                set extrainfo-type custom
                set utmevent "system"
                set subject "$groupby2 for device $groupby1"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,HA,Cluster"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "action=\"connect\" and status=\"failure\" and logdesc=\"FortiManager tunnel connection down\""
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 30009
        set name "Default-NOC-Switch-Events"
        set description "Default handler for NoC switch events"
        config rule
            edit 1
                set name "Switch-Controller activity detected"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "${logdesc}"
                set extrainfo-type custom
                set utmevent "_any_"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "msg"
                set eventstatus "auto"
                set tags "Default,NOC,Switch,Controller"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "(subtype=\"switch-controller\") and (logdesc==\"Switch-Controller discovered\" OR logdesc==\"Switch-Controller authorized\" OR logdesc==\"Switch-Controller deauthorized\" OR logdesc==\"Switch-Controller deleted\" OR logdesc==\"Switch-Controller warning\")"
            next
            edit 2
                set name "Vlan interface change has occurred"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "Device ${devname} interface vlan change with message: ${msg}"
                set extrainfo-type custom
                set utmevent "_any_"
                set subject "$groupby1 $groupby2 vlan interface change has occurred"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,Switch,Controller"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logdesc='FortiSwitch system' and msg~\"interface vlan\""
            next
            edit 3
                set name "Port switch detected"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "${logdesc} on Device: ${devname} with message: ${msg}"
                set extrainfo-type custom
                set utmevent "_any_"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "msg"
                set eventstatus "auto"
                set tags "Default,NOC,Switch,Controller"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logdesc=\"FortiSwitch link\" AND msg~\"switch port\""
            next
            edit 4
                set name "Device flap detected"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set utmevent "_any_"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "msg"
                set eventstatus "auto"
                set tags "Default,NOC,Switch,Controller"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "msg~\"flap\""
            next
            edit 5
                set name "Device LAG-MCLAG status change"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "Device: ${devname} LAG-MCLAG status update with message: ${msg}"
                set extrainfo-type custom
                set utmevent "_any_"
                set subject "$groupby1 $groupby2 LAG-MCLAG status change"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,Switch,Controller"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "msg~\"lag\" OR  msg~\"mclag\""
            next
            edit 6
                set name "Device MCLAG split-brain detected"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "Device ${devname} ${msg}."
                set extrainfo-type custom
                set utmevent "_any_"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,Switch,Controller"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "log_id=0115032695 and msg~\"MCLAG split-brain\""
            next
            edit 7
                set name "Deice cable diagnose detected"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "Device ${devname} ${msg}."
                set extrainfo-type custom
                set utmevent "_any_"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,Switch,Controller"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "log_id=0115032699 and  msg~\"CABLE DIAGNOSE\""
            next
            edit 8
                set name "Device come up detected"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "Device ${devname} ${msg}."
                set extrainfo-type custom
                set utmevent "_any_"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,Switch,Controller"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "log_id==\"0115032695\" and msg~\"come up\""
            next
            edit 9
                set name "Device gone down detected"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "Device ${devname} ${msg}."
                set extrainfo-type custom
                set utmevent "_any_"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,Switch,Controller"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "log_id==\"0115032695\" and msg~\"gone down\""
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 30010
        set name "Default-NOC-Network-Events"
        set description "Default handler for NOC network events"
        config rule
            edit 1
                set name "Device SNMP query failed"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set extrainfo "Device: ${devname} ${logdesc} with message: ${msg}"
                set extrainfo-type custom
                set utmevent "system"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,Network"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid=\"0100029021\" AND logdesc=\"SNMP query failed\""
            next
            edit 2
                set name "Device routing information changed"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set extrainfo "Device: ${devname} ${logdesc} with message ${msg}"
                set extrainfo-type custom
                set utmevent "system"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,Network"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logdesc==\"Routing information changed\""
            next
            edit 3
                set name "DHCP client lease granted or usage high"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set extrainfo "DHCP status on Device ${devname} is ${logdesc} with message: ${msg}"
                set extrainfo-type custom
                set utmevent "system"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,Network"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logdesc==\"DHCP client lease granted\" OR logdesc==\"DHCP lease usage high\" OR logdesc==\"DHCP lease usage full\""
            next
            edit 4
                set name "SNMP enabled"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "Device ${devname} ${logdesc} ${cfgattr} with message ${msg}."
                set extrainfo-type custom
                set utmevent "system"
                set subject "Device $groupby1 SNMP $groupby2 to Enable"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,Network"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "cfgpath=\"system.snmp.sysinfo\" and logdesc=\"Attribute configured\" and cfgattr=status[disable->enable]"
            next
            edit 5
                set name "SNMP disabled"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "Device ${devname} ${logdesc} ${cfgattr} with message ${msg}."
                set extrainfo-type custom
                set utmevent "system"
                set subject "Device $groupby1 SNMP $groupby2 to Disable"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,Network"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "cfgpath=\"system.snmp.sysinfo\" and logdesc=\"Attribute configured\" and cfgattr=status[enable->disable]"
            next
            edit 6
                set name "DHCP server status changed"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "DHCP server status change ${cfgattr} with message ${msg}."
                set extrainfo-type custom
                set utmevent "system"
                set subject "Device $groupby1 DHCP server $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,Network"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "cfgpath=\"system.dhcp.server\" and logdesc=\"Object attribute configured\""
            next
            edit 7
                set name "DHCP lease renewed"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "Host ${hostname} with message ${msg}."
                set extrainfo-type custom
                set utmevent "system"
                set subject "Device $groupby1 DHCP lease renewed. $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,Network"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "dhcp_msg=\"Ack\" and logdesc=\"DHCP Ack log\""
            next
            edit 8
                set name "DHCP lease released"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "Host ${hostname} with message ${msg}."
                set extrainfo-type custom
                set utmevent "system"
                set subject "Device $groupby1 DHCP lease released. $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,Network"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "dhcp_msg=\"Release\" and logdesc=\"DHCP Release log\""
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 30011
        set name "Default-NOC-Routing-Events"
        set description "Default handler for NoC routing events"
        config rule
            edit 1
                set name "Routing information changed"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "${logdesc} on ${devname} with message ${msg}  "
                set extrainfo-type custom
                set utmevent "_any_"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,Routing"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logdesc=\"Routing information changed\""
            next
            edit 2
                set name "BGP neighbor status changed"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "${devname}. BGP neighbor status changed with message ${msg}  "
                set extrainfo-type custom
                set utmevent "router"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,Routing"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logdesc=\"BGP neighbor status changed\""
            next
            edit 3
                set name "OSPF or OSPF6 neighbor status changed"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "${logdesc} on ${devname} with message ${msg}  "
                set extrainfo-type custom
                set utmevent "router"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,Routing"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logdesc==\"OSPF neighbor status changed\" OR logdesc==\"OSPF6 neighbor status changed\" "
            next
            edit 4
                set name "Neighbor table changed"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "${logdesc} on ${devname} with message ${msg}"
                set extrainfo-type custom
                set utmevent "router"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,Routing"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logdesc==\"neighbor table change\""
            next
            edit 5
                set name "VRRP state changed"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "${logdesc} on ${devname} with message ${msg}"
                set extrainfo-type custom
                set utmevent "router"
                set subject "$groupby1 $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,Routing"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logdesc==\"VRRP state changed\""
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 30013
        set name "Default-NOC-FortiExtender-Events"
        set description "Default handler for NoC FortiExtender events"
        config rule
            edit 1
                set name "FortiExtender Authorized"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "Device: ${ip} ${action} with message: ${msg}"
                set extrainfo-type custom
                set utmevent "fortiextender"
                set subject "$groupby1 $groupby2"
                set groupby1 "sn"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,FortiExtender"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "action=\"FortiExtender Authorized\""
            next
            edit 2
                set name "Warning event detected"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set extrainfo "${action} on ${ip} with message: ${msg}"
                set extrainfo-type custom
                set utmevent "fortiextender"
                set subject "$groupby1 $groupby2"
                set groupby1 "sn"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,FortiExtender"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "level=\"warning\""
            next
            edit 3
                set name "Alert event detected"
                set devtype FortiGate
                set severity high
                set logtype "event"
                set extrainfo "${action} on ${ip} with message: ${msg}"
                set extrainfo-type custom
                set utmevent "fortiextender"
                set subject "$groupby1 $groupby2"
                set groupby1 "sn"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,FortiExtender"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "level=\"alert\""
            next
            edit 4
                set name "Critical event detected"
                set devtype FortiGate
                set severity critical
                set logtype "event"
                set extrainfo "${action} on ${ip} with message: ${msg}"
                set extrainfo-type custom
                set utmevent "fortiextender"
                set subject "$groupby1 $groupby2"
                set groupby1 "sn"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,FortiExtender"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "level=\"critical\""
            next
            edit 5
                set name "Error event detected"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "${action} on ${ip} with message: ${msg}"
                set extrainfo-type custom
                set utmevent "fortiextender"
                set subject "$groupby1 $groupby2"
                set groupby1 "sn"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,FortiExtender"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "level=\"error\""
            next
            edit 6
                set name "Emergency event detected"
                set devtype FortiGate
                set severity critical
                set logtype "event"
                set extrainfo "${action} on ${ip} with message: ${msg}"
                set extrainfo-type custom
                set utmevent "fortiextender"
                set subject "$groupby1 $groupby2"
                set groupby1 "sn"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,FortiExtender"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "level=\"emergency\""
            next
            edit 7
                set name "FortiExtender controller activity detected"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "${action} on ${ip} with message: ${msg}"
                set extrainfo-type custom
                set utmevent "fortiextender"
                set subject "$groupby1 $groupby2"
                set groupby1 "sn"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,FortiExtender"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid=\"0111046401\" and logdesc=\"FortiExtender controller activity\""
            next
            edit 8
                set name "FortiExtender controller activity error detected"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "${action} on ${ip} with message: ${msg}"
                set extrainfo-type custom
                set utmevent "fortiextender"
                set subject "$groupby1 $groupby2"
                set groupby1 "sn"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,FortiExtender"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid=\"0111046402\" and logdesc=\"FortiExtender controller activity error\""
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 30014
        set name "Default-NOC-Interface-Events"
        set description "Default handler for NoC interface events"
        config rule
            edit 1
                set name "Interface status changed to up"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "Device ${devname}, status changed to ${status} with message ${msg}."
                set extrainfo-type custom
                set utmevent "system"
                set subject "Device $groupby1 $groupby2 to Up."
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,Interface"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "action=\"interface-stat-change\" and status=\"UP\""
            next
            edit 2
                set name "Interface status changed to down"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "Device ${devname}, status changed to ${status} with message ${msg}."
                set extrainfo-type custom
                set utmevent "system"
                set subject "Device $groupby1 $groupby2 to Down."
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,Interface"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "action=\"interface-stat-change\" and status=\"DOWN\""
            next
            edit 3
                set name "DNS server config added"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "Device ${devname}, DNS server status changed with message ${msg}."
                set extrainfo-type custom
                set utmevent "system"
                set subject "Device $groupby1 DNS Server $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,NOC,Interface,DNS"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "cfgpath=\"system.dns-server\" and action=\"Add\""
            next
            edit 4
                set name "DNS server config deleted"
                set devtype FortiGate
                set severity medium
                set logtype "event"
                set extrainfo "Device ${devname}, DNS server status changed with message ${msg}."
                set extrainfo-type custom
                set utmevent "system"
                set subject "Device $groupby1 DNS Server $groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set tags "Default,NOC,Interface,DNS"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "cfgpath=\"system.dns-server\" and action=\"Delete\""
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 30015
        set name "Default-Recon-Activity-By-Endpoint"
        set description "Default Handler for Recon Activity detection on the network - Scans/Probes/Attempted Access category"
        set data-selector "30015"
        config rule
            edit 1
                set name "SSH IP scanning detected"
                set devtype FortiGate
                set severity medium
                set logtype "traffic"
                set extrainfo "Recon activity from: ${srcip}:${srcport} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "IP scanning on Port: $groupby2 detected"
                set groupby1 "endpoint"
                set groupby2 "dstport"
                set eventstatus "open"
                set tags "Default,Risky,Recon,SSH"
                set filter-relation 0
                set aggregate-expr "COUNT_DISTINCT(dstip) >= 100"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "service"
                        set value "SSH"
                        set oper equal
                    next
                end
            next
            edit 2
                set name "FTP IP scanning detected"
                set devtype FortiGate
                set severity medium
                set logtype "traffic"
                set extrainfo "Recon activity from: ${srcip}:${srcport} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "IP scanning on Port: $groupby2 detected"
                set groupby1 "endpoint"
                set groupby2 "dstport"
                set eventstatus "open"
                set tags "Default,Risky,Recon,FTP"
                set filter-relation 0
                set aggregate-expr "COUNT_DISTINCT(dstip) >= 10"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "service"
                        set value "FTP"
                        set oper equal
                    next
                end
            next
            edit 3
                set name "RDP IP scanning detected"
                set devtype FortiGate
                set severity medium
                set logtype "traffic"
                set extrainfo "Recon activity from: ${srcip}:${srcport} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "IP scanning on Port: $groupby2 detected"
                set groupby1 "endpoint"
                set groupby2 "dstport"
                set eventstatus "open"
                set tags "Default,Risky,Recon,RDP"
                set filter-relation 0
                set aggregate-expr "COUNT_DISTINCT(dstip) >= 15"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "service"
                        set value "RDP"
                        set oper equal
                    next
                end
            next
            edit 4
                set name "HTTPS IP scanning detected"
                set devtype FortiGate
                set severity medium
                set logtype "traffic"
                set extrainfo "Recon activity from: ${srcip}:${srcport} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "IP scanning on Port: $groupby2 detected"
                set groupby1 "endpoint"
                set groupby2 "dstport"
                set eventstatus "open"
                set tags "Default,Risky,Recon,HTTPS"
                set filter-relation 0
                set aggregate-expr "COUNT_DISTINCT(dstip) >= 30"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "service"
                        set value "HTTPS"
                        set oper equal
                    next
                end
            next
            edit 5
                set name "DNS IP scanning detected"
                set devtype FortiGate
                set severity medium
                set logtype "traffic"
                set extrainfo "Recon activity from: ${srcip}:${srcport} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "IP scanning on Port: $groupby2 detected"
                set groupby1 "endpoint"
                set groupby2 "dstport"
                set eventstatus "open"
                set tags "Default,Risky,Recon,DNS"
                set filter-relation 0
                set aggregate-expr "COUNT_DISTINCT(dstip) >= 300"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "service"
                        set value "DNS"
                        set oper equal
                    next
                end
            next
            edit 6
                set name "LDAP IP scanning detected"
                set devtype FortiGate
                set severity medium
                set logtype "traffic"
                set extrainfo "Recon activity from: ${srcip}:${srcport} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "IP scanning on Port: $groupby2 detected"
                set groupby1 "endpoint"
                set groupby2 "dstport"
                set eventstatus "open"
                set tags "Default,Risky,Recon,LDAP"
                set filter-relation 0
                set aggregate-expr "COUNT_DISTINCT(dstip) >= 35"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "service"
                        set value "LDAP"
                        set oper equal
                    next
                end
            next
            edit 7
                set name "ICMP IP scanning detected"
                set devtype FortiGate
                set severity medium
                set logtype "traffic"
                set extrainfo "Recon activity from: ${srcip} detected"
                set extrainfo-type custom
                set subject "IP scanning on source endpoint: $groupby1 detected"
                set groupby1 "endpoint"
                set eventstatus "open"
                set tags "Default,Risky,Recon,ICMP"
                set filter-relation 0
                set aggregate-expr "COUNT_DISTINCT(dstip) >= 200"
                set thres-duration 1440
                set filter-expr "service~icmp"
            next
            edit 8
                set name "SMB IP scanning detected"
                set devtype FortiGate
                set severity medium
                set logtype "traffic"
                set extrainfo "Recon activity from: ${srcip}:${srcport} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "IP scanning on Port: $groupby2 detected"
                set groupby1 "endpoint"
                set groupby2 "dstport"
                set eventstatus "open"
                set tags "Default,Risky,Recon,SMB"
                set filter-relation 0
                set aggregate-expr "COUNT_DISTINCT(dstip) >= 50"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "service"
                        set value "SMB"
                        set oper equal
                    next
                end
            next
            edit 9
                set name "SNMP IP scanning detected"
                set devtype FortiGate
                set severity medium
                set logtype "traffic"
                set extrainfo "Recon activity from: ${srcip}:${srcport} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "IP scanning on Port: $groupby2 detected"
                set groupby1 "endpoint"
                set groupby2 "dstport"
                set eventstatus "open"
                set tags "Default,Risky,Recon,SNMP"
                set filter-relation 0
                set aggregate-expr "COUNT_DISTINCT(dstip) >= 150"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "service"
                        set value "SNMP"
                        set oper equal
                    next
                end
            next
            edit 10
                set name "SMTP IP scanning detected"
                set devtype FortiGate
                set severity medium
                set logtype "traffic"
                set extrainfo "Recon activity from: ${srcip}:${srcport} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "IP scanning on Port: $groupby2 detected"
                set groupby1 "endpoint"
                set groupby2 "dstport"
                set eventstatus "open"
                set tags "Default,Risky,Recon,SMTP"
                set filter-relation 0
                set aggregate-expr "COUNT_DISTINCT(dstip) >= 21"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "service"
                        set value "SMTP"
                        set oper equal
                    next
                end
            next
            edit 11
                set name "RPC IP scanning detected"
                set devtype FortiGate
                set severity medium
                set logtype "traffic"
                set extrainfo "Recon activity from: ${srcip}:${srcport} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "IP scanning on Port: $groupby2 detected"
                set groupby1 "endpoint"
                set groupby2 "dstport"
                set eventstatus "open"
                set tags "Default,Risky,Recon,RPC"
                set filter-relation 0
                set aggregate-expr "COUNT_DISTINCT(dstip) >= 10"
                set thres-duration 1440
                set filter-expr "(service~rpc or app~rpc)"
            next
        end
        set enable enable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 30016
        set name "Default-Shadow-IT-Events"
        set description "Default event handler to detect unsanctioned user, application and file exfiltration for cloud access. This handler need connect FortiAnalyzer to FortiCasb."
        config rule
            edit 1
                set name "Unsanctioned Applications detected"
                set devtype FortiGate
                set severity high
                set logtype "app-ctrl"
                set extrainfo "Unsanctioned application ${app} with app risk: ${apprisk} detected on: ${devname} with message: ${msg}"
                set extrainfo-type custom
                set subject "Unsanctioned Applications detected"
                set groupby1 "srcip"
                set groupby2 "app"
                set eventstatus "open"
                set tags "Default,Unsanctioned_App"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "(siflags & 1) == 0 && siappid >= 0"
            next
            edit 2
                set name "File Exfiltration Attempts detected"
                set devtype FortiGate
                set severity high
                set logtype "app-ctrl"
                set extrainfo "File exfiltration detected on: ${devname} with message: ${msg}"
                set extrainfo-type custom
                set subject "File Exfiltration Attempts detected"
                set groupby1 "srcip"
                set groupby2 "app"
                set eventstatus "open"
                set tags "Default,File_Exfiltration"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "(siflags & 4) == 4"
            next
            edit 3
                set name "Unsanctioned Users detected"
                set devtype FortiGate
                set severity high
                set logtype "app-ctrl"
                set extrainfo "Unsanctioned user: ${unauthuser} with app risk: ${apprisk} detected on: ${devname} with message: ${msg}"
                set extrainfo-type custom
                set subject "Unsanctioned Users detected"
                set groupby1 "srcip"
                set groupby2 "app"
                set eventstatus "open"
                set tags "Default,Unsanctioned_User"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "(siflags & 1) == 1 && (siflags & 2) == 0"
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
    edit 30017
        set handler-id "30017"
        set name "Default-Traffic-Consuming-High-Network-Brandwidth"
        set uuid ""
        set content-pack-uuid ""
        set content-pack-id ""
        set version 2
        set creation-time 0
        set enable-time 0
        set update-time 0
        set description "This handler is to detect if an endpoint consumed high brandwidth."
        set automation-stitch disable
        set notification ""
        set data-selector ""
        config rule
            edit 1
                set rule-id "1"
                set name "Traffic consuming high brandwidth groupby endpoint"
                set tags "brandwidth"
                set subject "High brandwidth endpoint $groupby1 detected"
                set devtype FortiGate
                set logtype "traffic"
                set utmevent ""
                set groupby1 "endpoint"
                set groupby2 ""
                set groupby3 ""
                set eventstatus "open"
                set extrainfo-type default
                set severity medium
                set enable enable
                set thres-duration 20
                set filter-relation 1
                set filter-expr ""
                set aggregate-expr "SUM(sentbyte) >= 1G"
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fgt"
    next
end

config alert correlation-handler
    edit aeb_aa9_90e_406
        set handler-id "aeb_aa9_90e_406"
        set name "Default-Suspicious-Traffic-From-Infected-Endpoint"
        set uuid ""
        set content-pack-uuid ""
        set content-pack-id ""
        set version 2
        set creation-time 0
        set enable-time 0
        set update-time 0
        set description "This is to detect if an endpoint is infected and there is a large traffic from the same endpoint."
        set automation-stitch disable
        set thres-duration 30
        set rule-relation "(6f6_eaf_abf_a02 OR 236_c74_808_236 OR 9e7_3dd_724_198 OR c94_9fd_802_c98) FOLLOWED_BY[15m] e9c_3e6_d6f_af6"
        set rule-relation-constraint "6f6_eaf_abf_a02.endpoint=236_c74_808_236.endpoint AND 236_c74_808_236.endpoint=9e7_3dd_724_198.endpoint AND 9e7_3dd_724_198.endpoint=c94_9fd_802_c98.endpoint AND c94_9fd_802_c98.endpoint=e9c_3e6_d6f_af6.endpoint"
        set eventstatus "auto"
        set extrainfo-type default
        set severity medium
        set tags "CnC"
        set notification ""
        set data-selector ""
        config rule
            edit 6f6_eaf_abf_a02
                set rule-id "6f6_eaf_abf_a02"
                set name "Traffic to Botnet CnC detected or blocked in virus log"
                set devtype FortiGate
                set logtype "virus"
                set utmevent ""
                set groupby1 "endpoint"
                set groupby2 ""
                set groupby3 ""
                set filter-relation 1
                set filter-expr ""
                set aggregate-expr "COUNT(*)>=1"
                config filter
                    edit 1
                        set id 1
                        set key "logid"
                        set value "0202009248"
                        set oper equal
                    next
                    edit 2
                        set id 2
                        set key "logid"
                        set value "0202009249"
                        set oper equal
                    next
                end
            next
            edit 236_c74_808_236
                set rule-id "236_c74_808_236"
                set name "Traffic to CnC detected"
                set devtype FortiGate
                set logtype "traffic"
                set utmevent ""
                set groupby1 "endpoint"
                set groupby2 ""
                set groupby3 ""
                set filter-relation 1
                set filter-expr "tdtype~infected"
                set aggregate-expr "COUNT(*)>=1"
            next
            edit 9e7_3dd_724_198
                set rule-id "9e7_3dd_724_198"
                set name "Web traffic to CnC detected"
                set devtype FortiGate
                set logtype "webfilter"
                set utmevent ""
                set groupby1 "endpoint"
                set groupby2 ""
                set groupby3 ""
                set filter-relation 1
                set filter-expr "tdtype~infected"
                set aggregate-expr "COUNT(*)>=1"
            next
            edit c94_9fd_802_c98
                set rule-id "c94_9fd_802_c98"
                set name "DNS traffic to CnC detected"
                set devtype FortiGate
                set logtype "dns"
                set utmevent ""
                set groupby1 "endpoint"
                set groupby2 ""
                set groupby3 ""
                set filter-relation 1
                set filter-expr "tdtype~infected"
                set aggregate-expr "COUNT(*)>=1"
            next
            edit e9c_3e6_d6f_af6
                set rule-id "e9c_3e6_d6f_af6"
                set name "Traffic from endpoint"
                set devtype FortiGate
                set logtype "traffic"
                set utmevent ""
                set groupby1 "endpoint"
                set groupby2 ""
                set groupby3 ""
                set filter-relation 1
                set filter-expr ""
                set aggregate-expr "SUM(sentbyte) >= 100M"
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/correlation-handler/fgt"
    next
    edit be8_c97_0c7_961
        set handler-id "be8_c97_0c7_961"
        set name "Default-Brute-Force-Account-Login-Attack-FGT"
        set uuid ""
        set content-pack-uuid ""
        set content-pack-id ""
        set version 2
        set creation-time 0
        set enable-time 0
        set update-time 0
        set description "This handler is to detect if an account login failed many times not followed by a login success for FortiGate."
        set automation-stitch disable
        set thres-duration 30
        set rule-relation "d31_1e5_630_2dd NOT_FOLLOWED_BY[5m] a83_c0a_9f1_ab1"
        set rule-relation-constraint "d31_1e5_630_2dd.devid=a83_c0a_9f1_ab1.devid"
        set eventstatus "auto"
        set extrainfo-type default
        set severity medium
        set tags "login,attack"
        set notification ""
        set data-selector ""
        config rule
            edit d31_1e5_630_2dd
                set rule-id "d31_1e5_630_2dd"
                set name "Login Failed 5 times"
                set devtype FortiGate
                set logtype "event"
                set utmevent "system"
                set groupby1 "devid"
                set groupby2 ""
                set groupby3 ""
                set filter-relation 1
                set filter-expr ""
                set aggregate-expr "COUNT(*) >= 5"
                config filter
                    edit 1
                        set id 1
                        set key "logid"
                        set value "0100032002"
                        set oper equal
                    next
                end
            next
            edit a83_c0a_9f1_ab1
                set rule-id "a83_c0a_9f1_ab1"
                set name "Login-Success"
                set devtype FortiGate
                set logtype "event"
                set utmevent "system"
                set groupby1 "devid"
                set groupby2 ""
                set groupby3 ""
                set filter-relation 1
                set filter-expr ""
                set aggregate-expr "COUNT(*)>=1"
                config filter
                    edit 1
                        set id 1
                        set key "logid"
                        set value "0100032001"
                        set oper equal
                    next
                end
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/correlation-handler/fgt"
    next
end

config ueba user-display-preference
    edit 1
        set status 1
        set userattr "name"
        set preference "FortiClient,LinkedIn,Google,FSSO,Salesforce"
    next
    edit 2
        set status 1
        set userattr "picture"
        set preference "FortiClient_User_Upload,FortiClient_Localhost,Windows,LinkedIn,Google,Salesforce"
    next
    edit 3
        set status 0
        set userattr "email"
        set preference "FortiClient,LinkedIn,Google,Salesforce"
    next
    edit 4
        set status 0
        set userattr "phoneno"
        set preference "FortiClient"
    next
    edit 5
        set status 0
        set userattr "social"
        set preference "FortiClient,Facebook,LinkedIn,Google,Salesforce"
    next
end

config ueba ioc-rescan
    set status disable
    set logtype 7
    set last-ndays 14
    set frequency 1
end

config alert default-view-assignment
    edit 1
        set view "0e917752-f81b-4db8-b57d-1d6d8e3c83e0"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOS"
    next
    edit 2
        set view "0e917752-f81b-4db8-b57d-1d6d8e3c83e0"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOC"
    next
    edit 3
        set view "0e917752-f81b-4db8-b57d-1d6d8e3c83e0"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FSF"
    next
    edit 4
        set view "487bb281-c0b5-4651-800f-6461f283a385"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOS"
    next
    edit 5
        set view "487bb281-c0b5-4651-800f-6461f283a385"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOC"
    next
    edit 6
        set view "487bb281-c0b5-4651-800f-6461f283a385"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FSF"
    next
    edit 7
        set view "d4655e5c-51c8-4b88-942a-b9279dd5dc32"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOS"
    next
    edit 8
        set view "d4655e5c-51c8-4b88-942a-b9279dd5dc32"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOC"
    next
    edit 9
        set view "d4655e5c-51c8-4b88-942a-b9279dd5dc32"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FSF"
    next
    edit 10
        set view "1a32dde4-f670-4ca7-9d7a-4955b1ea2d7e"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOS"
    next
    edit 11
        set view "1a32dde4-f670-4ca7-9d7a-4955b1ea2d7e"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOC"
    next
    edit 12
        set view "1a32dde4-f670-4ca7-9d7a-4955b1ea2d7e"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FSF"
    next
    edit 13
        set view "a411f12e-4b5b-4dcd-85ce-12b0aecbf31f"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOS"
    next
    edit 14
        set view "a411f12e-4b5b-4dcd-85ce-12b0aecbf31f"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOC"
    next
    edit 15
        set view "a411f12e-4b5b-4dcd-85ce-12b0aecbf31f"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FSF"
    next
    edit 16
        set view "225eb4bb-289c-4587-abb0-82bd9b7de22f"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOS"
    next
    edit 17
        set view "225eb4bb-289c-4587-abb0-82bd9b7de22f"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOC"
    next
    edit 18
        set view "225eb4bb-289c-4587-abb0-82bd9b7de22f"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FSF"
    next
    edit 19
        set view "78c10bad-22c1-482d-bebd-d8c0aba258c7"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOS"
    next
    edit 20
        set view "78c10bad-22c1-482d-bebd-d8c0aba258c7"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOC"
    next
    edit 21
        set view "78c10bad-22c1-482d-bebd-d8c0aba258c7"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FSF"
    next
    edit 22
        set view "626fcd4d-2013-4047-9903-5d31a3442be6"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOS"
    next
    edit 23
        set view "626fcd4d-2013-4047-9903-5d31a3442be6"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOC"
    next
    edit 24
        set view "626fcd4d-2013-4047-9903-5d31a3442be6"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FSF"
    next
    edit 25
        set view "f323508a-8668-4697-8890-1e4e21e72f47"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOS"
    next
    edit 26
        set view "f323508a-8668-4697-8890-1e4e21e72f47"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOC"
    next
    edit 27
        set view "f323508a-8668-4697-8890-1e4e21e72f47"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FSF"
    next
    edit 28
        set view "a147f0b1-61e9-4673-9190-30acb77ded75"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOS"
    next
    edit 29
        set view "a147f0b1-61e9-4673-9190-30acb77ded75"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOC"
    next
    edit 30
        set view "a147f0b1-61e9-4673-9190-30acb77ded75"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FSF"
    next
    edit 31
        set view "a860959e-0825-4476-9eeb-d36c41585f97"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOS"
    next
    edit 32
        set view "a860959e-0825-4476-9eeb-d36c41585f97"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOC"
    next
    edit 33
        set view "a860959e-0825-4476-9eeb-d36c41585f97"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FSF"
    next
    edit 34
        set view "00599895-4e24-4f24-867a-fc784cd9e6b3"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOS"
    next
    edit 35
        set view "00599895-4e24-4f24-867a-fc784cd9e6b3"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOC"
    next
    edit 36
        set view "00599895-4e24-4f24-867a-fc784cd9e6b3"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FSF"
    next
    edit 37
        set view "5c1e3d0e-4e36-42da-a9c1-60fe3510bc44"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOS"
    next
    edit 38
        set view "5c1e3d0e-4e36-42da-a9c1-60fe3510bc44"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOC"
    next
    edit 39
        set view "5c1e3d0e-4e36-42da-a9c1-60fe3510bc44"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FSF"
    next
    edit 40
        set view "043467f3-d82a-4ca0-9bb3-3125ca99ae33"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOS"
    next
    edit 41
        set view "043467f3-d82a-4ca0-9bb3-3125ca99ae33"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOC"
    next
    edit 42
        set view "043467f3-d82a-4ca0-9bb3-3125ca99ae33"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FSF"
    next
    edit 43
        set view "d53b589a-5d25-458c-b8f1-d5d4f370b9eb"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOS"
    next
    edit 44
        set view "d53b589a-5d25-458c-b8f1-d5d4f370b9eb"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOC"
    next
    edit 45
        set view "d53b589a-5d25-458c-b8f1-d5d4f370b9eb"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FSF"
    next
    edit 46
        set view "4c2ad19e-fd4e-416e-b0bd-3ca59f5b3a93"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOS"
    next
    edit 47
        set view "4c2ad19e-fd4e-416e-b0bd-3ca59f5b3a93"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOC"
    next
    edit 48
        set view "4c2ad19e-fd4e-416e-b0bd-3ca59f5b3a93"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FSF"
    next
    edit 49
        set view "de52e03a-2e38-4db3-8f20-5abd955abb18"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOS"
    next
    edit 50
        set view "4a51611b-5761-4204-883f-121c70cf7df0"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOS"
    next
    edit 51
        set view "4a51611b-5761-4204-883f-121c70cf7df0"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOC"
    next
    edit 52
        set view "4a51611b-5761-4204-883f-121c70cf7df0"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FSF"
    next
    edit 53
        set view "b28890c6-ced3-4823-b1ca-5ddd8a81569c"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FSF"
    next
    edit 54
        set view "aa35a383-08d9-48da-9b1e-5c6b35217a13"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FOS"
    next
    edit 55
        set view "de52e03a-2e38-4db3-8f20-5abd955abb18"
        set dvm_res_prod "DVM_RESTRICTED_PRD_FSF"
    next
end

config alert default-view-parents
    edit 1
        set uuid "3787103a-faa9-474a-ae40-58be4a0ba06b"
        set name "By Endpoint"
        set icon "ffg ffg-users"
    next
    edit 2
        set uuid "070a3295-91c5-4d46-9bf2-73cb52fa952c"
        set name "By Threat"
        set icon "ffg ffg-threats"
    next
    edit 3
        set uuid "944d437d-8494-445d-8f93-5756ec551fbd"
        set name "System Events"
        set icon "ffg ffg-eventlog"
    next
    edit 4
        set uuid "43aeb9b2-f6fb-4c79-91d2-c74dc86c390c"
        set name "Custom View"
        set icon "ffg ffg-custom-view"
    next
end

config alert default-views
    edit 1
        set uuid "0e917752-f81b-4db8-b57d-1d6d8e3c83e0"
        set name "All Security Events"
        set parent "3787103a-faa9-474a-ae40-58be4a0ba06b"
        set filters "tag='Default' and tag='By_endpoint'"
    next
    edit 2
        set uuid "487bb281-c0b5-4651-800f-6461f283a385"
        set name "Compromised Hosts"
        set parent "3787103a-faa9-474a-ae40-58be4a0ba06b"
        set filters "tag='Default' and tag='C&C' and tag='By_endpoint'"
    next
    edit 3
        set uuid "626fcd4d-2013-4047-9903-5d31a3442be6"
        set name "Sandbox Detections"
        set parent "3787103a-faa9-474a-ae40-58be4a0ba06b"
        set filters "tag='Default' and tag='Sandbox,By_endpoint'"
    next
    edit 4
        set uuid "a411f12e-4b5b-4dcd-85ce-12b0aecbf31f"
        set name "Malware Activity"
        set parent "3787103a-faa9-474a-ae40-58be4a0ba06b"
        set filters "tag='Default' and tag='Malware,By_endpoint'"
    next
    edit 5
        set uuid "78c10bad-22c1-482d-bebd-d8c0aba258c7"
        set name "Ongoing Intrusions"
        set parent "3787103a-faa9-474a-ae40-58be4a0ba06b"
        set filters "tag='Default' and tag='Intrusion,By_endpoint'"
    next
    edit 6
        set uuid "225eb4bb-289c-4587-abb0-82bd9b7de22f"
        set name "Malicious Domain/URL Access"
        set parent "3787103a-faa9-474a-ae40-58be4a0ba06b"
        set filters "tag='Default' and tag='Risky,By_endpoint' and (tag='URL' or tag='Domain')"
    next
    edit 7
        set uuid "a860959e-0825-4476-9eeb-d36c41585f97"
        set name "High Risk App Usage"
        set parent "3787103a-faa9-474a-ae40-58be4a0ba06b"
        set filters "tag='Default' and tag='Risky,App,By_endpoint'"
    next
    edit 8
        set uuid "f323508a-8668-4697-8890-1e4e21e72f47"
        set name "All Security Events"
        set parent "070a3295-91c5-4d46-9bf2-73cb52fa952c"
        set filters "tag='Default' and tag='By_threat'"
    next
    edit 9
        set uuid "a147f0b1-61e9-4673-9190-30acb77ded75"
        set name "C&C Call Backs"
        set parent "070a3295-91c5-4d46-9bf2-73cb52fa952c"
        set filters "tag='Default' and tag='By_threat' and tag='C&C'"
    next
    edit 10
        set uuid "00599895-4e24-4f24-867a-fc784cd9e6b3"
        set name "Sandbox Detections"
        set parent "070a3295-91c5-4d46-9bf2-73cb52fa952c"
        set filters "tag='Default' and tag='Sandbox,By_threat'"
    next
    edit 11
        set uuid "5c1e3d0e-4e36-42da-a9c1-60fe3510bc44"
        set name "Malware Activity"
        set parent "070a3295-91c5-4d46-9bf2-73cb52fa952c"
        set filters "tag='Default' and tag='Malware,By_threat'"
    next
    edit 12
        set uuid "043467f3-d82a-4ca0-9bb3-3125ca99ae33"
        set name "Ongoing Intrusions"
        set parent "070a3295-91c5-4d46-9bf2-73cb52fa952c"
        set filters "tag='Default' and tag='Intrusion,By_threat'"
    next
    edit 13
        set uuid "d53b589a-5d25-458c-b8f1-d5d4f370b9eb"
        set name "Malicious Domain/URL Access"
        set parent "070a3295-91c5-4d46-9bf2-73cb52fa952c"
        set filters "tag='Default' and tag='Risky,By_threat' and (tag='URL' or tag='Domain')"
    next
    edit 14
        set uuid "4c2ad19e-fd4e-416e-b0bd-3ca59f5b3a93"
        set name "High Risk App Usage"
        set parent "070a3295-91c5-4d46-9bf2-73cb52fa952c"
        set filters "tag='Default' and tag='Risky,App,By_threat'"
    next
    edit 15
        set uuid "de52e03a-2e38-4db3-8f20-5abd955abb18"
        set name "Local Device"
        set parent "944d437d-8494-445d-8f93-5756ec551fbd"
        set filters "tag='Default' and tag='Local,system'"
    next
    edit 16
        set uuid "4a51611b-5761-4204-883f-121c70cf7df0"
        set name "All"
        set parent "944d437d-8494-445d-8f93-5756ec551fbd"
        set filters "tag='Default' and tag='System'"
    next
    edit 17
        set uuid "b28890c6-ced3-4823-b1ca-5ddd8a81569c"
        set name "FortiGate"
        set parent "944d437d-8494-445d-8f93-5756ec551fbd"
        set filters "tag='Default' and tag='System' and devtype='FortiGate'"
    next
    edit 18
        set uuid "aa35a383-08d9-48da-9b1e-5c6b35217a13"
        set name "FortiGate"
        set parent "944d437d-8494-445d-8f93-5756ec551fbd"
        set filters "tag='Default' and tag='System' and devtype='FortiGate'"
    next
end

config system connectors
    edit 2
        set uuid "2edd7118-3b0e-448b-bebe-ca7b53a33d9d"
        set name "FortiOS Connector"
        set description "Connector to FortiOS operations"
        set status enable
        set type FOS
    next
end


config sql-report dataset

    edit "fml-History-Top-Client-IP"
        set description "FortiMail history top client IP"
        set dev-type FortiMail
        set log-type history
        set query "select coalesce(ipstr(`client_ip`), client_name) as clientip, count(*) as totalnum from $log where $filter group by clientip having coalesce(ipstr(`client_ip`), client_name) is not null order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Local-User"
        set description "FortiMail history top local user"
        set dev-type FortiMail
        set log-type history
        set query "select local_user, count(*) as totalnum from (select (case when direction='in' then `to` when direction='out' then `from` else NULL end) as local_user from $log where $filter) t where local_user is not null group by local_user order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Remote-Address"
        set description "FortiMail history top remote address"
        set dev-type FortiMail
        set log-type history
        set query "select remote_addr, count(*) as totalnum from (select (case when direction='out' then `to` when direction='in' then `from` else NULL end) as remote_addr from $log where $filter) t where remote_addr is not null group by remote_addr order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Virus"
        set description "FortiMail history top virus"
        set dev-type FortiMail
        set log-type history
        set query "select virus, count(*) as totalnum from $log where $filter and virus is not null group by virus order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Client-MSISDN"
        set description "FortiMail history top client msisdn"
        set dev-type FortiMail
        set log-type history
        set query "select msisdn, count(*) as totalnum from $log where $filter and msisdn is not null group by msisdn order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Client-Endpoint"
        set description "FortiMail history top client endpoint"
        set dev-type FortiMail
        set log-type history
        set query "select endpoint, sum(totalnum) as totalnum from ###(select endpoint, `from`, virus, count(*) as totalnum from $log where $filter and endpoint is not null group by endpoint, `from`, virus order by totalnum desc)### t group by endpoint order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Sender"
        set description "FortiMail history top sender"
        set dev-type FortiMail
        set log-type history
        set query "select `from` as sender, sum(totalnum) as totalnum from ###(select `from`, virus, direction, count(*) as totalnum from $log where $filter and `from` is not null group by `from`, virus, direction order by totalnum desc)### t group by sender order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Sender-IP"
        set description "FortiMail history top sender IP"
        set dev-type FortiMail
        set log-type history
        set query "select coalesce(ipstr(`client_ip`), client_name) as sender_ip, count(*) as totalnum from $log where $filter and `from` is not null group by sender_ip having coalesce(ipstr(`client_ip`), client_name) is not null order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Local-Sender"
        set description "FortiMail history top local sender"
        set dev-type FortiMail
        set log-type history
        set query "select `from` as sender, sum(totalnum) as totalnum from ###(select `from`, virus, direction, count(*) as totalnum from $log where $filter and `from` is not null group by `from`, virus, direction order by totalnum desc)### t where direction='out' group by sender order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Remote-Sender"
        set description "FortiMail history top remote sender"
        set dev-type FortiMail
        set log-type history
        set query "select `from` as sender, sum(totalnum) as totalnum from ###(select `from`, virus, direction, count(*) as totalnum from $log where $filter and `from` is not null group by `from`, virus, direction order by totalnum desc)### t where direction not in ('out', 'unknown') group by sender order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Sender-MSISDN"
        set description "FortiMail history top sender msisdn"
        set dev-type FortiMail
        set log-type history
        set query "select msisdn, count(*) as totalnum from $log where $filter and msisdn is not null and `from` is not null group by msisdn order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Sender-Endpoint"
        set description "FortiMail history top sender endpoint"
        set dev-type FortiMail
        set log-type history
        set query "select endpoint, sum(totalnum) as totalnum from ###(select endpoint, `from`, virus, count(*) as totalnum from $log where $filter and endpoint is not null group by endpoint, `from`, virus order by totalnum desc)### t where `from` is not null group by endpoint order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Recipient"
        set description "FortiMail history top recipient"
        set dev-type FortiMail
        set log-type history
        set query "select `to` as recipient, sum(totalnum) as totalnum from ###(select `to`, virus, direction, count(*) as totalnum from $log where $filter and `to` is not null group by `to`, virus, direction order by totalnum desc)### t group by recipient order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Local-Recipient"
        set description "FortiMail history top local recipient"
        set dev-type FortiMail
        set log-type history
        set query "select `to` as recipient, sum(totalnum) as totalnum from ###(select `to`, virus, direction, count(*) as totalnum from $log where $filter and `to` is not null group by `to`, virus, direction order by totalnum desc)### t where direction='in' group by recipient order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Remote-Recipient"
        set description "FortiMail history top remote recipient"
        set dev-type FortiMail
        set log-type history
        set query "select `to` as recipient, sum(totalnum) as totalnum from ###(select `to`, virus, direction, count(*) as totalnum from $log where $filter and `to` is not null group by `to`, virus, direction order by totalnum desc)### t where direction!='in' group by recipient order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Mail-Dest-IP"
        set description "FortiMail history top mail dest IP"
        set dev-type FortiMail
        set log-type history
        set query "select dst_ip, sum(totalnum) as totalnum from ###(select dst_ip, virus, count(*) as totalnum from $log where $filter and dst_ip is not null group by dst_ip, virus order by totalnum desc)### t group by dst_ip order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Count-Total-Sent-Received"
        set description "FortiMail history count total sent received"
        set dev-type FortiMail
        set log-type history
        set query "select direction, count(*) as totalnum from $log where $filter and direction in ('in', 'out', 'in-out') group by direction order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Virus-Sender"
        set description "FortiMail history top virus sender"
        set dev-type FortiMail
        set log-type history
        set query "select `from` as virus_sender, sum(totalnum) as totalnum from ###(select `from`, virus, direction, count(*) as totalnum from $log where $filter and `from` is not null group by `from`, virus, direction order by totalnum desc)### t where virus is not null group by virus_sender order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Virus-IP"
        set description "FortiMail history top virus IP"
        set dev-type FortiMail
        set log-type history
        set query "select coalesce(ipstr(`client_ip`), client_name) as virus_ip, count(*) as totalnum from $log where $filter and virus is not null group by virus_ip having coalesce(ipstr(`client_ip`), client_name) is not null order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Local-Virus-Sender"
        set description "FortiMail history top local virus sender"
        set dev-type FortiMail
        set log-type history
        set query "select `from` as virus_sender, sum(totalnum) as totalnum from ###(select `from`, virus, direction, count(*) as totalnum from $log where $filter and `from` is not null group by `from`, virus, direction order by totalnum desc)### t where virus is not null and direction='out' group by virus_sender order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Remote-Virus-Sender"
        set description "FortiMail history top remote virus sender"
        set dev-type FortiMail
        set log-type history
        set query "select `from` as virus_sender, sum(totalnum) as totalnum from ###(select `from`, virus, direction, count(*) as totalnum from $log where $filter and `from` is not null group by `from`, virus, direction order by totalnum desc)### t where virus is not null and direction not in ('out', 'unknown') group by virus_sender order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Virus-MSISDN"
        set description "FortiMail history top virus msisdn"
        set dev-type FortiMail
        set log-type history
        set query "select msisdn, count(*) as totalnum from $log where $filter and virus is not null and msisdn is not null group by msisdn order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Virus-Endpoint"
        set description "FortiMail history top virus endpoint"
        set dev-type FortiMail
        set log-type history
        set query "select endpoint, sum(totalnum) as totalnum from ###(select endpoint, `from`, virus, count(*) as totalnum from $log where $filter and endpoint is not null group by endpoint, `from`, virus order by totalnum desc)### t where virus is not null group by endpoint order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Virus-Recipient"
        set description "FortiMail history top virus recipient"
        set dev-type FortiMail
        set log-type history
        set query "select `to` as recipient, sum(totalnum) as totalnum from ###(select `to`, virus, direction, count(*) as totalnum from $log where $filter and `to` is not null group by `to`, virus, direction order by totalnum desc)### t where virus is not null group by recipient order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Local-Virus-Recipient"
        set description "FortiMail history top local virus recipient"
        set dev-type FortiMail
        set log-type history
        set query "select `to` as recipient, sum(totalnum) as totalnum from ###(select `to`, virus, direction, count(*) as totalnum from $log where $filter and `to` is not null group by `to`, virus, direction order by totalnum desc)### t where virus is not null and direction='in' group by recipient order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Remote-Virus-Recipient"
        set description "FortiMail history top remote virus recipient"
        set dev-type FortiMail
        set log-type history
        set query "select `to` as recipient, sum(totalnum) as totalnum from ###(select `to`, virus, direction, count(*) as totalnum from $log where $filter and `to` is not null group by `to`, virus, direction order by totalnum desc)### t where virus is not null and direction!='in' group by recipient order by totalnum desc"
        set protected enable
    next
    edit "fml-History-Top-Virus-Dest-IP"
        set description "FortiMail history top virus dest IP"
        set dev-type FortiMail
        set log-type history
        set query "select dst_ip, sum(totalnum) as totalnum from ###(select dst_ip, virus, count(*) as totalnum from $log where $filter and dst_ip is not null group by dst_ip, virus order by totalnum desc)### t where virus is not null group by dst_ip order by totalnum desc"
        set protected enable
    next
    edit "fml-Active-EmailAddress-Summary"
        set description "FortiMail active email address summary"
        set dev-type FortiMail
        set log-type history
        set query "select email_domain(`from`) as domain_name, count(*) as totalnum from $log where $filter and nullif(email_domain(`from`), '') is not null group by domain_name order by totalnum desc"
        set protected enable
    next
    edit "fml-Average-Size-by-Hour"
        set description "FortiMail average size by hour"
        set dev-type FortiMail
        set log-type history
        set query "select hourstamp as timeperiod, cast(sum(msg_total_len)/sum(msg_count) as
        decimal(18,2)) as avg_size from ###(select $hour_of_day as hourstamp,
        sum(coalesce(message_length, 0)) as msg_total_len, count(*) as msg_count
        from $log where $filter group by hourstamp order by msg_total_len desc)### t group
        by timeperiod order by timeperiod"
        set protected enable
    next
    edit "fml-Messages-per-Hour"
        set description "FortiMail messages per hour"
        set dev-type FortiMail
        set log-type history
        set query "select $hour_of_day as timeperiod, count(*) as totalnum from $log where $filter and disposition='Accept' group by timeperiod order by timeperiod"
        set protected enable
    next
    edit "fml-Total-Size-by-Hour"
        set description "FortiMail total size by hour"
        set dev-type FortiMail
        set log-type history
        set query "select $hour_of_day as timeperiod, sum(coalesce(message_length, 0)) as tsize
        from $log where $filter group by timeperiod having
        sum(coalesce(message_length, 0))>0 order by timeperiod"
        set protected enable
    next
    edit "fml-Connections-per-Hour"
        set description "FortiMail connections per hour"
        set dev-type FortiMail
        set log-type history
        set query "select $hour_of_day as timeperiod, count(*) as totalnum from $log where $filter group by timeperiod order by timeperiod"
        set protected enable
    next

    edit "fml-history-Average-Size-of-Mails"
        set description "FortiMail history average size of mails"
        set dev-type FortiMail
        set log-type history
        set query "select $flex_timescale(timestamp) as timescale, ceil(case when sum(total_in)>0 then sum(size_in)/sum(total_in) else 0 end) as avg_size_in, ceil(case when sum(total_out)>0 then sum(size_out)/sum(total_out) else 0 end) as avg_size_out from (###(select $flex_timestamp as timestamp, sum(coalesce(message_length,0)) as size_in, 0 as size_out, count(*) as total_in, 0 as total_out from $log where $filter and direction='in' group by timestamp order by timestamp desc)### union all ###(select $flex_timestamp as timestamp, 0 as size_in, sum(coalesce(message_length,0)) as size_out, 0 as total_in, count(*) as total_out from $log where $filter and direction='out' group by timestamp order by timestamp desc)###) t group by timescale order by timescale"
        set protected enable
    next

    edit "fml-history-Total-Size-of-Mails"
        set description "FortiMail history total size of mails"
        set dev-type FortiMail
        set log-type history
        set query "select $flex_timescale(timestamp) as timescale, sum(size_in) as size_in, sum(size_out) as size_out from ###(select $flex_timestamp as timestamp, sum(case when direction='in' then coalesce(message_length,0) else 0 end) as size_in, sum(case when direction='out' then coalesce(message_length,0) else 0 end) as size_out from $log where $filter group by timestamp order by timestamp desc)### t group by timescale order by timescale"
        set protected enable
    next

    edit "fml-history-Number-of-Mail-Connections"
        set description "FortiMail history number of mail connections"
        set dev-type FortiMail
        set log-type history
        set query "select $flex_timescale(timestamp) as timescale, sum(con_in) as con_in, sum(con_out) as con_out from ###(select $flex_timestamp as timestamp, sum(case when direction='in' then 1 else 0 end) as con_in, sum(case when direction='out' then 1 else 0 end) as con_out from $log where $filter group by timestamp order by timestamp desc)### t group by timescale order by timescale"
        set protected enable
    next

    edit "fml-history-Number-of-Mails"
        set description "FortiMail history number of mails"
        set dev-type FortiMail
        set log-type history
        set query "select $flex_timescale(timestamp) as timescale, sum(count_in) as count_in, sum(count_out) as count_out from ###(select $flex_timestamp as timestamp, sum(case when direction='in' and disposition='Accept' then 1 else 0 end) as count_in, sum(case when direction='out' and disposition='Accept' then 1 else 0 end) as count_out from $log where $filter group by timestamp order by timestamp desc)### t group by timescale order by timescale"
        set protected enable
    next

    edit "fml-history-Total-Message-Delay"
        set description "FortiMail history total message delay"
        set dev-type FortiMail
        set log-type event
        set query "select $flex_timescale(timestamp) as hod, sum(delay) as total_delay from ###(select timestamp, sum(delay) as delay from (select $flex_timestamp as timestamp, extract_epoch(substring((regexp_matches(msg, 'delay=[0-9]{2}:[0-9]{2}:[0-9]{2}'))[1] from 7 for 8)) as delay from $log where $filter and msg like '% delay=%:%:%') t group by timestamp order by timestamp desc)### t group by hod having sum(delay)>0 order by hod"
        set protected enable
    next

    edit "fml-history-Total-Message-Transmission-Delay"
        set description "FortiMail history total message transmission delay"
        set dev-type FortiMail
        set log-type event
        set query "select $flex_timescale(timestamp) as hod, sum(delay) as total_delay from ###(select timestamp, sum(delay) as delay from (select $flex_timestamp as timestamp, extract_epoch(substring(msg, string_position('xdelay=', msg)+length('xdelay='), length('hh:mm:ss'))) as delay from $log where $filter and msg like '%xdelay=%:%:%') t group by timestamp order by timestamp desc)### t group by hod order by hod"
        set protected enable
    next

    edit "fml-history-Top-IP-Policy"
        set description "FortiMail history top IP policy"
        set dev-type FortiMail
        set log-type history
        set query "select split_part(polid, ':', 2) as acl, count(*) as totalnum from $log where $filter group by acl order by totalnum desc"
        set protected enable
    next

    edit "fml-history-Top-Recipient-Policy"
        set description "FortiMail history top recipient policy"
        set dev-type FortiMail
        set log-type history
        set query "select split_part(polid, ':', 3) as acl, count(*) as totalnum from $log where $filter group by acl order by totalnum desc"
        set protected enable
    next

    edit "fml-history-Top-Access-List"
        set description "FortiMail history top access list"
        set dev-type FortiMail
        set log-type history
        set query "select split_part(polid, ':', 1) as acl, count(*) as totalnum from $log where $filter group by acl order by totalnum desc"
        set protected enable
    next

    edit "fml-history-Top-Spammed-Domains"
        set description "FortiMail history top spammed domains"
        set dev-type FortiMail
        set log-type history
        set query "select email_domain(`to`) as dst_domain, classifier, count(*) as totalnum from $log where $filter and disposition!='Accept' and email_domain(`to`) is not null group by dst_domain, classifier order by totalnum desc"
        set protected enable
    next

    edit "fml-history-Top-Spammed-Users"
        set description "FortiMail history top spammed users"
        set dev-type FortiMail
        set log-type history
        set query "select email_domain(`to`) as dst_domain, email_user(`to`) as dst_user, count(*) as totalnum from $log where $filter and disposition!='Accept' and `to` is not null group by dst_domain, dst_user order by totalnum desc"
        set protected enable
   next

    edit "fml-history-Top-Classifiers-By-Hour"
        set description "FortiMail history top classifiers by hour"
        set dev-type FortiMail
        set log-type history
        set query "select $hour_of_day as hodex, classifier, count(*) as totalnum from $log where $filter group by hodex, classifier order by hodex"
        set protected enable
    next

    edit "fml-history-Top-Disposition-Classifiers"
        set description "FortiMail history top disposition classifiers"
        set dev-type FortiMail
        set log-type history
        set query "select disposition, classifier, count(*) as totalnum from $log where $filter group by disposition, classifier order by totalnum desc"
        set protected enable
    next

    edit "fml-history-Top-Subjects"
        set description "FortiMail history top subjects"
        set dev-type FortiMail
        set log-type history
        set query "select disposition, subject, count(*) as totalnum from $log where $filter and subject is not null group by disposition, subject order by disposition asc, totalnum desc"
        set protected enable
    next

    edit "fml-Total-Counts-Inbound"
        set description "Total Inbound Messages"
        set dev-type FortiMail
        set log-type history
        set query "select sum(totalnum) as totalnum from ###(select count(*) as totalnum, sum(case when virus is not null then 1 else 0 end) as total_malware, sum(case when classifier!='Not Spam' then 1 else 0 end) as total_threat from $log where $filter and direction='in')### t"
        set protected enable
    next
    edit "fml-Total-Malware-Inbound"
        set description "Total Malware Inbound"
        set dev-type FortiMail
        set log-type history
        set query "select sum(total_malware) as totalnum from ###(select count(*) as totalnum, sum(case when virus is not null then 1 else 0 end) as total_malware, sum(case when classifier!='Not Spam' then 1 else 0 end) as total_threat from $log where $filter and direction='in')### t"
        set protected enable
    next
    edit "fml-Total-Classified-Inbound"
        set description "Total Threats Identified"
        set dev-type FortiMail
        set log-type history
        set query "select sum(total_threat) as totalnum from ###(select count(*) as totalnum, sum(case when virus is not null then 1 else 0 end) as total_malware, sum(case when classifier!='Not Spam' then 1 else 0 end) as total_threat from $log where $filter and direction='in')### t"
        set protected enable
    next
    edit "fml-Percentage-of-Unwanted-Mails"
        set description "Percentage of Unwanted/Bulk/Spam Mails"
        set dev-type FortiMail
        set log-type history
        set query "select cast((case when sum(totalnum) > 0 then round(sum(total_threat)*100/sum(totalnum)) else 0 end) as decimal(18, 2)) as percentage_hits from ###(select count(*) as totalnum, sum(case when virus is not null then 1 else 0 end) as total_malware, sum(case when classifier!='Not Spam' then 1 else 0 end) as total_threat from $log where $filter and direction='in')### t"
        set protected enable
    next
    edit "fml-Percentage-of-Known-Malware"
        set description "Percentage of Known Malware"
        set dev-type FortiMail
        set log-type history
        set query "select cast((case when sum(totalnum) > 0 then round(sum(total_malware)*100/sum(totalnum)) else 0 end) as decimal(18, 2)) as percentage_hits from ###(select count(*) as totalnum, sum(case when virus is not null then 1 else 0 end) as total_malware, sum(case when classifier!='Not Spam' then 1 else 0 end) as total_threat from $log where $filter and direction='in')### t"
        set protected enable
    next
    edit "fml-Impersonation-Analysis-Total-Count"
        set description "Total Impersonation Analysis Identified"
        set dev-type FortiMail
        set log-type history
        set query "select count(*) as totalnum from $log where $filter and classifier='Impersonation Analysis'"
        set protected enable
    next
    edit "fml-Messages-Malware-Inbound"
        set description "Total Malware Identified by Anti-Malware Tools"
        set dev-type FortiMail
        set log-type history
        set query "select classifier, count(*) as totalnum from $log where $filter and virus is not null and classifier in ('Virus Signature','FortiSandbox File', 'FortiSandbox URL', 'FortiSandbox NoResult','FortiGuard Outbreak','FortiGuard WebFilter') and direction='in' group by classifier order by totalnum desc"
        set protected enable
    next
    edit "fml-Messages-AntiVirus-Inbound-with-Details"
        set description "Identified Known Viruses"
        set dev-type FortiMail
        set log-type history
        set query "select hfrom as mailfrom, subject as mail_subject, regexp_replace(virus,'^.*:', '') as virus_type, count(*) as totalnum from $log where $filter and classifier not in ('FortiSandbox File', 'FortiSandbox URL', 'FortiSandbox NoResult') and virus is not null and virus not like ('%uri%') and virus not like ('%Unknown%') group by mailfrom, subject, virus order by totalnum desc"
        set protected enable
    next
    edit "fml-Messages-FSA-Inbound-Only-URI"
        set description "FortiSandbox Scanned URI"
        set dev-type FortiMail
        set log-type virus
        set query "select split_part(msg, ' ', 2) as uri, count(*) as total_number from $log where $filter and msg like ('Uri% has been sent to FortiSandbox%') group by uri order by total_number desc"
        set protected enable
    next
    edit "fml-Impersonation-Analysis-Senders"
        set description "Impersonation Analysis Senders"
        set dev-type FortiMail
        set log-type history
        set query "select `classifier`, `from` as sender, count(*) as totalnum from $log where $filter and classifier='Impersonation Analysis' group by `classifier`, sender order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Number-of-Incoming-Mails"
        set description "Number of Incoming Mails"
        set dev-type FortiMail
        set log-type history
        set query "select sum(totalnum) as totalnum from ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where direction='in'"
        set protected enable
    next
    edit "fml-domain-Number-of-Outgoing-Mails"
        set description "Number of Outgoing Mails"
        set dev-type FortiMail
        set log-type history
        set query "select sum(totalnum) as totalnum from ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where direction='out'"
        set protected enable
    next
    edit "fml-domain-Total-Spam-Mail"
        set description "FortiMail Total Spam Mail"
        set dev-type FortiMail
        set log-type history
        set query "select sum(totalnum) as totalnum from ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where is_spam order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Total-Mail-with-Virus"
        set description "FortiMail Total Mail with Virus"
        set dev-type FortiMail
        set log-type history
        set query "select sum(totalnum) as totalnum from ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where virus is not null order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Total-Mail-Sender"
        set description "FortiMail Total Mail Sender Domain"
        set dev-type FortiMail
        set log-type history
        set query "select count(distinct sender) as totalnum from ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t "
        set protected enable
    next
    edit "fml-domain-Total-Mail-Recipient"
        set description "FortiMail Total Mail Recipient"
        set dev-type FortiMail
        set log-type history
        set query "select count(distinct `to`) as totalnum from ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t "
        set protected enable
    next
    edit "fml-domain-Top-Virus"
        set description "Fortimail Top Virus by Count"
        set dev-type FortiMail
        set log-type history
        set query "select virus_s as virus, sum(totalnum) as totalnum from (select unnest(string_to_array(virus, ',')) as virus_s, sum(totalnum) as totalnum from ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where virus is not null group by virus_s) t group by virus order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Virus-Category"
        set description "FortiMail Virus Category"
        set dev-type FortiMail
        set log-type history
        set query "select virus, string_agg(distinct classifier::text, ',') as classifier_agg, sum(totalnum) as totalnum from (select unnest(string_to_array(virus, ',')) as virus, classifier, sum(totalnum) as totalnum from ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where virus is not null and direction='in' and classifier is not null group by virus, classifier) t group by virus order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Top-Virus-Sender-with-Aggregation"
        set description "Fortimail Top Virus Sender Domain with Virus"
        set dev-type FortiMail
        set log-type history
        set query "select sender, string_agg(distinct virus, ',') as virus_agg, sum(totalnum) as totalnum from (select sender, unnest(string_to_array(virus, ',')) as virus, sum(totalnum) as totalnum from ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where virus is not null and direction='in' group by sender, virus) t group by sender order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Top-Spam-Sender-with-Category"
        set description "Fortimail Top Spam Sender With Category"
        set dev-type FortiMail
        set log-type history
        set query "select sender, classifier, sum(totalnum) as totalnum from ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where is_spam and direction='in' group by sender, classifier order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Top-Sender-Domain"
        set description "FortiMail Top Sender Domain by Mail Count"
        set dev-type FortiMail
        set log-type history
        set query "select sender as src_domain, sum(totalnum) as totalnum from ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where direction='in' group by src_domain order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Top-Country-Sender"
        set description "FortiMail Top Country Sender"
        set dev-type FortiMail
        set log-type history
        set query "select client_cc as country_cc, sum(totalnum) as totalnum from ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where client_cc is not null and direction='in' group by country_cc order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Top-Spam-Subject"
        set description "FortiMail Top Spam Subject by Mail Count"
        set dev-type FortiMail
        set log-type history
        set query "select spam_subject as subject, sum(totalnum) as totalnum from ###(select domain, spam_subject, totalnum from (select *, row_number() OVER (PARTITION BY domain ORDER BY totalnum DESC) AS domain_rank from (select domain, spam_subject, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query where spam_subject is not null group by domain, spam_subject ) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, spam_subject, totalnum from (select *, row_number() OVER (PARTITION BY domain ORDER BY totalnum DESC) AS domain_rank from (select domain, spam_subject, sum(totalnum) as totalnum from ###LOG### group by domain, spam_subject) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t group by subject order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Mail-Category"
        set description "FortiMail Top Category by Mail Count"
        set dev-type FortiMail
        set log-type history
        set query "select classifier, sum(totalnum) as totalnum from  ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where classifier is not null group by classifier order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Spam-Category"
        set description "FortiMail Top Spam Category"
        set dev-type FortiMail
        set log-type history
        set query "select classifier, sum(totalnum) as totalnum from  ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where is_spam and direction='in' group by classifier order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Top-Spammed-Users-with-Category"
        set description "FortiMail Top Spammed User with Category"
        set dev-type FortiMail
        set log-type history
        set query " select recipient, classifier, totalnum, sum(totalnum) over (partition by recipient) as total_num from (select `to` as recipient, classifier, sum(totalnum) as totalnum from  ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where is_spam and direction='in' group by recipient, classifier order by totalnum desc) t order by total_num desc"
        set protected enable
    next
    edit "fml-domain-Top-Spammed-Category-with-Users"
        set description "FortiMail Top Spam Category with User"
        set dev-type FortiMail
        set log-type history
        set query " select classifier, recipient, totalnum, sum(totalnum) over (partition by classifier) as total_num from (select `to` as recipient, classifier, sum(totalnum) as totalnum from  ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where is_spam and direction='in' group by recipient, classifier order by totalnum desc) t order by total_num desc"
        set protected enable
    next
    edit "fml-domain-Top-Virus-Recipient-with-Aggregation"
        set description "FortiMail top virus recipient by Count"
        set dev-type FortiMail
        set log-type history
        set query "select recipient, string_agg(distinct virus, ',') as virus_agg, sum(totalnum) as totalnum from (select `to` as recipient, unnest(string_to_array(virus, ',')) as virus, sum(totalnum) as totalnum from ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where virus is not null and direction='in' group by recipient, virus) t group by recipient order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Top-Spam-Recipient"
        set description "FortiMail Top Spam Recipient"
        set dev-type FortiMail
        set log-type history
        set query "select `to` as recipient, sum(totalnum) as totalnum from  ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where is_spam and direction='in' group by recipient order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Top-Recipient-Domain"
        set description "FortiMail Top Recipient Domain"
        set dev-type FortiMail
        set log-type history
        set query "select email_domain(`to`) as dst_domain, sum(totalnum) as totalnum from  ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where direction='out' group by dst_domain order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Top-Local-User"
        set description "Fortimail Domain Top Local User"
        set dev-type FortiMail
        set log-type history
        set query "select `to` as recipient, sum(totalnum) as totalnum from ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where direction='in' group by recipient order by totalnum desc"
        set protected enable
    next
    edit "fml-domain-Top-Virus-Recipient"
        set description "FortiMail Top Virus Recipient"
        set dev-type FortiMail
        set log-type history
        set query "select `to` as recipient, sum(totalnum) as totalnum from ###(select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###base(/*tag:rpt_base_fml_h_domain*/select domain, direction, classifier, email_domain(`from`) as sender, virus, `to`, (case when direction='in' and (logflag&1>0) then subject else null end) as spam_subject, client_cc, (logflag&1>0) as is_spam, count(*) as totalnum from $log where $filter and domain is not null and `from` is not null and `to` is not null group by domain, direction, classifier, sender, virus, `to`, spam_subject, client_cc, is_spam /*SkipSTART*/ ORDER BY totalnum desc /*SkipEND*/)base### base_query group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query /*SkipSTART*/ ORDER BY domain_rank /*SkipEND*/ /*HCACHE-AGG select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, totalnum from (select *, row_number() OVER (PARTITION BY domain, classifier ORDER BY totalnum DESC) AS domain_rank from (select domain, classifier, `to`, sender, direction, client_cc, virus, is_spam, sum(totalnum) as totalnum from ###LOG### group by domain, classifier, `to`, sender, direction, client_cc, virus, is_spam) agg_query) rank_query ORDER BY domain_rank AGG-END*/)### t where virus is not null and direction='in' group by recipient order by totalnum desc"
        set protected enable
    next
end

config sql-report chart
    edit "fml-History-Top10-Client-IP"
        set disp-name "FortiMail-Top History Client IP"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 client IP in FortiMail history"
        set dataset "fml-History-Top-Client-IP"
        set chart-type table
        config table-columns
            edit 1
                set header "Client IP"
                set data-binding "clientip"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Local-User"
        set disp-name "FortiMail-Top History Local User"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 local users in FortiMail history"
        set dataset "fml-History-Top-Local-User"
        set chart-type table
        config table-columns
            edit 1
                set header "Local User"
                set data-binding "local_user"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Remote-Address"
        set disp-name "FortiMail-Top History Remote Address"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 remote address in FortiMail history"
        set dataset "fml-History-Top-Remote-Address"
        set chart-type table
        config table-columns
            edit 1
                set header "Remote Address"
                set data-binding "remote_addr"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Virus"
        set disp-name "FortiMail-Top History Virus"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 viruses in FortiMail history"
        set dataset "fml-History-Top-Virus"
        set chart-type table
        config table-columns
            edit 1
                set header "Virus"
                set data-binding "virus"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Client-MSISDN"
        set disp-name "FortiMail-Top History Client MSISDN"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 clients MSISDN in FortiMail history"
        set dataset "fml-History-Top-Client-MSISDN"
        set chart-type table
        config table-columns
            edit 1
                set header "MSISDN"
                set data-binding "msisdn"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Client-Endpoint"
        set disp-name "FortiMail-Top History Client Endpoint"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 clients endpoint in FortiMail history"
        set dataset "fml-History-Top-Client-Endpoint"
        set chart-type table
        config table-columns
            edit 1
                set header "Endpoint"
                set data-binding "endpoint"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Sender"
        set disp-name "FortiMail-Top History Sender"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 senders in FortiMail history"
        set dataset "fml-History-Top-Sender"
        set chart-type table
        config table-columns
            edit 1
                set header "Sender"
                set data-binding "sender"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Sender-IP"
        set disp-name "FortiMail-Top History Sender IP"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 sender IP in FortiMail history"
        set dataset "fml-History-Top-Sender-IP"
        set chart-type table
        config table-columns
            edit 1
                set header "Sender IP"
                set data-binding "sender_ip"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Local-Sender"
        set disp-name "FortiMail-Top History Local Sender"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 local senders in FortiMail history"
        set dataset "fml-History-Top-Local-Sender"
        set chart-type table
        config table-columns
            edit 1
                set header "Sender"
                set data-binding "sender"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Remote-Sender"
        set disp-name "FortiMail-Top History Remote Sender"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 remote senders in FortiMail history"
        set dataset "fml-History-Top-Remote-Sender"
        set chart-type table
        config table-columns
            edit 1
                set header "Sender"
                set data-binding "sender"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Sender-MSISDN"
        set disp-name "FortiMail-Top History Sender MSISDN"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 senders MSISDN in FortiMail history"
        set dataset "fml-History-Top-Sender-MSISDN"
        set chart-type table
        config table-columns
            edit 1
                set header "MSISDN"
                set data-binding "msisdn"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Sender-Endpoint"
        set disp-name "FortiMail-Top History Sender Endpoint"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 senders Endpoint in FortiMail history"
        set dataset "fml-History-Top-Sender-Endpoint"
        set chart-type table
        config table-columns
            edit 1
                set header "Endpoint"
                set data-binding "endpoint"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Recipient"
        set disp-name "FortiMail-Top History Recipient"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 recipients in FortiMail history"
        set dataset "fml-History-Top-Recipient"
        set chart-type table
        config table-columns
            edit 1
                set header "Recipient"
                set data-binding "recipient"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Local-Recipient"
        set disp-name "FortiMail-Top History Local Recipient"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 local recipients in FortiMail history"
        set dataset "fml-History-Top-Local-Recipient"
        set chart-type table
        config table-columns
            edit 1
                set header "Recipient"
                set data-binding "recipient"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Remote-Recipient"
        set disp-name "FortiMail-Top History Remote Recipient"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 remote recipients in FortiMail history"
        set dataset "fml-History-Top-Remote-Recipient"
        set chart-type table
        config table-columns
            edit 1
                set header "Recipient"
                set data-binding "recipient"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Mail-Dest-IP"
        set disp-name "FortiMail-Top History Mail Dest IP"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 mail destination IP in FortiMail history"
        set dataset "fml-History-Top-Mail-Dest-IP"
        set chart-type table
        config table-columns
            edit 1
                set header "Destination IP"
                set data-binding "dst_ip"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Count-Total-Sent-Received"
        set disp-name "FortiMail-Top History Total Sent Received"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 total sent received in FortiMail history"
        set dataset "fml-History-Count-Total-Sent-Received"
        set chart-type table
        config table-columns
            edit 1
                set header "Direction"
                set data-binding "direction"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Virus-Sender"
        set disp-name "FortiMail-Top History Virus Sender"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 virus senders in FortiMail history"
        set dataset "fml-History-Top-Virus-Sender"
        set chart-type table
        config table-columns
            edit 1
                set header "Sender Virus"
                set data-binding "virus_sender"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Virus-IP"
        set disp-name "FortiMail-Top History Virus IP"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 virus IP in FortiMail history"
        set dataset "fml-History-Top-Virus-IP"
        set chart-type table
        config table-columns
            edit 1
                set header "Virus IP"
                set data-binding "virus_ip"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Local-Virus-Sender"
        set disp-name "FortiMail-Top History Local Virus Sender"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 local virus senders in FortiMail history"
        set dataset "fml-History-Top-Local-Virus-Sender"
        set chart-type table
        config table-columns
            edit 1
                set header "Sender Virus"
                set data-binding "virus_sender"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Remote-Virus-Sender"
        set disp-name "FortiMail-Top History Remote Virus Sender"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 remote virus senders in FortiMail history"
        set dataset "fml-History-Top-Remote-Virus-Sender"
        set chart-type table
        config table-columns
            edit 1
                set header "Sender Virus"
                set data-binding "virus_sender"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Virus-MSISDN"
        set disp-name "FortiMail-Top History Virus MSISDN"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 viruses MSISDN in FortiMail history"
        set dataset "fml-History-Top-Virus-MSISDN"
        set chart-type table
        config table-columns
            edit 1
                set header "MSISDN"
                set data-binding "msisdn"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Virus-Endpoint"
        set disp-name "FortiMail-Top History Virus Endpoint"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 viruses endpoint in FortiMail history"
        set dataset "fml-History-Top-Virus-Endpoint"
        set chart-type table
        config table-columns
            edit 1
                set header "Endpoint"
                set data-binding "endpoint"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Virus-Recipient"
        set disp-name "FortiMail-Top History Virus Recipient"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 virus recipients in FortiMail history"
        set dataset "fml-History-Top-Virus-Recipient"
        set chart-type table
        config table-columns
            edit 1
                set header "Recipient"
                set data-binding "recipient"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Local-Virus-Recipient"
        set disp-name "FortiMail-Top History Local Virus Recipient"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 local virus recipients in FortiMail history"
        set dataset "fml-History-Top-Local-Virus-Recipient"
        set chart-type table
        config table-columns
            edit 1
                set header "Recipient"
                set data-binding "recipient"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Remote-Virus-Recipient"
        set disp-name "FortiMail-Top History Remote Virus Recipient"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 remote virus recipients in FortiMail history"
        set dataset "fml-History-Top-Remote-Virus-Recipient"
        set chart-type table
        config table-columns
            edit 1
                set header "Recipient"
                set data-binding "recipient"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Top10-Virus-Dest-IP"
        set disp-name "FortiMail-Top History Virus Dest IP"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 virus destination IP in FortiMail history"
        set dataset "fml-History-Top-Virus-Dest-IP"
        set chart-type table
        config table-columns
            edit 1
                set header "Destination IP"
                set data-binding "dst_ip"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-History-Total-Active-EmailAddress"
        set disp-name "FortiMail-Top History Total Active EmailAddress"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 10 total active email address per domain"
        set dataset "fml-Active-EmailAddress-Summary"
        set chart-type table
            config table-columns
                edit 1
                    set header "Domain"
                    set data-binding "domain_name"
                    set data-top 10
                    set column-width 40
                next
                edit 2
                    set header "Total"
                    set data-type aggregate
                    set data-binding "totalnum"
                    set column-attr count
                    set column-width 30
                next
            end
        set protected enable
    next

    edit "fml-History-Average-Size-by-Hour"
        set disp-name "FortiMail-History Average Size by Hour"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Average size of messages per hour in FortiMail history"
        set dataset "fml-Average-Size-by-Hour"
        set chart-type table
        config table-columns
            edit 1
                set header "Hour"
                set data-binding "timeperiod"
                set data-top 25
                set column-width 40
            next
            edit 2
                set header "Size (Bytes)"
                set data-binding "avg_size"
                set column-graph-type bar
                set column-width 60
                set column-span 2
            next
            edit 3
                set data-binding "avg_size"
                set column-attr bandwidth
            next
        end
        set protected enable
    next

    edit "fml-History-Messages-per-Hour"
        set disp-name "FortiMail-History Messages per Hour"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Number of mails per hour in FortiMail history"
        set dataset "fml-Messages-per-Hour"
        set chart-type table
        config table-columns
            edit 1
                set header "Hour"
                set data-binding "timeperiod"
                set data-top 25
                set column-width 40
            next
            edit 2
                set header "Messages"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fml-History-Total-Size-by-Hour"
        set disp-name "FortiMail-History Total Size by Hour"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Total size of exchanged mails per hour in FortiMail history"
        set dataset "fml-Total-Size-by-Hour"
        set chart-type table
        config table-columns
            edit 1
                set header "Hour"
                set data-binding "timeperiod"
                set data-top 25
                set column-width 40
            next
            edit 2
                set header "Size"
                set data-binding "tsize"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "tsize"
                set column-attr bandwidth
            next
        end
        set protected enable
    next

    edit "fml-History-Connections-per-Hour"
        set disp-name "FortiMail-History Connections per Hour"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Number of connections per hour in FortiMail history"
        set dataset "fml-Connections-per-Hour"
        set chart-type table
        config table-columns
            edit 1
                set header "Hour"
                set data-binding "timeperiod"
                set data-top 25
                set column-width 40
            next
            edit 2
                set header "Connections"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fml-Average-Size-of-Mails"
        set disp-name "FortiMail-Average Size of Mails"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Average size of mails in FortiMail history"
        set dataset "fml-history-Average-Size-of-Mails"
        set chart-type area
        config table-columns
            edit 1
                set header "Time"
                set data-binding "timescale"
                set column-attr time
                set data-top 20
            next
            edit 2
                set data-binding "avg_size_in"
                set column-attr bandwidth
                set column-graph-type line-up
                set legend "Size In"
            next
            edit 3
                set data-binding "avg_size_out"
                set column-attr bandwidth
                set column-graph-type line-down
                set legend "Size Out"
            next
        end
        set protected enable
    next

    edit "fml-Total-Size-of-Mails"
        set disp-name "FortiMail-Total Size of Mails"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Total size of mails in FortiMail history"
        set dataset "fml-history-Total-Size-of-Mails"
        set chart-type area
        config table-columns
            edit 1
                set header "Time"
                set data-binding "timescale"
                set column-attr time
                set data-top 20
            next
            edit 2
                set data-binding "size_in"
                set column-attr bandwidth
                set column-graph-type line-up
                set legend "Size In"
            next
            edit 3
                set data-binding "size_out"
                set column-attr bandwidth
                set column-graph-type line-down
                set legend "Size Out"
            next
        end
        set protected enable
    next

    edit "fml-Number-of-Mail-Connections"
        set disp-name "FortiMail-Number of Mail Connections"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Number of mail connections in FortiMail history"
        set dataset "fml-history-Number-of-Mail-Connections"
        set chart-type area
        config table-columns
            edit 1
                set header "Time"
                set data-binding "timescale"
                set column-attr time
                set data-top 20
            next
            edit 2
                set data-binding "con_in"
                set column-attr count
                set column-graph-type line-up
                set legend "Connections In"
            next
            edit 3
                set data-binding "con_out"
                set column-attr count
                set column-graph-type line-down
                set legend "Connections Out"
            next
        end
        set protected enable
    next

    edit "fml-Number-of-Mails"
        set disp-name "FortiMail-Number of Mails"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Number of mails in FortiMail history"
        set dataset "fml-history-Number-of-Mails"
        set chart-type area
        config table-columns
            edit 1
                set header "Time"
                set data-binding "timescale"
                set column-attr time
                set data-top 20
            next
            edit 2
                set data-binding "count_in"
                set column-attr count
                set column-graph-type line-up
                set legend "Mails In"
            next
            edit 3
                set data-binding "count_out"
                set column-attr count
                set column-graph-type line-down
                set legend "Mails Out"
            next
        end
        set protected enable
    next

    edit "fml-Total-Message-Delay"
        set disp-name "FortiMail-Total Message Delay"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Total message delay in FortiMail history"
        set dataset "fml-history-Total-Message-Delay"
        set chart-type area
        config table-columns
            edit 1
                set header "Time"
                set data-binding "hod"
                set column-attr time
                set data-top 20
            next
            edit 2
                set data-binding "total_delay"
                set column-attr timespan
                set column-graph-type line-up
                set legend "Delay"
            next
        end
        set protected enable
    next

    edit "fml-Total-Message-Transmission-Delay"
        set disp-name "FortiMail-Total Message TransmissionDelay"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Total message transmissionDelay in FortiMail history"
        set dataset "fml-history-Total-Message-Transmission-Delay"
        set chart-type area
        config table-columns
            edit 1
                set header "Time"
                set data-binding "hod"
                set column-attr time
                set data-top 20
            next
            edit 2
                set data-binding "total_delay"
                set column-attr timespan
                set column-graph-type line-up
                set legend "Delay"
            next
        end
        set protected enable
    next

    edit "fml-Top-IP-Policy"
        set disp-name "FortiMail-Top 20 IP Policy"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 20 IP policy in FortiMail history"
        set dataset "fml-history-Top-IP-Policy"
        set chart-type table
        config table-columns
            edit 1
                set header "Policy"
                set data-binding "acl"
                set data-top 20
                set column-width 40
            next
            edit 2
                set header "Total"
                set data-binding "totalnum"
                set column-graph-type bar
                set column-span 2
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fml-Top-Recipient-Policy"
        set disp-name "FortiMail-Top 20 Recipient Policy"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 20 recipient policy in FortiMail history"
        set dataset "fml-history-Top-Recipient-Policy"
        set chart-type table
        config table-columns
            edit 1
                set header "Recipient Policy"
                set data-binding "acl"
                set data-top 20
                set column-width 40
            next
            edit 2
                set header "Total"
                set data-binding "totalnum"
                set column-graph-type bar
                set column-span 2
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fml-Top-Access-List"
        set disp-name "FortiMail-Top 20 Access List"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 20 access list in FortiMail history"
        set dataset "fml-history-Top-Access-List"
        set chart-type table
        config table-columns
            edit 1
                set header "Access List"
                set data-binding "acl"
                set data-top 20
                set column-width 40
            next
            edit 2
                set header "Total"
                set data-binding "totalnum"
                set column-graph-type bar
                set column-span 2
                set column-width 60
            next
            edit 3
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fml-Top-Spammed-Domains"
        set disp-name "FortiMail-Top Spammed Domains"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top spammed domains in FortiMail history"
        set dataset "fml-history-Top-Spammed-Domains"
        set order-by "totalnum"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "Domain"
                set data-binding "dst_domain"
                set data-top 6
            next
            edit 2
                set data-type drilldown
                set data-binding "classifier"
                set data-top 3
            next
            edit 3
                set header "Total"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
        set protected enable
    next

    edit "fml-Top-Spammed-Users"
        set disp-name "FortiMail-Top Spammed Users"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top spammed users in FortiMail history"
        set dataset "fml-history-Top-Spammed-Users"
        set order-by "totalnum"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "Domain"
                set data-binding "dst_domain"
                set data-top 6
            next
            edit 2
                set data-type drilldown
                set data-binding "dst_user"
                set data-top 3
            next
            edit 3
                set header "Total"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
        set protected enable
    next

    edit "fml-Top-Classifiers-By-Hour"
        set disp-name "FortiMail-Top Classifiers by Hour"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top classifiers by hour in FortiMail history"
        set dataset "fml-history-Top-Classifiers-By-Hour"
        set order-by "totalnum"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "Hour"
                set data-binding "hodex"
                set data-top 24
            next
            edit 2
                set data-type drilldown
                set data-binding "classifier"
                set data-top 3
            next
            edit 3
                set header "Total"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
        set protected enable
    next

    edit "fml-Top-Disposition-Classifiers"
        set disp-name "FortiMail-Top Disposition Classifiers"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top disposition  classifiers in FortiMail history"
        set dataset "fml-history-Top-Disposition-Classifiers"
        set order-by "totalnum"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "Disposition"
                set data-binding "disposition"
                set data-top 6
            next
            edit 2
                set data-type drilldown
                set data-binding "classifier"
                set data-top 3
            next
            edit 3
                set header "Total"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
        set protected enable
    next

    edit "fml-Top-Subjects"
        set disp-name "FortiMail-Top 20 Subjects"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top 20 subjects in FortiMail history"
        set dataset "fml-history-Top-Subjects"
        set chart-type table
        config table-columns
            edit 1
                set header "Disposition"
                set data-binding "disposition"
                set data-top 20
            next
            edit 2
                set header "Subjects"
                set data-type drilldown
                set data-binding "subject"
            next
            edit 3
                set header "Total"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fml-Top-Disposition-Classifiers-Pie"
        set disp-name "FortiMail-Top Disposition Classifiers - Pie Chart"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Top disposition classifiers in FortiMail history"
        set dataset "fml-history-Top-Disposition-Classifiers"
        set chart-type pie
        config table-columns
            edit 1
                set header "Classifier"
                set data-binding "classifier"
                set data-top 5
            next
            edit 2
                set header "Count"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
        set protected enable
    next
    edit "fml-Messages-Malware-Inbound"
        set disp-name "FortiMail-Total Malware Identified by Anti-Malware Tools"
        set description "Total Malware Identified by Anti-Malware Tools"
        set category "FortiMail"
        set dev-type FortiMail
        set dataset "fml-Messages-Malware-Inbound"
        set chart-type pie
        config table-columns
            edit 1
                set header "Malware Tools"
                set data-binding "classifier"
                set data-top 5
            next
            edit 2
                set header "Count"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
        set protected enable
    next
    edit "fml-Messages-AntiVirus-Inbound-with-Details"
        set disp-name "FortiMail-Identified Known Viruses"
        set description "Identified Known Viruses"
        set category "FortiMail"
        set dev-type FortiMail
        set dataset "fml-Messages-AntiVirus-Inbound-with-Details"
        set chart-type table
        config table-columns
            edit 1
                set header "Sender"
                set data-binding "mailfrom"
                set data-top 10
            next
            edit 2
                set header "Mail Subject"
                set data-binding "mail_subject"
            next
            edit 3
                set header "Virus"
                set data-binding "virus_type"
            next
            edit 4
                set header "Total Number"
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-Messages-FSA-Inbound-Only-URI"
        set disp-name "FortiMail-FortiSandbox Scanned URI"
        set description "FortiSandbox Scanned URI"
        set category "FortiMail"
        set dev-type FortiMail
        set dataset "fml-Messages-FSA-Inbound-Only-URI"
        set chart-type table
        config table-columns
            edit 1
                set header "URL"
                set data-binding "uri"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total Number"
                set data-binding "total_number"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "total_number"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-Impersonation-Analysis-Senders"
        set disp-name "FortiMail-Impersonation Analysis Senders"
        set description "Impersonation Analysis Senders"
        set category "FortiMail"
        set dev-type FortiMail
        set dataset "fml-Impersonation-Analysis-Senders"
        set chart-type table
        config table-columns
            edit 1
                set header "Classifier"
                set data-binding "classifier"
                set data-top 10
            next
            edit 2
                set header "From"
                set data-binding "sender"
            next
            edit 3
                set header "Count"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
            next
            edit 4
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-domain-Mail-Category"
        set disp-name "FortiMail-FortiMail Top Category by Mail Count"
        set description "FortiMail Top Category by Mail Count"
        set category "FortiMail"
        set dev-type FortiMail
        set dataset "fml-domain-Mail-Category"
        set chart-type donut
        set chart-style "{\"legend-format\":\"${name} (${val})\", \"legend-font-size\": \"9px\", \"show-value\": \"enable\", \"legend-position\":\"right\", \"inner-content\":\"summary\", \"show-header\": \"enable\", \"legend-columns\":\"2\"}"
        set include-other disable
        config table-columns
            edit 1
                set header ""
                set data-binding "classifier"
                set data-top 10
            next
            edit 2
                set header "Mails"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-domain-Top-Virus-Count"
        set disp-name "FortiMail-FortiMail Top Virus by Count"
        set description "FortiMail Top Virus by Count"
        set category "FortiMail"
        set dev-type FortiMail
        set dataset "fml-domain-Top-Virus"
        set chart-type donut
        set chart-style "{\"legend-format\":\"${name} (${val})\", \"legend-font-size\": \"9px\", \"show-value\": \"enable\", \"legend-position\":\"right\", \"inner-content\":\"summary\", \"show-header\": \"enable\", \"legend-columns\":\"2\"}"
        set include-other disable
        config table-columns
            edit 1
                set header ""
                set data-binding "virus"
                set data-top 10
            next
            edit 2
                set header "Virus"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-domain-Top-Local-User-Count"
        set disp-name "FortiMail-FortiMail Top Recipient by Mail Count"
        set description "FortiMail Top Recipient by Mail Count"
        set category "FortiMail"
        set dev-type FortiMail
        set dataset "fml-domain-Top-Local-User"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\", \"height\":\"300\", \"fixed-bar-width\":\"20px\", \"y-label\": \"flat\", \"bar-color\": \"#4e79a7\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "Recipient"
                set data-binding "recipient"
                set data-top 10
            next
            edit 2
                set header "Total Number"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-domain-Top-Virus-Recipient"
        set disp-name "FortiMail-FortiMail Top Virus Recipient"
        set category "FortiMail"
        set dev-type FortiMail
        set description "FortiMail Top Virus Recipient"
        set dataset "fml-domain-Top-Virus-Recipient"
        set chart-type donut
        set chart-style "{\"legend-format\":\"${name} (${val})\", \"legend-font-size\": \"9px\", \"show-value\": \"enable\", \"legend-position\":\"right\", \"inner-content\":\"summary\", \"show-header\": \"enable\", \"legend-columns\":\"1\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "Recipient"
                set data-binding "recipient"
                set data-top 10
            next
            edit 2
                set header "Recipients"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-domain-Top-Spam-Recipient"
        set disp-name "FortiMail-FortiMail Top Spam Recipient"
        set category "FortiMail"
        set dev-type FortiMail
        set description "FortiMail Top Spam Recipient"
        set dataset "fml-domain-Top-Spam-Recipient"
        set chart-type donut
        set chart-style "{\"legend-format\":\"${name} (${val})\", \"legend-font-size\": \"9px\", \"show-value\": \"enable\", \"legend-position\":\"right\", \"inner-content\":\"summary\", \"show-header\": \"enable\", \"legend-columns\":\"1\"}"
        set include-other disable
        config table-columns
            edit 1
                set header ""
                set data-binding "recipient"
                set data-top 10
            next
            edit 2
                set header "Recipients"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-domain-Top-Spam-Subject"
        set disp-name "FortiMail-FortiMail Top Spam Subject by Mail Count"
        set category "FortiMail"
        set dev-type FortiMail
        set description "FortiMail Top Spam Subject by Mail Count"
        set dataset "fml-domain-Top-Spam-Subject"
        set chart-type donut
        set chart-style "{\"legend-format\":\"${name} (${val})\", \"legend-font-size\": \"9px\", \"show-value\": \"enable\", \"legend-position\":\"right\", \"inner-content\":\"summary\", \"show-header\": \"enable\", \"legend-columns\":\"2\"}"
        set include-other disable
        config table-columns
            edit 1
                set header ""
                set data-binding "subject"
                set data-top 10
            next
            edit 2
                set header "Subjects"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-domain-Top-Sender-Domain"
        set disp-name "FortiMail-FortiMail Top Sender Domain by Mail Count"
        set category "FortiMail"
        set dev-type FortiMail
        set description "FortiMail Top Sender Domain by Mail Count"
        set dataset "fml-domain-Top-Sender-Domain"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\", \"show-header\": \"enable\",  \"fixed-bar-width\":\"20px\",\"legend-position\":\"top\", \"height\":\"540\", \"bar-color\": \"bubble-ring\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "Domain"
                set data-binding "src_domain"
                set data-top 10
            next
            edit 2
                set header "Sender"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fml-domain-Top-Recipient-Domain"
        set disp-name "FortiMail-FortiMail Top Recipient Domain"
        set category "FortiMail"
        set dev-type FortiMail
        set description "FortiMail Top Recipient Domain"
        set dataset "fml-domain-Top-Recipient-Domain"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\", \"show-header\": \"enable\",  \"fixed-bar-width\":\"20px\",\"legend-position\":\"top\", \"height\":\"540\", \"bar-color\": \"bubble-ring\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "Domain"
                set data-binding "dst_domain"
                set data-top 10
            next
            edit 2
                set header "Destination"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-domain-Spam-Category"
        set disp-name "FortiMail-FortiMail Top Spam Category"
        set description "FortiMail Top Spam Category"
        set category "FortiMail"
        set dev-type FortiMail
        set dataset "fml-domain-Spam-Category"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\", \"fixed-bar-width\":\"20px\", \"height\":\"440\", \"bar-color\": \"bubble-ring\", \"y-tick-max-len\": \"30\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "Category"
                set data-binding "classifier"
                set data-top 10
            next
            edit 2
                set header "Mails"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-domain-Top-Spammed-Users-with-Category-Table"
        set disp-name "FortiMail-FortiMail Top Spammed User with Category Table"
        set category "FortiMail"
        set dev-type FortiMail
        set description "FortiMail Top Spammed User with Category Table"
        set dataset "fml-domain-Top-Spammed-Users-with-Category"
        set chart-type table
        set chart-style "{\"table-scheme\": \"dark\", \"table-subtotal-bg-color\":\" \"}"
        set include-other enable
        config table-columns
            edit 1
                set header "Recipient"
                set data-binding "recipient"
                set column-width 32
                set data-top 5
            next
            edit 2
                set header "Category"
                set data-binding "classifier"
                set data-type drilldown
                set column-width 32
                set data-top 3
            next
            edit 3
                set header "Total Number"
                set data-binding "totalnum"
                set data-type aggregate
                set column-width 20
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-domain-Top-Spammed-Category-with-Users"
        set disp-name "FortiMail-FortiMail Top Spam Category with User"
        set category "FortiMail"
        set dev-type FortiMail
        set description "FortiMail Top Spam Category with User"
        set dataset "fml-domain-Top-Spammed-Category-with-Users"
        set chart-type bubble-ring
        set chart-style "{\"show-value\":\"enable\" }"
        set include-other disable
        config table-columns
            edit 1
                set header "Category"
                set data-binding "classifier"
                set data-top 10
            next
            edit 2
                set header "Recipient"
                set data-type drilldown
                set data-binding "recipient"
                set data-top 5
            next
            edit 3
                set header "Total Number"
                set data-binding "totalnum"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-domain-Top-Spam-Sender-with-Category"
        set disp-name "FortiMail-Fortimail Top Spam Sender With Category"
        set category "FortiMail"
        set dev-type FortiMail
        set description "Fortimail Top Spam Sender With Category"
        set dataset "fml-domain-Top-Spam-Sender-with-Category"
        set chart-type table
        set chart-style "{\"table-scheme\": \"dark\", \"table-subtotal-bg-color\":\" \"}"
        set include-other enable
        config table-columns
            edit 1
                set header "Sender"
                set data-binding "sender"
                set column-width 32
                set data-top 5
            next
            edit 2
                set header "Category"
                set data-binding "classifier"
                set data-type drilldown
                set column-width 32
                set data-top 3
            next
            edit 3
                set header "Total Number"
                set data-binding "totalnum"
                set data-type aggregate
                set column-attr count
                set column-width 20
            next
        end
        set protected enable
    next
    edit "fml-domain-Virus-Category"
        set disp-name "FortiMail-FortiMail Virus Category"
        set category "FortiMail"
        set dev-type FortiMail
        set description "FortiMail Virus Category"
        set dataset "fml-domain-Virus-Category"
        set chart-type table
        set chart-style "{\"table-scheme\": \"dark\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "Virus"
                set data-binding "virus"
                set column-width 35
                set data-top 10
            next
            edit 2
                set header "Category"
                set data-binding "classifier_agg"
                set data-type raw
                set column-width 35
                set data-top 5
            next
            edit 3
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 30
            next
            edit 4
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-domain-Top-Virus-Sender-with-Aggregation"
        set disp-name "FortiMail-FortiMail Top Virus Sender Domain"
        set category "FortiMail"
        set dev-type FortiMail
        set description "FortiMail Top Virus Sender Domain"
        set dataset "fml-domain-Top-Virus-Sender-with-Aggregation"
        set chart-style "{\"table-scheme\": \"dark\"}"
        set chart-type table
        config table-columns
            edit 1
                set header "Sender"
                set data-binding "sender"
                set data-top 10
                set column-width 20
            next
            edit 2
                set header "Viruses"
                set data-binding "virus_agg"
                set column-style "{\"max-text-length\":256}"
                set column-width 50
            next
            edit 3
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 30
            next
            edit 4
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-domain-Top-Virus-Recipient-with-Aggregation"
        set disp-name "FortiMail-FortiMail Top Virus Recipient by Mail Count"
        set category "FortiMail"
        set dev-type FortiMail
        set description "FortiMail Top Virus Recipient by Mail Count"
        set dataset "fml-domain-Top-Virus-Recipient-with-Aggregation"
        set chart-type table
        set chart-style "{\"table-scheme\": \"dark\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "Recipient"
                set data-binding "recipient"
                set data-top 10
                set column-width 20
            next
            edit 2
                set header "Viruses"
                set data-binding "virus_agg"
                set column-style "{\"max-text-length\":256}"
                set column-width 50
            next
            edit 3
                set header "Total Number"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 30
            next
            edit 4
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fml-domain-Top-Country-Sender"
        set disp-name "FortiMail-FortiMail Top Country Sender"
        set description "FortiMail Top Country Sender"
        set category "FortiMail"
        set dev-type FortiMail
        set dataset "fml-domain-Top-Country-Sender"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\", \"show-header\": \"enable\", \"height\":\"300\", \"fixed-bar-width\":\"20px\",  \"y-label\": \"flat\", \"bar-color\": \"bubble-ring\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "Country"
                set data-binding "country_cc"
                set column-attr country-code
                set data-top 10
            next
            edit 2
                set header "Senders"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
end

config sql-report macro
    edit "fml-Total-Counts-Inbound"
        set disp-name "FortiMail-Total Inbound Messages"
        set description "Total Inbound Messages"
        set dev-type FortiMail
        set dataset "fml-Total-Counts-Inbound"
        set data-binding "totalnum"
        set data-attr count
        set protected enable
    next
    edit "fml-Total-Malware-Inbound"
        set disp-name "FortiMail-Total Malware Identified"
        set description "Total Malware Identified"
        set dev-type FortiMail
        set dataset "fml-Total-Malware-Inbound"
        set data-binding "totalnum"
        set data-attr count
        set protected enable
    next
    edit "fml-Total-Classified-Inbound"
        set disp-name "FortiMail-Total Threats Identified"
        set description "Total Threats Identified"
        set dev-type FortiMail
        set dataset "fml-Total-Classified-Inbound"
        set data-binding "totalnum"
        set data-attr count
        set protected enable
    next
    edit "fml-Percentage-of-Unwanted-Mails"
        set disp-name "FortiMail-Percentage of Unwanted-Bulk-Spam Mails"
        set description "Percentage of Unwanted-Bulk-Spam Mails"
        set dev-type FortiMail
        set dataset "fml-Percentage-of-Unwanted-Mails"
        set data-binding "percentage_hits"
        set protected enable
    next
    edit "fml-Percentage-of-Known-Malware"
        set disp-name "FortiMail-Percentage of Known Malware"
        set description "Percentage of Known Malware"
        set dev-type FortiMail
        set dataset "fml-Percentage-of-Known-Malware"
        set data-binding "percentage_hits"
        set protected enable
    next
    edit "fml-Impersonation-Analysis-Total-Count"
        set disp-name "FortiMail-Total Impersonation Analysis Identified"
        set description "Total Impersonation Analysis Identified"
        set dev-type FortiMail
        set dataset "fml-Impersonation-Analysis-Total-Count"
        set data-binding "totalnum"
        set data-attr count
        set protected enable
    next
    edit "fml-domain-Number-of-Incoming-Mails"
        set disp-name "FortiMail-Number of Incoming Mails"
        set description "Number of Incoming Mails"
        set dev-type FortiMail
        set dataset "fml-domain-Number-of-Incoming-Mails"
        set data-binding "totalnum"
        set data-attr count
        set protected enable
    next
    edit "fml-domain-Number-of-Outgoing-Mails"
        set disp-name "FortiMail-Number of Outgoing Mails"
        set description "Number of Outgoing Mails"
        set dev-type FortiMail
        set dataset "fml-domain-Number-of-Outgoing-Mails"
        set data-binding "totalnum"
        set data-attr count
        set protected enable
    next
    edit "fml-domain-Total-Spam-Mail"
        set disp-name "FortiMail-FortiMail Total Spam Mail"
        set description "FortiMail Total Spam Mail"
        set dev-type FortiMail
        set dataset "fml-domain-Total-Spam-Mail"
        set data-binding "totalnum"
        set data-attr count
        set protected enable
    next
    edit "fml-domain-Total-Mail-with-Virus"
        set disp-name "FortiMail-FortiMail Total Mail with Virus"
        set description "FortiMail Total Mail with Virus"
        set dev-type FortiMail
        set dataset "fml-domain-Total-Mail-with-Virus"
        set data-binding "totalnum"
        set data-attr count
        set protected enable
    next

    edit "fml-domain-Total-Mail-Sender"
        set disp-name "FortiMail-FortiMail Total Mail Sender Domain"
        set description "FortiMail Total Mail Sender Domain"
        set dev-type FortiMail
        set dataset "fml-domain-Total-Mail-Sender"
        set data-binding "totalnum"
        set data-attr count
        set protected enable
    next

    edit "fml-domain-Total-Mail-Recipient"
        set disp-name "FortiMail-FortiMail Total Mail Recipient"
        set description "FortiMail Total Mail Recipient"
        set dev-type FortiMail
        set dataset "fml-domain-Total-Mail-Recipient"
        set data-binding "totalnum"
        set data-attr count
        set protected enable
    next
end


config sql-report layout
    edit 1000073001
        set is-template enable
        set dev-type FortiMail
        set category "FortiMail"
        set title "Template - FortiMail Default Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Top 10 client IP, senders, virus senders, local users, recipients and virus recipients"
        set body "<fazchart mkey=\"fml-History-Top10-Client-IP\" title=\"Top 10 Client IP\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-History-Top10-Sender\" title=\"Top 10 Senders\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-History-Top10-Virus-Sender\" title=\"Top 10 Virus Senders\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-History-Top10-Local-User\" title=\"Top 10 Local Users\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-History-Top10-Recipient\" title=\"Top 10 Recipients\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-History-Top10-Virus-Recipient\" title=\"Top 10 Virus Recipients\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90102
                next
            end
        set protected enable
    next
    edit 1000073002
        set is-template enable
        set dev-type FortiMail
        set category "FortiMail"
        set title "Template - FortiMail Analysis Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Statistics for Avg and Total mail size, number of mails and connections, delays, ip policies, recipient policies, top access list. Incoming filters for top spammed domains and users, classifiers by hour and disposition, and top subjects."
        set body "<h1>Statistics</h1><p></p><fazchart mkey=\"fml-Average-Size-of-Mails\" title=\"Average Size of Mails\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-Total-Size-of-Mails\" title=\"Total Size of Mails\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-Number-of-Mail-Connections\" title=\"Number of Mail Connections\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-Number-of-Mails\" title=\"Number of Mails\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-Total-Message-Delay\" title=\"Total Message Delay\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-Total-Message-Transmission-Delay\" title=\"Total Message Transmission Delay\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-Top-IP-Policy\" title=\"Top IP Policy\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-Top-Recipient-Policy\" title=\"Top Recipient Policy\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-Top-Access-List\" title=\"Top Access List\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Incoming Filtering</h1><p></p><fazchart mkey=\"fml-Top-Spammed-Domains\" title=\"Top Spammed Domains\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-Top-Spammed-Users\" title=\"Top Spammed Users\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-Top-Classifiers-By-Hour\" title=\"Top Classifiers By Hour\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-Top-Disposition-Classifiers\" title=\"Top Disposition Classifiers\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fml-Top-Subjects\" title=\"Top Subjects\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90102
                next
                edit 90203
                next
            end
        set protected enable
    next
    edit 1000073003
        set is-template enable
        set dev-type FortiMail
        set category "FortiMail"
        set title "Template - FortiMail Summary Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "FortiMail summary per domain."
        set body "<div style=\"height:5px\"></div><h2><span style=\"font-size:18px; font-family:Lato; color:black\"> MAIL SUMMARY</span></h2><table style=\"padding-top:5px; width:100%; height:15px\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\"><tr><td style=\"vertical-align:bottom; width:28px\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/incomingmails.png\" style=\"height:30px; width:25px\" /></td><td style=\"vertical-align:bottom\"><b><span style=\"font-size:24px\"><fazmacro mkey=\"fml-domain-Number-of-Incoming-Mails\"></fazmacro></span></b><span></span><span style=\"font-size:18px\">Incoming Mails</span></td><td style=\"vertical-align:bottom; width:28px\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/outgoingmails.png\" style=\"height:30px; width:25px\" /></td><td style=\"vertical-align:bottom\"><b><span style=\"font-size:24px\"><fazmacro mkey=\"fml-domain-Number-of-Outgoing-Mails\"></fazmacro></span></b><span style=\"font-size:18px; font-family:Lato\"> Outgoing Mails</span></td><td style=\"vertical-align:bottom; width:28px\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/virusmail.png\" style=\"height:25px; width:25px\" /></td><td style=\"vertical-align:bottom\"><b><span style=\"font-size:24px\"><fazmacro mkey=\"fml-domain-Total-Mail-with-Virus\"></fazmacro></span></b><span style=\"font-size:18px; font-family:Lato\"> Virus Mails</span></td></tr><tr><td style=\"height:15px\"></td></tr><tr><td style=\"vertical-align:bottom; width:28px\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/spammail.png\" style=\"height:25px; width:25px\" /></td><td style=\"vertical-align:bottom\"><b><span style=\"font-size:24px\"><fazmacro mkey=\"fml-domain-Total-Spam-Mail\"></fazmacro></span></b><span></span><span style=\"font-size:18px\">Spam Mails</span></td><td style=\"vertical-align:bottom; width:28px\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/sender_recipitant.png\" style=\"height:25px; width:25px\" /></td><td style=\"vertical-align:bottom\"><b><span style=\"font-size:24px\"><fazmacro mkey=\"fml-domain-Total-Mail-Sender\"></fazmacro></span></b><span style=\"font-size:18px; font-family:Lato\"> Senders</span></td><td style=\"vertical-align:bottom; width:28px\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/sender_recipitant.png\" style=\"height:25px; width:25px\" /></td><td style=\"vertical-align:bottom\"><b><span style=\"font-size:24px\"><fazmacro mkey=\"fml-domain-Total-Mail-Recipient\"></fazmacro></span></b><span style=\"font-size:18px; font-family:Lato\"> Recipients</span></td></tr></table><div style=\"height:25px;\"></div><div style=\"font-family: Lato;\"><fazchart width=\"1000px\" title=\"MAIL COUNT BY CATEGORY\" mkey=\"fml-domain-Mail-Category\"></fazchart></div><div style=\"height:25px\"></div><div style=\"font-family: Lato;\"><fazchart width=\"1000px\" title=\"TOP 10 MAIL VIRUS\" mkey=\"fml-domain-Top-Virus-Count\"></fazchart></div><div style=\"page-break-after: always\"></div><div style=\"height:5px\"></div><h2><span style=\"font-size:18px; font-family:Lato; color:black\"> MAIL SUMMARY</span></h2><div><fazchart width=\"1000px\" title=\"TOP 10 SENDER COUNTRY\" mkey=\"fml-domain-Top-Country-Sender\"></fazchart></div><div style=\"height:5px\"></div><div><fazchart width=\"1000px\" title=\"TOP 10 SPAM SUBJECT\" mkey=\"fml-domain-Top-Spam-Subject\"></fazchart></div><div style=\"page-break-after: always\"></div><div style=\"height:5px\"></div><h2><span style=\"font-size:18px; font-family:Lato; color:black\"> MAIL SUMMARY</span></h2><div><fazchart width=\"1000px\" title=\"TOP 10 MAIL RECIPIENT\" mkey=\"fml-domain-Top-Local-User-Count\"></fazchart></div><table style=\"width:100%\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\"><tr><td style=\"vertical-align:top\"><fazchart width=\"500px\" title=\"TOP 10 SPAM RECIPIENT\" mkey=\"fml-domain-Top-Spam-Recipient\"></fazchart></td><td style=\"vertical-align:top\"><fazchart width=\"500px\" title=\"TOP 10 VIRUS RECIPIENT\" mkey=\"fml-domain-Top-Virus-Recipient\"></fazchart></td></tr></table><div style=\"page-break-after: always\"></div><div style=\"height:5px\"></div><h2><span style=\"font-size:18px; font-family:Lato; color:black\"> MAIL SUMMARY</span></h2><table style=\"width:100%\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\"><tr><td style=\"vertical-align:top\"><fazchart width=\"500PX\" title=\"TOP 10 DESTINATION DOMAIN\" mkey=\"fml-domain-Top-Recipient-Domain\"></fazchart></td><td style=\"vertical-align:top\"><fazchart width=\"500px\" title=\"TOP 10 SENDER DOMAIN\" mkey=\"fml-domain-Top-Sender-Domain\"></fazchart></td></tr></table><p></p><div style=\"page-break-after: always\"></div><div style=\"height:5px\"></div><h2><span style=\"font-size:18px; font-family:Lato; color:black\"> SPAM SUMMARY</span></h2><table style=\"width:100%\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\"><tr><td style=\"vertical-align:top\"><fazchart width=\"350px\" title=\"SPAM MAIL CATEGORY\" mkey=\"fml-domain-Spam-Category\"></fazchart></td><td style=\"vertical-align:top\"><fazchart width=\"650px\" title=\"TOP 10 SPAM MAIL CATEGORY BY RECIPIENT\" mkey=\"fml-domain-Top-Spammed-Category-with-Users\"></fazchart></td></tr></table><div style=\"page-break-after: always\"></div><div style=\"height:5px\"></div><div style=\"page-break-inside: avoid;\"><h2><span style=\"font-size:18px; font-family:Lato; color:black\"> SPAM SUMMARY</span></h2><div><fazchart width=\"1000px\" title=\"TOP 5 SPAM SENDER DOMAIN BY CATEGORY\" mkey=\"fml-domain-Top-Spam-Sender-with-Category\"></fazchart><div style=\"height:20px\"></div><fazchart width=\"1000px\" title=\"TOP 5 SPAM MAIL RECIPIENT BY CATEGORY\" mkey=\"fml-domain-Top-Spammed-Users-with-Category-Table\"></fazchart></div></div><div style=\"page-break-after: always\"></div><div style=\"height:5px\"></div><h2><span style=\"font-size:18px; font-family:Lato; color:black\"> VIRUS SUMMARY</span></h2><div><fazchart width=\"1000px\" title=\"TOP 10 VIRUS MAIL RECIPIENT\" mkey=\"fml-domain-Top-Virus-Recipient-with-Aggregation\"></fazchart></div><div style=\"page-break-after: always\"></div><div style=\"height:5px\"></div><h2><span style=\"font-size:18px; font-family:Lato; color:black\"> VIRUS SUMMARY</span></h2><div><fazchart width=\"1000px\" title=\"TOP 10 MAIL VIRUS BY CATEGORY\" mkey=\"fml-domain-Virus-Category\"></fazchart></div><div style=\"page-break-after: always\"></div><div style=\"height:5px\"></div><h2><span style=\"font-size:18px; font-family:Lato; color:black\"> VIRUS SUMMARY</span></h2><div><fazchart width=\"1000px\" title=\"TOP 10 VIRUS SENDER DOMAIN\" mkey=\"fml-domain-Top-Virus-Sender-with-Aggregation\"></fazchart></div>"
            config header
                edit 1
                    set type graphic
                    set graphic "header_webusage_bg.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90102
                next
                edit 90203
                next
            end
        set report-tag "concise"
        set protected enable
    next
end

config sql-report layout-folder
    edit 99999
        set folder-name "Default Templates"
        set protected enable
    next
    edit 90102
        set folder-name "FortiMail Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90203
        set folder-name "SOC Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90205
        set folder-name "Outbreak Alert Reports Templates"
        set parent-id 99999
        set protected enable
    next
end

config sql-report schedule
    edit "1000073003"
         set is-template enable
         set description "FortiMail Summary Report"
         set include-coverpage disable
         set display-table-contents disable
         set output-format pdf
         set schedule-color "#5484ED"
         set resolve-hostname disable
         set device-list-type none
         set auto-hcache enable
         set orientation landscape
         set status disable
         set schedule-type every-n-weeks
         set schedule-frequency 1
         set schedule-valid-start 00:00 2022/04/01
         set time-period last-7-days
         set dev-type FortiMail
         set data-accuracy high
         config report-layout
             edit 1000073003
             next
         end
         config devices
            edit All_FortiMail
            next
         end
    next
end

config alert basic-handler
    edit 40000
        set name "Default-FML-Threat-Detection-By-Email"
        set description "Default FortiMail Handler to detect malicious and suspicious activities grouped by user's Email address"
        config rule
            edit 1
                set name "Malware detected in incoming email"
                set devtype FortiMail
                set severity critical
                set logtype "statistics"
                set extrainfo "Classifier: ${classifier}, From: ${from}, Server: ${client_name}(${client_ip})"
                set extrainfo-type custom
                set subject "Malware detected in incoming email"
                set groupby1 "to"
                set groupby2 "classifier"
                set eventstatus "open"
                set tags "Incoming,Email,Malware,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction==in and disposition!~quarantine and (classifier==\"Virus Signature\" or classifier==\"Fortiguard Outbreak\")"
            next
            edit 2
                set name "Malware detected in email"
                set devtype FortiMail
                set severity high
                set logtype "virus"
                set extrainfo "From: ${from}, Server: ${client_name}(${client_ip}), ${msg}"
                set extrainfo-type custom
                set subject "Malware detected in email"
                set groupby1 "to"
                set eventstatus "auto"
                set tags "Email,Malware,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "subtype==infected"
            next
            edit 3
                set name "Spam detected in incoming email"
                set devtype FortiMail
                set severity high
                set logtype "statistics"
                set extrainfo "Classifier: ${classifier}, From: ${from}, Server: ${client_name}(${client_ip})"
                set extrainfo-type custom
                set subject "Spam detected in incoming email"
                set groupby1 "to"
                set eventstatus "open"
                set tags "Incoming,Email,Spam,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction==in and disposition!~quarantine and disposition!~reject and ( classifier==\"Recipient Verification\" or classifier==\"Fortiguard Antispam\" or classifier==\"Fortiguard Antispam-ip\" or classifier==\"Image Spam\" )"
            next
            edit 4
                set name "Matched hash detected in email"
                set devtype FortiMail
                set severity medium
                set logtype "virus"
                set extrainfo "From: ${from}, Server: ${client_name}(${client_ip}), ${msg}"
                set extrainfo-type custom
                set subject "Matched hash detected in email"
                set groupby1 "to"
                set eventstatus "auto"
                set tags "Email,Risky,File,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 30
                set filter-expr "subtype==file-signature"
            next
            edit 5
                set name "Malicious URL detected in incoming email"
                set devtype FortiMail
                set severity high
                set logtype "statistics"
                set extrainfo "Classifier: ${classifier}, From: ${from}, Server: ${client_name}(${client_ip})"
                set extrainfo-type custom
                set subject "Malicious URL detected in incoming email"
                set groupby1 "to"
                set eventstatus "open"
                set tags "Incoming,Email,Risky,URL,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction==in and classifier==\"Fortiguard Webfilter\" and disposition!~quarantine"
            next
            edit 6
                set name "Suspicious URL detected in email"
                set devtype FortiMail
                set severity medium
                set logtype "spam"
                set extrainfo "From: ${from}, Server: ${client_name}(${client_ip}), ${msg}"
                set extrainfo-type custom
                set subject "Suspicious URL detected in email"
                set groupby1 "to"
                set eventstatus "auto"
                set tags "Email,Risky,URL,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "msg~\"Fortiguard-Webfilter\" and msg!~\"category: malicious website\" and msg!~\"category: spam URLs\" and msg!~\"category: phishing\""
            next
            edit 7
                set name "Malicious URL detected in email"
                set devtype FortiMail
                set severity high
                set logtype "spam"
                set extrainfo "From: ${from}, Server: ${client_name}(${client_ip}), ${msg}"
                set extrainfo-type custom
                set subject "Malicious URL detected in email"
                set groupby1 "to"
                set eventstatus "auto"
                set tags "Email,Risky,URL,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "msg~\"Fortiguard-Webfilter\" and (msg~\"category: malicious website\" or msg~\"category: spam URLs\" or msg~\"category: phishing\" )"
            next
            edit 8
                set name "Sandbox detected suspicious content in email"
                set devtype FortiMail
                set severity medium
                set logtype "virus"
                set extrainfo "From: ${from}, Server: ${client_name}(${client_ip}), ${msg}"
                set extrainfo-type custom
                set subject "Sandbox detected suspicious content in email"
                set groupby1 "to"
                set eventstatus "auto"
                set tags "Email,Risky,Sandbox,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "subtype==fortisandbox and (msg~\"rating=suspicious_medium\" or msg~\"rating=suspicious_high\" or msg~\"suspicious is found\" )"
            next
            edit 9
                set name "Outgoing email blocked by access control"
                set devtype FortiMail
                set severity medium
                set logtype "statistics"
                set extrainfo "Classifier: ${classifier}, From: ${from}, Server: ${client_name}(${client_ip})"
                set extrainfo-type custom
                set subject "Outgoing email blocked by access control"
                set groupby1 "to"
                set eventstatus "mitigated"
                set tags "Outgoing,Email,Access_Control,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "direction==out and classifier~\"Access Control\" and (disposition==discard or disposition==reject)"
            next
            edit 10
                set name "Oversize email detected"
                set devtype FortiMail
                set severity low
                set logtype "spam"
                set extrainfo "From: ${from}, Server: ${client_name}(${client_ip}), ${msg}"
                set extrainfo-type custom
                set subject "Oversize email detected"
                set groupby1 "to"
                set eventstatus "auto"
                set tags "Email,Risky,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "msg~\"max scan size\""
            next
            edit 11
                set name "Suspicious content detected in email"
                set devtype FortiMail
                set severity medium
                set logtype "virus"
                set extrainfo "From: ${from}, Server: ${client_name}(${client_ip}), ${msg}"
                set extrainfo-type custom
                set subject "Suspicious content detected in email"
                set groupby1 "to"
                set tags "Email,Risky,Malware,By_Endpoint"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "subtype==\"malware-outbreak\" and msg~\"suspicious content\""
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fml"
    next
    edit 40001
        set name "Default-FML-Compromised Host-Detection-IOC-By-Threat"
        set description "Default event handler to detect compromised hosts by IOC feature grouped by threat"
        config rule
            edit 1
                set name "User clicked the CnC malicious URL"
                set devtype FortiMail
                set severity critical
                set logtype "spam"
                set extrainfo "user:${to} clicked the CnC malicious URL:${tdurl}"
                set extrainfo-type custom
                set subject "Email filter CnC to $groupby1 detected"
                set groupby1 "to"
                set groupby2 "from"
                set eventstatus "open"
                set tags "Default,By_Threat,C&C,Email,Ioc_Rescan"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "tdtype~infected"
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fml"
    next
end


config sql-report dataset

    edit "fch-Global-Traffic-Timeline"
        set description "Global traffic time line"
        set log-type traffic
        set dev-type FortiCache
        set query "select $flex_timescale(timestamp) as hodex, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, sum(coalesce(resplength,0)) as bandwidth from $log where $filter and subtype='http-transaction' group by timestamp having sum(coalesce(resplength, 0))>0 order by timestamp desc)### t group by hodex order by hodex"
        set protected enable
    next

    edit "fch-Global-Request-Timeline"
        set description "Global request time line"
        set log-type traffic
        set dev-type FortiCache
        set query "select $flex_timescale(timestamp) as hodex, sum(request) as request from ###(select $flex_timestamp as timestamp, count(*) as request from $log where $filter and subtype='http-transaction' group by timestamp order by timestamp desc)### t group by hodex order by hodex"
        set protected enable
    next

    edit "fch-Top-Websites-by-Bandwidth"
        set description "Top websites by bandwidth"
        set log-type traffic
        set dev-type FortiCache
        set query "select root_domain(hostname) as host, sum(coalesce(resplength,0)) as bandwidth from $log where $filter and hostname is not null and subtype='http-transaction' group by host having sum(coalesce(resplength, 0))>0 order by bandwidth desc"
        set protected enable
    next

    edit "fch-Global-Bandwidth-Savings"
        set description "Global bandwidth savings"
        set log-type traffic
        set dev-type FortiCache
        set query "select sum(cache_len) as cache_len, sum(total_len) as total_len, cast(sum(cache_len)*100.0/sum(total_len) as decimal(18,2)) as savings from (###(select sum(case when resptype is not null then resplength else 0 end) as total_len, sum(case when resptype='cached' then resplength else 0 end) as cache_len from $log where $filter and subtype='http-transaction')###) t having sum(total_len)>0"
        set protected enable
    next

    edit "fch-Top-Websites-by-Bandwidth-Savings"
        set description "Fetch the top websites by bandwidth savings"
        set log-type traffic
        set dev-type FortiCache
        set query "select host, sum(cache_len) as cache_len, sum(cache_len+normal_len) as total_len, cast(sum(cache_len)*100.0/sum(cache_len+normal_len) as decimal(18,2)) as savings from (###(select root_domain(hostname) as host, sum(case when resptype='cached' then resplength else 0 end) as cache_len, sum(case when resptype in ('normal', 'generated') then resplength else 0 end) as normal_len from $log where $filter and hostname is not null and subtype='http-transaction' group by host)###) t where cache_len>0 and normal_len>0 group by host order by savings desc"
        set protected enable
    next

    edit "fch-Global-Cache-Rate"
        set description "Global cache rate"
        set log-type traffic
        set dev-type FortiCache
        set query "select sum(cache_objs) as cache_num, sum(total_objs) as total_num, cast(sum(cache_objs)*100.0/sum(total_objs) as decimal(18,2)) as cache_rate from (###(select sum(case when resptype='cached' then 1 else 0 end) as cache_objs, count(*) as total_objs from $log where $filter and subtype='http-transaction')###) t having sum(total_objs)>0"
        set protected enable
    next

    edit "fch-Top-Websites-by-Cache-Rate"
        set description "Fetch the top websites by cache rate"
        set log-type traffic
        set dev-type FortiCache
        set query "select host, cast(sum(cache_num)*100.0/sum(cache_num+normal_num) as decimal(18,2)) as cache_rate from (###(select root_domain(hostname) as host, sum(case when resptype='cached' then 1 else 0 end) as cache_num, sum(case when resptype in ('normal', 'generated') then 1 else 0 end) as normal_num from $log where $filter and hostname is not null and subtype='http-transaction' group by host)###) t where cache_num>0 and normal_num>0 group by host order by cache_rate desc"
        set protected enable
    next

    edit "fch-Top-Websites-by-Response-Time-Improvement"
        set description "Fetch the top websites by response time improvement"
        set log-type traffic
        set dev-type FortiCache
        set query "select host, cast(sum(normal_time - cache_time)*100.0/sum(normal_time) as decimal(18,2)) as improvement from (###(select root_domain(hostname) as host, sum(case when resptype='cached' then respfinishtime-reqtime else 0 end) as cache_time, sum(case when resptype in ('normal', 'generated') then respfinishtime-reqtime else 0 end) as normal_time from $log where $filter and hostname is not null and subtype='http-transaction' group by host)###) t where normal_time>0 and cache_time>0 and normal_time>cache_time group by host order by improvement desc"
        set protected enable
    next

    edit "fch-Top-Web-Users-By-Bandwidth"
        set description "fk Top Web Users By Bandwidth"
        set log-type traffic
        set dev-type FortiCache
        set query "select coalesce(nullifna(`user`),  ipstr(`srcip`)) as user_src, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out from $log where $filter group by user_src having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc"
        set protected enable
    next

    edit "fch-traffic-bandwidth-timeline"
        set description "fk traffic bandwidth timeline"
        set log-type traffic
        set dev-type FortiCache
        set query "select $flex_timescale(timestamp) as hodex, sum(traffic_out) as traffic_out, sum(traffic_in) as traffic_in from ###(select $flex_timestamp as timestamp, sum(coalesce(sentbyte, 0)) as traffic_out, sum(coalesce(rcvdbyte, 0)) as traffic_in from $log where $filter group by timestamp having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by timestamp desc)### t group by hodex order by hodex"
        set protected enable
    next

    edit "fch-utm-Top-Virus"
        set description "fk utm Top Virus"
        set log-type traffic
        set dev-type FortiCache
        set query "select virus, max(virusid) as virusid, (case when virus like 'Riskware%' then 'Spyware' when virus like 'Adware%' then 'Adware' else 'Virus' end) as malware_type, count(*) as totalnum from $log-virus where $filter and nullifna(virus) is not null group by virus order by totalnum desc"
        set protected enable
    next

    edit "fch-webfilter-Categories-By-Bandwidth"
        set description "fk utm Top Virus"
        set log-type webfilter
        set dev-type FortiCache
        set query "select catdesc, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log-webfilter where $filter and catdesc is not null group by catdesc order by bandwidth desc"
        set protected enable
    next

    edit "fch-webfilter-Top-Allowed-Web-Categories"
        set description "fk webfilter Top Allowed Web Categories"
        set log-type webfilter
        set dev-type FortiCache
        set query "select catdesc, sum(requests) as requests from ###(select hostname as domain, catdesc, action, count(*) as requests from $log where $filter and catdesc is not null group by domain, catdesc, action order by requests desc)### t where action!='blocked' group by catdesc order by requests desc"
        set protected enable
    next

    edit "fch-webfilter-Top-Allowed-Web-Sites-by-Bandwidth"
        set description "fk webfilter Top Allowed Web Sites by Bandwidth"
        set log-type webfilter
        set dev-type FortiCache
        set query "select domain, string_agg(distinct catdesc, ', ') as agg_catdesc, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from ###(select coalesce(nullifna(hostname), ipstr(`srcip`)) as domain, catdesc, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out from $log where $filter and action!='blocked' group by domain, catdesc having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc)### t group by domain order by bandwidth desc"
        set protected enable
    next

    edit "fch-webfilter-Top-Allowed-Web-Sites-By-Requests"
        set description "fk webfilter Top Allowed Web Sites By Requests"
        set log-type webfilter
        set dev-type FortiCache
        set query "select domain, string_agg(distinct catdesc, ', ') as agg_catdesc, sum(requests) as requests from ###(select hostname as domain, catdesc, action, count(*) as requests from $log where $filter and catdesc is not null group by domain, catdesc, action order by requests desc)### t where action!='blocked' and domain is not null group by domain order by requests desc"
        set protected enable
    next

    edit "fch-webfilter-Top-Blocked-Web-Categories"
        set description "fk webfilter Top Blocked Web Categories"
        set log-type webfilter
        set dev-type FortiCache
        set query "select catdesc, sum(requests) as requests from ###(select hostname as domain, catdesc, action, count(*) as requests from $log where $filter and catdesc is not null group by domain, catdesc, action order by requests desc)### t where action='blocked' group by catdesc order by requests desc"
        set protected enable
    next

    edit "fch-webfilter-Top-Blocked-Web-Sites-By-Requests"
        set description "fk webfilter Top Blocked Web Sites By Requests"
        set log-type webfilter
        set dev-type FortiCache
        set query "select domain, catdesc, sum(requests) as requests from ###(select hostname as domain, catdesc, action, count(*) as requests from $log where $filter and catdesc is not null group by domain, catdesc, action order by requests desc)### t where domain is not null and action='blocked' group by domain, catdesc order by requests desc"
        set protected enable
    next

    edit "fch-webfilter-Top-Web-Users-By-Allowed-Requests"
        set description "fk webfilter Top Web Users By Allowed Requests"
        set log-type webfilter
        set dev-type FortiCache
        set query "select user_src, sum(requests) as requests from ###(select coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, action, count(*) as requests from $log-webfilter where $filter and coalesce(nullifna(`user`), ipstr(`srcip`)) is not null group by user_src, action /*SkipSTART*/order by requests desc/*SkipEND*/)### t where action!='blocked' group by user_src order by requests desc"
        set protected enable
    next

    edit "fch-webfilter-Top-Web-Users-By-Blocked-Requests"
        set description "fk webfilter Top Web Users By Blocked Requests"
        set log-type webfilter
        set dev-type FortiCache
        set query "select user_src, sum(requests) as requests from ###(select coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, action, count(*) as requests from $log-webfilter where $filter and coalesce(nullifna(`user`), ipstr(`srcip`)) is not null group by user_src, action /*SkipSTART*/order by requests desc/*SkipEND*/)### t where action='blocked' group by user_src order by requests desc"
        set protected enable
    next

    edit "fch-webfilter-Web-Activity-Summary-By-Requests"
        set description "fk webfilter Top Web Activity Summary By Requests"
        set log-type webfilter
        set dev-type FortiCache
        set query "select $flex_timescale(timestamp) as hodex, sum(allowed_request) as allowed_request, sum(blocked_request) as blocked_request from ###(select $flex_timestamp as timestamp, sum(case when action!='blocked' then 1 else 0 end) as allowed_request, sum(case when action='blocked' then 1 else 0 end) as blocked_request from $log-webfilter where $filter group by timestamp order by timestamp desc)### t group by hodex order by hodex"
        set protected enable
    next
end


config sql-report chart

    edit "fch-Traffic-Timeline"
        set disp-name "FortiCache-Traffic timeline"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Traffic timeline"
        set dataset "fch-Global-Traffic-Timeline"
        set chart-type area
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "bandwidth"
                set column-graph-type line-up
                set column-attr bandwidth
                set legend "Global Traffic"
            next
        end
        set protected enable
    next

    edit "fch-Request-Timeline"
        set disp-name "FortiCache-Request timeline"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Request timeline"
        set dataset "fch-Global-Request-Timeline"
        set chart-type area
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "request"
                set column-graph-type line-up
                set column-attr count
                set legend "Requests"
            next
        end
        set protected enable
    next

    edit "fch-Top20-Websites-by-Bandwidth"
        set disp-name "FortiCache-Top Websites by Bandwidth Pie Chart"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 20 websites by bandwidth pie chart"
        set dataset "fch-Top-Websites-by-Bandwidth"
        set chart-type pie
        config table-columns
            edit 1
                set header "Websites"
                set data-binding "host"
                set data-top 20
            next
            edit 2
                set header "Bytes"
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next

    edit "fch-Global-Bandwidth-Savings"
        set disp-name "FortiCache-Global Bandwidth Savings"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Global bandwidth savings"
        set dataset "fch-Global-Bandwidth-Savings"
        set chart-type table
        config table-columns
            edit 1
                set header "Cached Bandwidth"
                set data-binding "cache_len"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 2
                set data-binding "cache_len"
                set column-attr bandwidth
            next
            edit 3
                set header "Total Bandwidth"
                set data-binding "total_len"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 4
                set data-binding "total_len"
                set column-attr bandwidth
            next
            edit 5
                set header "Bandwidth Savings"
                set data-binding "savings"
                set column-attr percent
                set column-width 20
            next
        end
        set protected enable
    next

    edit "fch-Top20-Websites-by-Bandwidth-Savings"
        set disp-name "FortiCache-Top 20 Websites by Bandwidth Savings"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 20 websites by bandwidth savings"
        set dataset "fch-Top-Websites-by-Bandwidth-Savings"
        set chart-type table
        config table-columns
            edit 1
                set header "Hostname"
                set data-binding "host"
                set data-top 20
                set column-width 25
            next
            edit 2
                set header "Cached Traffic"
                set data-binding "cache_len"
                set column-span 2
                set column-graph-type bar
                set column-width 30
            next
            edit 3
                set data-binding "cache_len"
                set column-attr bandwidth
            next
            edit 4
                set header "Total Traffic"
                set data-binding "total_len"
                set column-span 2
                set column-graph-type bar
                set column-width 30
            next
            edit 5
                set data-binding "total_len"
                set column-attr bandwidth
            next
            edit 6
                set header "Traffic Savings"
                set data-binding "savings"
                set column-attr percent
                set column-width 15
            next
        end
        set protected enable
    next

    edit "fch-Global-Cache-Rate"
        set disp-name "FortiCache-Global Cache Rate"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Global cache rate"
        set dataset "fch-Global-Cache-Rate"
        set chart-type table
        config table-columns
            edit 1
                set header "Cached Number"
                set data-binding "cache_num"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 2
                set data-binding "cache_num"
                set column-attr count
            next
            edit 3
                set header "Total Number"
                set data-binding "total_num"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 4
                set data-binding "total_num"
                set column-attr count
            next
            edit 5
                set header "Cached Rate"
                set data-binding "cache_rate"
                set column-attr percent
                set column-width 20
            next
        end
        set protected enable
    next

    edit "fch-Top20-Websites-by-Cache-Rate"
        set disp-name "FortiCache-Top 20 Websites by Cache Rate"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 20 websites by cache rate"
        set dataset "fch-Top-Websites-by-Cache-Rate"
        set chart-type table
        config table-columns
            edit 1
                set header "Hostname"
                set data-binding "host"
                set data-top 20
                set column-width 40
            next
            edit 2
                set header "Cached Rate"
                set data-binding "cache_rate"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "cache_rate"
                set column-attr percent
            next
        end
        set protected enable
    next

    edit "fch-Top20-Websites-by-Response-Time-Improvement"
        set disp-name "FortiCache-Top 20 Websites by Response Time Improvement"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 20 websites by response time improvement"
        set dataset "fch-Top-Websites-by-Response-Time-Improvement"
        set chart-type table
        config table-columns
            edit 1
                set header "Hostname"
                set data-binding "host"
                set data-top 20
                set column-width 40
            next
            edit 2
                set header "Improvement"
                set data-binding "improvement"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "improvement"
                set column-attr percent
            next
        end
        set protected enable
    next

    edit "fch-Bandwidth-Summary"
        set disp-name "FortiCache-Bandwidth Summary"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Traffic bandwidth usage summary"
        set dataset "fch-traffic-bandwidth-timeline"
        set chart-type area
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
            next
            edit 2
                set legend "Sent"
                set data-binding "traffic_out"
                set column-graph-type line-up
                set column-attr bandwidth
            next
            edit 3
                set legend "Received"
                set data-binding "traffic_in"
                set column-graph-type line-up
                set column-attr bandwidth
                
            next
        end
        set protected enable
    next

    edit "fch-Top-20-Allowed-Web-Categories"
        set disp-name "FortiCache-Top 20 Allowed Web Categories"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 20 allowed web filtering categories"
        set dataset "fch-webfilter-Top-Allowed-Web-Categories"
        set chart-type table
        config table-columns
            edit 1
                set header "Category"
                set data-binding "catdesc"
                set data-top 20
                set column-attr web-cat
            next
            edit 2
                set header "Requests"
                set data-binding "requests"
                set column-graph-type bar
                set column-span 2
            next
            edit 3
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fch-Top-20-Application-Categories-by-Bandwidth"
        set disp-name "FortiCache-Top 20 Application Categories by Bandwidth"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 20 application categories by bandwidth usage"
        set dataset "fch-webfilter-Categories-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Category"
                set data-binding "catdesc"
                set data-top 20
                set column-attr web-cat
            next
            edit 2
                set header "Bytes"
                set data-binding "bandwidth"
                set column-graph-type bar
                set column-span 2
            next
            edit 3
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next

    edit "fch-Top-20-Web-Users-by-Bandwidth"
        set disp-name "FortiCache-Top 20 Web Users by Bandwidth"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 20 web users by bandwidth"
        set dataset "fch-Top-Web-Users-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set data-top 10
                set column-attr user
            next
            edit 2
                set header "Bytes"
                set data-binding "bandwidth"
                set column-graph-type bar
                set column-span 2
            next
            edit 3
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
            edit 4
                set header "Bytes_in"
                set data-binding "traffic_in"
            next
            edit 5
                set header "Bytes_out"
                set data-binding "traffic_out"
            next
        end
        set protected enable
    next

    edit "fch-Top-20-Blocked-Web-Categories"
        set disp-name "FortiCache-Top 20 Blocked Web Categories"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 20 blocked web filter categories"
        set dataset "fch-webfilter-Top-Blocked-Web-Categories"
        set chart-type table
        config table-columns
            edit 1
                set header "Category"
                set data-binding "catdesc"
                set data-top 20
                set column-attr web-cat
            next
            edit 2
                set header "Requests"
                set data-binding "requests"
                set column-graph-type bar
                set column-span 2
            next
            edit 3
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fch-Top-20-Blocked-Websites"
        set disp-name "FortiCache-Top 20 Blocked Websites"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 20 Blocked websites by number of requests"
        set dataset "fch-webfilter-Top-Blocked-Web-Sites-By-Requests"
        set chart-type table
        config table-columns
            edit 1
                set header "Website"
                set data-binding "domain"
                set data-top 20
                set column-attr obf-url
            next
            edit 2
                set header "Category"
                set data-binding "catdesc"
                set column-attr web-cat
            next
            edit 3
                set header "Requests"
                set data-binding "requests"
                set column-graph-type bar
                set column-span 2
            next
            edit 4
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fch-Top-20-Viruses"
        set disp-name "FortiCache-Top 20 Viruses"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 20 viruses detected"
        set dataset "fch-utm-Top-Virus"
        set chart-type table
        config table-columns
            edit 1
                set header "Virus Name"
                set data-binding "virusid"
                set column-attr url
                set column-span 2
                set data-top 20
            next
            edit 2
                set data-binding "virus"
                set column-attr virus
            next
            edit 3
                set header "Malware Type"
                set data-binding "malware_type"
            next
            edit 4
                set header "Occurrences"
                set data-binding "totalnum"
                set column-graph-type bar
                set column-span 2
            next
            edit 5
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fch-Top-50-Allowed-Websites"
        set disp-name "FortiCache-Top 50 Allowed Websites"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 50 allowed websites by number of requests"
        set dataset "fch-webfilter-Top-Allowed-Web-Sites-By-Requests"
        set chart-type table
        config table-columns
            edit 1
                set header "Website"
                set data-binding "domain"
                set data-top 50
            next
            edit 2
                set header "Category"
                set data-binding "agg_catdesc"
                set column-attr web-cat
            next
            edit 3
                set header "Requests"
                set data-binding "requests"
                set column-graph-type bar
                set column-span 2
            next
            edit 4
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fch-Top-50-Websites-and-Category-by-Bandwidth"
        set disp-name "FortiCache-Top 50 Websites and Category by Bandwidth"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 50 websites and web filtering categories by bandwidth usage"
        set dataset "fch-webfilter-Top-Allowed-Web-Sites-by-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Website"
                set data-binding "domain"
                set data-top 50
            next
            edit 2
                set header "Category"
                set data-binding "agg_catdesc"
                set column-attr web-cat
            next
            edit 3
                set header "Bytes"
                set data-binding "bandwidth"
                set column-graph-type bar
                set column-span 2
            next
            edit 4
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next

   edit "fch-Top-Blocked-Categories-by-Donut-Chart"
        set disp-name "FortiCache-Top 10 Blocked Categories"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 10 Blocked Categories by donut chart"
        set dataset "fch-webfilter-Top-Blocked-Web-Categories"
        set chart-type donut
        config table-columns
            edit 1
                set header "Categories"
                set data-binding "catdesc"
                set data-top 10
            next
            edit 2
                set header "Requests"
                set data-type aggregate
                set data-binding "requests"
                set column-attr percent
            next
        end
        set protected enable
    next

    edit "fch-Top-Blocked-Websites-and-Categories"
        set disp-name "FortiCache-Top 50 Blocked Websites and Categories"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 50 blocked web filtering websites and categories by number of requests"
        set dataset "fch-webfilter-Top-Blocked-Web-Sites-By-Requests"
        set chart-type table
        config table-columns
            edit 1
                set header "Website"
                set data-binding "domain"
                set data-top 50
                set column-attr obf-url
            next
            edit 2
                set header "Category"
                set data-binding "catdesc"
                set column-attr web-cat
            next
            edit 3
                set header "Requests"
                set data-binding "requests"
                set column-graph-type bar
                set column-span 2
            next
            edit 4
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next

   edit "fch-Top-Categories-by-request-Donut-Chart"
        set disp-name "FortiCache-Top 10 Web Categories by request"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 10 categories by request donut chart"
        set dataset "fch-webfilter-Top-Allowed-Web-Categories"
        set chart-type donut
        config table-columns
            edit 1
                set header "Categories"
                set data-binding "catdesc"
                set data-top 10
            next
            edit 2
                set header "Requests"
                set data-type aggregate
                set data-binding "requests"
                set column-attr percent
            next
        end
        set protected enable
    next

    edit "fch-Top-Web-Users-by-Allowed-Requests"
        set disp-name "FortiCache-Top 20 Web Users by Allowed Requests"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 20 web users by number of allowed requests"
        set dataset "fch-webfilter-Top-Web-Users-By-Allowed-Requests"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set column-attr user
                set data-top 20
            next
            edit 2
                set header "Requests"
                set data-binding "requests"
                set column-graph-type bar
                set column-span 2
            next
            edit 3
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fch-Top-Web-Users-by-Blocked-Requests"
        set disp-name "FortiCache-Top 20 Web Users by Blocked Requests"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 20 web users by number of blocked requests"
        set dataset "fch-webfilter-Top-Web-Users-By-Blocked-Requests"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set column-attr user
                set data-top 20
            next
            edit 2
                set header "Requests"
                set data-binding "requests"
                set column-graph-type bar
                set column-span 2
            next
            edit 3
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next

   edit "fch-Top-Websites-by-Bandwidth-Donut-Chart"
        set disp-name "FortiCache-Top 10 Websites by Bandwidth"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Top 10 Websites by Bandwidth Donut Chart"
        set dataset "fch-webfilter-Top-Allowed-Web-Sites-by-Bandwidth"
        set chart-type donut
        config table-columns
            edit 1
                set header "Website"
                set data-binding "domain"
                set data-top 10
            next
            edit 2
                set header "Bytes"
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr percent
            next
        end
        set protected enable
    next

    edit "fch-Web-Activity-Summary"
        set disp-name "FortiCache-Web Activity Summary"
        set category "FortiCache"
        set dev-type FortiCache
        set description "Web activity summary by number of requests"
        set dataset "fch-webfilter-Web-Activity-Summary-By-Requests"
        set chart-type line
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
            next
            edit 2
                set legend "Allowed Requests"
                set data-binding "allowed_request"
                set column-graph-type line-up
            next
            edit 3
                set legend "Blocked Requests"
                set data-binding "blocked_request"
                set column-graph-type line-up
                
            next
        end
        set protected enable
    next

end


config sql-report layout
    edit 1000075001
        set is-template enable
        set dev-type FortiCache
        set category "FortiCache"
        set title "Template - FortiCache Default Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Global bandwidth savings, cache rate, traffic and request timeline. Top 20 websites by bandwidth, bandwidth savings, cache rate, response time improvement."
        set body "<fazchart mkey=\"fch-Global-Bandwidth-Savings\" title=\"Global Bandwidth Savings\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fch-Global-Cache-Rate\" title=\"Global Cache Rate\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fch-Traffic-Timeline\" title=\"Traffic Timeline\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fch-Request-Timeline\" title=\"Request Timeline\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fch-Top20-Websites-by-Bandwidth\" title=\"Top 20 Websites by Bandwidth Pie Chart\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fch-Top20-Websites-by-Bandwidth-Savings\" title=\"Top 20 Websites by Bandwidth Savings\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fch-Top20-Websites-by-Cache-Rate\" title=\"Top 20 Websites by Cache Rate\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fch-Top20-Websites-by-Response-Time-Improvement\" title=\"Top 20 Websites by Response Time Improvement\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90103
                next
            end
        set protected enable
    next

    edit 1000075002
        set is-template enable
        set dev-type FortiCache
        set category "FortiCache"
        set title "Template - FortiCache Web Usage Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set body "<h1>Web Usage Summary</h1><fazchart mkey=\"fch-Web-Activity-Summary\" title=\"Request Summary\" width=\"100%\"></fazchart><fazchart mkey=\"fch-Bandwidth-Summary\" title=\"Bandwidth Summary\" width=\"100%\"></fazchart><hr /><h1>Web Activity</h1><fazchart mkey=\"fch-Top-Web-Users-by-Allowed-Requests\" title=\"Top 20 Most Active Users\" width=\"100%\"></fazchart><fazchart mkey=\"fch-Top-Categories-by-request-Donut-Chart\" title=\"Top Categories by Request\" width=\"100%\"></fazchart><fazchart mkey=\"fch-Top-20-Allowed-Web-Categories\" title=\"Top 20 Allowed Web Categories\" width=\"100%\"></fazchart><fazchart mkey=\"fch-Top-50-Allowed-Websites\" title=\"Top 50 Most Visited Websites\" width=\"100%\"></fazchart><hr /><h1>Internet Bandwidth Usage</h1><fazchart mkey=\"fch-Top-20-Web-Users-by-Bandwidth\" title=\"Top 20 Bandwidth Users\" width=\"100%\"></fazchart><fazchart mkey=\"fch-Top-20-Application-Categories-by-Bandwidth\" title=\"Top 20 Categories By Bandwidth\" width=\"100%\"></fazchart><fazchart mkey=\"fch-Top-Websites-by-Bandwidth-Donut-Chart\" title=\"Top Websites by Bandwidth\" width=\"100%\"></fazchart><fazchart mkey=\"fch-Top-50-Websites-and-Category-by-Bandwidth\" title=\"Top 50 Websites and Category by Bandwidth\" width=\"100%\"></fazchart><hr /><h1>Most Blocked</h1><fazchart mkey=\"fch-Top-Web-Users-by-Blocked-Requests\" title=\"Top 20 Most Block Users\" width=\"100%\"></fazchart><fazchart mkey=\"fch-Top-Blocked-Categories-by-Donut-Chart\" title=\"Top Blocked Categories\" width=\"100%\"></fazchart><fazchart mkey=\"fch-Top-20-Blocked-Web-Categories\" title=\"Top 20 Blocked Web Categories\" width=\"100%\"></fazchart><fazchart mkey=\"fch-Top-Blocked-Websites-and-Categories\" title=\"Top 50 Most Blocked Websites\" width=\"100%\"></fazchart><p>&nbsp;</p>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90103
                next
                edit 90200
                next
            end
        set protected enable
    next

    edit 1000075003
        set is-template enable
        set dev-type FortiCache
        set category "FortiCache"
        set title "Template - FortiCache Security Analysis"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set body "<h1>User Security Analysis</h1><fazchart mkey=\"fch-Top-20-Blocked-Websites\" title=\"Top Blocked Web Sites\" width=\"100%\"></fazchart><fazchart mkey=\"fch-Top-50-Allowed-Websites\" title=\"Top Allowed Web Sites\" width=\"100%\"></fazchart><fazchart mkey=\"fch-Top-20-Blocked-Web-Categories\" title=\"Top Blocked Web Categories\" width=\"100%\"></fazchart><fazchart mkey=\"fch-Top-20-Allowed-Web-Categories\" title=\"Top Allowed Web Categories\" width=\"100%\"></fazchart><fazchart mkey=\"fch-Top-20-Viruses\" title=\"Top Detected Viruses\" width=\"100%\"></fazchart><p>&nbsp;</p>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90103
                next
                edit 90203
                next
            end
        set protected enable
    next
end


config sql-report layout-folder
    edit 99999
        set folder-name "Default Templates"
        set protected enable
    next
    edit 90103
        set folder-name "FortiCache Reports Templates"
        set parent-id 99999
        set protected enable
    next

    edit 90200
        set folder-name "Application Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90203
        set folder-name "SOC Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90205
        set folder-name "Outbreak Alert Reports Templates"
        set parent-id 99999
        set protected enable
    next
end


config sql-report dataset
    edit "fwb-attack-Top-Attack-Sources"
        set description "FortiWeb attack top attack sources"
        set log-type attack
        set dev-type FortiWeb
        set query "select src as srcip, count(*) as totalnum from $log where $filter and src is not null group by srcip order by totalnum desc"
        set protected enable
    next
    edit "fwb-attack-Top-Attack-Types"
        set description "FortiWeb attack top attack types"
        set log-type attack
        set dev-type FortiWeb
        set query "select subtype, count(*) as totalnum from $log where $filter and subtype is not null group by subtype order by totalnum desc"
        set protected enable
    next
    edit "fwb-attack-Top-Attack-URLs"
        set description "FortiWeb attack top attack URLs"
        set log-type attack
        set dev-type FortiWeb
        set query "select http_host, http_url, count(*) as totalnum from $log where $filter and http_host is not null and http_url is not null group by http_host, http_url order by totalnum desc"
        set protected enable
    next
    edit "fwb-attack-Top-Attack-Severities-By-Action"
        set description "FortiWeb attack top attack severities by action"
        set log-type attack
        set dev-type FortiWeb
        set query "select action, pri, count(*) as totalnum from $log where $filter and action is not null and pri is not null group by action, pri order by totalnum desc"
        set protected enable
    next
    edit "fwb-attack-Top-Attack-Destinations-By-Type" 
        set description "FortiWeb attack top attack destinations by type"
        set log-type attack
        set dev-type FortiWeb
        set query "select subtype, dst as dstip, count(*) as totalnum from $log where $filter and subtype is not null and dst is not null group by subtype, dstip order by totalnum desc"
        set protected enable
    next
    edit "fwb-attack-Top-Attack-Destinations-By-Source"
        set description "FortiWeb attack top attack destinations by source"
        set log-type attack
        set dev-type FortiWeb
        set query "select src as srcip, dst as dstip, count(*) as totalnum from $log where $filter and src is not null and dst is not null group by srcip, dstip order by totalnum desc"
        set protected enable
    next
    edit "fwb-attack-Top-Attack-Types-By-Source"
        set description "FortiWeb attack top attack types by source"
        set log-type attack
        set dev-type FortiWeb
        set query "select src as srcip, subtype, count(*) as totalnum from $log where $filter and src is not null group by srcip, subtype order by totalnum desc"
        set protected enable
    next
    edit "fwb-attack-Top-Attacked-Http-Methods-By-Type"
        set description "FortiWeb attack top attacked HTTP methods by type"
        set log-type attack
        set dev-type FortiWeb
        set query "select subtype, http_method, count(*) as totalnum from $log where $filter and subtype is not null and http_method is not null group by subtype, http_method order by totalnum desc"
        set protected enable
    next
    edit "fwb-attack-Top-Attacks-By-Policy"
        set description "FortiWeb attack top attacks by policy"
        set log-type attack
        set dev-type FortiWeb
        set query "select policy, count(*) as totalnum from $log where $filter and policy is not null group by policy order by totalnum desc"
        set protected enable
    next
    edit "fwb-attack-Top-Attacked-Destinations"
        set description "FortiWeb attack top attacked destinations"
        set log-type attack
        set dev-type FortiWeb
        set query "select dst as dstip, count(*) as totalnum from $log where $filter and dst is not null group by dstip order by totalnum desc"
        set protected enable
    next
    edit "fwb-attack-Top-Attack-Protocols-By-Type"
        set description "FortiWeb attack top attack protocols by type"
        set log-type attack
        set dev-type FortiWeb
        set query "select subtype, service as f_service, count(*) as totalnum from $log where $filter and subtype is not null and service is not null group by subtype, f_service order by totalnum desc"
        set protected enable
    next
    edit "fwb-attack-Top-Attacked-User-Identifications"
        set description "FortiWeb attack top attacked user identifications"
        set log-type attack
        set dev-type FortiWeb
        set query "select http_session_id, count(*) as totalnum from $log where $filter and http_session_id is not null group by http_session_id order by totalnum desc"
        set protected enable
    next
    edit "fwb-traffic-Top-Policies"
        set description "FortiWeb traffic top policies"
        set log-type traffic
        set dev-type FortiWeb
        set query "select policy, count(*) as totalnum from $log where $filter and policy is not null group by policy order by totalnum desc"
        set protected enable
    next
    edit "fwb-traffic-Top-Services"
        set description "FortiWeb traffic top services"
        set log-type traffic
        set dev-type FortiWeb
        set query "select service as f_service, count(*) as totalnum from $log where $filter and service is not null group by f_service order by totalnum desc"
        set protected enable
    next
    edit "fwb-traffic-Top-Sources"
        set description "FortiWeb traffic top sources"
        set log-type traffic
        set dev-type FortiWeb
        set query "select src as srcip, count(*) as totalnum from $log where $filter and src is not null group by srcip order by totalnum desc"
        set protected enable
    next
    edit "fwb-traffic-Top-Destinations"
        set description "FortiWeb traffic top destinations"
        set log-type traffic
        set dev-type FortiWeb
        set query "select dst as dstip, count(*) as totalnum from $log where $filter and dst is not null group by dstip order by totalnum desc"
        set protected enable
    next
    edit "fwb-event-Top-event-categories"
        set description "FortiWeb event top event categories"
        set log-type event
        set dev-type FortiWeb
        set query "select pri, count(*) as totalnum from $log where $filter and pri is not null group by pri order by totalnum desc"
        set protected enable
    next
    edit "fwb-event-Top-event-types"
        set description "FortiWeb event top event types"
        set log-type event
        set dev-type FortiWeb
        set query "select subtype, count(*) as totalnum from $log where $filter and subtype is not null group by subtype order by totalnum desc"
        set protected enable
    next
    edit "fwb-event-Top-Event-Categories-By-Status"
        set description "FortiWeb event top event categories by status"
        set log-type event
        set dev-type FortiWeb
        set query "select pri, status, count(*) as totalnum from $log where $filter and pri is not null and status is not null group by pri, status order by totalnum desc"
        set protected enable
    next
    edit "fwb-event-Top-login-by-user"
        set description "FortiWeb event top login by user"
        set log-type event
        set dev-type FortiWeb
        set query "select `user`as f_user, msg, count(*) as totalnum from $log where $filter and `user` is not null and msg is not null group by f_user, msg order by totalnum desc"
        set protected enable
    next
    edit "fwb-traffic-bw-over-time"
        set description "Bandwidth Over Time"
        set log-type traffic
        set dev-type FortiWeb
        set query "select $flex_timescale(timestamp) as hodex, sum(req_in) as req_in, sum(resp_out) as resp_out from ###(select $flex_timestamp as timestamp, sum(http_request_bytes) as req_in, sum(http_response_bytes) as resp_out from $log where $filter and http_host!='none' and nullifna(http_host) is not null group by timestamp order by timestamp desc)### t group by hodex order by hodex"
        set protected enable
    next
    edit "fwb-traffic-top-resp-bytes"
        set description "Top Hosts per Response Bytes"
        set log-type traffic
        set dev-type FortiWeb
        set query "select http_host ,sum(http_request_bytes) as req_in, sum(http_response_bytes) as resp_out from $log where $filter and http_host!='none' and nullifna(http_host) is not null group by http_host order by resp_out desc"
        set protected enable
    next
    edit "fwb-traffic-top-bw-per-domain-over-time"
        set description "Bandwidth per Domain over Time"
        set log-type traffic
        set dev-type FortiWeb
        set query "select $flex_timescale(timestamp) as hodex, http_host, sum(req_in) as req_in, sum(resp_out) as resp_out from ###(select $flex_timestamp as timestamp, http_host, sum(http_request_bytes) as req_in, sum(http_response_bytes) as resp_out from $log where $filter and http_host!='none' and nullifna(http_host) is not null group by timestamp, http_host order by timestamp desc)### t group by http_host, hodex order by hodex"
        set protected enable
    next
    edit "fwb-attack-top-hosts"
        set description "Intrusion Prevention"
        set log-type traffic
        set dev-type FortiWeb
        set query "select http_host,  count(*) as hits from $log where $filter and http_host!='none' and nullifna(http_host) is not null group by http_host order by hits desc"
        set protected enable
    next
    edit "fwb-traffic-top-hosts"
        set description "All Hosts by Hits"
        set log-type traffic
        set dev-type FortiWeb
        set query "select http_host, count(*) as hits from $log where $filter and http_host!='none' and nullifna(http_host) is not null group by http_host order by hits desc"
        set protected enable
    next
    edit "fwb-traffic-top-hits-per-domain-over-time"
        set description "Top Hits per Domain over Time"
        set log-type traffic
        set dev-type FortiWeb
        set query "select $flex_timescale(timestamp) as hodex, http_host, sum(hits) as hits from ###(select $flex_timestamp as timestamp, http_host, count(*) as hits from $log where $filter and http_host!='none' and nullifna(http_host) is not null group by timestamp, http_host order by timestamp desc)### t group by hodex, http_host order by hodex"
        set protected enable
    next
    edit "fwb-traffic-top-hits-uniq-src-per-domain-over-time"
        set description "Top Hits per Unique Src per Domain over Time"
        set log-type traffic
        set dev-type FortiWeb
        set query "select $flex_timescale(timestamp) as hodex, http_host, count(distinct src) as hits from ###(select $flex_timestamp as timestamp, http_host, src from $log where $filter and http_host!='none' and nullifna(http_host) is not null group by timestamp, http_host, src order by timestamp desc)### t group by hodex, http_host order by hodex"
        set protected enable
    next
    edit "fwb-traffic-http-methods-over-time"
        set description "HTTP Methods over Time"
        set log-type traffic
        set dev-type FortiWeb
        set query "select $flex_timescale(timestamp) as hodex, http_method, sum(hits) as hits from ###(select $flex_timestamp as timestamp, http_method, count(*) as hits from $log where $filter and http_method!='none' and nullifna(http_method) is not null group by timestamp, http_method order by timestamp desc)### t group by http_method, hodex order by hodex"
        set protected enable
    next
    edit "fwb-traffic-retcode"
        set description "Top HTTP Response Status Codes"
        set log-type traffic
        set dev-type FortiWeb
        set query "select http_retcode, count(*) as hits from $log where $filter and http_retcode!='0' and nullifna(http_retcode::text) is not null group by http_retcode order by hits desc"
        set protected enable
    next
    edit "fwb-traffic-retcode-400-per-url"
        set description "Top 400 Response Status Codes per URL"
        set log-type traffic
        set dev-type FortiWeb
        set query "select http_retcode, url, sum(hits) as hits from ###(select http_retcode, http_host::text || http_url::text as url, count(*) as hits from $log where $filter group by http_retcode, url order by hits desc)### t where http_retcode::text like '40%' group by http_retcode, url order by hits desc"
        set protected enable
    next
    edit "fwb-traffic-retcode-500-per-url"
        set description "Top 500 Response Status Codes per URL"
        set log-type traffic
        set dev-type FortiWeb
        set query "select http_retcode, url, sum(hits) as hits from ###(select http_retcode, http_host::text || http_url::text as url, count(*) as hits from $log where $filter group by http_retcode, url order by hits desc)### t where http_retcode::text like '50%' group by http_retcode, url order by hits desc"
        set protected enable
    next
    edit "fwb-traffic-retcode-per-domain"
        set description "Top HTTP Response Status Codes per Domain"
        set log-type traffic
        set dev-type FortiWeb
        set query "select http_retcode, http_host, count(*) as hits from $log where $filter and http_retcode!='0' and nullifna(http_retcode::text) is not null group by http_retcode, http_host order by hits desc"
        set protected enable
    next
    edit "fwb-traffic-top-user-agent"
        set description "Top User Agent"
        set log-type traffic
        set dev-type FortiWeb
        set query "select http_agent, count(*) as hits from $log where $filter and http_agent!='none' and nullifna(http_agent) is not null group by http_agent order by hits desc"
        set protected enable
    next

end

config sql-report chart
    edit "fwb-attack-Top-Attack-Sources"
        set disp-name "FortiWeb-Top Attack Sources"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 sources of attacks"
        set dataset "fwb-attack-Top-Attack-Sources"
        set chart-type pie
        config table-columns
            edit 1
                set header "Source IP"
                set data-binding "srcip"
                set data-top 10
            next
            edit 2
                set header "Events"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
        set protected enable
    next
    edit "fwb-attack-Top-Attack-Types"
        set disp-name "FortiWeb-Top Attack Types"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 detected attack types"
        set dataset "fwb-attack-Top-Attack-Types"
        set chart-type pie
        config table-columns
            edit 1
                set header "Subtype"
                set data-binding "subtype"
                set data-top 10
            next
            edit 2
                set header "Events"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
	    set protected enable
    next
    edit "fwb-attack-Top-Attack-URLs"
        set disp-name "FortiWeb-Top Attack URLs"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 detected attack URLs"
        set dataset "fwb-attack-Top-Attack-URLs"
        set chart-type table
        config table-columns
            edit 1
                set header "Host"
                set data-binding "http_host"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "URL"
                set data-binding "http_url"
                set column-width 40
            next
            edit 3
                set header "Events"
                set data-binding "totalnum"
                set column-attr count
                set column-width 20
            next
        end
	set protected enable
    next
    edit "fwb-attack-Top-Attack-Severity-By-Action"
        set disp-name "FortiWeb-Top Attack Severity by Action"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 detected attack severities by action"
        set dataset "fwb-attack-Top-Attack-Severities-By-Action"
        set chart-type table
        config table-columns
            edit 1
                set header "Action"
                set data-binding "action"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Categories"
                set data-binding "pri"
                set column-width 40
            next
            edit 3
                set header "Events"
                set data-binding "totalnum"
                set column-attr count
                set column-width 20
            next
        end
	set protected enable
    next
    edit "fwb-attack-Top-Attack-Destinations-By-Type"
        set disp-name "FortiWeb-Top Attack Destinations by Type"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 attacked destinations by type"
        set dataset "fwb-attack-Top-Attack-Destinations-By-Type"
        set chart-type table
        config table-columns
            edit 1
                set header "SubType"
                set data-binding "subtype"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Destination"
                set data-binding "dstip"
                set column-width 40
            next
            edit 3
                set header "Events"
                set data-binding "totalnum"
                set column-attr count
                set column-width 20
            next
        end
	set protected enable
    next
    edit "fwb-attack-Top-Attack-Destinations-By-Source"
        set disp-name "FortiWeb-Top Attack Destinations by Source"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 attacked destinations by source"
        set dataset "fwb-attack-Top-Attack-Destinations-By-Source"
        set chart-type table
        config table-columns
            edit 1
                set header "Source"
                set data-binding "srcip"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Destination"
                set data-binding "dstip"
                set column-width 40
            next
            edit 3
                set header "Events"
                set data-binding "totalnum"
                set column-attr count
                set column-width 20
            next
        end
	set protected enable
    next
    edit "fwb-attack-Top-Attack-Types-By-Source"
        set disp-name "FortiWeb-Top Attack Types by Source"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 detected attack types by source"
        set dataset "fwb-attack-Top-Attack-Types-By-Source"
        set chart-type table
        config table-columns
            edit 1
                set header "Source"
                set data-binding "srcip"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "SubType"
                set data-binding "subtype"
                set column-width 40
            next
            edit 3
                set header "Events"
                set data-binding "totalnum"
                set column-attr count
                set column-width 20
            next
        end
	set protected enable
    next
    edit "fwb-attack-Top-Attacked-Http-Methods-By-Type"
        set disp-name "FortiWeb-Top Attacked HTTP Methods by Type"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 attacked HTTP methods by attack type"
        set dataset "fwb-attack-Top-Attacked-Http-Methods-By-Type"
        set chart-type table
        config table-columns
            edit 1
                set header "SubType"
                set data-binding "subtype"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Method"
                set data-binding "http_method"
                set column-width 40
            next
            edit 3
                set header "Events"
                set data-binding "totalnum"
                set column-attr count
                set column-width 20
            next
        end
	set protected enable
    next
    edit "fwb-attack-Top-Attacks-By-Policy"
        set disp-name "FortiWeb-Top Attacks by Policy"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 attacks used by policies"
        set dataset "fwb-attack-Top-Attacks-By-Policy"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "Policy"
                set data-binding "policy"
                set data-top 10
            next
            edit 2
                set header "Events"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
	set protected enable
    next
    edit "fwb-attack-Top-Attacked-Destinations"
        set disp-name "FortiWeb-Top Attacked Destinations"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 attacked destinations"
        set dataset "fwb-attack-Top-Attacked-Destinations"
        set chart-type pie
        config table-columns
            edit 1
                set header "Destination"
                set data-binding "dstip"
                set data-top 10
            next
            edit 2
                set header "Events"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
	set protected enable
    next
    edit "fwb-attack-Top-Attack-Protocols-By-Type"
        set disp-name "FortiWeb-Top Attack Protocols by Type"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 attack protocols by type"
        set dataset "fwb-attack-Top-Attack-Protocols-By-Type"
        set chart-type table
        config table-columns
            edit 1
                set header "SubType"
                set data-binding "subtype"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Service"
                set data-binding "f_service"
                set column-width 40
            next
            edit 3
                set header "Events"
                set data-binding "totalnum"
                set column-attr count
                set column-width 20
            next
        end
	set protected enable
    next
    edit "fwb-attack-Top-Attacked-User-Identifications"
        set disp-name "FortiWeb-Top Attacked User Identifications"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 Attacked User identifications"
        set dataset "fwb-attack-Top-Attacked-User-Identifications"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "Session ID"
                set data-binding "http_session_id"
                set data-top 10
            next
            edit 2
                set header "Events"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
	set protected enable
    next
    edit "fwb-traffic-Top-Policies"
        set disp-name "FortiWeb-Top Traffic Policies"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 policies in FortiWeb traffic"
        set dataset "fwb-traffic-Top-Policies"
        set chart-type pie
        config table-columns
            edit 1
                set header "Policy"
                set data-binding "policy"
                set data-top 10
            next
            edit 2
                set header "Events"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
	set protected enable
    next
    edit "fwb-traffic-Top-Services"
        set disp-name "FortiWeb-Top Traffic Services"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 services in FortiWeb traffic"
        set dataset "fwb-traffic-Top-Services"
        set chart-type pie
        config table-columns
            edit 1
                set header "Service"
                set data-binding "f_service"
                set data-top 10
            next
            edit 2
                set header "Events"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
	    set protected enable
    next
    edit "fwb-traffic-Top-Sources"
        set disp-name "FortiWeb-Top Traffic Sources"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 sources in FortiWeb traffic"
        set dataset "fwb-traffic-Top-Sources"
        set chart-type pie
        config table-columns
            edit 1
                set header "Source IP"
                set data-binding "srcip"
                set data-top 10
            next
            edit 2
                set header "Events"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
	    set protected enable
    next
    edit "fwb-traffic-Top-Destinations"
        set disp-name "FortiWeb-Top Traffic Destinations"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 destinations in FortiWeb traffic"
        set dataset "fwb-traffic-Top-Destinations"
        set chart-type pie
        config table-columns
            edit 1
                set header "Destination"
                set data-binding "dstip"
                set data-top 10
            next
            edit 2
                set header "Events"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
	    set protected enable
    next
    edit "fwb-event-Top-Event-Categories"
        set disp-name "FortiWeb-Top Event Categories"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 event categories"
        set dataset "fwb-event-Top-event-categories"
        set chart-type pie
        config table-columns
            edit 1
                set header "Category"
                set data-binding "pri"
                set data-top 10
            next
            edit 2
                set header "Events"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
	    set protected enable
    next
    edit "fwb-event-Top-Event-Types"
        set disp-name "FortiWeb-Top Event Types"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 event types"
        set dataset "fwb-event-Top-event-types"
        set chart-type pie
        config table-columns
            edit 1
                set header "Subtype"
                set data-binding "subtype"
                set data-top 10
            next
            edit 2
                set header "Events"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
	    set protected enable
    next
    edit "fwb-event-Top-Event-Categories-By-Status"
        set disp-name "FortiWeb-Top Event Categories by Status"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 event categories by status"
        set dataset "fwb-event-Top-Event-Categories-By-Status"
        set chart-type table
        config table-columns
            edit 1
                set header "Categories"
                set data-binding "pri"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Status"
                set data-binding "status"
                set column-width 40
            next
            edit 3
                set header "Events"
                set data-binding "totalnum"
                set column-attr count
                set column-width 20
            next
        end
	set protected enable
    next
    edit "fwb-event-Top-Login-By-User"
        set disp-name "FortiWeb-Top Event Login by User"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 login events by user"
        set dataset "fwb-event-Top-login-by-user"
        set chart-type table
        config table-columns
            edit 1
                set header "User"
                set data-binding "f_user"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Message"
                set data-binding "msg"
                set column-width 40
            next
            edit 3
                set header "Events"
                set data-binding "totalnum"
                set column-attr count
                set column-width 20
            next
        end
	set protected enable
    next
    edit "fwb-bandwithd-over-time"
        set disp-name "FortiWeb-Bandwidth Over Time"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Bandwidth Over Time"
        set dataset "fwb-traffic-bw-over-time"
        set chart-type area
        config table-columns
            edit 1
                set data-binding "hodex"
                set column-attr time
            next
            edit 2
                set data-binding "req_in"
                set column-graph-type line-up
                set column-attr bandwidth
                set legend "HTTP Request Bytes"
            next
            edit 3
                set data-binding "resp_out"
                set column-graph-type line-up
                set column-attr bandwidth
                set legend "HTTP Response Bytes"
            next

        end
        set protected enable
    next
    edit "fwb-top-hosts-per-response"
        set disp-name "FortiWeb-Top Hosts per Response Bytes"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top Hosts per Response Bytes"
        set dataset "fwb-traffic-top-resp-bytes"
        set resolve-hostname disable
        set chart-type table
        config table-columns
            edit 1
                set header "HTTP Host"
                set data-binding "http_host"
                set data-top 10
                set column-width 0
            next
            edit 2
                set header "HTTP Request Bytes"
                set data-binding "req_in"
                set column-attr bandwidth
                set column-width 0
            next
            edit 3
                set header "HTTP Response Bytes"
                set data-binding "resp_out"
                set column-attr bandwidth
                set column-width 0
                set data-top 10
            next
        end
        set protected enable
    next
    edit "fwb-bandwidth-per-domain"
        set disp-name "FortiWeb-Bandwidth per Domain over Time"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Bandwidth per Domain over Time"
        set dataset "fwb-traffic-top-bw-per-domain-over-time"
        set chart-type bar
        set order-by "hodex"
        set include-other enable
        config table-columns
            edit 1
                set header ""
                set data-binding "hodex"
                set column-attr time
                set data-top 744
            next
            edit 2
                set header "Host"
                set data-type drilldown
                set data-binding "http_host"
                set data-top 3
            next
            edit 3
                set header ""
                set data-binding "resp_out"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "fwb-top-hosts-by-hits"
        set disp-name "FortiWeb-Top Hosts"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top Hosts by Hits"
        set dataset "fwb-attack-top-hosts"
        set chart-type bar
        set include-other enable
        config table-columns
            edit 1
                set header "HTTP Host"
                set data-binding "http_host"
                set data-top 10
            next
            edit 2
                set header "Hits"
                set data-binding "hits"
                set column-attr count
                set data-type aggregate
                set data-top 3
            next
        end
        set protected enable
    next
    edit "fwb-all-hosts-by-hits"
        set disp-name "FortiWeb-All Hosts"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "All Hosts by Hits"
        set dataset "fwb-traffic-top-hosts"
        set resolve-hostname disable
        set chart-type table
        set include-other enable
        config table-columns
            edit 1
                set header "HTTP Host"
                set data-binding "http_host"
                set data-top 50
                set column-width 0
            next
            edit 2
                set header "Hits"
                set data-binding "hits"
                set column-attr count
                set data-type aggregate
                set column-width 0
            next
        end
        set protected enable
    next
    edit "fwb-top-hits-per-domain-over-time"
        set disp-name "FortiWeb-Top Hits per Domain over Time"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top Hits per Domain over Time"
        set dataset "fwb-traffic-top-hits-per-domain-over-time"
        set chart-type bar
        set order-by "hodex"
        set include-other disable
        config table-columns
            edit 1
                set header ""
                set data-binding "hodex"
                set column-attr time
                set data-top 744
            next
            edit 2
                set header ""
                set data-type drilldown
                set data-binding "http_host"
                set data-top 3
            next
            edit 3
                set header ""
                set data-binding "hits"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fwb-top-hits-per-src-per-domain"
        set disp-name "FortiWeb-Top Hits per Unique Src per Domain over Time"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top Hits per Unique Src per Domain over Time"
        set dataset "fwb-traffic-top-hits-uniq-src-per-domain-over-time"
        set chart-type bar
        set order-by "hodex"
        set include-other disable
        config table-columns
            edit 1
                set header ""
                set data-binding "hodex"
                set column-attr time
                set data-top 744
            next
            edit 2
                set header ""
                set data-type drilldown
                set data-binding "http_host"
                set data-top 3
            next
            edit 3
                set header ""
                set data-binding "hits"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fwb-http-methods-over-time"
        set disp-name "FortiWeb-HTTP Methods over Time"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "HTTP Methods over Time"
        set dataset "fwb-traffic-http-methods-over-time"
        set chart-type bar
        set order-by "hodex"
        set include-other disable
        config table-columns
            edit 1
                set header ""
                set data-binding "hodex"
                set column-attr time
                set data-top 744
            next
            edit 2
                set header ""
                set data-type drilldown
                set data-binding "http_method"
                set data-top 3
            next
            edit 3
                set header "Hits"
                set data-binding "hits"
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "fwb-top-http-response-status-codes"
        set disp-name "FortiWeb-Top HTTP Response Status Codes"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top HTTP Response Status Codes"
        set dataset "fwb-traffic-retcode"
        set chart-type bar
        set include-other enable
        config table-columns
            edit 1
                set header "HTTP RetCode"
                set data-binding "http_retcode"
                set data-top 10
            next
            edit 2
                set header "Hits"
                set data-binding "hits"
                set column-attr count
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "fwb-top-400-response-status-code-per-url"
        set disp-name "FortiWeb-Top 400 Response Status Codes per URL"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 400 Response Status Codes per URL"
        set dataset "fwb-traffic-retcode-400-per-url"
        set resolve-hostname disable
        set chart-type table
        config table-columns
            edit 1
                set header "HTTP Retcode"
                set data-binding "http_retcode"
                set data-top 10
                set column-width 15
            next
            edit 2
                set header "URL"
                set data-binding "url"
                set column-width 70
            next
            edit 3
                set header "Hits"
                set data-binding "hits"
                set column-attr count
                set column-width 15
            next
        end
        set protected enable
    next
    edit "fwb-top-500-response-status-codes-per-url"
        set disp-name "FortiWeb-Top 500 Response Status Codes per URL"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 500 Response Status Codes per URL"
        set dataset "fwb-traffic-retcode-500-per-url"
        set resolve-hostname disable
        set chart-type table
        config table-columns
            edit 1
                set header "HTTP Retcode"
                set data-binding "http_retcode"
                set data-top 10
                set column-width 15
            next
            edit 2
                set header "URL"
                set data-binding "url"
                set column-width 70
            next
            edit 3
                set header "Hits"
                set data-binding "hits"
                set column-attr count
                set column-width 15
            next
        end
        set protected enable
    next
    edit "fwb-top-http-response-status-codes-per-domain"
        set disp-name "FortiWeb-Top HTTP Response Status Codes per Domain"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top HTTP Response Status Codes per Domain"
        set dataset "fwb-traffic-retcode-per-domain"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "HTTP Host"
                set data-binding "http_host"
                set data-top 10
            next
            edit 2
                set header ""
                set data-type drilldown
                set data-binding "http_retcode"
                set data-top 3
            next
            edit 3
                set header "Hits"
                set data-binding "hits"
                set column-attr count
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "fwb-top-user-agent"
        set disp-name "FortiWeb-Top User Agent"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top User Agent"
        set dataset "fwb-traffic-top-user-agent"
        set chart-type pie
        set include-other enable
        config table-columns
            edit 1
                set header "HTTP Agent"
                set data-binding "http_agent"
                set data-top 10
            next
            edit 2
                set header "Hits"
                set data-type aggregate
                set column-attr count
                set data-binding "hits"
            next
        end
        set protected enable
    next
end


config sql-report layout
    edit 1000074001
        set is-template enable
        set dev-type FortiWeb
        set category "FortiWeb"
        set title "Template - FortiWeb Default Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Top sources, sources of attacks, event categories, login events by user, top destinations, attack destinations and event types"
        set body "<fazchart mkey=\"fwb-attack-Top-Attack-Sources\" title=\"Top Sources of Attacks\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fwb-traffic-Top-Sources\" title=\"Top Sources\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fwb-event-Top-Event-Categories\" title=\"Top Event Categories\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fwb-event-Top-Login-By-User\" title=\"Top Login Events by User\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fwb-attack-Top-Attacked-Destinations\" title=\"Top Attack Destinations\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fwb-traffic-Top-Destinations\" title=\"Top Destinations\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fwb-event-Top-Event-Types\" title=\"Top Event Types\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90104
                next
                edit 90203
                next
            end
        set protected enable
    next


    edit 1000074002
        set is-template enable
        set dev-type FortiWeb
        set category "FortiWeb"
        set title "Template - FortiWeb Web Application Analysis Report"
        set description "It includes web application trends, behavior and consolidated views in a multi-FortiWeb environment."
        set body "<h1>1. Objectives</h1><p>The following reports provide&nbsp; insight into web application trends, behavior and consolidated view in a multi-FortiWeb environment.</p><h1>2.Reports</h1><fazchart mkey=\"fwb-bandwithd-over-time\" title=\"2.1.Bandwidth over Time\" width=\"100%\"></fazchart><p>Provides high level view web app usage with overall bandwidth overtime.</p><fazchart mkey=\"fwb-top-hosts-per-response\" title=\"2.2.Top Hosts per Response Bytes\" width=\"100%\"></fazchart><p>Detailed info regarding bandwidth use per host.</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><fazchart mkey=\"fwb-bandwidth-per-domain\" title=\"2.3.Bandwidth per Domain over Time\" width=\"100%\"></fazchart><p>Breakdown of bandwidth used for each website, helps with identification of utilization patterns during the day.</p><fazchart mkey=\"fwb-top-hosts-by-hits\" title=\"2.4.Top Hosts\" width=\"100%\"></fazchart><p>Top hosts per number of hits.</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><fazchart mkey=\"fwb-all-hosts-by-hits\" title=\"2.5.All Hosts\" width=\"100%\"></fazchart><p>Detailed info regarding requested hosts and as a percentage of overall hits.</p><fazchart mkey=\"fwb-top-hits-per-domain-over-time\" title=\"2.6.Top Hosts per Domain over Time\" width=\"100%\"></fazchart><p>This can help to identify which sites are more active for each period of the day, which can help in capacity planning and eventually creating a dynamic resource distribution in their server farm (moving resources from one website to another during specific dates/times). Just like other trend graphs this can help security admins identify deviations in a glimpse.</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><fazchart mkey=\"fwb-top-hits-per-src-per-domain\" title=\"2.7.Top Hits per Unique Src per Domain over Time\" width=\"100%\"></fazchart><p>This is an attempt to give the administrator a rough idea of &quot;unique visitors&quot;. Given this is based on source IP, depending on the architecture could be more valuable to some customers than others.</p><fazchart mkey=\"fwb-http-methods-over-time\" title=\"2.8.HTTP Methods over Time\" width=\"100%\"></fazchart><p>This chart gives insight into how&nbsp; HTTP methods are used overtime and can hint to orchestrated attacks when large amount of requests using methods not seen previously,&nbsp; suddenly occur which may need to be closely reviewed by the security team.</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><fazchart mkey=\"fwb-top-http-response-status-codes\" title=\"2.9.Top HTTP Response Status Codes\" width=\"100%\"></fazchart><p>This graph can help administrators to visualize errors in the application behavior (cyclical loops, excessive server-side errors or broken pages), and attempts to circumvent the access controls employed by the website (e.g. too many Unauthorized/Forbidden codes).</p><fazchart mkey=\"fwb-top-400-response-status-code-per-url\" title=\"2.10.Top 400 Response Status Codes per URL\" width=\"100%\"></fazchart><p>This table enable an administrator to identify failures in the website code (like broken references) and specific pages that are more problematic for developer&#39;s review.</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><fazchart mkey=\"fwb-top-500-response-status-codes-per-url\" title=\"2.11.Top 500 Response Status Codes per URL\" width=\"100%\"></fazchart><p>This table allow an administrator to identify errors in the server-side, too many 500 errors may indicate some problems in the web server or the application.</p><fazchart mkey=\"fwb-top-http-response-status-codes-per-domain\" title=\"2.12.Top HTTP Response Status Codes per Domain\" width=\"100%\"></fazchart><p>Similar to the &quot;HTTP Response Status Codes&quot; but with a breakdown per domain to ease the identification of abnormal behaviour in specific websites.</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><fazchart mkey=\"fwb-top-user-agent\" title=\"2.13.Top User Agent\" width=\"100%\"></fazchart><p>The information obtained by this chart can steer the development of the website towards compatibility with a specific user-base (e.g. lots of mobile users) and also help in the security-side by allowing administrators to enforce a more rigid SSL/TLS policy knowing that they&#39;ll not break compatibility to most of their visitors.</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90104
                next
                edit 90200
                next
            end
        set protected enable
    next
end

config sql-report layout-folder
    edit 99999
        set folder-name "Default Templates"
        set protected enable
    next
    edit 90104
        set folder-name "FortiWeb Reports Templates"
        set parent-id 99999
        set protected enable
    next

    edit 90200
        set folder-name "Application Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90203
        set folder-name "SOC Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90205
        set folder-name "Outbreak Alert Reports Templates"
        set parent-id 99999
        set protected enable
    next
end

config alert basic-handler
    edit 160000
        set name "Default-FWB-Threat-Detection-By-Hostname"
        set description "Default FortiWeb Handler to detect malicious and suspicious activities grouped by web server's host name"
        config rule
            edit 1
                set name "Malicious activity detected"
                set devtype FortiWeb
                set severity high
                set logtype "attack"
                set extrainfo "Malicious activity: ${main_type}, ${subtype}, ${msg}, Traffic path: from ${src} to ${dst} (${policy})"
                set extrainfo-type custom
                set subject "Malicious activity: $groupby2 detected"
                set groupby1 "http_host"
                set groupby2 "signature_subclass"
                set eventstatus "open"
                set tags "By_Endpoint,Intrusion,Signature"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "action"
                        set value "Alert_Deny"
                        set oper not-equal
                    next
                    edit 2
                        set key "action"
                        set value "Period_Block"
                        set oper not-equal
                    next
                end
            next
            edit 2
                set name "Malicious activity blocked"
                set devtype FortiWeb
                set severity medium
                set logtype "attack"
                set extrainfo "Malicious activity: ${main_type}, ${subtype}, ${msg}, Traffic path: from ${src} to ${dst} (${policy})"
                set extrainfo-type custom
                set subject "Malicious activity: $groupby2 blocked"
                set groupby1 "http_host"
                set groupby2 "signature_subclass"
                set eventstatus "mitigated"
                set tags "By_Endpoint,Intrusion,Signature"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "action"
                        set value "Alert_Deny"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "Period_Block"
                        set oper equal
                    next
                end
            next
            edit 3
                set name "Encrypted traffic bypassed FortiWeb scan"
                set devtype FortiWeb
                set severity low
                set logtype "traffic"
                set extrainfo "Destination: ${dst}, ${msg}"
                set extrainfo-type custom
                set subject "Encrypted traffic bypassed FortiWeb scan"
                set groupby1 "http_host"
                set eventstatus "open"
                set tags "By_Endpoint,Risky,Bypassed"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "msg"
                        set value "No server certificate for SSL connection"
                        set oper contain
                    next
                    edit 2
                        set key "msg"
                        set value "SSL certificate key mismatch"
                        set oper contain
                    next
                    edit 3
                        set key "msg"
                        set value "Ephemeral keys cannot be decrypted"
                        set oper contain
                    next
                    edit 4
                        set key "msg"
                        set value "Unsupported cipher for SSL connection"
                        set oper contain
                    next
                    edit 5
                        set key "msg"
                        set value "Unmonitored SSL connection"
                        set oper contain
                    next
                end
            next
            edit 4
                set name "HTTP response time above threshold"
                set devtype FortiWeb
                set severity low
                set logtype "traffic"
                set extrainfo "Destination: ${dst}, ${msg}"
                set extrainfo-type custom
                set subject "HTTP response time above threshold"
                set groupby1 "http_host"
                set tags "By_Endpoint,Risky,Response_Time"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "http_response_time"
                        set value "10000"
                        set oper great-or-equal
                    next
                end
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fwb"
    next
end


config sql-report dataset
end


config sql-report chart
end


config sql-report layout
end


config sql-report layout-folder
	edit 99999
		set folder-name "Default Templates"
		set protected enable
	next
end


config sql-report dataset
    edit "fct-Installed-Feature-Summary"
        set description "Installed Feature Summary"
        set dev-type FortiClient
        set log-type fct-event
        set query "select subtype, count(distinct fctuid) as totalnum from ###(select uid as fctuid, regexp_replace(os, '\\(build.*', '') as os_short, fctver, subtype, fgtserial, max(case when msg like 'Compliance rules%applied' then 1 else 0 end) as compliance_flag from $log where $filter and subtype != 'admin' group by uid, os_short, fctver, subtype, fgtserial)### t where subtype is not null group by subtype order by totalnum desc"
        set protected enable
    next
    edit "fct-Device-by-Operating-System"
        set description "Device by OS"
        set dev-type FortiClient
        set log-type fct-event
        set query "select os_short as os, count(distinct fctuid) as totalnum from ###(select uid as fctuid, regexp_replace(os, '\\(build.*', '') as os_short, fctver, subtype, fgtserial, max(case when msg like 'Compliance rules%applied' then 1 else 0 end) as compliance_flag from $log where $filter and subtype != 'admin' group by uid, os_short, fctver, subtype, fgtserial)### t where os_short is not null group by os order by totalnum desc"
        set protected enable
    next
    edit "fct-Installed-FortiClient-Version"
        set description "FortiClient Version"
        set dev-type FortiClient
        set log-type fct-event
        set query "select fctver as fctver_short, count(distinct fctuid) as totalnum from ###(select uid as fctuid, regexp_replace(os, '\\(build.*', '') as os_short, fctver, subtype, fgtserial, max(case when msg like 'Compliance rules%applied' then 1 else 0 end) as compliance_flag from $log where $filter and subtype != 'admin' group by uid, os_short, fctver, subtype, fgtserial)### t where fctver is not null group by fctver order by totalnum desc"
        set protected enable
    next
    edit "fct-Endpoint-Profile-Deployment"
        set description "Endpoint Profile Deployment"
        set dev-type FortiClient
        set log-type fct-event
        set query "select profile, count(distinct fctuid) as totalnum from ###(select uid as fctuid, coalesce(nullifna(usingpolicy), 'No Profile') as profile from $log where $filter group by uid, profile)### t group by profile order by totalnum desc"
        set protected enable
    next
    edit "fct-Client-Summary"
        set description "Client Summary"
        set dev-type FortiClient
        set log-type fct-event
        set query "select hostname, deviceip, os_short as os, profile, fctver, from_itime(max(itime)) as last_seen from ###(select hostname, deviceip, regexp_replace(os, '\\(build.*', '') as os_short, nullifna(usingpolicy) as profile, fctver, max(itime) as itime from $log where $filter and os is not null group by hostname, deviceip, os_short, profile, fctver order by itime desc)### t group by hostname, deviceip, os, profile, fctver order by last_seen desc"
        set protected enable
    next

    edit "fct-Total-Threats-Found"
        set description "Total Threats Found"
        set dev-type FortiClient
        set log-type fct-traffic
        set query "select utmevent_s as utmevent, count(distinct threat) as totalnum from ###(select coalesce(nullifna(lower(utmevent)), 'unknown') as utmevent_s, threat from $log where $filter and threat is not null and utmaction='blocked' group by utmevent_s, threat)### t group by utmevent order by totalnum desc"
        set protected enable
    next
    edit "fct-Top-AV-Threats-Detected"
        set description "Top AV Threats Detected"
        set dev-type FortiClient
        set log-type fct-traffic
        set query "select threat, sum(totalnum) as totalnum from ((select threat, sum(totalnum) as totalnum from ###(select threat, count(*) as totalnum from $log-fct-traffic where $filter and threat is not null and lower(utmevent)='antivirus' group by threat order by totalnum desc)### t group by threat) union all (select threat, sum(totalnum) as totalnum from ###(select virus as threat, count(*) as totalnum from $log-fct-event where $filter and virus is not null group by threat order by totalnum desc)### t group by threat)) t group by threat order by totalnum desc"
        set protected enable
    next
    edit "fct-Top-Infected-Devices-with-Botnet"
        set description "Top Infected Devices with Botnet"
        set dev-type FortiClient
        set log-type fct-traffic
        set query "select hostname, count(*) as totalnum from $log where $filter and hostname is not null and lower(utmevent) in ('webfilter', 'appfirewall') and lower(threat) like '%botnet%' group by hostname order by totalnum desc"
        set protected enable
    next
    edit "fct-Top-Infected-Devices-with-Virus-Malware"
        set description "Top Infected Devices with Virus Malware"
        set dev-type FortiClient
        set log-type fct-traffic
        set query "select hostname, sum(totalnum) as totalnum from ((select hostname, sum(totalnum) as totalnum from ###(select hostname, count(*) as totalnum from $log-fct-traffic where $filter and hostname is not null and lower(utmevent) in ('antivirus', 'antimalware') group by hostname order by totalnum desc)### t group by hostname) union all (select hostname, sum(totalnum) as totalnum from ###(select hostname, count(*) as totalnum from $log-fct-event where $filter and hostname is not null and virus is not null group by hostname order by totalnum desc)### t group by hostname)) t group by hostname order by totalnum desc"
        set protected enable
    next
    edit "fct-All-Antivirus-Antimalware-Detections"
        set description "All Antivirus and Antimalware Detections"
        set dev-type FortiClient
        set log-type fct-traffic
        set query "select threat, hostname, hostuser, utmaction, from_dtime(max(dtime)) as last_seen from ((select threat, hostname, hostuser, utmaction, max(dtime) as dtime from ###(select threat, hostname, coalesce(nullifna(`user`), 'Unknown') as hostuser, utmaction, max(dtime) as dtime from $log-fct-traffic where $filter and lower(utmevent) in ('antivirus', 'antimalware') group by threat, hostname, hostuser, utmaction order by threat)### t group by threat, hostname, hostuser, utmaction) union all (select threat, hostname, hostuser, utmaction, max(dtime) as dtime from ###(select virus as threat, hostname, coalesce(nullifna(`user`), 'Unknown') as hostuser, action as utmaction, max(dtime) as dtime from $log-fct-event where $filter and (logflag is null or logflag&8=0) and virus is not null group by threat, hostname, hostuser, utmaction order by threat)### t group by threat, hostname, hostuser, utmaction)) t group by threat, hostname, hostuser, utmaction order by threat"
        set protected enable
    next
    edit "fct-Web-Filter-Violations"
        set description "Web Filter Violations"
        set dev-type FortiClient
        set log-type fct-traffic
        set query "select hostuser, hostname, string_agg(distinct remotename, ',') as remotename, utmaction, sum(total) as totalnum, from_dtime(max(dtime)) as last_seen from ###(select remotename, hostname, coalesce(nullifna(`user`), 'Unknown') as hostuser, utmaction, count(*) as total, max(dtime) as dtime from $log where $filter and lower(utmevent)='webfilter' and utmaction='blocked' group by remotename, hostname, hostuser, utmaction order by total desc)### t group by hostuser, hostname, utmaction order by totalnum desc"
        set protected enable
    next
    edit "fct-Application-Firewall"
        set description "Application Firewall"
        set dev-type FortiClient
        set log-type fct-traffic
        set query "select threat, hostname, hostuser, utmaction, from_dtime(max(dtime)) as last_seen from ###(select threat, hostname, coalesce(nullifna(`user`), 'Unknown') as hostuser, utmaction, max(dtime) as dtime from $log where $filter and lower(utmevent)='appfirewall' and utmaction='blocked' group by threat, hostname, hostuser, utmaction order by dtime desc)### t1 left join app_mdata t2 on t1.threat=t2.name group by threat, risk, hostname, hostuser, utmaction order by risk desc"
        set protected enable
    next
    edit "fct-Errors-and-Alerts"
        set description "Errors and Alerts"
        set dev-type FortiClient
        set log-type fct-event
        set query "select msg, hostname, hostuser, from_dtime(max(dtime)) as last_seen from ###(select msg, hostname, coalesce(nullifna(`user`), 'Unknown') as hostuser, max(dtime) as dtime from $log where $filter and level in ('error', 'alert') group by msg, hostname, hostuser order by dtime desc)### t group by msg, hostname, hostuser order by last_seen desc"
      set protected enable
    next
    edit "fct-Threats-by-Top-Devices"
        set description "Threats by Top Devices"
        set dev-type FortiClient
        set log-type fct-traffic
        set query "select hostname, count(*) as totalnum from $log where $filter and hostname is not null and utmevent is not null and utmaction='blocked' group by hostname order by totalnum desc"
        set protected enable
    next
    edit "fct-vuln-Device-Vulnerabilities"
        set description "Vulnerabilities Detected by User/Device"
        set dev-type FortiClient
        set log-type fct-netscan
        set query "select vulnseverity, (CASE vulnseverity WHEN 'Critical' THEN 5 WHEN 'High' THEN 4 WHEN 'Medium' THEN 3 WHEN 'Info' THEN 2 WHEN 'Low' THEN 1 ELSE 0 END) as severity_number, count(distinct vulnname) as vuln_num from ###(select vulnseverity, devid, vulnname from $log where $filter and nullifna(vulnseverity) is not null and nullifna(vulnname) is not null group by vulnseverity, vulnname, devid)### t group by vulnseverity order by severity_number desc"
        set protected enable
    next
    edit "fct-vuln-Category-Type-Vulnerabilities"
        set description "Vulnerabilities Detected by Category Type"
        set dev-type FortiClient
        set log-type fct-netscan
        set query "select vulncat, count(distinct vulnname) as totalnum from ###(select vulncat, vulnname from $log where $filter and nullifna(vulncat) is not null and nullifna(vulnname) is not null group by vulncat, vulnname)### t group by vulncat order by totalnum desc"
        set protected enable
    next
    edit "fct-vuln-Vulnerabilities-by-OS"
        set description "Forticlient Vulnerabilities by OS"
        set dev-type FortiClient
        set log-type fct-netscan
        set query "select os, count(distinct vulnname) as totalnum from ###(select os, vulnname from $log where $filter and nullifna(os) is not null and nullifna(vulnname) is not null group by os, vulnname)### t group by os order by totalnum desc"
        set protected enable
    next
    edit "fct-vuln-Devices-by-Vulnerability-Risk-Level"
        set description "Number Vulnerability by Device and Risk Level"
        set dev-type FortiClient
        set log-type fct-netscan
        set query "select vulnseverity, (case when vulnseverity='Critical' then 5 when vulnseverity='High' then 4 when vulnseverity='Medium' then 3 when vulnseverity='Low' then 2 when vulnseverity='Info' then 1 else 0 end) as severity_number, count(distinct vulnname) as vuln_num, count(distinct devid) as dev_num from ###(select vulnseverity, devid, vulnname from $log where $filter and nullifna(vulnseverity) is not null and nullifna(vulnname) is not null and nullifna(devid) is not null group by vulnseverity, vulnname, devid)### t group by vulnseverity order by dev_num desc, severity_number desc"
        set protected enable
    next
    edit "fct-vuln-Vulnerability-Trend"
        set description "Vulnerability Trend"
        set dev-type FortiClient
        set log-type fct-netscan
        set query "select $flex_timescale(timestamp) as hodex, count(distinct vulnname) as total_num from ###(select $flex_timestamp as timestamp, vulnname from $log where $filter and nullifna(vulnname) is not null group by timestamp, vulnname order by timestamp desc)### t group by hodex order by hodex"
        set protected enable
    next
    edit "fct-vuln-Details-by-Risk-Level-Device"
        set description "Vulnerability Details for Each Risk Level by Device"
        set dev-type FortiClient
        set log-type fct-netscan
        set query "select hostname, os, vulnseverity, count(distinct vulnname) as vuln_num, count(distinct products) as products, count(distinct cve_id) as cve_count from ###(select hostname, os, vulnname, vulnseverity, vulnid from $log where $filter and vulnname is not null and vulnseverity is not null and hostname is not null group by hostname, os, vulnname, vulnseverity, vulnid)### t1 left join fct_mdata t2 on t1.vulnid=t2.vid::int group by hostname, os, vulnseverity order by vuln_num desc, hostname"
        set protected enable
    next
    edit "fct-vuln-Details-by-Device-User"
        set description "Vulnerability Details by Device User"
        set dev-type FortiClient
        set log-type fct-netscan
        set query "select hostname, ('<div>' || vulnname || '</div>') as vulnname, vulnseverity, vulncat, string_agg(distinct products, ',') as products, string_agg(distinct cve_id, ',') as cve_list, ('<a href=' || String_agg(DISTINCT vendor_link, ',') || '>Remediation Info</a>') as vendor_link from ###(select hostname, vulnname, vulnseverity, vulncat, vulnid from $log where $filter and vulnname is not null and hostname is not null group by hostname, vulnname, vulnseverity, vulncat, vulnid)### t1 inner join fct_mdata t2 on t1.vulnid=t2.vid::int group by hostname, vulnname, vulnseverity, vulncat order by hostname"
        set protected enable
    next
    edit "fct-vuln-Remediation-by-Device"
        set description "Remediate The Vulnerability Found on Device"
        set dev-type FortiClient
        set log-type fct-netscan
        set query "select hostname, ('<div>' || vulnname || '</div>') as vulnname, vulnseverity, string_agg(distinct vendor_link, ',') as vendor_link from ###(select hostname, vulnname, vulnseverity, vulnid from $log where $filter and vulnname is not null and hostname is not null group by hostname, vulnname, vulnseverity, vulnid)### t1 inner join fct_mdata t2 on t1.vulnid=t2.vid::int group by hostname, vulnname, vulnseverity order by vulnseverity, hostname"
        set protected enable
    next
    edit "fct-vuln-Remediation-by-Vulnerability"
        set description "Remediation by Vulnerability"
        set dev-type FortiClient
        set log-type fct-netscan
        set query "select ('<b>' || vulnname || '</b><br/><br/>' || 'Description<br/><div style=word-break:normal>' || description || '</div><br/><br/>' || 'Affected Products<br/>' || products || '<br/><br/>' || 'Impact<br/>' || impact || '<br/><br/>' || 'Recommended Actions<br/>' || vendor_link || '<br/><br/><br/>') as remediation from ###(select devid, vulnname, vulnseverity, (case vulnseverity when 'low' then 1 when 'info' then 2 when 'medium' then 3 when 'high' then 4 when 'critical' then 5 else 0 end) as severity_level, vulnid from $log where $filter and vulnname is not null group by devid, vulnname, vulnseverity, severity_level, vulnid order by severity_level)### t1 inner join fct_mdata t2 on t1.vulnid=t2.vid::int group by remediation order by remediation"
        set protected enable
    next
    edit "fct-vuln-Top-30-Targeted-High-Risk-Vulnerabilities"
        set description "Top 30 Targeted High Risk Vulnerabilities"
        set dev-type FortiClient
        set log-type fct-netscan
        set query "select t3.cve_id, score, string_agg(distinct products, ',') as products, ('<a href=' || String_agg(vendor_link, ',') || '>Mitigation Infomation</a>') as vendor_link from ###(select vulnid from $log where $filter group by vulnid)### t1 inner join fct_mdata t2 on t2.vid=t1.vulnid::text inner join fct_cve_score t3 on strpos(t2.cve_id, t3.cve_id) > 0 group by t3.cve_id, score order by score desc, t3.cve_id"
        set protected enable
    next

    edit "fct-Endpoints-by-FortiGate"
        set description "Endpoints by FortiGate"
        set dev-type FortiClient
        set log-type fct-event
        set query "select fgtserial, count(distinct fctuid) as totalnum from ###(select uid as fctuid, regexp_replace(os, '\\(build.*', '') as os_short, fctver, subtype, fgtserial, max(case when msg like 'Compliance rules%applied' then 1 else 0 end) as compliance_flag from $log where $filter and subtype != 'admin' group by uid, os_short, fctver, subtype, fgtserial)### t where fgtserial is not null group by fgtserial order by totalnum desc"
        set protected enable
    next
    edit "fct-Top-Malware-Detections"
        set description "Top Infected Devices with Malware"
        set dev-type FortiClient
        set log-type fct-traffic
        set query "select hostname, fctuid, sum(totalnum) as totalnum from ((select hostname, fctuid, sum(totalnum) as totalnum from ###(select threat, hostname, coalesce(nullifna(`user`), 'Unknown') as hostuser, utmaction, max(dtime) as dtime, uid as fctuid, count(*) as totalnum from $log-fct-traffic where $filter and lower(utmevent) in ('antivirus', 'antimalware') group by threat, hostname, hostuser, utmaction, uid order by threat)### t group by hostname, fctuid) union all (select hostname, fctuid, sum(totalnum) as totalnum from ###(select virus as threat, hostname, coalesce(nullifna(`user`), 'Unknown') as hostuser, action as utmaction, max(dtime) as dtime, uid as fctuid, count(*) as totalnum from $log-fct-event where $filter and (logflag is null or logflag&8=0) and virus is not null group by threat, hostname, hostuser, utmaction, uid order by threat)### t group by hostname, fctuid)) t group by hostname, fctuid order by totalnum desc"
        set protected enable
    next
    edit "fct-Top10-Malware-Detections"
        set description "Top 10 Infected Devices with Malware"
        set dev-type FortiClient
        set log-type fct-traffic
        set query "select threat, hostname, hostuser, utmaction, fctuid, sum(totalnum) as totalnum from ((select threat, hostname, hostuser, utmaction, fctuid, sum(totalnum) as totalnum from ###(select threat, hostname, coalesce(nullifna(`user`), 'Unknown') as hostuser, utmaction, max(dtime) as dtime, uid as fctuid, count(*) as totalnum from $log-fct-traffic where $filter and lower(utmevent) in ('antivirus', 'antimalware') group by threat, hostname, hostuser, utmaction, uid order by threat)### t group by threat, hostname, hostuser, utmaction, fctuid) union all (select threat, hostname, hostuser, utmaction, fctuid, sum(totalnum) as totalnum from ###(select virus as threat, hostname, coalesce(nullifna(`user`), 'Unknown') as hostuser, action as utmaction, max(dtime) as dtime, uid as fctuid, count(*) as totalnum from $log-fct-event where $filter and (logflag is null or logflag&8=0) and virus is not null group by threat, hostname, hostuser, utmaction, uid order by threat)### t group by threat, hostname, hostuser, utmaction, fctuid)) t where utmaction != 'pass' group by threat, hostname, hostuser, utmaction, fctuid order by totalnum desc"
        set protected enable
    next
    edit "fct-Devices-with-Botnet"
        set description "Infected Devices with Botnet"
        set dev-type FortiClient
        set log-type fct-traffic
        set query "select threat, hostname, coalesce(nullifna(`user`), 'Unknown') as hostuser, utmaction, uid as fctuid, count(*) as totalnum from $log where $filter and hostname is not null and lower(utmevent) in ('webfilter', 'appfirewall') and lower(threat) like '%botnet%' group by threat, hostname, hostuser, utmaction, fctuid order by totalnum desc"
        set protected enable
    next

    edit "fct-Compliance-by-FortiGate"
        set description "FortiClinet Compliance by FortiGate Enforcing"
        set dev-type FortiClient
        set log-type fct-event
        set query "select fgtserial, count(distinct fctuid) as totalnum from (select fgtserial, fctuid, max(compliance_flag) as compliance_flag from ###(select uid as fctuid, regexp_replace(os, '\\(build.*', '') as os_short, fctver, subtype, fgtserial, max(case when msg like 'Compliance rules%applied' then 1 else 0 end) as compliance_flag from $log where $filter and subtype != 'admin' group by uid, os_short, fctver, subtype, fgtserial)### tt group by fgtserial, fctuid) t where compliance_flag = 1 group by fgtserial order by totalnum desc"
        set protected enable
    next
    edit "fct-Compliance-Status"
        set description "Number of FortiClinets by Compliance Status"
        set dev-type FortiClient
        set log-type fct-event
        set query "select (case compliance_flag when 1 then 'Compliant' else 'Non-Compliant' end) as compliance, count(distinct fctuid) as totalnum from (select fctuid, max(compliance_flag) as compliance_flag from ###(select uid as fctuid, regexp_replace(os, '\\(build.*', '') as os_short, fctver, subtype, fgtserial, max(case when msg like 'Compliance rules%applied' then 1 else 0 end) as compliance_flag from $log where $filter and subtype != 'admin' group by uid, os_short, fctver, subtype, fgtserial)### tt group by fctuid) t group by compliance order by totalnum desc"
        set protected enable
    next
    edit "fct-Non-Compliant-Endpoints"
        set description "Non-compliant Endpoints"
        set dev-type FortiClient
        set log-type fct-event
        set query "select t1.fgtserial, t3.srcintf, t2.epname as hostname, t2.mac, 'Non-Compliant' as status from (select fgtserial, fctuid, max(compliance_flag) as compliance_flag from ###(select uid as fctuid, regexp_replace(os, '\\(build.*', '') as os_short, fctver, subtype, fgtserial, max(case when msg like 'Compliance rules%applied' then 1 else 0 end) as compliance_flag from $log where $filter and subtype != 'admin' group by uid, os_short, fctver, subtype, fgtserial)### tt group by fgtserial, fctuid) t1 left join $ADOM_ENDPOINT t2 on t1.fctuid = t2.fctuid left join $ADOM_EPEU_DEVMAP t3 on t2.epid = t3.epid where compliance_flag = 0 group by t1.fctuid, t1.fgtserial, t3.srcintf, t2.epname, t2.mac"
        set protected enable
    next

    edit "fct-Traffic-Web-Hits"
        set description "Web Traffic Trend"
        set dev-type FortiClient
        set log-type fct-traffic
        set query "select $flex_timescale(timestamp) as hodex, sum(requests) as requests from ###(select $flex_timestamp as timestamp, count(*) as requests from $log where $filter and lower(utmevent)='webfilter' group by timestamp order by timestamp desc)### t group by hodex order by hodex"
        set protected enable
    next
    edit "fct-Traffic-Top-Allowed-Web-Cat"
        set description "Top Visited Web Categories"
        set dev-type FortiClient
        set log-type fct-traffic
        set query "select category, sum(requests) as requests from ###(select fct_webcat(threat) as category, remotename as website, count(*) as requests from $log where $filter and direction='outbound' and threat is not null and utmaction='passthrough' and lower(utmevent)='webfilter' group by category, website order by requests desc)### t group by category order by requests desc"
        set protected enable
    next
    edit "fct-Traffic-Top-Allowed-Website"
        set description "Top Visited Websites"
        set dev-type FortiClient
        set log-type fct-traffic
        set query "select website, string_agg(distinct category, ', ') as agg_category, sum(requests) as requests from ###(select fct_webcat(threat) as category, remotename as website, count(*) as requests from $log where $filter and direction='outbound' and threat is not null and utmaction='passthrough' and lower(utmevent)='webfilter' group by category, website order by requests desc)### t where website is not null group by website order by requests desc"
        set protected enable
    next
    edit "fct-Traffic-Top-Category-By-Website-Session"
        set description "Top Web Categories by Website Session"
        set dev-type FortiClient
        set log-type fct-traffic
        set query "select fct_webcat(threat) as category, remotename as website, count(*) as requests from $log where $filter and nullifna(threat) is not null and lower(utmevent)='webfilter' group by category, website order by requests desc"
        set protected enable
    next
    edit "fct-Traffic-Top-Web-Users-By-Website"
        set description "Top Web Users by Website"
        set dev-type FortiClient
        set log-type fct-traffic
        set query "select coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, remotename as website, count(*) as requests from $log where $filter and direction='outbound' and remotename is not null and utmaction='passthrough' and lower(utmevent)='webfilter' group by user_src, website order by requests desc"
        set protected enable
    next
        
end


config sql-report chart
    edit "fct-Installed-Feature-Summary"
        set disp-name "FortiClient-Installed Feature Summary"
        set category "Event"
        set dev-type FortiClient
        set description "Installed Feature Summary"
        set dataset "fct-Installed-Feature-Summary"
        set chart-type table
        config table-columns
            edit 1
                set header "Feature"
                set data-type raw
                set data-binding "subtype"
                set data-top 30
                set column-width 40
            next
            edit 2
                set header "Total"
                set data-type raw
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set header " "
                set data-type raw
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fct-Device-by-Operating-System"
        set disp-name "FortiClient-Device by OS"
        set category "Event"
        set dev-type FortiClient
        set description "Device by Operating System"
        set dataset "fct-Device-by-Operating-System"
        set chart-type donut
        config table-columns
            edit 1
                set header ""
                set data-binding "os"
                set data-top 10
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fct-Installed-FortiClient-Version"
        set disp-name "FortiClient-FortiClient Version: Installed"
        set category "Event"
        set dev-type FortiClient
        set description "Installed FortiClient Version"
        set dataset "fct-Installed-FortiClient-Version"
        set chart-type donut
        config table-columns
            edit 1
                set header ""
                set data-binding "fctver_short"
                set data-top 10
            next
            edit 2
                set header "Total Number"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fct-Endpoint-Profile-Deployment"
        set disp-name "FortiClient-Endpoint Profile Deployment"
        set category "Event"
        set dev-type FortiClient
        set description "Endpoint Profile Deployment"
        set dataset "fct-Endpoint-Profile-Deployment"
        set chart-type donut
        config table-columns
            edit 1
                set header ""
                set data-binding "profile"
                set data-top 10
            next
            edit 2
                set header "Total Number"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fct-Client-Summary"
        set disp-name "FortiClient-Client Summary"
        set category "Event"
        set dev-type FortiClient
        set description "Client Summary"
        set dataset "fct-Client-Summary"
        set chart-type table
        config table-columns
            edit 1
                set header "Name"
                set data-binding "hostname"
                set data-top 30
                set column-width 15
            next
            edit 2
                set header "Source IP"
                set data-binding "deviceip"
                set column-width 15
            next
            edit 3
                set header "OS"
                set data-binding "os"
                set column-width 30
            next
            edit 4
                set header "Policy Name"
                set data-binding "profile"
                set column-width 10
            next
            edit 5
                set header "FCT Version"
                set data-binding "fctver"
                set column-width 15
            next
            edit 6
                set header "Last Seen"
                set data-binding "last_seen"
                set column-width 10
            next
        end
        set protected enable
    next

    edit "fct-Total-Threats-Found"
        set disp-name "FortiClient-Total Threats Found"
        set category "Threat"
        set dev-type FortiClient
        set description "Total Threats Found"
        set dataset "fct-Total-Threats-Found"
        set chart-type table
        config table-columns
            edit 1
                set header "Name"
                set data-binding "utmevent"
                set data-top 0
                set column-width 30
            next
            edit 2
                set header "Number of Threats"
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 50
            next
            edit 3
                set header " "
                set data-binding "totalnum"
                set column-attr count
            next
            edit 4
                set header "Percentage of Total"
                set data-binding "totalnum"
                set column-attr cal-percent
                set column-width 20
            next
        end
        set protected enable
    next
    edit "fct-Top10-AV-Threats-Detected"
        set disp-name "FortiClient-Top 10 AV Threats Detected"
        set category "Threat"
        set dev-type FortiClient
        set description "Top 10 AV Threats Detected"
        set dataset "fct-Top-AV-Threats-Detected"
        set chart-type table
        config table-columns
            edit 1
                set header "Name"
                set data-type raw
                set data-binding "threat"
                set data-top 10
                set column-width 30
            next
            edit 2
                set header "Number of Detections"
                set data-type raw
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 50
            next
            edit 3
                set header " "
                set data-type raw
                set data-binding "totalnum"
                set column-attr count
            next
            edit 4
                set header "Percentage of Total"
                set data-type raw
                set data-binding "totalnum"
                set column-attr cal-percent
                set column-width 20
            next
        end
        set protected enable
    next
    edit "fct-Top10-Infected-Devices-with-Botnet"
        set disp-name "FortiClient-Top 10 Infected Devices with Botnet"
        set category "Threat"
        set dev-type FortiClient
        set description "Top 10 Infected Devices with Botnet"
        set dataset "fct-Top-Infected-Devices-with-Botnet"
        set chart-type table
        config table-columns
            edit 1
                set header "Name"
                set data-type raw
                set data-binding "hostname"
                set data-top 10
                set column-width 30
            next
            edit 2
                set header "Number of Detections"
                set data-type raw
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 50
            next
            edit 3
                set header " "
                set data-type raw
                set data-binding "totalnum"
                set column-attr count
            next
            edit 4
                set header "Percentage of Total"
                set data-type raw
                set data-binding "totalnum"
                set column-attr cal-percent
                set column-width 20
            next
        end
        set protected enable
    next
    edit "fct-Top10-Infected-Devices-with-Virus-Malware"
        set disp-name "FortiClient-Top 10 Infected Devices with Virus or Malware"
        set category "Threat"
        set dev-type FortiClient
        set description "Top 10 Infected Devices with Virus or Malware"
        set dataset "fct-Top-Infected-Devices-with-Virus-Malware"
        set chart-type table
        config table-columns
            edit 1
                set header "Name"
                set data-type raw
                set data-binding "hostname"
                set data-top 10
                set column-width 30
            next
            edit 2
                set header "Number of Detections"
                set data-type raw
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 50
            next
            edit 3
                set header " "
                set data-type raw
                set data-binding "totalnum"
                set column-attr count
            next
            edit 4
                set header "Percentage of Total"
                set data-type raw
                set data-binding "totalnum"
                set column-attr cal-percent
                set column-width 20
            next
        end
        set protected enable
    next
    edit "fct-All-Antivirus-Antimalware-Detections"
        set disp-name "FortiClient-All Antivirus and Antimalware Detections"
        set category "Threat"
        set dev-type FortiClient
        set description "All Antivirus and Antimalware Detections"
        set dataset "fct-All-Antivirus-Antimalware-Detections"
        set chart-type table
        config table-columns
            edit 1
                set header "Threat Name"
                set data-type raw
                set data-binding "threat"
                set data-top 0
                set column-width 30
            next
            edit 2
                set header "Device"
                set data-type raw
                set data-binding "hostname"
                set column-width 20
            next
            edit 3
                set header "User"
                set data-type raw
                set data-binding "hostuser"
                set column-width 25
            next
            edit 4
                set header "Action"
                set data-type raw
                set data-binding "utmaction"
                set column-width 15
            next
            edit 5
                set header "Last Seen"
                set data-binding "last_seen"
                set column-width 10
            next
        end
        set protected enable
    next
    edit "fct-Web-Filter-Violations"
        set disp-name "FortiClient-Web Filter Violations"
        set category "Threat"
        set dev-type FortiClient
        set description "Web Filter Violations"
        set dataset "fct-Web-Filter-Violations"
        set chart-type table
        config table-columns
            edit 1
                set header "User"
                set data-type raw
                set data-binding "hostuser"
                set data-top 30
                set column-width 10
            next
            edit 2
                set header "Site"
                set data-type raw
                set data-binding "remotename"
                set column-width 40
                set column-attr obf-url
            next
            edit 3
                set header "Action"
                set data-type raw
                set data-binding "utmaction"
                set column-width 10
            next
            edit 4
                set header "Count"
                set data-type raw
                set data-binding "totalnum"
                set column-attr count
                set column-width 10
            next
            edit 5
                set header "Device"
                set data-type raw
                set data-binding "hostname"
                set column-width 10
            next
            edit 6
                set header "Last Seen"
                set data-binding "last_seen"
                set column-width 10
            next
        end
        set protected enable
    next
    edit "fct-Application-Firewall"
        set disp-name "FortiClient-Application Firewall"
        set category "Threat"
        set dev-type FortiClient
        set description "Application Firewall"
        set dataset "fct-Application-Firewall"
        set chart-type table
        config table-columns
            edit 1
                set header "Application"
                set data-type raw
                set data-binding "threat"
                set data-top 30
                set column-width 30
            next
            edit 2
                set header "Device"
                set data-type raw
                set data-binding "hostname"
                set column-width 20
            next
            edit 3
                set header "User"
                set data-type raw
                set data-binding "hostuser"
                set column-width 20
            next
            edit 4
                set header "Action"
                set data-type raw
                set data-binding "utmaction"
                set column-width 20
            next
            edit 5
                set header "Last Seen"
                set data-binding "last_seen"
                set column-width 10
            next
        end
        set protected enable
    next
    edit "fct-Errors-and-Alerts"
        set disp-name "FortiClient-Errors and Alerts"
        set category "Event"
        set dev-type FortiClient
        set description "Errors and Alerts"
        set dataset "fct-Errors-and-Alerts"
        set chart-type table
        config table-columns
            edit 1
                set header "Description"
                set data-type raw
                set data-binding "msg"
                set data-top 30
                set column-width 30
            next
            edit 2
                set header "Device"
                set data-type raw
                set data-binding "hostname"
                set column-width 30
            next
            edit 3
                set header "User"
                set data-type raw
                set data-binding "hostuser"
                set column-width 30
            next
            edit 4
                set header "Last Seen"
                set data-binding "last_seen"
                set column-width 10
            next
        end
        set protected enable
    next
    edit "fct-Threats-by-Top-Devices"
        set disp-name "FortiClient-Threats by Top Devices"
        set category "Threat"
        set dev-type FortiClient
        set description "Threats by Top Devices"
        set dataset "fct-Threats-by-Top-Devices"
        set chart-type table
        config table-columns
            edit 1
                set header "Device Name"
                set data-type raw
                set data-binding "hostname"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Number of Detections"
                set data-type raw
                set data-binding "totalnum"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set header " "
                set data-type raw
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fct-vuln-Device-Vulnerabilities"
        set disp-name "FortiClient-Vulnerabilities Detected by Device"
        set category "Vulnerability"
        set dev-type FortiClient
        set description "Vulnerabilities Detected by User/Device"
        set dataset "fct-vuln-Device-Vulnerabilities"
        set chart-type donut
        config table-columns
            edit 1
                set header ""
                set data-binding "vulnseverity"
                set data-top 10
            next
            edit 2
                set header "Total Number"
                set data-type aggregate
                set data-binding "vuln_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fct-vuln-Category-Type-Vulnerabilities"
        set disp-name "FortiClient-Vulnerabilities Detected by Category Type"
        set category "Vulnerability"
        set dev-type FortiClient
        set description "Vulnerabilities Detected by Category Type"
        set dataset "fct-vuln-Category-Type-Vulnerabilities"
        set chart-type donut
        config table-columns
            edit 1
                set header ""
                set data-binding "vulncat"
                set data-top 10
            next
            edit 2
                set header "Total Number"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fct-vuln-Vulnerabilities-by-OS"
        set disp-name "FortiClient-The OS Vulnerabilities Detected"
        set category "Vulnerability"
        set dev-type FortiClient
        set description "The OS Vulnerabilities Detected"
        set dataset "fct-vuln-Vulnerabilities-by-OS"
        set chart-type donut
        config table-columns
            edit 1
                set data-binding "os"
                set data-top 10
            next
            edit 2
                set header "Total Number"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fct-vuln-Vulnerabilities-by-Risk-Level"
        set disp-name "FortiClient-Number of Vulnerabilities by Risk Level"
        set category "Vulnerability"
        set dev-type FortiClient
        set description "Number of Vulnerabilities by Risk Level"
        set dataset "fct-vuln-Devices-by-Vulnerability-Risk-Level"
        set chart-type bar
        config table-columns
            edit 1
                set header "Severity"
                set data-binding "vulnseverity"
                set data-top 20
            next
            edit 2
                set header "Vulnerability"
                set data-type aggregate
                set data-binding "vuln_num"
            next
        end
        set protected enable
    next
    edit "fct-vuln-Device-by-Risk-Level"
        set disp-name "FortiClient-Number of Vulnerabilities by Device and Risk Level"
        set category "Vulnerability"
        set dev-type FortiClient
        set description "Number of Vulnerabilities by Device and Risk Level"
        set dataset "fct-vuln-Devices-by-Vulnerability-Risk-Level"
        set chart-type table
        config table-columns
            edit 1
                set header "Number of Device"
                set data-binding "dev_num"
                set column-attr count
                set data-top 5
            next
            edit 2
                set header "Risk Level"
                set data-binding "vulnseverity"
                set column-attr severity
                set column-span 2
            next
            edit 3
                set data-binding "vulnseverity"
            next
            edit 4
                set header "Vulnerabilities"
                set data-binding "vuln_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fct-vuln-Vulnerability-Trend"
        set disp-name "FortiClient-The Vulnerabilities Trend"
        set category "Vulnerability"
        set dev-type FortiClient
        set description "The Vulnerabilities Trend"
        set dataset "fct-vuln-Vulnerability-Trend"
        set chart-type line
        config table-columns
            edit 1
                set header "Date"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "total_num"
                set column-graph-type line-up
                set column-attr count
                set legend "vulnerability"
            next
        end
        set protected enable
    next
    edit "fct-vuln-Details-by-Risk-Level-Device"
        set disp-name "FortiClient-Vulnerability Details for Each Risk Level by Device"
        set category "Vulnerability"
        set dev-type FortiClient
        set description "Vulnerability Details for Each Risk Level by Device"
        set dataset "fct-vuln-Details-by-Risk-Level-Device"
        set chart-type table
        config table-columns
            edit 1
                set header "Host Name"
                set data-type raw
                set data-binding "hostname"
                set data-top 10
                set column-width 17
            next
            edit 2
                set header "Severity Level"
                set data-binding "vulnseverity"
                set column-attr severity
                set column-span 2
                set column-width 10
            next
            edit 3
                set data-binding "vulnseverity"
                set column-attr default
            next
            edit 4
                set header "Vulnerabilities"
                set data-binding "vuln_num"
                set column-attr count
            next
            edit 5
                set header "OS Version"
                set data-binding "os"
                set column-width 30
            next
            edit 6
                set header "Applications"
                set data-binding "products"
                set column-attr count
            next
            edit 7
                set header "CVE# Count"
                set data-binding "cve_count"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fct-vuln-Details-by-Device-User"
        set disp-name "FortiClient-Vulnerability Details by Device User"
        set category "Vulnerability"
        set dev-type FortiClient
        set description "Vulnerability Details by Device User"
        set dataset "fct-vuln-Details-by-Device-User"
        set chart-type table
        config table-columns
            edit 1
                set header "Host Name"
                set data-type raw
                set data-binding "hostname"
                set data-top 25
                set column-width 17
            next
            edit 2
                set header "Vulnerability Name"
                set data-binding "vulnname"
                set column-width 20
                set column-attr html
            next
            edit 3
                set header "Severity"
                set data-binding "vulnseverity"
                set column-attr severity
                set column-span 2
                set column-width 10
            next
            edit 4
                set data-binding "vulnseverity"
            next
            edit 5
                set header "Category"
                set data-binding "vulncat"
            next
            edit 6
                set header "Application/Product"
                set data-binding "products"
            next
            edit 7
                set header "CVE"
                set data-binding "cve_list"
                set column-width 14
            next
            edit 8
                set header "Remediation Actions"
                set data-binding "vendor_link"
                set column-attr html
            next
        end
        set protected enable
    next
    edit "fct-vuln-Remediation-by-Device"
        set disp-name "FortiClient-Remediate The Vulnerability Found on Device"
        set category "Vulnerability"
        set dev-type FortiClient
        set description "Remediate The Vulnerability Found on Device"
        set dataset "fct-vuln-Remediation-by-Device"
        set chart-type table
        config table-columns
            edit 1
                set header "Host Name"
                set data-type raw
                set data-binding "hostname"
                set data-top 10
                set column-width 17
            next
            edit 2
                set header "Vulnerability"
                set data-binding "vulnname"
                set column-attr html
            next
            edit 3
                set header "Risk"
                set data-binding "vulnseverity"
                set column-attr severity
                set column-span 2
                set column-width 10
            next
            edit 4
                set data-binding "vulnseverity"
            next
            edit 5
                set header "Actions Required"
                set data-binding "vendor_link"
                set column-attr url
                set column-span 2
                set column-width 50
            next
            edit 6
                set data-binding "vendor_link"
                set column-attr html
            next
        end
        set protected enable
    next
    edit "fct-vuln-Remediation-by-Vulnerability"
        set disp-name "FortiClient-Remediation by Vulnerability"
        set category "Vulnerability"
        set dev-type FortiClient
        set description "Remediation by Vulnerability"
        set dataset "fct-vuln-Remediation-by-Vulnerability"
        set chart-type table
        config table-columns
            edit 1
                set data-type raw
                set data-binding "remediation"
                set data-top 10
                set column-attr html
            next
        end
        set protected enable
    next
    edit "fct-vuln-Top-30-Targeted-High-Risk-Vulnerabilities"
        set disp-name "FortiClient-Top 30 Targeted High Risk Vulnerabilities"
        set category "Vulnerability"
        set dev-type FortiClient
        set description "Top 30 Targeted High Risk Vulnerabilities"
        set dataset "fct-vuln-Top-30-Targeted-High-Risk-Vulnerabilities"
        set chart-type table
        config table-columns
            edit 1
                set header "CVE"
                set data-type raw
                set data-binding "cve_id"
                set data-top 30
                set column-width 20
            next
            edit 2
                set header "Affected Products/Version"
                set data-binding "products"
                set column-width 60
            next
            edit 3
                set header "Patching Information"
                set data-binding "vendor_link"
                set column-attr url
                set column-width 20
            next
        end
        set protected enable
    next

    edit "fct-Endpoints-by-FortiGate"
        set disp-name "FortiClient-Endpoints by FortiGate"
        set category "Event"
        set dev-type FortiClient
        set description "Endpoints by FortiGate"
        set dataset "fct-Endpoints-by-FortiGate"
        set chart-type donut
        config table-columns
            edit 1
                set header ""
                set data-binding "fgtserial"
                set data-top 10
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fct-Top-Malware-Detections"
        set disp-name "FortiClient-Top Anti-Malware Detections"
        set category "Threat"
        set dev-type FortiClient
        set description "Top Anti-Malware Detections"
        set dataset "fct-Top-Malware-Detections"
        set chart-type donut
        config table-columns
            edit 1
                set data-binding "hostname"
                set data-top 10
            next
            edit 2
                set header "Total Number"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fct-Top10-Malware-Detections"
        set disp-name "FortiClient-Top 10 Anti-Malware Detections"
        set category "Threat"
        set dev-type FortiClient
        set description "Top 10 Anti-Malware Detections"
        set dataset "fct-Top10-Malware-Detections"
        set chart-type table
        config table-columns
            edit 1
                set header "Threat name"
                set data-binding "threat"
                set data-top 10
            next
            edit 2
                set header "Device"
                set data-binding "hostname"
            next
            edit 3
                set header "User"
                set data-binding "hostuser"
            next
            edit 4
                set header "Action"
                set data-binding "utmaction"
            next
        end
        set protected enable
    next
    edit "fct-Devices-with-Botnet"
        set disp-name "FortiClient-Devices with Botnet Detections"
        set category "Threat"
        set dev-type FortiClient
        set description "Devices with Botnet Detections"
        set dataset "fct-Devices-with-Botnet"
        set chart-type table
        config table-columns
            edit 1
                set header "Threat name"
                set data-binding "threat"
                set data-top 10
            next
            edit 2
                set header "Device"
                set data-binding "hostname"
            next
            edit 3
                set header "User"
                set data-binding "hostuser"
            next
            edit 4
                set header "Action"
                set data-binding "utmaction"
            next
        end
        set protected enable
    next
    edit "fct-vuln-Vulnerability-by-Hostname"
        set disp-name "FortiClient-Vulnerability by Hostname"
        set category "Vulnerability"
        set dev-type FortiClient
        set description "Vulnerability Details for Each Risk Level by Device"
        set dataset "fct-vuln-Details-by-Risk-Level-Device"
        set chart-type bar
        config table-columns
            edit 1
                set header "Host Name"
                set data-type raw
                set data-binding "hostname"
                set data-top 10
            next
            edit 2
                set header "Severity Level"
                set data-type drilldown
                set data-binding "vulnseverity"
                set column-attr severity
            next
            edit 3
                set header "Vulnerabilities"
                set data-type aggregate
                set data-binding "vuln_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fct-Users-With-Web-Violations"
        set disp-name "FortiClient-Top 20 Users with Web Violations"
        set category "Threat"
        set dev-type FortiClient
        set description "Top 20 Users with Web Violations"
        set dataset "fct-Web-Filter-Violations"
        set chart-type bar
        config table-columns
            edit 1
                set header "User"
                set data-binding "hostuser"
                set data-top 20
            next
            edit 2
                set header "Count"
                set data-type aggregate
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fct-Compliance-by-FortiGate"
        set disp-name "FortiClient-FortiGates Enforcing Compliance"
        set category "Event"
        set dev-type FortiClient
        set description "FortiGate Devices with Compliance Enforcement"
        set dataset "fct-Compliance-by-FortiGate"
        set chart-type table
        config table-columns
            edit 1
                set header "Device"
                set data-binding "fgtserial"
                set data-top 10
            next
            edit 2
                set header "# Devices"
                set data-binding "totalnum"
            next
        end
        set protected enable
    next
    edit "fct-Compliance-Status"
        set disp-name "FortiClient-Endpoint Compliance"
        set category "Event"
        set dev-type FortiClient
        set description "Number of Compliant and Non-complicant Endpoints"
        set dataset "fct-Compliance-Status"
        set chart-type donut
        config table-columns
            edit 1
                set header ""
                set data-binding "compliance"
            next
            edit 2
                set header "Total Number"
                set data-binding "totalnum"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fct-Non-Compliant-Endpoints"
        set disp-name "FortiClient-Non Compliant Endpoints"
        set category "Event"
        set dev-type FortiClient
        set description "Non-compliant Endpoints with FortiGates"
        set dataset "fct-Non-Compliant-Endpoints"
        set chart-type table
        config table-columns
            edit 1
                set header "FortiGate"
                set data-binding "fgtserial"
                set data-top 10
            next
            edit 2
                set header "Source Interface"
                set data-binding "srcintf"
            next
            edit 3
                set header "Hostname"
                set data-binding "hostname"
            next
            edit 4
                set header "Device ID"
                set data-binding "mac"
            next
            edit 5
                set header "Status"
                set data-binding "status"
            next
        end
        set protected enable
    next

    edit "fct-Traffic-Web-Hits"
        set disp-name "FortiClient-Web Traffic Trend"
        set category "Traffic"
        set dev-type FortiClient
        set description "Trend Chart Showing Hits"
        set dataset "fct-Traffic-Web-Hits"
        set chart-type line
        config table-columns
            edit 1
                set header "Date"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "requests"
                set column-graph-type line-up
                set column-attr count
                set legend "# of Requests"
            next
        end
        set protected enable
    next
    edit "fct-Traffic-Top-Allowed-Web-Cat"
        set disp-name "FortiClient-Top Visited Web Categories"
        set category "Traffic"
        set dev-type FortiClient
        set description "Top Visited Web Categories"
        set dataset "fct-Traffic-Top-Allowed-Web-Cat"
        set chart-type table
        config table-columns
            edit 1
                set header "Category"
                set data-binding "category"
                set column-attr web-cat
                set data-top 20
                set column-width 40
            next
            edit 2
                set header "Total Request"
                set data-binding "requests"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fct-Traffic-Top-Allowed-Website"
        set disp-name "FortiClient-Top Visited Websites"
        set category "Traffic"
        set dev-type FortiClient
        set description "Top Visited Websites"
        set dataset "fct-Traffic-Top-Allowed-Website"
        set chart-type table
        config table-columns
            edit 1
                set header "Website"
                set data-binding "website"
                set data-top 20
                set column-width 30
            next
            edit 2
                set header "Category"
                set data-binding "agg_category"
                set column-width 30
            next
            edit 3
                set header "Total Request"
                set data-binding "requests"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 4
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fct-Traffic-Top-Category-By-Website-Session"
        set disp-name "FortiClient-Top Web Categories by Website Session"
        set category "Traffic"
        set dev-type FortiClient
        set description "Top Web Categories by Website Session"
        set dataset "fct-Traffic-Top-Category-By-Website-Session"
        set chart-type table
        config table-columns
            edit 1
                set header "Category"
                set data-binding "category"
                set data-type raw
                set column-attr web-cat
                set data-top 20
            next
            edit 2
                set header "Website"
                set data-binding "website"
                set data-type drilldown 
                set data-top 20
            next
            edit 3
                set header "Total Session"
                set data-binding "requests"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fct-Traffic-Top-Web-Users-By-Website"
        set disp-name "FortiClient-Top Web Users by Website"
        set category "Traffic"
        set dev-type FortiClient
        set description "Top Web Users by Website"
        set dataset "fct-Traffic-Top-Web-Users-By-Website"
        set chart-type table
        config table-columns
            edit 1
                set header "User(or IP)"
                set data-binding "user_src"
                set data-type raw
                set column-attr user 
                set data-top 20
            next
            edit 2
                set header "Website"
                set data-binding "website"
                set data-type drilldown 
                set data-top 20
            next
            edit 3
                set header "Total Request"
                set data-binding "requests"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
end


config sql-report layout
    edit 1000072001
        set dev-type FortiClient
        set category "FortiClient"
        set is-template enable
        set title "Template - FortiClient Default Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Summaries for Installation, OS, Device, FCT version and client summary. Threat summary by AV threats, infected devices, detections, WF violations, AP firewall, errors and alerts, total threats found."
        set body "<h1>Endpoint Summary</h1><p>FortiClient helps to secure your network's endpoint PCs, laptops, tablets, and mobile devices.<br /><br />The following report helps you monitor and manage FortiClient detections of anti-malware, blocked applications, web filter violations, vulnerabilities and remediations, remote access and compliance.</p><fazchart mkey=\"fct-Installed-Feature-Summary\" title=\"Installed Feature Summary\" filter-logic=\"and\" width=\"720\"></fazchart><fazchart mkey=\"fct-Device-by-Operating-System\" title=\"Device by OS\" filter-logic=\"and\" width=\"720\"></fazchart><fazchart mkey=\"fct-Endpoints-by-FortiGate\" title=\"Endpoints by FortiGate\" filter-logic=\"and\" width=\"720\"></fazchart><h2>FortiClient Version Installed</h2><p>The following lists a count of the FortiClient versions installed on the network.</p><fazchart mkey=\"fct-Installed-FortiClient-Version\" title=\" \" filter-logic=\"and\" width=\"720\"></fazchart><h2>Endpoint Profile Deployment</h2><p>The following shows the endpoint profiles deployed by host.</p><fazchart mkey=\"fct-Endpoint-Profile-Deployment\" title=\"\" filter-logic=\"and\" width=\"720\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Compliance</h1><h2>FortiGates Enforcing Compliance</h2><p>The following are the list of FortiGate devices on the network that enforce compliance and the number of associated devices.</p><fazchart mkey=\"fct-Compliance-by-FortiGate\" title=\" \" filter-logic=\"and\" width=\"720\"></fazchart><h2>Endpoint Compliance</h2><p>The following are the number of compliant, non-compliant and exempt endpoints on the network.</p><fazchart mkey=\"fct-Compliance-Status\" title=\" \" filter-logic=\"and\" width=\"720\"></fazchart><h2>Non Compliant Endpoints</h2><p>The following are endpoints identified as non-compliant with the FortiGates enforcing compliance on the network.</p><fazchart mkey=\"fct-Non-Compliant-Endpoints\" title=\" \" filter-logic=\"and\" width=\"720\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Threat Summary</h1><fazchart mkey=\"fct-Threats-by-Top-Devices\" title=\"Top 10 Devices by Threats\" filter-logic=\"and\" width=\"720\"></fazchart><fazchart mkey=\"fct-Top-Malware-Detections\" title=\"Anti-Malware Detections\" filter-logic=\"and\" width=\"720\"></fazchart><fazchart mkey=\"fct-Top10-Malware-Detections\" title=\"Top 10 Malware Detections\" filter-logic=\"and\" width=\"720\"></fazchart><fazchart mkey=\"fct-Devices-with-Botnet\" title=\"Devices with Botnet C&C\" filter-logic=\"and\" width=\"720\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2>Endpoint Vulnerabilities</h2><p>The following is a list of the vulnerabilities detected and suggested remediation actions.</p><fazchart mkey=\"fct-vuln-Device-Vulnerabilities\" title=\"Vulnerabilities by Severity\" width=\"100%\"></fazchart><fazchart mkey=\"fct-vuln-Category-Type-Vulnerabilities\" title=\"Vulnerabilities by Category\" width=\"100%\"></fazchart><fazchart mkey=\"fct-vuln-Vulnerability-by-Hostname\" title=\"Endpoint Vulnerabilities by Hostname\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2>Web Violations</h2><fazchart mkey=\"fct-Users-With-Web-Violations\" title=\"Top 20 Users with Web Violations\" filter-logic=\"and\" width=\"720\"></fazchart><fazchart mkey=\"fct-Web-Filter-Violations\" title=\"Top 20 User Web Filter Violations by Count\" filter-logic=\"and\" width=\"720\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2>Events & System Updates</h2><fazchart mkey=\"fct-Errors-and-Alerts\" title=\"Errors and Alerts\" filter-logic=\"and\" width=\"720\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Web Traffic Summary</h1><p>&nbsp;</p><fazchart mkey=\"fct-Traffic-Web-Hits\" title=\"Web Traffic Trend Over Time\" width=\"100%\"></fazchart><p>&nbsp;</p><fazchart mkey=\"fct-Traffic-Top-Allowed-Web-Cat\" title=\"Top Visited Web Categories\" width=\"100%\"></fazchart><p>&nbsp;</p><fazchart mkey=\"fct-Traffic-Top-Allowed-Website\" title=\"Top Visited Websites\" width=\"100%\"></fazchart><p>&nbsp;</p><fazchart mkey=\"fct-Traffic-Top-Category-By-Website-Session\" title=\"Top Web Categories by Website and Session\" width=\"100%\"></fazchart><p>&nbsp;</p><fazchart mkey=\"fct-Traffic-Top-Web-Users-By-Website\" title=\"Top Browsing Users by Website\" width=\"100%\"></fazchart><p>&nbsp;</p><p>&nbsp;</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Appendix 1</h1><h2>Client Summary</h2><p>The following is a detailed list of hosts by FortiClient Version installed.</p><fazchart mkey=\"fct-Client-Summary\" title=\"\" filter-logic=\"and\" width=\"720\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Appendix 2</h1><h2>Vulnerability Remediation Details</h2><p>The following lists the remediation actions for the vulnerablities detected.</p><fazchart mkey=\"fct-vuln-Details-by-Device-User\" title=\"\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90106
                next
                edit 90202
                next
                edit 90203
                next
            end
        set protected enable
    next
    edit 1000072002
        set dev-type FortiClient
        set category "FortiClient"
        set hide-rowid 1
        set is-template enable
        set title "Template - FortiClient Vulnerability Scan Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "The vulnerabilities detected through Forticlient scans across the network"
        set body "<h1>Summary</h1><p>The following report provides a summary of the vulnerabilities detected through FortiClient scans across the network.</p><p>&nbsp;</p><h2>Device Vulnerabilities</h2><p>The following are vulnerabilities detected by user/device.</p><fazchart mkey=\"fct-vuln-Device-Vulnerabilities\" title=\" \" width=\"100%\"></fazchart><h2>Category Type Vulnerabilities</h2><p>The following are vulnerabilities detected by category type.</p><fazchart mkey=\"fct-vuln-Category-Type-Vulnerabilities\" title=\" \" width=\"100%\"></fazchart><h2>Vulnerabilities by OS</h2><p>The following are the OS vulnerabilities detected.</p><fazchart mkey=\"fct-vuln-Vulnerabilities-by-OS\" title=\" \" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2># Vulnerabilities by Risk Level</h2><p>The following chart displays the number of vulnerabilities by risk level.</p><fazchart mkey=\"fct-vuln-Vulnerabilities-by-Risk-Level\" title=\" \" width=\"100%\"></fazchart><h2># Devices by Vulnerability Risk Level.</h2><p>The following table displays the number of vulnerabilities on the net work by device and risk level.</p><fazchart mkey=\"fct-vuln-Device-by-Risk-Level\" title=\" \" width=\"100%\"></fazchart><h2>Vulnerability Trend</h2><p>The following chart displays the vulnerability trend over the report period.</p><fazchart mkey=\"fct-vuln-Vulnerability-Trend\" title=\" \" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2>Vulnerabilities by Risk Level Details</h2><p>The following provides details of the vulnerabilities for each risk level by device.</p><fazchart mkey=\"fct-vuln-Details-by-Risk-Level-Device\" title=\"Devices with Critical Vulnerabilities\" width=\"100%\"><fazfilters><fazfilter field=\"vulnseverity\" oper=\"eq\" value=\"Critical\"></fazfilter></fazfilters></fazchart><fazchart mkey=\"fct-vuln-Details-by-Risk-Level-Device\" title=\"Devices with High Vulnerabilities\" width=\"100%\"><fazfilters><fazfilter field=\"vulnseverity\" oper=\"eq\" value=\"High\"></fazfilter></fazfilters></fazchart><fazchart mkey=\"fct-vuln-Details-by-Risk-Level-Device\" title=\"Devices with Medium Vulnerabilities\" width=\"100%\"><fazfilters><fazfilter field=\"vulnseverity\" oper=\"eq\" value=\"Medium\"></fazfilter></fazfilters></fazchart><fazchart mkey=\"fct-vuln-Details-by-Risk-Level-Device\" title=\"Devices with Low Vulnerabilities\" width=\"100%\"><fazfilters><fazfilter field=\"vulnseverity\" oper=\"eq\" value=\"Low\"></fazfilter></fazfilters></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2>Vulnerability Details by Device User</h2><p>The following provides details of the vulnerabilities by device user.</p><fazchart mkey=\"fct-vuln-Details-by-Device-User\" title=\" \" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2>Remediation Actions by Device</h2><p>The following is a list of actions required to remediate the vulnerabilities found on devices in the network.</p><fazchart mkey=\"fct-vuln-Remediation-by-Device\" title=\" \" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2>Remediation by Vulnerability</h2><fazchart mkey=\"fct-vuln-Remediation-by-Vulnerability\" title=\" \" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2>Top 30 Targeted High Risk Vulnerabilities</h2><p>The following is an overview of the highest risk software vulnerabilities that are being exploited to target critical infrastructure organizations, along with mitigation recommendations.</p><fazchart mkey=\"fct-vuln-Top-30-Targeted-High-Risk-Vulnerabilities\" title=\" \" width=\"100%\"></fazchart><p>&nbsp;</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Resources</h1><p>&nbsp;</p><p><strong>FortiClient</strong></p><p>&nbsp;</p><p>FortiClient is an industry certified all-in-one personal security suite. It includes Anti-Virus, Web Filtering, Application Firewall, VLN and more.</p><p>http://www.forticlient.com/</p><p>&nbsp;</p><p><strong>Online Virus Scan</strong></p><p>&nbsp;</p><p>Upload a suspicious file for scanning by FortiGuard AV Online Scanner.</p><p>http://www.fortiguard.com/virusscanner</p><p>&nbsp;</p><p><strong>Malware Removal Tools</strong></p><p>&nbsp;</p><p>Suspect your PC is already infected? View our malware removal tools.</p><p>http://www.fortiguard.com/malwareremoval</p><p>&nbsp;</p><p>&nbsp;</p>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90106
                next
                edit 90202
                next
                edit 90203
                next
            end
        set protected enable
    next
end

config sql-report schedule
     edit "1000072001"
         set is-template enable
         set description "FortiClient Default Report"
         set schedule-type every-n-weeks
         set schedule-frequency 1
         set schedule-valid-start 00:00 2012/10/01
         set time-period last-7-days
         set display-table-contents enable
         set output-format pdf
         set dev-type FortiClient
         set schedule-color "#5484ED"
         config report-layout
             edit 1000072001
             next
         end
         config devices
            edit All_FortiClient
            next
         end
    next
end

config sql-report layout-folder
    edit 99999
        set folder-name "Default Templates"
        set protected enable
    next
    edit 90106
        set folder-name "FortiClient Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90202
        set folder-name "Asset and User Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90203
        set folder-name "SOC Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90205
        set folder-name "Outbreak Alert Reports Templates"
        set parent-id 99999
        set protected enable
    next
end

config alert basic-handler
    edit 60001
        set name "Default-FCT-Threat-Detection-By-Endpoint"
        set description "Default event handler for FortiClient threat detection by endpoint"
        config rule
            edit 1
                set name "Sandbox detected Malware in FCT File submission"
                set devtype FortiClient
                set severity high
                set logtype "fct-event"
                set extrainfo "Malware detected in File: ${file} with Size: ${filesize}"
                set extrainfo-type custom
                set subject "Sandbox detected Malware in FCT File submission"
                set groupby1 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Sandbox,Malware"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "subtype=\"sandboxing\" and msg~\"Found virus\" "
            next
            edit 2
                set name "Malware found by FCT AV scan on File System"
                set devtype FortiClient
                set severity high
                set logtype "fct-event"
                set extrainfo "Malware: ${virus} detected in File: ${file} with Size: ${filesize} "
                set extrainfo-type custom
                set subject "Malware found by FCT AV scan on File System"
                set groupby1 "endpoint"
                set groupby2 "virus"
                set eventstatus "contained"
                set tags "Default,By_Endpoint,Malware"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "subtype=\"av\" and msg~\"Found virus\""
            next
            edit 3
                set name "Access to Web blocked by FCT Web Filter"
                set devtype FortiClient
                set severity medium
                set logtype "fct-traffic"
                set extrainfo "Process: ${srcname} initiated traffic to domain: ${remotename} with URL: ${url}, FortiGuard Category: ${threat}"
                set extrainfo-type custom
                set subject "Access to Web blocked by FCT Web Filter"
                set groupby1 "endpoint"
                set groupby2 "remotename"
                set eventstatus "mitigated"
                set tags "Default,By_Endpoint,URL,Risky"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "utmevent=\"webfilter\" and utmaction=\"blocked\""
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fct"
    next
    edit 60002
        set name "Default-FCT-Threat-Detection-By-Threat"
        set description "Default event handler for FortiClient threat detection by threat"
        config rule
            edit 1
                set name "Malware found by FCT AV scan on File System"
                set devtype FortiClient
                set severity high
                set logtype "fct-event"
                set extrainfo "Malware: ${virus} detected in File: ${file} with Size: ${filesize} "
                set extrainfo-type custom
                set subject "Malware found by FCT AV scan on File System"
                set groupby1 "virus"
                set groupby2 "endpoint"
                set eventstatus "contained"
                set tags "Default,By_Threat,Malware"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "subtype=\"av\" and msg~\"Found virus\""
            next
            edit 2
                set name "Access to Web blocked by FCT Web Filter"
                set devtype FortiClient
                set severity medium
                set logtype "fct-traffic"
                set extrainfo "Process: ${srcname} initiated traffic to domain: ${remotename} with URL: ${url}, FortiGuard Category: ${threat}"
                set extrainfo-type custom
                set subject "Access to Web blocked by FCT Web Filter"
                set groupby1 "remotename"
                set groupby2 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Threat,URL,Risky"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "utmevent=\"webfilter\" and utmaction=\"blocked\""
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fct"
    next
end


config sql-report dataset
end



config sql-report chart
end


config sql-report layout
end


config sql-report layout-folder
	edit 99999
		set folder-name "Default Templates"
		set protected enable
	next
end
config alert correlation-handler
    edit ab3_4d1_75a_b78
        set handler-id "ab3_4d1_75a_b78"
        set name "Default-Brute-Force-Account-Login-Attack-FAZ"
        set uuid ""
        set content-pack-uuid ""
        set content-pack-id ""
        set version 2
        set creation-time 0
        set enable-time 0
        set update-time 0
        set description "This handler is to detect if an account login failed many times not followed by a login success for FortiAnalyzer."
        set automation-stitch disable
        set thres-duration 30
        set rule-relation "c3a_f11_453_7cd NOT_FOLLOWED_BY[5m] 5b7_902_4ce_c21"
        set rule-relation-constraint "c3a_f11_453_7cd.devid=5b7_902_4ce_c21.devid"
        set eventstatus "auto"
        set extrainfo-type default
        set severity medium
        set tags "login,attack"
        set notification ""
        set data-selector ""
        config rule
            edit c3a_f11_453_7cd
                set rule-id "c3a_f11_453_7cd"
                set name "Login Failed 5 Times"
                set devtype FortiAnalyzer
                set logtype "event"
                set utmevent ""
                set groupby1 "devid"
                set groupby2 ""
                set groupby3 ""
                set filter-relation 1
                set filter-expr ""
                set aggregate-expr "COUNT(*) >= 5"
                config filter
                    edit 1
                        set id 1
                        set key "operation"
                        set value "login failed"
                        set oper equal
                    next
                end
            next
            edit 5b7_902_4ce_c21
                set rule-id "5b7_902_4ce_c21"
                set name "Login Success"
                set devtype FortiAnalyzer
                set logtype "event"
                set utmevent ""
                set groupby1 "devid"
                set groupby2 ""
                set groupby3 ""
                set filter-relation 1
                set filter-expr ""
                set aggregate-expr "COUNT(*)>=1"
                config filter
                    edit 1
                        set id 1
                        set key "operation"
                        set value "login"
                        set oper equal
                    next
                end
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/correlation-handler/faz"
    next
end


config sql-report dataset
    edit "threat-rating-distribution"
        set description "FortiSandbox threat rating distribution"
        set log-type virus
        set dev-type FortiSandbox
        set query "select risk, count(*) as total_num from $log where $filter group by risk order by total_num desc"
        set protected enable
    next
    edit "job-severity-timeline"
        set description "FortiSandbox job severity timeline"
        set log-type virus
        set dev-type FortiSandbox
        set query "select $flex_timescale(timestamp) as hod, risk, sum(total_num) as total_num from ###(select $flex_timestamp as timestamp, risk, count(*) as total_num from $log where $filter group by timestamp, risk order by timestamp desc)### t group by hod, risk order by hod desc"
        set protected enable
    next
    edit "targeted-hosts-with-severity"
        set description "FortiSandbox targeted hosts with severity"
        set log-type virus
        set dev-type FortiSandbox
        set query "select dstip, risk, count(*) as total_num from $log where $filter and dstip is not null group by dstip, risk order by total_num desc"
        set protected enable
    next
    edit "brief-job-list"
        set description "FortiSandbox brief job list"
        set log-type virus
        set dev-type FortiSandbox
        set query "select $DAY_OF_MONTH as timestamp, srcip, dstip, fname, suser, stype, risk, count(*) as cnt from $log where $filter group by timestamp, srcip, dstip, fname, suser, stype, risk order by timestamp desc"
        set protected enable
    next
    edit "fsa-scan-stats-of-malware-by-name"
        set description "FortiSandbox scan statistics of malware by name"
        set log-type virus
        set dev-type FortiSandbox
        set query "select mname, max(risk) as risk, count(*) as total_num from $log where $filter group by mname order by total_num desc"
        set protected enable
    next
    edit "fsa-targeted-hosts"
        set description "FortiSandbox targeted hosts"
        set log-type virus
        set dev-type FortiSandbox
        set query "select dstip, count(*) as total_num from $log where $filter and dstip is not null and risk is not null group by dstip order by total_num desc"
        set protected enable
    next
    edit "fsa-scan-stats-of-rating-by-source-os"
        set description "FortiSandbox scan statistics of risks by vmos"
        set log-type virus
        set dev-type FortiSandbox
        set query "select risk, count(*) as total_num, vmos from $log where $filter group by risk, vmos order by vmos, total_num desc"
        set protected enable
    next
    edit "fsa-scan-stats-count-of-file-type"
        set description "FortiSandbox scan statistics of file type"
        set log-type event
        set dev-type FortiSandbox
        set query "select ftype, sum(job_count) as total_num from ###(select $flex_timestamp as timestamp, $HOUR_OF_DAY as hourstamp, $HOUR_OF_DAY(stime) as stime_hod, fname, ftype, rsrc, risk, mcate, (case when msg like 'URL%' then 'URL' else 'FILE' end) as src_type, max(itime) as max_itime, min(itime) as min_itime, sum(CASE WHEN etime>stime THEN etime-stime ELSE 0 END) as duration, sum(CASE WHEN jobid IS NOT NULL AND risk IS NOT NULL THEN 1 ELSE 0 END) as job_count, count(*) as total_num from $log where $filter group by timestamp, hourstamp, stime_hod, fname, ftype, rsrc, risk, src_type, mcate, src_type order by hourstamp)### t where ftype is not null group by ftype having sum(job_count)>0 order by total_num desc"
        set protected enable
    next
    edit "fsa-File-Type-Summary-With-VM-Source"
        set description  "FortiSandbox File Type Summary With VM Source"
        set log-type event
        set dev-type FortiSandbox
        set query "select (case when ftype in ('exe','msi','upx','vbs','bat','cmd','dll','ps1','jar','wsf','vbs','pdf','doc','docx','rtf','dotx','docm','dotm','dot','xltm','pub','xls','xlsx','xltx','xlsm','xlsb','xlam','xlt','ppsx','ppt','pptx','potx','sldx','pptm','ppsm','potm','ppam','sldm','pps','pot','msg','swf','htm','js','url','lnk') then 'Executable Files'  when ftype in ('cab','tgz','z','7z','tar','lzh','kgb','rar','zip','gz','xz','bz2','ace','tar.gz','tar.gz2','tar.Z') then 'Archived' when ftype in ('.avi','.mpeg','mp3','mp4') then 'Media' when ftype is null then 'null' else 'other' end) as filetype, sum(total_num) as total_num from ###(select $flex_timestamp as timestamp, $HOUR_OF_DAY as hourstamp, $HOUR_OF_DAY(stime) as stime_hod, fname, ftype, rsrc, risk, mcate, (case when msg like 'URL%' then 'URL' else 'FILE' end) as src_type, max(itime) as max_itime, min(itime) as min_itime, sum(CASE WHEN etime>stime THEN etime-stime ELSE 0 END) as duration, sum(CASE WHEN jobid IS NOT NULL AND risk IS NOT NULL THEN 1 ELSE 0 END) as job_count, count(*) as total_num from $log where $filter group by timestamp, hourstamp, stime_hod, fname, ftype, rsrc, risk, src_type, mcate, src_type order by hourstamp)### t where rsrc LIKE 'VM Engine%' and ftype is not null group by filetype order by total_num desc"
        set protected enable
    next
    edit "fsa-File-Type-Details-With-VM-Source"
        set description  "FortiSandbox File Type Details With VM Source"
        set log-type event
        set dev-type FortiSandbox
        set query "select (case when ftype in ('pdf') then 'Adobe PDF' when ftype in ('swf') then 'Adobe Flash' when ftype in ('doc','docx','rtf','dotx','docm','dotm','dot','xltm','pub') then 'Microsoft Word' when ftype in ('xls','xlsx','xltx','xlsm','xlsb','xlam','xlt') then 'Microsoft Excel' when ftype in ('ppsx','ppt','pptx','potx','sldx','pptm','ppsm','potm','ppam','sldm','pps','pot') then 'Microsoft PowerPoint' when ftype in ('msg') then 'Microsoft Outlook' when ftype in ('htm','js','url','lnk') then 'Web Files' when ftype in ('cab','tgz','z','7z','tar','lzh','kgb','rar','zip','gz','xz','bz2','ace') then 'Archive Files' when ftype in ('apk') then 'Android Files' when ftype is null then 'null' else ftype end) as filetype, sum(total_num) as total_num from ###(select $flex_timestamp as timestamp, $HOUR_OF_DAY as hourstamp, $HOUR_OF_DAY(stime) as stime_hod, fname, ftype, rsrc, risk, mcate, (case when msg like 'URL%' then 'URL' else 'FILE' end) as src_type, max(itime) as max_itime, min(itime) as min_itime, sum(CASE WHEN etime>stime THEN etime-stime ELSE 0 END) as duration, sum(CASE WHEN jobid IS NOT NULL AND risk IS NOT NULL THEN 1 ELSE 0 END) as job_count, count(*) as total_num from $log where $filter group by timestamp, hourstamp, stime_hod, fname, ftype, rsrc, risk, src_type, mcate, src_type order by hourstamp)### t where rsrc LIKE 'VM Engine%' and ftype is not null group by filetype order by total_num desc"
        set protected enable
    next
    edit "fsa-File-Type-Summary"
        set description  "FortiSandbox File Type Summary"
        set log-type event
        set dev-type FortiSandbox
        set query "select (case when ftype in ('exe','msi','upx','vbs','bat','cmd','dll','ps1','jar','wsf','vbs','pdf','doc','docx','rtf','dotx','docm','dotm','dot','xltm','pub','xls','xlsx','xltx','xlsm','xlsb','xlam','xlt','ppsx','ppt','pptx','potx','sldx','pptm','ppsm','potm','ppam','sldm','pps','pot','msg','swf','htm','js','url','lnk') then 'Executable Files'  when ftype in ('cab','tgz','z','7z','tar','lzh','kgb','rar','zip','gz','xz','bz2','ace','tar.gz','tar.gz2','tar.Z') then 'Archived' when ftype in ('.avi','.mpeg','mp3','mp4') then 'Media' when ftype is null then 'null' else 'other' end) as filetype, sum(total_num) as total_num from ###(select $flex_timestamp as timestamp, $HOUR_OF_DAY as hourstamp, $HOUR_OF_DAY(stime) as stime_hod, fname, ftype, rsrc, risk, mcate, (case when msg like 'URL%' then 'URL' else 'FILE' end) as src_type, max(itime) as max_itime, min(itime) as min_itime, sum(CASE WHEN etime>stime THEN etime-stime ELSE 0 END) as duration, sum(CASE WHEN jobid IS NOT NULL AND risk IS NOT NULL THEN 1 ELSE 0 END) as job_count, count(*) as total_num from $log where $filter group by timestamp, hourstamp, stime_hod, fname, ftype, rsrc, risk, src_type, mcate, src_type order by hourstamp)### t where ftype is not null group by filetype order by total_num desc"
        set protected enable
    next
    edit "fsa-File-Type-Details"
        set description  "FortiSandbox File Type Details"
        set log-type event
        set dev-type FortiSandbox
        set query "select (case when ftype in ('pdf') then 'Adobe PDF' when ftype in ('swf') then 'Adobe Flash' when ftype in ('doc','docx','rtf','dotx','docm','dotm','dot','xltm','pub') then 'Microsoft Word' when ftype in ('xls','xlsx','xltx','xlsm','xlsb','xlam','xlt') then 'Microsoft Excel' when ftype in ('ppsx','ppt','pptx','potx','sldx','pptm','ppsm','potm','ppam','sldm','pps','pot') then 'Microsoft PowerPoint' when ftype in ('msg') then 'Microsoft Outlook' when ftype in ('htm','js','url','lnk') then 'Web Files' when ftype in ('cab','tgz','z','7z','tar','lzh','kgb','rar','zip','gz','xz','bz2','ace') then 'Archive Files' when ftype in ('apk') then 'Android Files' when ftype is null then 'null' else ftype end) as filetype, sum(total_num) as total_num from ###(select $flex_timestamp as timestamp, $HOUR_OF_DAY as hourstamp, $HOUR_OF_DAY(stime) as stime_hod, fname, ftype, rsrc, risk, mcate, (case when msg like 'URL%' then 'URL' else 'FILE' end) as src_type, max(itime) as max_itime, min(itime) as min_itime, sum(CASE WHEN etime>stime THEN etime-stime ELSE 0 END) as duration, sum(CASE WHEN jobid IS NOT NULL AND risk IS NOT NULL THEN 1 ELSE 0 END) as job_count, count(*) as total_num from $log where $filter group by timestamp, hourstamp, stime_hod, fname, ftype, rsrc, risk, src_type, mcate, src_type order by hourstamp)### t where ftype is not null group by filetype order by total_num desc"
        set protected enable
    next
    edit "fsa-File-Source-Stats"
        set description  "FortiSandbox File Source Stats"
        set log-type event
        set dev-type FortiSandbox
        set query "select rsrc as res_src, sum(case when risk='Clean' then total_num else 0 end) as clean, sum(case when risk='Low Risk' then total_num else 0 end) as low, sum(case when risk='Medium Risk' then total_num else 0 end) as medium, sum(case when risk='High Risk' then total_num else 0 end) as high, sum(case when risk='Malicious' then total_num else 0 end) as malicious, sum(case when risk='Unknown' then total_num else 0 end) as unknown, sum (total_num) as total_num from ###(select $flex_timestamp as timestamp, $HOUR_OF_DAY as hourstamp, $HOUR_OF_DAY(stime) as stime_hod, fname, ftype, rsrc, risk, mcate, (case when msg like 'URL%' then 'URL' else 'FILE' end) as src_type, max(itime) as max_itime, min(itime) as min_itime, sum(CASE WHEN etime>stime THEN etime-stime ELSE 0 END) as duration, sum(CASE WHEN jobid IS NOT NULL AND risk IS NOT NULL THEN 1 ELSE 0 END) as job_count, count(*) as total_num from $log where $filter group by timestamp, hourstamp, stime_hod, fname, ftype, rsrc, risk, src_type, mcate, src_type order by hourstamp)### t where rsrc is not null and risk is not null group by res_src order by total_num desc"
        set protected enable
    next
    edit "fsa-File-Type-Stats"
        set description  "FortiSandbox File Type Stats"
        set log-type event
        set dev-type FortiSandbox
        set query "select ftype as filetype, sum(CASE WHEN rsrc='AV Scanner' THEN total_num ELSE 0 END) as avscan, sum(CASE WHEN rsrc='Local Overwrite' THEN total_num ELSE 0 END) as local, sum(CASE WHEN rsrc='Sandboxing Result Cache' THEN total_num ELSE 0 END) as sandb, sum(CASE WHEN rsrc='VM Engine (AI)' OR rsrc='VM Engine' THEN total_num ELSE 0 END) as vmeng, sum(CASE WHEN rsrc='FSA Community Cloud' THEN total_num ELSE 0 END) as comm, sum(CASE WHEN rsrc='Static File Scan' THEN total_num ELSE 0 END) as static, sum(total_num) as total_num from ###(select $flex_timestamp as timestamp, $HOUR_OF_DAY as hourstamp, $HOUR_OF_DAY(stime) as stime_hod, fname, ftype, rsrc, risk, mcate, (case when msg like 'URL%' then 'URL' else 'FILE' end) as src_type, max(itime) as max_itime, min(itime) as min_itime, sum(CASE WHEN etime>stime THEN etime-stime ELSE 0 END) as duration, sum(CASE WHEN jobid IS NOT NULL AND risk IS NOT NULL THEN 1 ELSE 0 END) as job_count, count(*) as total_num from $log where $filter group by timestamp, hourstamp, stime_hod, fname, ftype, rsrc, risk, src_type, mcate, src_type order by hourstamp)### t where rsrc in ('AV Scanner','Local Overwrite','Sandboxing Result Cache','VM Engine', 'VM Engine (AI)', 'FSA Community Cloud','Static File Scan') group by filetype order by total_num desc"
        set protected enable
    next
    edit "fsa-Hourly-File-Stats-Count"
        set description  "FortiSandbox Hourly File Stats Count"
        set log-type event
        set dev-type FortiSandbox
        set query "select hourstamp as hrstamp, sum(CASE WHEN rsrc='AV Scanner' THEN total_num ELSE 0 END) as avscan, sum(CASE WHEN rsrc='Local Overwrite' THEN total_num ELSE 0 END) as local, sum(CASE WHEN rsrc='Sandboxing Result Cache' THEN total_num ELSE 0 END) as sandb, sum(CASE WHEN rsrc='VM Engine (AI)' OR rsrc='VM Engine' THEN total_num ELSE 0 END) as vmeng, sum(CASE WHEN rsrc='FSA Community Cloud' THEN total_num ELSE 0 END) as comm, sum(CASE WHEN rsrc='Static File Scan' THEN total_num ELSE 0 END) as static, sum(total_num) as total_num from ###(select $flex_timestamp as timestamp, $HOUR_OF_DAY as hourstamp, $HOUR_OF_DAY(stime) as stime_hod, fname, ftype, rsrc, risk, mcate, (case when msg like 'URL%' then 'URL' else 'FILE' end) as src_type, max(itime) as max_itime, min(itime) as min_itime, sum(CASE WHEN etime>stime THEN etime-stime ELSE 0 END) as duration, sum(CASE WHEN jobid IS NOT NULL AND risk IS NOT NULL THEN 1 ELSE 0 END) as job_count, count(*) as total_num from $log where $filter group by timestamp, hourstamp, stime_hod, fname, ftype, rsrc, risk, src_type, mcate, src_type order by hourstamp)### t where rsrc in ('AV Scanner','Local Overwrite','Sandboxing Result Cache','VM Engine', 'VM Engine (AI)', 'FSA Community Cloud','Static File Scan') group by hrstamp order by hrstamp"
        set protected enable
    next
    edit "fsa-Scanned-File-Stats-By-Source"
        set description  "FortiSandbox Scanned File Stats By Source"
        set log-type event
        set dev-type FortiSandbox
        set query "select round(sum(avscan)/sum(total_num)) as avscan, round(sum(local)/sum(total_num)) as local, round(sum(sandb)/sum(total_num)) as sandb, round(sum(vmeng)/sum(total_num)) as vmeng, round(sum(comm)/sum(total_num)) as comm, round(sum(static)/sum(total_num)) as static from (select sum(CASE WHEN rsrc='AV Scanner' THEN duration ELSE 0 END) as avscan, sum(CASE WHEN rsrc='Local Overwrite' THEN duration ELSE 0 END) as local, sum(CASE WHEN rsrc='Sandboxing Result Cache' THEN duration ELSE 0 END) as sandb, sum(CASE WHEN rsrc='VM Engine (AI)' OR rsrc='VM Engine' THEN duration ELSE 0 END) as vmeng, sum(CASE WHEN rsrc='FSA Community Cloud' THEN duration ELSE 0 END) as comm, sum(CASE WHEN rsrc='Static File Scan' THEN duration ELSE 0 END) as static, sum(total_num) as total_num from ###(select $flex_timestamp as timestamp, $HOUR_OF_DAY as hourstamp, $HOUR_OF_DAY(stime) as stime_hod, fname, ftype, rsrc, risk, mcate, (case when msg like 'URL%' then 'URL' else 'FILE' end) as src_type, max(itime) as max_itime, min(itime) as min_itime, sum(CASE WHEN etime>stime THEN etime-stime ELSE 0 END) as duration, sum(CASE WHEN jobid IS NOT NULL AND risk IS NOT NULL THEN 1 ELSE 0 END) as job_count, count(*) as total_num from $log where $filter group by timestamp, hourstamp, stime_hod, fname, ftype, rsrc, risk, src_type, mcate, src_type order by hourstamp)### t where rsrc in ('AV Scanner','Local Overwrite','Sandboxing Result Cache','VM Engine', 'VM Engine (AI)', 'FSA Community Cloud','Static File Scan') group by rsrc, duration) t"
        set protected enable
    next
    edit "fsa-Hourly-Sanned-File-Stats-By-Source"
        set description  "FortiSandbox Hourly Scanned File Stats By Source"
        set log-type event
        set dev-type FortiSandbox
        set query "select hrstamp, round(sum(avscan)/sum(total_num)) as avscan, round(sum(local)/sum(total_num)) as local, round(sum(sandb)/sum(total_num)) as sandb, round(sum(vmeng)/sum(total_num)) as vmeng, round(sum(comm)/sum(total_num)) as comm, round(sum(static)/sum(total_num)) as static from (select hourstamp as hrstamp, sum(CASE WHEN rsrc='AV Scanner' THEN duration ELSE 0 END) as avscan, sum(CASE WHEN rsrc='Local Overwrite' THEN duration ELSE 0 END) as local, sum(CASE WHEN rsrc='Sandboxing Result Cache' THEN duration ELSE 0 END) as sandb, sum(CASE WHEN rsrc='VM Engine (AI)' OR rsrc='VM Engine' THEN duration ELSE 0 END) as vmeng, sum(CASE WHEN rsrc='FSA Community Cloud' THEN duration ELSE 0 END) as comm, sum(CASE WHEN rsrc='Static File Scan' THEN duration ELSE 0 END) as static, sum(total_num) as total_num from ###(select $flex_timestamp as timestamp, $HOUR_OF_DAY as hourstamp, $HOUR_OF_DAY(stime) as stime_hod, fname, ftype, rsrc, risk, mcate, (case when msg like 'URL%' then 'URL' else 'FILE' end) as src_type, max(itime) as max_itime, min(itime) as min_itime, sum(CASE WHEN etime>stime THEN etime-stime ELSE 0 END) as duration, sum(CASE WHEN jobid IS NOT NULL AND risk IS NOT NULL THEN 1 ELSE 0 END) as job_count, count(*) as total_num from $log where $filter group by timestamp, hourstamp, stime_hod, fname, ftype, rsrc, risk, src_type, mcate, src_type order by hourstamp)### t where rsrc in ('AV Scanner','Local Overwrite','Sandboxing Result Cache','VM Engine', 'VM Engine (AI)', 'FSA Community Cloud','Static File Scan') group by hrstamp, rsrc, duration order by hrstamp) t group by hrstamp order by hrstamp"
        set protected enable
    next
    edit "fsa-Totalnum-Files-Submitted-to-Sandbox"
        set description "Total Files Submitted to Sandbox"
        set dev-type FortiSandbox
        set log-type event
        set query "select count(distinct(fctuid, sha256)) as totalnum from ###(select $flex_timestamp as timestamp, fctuid, sha256, max(fname) as file, max(risk) as risk from $log where $filter and fctuid is not null and sha256 is not null group by timestamp, fctuid, sha256 order by timestamp desc)### t"
        set protected enable
    next
    edit "fsa-Totalnum-of-Hosts-Affected"
        set description "Total Number of Hosts Affected"
        set dev-type FortiSandbox
        set log-type event
        set query "select count(distinct fctuid) as totalnum from ###(select $flex_timestamp as timestamp, fctuid, sha256, max(fname) as file, max(risk) as risk from $log where $filter and fctuid is not null and sha256 is not null group by timestamp, fctuid, sha256 order by timestamp desc)### t where risk::text in ('Malicious', 'Low risk', 'Medium Risk', 'High Risk')"
        set protected enable
    next
    edit "fsa-Top-Endpoint-by-Number-of-Malicious-File-Detected"
        set description "Top Endpoints by Number of Malicious Files Detected"
        set dev-type FortiSandbox
        set log-type event
        set query "select coalesce(t2.epname, t2.detectkey, 'Unknown') as ep_name, coalesce(t2.osname, 'Unknown') as os_name, count(distinct sha256) as filenum from ###(select $flex_timestamp as timestamp, fctuid, sha256, max(fname) as file, max(risk) as risk from $log where $filter and fctuid is not null and sha256 is not null group by timestamp, fctuid, sha256 order by timestamp desc)### t1 left join $ADOM_ENDPOINT t2 on t1.fctuid=t2.fctuid where risk::text in ('Malicious', 'Low risk', 'Medium Risk', 'High Risk') group by ep_name, os_name order by filenum desc"
        set protected enable
    next
    edit "fsa-Malicious-File-Detected-by-time"
        set description "Malicious Files Detected by Time"
        set dev-type FortiSandbox
        set log-type event
        set query "select $flex_timescale(timestamp) as timescale, count(distinct(fctuid, sha256)) as filenum from ###(select $flex_timestamp as timestamp, fctuid, sha256, max(fname) as file, max(risk) as risk from $log where $filter and fctuid is not null and sha256 is not null group by timestamp, fctuid, sha256 order by timestamp desc)### t where risk::text in ('Malicious', 'Low risk', 'Medium Risk', 'High Risk') group by timescale order by timescale"
        set protected enable
    next
    edit "fsa-Malicious-File-Detected-by-host"
        set description "Malicious Files Detected by Host"
        set dev-type FortiSandbox
        set log-type event
        set query "select t1.fctuid, coalesce(t2.epname, t2.detectkey, 'Unknown') as ep_name, string_agg(distinct file, ', ') as files, count(distinct sha256) as filenum from ###(select $flex_timestamp as timestamp, fctuid, sha256, max(fname) as file, max(risk) as risk from $log where $filter and fctuid is not null and sha256 is not null group by timestamp, fctuid, sha256 order by timestamp desc)### t1 left join $ADOM_ENDPOINT t2 on t1.fctuid=t2.fctuid where risk::text in ('Malicious', 'Low risk', 'Medium Risk', 'High Risk') group by t1.fctuid, ep_name order by filenum desc"
        set protected enable
    next
    edit "fsa-Top-Email-Risk-Files"
        set description "Identified Email Risk Files"
        set dev-type FortiSandbox
        set log-type virus
        set query "select malware, sum(total_num) as total_num from ###(select coalesce(nullifna(mname), 'New malware detected by Sandbox') as malware, max(risk) as risk, count(*) as total_num from $log where $filter and risk!='Clean' and mname is not null and suser like '%@%' group by malware order by risk desc, total_num desc)### t group by malware order by total_num desc"
        set protected enable
    next
    edit "fsa-Total-New-Email-Malware"
        set description "FSA Number of New Email Malware"
        set dev-type FortiSandbox
        set log-type virus
        set query "select sum(total_numbers) as total_numbers, sum(total_new) as total_new, round(sum(total_new)*100/sum(total_numbers)) as percentage_hits from ###(select count(*) as total_numbers, sum(case when lower(vmos) like '%win%' then 1 else 0 end) as total_new from $log where $filter and suser like '%@%')### t"
        set protected enable
    next
    edit "fsa-Email-Risk-Rating-by-File"
        set description "FortiSandbox Email Risk Rating by File"
        set dev-type FortiSandbox
        set log-type virus
        set query "select malware, max(risk) as risk, sum(total_num) as total_num from ###(select coalesce(nullifna(mname), 'New malware detected by Sandbox') as malware, max(risk) as risk, count(*) as total_num from $log where $filter and risk!='Clean' and mname is not null and suser like '%@%' group by malware order by risk desc, total_num desc)### t group by malware order by risk desc, total_num desc"
        set protected enable
    next
    edit "fsa-Email-Risk-Rating-by-URL"
        set description "FortiSandbox Email Risk Rating by URL"
        set dev-type FortiSandbox
        set log-type virus
        set query "select left(url, 48) as url_short, max(risk) as risk, count(*) as total_num from $log where $filter and lower(`stype`) like '%url%' and risk!='Clean' and suser like '%@%' group by url_short order by risk desc, total_num desc"
        set protected enable
    next
    edit  "fsa-Count-of-Known-Malware-Detected"
        set description "FortiSandbox Count of Known Malware Detected"
        set log-type virus
        set dev-type FortiSandbox
        set query "select count(*) from ###(select sha256, coalesce(nullifna(mname), 'Unknown') as malware_name, coalesce(fname, 'n/a') as file_name, proto, risk,(case risk when 'Malicious' then 5 when 'High Risk' then 4 when 'Medium Risk' then 3 when 'Low Risk' then 2 else 1 end) as risk_num, count(*) as count_of from $log where $filter and risk in ('Low Risk', 'Medium Risk', 'High Risk', 'Malicious') group by sha256, malware_name, file_name, risk, proto order by risk_num desc, count_of desc)### t where malware_name != 'Unknown'"
        set protected enable
    next
    edit  "fsa-Count-of-Unknown-Malware-Detected"
        set description  "FortiSandbox Count of Unknown Malware Detected"
        set log-type virus
        set dev-type FortiSandbox
        set query "select count(*) from ###(select sha256, coalesce(nullifna(mname), 'Unknown') as malware_name, coalesce(fname, 'n/a') as file_name, proto, risk,(case risk when 'Malicious' then 5 when 'High Risk' then 4 when 'Medium Risk' then 3 when 'Low Risk' then 2 else 1 end) as risk_num, count(*) as count_of from $log where $filter and risk in ('Low Risk', 'Medium Risk', 'High Risk', 'Malicious') group by sha256, malware_name, file_name, risk, proto order by risk_num desc, count_of desc)### t where malware_name = 'Unknown'"
        set protected enable
    next
    edit  "fsa-Count-of-Total-Files-Scanned"
        set description  "FortiSandbox Count of Total Files Scanned"
        set log-type event
        set dev-type FortiSandbox
        set query "select sum(job_count) as total_num from  ###(select $flex_timestamp as timestamp, $HOUR_OF_DAY as hourstamp, $HOUR_OF_DAY(stime) as stime_hod, fname, ftype, rsrc, risk, mcate, (case when msg like 'URL%' then 'URL' else 'FILE' end) as src_type, max(itime) as max_itime, min(itime) as min_itime, sum(CASE WHEN etime>stime THEN etime-stime ELSE 0 END) as duration, sum(CASE WHEN jobid IS NOT NULL AND risk IS NOT NULL THEN 1 ELSE 0 END) as job_count, count(*) as total_num from $log where $filter group by timestamp, hourstamp, stime_hod, fname, ftype, rsrc, risk, src_type, mcate, src_type order by hourstamp)### t"
        set protected enable
    next
    edit  "fsa-Count-of-Unique-Filetypes-Found"
        set description  "FortiSandbox Count of Unique Filetypes Found"
        set log-type event
        set dev-type FortiSandbox
        set query "select count(distinct ftype) as \"Unique File Types\" from ###(select distinct ftype from $log where $filter and nullifna(ftype) is not null)### t"
        set protected enable
    next
    edit  "fsa-Files-Detected-Are-Executables"
        set description  "FortiSandbox Files Detected Are Executables"
        set log-type event
        set dev-type FortiSandbox
        set query "select sum(count_of) as total_num from ###(select ftype, count(*) as count_of from $log where $filter and fname is not null group by ftype)### t where ftype in ('exe','msi','upx','vbs','bat','cmd','dll','ps1','jar','wsf','vbs','pdf','doc','docx','rtf','dotx','docm','dotm','dot','xltm','pub','xls','xlsx','xltx','xlsm','xlsb','xlam','xlt','ppsx','ppt','pptx','potx','sldx','pptm','ppsm','potm','ppam','sldm','pps','pot','msg','swf','htm','js','url','lnk','ACTION','APK','APP','BAT','BIN','CMD','COM','COMMAND','CPL','CSH','EXE','GADGET','INF1','INS','INX','IPA','ISU','JOB','JSE','KSH','LNK','MSC','MSI','MSP','MST','OSX','OUT','PAF','PIF','PRG','PS1','REG','RGS','RUN','SCR','SCT','SHB','SHS','U3P','VB','VBE','VBS','VBSCRIPT','WORKFLOW','WS','WSF','WSH','0XE','73K','89K','A6P','AC','ACC','ACR','ACTM','AHK','AIR','APP','ARSCRIPT','AS','ASB','AWK','AZW2','BEAM','BTM','CEL','CELX','CHM','COF','CRT','DEK','DLD','DMC','DOCM','DOTM','DXL','EAR','EBM','EBS','EBS2','ECF','EHAM','ELF','ES','EX4','EXOPC','EZS','FAS','FKY','FPI','FRS','FXP','GS','HAM','HMS','HPF','HTA','IIM','IPF','ISP','JAR','JS','JSX','KIX','LO','LS','MAM','MCR','MEL','MPX','MRC','MS','MS','MXE','NEXE','OBS','ORE','OTM','PEX','PLX','POTM','PPAM','PPSM','PPTM','PRC','PVD','PWC','PYC','PYO','QPX','RBX','ROX','RPJ','S2A','SBS','SCA','SCAR','SCB','SCRIPT','SMM','SPR','TCP','THM','TLB','TMS','UDF','UPX','URL','VLX','VPM','WCM','WIDGET','WIZ','WPK','WPM','XAP','XBAP','XLAM','XLM','XLSM','XLTM','XQT','XYS','ZL9')"
        set protected enable
    next
    edit  "fsa-Average-Scan-Time-Per-File"
        set description  "FortiSandbox Average Scan Time Per File"
        set log-type virus
        set dev-type FortiSandbox
        set query "select cast(sum(total)\/sum(count) as decimal(18, 0)) as scantime_avg from ###(select sum(scanend-scanstart) as total, count(*) as count from $log where $filter and fname is not null and scanend>=scanstart)### t"
        set protected enable
    next
    edit  "fsa-Files-Processed-Per-Hour"
        set description  "FortiSandbox Files Processed Per Hour"
        set log-type event
        set dev-type FortiSandbox
        set query "select cast((case when max(max_itime)>min(min_itime) then (3600*sum(job_count)/((max(max_itime)-min(min_itime)))) else 0 end) as decimal(18,0))as files_processed_per_hour from ###(select $flex_timestamp as timestamp, $HOUR_OF_DAY as hourstamp, $HOUR_OF_DAY(stime) as stime_hod, fname, ftype, rsrc, risk, mcate, (case when msg like 'URL%' then 'URL' else 'FILE' end) as src_type, max(itime) as max_itime, min(itime) as min_itime, sum(CASE WHEN etime>stime THEN etime-stime ELSE 0 END) as duration, sum(CASE WHEN jobid IS NOT NULL AND risk IS NOT NULL THEN 1 ELSE 0 END) as job_count, count(*) as total_num from $log where $filter group by timestamp, hourstamp, stime_hod, fname, ftype, rsrc, risk, src_type, mcate, src_type order by hourstamp)### t"
        set protected enable
    next
    edit  "fsa-Most-Frequent-Attack-Victim"
        set description  "FortiSandbox Most Frequent Attack Victim"
        set log-type virus
        set dev-type FortiSandbox
        set query "select dstip, max($DAY_OF_MONTH(max_itime)) as last_seen, sum(total_num) as total_num from ###(select dstip, max(itime) as max_itime, count(*) as total_num from $log where $filter and dstip is not null and nullif(risk, 'Unknown') is not null and risk <> 'Clean' group by dstip order by total_num desc)### t group by dstip order by total_num desc limit 1"
        set protected enable
    next
    edit  "fsa-Known-Malware-Detected"
        set description  "FortiSandbox Known Malware Detected"
        set log-type virus
        set dev-type FortiSandbox
        set query "select malware_name as mname, file_name as fname, proto, risk, risk_num, sum(count_of) as count_of from ###(select sha256, coalesce(nullifna(mname), 'Unknown') as malware_name, coalesce(fname, 'n/a') as file_name, proto, risk,(case risk when 'Malicious' then 5 when 'High Risk' then 4 when 'Medium Risk' then 3 when 'Low Risk' then 2 else 1 end) as risk_num, count(*) as count_of from $log where $filter and risk in ('Low Risk', 'Medium Risk', 'High Risk', 'Malicious') group by sha256, malware_name, file_name, risk, proto order by risk_num desc, count_of desc)### t where malware_name != 'Unknown' group by mname, fname, risk, risk_num, proto order by risk_num desc, count_of desc, mname, fname"
        set protected enable
    next
    edit  "fsa-Unknown-Malware-Detected"
        set description  "FortiSandbox Unknown Malware Detected"
        set log-type virus
        set dev-type FortiSandbox
        set query "select sha256, file_name as fname, proto, risk, risk_num, sum(count_of) as count_of from ###(select sha256, coalesce(nullifna(mname), 'Unknown') as malware_name, coalesce(fname, 'n/a') as file_name, proto, risk,(case risk when 'Malicious' then 5 when 'High Risk' then 4 when 'Medium Risk' then 3 when 'Low Risk' then 2 else 1 end) as risk_num, count(*) as count_of from $log where $filter and risk in ('Low Risk', 'Medium Risk', 'High Risk', 'Malicious') group by sha256, malware_name, file_name, risk, proto order by risk_num desc, count_of desc)### t where malware_name = 'Unknown' and nullif(risk, 'Unknown') is not null group by sha256, fname, proto, risk, risk_num order by risk_num desc, count_of desc, fname"
        set protected enable
    next
    edit  "fsa-Malware-Disposition-Breakdown"
        set description  "FortiSandbox Malware Disposition Breakdown"
        set log-type event
        set dev-type FortiSandbox
        set query "select risk, sum(count_of) as count_of from   ###(select sha256, coalesce(nullifna(mname), 'Unknown') as malware_name, coalesce(fname, 'n/a') as file_name, proto, risk,(case risk when 'Malicious' then 5 when 'High Risk' then 4 when 'Medium Risk' then 3 when 'Low Risk' then 2 else 1 end) as risk_num, count(*) as count_of from $log where $filter and risk in ('Low Risk', 'Medium Risk', 'High Risk', 'Malicious') group by sha256, malware_name, file_name, risk, proto order by risk_num desc, count_of desc)### t where risk in ('Low Risk', 'Medium Risk', 'High Risk', 'Malicious') group by risk order by count_of desc"
        set protected enable
    next
    edit  "fsa-Most-Popular-Filetype"
        set description  "FortiSandbox Most Popular Filetype"
        set log-type event
        set dev-type FortiSandbox
        set query "select ftype, count(*) as \"Total\" from $log where $filter and ftype is not null group by ftype order by \"Total\" desc"
        set protected enable
    next
    edit  "fsa-Count-of-Files-Are-Archived-Compressed"
        set description  "FortiSandbox Count of Files Are Archived Compressed"
        set log-type event
        set dev-type FortiSandbox
        set query "select sum(job_count) as total_num from ###(select $flex_timestamp as timestamp, $HOUR_OF_DAY as hourstamp, $HOUR_OF_DAY(stime) as stime_hod, fname, ftype, rsrc, risk, mcate, (case when msg like 'URL%' then 'URL' else 'FILE' end) as src_type, max(itime) as max_itime, min(itime) as min_itime, sum(CASE WHEN etime>stime THEN etime-stime ELSE 0 END) as duration, sum(CASE WHEN jobid IS NOT NULL AND risk IS NOT NULL THEN 1 ELSE 0 END) as job_count, count(*) as total_num from $log where $filter group by timestamp, hourstamp, stime_hod, fname, ftype, rsrc, risk, src_type, mcate, src_type order by hourstamp)### t where fname is not null and ftype in ('cab','tgz','z','7z','tar','lzh','kgb','rar','zip','gz','xz','bz2','ace','tar.gz','tar.gz2','tar.Z')"
        set protected enable
    next
    edit  "fsa-Count-of-Files-Are-Macro-Enabled"
        set description  "FortiSandbox Count of Files Are Macro Enabled"
        set log-type event
        set dev-type FortiSandbox
        set query "select sum(count_of) as total_num from ###(select ftype, count(*) as count_of from $log where $filter and fname is not null group by ftype)### t where ftype in  ('docm','dotm','xlm','xlsm','xltm','xla','xlam','pptm','potm','ppsm','sldm','vsdm', 'vssm','vstm')"
        set protected enable
    next
    edit  "fsa-Sandbox-Processing-bar"
        set description  "FortiSandbox Sandbox Processing Bar"
        set log-type event
        set dev-type FortiSandbox
        set query "select risk, sum(job_count) as total_num from ###(select $flex_timestamp as timestamp, $HOUR_OF_DAY as hourstamp, $HOUR_OF_DAY(stime) as stime_hod, fname, ftype, rsrc, risk, mcate, (case when msg like 'URL%' then 'URL' else 'FILE' end) as src_type, max(itime) as max_itime, min(itime) as min_itime, sum(CASE WHEN etime>stime THEN etime-stime ELSE 0 END) as duration, sum(CASE WHEN jobid IS NOT NULL AND risk IS NOT NULL THEN 1 ELSE 0 END) as job_count, count(*) as total_num from $log where $filter group by timestamp, hourstamp, stime_hod, fname, ftype, rsrc, risk, src_type, mcate, src_type order by hourstamp)### t where risk is not null group by risk order by total_num desc"
        set protected enable
    next
    edit  "fsa-Count-of-Filetypes-Including-Other"
        set description  "FortiSandbox Count of Filetypes Including Other"
        set log-type event
        set dev-type FortiSandbox
        set query "select ftype, sum(job_count) as count_of from  ###(select $flex_timestamp as timestamp, $HOUR_OF_DAY as hourstamp, $HOUR_OF_DAY(stime) as stime_hod, fname, ftype, rsrc, risk, mcate, (case when msg like 'URL%' then 'URL' else 'FILE' end) as src_type, max(itime) as max_itime, min(itime) as min_itime, sum(CASE WHEN etime>stime THEN etime-stime ELSE 0 END) as duration, sum(CASE WHEN jobid IS NOT NULL AND risk IS NOT NULL THEN 1 ELSE 0 END) as job_count, count(*) as total_num from $log where $filter group by timestamp, hourstamp, stime_hod, fname, ftype, rsrc, risk, src_type, mcate, src_type order by hourstamp)### t group by ftype order by count_of desc"
        set protected enable
    next
    edit  "fsa-Filetype-Breakout-Malware"
        set description  "FortiSandbox Filetype Breakout Malware"
        set log-type event
        set dev-type FortiSandbox
        set query "select ftype, sum(job_count) as count_of from  ###(select $flex_timestamp as timestamp, $HOUR_OF_DAY as hourstamp, $HOUR_OF_DAY(stime) as stime_hod, fname, ftype, rsrc, risk, mcate, (case when msg like 'URL%' then 'URL' else 'FILE' end) as src_type, max(itime) as max_itime, min(itime) as min_itime, sum(CASE WHEN etime>stime THEN etime-stime ELSE 0 END) as duration, sum(CASE WHEN jobid IS NOT NULL AND risk IS NOT NULL THEN 1 ELSE 0 END) as job_count, count(*) as total_num from $log where $filter group by timestamp, hourstamp, stime_hod, fname, ftype, rsrc, risk, src_type, mcate, src_type order by hourstamp)### t where ftype is not null and risk='Malicious' group by ftype order by count_of desc"
        set protected enable
    next
    edit  "fsa-Compressed-File-Analysis"
        set description  "FortiSandbox Compressed File Analysis"
        set log-type event
        set dev-type FortiSandbox
        set query "select risk, sum(count_of) as count_of from (select case risk when 'Clean' then 'Clean' else 'Malicious' end as risk, sum(job_count) as count_of from  ###(select $flex_timestamp as timestamp, $HOUR_OF_DAY as hourstamp, $HOUR_OF_DAY(stime) as stime_hod, fname, ftype, rsrc, risk, mcate, (case when msg like 'URL%' then 'URL' else 'FILE' end) as src_type, max(itime) as max_itime, min(itime) as min_itime, sum(CASE WHEN etime>stime THEN etime-stime ELSE 0 END) as duration, sum(CASE WHEN jobid IS NOT NULL AND risk IS NOT NULL THEN 1 ELSE 0 END) as job_count, count(*) as total_num from $log where $filter group by timestamp, hourstamp, stime_hod, fname, ftype, rsrc, risk, src_type, mcate, src_type order by hourstamp)### t where fname is not null and ftype in ('cab','tgz','z','7z','tar','lzh','kgb','rar','zip','gz','xz','bz2','ace','tar.gz','tar.gz2','tar.Z') and nullif(risk, 'Unknown') is not null group by risk) t group by risk order by count_of desc, risk"
        set protected enable
    next
    edit  "fsa-avg-Scantime-Per-Clean-File"
        set description  "FortiSandbox Average Scantime Per Clean File"
        set log-type virus
        set dev-type FortiSandbox
        set query "select cast(sum(total)\/sum(count) as decimal(18, 0)) as scan_avg from ###(select risk, sum(scanend-scanstart) as total, count(*) as count from $log where $filter  and scanend>scanstart group by risk order by count desc)### t where risk='Clean'"
        set protected enable
    next
    edit  "fsa-avg-Scantime-Per-Malicious-File"
        set description  "FortiSandbox Average Scantime Per Malicious File"
        set log-type virus
        set dev-type FortiSandbox
        set query "select cast(sum(total)\/sum(count) as decimal(18, 0)) as scan_avg from ###(select risk, sum(scanend-scanstart) as total, count(*) as count from $log where $filter  and scanend>scanstart group by risk order by count desc)### t where risk='Malicious'"
        set protected enable
    next
    edit  "fsa-Files-Scanned-per-Day-and-Hour"
        set description  "FortiSandbox Files Scanned per Day and Hour"
        set log-type event
        set dev-type FortiSandbox
        set query  "select hourstamp, daystamp, round(sum(cnt)/count(*)) as cnt from (select $hour_of_day(timestamp) as hourstamp, $HOUR_OF_DAY(timestamp) as hour_stamp, split_part($day_of_week(timestamp), '-', 2) as daystamp, sum(job_count) as cnt from  ###(select $flex_timestamp as timestamp, $HOUR_OF_DAY as hourstamp, $HOUR_OF_DAY(stime) as stime_hod, fname, ftype, rsrc, risk, mcate, (case when msg like 'URL%' then 'URL' else 'FILE' end) as src_type, max(itime) as max_itime, min(itime) as min_itime, sum(CASE WHEN etime>stime THEN etime-stime ELSE 0 END) as duration, sum(CASE WHEN jobid IS NOT NULL AND risk IS NOT NULL THEN 1 ELSE 0 END) as job_count, count(*) as total_num from $log where $filter group by timestamp, hourstamp, stime_hod, fname, ftype, rsrc, risk, src_type, mcate, src_type order by hourstamp)### t group by timestamp, hourstamp, hour_stamp, daystamp) t group by hourstamp, daystamp order by hourstamp"
        set protected enable
    next
    edit  "fsa-avg-Scantime-per-Filetype"
        set description "FortiSandbox Average Scantime per Filetype"
        set log-type event
        set dev-type FortiSandbox
        set query "select ftype, sum(count) as count_of, sum(total)\/sum(count) as avg_scantime from  ###(select ftype, sum(etime-stime) as total, count(*) as count from $log  where $filter and etime>stime and ftype is not null group by ftype order by count desc)### t  group by ftype order by avg_scantime desc"
        set protected enable
    next
    edit "fsa-Targeted-Hosts-Lastseen"
        set description "FortiSandbox Lastseen Targeted Hosts"
        set log-type virus
        set dev-type FortiSandbox
        set query "select dstip, max($DAY_OF_MONTH(max_itime)) as last_seen, sum(total_num) as total_num from ###(select dstip, max(itime) as max_itime, count(*) as total_num from $log where $filter and dstip is not null and nullif(risk, 'Unknown') is not null and risk <> 'Clean' group by dstip order by total_num desc)### t group by dstip order by total_num desc"
        set protected enable
    next
    edit  "fsa-Command-and-Control-Callbacks-Count"
        set description "FortiSandbox Command and Control Callbacks Count"
        set log-type event
        set dev-type FortiSandbox
        set query "select mcate, sum(job_count) as total_num from ###(select $flex_timestamp as timestamp, $HOUR_OF_DAY as hourstamp, $HOUR_OF_DAY(stime) as stime_hod, fname, ftype, rsrc, risk, mcate, (case when msg like 'URL%' then 'URL' else 'FILE' end) as src_type, max(itime) as max_itime, min(itime) as min_itime, sum(CASE WHEN etime>stime THEN etime-stime ELSE 0 END) as duration, sum(CASE WHEN jobid IS NOT NULL AND risk IS NOT NULL THEN 1 ELSE 0 END) as job_count, count(*) as total_num from $log where $filter group by timestamp, hourstamp, stime_hod, fname, ftype, rsrc, risk, src_type, mcate, src_type order by hourstamp)### t where mcate in ('Infector','Botnet') group by mcate having sum(job_count)>0 order by total_num desc"
        set protected enable
    next
    edit  "fsa-Max-Hourly-Files-Processed"
        set description "FortiSandbox Max Hourly Files Processed"
        set log-type event
        set dev-type FortiSandbox
        set query "select stime_hod as hour_stamp, sum(job_count) as count_of from ###(select $flex_timestamp as timestamp, $HOUR_OF_DAY as hourstamp, $HOUR_OF_DAY(stime) as stime_hod, fname, ftype, rsrc, risk, mcate, (case when msg like 'URL%' then 'URL' else 'FILE' end) as src_type, max(itime) as max_itime, min(itime) as min_itime, sum(CASE WHEN etime>stime THEN etime-stime ELSE 0 END) as duration, sum(CASE WHEN jobid IS NOT NULL AND risk IS NOT NULL THEN 1 ELSE 0 END) as job_count, count(*) as total_num from $log where $filter group by timestamp, hourstamp, stime_hod, fname, ftype, rsrc, risk, src_type, mcate, src_type order by hourstamp)### t group by hour_stamp order by count_of desc, hour_stamp desc"
        set protected enable
    next
    edit  "fsa-Most-Frequent-Malware-Category"
        set description "FortiSandbox Most Frequent Malware Category"
        set log-type event
        set dev-type FortiSandbox
        set query "select mcate, max($DAY_OF_MONTH(max_itime)) as last_seen, sum(total_num) as total_num from ###(select $flex_timestamp as timestamp, $HOUR_OF_DAY as hourstamp, $HOUR_OF_DAY(stime) as stime_hod, fname, ftype, rsrc, risk, mcate, (case when msg like 'URL%' then 'URL' else 'FILE' end) as src_type, max(itime) as max_itime, min(itime) as min_itime, sum(CASE WHEN etime>stime THEN etime-stime ELSE 0 END) as duration, sum(CASE WHEN jobid IS NOT NULL AND risk IS NOT NULL THEN 1 ELSE 0 END) as job_count, count(*) as total_num from $log where $filter group by timestamp, hourstamp, stime_hod, fname, ftype, rsrc, risk, src_type, mcate, src_type order by hourstamp)### t where mcate is not null and mcate not in ('NotApplicable','Unknown') and nullif(risk, 'Unknown') is not null and risk <> 'Clean' group by mcate order by total_num desc"
        set protected enable
    next
    edit  "fsa-Sandbox-Threat-Detection-Processing"
        set description "FortiSandbox Threat Detection Processing"
        set log-type event
        set dev-type FortiSandbox
        set query "select rsrc, src_type, max(risk) as risk, sum(job_count) as count_of from ###(select $flex_timestamp as timestamp, $HOUR_OF_DAY as hourstamp, $HOUR_OF_DAY(stime) as stime_hod, fname, ftype, rsrc, risk, mcate, (case when msg like 'URL%' then 'URL' else 'FILE' end) as src_type, max(itime) as max_itime, min(itime) as min_itime, sum(CASE WHEN etime>stime THEN etime-stime ELSE 0 END) as duration, sum(CASE WHEN jobid IS NOT NULL AND risk IS NOT NULL THEN 1 ELSE 0 END) as job_count, count(*) as total_num from $log where $filter group by timestamp, hourstamp, stime_hod, fname, ftype, rsrc, risk, src_type, mcate, src_type order by hourstamp)### t where rsrc is not null and risk is not null group by rsrc, src_type order by risk desc, count_of desc"
        set protected enable
    next
    edit  "fsa-Peak-Daily-Total-Scan-Time"
        set description  "FortiSandbox Peak Compute Hours Per Day"
        set log-type event
        set dev-type FortiSandbox
        set query "select cast(max(scantime)\/3600 as decimal(18,2)) as peak_comp_hours from (select substring(hourstamp, 1, LENGTH(hourstamp)-6) dom, sum(duration) as scantime from ###(select $flex_timestamp as timestamp, $HOUR_OF_DAY as hourstamp, $HOUR_OF_DAY(stime) as stime_hod, fname, ftype, rsrc, risk, mcate, (case when msg like 'URL%' then 'URL' else 'FILE' end) as src_type, max(itime) as max_itime, min(itime) as min_itime, sum(CASE WHEN etime>stime THEN etime-stime ELSE 0 END) as duration, sum(CASE WHEN jobid IS NOT NULL AND risk IS NOT NULL THEN 1 ELSE 0 END) as job_count, count(*) as total_num from $log where $filter group by timestamp, hourstamp, stime_hod, fname, ftype, rsrc, risk, src_type, mcate, src_type order by hourstamp)### t where duration>0 group by dom) t"
        set protected enable
    next
    edit  "fsa-Most-Frequent-CallbackIP-Domain"
        set description "FortiSandbox Most Frequent Callback IP Domain"
        set log-type virus
        set dev-type FortiSandbox
        set query "select dstip, max($DAY_OF_MONTH(max_itime)) as last_seen, sum(total_num) as total_num from ###(select dstip, mcate, max(itime) as max_itime, count(*) as total_num from $log  where $filter group by dstip, mcate order by total_num desc)### t where dstip is not null and mcate in('Infector','Botnet') group by dstip order by total_num desc"
        set protected enable
    next
    edit  "fsa-Callback-Destinations"
        set description "FortiSandbox Callback Destinations"
        set log-type virus
        set dev-type FortiSandbox
        set query "select dstip as callback_ip_domain, sum(total_num) as attempts from ###(select dstip, mcate, max(itime) as max_itime, count(*) as total_num from $log  where $filter group by dstip, mcate order by total_num desc)### t where dstip is not null and mcate in('Infector','Botnet') group by dstip order by attempts desc"
        set protected enable
    next
end

config sql-report chart
    edit "Threat-Rating-Distribution"
        set disp-name "FortiSandbox-Threat Rating Distribution"
        set category "FortiSandbox"
        set dev-type FortiSandbox
        set description "Threat Rating Distribution"
        set dataset "threat-rating-distribution"
        set chart-type donut
        set include-other enable
        set resolve-hostname disable
        config table-columns
            edit 1
                set header ""
                set data-binding "risk"
                set data-top 5
            next
            edit 2
                set header ""
                set data-binding "total_num"
                set column-attr count
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "Job-Severity-Timeline"
        set disp-name "FortiSandbox-Job Severity Timeline"
        set category "FortiSandbox"
        set dev-type FortiSandbox
        set description "Job Severity Timeline"
        set dataset "job-severity-timeline"
        set chart-type bar
        set order-by "hod"
        set include-other disable
        set resolve-hostname disable
        config table-columns
            edit 1
                set header "Data/Time"
                set data-binding "hod"
                set data-top 168
            next
            edit 2
                set data-binding "risk"
                set data-type drilldown
                set data-top 5
            next
            edit 3
                set header "Events"
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
       end
       set protected enable
    next
    edit "Malware-Severity-of-Targeted-Hosts"
        set disp-name "FortiSandbox-Malware Severity of Targeted Hosts"
        set category "FortiSandbox"
        set dev-type FortiSandbox
        set description "Malware Severity of Targeted Hosts"
        set dataset "targeted-hosts-with-severity"
        set chart-type table
        set include-other enable
        set resolve-hostname disable
        config table-columns
            edit 1
                set header "Targeted Host"
                set data-binding "dstip"
                set data-top 25
            next
            edit 2
                set header "Severity"
                set data-binding "risk"
                set data-top 10
                set data-type drilldown
            next
            edit 3
                set header "Events"
                set data-binding "total_num"
                set column-attr count
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "Brief-Job-List"
        set disp-name "FortiSandbox-Brief Job List"
        set category "FortiSandbox"
        set dev-type FortiSandbox
        set description "Brief Job List"
        set dataset "brief-job-list"
        set chart-type table
        set resolve-hostname disable
        config table-columns
            edit 1
                set header "Date"
                set data-binding "timestamp"
                set data-top 5000
                set column-width 10
            next
            edit 2
                set header "Source IP"
                set data-binding "srcip"
                set column-width 10
            next
            edit 3
                set header "Targeted Host"
                set data-binding "dstip"
                set column-width 14
            next
            edit 4
                set header "File Name"
                set data-binding "fname"
                set column-width 25
            next
            edit 5
                set header "Submit User"
                set data-binding "suser"
                set column-width 11
            next
            edit 6
                set header "Submit Type"
                set data-binding "stype"
                set column-width 11
            next
            edit 7
                set header "Severity"
                set data-binding "risk"
                set column-width 10
            next
            edit 8
                set header "Count"
                set data-binding "cnt"
                set column-width 9
            next
        end
        set protected enable
    next
    edit "FSA-Malware-Count-By-Name"
        set disp-name "FortiSandbox-FSA Top 20 Malware"
        set category "FortiSandbox"
        set dev-type FortiSandbox
        set description "FSA top 20 malware by count"
        set dataset "fsa-scan-stats-of-malware-by-name"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "Virus"
                set data-binding "mname"
                set data-top 20
            next
            edit 2
                set data-binding "risk"
                set data-type drilldown
                set data-top 5
            next
            edit 3
                set header "Amount"
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
       end
       set protected enable
    next
    edit "FSA-File-Type"
        set disp-name "FortiSandbox-FSA Top 50 File Type"
        set category "FortiSandbox"
        set dev-type FortiSandbox
        set description "FSA Top 50 File Type by job count"
        set dataset "fsa-scan-stats-count-of-file-type"
        set chart-type table
        config table-columns
            edit 1
                set header "File Type"
                set data-binding "ftype"
                set data-top 50
            next
            edit 2
                set header "Job Count"
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
       end
       set protected enable
    next
    edit "FSA-Rating-Of-OS"
        set disp-name "FortiSandbox-FSA Top 50 Source OS"
        set category "FortiSandbox"
        set dev-type FortiSandbox
        set description "FSA Top 50 Source OS by Rating count"
        set dataset "fsa-scan-stats-of-rating-by-source-os"
        set chart-type table
        config table-columns
            edit 1
                set header "Source OS"
                set data-binding "vmos"
                set data-top 20
            next
            edit 2
                set header "Rating"
                set data-type drilldown
                set data-binding "risk"
                set data-top 5
            next
            edit 3
                set header "count"
                set data-type aggregate
                set data-binding "total_num"
                set column-attr count
            next
       end
       set protected enable
    next
    edit "FSA-Targeted-Hosts"
        set disp-name "FortiSandbox-FSA Top 20 Targeted Hosts"
        set category "FortiSandbox"
        set dev-type FortiSandbox
        set description "FSA Top 20 Targeted Hosts"
        set dataset "fsa-targeted-hosts"
        set chart-type bar
        config table-columns
            edit 1
                set header "Hosts"
                set data-binding "dstip"
                set data-top 20
            next
            edit 2
                set header "Count"
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
       end
       set protected enable
    next
    edit "fsa-File-Type-Summary-With-VM-Source"
        set disp-name "FortiSandbox-FortiSandbox File Type Summary With VM Source"
        set description "FortiSandbox File Type Summary With VM Source"
        set dev-type FortiSandbox
        set category "FortiSandbox"
        set dataset "fsa-File-Type-Summary-With-VM-Source"
        set chart-type donut
        set include-other enable
        config table-columns
            edit 1
                set header ""
                set data-binding "filetype"
                set data-top 5
            next
            edit 2
                set header ""
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fsa-File-Type-Details-With-VM-Source"
        set disp-name "FortiSandbox-FortiSandbox File Type Details With VM Source"
        set description "FortiSandbox File Type Details With VM Source"
        set dev-type FortiSandbox
        set category "FortiSandbox"
        set dataset "fsa-File-Type-Details-With-VM-Source"
        set chart-type donut
        config table-columns
            edit 1
                set header ""
                set data-binding "filetype"
                set data-top 5
            next
            edit 2
                set header "total num"
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fsa-File-Type-Summary"
        set disp-name "FortiSandbox-FortiSandbox File Type Summary"
        set description "FortiSandbox File Type Summary"
        set dev-type FortiSandbox
        set category "FortiSandbox"
        set dataset "fsa-File-Type-Summary"
        set chart-type donut
        config table-columns
            edit 1
                set header ""
                set data-binding "filetype"
                set data-top 10
            next
            edit 2
                set header ""
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fsa-File-Type-Details"
        set disp-name "FortiSandbox-FortiSandbox File Type Details"
        set description "FortiSandbox File Type Details"
        set dev-type FortiSandbox
        set category "FortiSandbox"
        set dataset "fsa-File-Type-Details"
        set chart-type donut
        config table-columns
            edit 1
                set header ""
                set data-binding "filetype"
                set data-top 10
            next
            edit 2
                set header ""
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fsa-File-Source-Stats-Donut"
        set disp-name "FortiSandbox-FortiSandbox File Source Stats Donut"
        set description "FortiSandbox File Source Stats Donut"
        set dev-type FortiSandbox
        set category "FortiSandbox"
        set dataset "fsa-File-Source-Stats"
        set chart-type donut
        config table-columns
            edit 1
                set header ""
                set data-binding "res_src"
                set data-top 10
            next
            edit 2
                set header ""
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fsa-File-Source-Stats-Table"
        set disp-name "FortiSandbox-FortiSandbox File Source Stats Table"
        set description "FortiSandbox File Source Stats Table"
        set dev-type FortiSandbox
        set category "FortiSandbox"
        set dataset "fsa-File-Source-Stats"
        set chart-type table
        config table-columns
            edit 1
                set header "Rating Module"
                set data-binding "res_src"
            next
            edit 2
                set header "Clean"
                set data-binding "clean"
                set column-attr count
            next
            edit 3
                set header "Low"
                set data-binding "low"
                set column-attr count
            next
            edit 4
                set header "Medium"
                set data-binding "medium"
                set column-attr count
            next
            edit 5
                set header "High"
                set data-binding "high"
                set column-attr count
            next
            edit 6
                set header "Malicious"
                set data-binding "malicious"
                set column-attr count
            next
            edit 7
                set header "Unknown"
                set data-binding "unknown"
                set column-attr count
            next
            edit 8
                set header "Total"
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fsa-File-Type-Stats"
        set disp-name "FortiSandbox-FortiSandbox File Type Stats"
        set description "FortiSandbox File Type Stats"
        set dev-type FortiSandbox
        set category "FortiSandbox"
        set dataset "fsa-File-Type-Stats"
        set chart-type table
        config table-columns
            edit 1
                set header "Filetype"
                set data-binding "filetype"
                set data-top 10
            next
            edit 2
                set header "Static File Scan"
                set data-binding "static"
                set column-attr count
            next
            edit 3
                set header "AV Scanner"
                set data-binding "avscan"
                set column-attr count
            next
            edit 4
                set header "FSA Community Cloud"
                set data-binding "comm"
                set column-attr count
            next
            edit 5
                set header "VM Engine"
                set data-binding "vmeng"
                set column-attr count
            next
            edit 6
                set header "Sandboxing Result"
                set data-binding "sandb"
                set column-attr count
            next
            edit 7
                set header "Local Overwrite"
                set data-binding "local"
                set column-attr count
            next
            edit 8
                set header "Total"
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fsa-Hourly-File-Stats-Count"
        set disp-name "FortiSandbox-FortiSandbox Hourly File Stats Count"
        set description "FortiSandbox Hourly File Stats Count"
        set dev-type FortiSandbox
        set category "FortiSandbox"
        set dataset "fsa-Hourly-File-Stats-Count"
        set chart-type table
        config table-columns
            edit 1
                set header "Hour"
                set data-binding "hrstamp"
            next
            edit 2
                set header "Static File Scan"
                set data-binding "static"
                set column-attr count
            next
            edit 3
                set header "AV Scanner"
                set data-binding "avscan"
                set column-attr count
            next
            edit 4
                set header "FSA Community Cloud"
                set data-binding "comm"
                set column-attr count
            next
            edit 5
                set header "VM Engine"
                set data-binding "vmeng"
                set column-attr count
            next
            edit 6
                set header "Sandboxing Result"
                set data-binding "sandb"
                set column-attr count
            next
            edit 7
                set header "Local Overwrite"
                set data-binding "local"
				set column-attr count
            next
            edit 8
                set header "Total"
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fsa-Scanned-File-Stats-By-Source"
        set disp-name "FortiSandbox-FortiSandbox Scanned File Stats By Source"
        set description "FortiSandbox Scanned File Stats By Source"
        set dev-type FortiSandbox
        set category "FortiSandbox"
        set dataset "fsa-Scanned-File-Stats-By-Source"
        set chart-type table
        config table-columns
            edit 1
                set header "Static File Scan"
                set data-binding "static"
                set column-attr timespan
            next
            edit 2
                set header "AV Scanner"
                set data-binding "avscan"
                set column-attr timespan
            next
            edit 3
                set header "FSA Community Cloud"
                set data-binding "comm"
                set column-attr timespan
            next
            edit 4
                set header "VM Engine"
                set data-binding "vmeng"
                set column-attr timespan
            next
            edit 5
                set header "Sandboxing Result"
                set data-binding "sandb"
                set column-attr timespan
            next
            edit 6
                set header "Local Overwrite"
                set data-binding "local"
                set column-attr timespan
            next
        end
        set protected enable
    next
    edit "fsa-Hourly-Sanned-File-Stats-By-Source"
        set disp-name "FortiSandbox-FortiSandbox Hourly Scanned File Stats By Source"
        set description "FortiSandbox Hourly Scanned File Stats By Source"
        set dev-type FortiSandbox
        set category "FortiSandbox"
        set dataset "fsa-Hourly-Sanned-File-Stats-By-Source"
        set chart-type table
        config table-columns
            edit 1
                set header "Hour"
                set data-binding "hrstamp"
            next
            edit 2
                set header "Static File Scan"
                set data-binding "static"
                set column-attr timespan
            next
            edit 3
                set header "AV Scanner"
                set data-binding "avscan"
                set column-attr timespan
            next
            edit 4
                set header "FSA Community Cloud"
                set data-binding "comm"
                set column-attr timespan
            next
            edit 5
                set header "VM Engine"
                set data-binding "vmeng"
                set column-attr timespan
            next
            edit 6
                set header "Sandboxing Result"
                set data-binding "sandb"
                set column-attr timespan
            next
            edit 7
                set header "Local Overwrite"
                set data-binding "local"
                set column-attr timespan
            next
        end
        set protected enable
    next
    edit "fsa-Top-Endpoint-by-Number-of-Malicious-File-Detected"
        set disp-name "FortiSandbox-Top Endpoints by Number of Malicious Files Detected"
        set category "FortiSandbox"
        set dev-type FortiSandbox
        set description "Top Endpoints by Number of Malicious Files Detected"
        set dataset "fsa-Top-Endpoint-by-Number-of-Malicious-File-Detected"
        set chart-type table
        config table-columns
            edit 1
                set header "Host"
                set data-binding "ep_name"
                set data-top 0
            next
            edit 2
                set header "Malicious File Count"
                set data-binding "filenum"
                set column-width 20
            next
            edit 3
                set header "OS"
                set data-binding "os_name"
                set column-width 30
            next
        end
        set protected enable
    next
    edit "fsa-Malicious-File-Detected-Timeline"
        set disp-name "FortiSandbox-Timeline for Malicious Files Detected"
        set category "FortiSandbox"
        set dev-type FortiSandbox
        set description "Timeline for Malicious Files Detected"
        set dataset "fsa-Malicious-File-Detected-by-time"
        set chart-type line
        config table-columns
            edit 1
                set data-binding "timescale"
                set column-attr time
            next
            edit 2
                set data-binding "filenum"
                set legend "Number of Files"
                set column-graph-type line-up
            next
        end
        set protected enable
    next
    edit "fsa-Malicious-File-Detected-by-Host"
        set disp-name "FortiSandbox-Top Hosts by Malicious Files Detected"
        set category "FortiSandbox"
        set dev-type FortiSandbox
        set description "Top Hosts by Malicious Files Detected"
        set dataset "fsa-Malicious-File-Detected-by-host"
        set chart-type table
        config table-columns
            edit 1
                set header "Hosts"
                set data-binding "ep_name"
                set column-width 20
            next
            edit 2
                set header "FCTUID"
                set data-binding "fctuid"
                set column-width 50
            next
            edit 3
                set header "Files"
                set data-binding "files"
                set column-width 30
            next
        end
        set protected enable
    next
    edit "fsa-Top-Email-Risk-Files"
        set disp-name "FortiSandbox-Identified Email Risk Files"
        set description "Identified Email Risk Files"
        set category "FortiSandbox"
        set dev-type FortiSandbox
        set dataset "fsa-Top-Email-Risk-Files"
        set chart-type table
        config table-columns
            edit 1
                set header "Virus"
                set data-binding "malware"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Total_Number"
                set data-binding "total_num"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fsa-Email-Risk-Rating-by-File"
        set disp-name "FortiSandbox-FortiSandbox Email Risk Rating by File"
        set description "FortiSandbox Email Risk Rating by File"
        set category "FortiSandbox"
        set dev-type FortiSandbox
        set dataset "fsa-Email-Risk-Rating-by-File"
        set chart-type table
        config table-columns
            edit 1
                set header "Malware Name"
                set data-binding "malware"
                set data-top 10
            next
            edit 2
                set header "Risk"
                set data-binding "risk"
            next
        end
        set protected enable
    next
    edit "fsa-Email-Risk-Rating-by-URL"
        set disp-name "FortiSandbox-FortiSandbox Email Risk Rating by URL"
        set description "FortiSandbox Email Risk Rating by URL"
        set category "FortiSandbox"
        set dev-type FortiSandbox
        set dataset "fsa-Email-Risk-Rating-by-URL"
        set chart-type table
        config table-columns
            edit 1
                set header "URL"
                set data-binding "url_short"
                set data-top 10
                set column-width 25
                set column-attr obf-url
            next
            edit 2
                set header "Risk"
                set data-binding "risk"
                set column-width 25
            next
            edit 3
                set header "Total Number"
                set data-binding "total_num"
                set column-span 2
                set column-graph-type bar
                set column-width 50
            next
            edit 4
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fsa-Top-Threat-Rating-Distribution"
        set disp-name "FortiSandbox-Sandbox Scanning Statistics"
        set description "Sandbox Scanning Statistics"
        set dev-type FortiSandbox
        set category "FortiSandbox"
        set dataset "threat-rating-distribution"
        set chart-type table
        config table-columns
            edit 1
                set header "Risk"
                set data-binding "risk"
                set data-top 10
            next
            edit 2
                set header "Events (Count)"
                set data-binding "total_num"
                set column-attr count
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "fsa-Top-Targeted-Hosts"
        set disp-name "FortiSandbox-Top Sandbox Hosts"
        set description "Top Sandbox Hosts"
        set dev-type FortiSandbox
        set category "FortiSandbox"
        set dataset "fsa-targeted-hosts"
        set chart-type table
        config table-columns
            edit 1
                set header "Destination IP"
                set data-binding "dstip"
                set data-top 10
            next
            edit 2
                set header "Events (Count)"
                set data-binding "total_num"
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "fsa-Scan-Stats-of-Malware-by-Name"
        set disp-name "FortiSandbox-Top Sandbox Malware"
        set description "Top Sandbox Malware"
        set dev-type FortiSandbox
        set category "FortiSandbox"
        set dataset "fsa-scan-stats-of-malware-by-name"
        set chart-type table
        config table-columns
            edit 1
                set header "Malware"
                set data-binding "mname"
                set data-top 10
            next
            edit 2
                set header "Events (Count)"
                set data-binding "total_num"
                set column-attr count
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "fsa-Known-Malware-Detected"
        set disp-name "FortiSandbox-FortiSandbox Known Malware Detected"
        set description "FortiSandbox Known Malware Detected"
        set dev-type FortiSandbox
        set category "FortiSandbox"
        set dataset "fsa-Known-Malware-Detected"
        set chart-type table
        config table-columns
            edit 1
                set header "Malware"
                set data-binding "mname"
                set data-top 5
                set column-width 30
            next
            edit 2
                set header "File"
                set data-binding "fname"
                set column-width 35
            next
            edit 3
                set header "Protocol"
                set data-binding "proto"
            next
            edit 4
                set header "Severity"
                set data-binding "risk_num"
                set column-attr severity
                set column-span 2
            next
            edit 5
                set header "Risk"
                set data-binding "risk"
            next
            edit 6
                set header "Count"
                set data-binding "count_of"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fsa-Unknown-Malware-Detected"
        set disp-name "FortiSandbox-FortiSandbox Unknown Malware Detected"
        set description "FortiSandbox Unknown Malware Detected"
        set dev-type FortiSandbox
        set category "FortiSandbox"
        set dataset "fsa-Unknown-Malware-Detected"
        set chart-type table
        config table-columns
            edit 1
                set header "sha256"
                set data-binding "sha256"
                set column-width 35
                set data-top 5
            next
            edit 2
                set header "File"
                set data-binding "fname"
                set column-width 30
            next
            edit 3
                set header "Protocol"
                set data-binding "proto"
            next
            edit 4
                set header "Severity"
                set data-binding "risk_num"
                set column-attr severity
                set column-span 2
            next
            edit 5
                set header "Risk"
                set data-binding "risk"
            next
            edit 6
                set header "Count"
                set data-binding "count_of"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fsa-Malware-Disposition-Breakdown"
        set disp-name "FortiSandbox-FortiSandbox Malware Disposition Breakdown"
        set description "FortiSandbox Malware Disposition Breakdown"
        set dev-type FortiSandbox
        set category "FortiSandbox"
        set dataset "fsa-Malware-Disposition-Breakdown"
        set chart-type donut
        set chart-style "{\"size\": \"medium\", \"legend-position\": \"right\", \"inner-content\": \"summary-value\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set header "Risk"
                set data-binding "risk"
                set data-top 5
            next
            edit 2
                set header "Count"
                set data-type aggregate
                set data-binding "count_of"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fsa-Sandbox-Processing-Donut"
        set disp-name "FortiSandbox-FortiSandbox Sandbox Processing Donut"
        set dev-type FortiSandbox
        set category "FortiSandbox"
        set description "FortiSandbox Sandbox Processing Donut"
        set dataset "fsa-Sandbox-Processing-bar"
        set chart-type donut
        set chart-style "{\"size\": \"big\", \"legend-position\": \"right\", \"inner-content\": \"summary-value\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set header "Risk"
                set data-binding "risk"
                set data-top 20
            next
            edit 2
                set header "Count"
                set data-type aggregate
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fsa-Sandbox-Processing-bar"
        set disp-name "FortiSandbox-FortiSandbox Sandbox Processing Bar"
        set dev-type FortiSandbox
        set category "FortiSandbox"
        set description "FortiSandbox Sandbox Processing Bar"
        set dataset "fsa-Sandbox-Processing-bar"
        set chart-type bar
        config table-columns
            edit 1
                set header "Risk"
                set data-binding "risk"
                set data-top 20
            next
            edit 2
                set header "Count"
                set data-type aggregate
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fsa-Count-of-Filetypes-Including-Other"
        set disp-name "FortiSandbox-FortiSandbox Count of Filetypes Including Other"
        set description "FortiSandbox Count of Filetypes Including Other"
        set dev-type FortiSandbox
         set category "FortiSandbox"
        set dataset "fsa-Count-of-Filetypes-Including-Other"
        set chart-type donut
        set chart-style "{\"size\": \"medium\", \"legend-position\": \"right\", \"inner-content\": \"summary-value\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set header "File Type"
                set data-binding "ftype"
                set data-top 5
            next
            edit 2
                set header "Count"
                set data-type aggregate
                set data-binding "count_of"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fsa-Filetype-Breakout-Malware"
        set disp-name "FortiSandbox-FortiSandbox Filetype Breakout Malware"
        set description "FortiSandbox Filetype Breakout Malware"
        set dev-type FortiSandbox
         set category "FortiSandbox"
        set dataset "fsa-Filetype-Breakout-Malware"
        set chart-type donut
        set chart-style "{\"size\": \"medium\", \"legend-position\": \"right\", \"inner-content\": \"summary-value\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set header "File Type"
                set data-binding "ftype"
                set data-top 5
            next
            edit 2
                set header "Count"
                set data-type aggregate
                set data-binding "count_of"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fsa-Compressed-File-Analysis"
        set disp-name "FortiSandbox-FortiSandbox Compressed File Analysis"
        set description "FortiSandbox Compressed File Analysis"
        set dev-type FortiSandbox
         set category "FortiSandbox"
        set dataset "fsa-Compressed-File-Analysis"
        set chart-type donut
        set chart-style "{\"size\": \"medium\", \"legend-position\": \"right\", \"inner-content\": \"summary-value\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set header "risk"
                set data-binding "risk"
            next
            edit 2
                set header "count_of"
                set data-type aggregate
                set data-binding "count_of"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fsa-Files-Scanned-per-Day-and-Hour"
        set disp-name "FortiSandbox-FortiSandbox Files Scanned per Day and Hour"
        set description "FortiSandbox Files Scanned per Day and Hour"
        set dev-type FortiSandbox
        set category "FortiSandbox"
        set dataset "fsa-Files-Scanned-per-Day-and-Hour"
        set chart-style "{\"time-display\": \"hour-only\", \"colormap\":[\"#fad7a0\", \"#f8c471\", \"#f5b041\", \"#f39c12\", \"#d68910\", \"#b9770e\"] }"
        set chart-type heatmap
        set hidden enable
        config table-columns
            edit 1
                set header "Hours"
                set data-binding "hourstamp"
                set column-attr time
                set data-top 0
            next
            edit 2
                set column-attr none
                set data-binding "daystamp"
                set data-type drilldown
            next
            edit 3
                set header "cnt"
                set data-binding "cnt"
                set column-graph-type line-up
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fsa-avg-Scantime-per-Filetype"
        set disp-name "FortiSandbox-FortiSandbox Average Scantime per Filetype"
        set description "FortiSandbox Average Scantime per Filetype"
        set dev-type FortiSandbox
        set category "FortiSandbox"
        set dataset "fsa-avg-Scantime-per-Filetype"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\", \"bar-size\": \"small\"}"
        set include-other disable
        config table-columns
            edit 1
                set header ""
                set data-binding "ftype"
                set data-top 10
            next
            edit 2
                set header ""
                set data-binding "avg_scantime"
                set data-type aggregate
                set column-attr timespan
            next
        end
    next
    edit "fsa-Targeted-Hosts-Lastseen"
        set disp-name "FortiSandbox-FortiSandbox Lastseen Targeted Hosts"
        set description "FortiSandbox Lastseen Targeted Hosts"
        set dev-type FortiSandbox
        set category "FortiSandbox"
        set dataset "fsa-Targeted-Hosts-Lastseen"
        set chart-type table
        config table-columns
            edit 1
                set header "Hosts"
                set data-binding "dstip"
                set data-top 5
            next
            edit 2
                set header "Last Detected"
                set data-binding "last_seen"
            next
            edit 3
                set header "Targets"
                set data-binding "total_num"
                set column-attr count
            next
        end
    set protected enable
    next
    edit "fsa-Command-and-Control-Callbacks-Count"
        set disp-name "FortiSandbox-FortiSandbox Command and Control Callbacks Count"
        set category "FortiSandbox"
        set dev-type FortiSandbox
        set description "FortiSandbox Command and Control Callbacks Count"
        set dataset "fsa-Command-and-Control-Callbacks-Count"
        set chart-type table
        config table-columns
            edit 1
                set header "Malware"
                set data-binding "mcate"
                set data-top 10
            next
            edit 2
                set header "Count"
                set column-span 2
                set column-graph-type bar
                set data-binding "total_num"
                set column-attr count
            next
            edit 3
                set data-binding "total_num"
                set column-attr count
            next
        end
       set protected enable
    next
    edit "fsa-Max-Hourly-Files-Processed"
        set disp-name "FortiSandbox-FortiSandbox Max Hourly Files Processed"
        set category "FortiSandbox"
        set dev-type FortiSandbox
        set description "FortiSandbox Max Hourly Files Processed"
        set dataset "fsa-Max-Hourly-Files-Processed"
        set chart-type table
        config table-columns
            edit 1
                set header "Hour"
                set data-binding "hour_stamp"
                set data-top 1
            next
            edit 2
                set column-span 2
                set data-binding "count_of"
                set column-graph-type bar
                set column-width 50
            next
            edit 3
                set header "Count"
                set data-binding "count_of"
                set column-attr count
            next
        end
       set protected enable
    next
    edit "fsa-Most-Frequent-Malware-Category"
        set disp-name "FortiSandbox-FortiSandbox Most Frequent Malware Category"
        set category "FortiSandbox"
        set dev-type FortiSandbox
        set description "FortiSandbox Most Frequent Malware Category"
        set dataset "fsa-Most-Frequent-Malware-Category"
        set chart-type table
        set include-other disable
        config table-columns
            edit 1
                set header "Malware Category"
                set data-binding "mcate"
                set data-top 1
            next
            edit 2
                set header "Count"
                set data-binding "total_num"
                set column-attr count
            next
        end
       set protected enable
    next
    edit "fsa-Most-Frequent-CallbackIP-Domain"
        set disp-name "FortiSandbox-FortiSandbox Most Frequent Callback IP Domain"
        set category "FortiSandbox"
        set dev-type FortiSandbox
        set description "FortiSandbox Most Frequent Callback IP Domain"
        set dataset "fsa-Most-Frequent-CallbackIP-Domain"
        set chart-type table
        set include-other disable
        config table-columns
            edit 1
                set header "Hosts"
                set data-binding "dstip"
                set data-top 1
            next
            edit 2
                set header "Last Detected"
                set data-binding "last_seen"
            next
            edit 3
                set header "Count"
                set data-binding "total_num"
                set column-attr count
            next
        end
       set protected enable
    next
    edit "fsa-Callback-Destinations"
        set disp-name "FortiSandbox-FortiSandbox Callback Destinations"
        set category "FortiSandbox"
        set dev-type FortiSandbox
        set description "FortiSandbox Callback Destinations"
        set dataset "fsa-Callback-Destinations"
        set chart-type table
        config table-columns
            edit 1
                set header "Hosts"
                set data-binding "callback_ip_domain"
                set data-top 10
            next
            edit 2
                set header "Count"
                set data-type aggregate
                set data-binding "attempts"
                set column-attr count
            next
        end
       set protected enable
    next
    edit "fsa-Sandbox-Threat-Detection-Processing"
        set disp-name "FortiSandbox-FortiSandbox Threat Detection Processing"
        set category "FortiSandbox"
        set dev-type FortiSandbox
        set description "FortiSandbox Threat Detection Processing"
        set dataset "fsa-Sandbox-Threat-Detection-Processing"
        set chart-type table
        config table-columns
            edit 1
                set header "Processed By"
                set data-binding "rsrc"
                set data-top 10
            next
            edit 2
                set header "Source Type"
                set data-type drilldown
                set data-binding "src_type"
            next
            edit 3
                set header "Severity"
                set data-type drilldown
                set data-binding "risk"
            next
            edit 4
                set header "Count"
                set data-type aggregate
                set data-binding "count_of"
                set column-attr count
            next
        end
       set protected enable
    next
    edit "fsa-Sandbox-Processing-Cluster-Bar"
        set disp-name "FortiSandbox-FortiSandbox Processing Cluster Bar"
        set category "FortiSandbox"
        set dev-type FortiSandbox
        set description "FortiSandbox Processing Cluster Bar"
        set dataset "fsa-Sandbox-Threat-Detection-Processing"
        set chart-type bar
        set chart-style "{\"cluster-chart\":\"enable\"}"
        config table-columns
            edit 1
                set header "Processed By"
                set data-binding "rsrc"
                set data-top 50
            next
            edit 2
                set header "Source Type"
                set data-type drilldown
                set data-binding "src_type"
                set data-top 2
            next
            edit 3
                set header "Count"
                set data-type aggregate
                set data-binding "count_of"
                set column-attr count
            next
        end
       set protected enable
    next
    edit "fsa-Peak-Daily-Total-Scan-Time"
        set disp-name "FortiSandbox-FortiSandbox Peak Compute Hours Per Day"
        set category "FortiSandbox"
        set dev-type FortiSandbox
        set description "FortiSandbox Peak Compute Hours Per Day"
        set dataset "fsa-Peak-Daily-Total-Scan-Time"
        set chart-type table
        config table-columns
            edit 1
                set header "Hours"
                set data-binding "peak_comp_hours"
                set data-top 10
            next
        end
       set protected enable
    next
end


config sql-report macro

    edit "fsa-Total-Number-of-Files-Submitted"
        set disp-name "FortiSandbox-Total Number of Files Submitted to Sandbox"
        set dev-type FortiSandbox
        set description "Total Number of Files Submitted to Sandbox"
        set dataset "fsa-Totalnum-Files-Submitted-to-Sandbox"
        set data-binding "totalnum"
        set protected enable
    next

    edit "fsa-Total-Number-of-Hosts-Affected"
        set disp-name "FortiSandbox-Total Number of Hosts Affected"
        set dev-type FortiSandbox
        set description "Total Number of Hosts Affected"
        set dataset "fsa-Totalnum-of-Hosts-Affected"
        set data-binding "totalnum"
        set protected enable
    next
    edit "fsa-Total-New-Email-Malware"
        set disp-name "FortiSandbox-FSA Number of New Email Malware"
        set description "FSA Number of New Email Malware"
        set dev-type FortiSandbox
        set dataset "fsa-Total-New-Email-Malware"
        set data-binding "total_new"
        set data-attr count
        set protected enable
    next
    edit "fsa-Count-of-Known-Malware-Detected"
        set disp-name "FortiSandbox-FortiSandbox Count of Known Malware Detected"
        set description "FortiSandbox Count of Known Malware Detected"
        set dev-type FortiSandbox
        set dataset "fsa-Count-of-Known-Malware-Detected"
        set data-binding "count"
        set data-attr count
        set protected enable
    next
    edit "fsa-Count-of-Unknown-Malware-Detected"
        set disp-name "FortiSandbox-FortiSandbox Count of Unknown Malware Detected"
        set description "FortiSandbox Count of Unknown Malware Detected"
        set dev-type FortiSandbox
        set dataset "fsa-Count-of-Unknown-Malware-Detected"
        set data-binding "count"
        set data-attr count
        set protected enable
    next
    edit "fsa-Count-of-Total-Files-Scanned"
        set disp-name "FortiSandbox-FortiSandbox Count of Total Files Scanned"
        set description "FortiSandbox Count of Total Files Scanned"
        set dev-type FortiSandbox
        set dataset "fsa-Count-of-Total-Files-Scanned"
        set data-binding "total_num"
        set data-attr count
        set protected enable
    next
    edit "fsa-Count-of-Unique-Filetypes-Found"
        set disp-name "FortiSandbox-FortiSandbox Count of Unique Filetypes Found"
        set description "FortiSandbox Count of Unique Filetypes Found"
        set dev-type FortiSandbox
        set dataset "fsa-Count-of-Unique-Filetypes-Found"
        set data-binding "Unique File Types"
        set data-attr count
        set protected enable
    next
    edit "fsa-Files-Detected-Are-Executables"
        set disp-name "FortiSandbox-FortiSandbox Files Detected Are Executables"
        set description "FortiSandbox Files Detected Are Executables"
        set dev-type FortiSandbox
        set dataset "fsa-Files-Detected-Are-Executables"
        set data-binding "total_num"
        set data-attr count
        set protected enable
    next
    edit "fsa-Average-Scan-Time-Per-File"
        set disp-name "FortiSandbox-FortiSandbox Average Scan Time Per File"
        set description "FortiSandbox Average Scan Time Per File"
        set dev-type FortiSandbox
        set dataset "fsa-Average-Scan-Time-Per-File"
        set data-binding "scantime_avg"
        set data-attr count
        set protected enable
    next
    edit "fsa-Files-Processed-Per-Hour"
        set disp-name "FortiSandbox-FortiSandbox Files Processed Per Hour"
        set description "FortiSandbox Files Processed Per Hour"
        set dev-type FortiSandbox
        set dataset "fsa-Files-Processed-Per-Hour"
        set data-binding "files_processed_per_hour"
        set data-attr count
        set protected enable
    next
    edit "fsa-Peak-Compute-Hours-Per-Day"
        set disp-name "FortiSandbox-FortiSandbox Peak Compute Hours Per Day"
        set description "FortiSandbox Peak Compute Hours Per Day"
        set dev-type FortiSandbox
        set dataset "fsa-Peak-Daily-Total-Scan-Time"
        set data-binding "peak_comp_hours"
        set protected enable
    next
    edit "fsa-Count-of-Files-Are-Archived-Compressed"
        set disp-name "FortiSandbox-FortiSandbox Count of Files Are Archived Compressed"
        set description "FortiSandbox Count of Files Are Archived Compressed"
        set dev-type FortiSandbox
        set dataset "fsa-Count-of-Files-Are-Archived-Compressed"
        set data-binding "total_num"
        set data-attr count
        set protected enable
    next
    edit "fsa-Count-of-Files-Are-Macro-Enabled"
        set disp-name "FortiSandbox-FortiSandbox Count of Files Are Macro Enabled"
        set description "FortiSandbox Count of Files Are Macro Enabled"
        set dev-type FortiSandbox
        set dataset "fsa-Count-of-Files-Are-Macro-Enabled"
        set data-binding "total_num"
        set data-attr count
        set protected enable
    next
    edit "fsa-avg-Scantime-Per-Clean-File"
        set disp-name "FortiSandbox-FortiSandbox Average Scantime Per Clean File"
        set description "FortiSandbox Average Scantime Per Clean File"
        set dev-type FortiSandbox
        set dataset "fsa-avg-Scantime-Per-Clean-File"
        set data-binding "scan_avg"
        set data-attr count
        set protected enable
    next
    edit "fsa-avg-Scantime-Per-Malicious-File"
        set disp-name "FortiSandbox-FortiSandbox Average Scantime Per Malicious File"
        set description "FortiSandbox Average Scantime Per Malicious File"
        set dev-type FortiSandbox
        set dataset "fsa-avg-Scantime-Per-Malicious-File"
        set data-binding "scan_avg"
        set data-attr count
        set protected enable
    next
    edit "fsa-Most-Popular-Filetype-count"
        set disp-name "FortiSandbox-FortiSandbox Most Popular Filetype Count"
        set description "FortiSandbox Most Popular Filetype Count"
        set dev-type FortiSandbox
        set dataset "fsa-Most-Popular-Filetype"
        set data-binding "ftype"
        set protected enable
    next
    edit "fsa-Most-Frequent-Attack-Victim"
        set disp-name "FortiSandbox-FortiSandbox Most Frequent Attack Victim"
        set description "FortiSandbox Most Frequent Attack Victim"
        set dev-type FortiSandbox
        set dataset "fsa-Most-Frequent-Attack-Victim"
        set data-binding "dstip"
        set protected enable
    next
    edit "fsa-Max-Hourly-Files-Processed-Hour"
        set disp-name "FortiSandbox-FortiSandbox Max Hourly Files Processed Hour"
        set description "FortiSandbox Max Hourly Files Processed Hour"
        set dev-type FortiSandbox
        set dataset "fsa-Max-Hourly-Files-Processed"
        set data-binding "hour_stamp"
        set protected enable
    next
    edit "fsa-Max-Hourly-Files-Processed-Count"
        set disp-name "FortiSandbox-FortiSandbox Max Hourly Files Processed Count"
        set description "FortiSandbox Max Hourly Files Processed Count"
        set dev-type FortiSandbox
        set dataset "fsa-Max-Hourly-Files-Processed"
        set data-binding "count_of"
        set data-attr count
        set protected enable
    next
end



config sql-report layout
    edit 1000079001
        set is-template enable
        set dev-type FortiSandbox
        set category "FortiSandbox"
        set title "Template - FortiSandbox Default Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Threat rating distribution, job severity timeline, malware severity of targeted hosts, top 20 targeted hosts, top 20 malware, top 50 file type and brief job list"
        set body "<h1>FortiSandbox - File Submission Information</h1><p>&nbsp;</p><p><strong>The following charts show the file type details submitted to FortiSandbox.</strong></p><fazchart mkey=\"fsa-File-Type-Summary-With-VM-Source\" title=\"FortiSandbox-File Type Summary Submitted to FSA by VM Module\" width=\"100%\"></fazchart><p>&nbsp;</p><fazchart mkey=\"fsa-File-Type-Details-With-VM-Source\" title=\"FortiSandbox-File Type Breakdown Submitted to FSA by VM Module\" width=\"100%\"></fazchart><p>&nbsp;</p><fazchart mkey=\"fsa-File-Type-Summary\" title=\"FortiSandbox-File Type Summary Submitted to FSA\" width=\"100%\"></fazchart><p>&nbsp;</p><fazchart mkey=\"fsa-File-Type-Details\" title=\"FortiSandbox-File Type Breakdown Submitted to FSA\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>FortiSandbox - File Scan Statistics</h1><p><br /><strong>The following graph displays the number of Malicious events, and other events by Risk Level.</strong></p><fazchart mkey=\"Threat-Rating-Distribution\" title=\"{default}\" width=\"100%\"></fazchart><p>&nbsp;</p><p><strong>The following graph displays the number of Malicious events, and other events by Risk Level.</strong></p><fazchart mkey=\"Job-Severity-Timeline\" title=\"{default}\" width=\"100%\"></fazchart><p><strong>The following table shows the Top 50 file types identified.</strong></p><fazchart mkey=\"FSA-File-Type\" title=\"{default}\" width=\"100%\"></fazchart><p>&nbsp;</p><p><strong>The following shows the Top 20 Hosts that have been targeted by Malware.</strong></p><fazchart mkey=\"FSA-Targeted-Hosts\" title=\"{default}\" width=\"100%\"></fazchart><p>&nbsp;</p><p><strong>The following graph displays the Severity of Malware events detected on Targeted Hosts.</strong></p><fazchart mkey=\"Malware-Severity-of-Targeted-Hosts\" title=\"{default}\" width=\"100%\"></fazchart><p><br /><strong>The following graph shows the Top 20 Malware detected.</strong></p><fazchart mkey=\"FSA-Malware-Count-By-Name\" title=\"{default}\" width=\"100%\"></fazchart><p><strong>The following tables contains the list of job names by count.</strong></p><fazchart mkey=\"Brief-Job-List\" title=\"FortiSandbox-FSA Brief Job List\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>FortiSandbox - Performance Statistics</h1><p><strong>The following charts show the Threat Rating Destribution by&nbsp;VM Host Module.</strong></p><fazchart mkey=\"fsa-File-Source-Stats-Donut\" title=\"FortiSandbox-Threat Rating Summary by VM Module\" width=\"100%\"></fazchart><p>&nbsp;</p><fazchart mkey=\"fsa-File-Source-Stats-Table\" title=\"FortiSandbox-Threat Rating Breakdown by VM Module \" width=\"100%\"></fazchart><p>&nbsp;</p><fazchart mkey=\"fsa-File-Type-Stats\" title=\"Threat Rating Breakdown by File Type and VM Module\" width=\"100%\"></fazchart><p>&nbsp;</p><fazchart mkey=\"fsa-Hourly-File-Stats-Count\" title=\"Threat Rating Breakdown by Time and VM Module\" width=\"100%\"></fazchart><p>&nbsp;</p><fazchart mkey=\"fsa-Scanned-File-Stats-By-Source\" title=\"Average Threat Rating Duration by VM Module\" width=\"100%\"></fazchart><div><p>&nbsp;</p><fazchart mkey=\"fsa-Hourly-Sanned-File-Stats-By-Source\" title=\"Average Threat Rating Duration by Time and VM Module\" width=\"100%\"></fazchart><p>&nbsp;</p></div>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90108
                next
            end
        set protected enable
    next
    edit 1000079002
        set is-template enable
        set dev-type FortiSandbox
        set category "FortiSandbox"
        set title "Template - Endpoint Sandbox Detections Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Endpoint report showing the APT threats deteted by sandbox"
        set body "<h1>Summary</h1><p>Fortinet Advanced Threat Protection relies on multiple types of security technologies, products, and research applied from the network edge through to endpoint devices. To deliver the most effective protection, they are integrated to work together automatically, continuously handing off data from one to the next to identify, evaluate and respond to attacks.</p><p>FortiSandbox, together with FortiClient, provides Advanced Threat Protection to identify and help customers thwart the highly targeted and tailored attacks that increasingly bypass traditional defenses and lurk within networks.</p><p>&nbsp;</p><tr><td style=\"width:352px\"><span style=\"font-size:14px\"><strong>Total Files Submiited to Sandbox:</strong>&nbsp;<fazmacro mkey=\"fsa-Total-Number-of-Files-Submitted\"></fazmacro></span></td></tr><p>&nbsp;</p><tr><td style=\"width:352px\"><span style=\"font-size:14px\"><strong>Total Number of Hosts Affected:</strong>&nbsp;<fazmacro mkey=\"fsa-Total-Number-of-Hosts-Affected\"></fazmacro></span></td></tr><p>&nbsp;</p><h2>Endpoints by Malicious File Count</h2><p>The following are endpoints detected by sandbox.</p><fazchart mkey=\"fsa-Top-Endpoint-by-Number-of-Malicious-File-Detected\" title=\" \" width=\"100%\"></fazchart><p>&nbsp;</p><h1>Malicious Files Detected</h1><fazchart mkey=\"fsa-Malicious-File-Detected-Timeline\" title=\"Malicious File Detections within Current Time Range\" width=\"100%\"></fazchart><p>&nbsp;</p><fazchart mkey=\"fsa-Malicious-File-Detected-by-Host\" title=\"Malicious Files Detected by Hosts\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90108
                next
                edit 90202
                next
            end
        set protected enable
    next
    edit 1000079003
        set is-template enable
        set dev-type FortiSandbox
        set category "FortiSandbox"
        set title "Template - FortiSandbox CTAP Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "FortiSandbox CTAP Report"
        set body "<h1><strong>Executive Summary</strong></h1><p>The assessment report provides organizations a snapshot of their current security posture based on known and unknown malware found in the network. Through the use of sandboxing, organizations can better understand the benefits of using sandbox to uncover potential vulnerabilities in their security architecture and polices, and review the details of these threats.</p><h2><strong>Security</strong></h2><table border=\"0\" cellspacing=\"4\" cellpadding=\"1\" align=\"center\" style=\"height:140px; width:720px\"><tbody><tr><td style=\"width:110px\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/icons_Known_Malware_detected.png\" style=\"height:100px; width:100px\" /></td><td style=\"width:250px\"><p><span style=\"font-size:24px\"><strong><fazmacro mkey=\"fsa-Count-of-Known-Malware-Detected\"></fazmacro></strong></span></p><p><span style=\"font-size:14px; text-align:left\">Known Malware Detected</span></p></td><td style=\"width:110px\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/icons_Unknown_Malware_detected.png\" style=\"height:100px; width:100px\" /></td><td style=\"width:250px\"><p><span style=\"font-size:24px\"><strong><fazmacro mkey=\"fsa-Count-of-Unknown-Malware-Detected\"></fazmacro></strong></span></p><p><span style=\"font-size:14px; text-align:left\">Unknown Malware Detected</span></p></td></tr></tbody></table><p>Security Summary: As part of your security strategy, protecting against known and unknown malware is critical to reducing risks. In-place security controls are designed to block known malware while sandboxing complements these controls to block unknown malware. Also critical is to uncover any callbacks as a signal to an active or impending threat campaign.</p><p>Additional details are found in Security section below.</p><h2><strong>File Analysis</strong></h2><table border=\"0\" cellspacing=\"4\" cellpadding=\"1\" align=\"center\" style=\"height:140px; width:720px\"><tbody><tr><td style=\"text-align:left; width:110px\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/icons_Total_files_scanned.png\" style=\"height:100px; width:100px\" /></td><td style=\"height:70px; vertical-align:top; width:160px\"><p><span style=\"font-size:24px\"><strong><fazmacro mkey=\"fsa-Count-of-Total-Files-Scanned\"></fazmacro></strong></span></p><p style=\"text-align:left\"><span style=\"font-size:14px; text-align:left\">Total Files Scanned</span></p></td><td style=\"text-align:left; width:110px\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/icons_unique_filetypes_found.png\" style=\"height:100px; width:100px\" /></td><td style=\"text-align:left; vertical-align:top; width:160px\"><p><span style=\"font-size:24px\"><strong><fazmacro mkey=\"fsa-Count-of-Unique-Filetypes-Found\"></fazmacro></strong></span></p><p style=\"text-align:left\"><span style=\"font-size:14px; text-align:left\">Unique Filetypes Found</span></p></td><td style=\"text-align:left; width:110px\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/icons_files_detected_executables.png\" style=\"height:100px; width:100px\" /></td><td style=\"text-align:left; vertical-align:top; width:160px\"><p><span style=\"font-size:24px\"><strong><fazmacro mkey=\"fsa-Files-Detected-Are-Executables\"></fazmacro></strong></span></p><p style=\"text-align:left\"><span style=\"font-size:14px; text-align:left\">Files Detected are Executable</span></p></td></tr></tbody></table><p>Based on the number of files submitted for sandboxing, you will be provided intelligence on the various file types including those that are potentially risky found in your organization. This visibility serves as an opportunity for organizations to fine-tune application policies as part of early preventive controls.</p><p>Additional details are found in File Analysis section below.</p><h2><strong>Performance</strong></h2><table border=\"0\" align=\"center\" cellspacing=\"4\" cellpadding=\"1\" style=\"height:140px; width:720px\"><tbody><tr><td style=\"width:110px\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/icons_faverage_scan_time_per_file_copy.png\" style=\"height:100px; width:100px\" /></td><td style=\"text-align:left; vertical-align:top; width:160px\"><p><span style=\"font-size:24px\"><strong><fazmacro mkey=\"fsa-Average-Scan-Time-Per-File\"></fazmacro></strong></span><span style=\"font-size:14px\">s</span></p><p style=\"text-align:left\"><span style=\"font-size:14px; text-align:left\">Average Scan Time Per File</span></p></td><td style=\"width:110px\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/icons_files_processed_per_hour.png\" style=\"height:100px; width:100px\" /></td><td style=\"text-align:left; vertical-align:top; width:160px\"><p><span style=\"font-size:24px\"><strong><fazmacro mkey=\"fsa-Files-Processed-Per-Hour\"></fazmacro></strong></span></p><p style=\"text-align:left\"><span style=\"font-size:14px; text-align:left\">Files Processed Per Hour</span></p></td><td style=\"width:110px\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/icons_Peak_compute_hours.png\" style=\"height:100px; width:100px\" /></td><td style=\"text-align:left; vertical-align:top; width:160px\"><p><span style=\"font-size:24px\"><strong><fazmacro mkey=\"fsa-Max-Hourly-Files-Processed-Count\"></fazmacro></strong></span></p><p style=\"text-align:left\"><span style=\"font-size:14px; text-align:left\">Files Processed in Peak Hour</span></p></td></tr></tbody></table><p>Besides detecting threats, it is important to deploy a scalable sandboxing solution so there is minimal impact to the threat detection and response during peak periods. Analysis that are AI-powered combined with a powerful pre-filter engine will reduce the number of files requiring detonation.</p><p>Additional details are found in Performance section below.</p><div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1><strong>Security</strong></h1></div><table border=\"0\" align=\"center\" cellspacing=\"1\" cellpadding=\"1\" style=\"line-height:1.2; width:740px\"><tbody><tr><td style=\"text-align:center; vertical-align:top; width:80px\"><p style=\"text-align:center\">Quick Stats<img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/stats.png\" style=\"height:70px; width:70px\" /></p></td><td style=\"text-align:left; vertical-align:top; width:330px\"><ul><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"fsa-Count-of-Known-Malware-Detected\"></fazmacro></strong>&nbsp;known malware detected</span></li><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"fsa-Count-of-Unknown-Malware-Detected\"></fazmacro></strong>&nbsp;unknown malware detected</span></li><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"fsa-Most-Frequent-Attack-Victim\"></fazmacro></strong>most frequent attack victim</span></li></ul></td><td style=\"text-align:left; vertical-align:top; width:330px\">&nbsp;</td></tr></tbody></table><h2><strong>Command and Control Callbacks</strong></h2><fazchart mkey=\"fsa-Command-and-Control-Callbacks-Count\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><h2><strong>Most Frequent Malware Category</strong></h2><fazchart mkey=\"fsa-Most-Frequent-Malware-Category\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><h2><strong>Most Frequent Callback IP Domain</strong></h2><fazchart mkey=\"fsa-Most-Frequent-CallbackIP-Domain\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><h2><strong>Callback Destinations</strong></h2><fazchart mkey=\"fsa-Callback-Destinations\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><h2><strong>Top 5 Known Malware Detected</strong></h2><p>Known malware are threats that have been analyzed prior and its characteristics are considered to be malicious. Below is a list of known malware detected by Sandbox pre-filter stage including AI-powered static analysis.</p><fazchart mkey=\"fsa-Known-Malware-Detected\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><h2><strong>Top 5 Unknown Malware Detected</strong></h2><p>Unknown malware are threats that uses new malware techniques or 0-day exploits designed to bypass traditional detection engines. Below is a list of unknown malware detected by Sandbox AI-powered dynamic analysis.</p><fazchart mkey=\"fsa-Unknown-Malware-Detected\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><table border=\"0\" align=\"center\" cellspacing=\"2\" cellpadding=\"1\" style=\"height:200px; width:730px\"><tbody><tr><td style=\"text-align:justify; vertical-align:top; width:360px\"><h2><strong>Malware Disposition Breakdown</strong></h2><p>Characteristics of a malware vary greatly on it&#39;s impact to a user or an organization. This distribution breaks down on the severity of malware seen in your organization.</p></td><td style=\"width:10px\">&nbsp;</td><td style=\"text-align:center; vertical-align:top; width:360px\"><fazchart mkey=\"fsa-Malware-Disposition-Breakdown\" title=\"\" width=\"350px\"></fazchart></td></tr></tbody></table><p>&nbsp;</p><h2><strong>Top 5 Targeted Hosts</strong></h2><p>The ultimate destination of an attack typically lands on a host(s) within an organization thus uncovering these vulnerable host is critical to prioritize proper mitigation and to close these security gaps. Below is a list of suspected destination hosts with associated malware as uncovered during sandbox AI-powered dynamic analysis.</p><fazchart mkey=\"fsa-Targeted-Hosts-Lastseen\" title=\"\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1><strong>File Analysis</strong></h1><table border=\"0\" align=\"center\" cellspacing=\"1\" cellpadding=\"1\" style=\"line-height:1.2; width:740px\"><tbody><tr><td style=\"text-align:center; vertical-align:top; width:80px\"><p style=\"text-align:center\">Quick Stats<img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/stats.png\" style=\"height:70px; width:70px\" /></p></td><td style=\"text-align:left; vertical-align:top; width:330px\"><ul><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"fsa-Count-of-Total-Files-Scanned\"></fazmacro></strong>&nbsp;total files scanned</span></li><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"fsa-Count-of-Unique-Filetypes-Found\"></fazmacro></strong>&nbsp;unique filetypes found</span></li><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"fsa-Most-Popular-Filetype-count\"></fazmacro></strong>&nbsp;most popular filetype</span></li></ul></td><td style=\"text-align:left; vertical-align:top; width:330px\"><ul><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"fsa-Count-of-Files-Are-Archived-Compressed\"></fazmacro></strong>of files are archives/compressed</span></li><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"fsa-Count-of-Files-Are-Macro-Enabled\"></fazmacro></strong>of files are macro enabled</span></li><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"fsa-Files-Detected-Are-Executables\"></fazmacro></strong>&nbsp;of files are executable</span></li></ul></td></tr></tbody></table><h2><strong>Threat Detection Processing</strong></h2><fazchart mkey=\"fsa-Sandbox-Threat-Detection-Processing\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><fazchart mkey=\"fsa-Sandbox-Processing-Cluster-Bar\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><h2><strong>Total Files Scanned Clean to Malicious</strong></h2><p>The chart following shows the total files scanned by FortiSandbox for the selected time period.</p><fazchart mkey=\"fsa-Sandbox-Processing-Donut\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><p>&nbsp;</p><table border=\"0\" cellspacing=\"1\" cellpadding=\"1\" style=\"width:730px\"><tbody><tr><td style=\"vertical-align:top; width:360px\"><h2><strong>Filetype Breakout (Overall)</strong></h2><p>Each organization have their own unique environment when it comes to the composition of file transactions. The pie-chart breaks down the various file types processed by the sandbox.</p><p>&nbsp;</p></td><td style=\"width:10px\">&nbsp;</td><td style=\"vertical-align:middle; width:360px\"><fazchart mkey=\"fsa-Count-of-Filetypes-Including-Other\" title=\"\" width=\"350px\"></fazchart><p>&nbsp;</p><p>&nbsp;</p></td></tr><tr><td><fazchart mkey=\"fsa-Filetype-Breakout-Malware\" title=\"\" width=\"350px\"></fazchart><p>&nbsp;</p><p>&nbsp;</p></td><td>&nbsp;</td><td style=\"vertical-align:top\"><p>&nbsp;</p><h2><strong>Filetype Breakout (Malware)</strong></h2><p>Malware can be embedded in various objects. The pie-chart breaks down the various file types associated with malware seen by the sandbox.</p><p>&nbsp;</p></td></tr><tr><td style=\"vertical-align:top\"><p>&nbsp;</p><h2><strong>Compressed File Analysis&nbsp;(Malware)</strong></h2><p>While compression makes file storage and transmission more efficient, attackers use uncommon compression or multi-level compression designed to bypass security controls. The piechart highlights the number of malware associated with the use of compression.</p></td><td>&nbsp;</td><td><fazchart mkey=\"fsa-Compressed-File-Analysis\" title=\"\" width=\"350px\"></fazchart><p>&nbsp;</p></td></tr></tbody></table><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1><strong>Performance</strong></h1><table border=\"0\" align=\"center\" cellspacing=\"1\" cellpadding=\"1\" style=\"line-height:1.2; width:740px\"><tbody><tr><td style=\"text-align:center; vertical-align:top; width:80px\"><p style=\"text-align:center\">Quick Stats<img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/stats.png\" style=\"height:70px; width:70px\" /></p></td><td style=\"text-align:left; vertical-align:top; width:330px\"><ul><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"fsa-Average-Scan-Time-Per-File\"></fazmacro></strong>&nbsp;seconds average Scan Time Per File</span></li><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"fsa-Files-Processed-Per-Hour\"></fazmacro></strong>&nbsp;Files Processed Per Hour</span></li><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"fsa-Max-Hourly-Files-Processed-Count\"></fazmacro></strong>&nbsp;Files Processed in Peak Hour</span></li></ul></td><td style=\"text-align:left; vertical-align:top; width:330px\"><ul><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"fsa-avg-Scantime-Per-Clean-File\"></fazmacro></strong>seconds average scan time per clean file</span></li><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"fsa-avg-Scantime-Per-Malicious-File\"></fazmacro></strong>seconds average scan time per malicious file</span></li><li><span style=\"font-size:12px\"><strong><fazmacro mkey=\"fsa-Max-Hourly-Files-Processed-Hour\"></fazmacro></strong>&nbsp;Peak Hour of Processing</span></li></ul></td></tr></tbody></table><h2><strong>Files Scanned per Day and Hour</strong></h2><p>High file activity is common during business hours and can be influenced by various events e.g. product announcement, quarterly earnings, etc. It can also highlight anomalies such as a exfiltration of data during off peak hours. The matrix chart breaks down the number of file activity on an hourly basis.</p><fazchart mkey=\"fsa-Files-Scanned-per-Day-and-Hour\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><h2><strong>Top 10 Average Scan Time per Filetype (in seconds)</strong></h2><p>To optimize sandbox resources and security policies, visibility to the file types and associated processing time is essential in the decision-making process. The bar-chart breaks down the various file types and its average sandbox processing time.</p><fazchart mkey=\"fsa-avg-Scantime-per-Filetype\" title=\"\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1><strong>Recommendations</strong></h1><p><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_internal/icon_check_box.png\" style=\"height:15px; width:15px;\"/> Add Threat Protection to Proactively Scan File Repositories.</p><p><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_internal/icon_check_box.png\" style=\"height:15px; width:15px;\"/> Add Sandboxing Technology to Detect Unknown Malware.</p><p><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_internal/icon_check_box.png\" style=\"height:15px; width:15px;\"/> Remind Users to Be Careful When Opening Macro Enabled Files.</p><p><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_internal/icon_check_box.png\" style=\"height:15px; width:15px;\"/> Implement and Enforce Corporate Use Policies Regarding Peer to Peer.</p><p><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_internal/icon_check_box.png\" style=\"height:15px; width:15px;\"/> Enact Strict Policies Regarding Executable Files.</p><p><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_internal/icon_check_box.png\" style=\"height:15px; width:15px;\"/> Consider Implementing AI Assisted Sandboxing.</p><p><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_internal/icon_check_box.png\" style=\"height:15px; width:15px;\"/> Audit Existing Network for Potential Breaches.</p>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90108
                next
                edit 90203
                next
            end
        set protected enable
    next
end

config sql-report layout-folder
    edit 99999
        set folder-name "Default Templates"
        set protected enable
    next
    edit 90108
        set folder-name "FortiSandbox Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90202
        set folder-name "Asset and User Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90203
        set folder-name "SOC Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90205
        set folder-name "Outbreak Alert Reports Templates"
        set parent-id 99999
        set protected enable
    next
end

config alert basic-handler
    edit 50003
        set name "Default-FSA-System-Handler"
        set description "Default handler to track critical system event of Sandbox"
        config rule
            edit 1
                set name "Critical events"
                set devtype FortiSandbox
                set severity critical
                set logtype "event"
                set extrainfo "Action: ${action}, Status: ${status}"
                set extrainfo-type custom
                set subject "$groupby2"
                set groupby1 "devname"
                set groupby2 "msg"
                set eventstatus "open"
                set tags "Default,FortiSandbox,System"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "pri"
                        set value "2"
                        set oper great-or-equal
                    next
                end
            next
            edit 2
                set name "Malicious file detected"
                set devtype FortiSandbox
                set severity high
                set logtype "event"
                set extrainfo "File Name: ${fname}.${ftype}, Level: ${level}, Action: ${action}, Status: ${status}"
                set extrainfo-type custom
                set subject "$groupby2"
                set groupby1 "devname"
                set groupby2 "msg"
                set eventstatus "open"
                set tags "Default,FortiSandbox,System,Risky"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "risk"
                        set value "malicious"
                        set oper equal
                    next
                end
            next
            edit 3
                set name "Error event detected"
                set devtype FortiSandbox
                set severity high
                set logtype "event"
                set extrainfo "Action: ${action}, Status: ${status}"
                set extrainfo-type custom
                set subject "$groupby2"
                set groupby1 "devname"
                set groupby2 "msg"
                set eventstatus "open"
                set tags "Default,FortiSandbox,System"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "pri"
                        set value "3"
                        set oper equal
                    next
                    edit 2
                        set key "msg"
                        set value "malware package"
                        set oper not-contain
                    next
                    edit 3
                        set key "msg"
                        set value "file upload error"
                        set oper not-contain
                    next
                end
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fsa"
    next
    edit 50004
        set name "Default-FSA-Malware-Handler-By-Endpoint"
        set description "Default handler to track the malware detection by Sandbox per endpoint"
        config rule
            edit 1
                set name "FortiSandbox Malware Detected group by endpoint"
                set devtype FortiSandbox
                set severity high
                set logtype "malware"
                set extrainfo "Malware: ${mname} with severity: ${risk} found in file: ${fname}, Checksum: ${md5} from ${srcip}"
                set extrainfo-type custom
                set subject "FortiSandbox Detected Malware $groupby2 from $groupby1"
                set groupby1 "endpoint"
                set groupby2 "mname"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Sandbox,Malware,Risky"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "risk"
                        set value "Malicious"
                        set oper equal
                    next
                    edit 2
                        set key "srcip"
                        set value "0.0.0.0"
                        set oper not-equal
                    next
                end
            next
            edit 2
                set name "FortiSandbox Malware Detected group by dstendpoint"
                set devtype FortiSandbox
                set severity high
                set logtype "malware"
                set extrainfo "Malware: ${mname} with severity: ${risk} found in file: ${fname}, Checksum: ${md5} to ${dstip}"
                set extrainfo-type custom
                set subject "FortiSandbox Detected Malware $groupby2 to $groupby1"
                set groupby1 "dstendpoint"
                set groupby2 "mname"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Sandbox,Malware,Risky"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "risk"
                        set value "Malicious"
                        set oper equal
                    next
                    edit 2
                        set key "dstip"
                        set value "0.0.0.0"
                        set oper not-equal
                    next
                end
            next
            edit 3
                set name "FortiSandbox Detected Risky File group by endpoint"
                set devtype FortiSandbox
                set severity medium
                set logtype "malware"
                set extrainfo "Malware: ${mname} with severity: ${risk} found in file: ${fname}, Checksum: ${md5} from ${srcip}"
                set extrainfo-type custom
                set subject "FortiSandbox Detected Risky File $groupby2 from $groupby1"
                set groupby1 "endpoint"
                set groupby2 "fname"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Sandbox,Malware,Risky"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "risk"
                        set value "high risk"
                        set oper equal
                    next
                    edit 2
                        set key "srcip"
                        set value "0.0.0.0"
                        set oper not-equal
                    next
                end
            next
            edit 4
                set name "FortiSandbox Detected Risky File group by dstendpoint"
                set devtype FortiSandbox
                set severity medium
                set logtype "malware"
                set extrainfo "Malware: ${mname} with severity: ${risk} found in file: ${fname}, Checksum: ${md5} to ${dstip}"
                set extrainfo-type custom
                set subject "FortiSandbox Detected Risky File $groupby2 to $groupby1"
                set groupby1 "dstendpoint"
                set groupby2 "fname"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Sandbox,Malware,Risky"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "risk"
                        set value "high risk"
                        set oper equal
                    next
                    edit 2
                        set key "dstip"
                        set value "0.0.0.0"
                        set oper not-equal
                    next
                end
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fsa"
    next
    edit 50005
        set name "Default-FSA-Malware-Handler-By-Threat"
        set description "Default handler to track the malware detection by Sandbox per threat"
        config rule
            edit 1
                set name "FortiSandbox Malware Detected group by endpoint"
                set devtype FortiSandbox
                set severity high
                set logtype "malware"
                set extrainfo "Malware: ${mname} with severity: ${risk} found in file: ${fname}, Checksum: ${md5} from ${groupby2}"
                set extrainfo-type custom
                set subject "FortiSandbox Detected Malware from $groupby2"
                set groupby1 "mname"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Sandbox,Malware,Risky"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "risk"
                        set value "Malicious"
                        set oper equal
                    next
                    edit 2
                        set key "srcip"
                        set value "0.0.0.0"
                        set oper not-equal
                    next
                end
            next
            edit 2
                set name "FortiSandbox Malware Detected group by dstendpoint"
                set devtype FortiSandbox
                set severity high
                set logtype "malware"
                set extrainfo "Malware: ${mname} with severity: ${risk} found in file: ${fname}, Checksum: ${md5} to ${groupby2}"
                set extrainfo-type custom
                set subject "FortiSandbox Detected Malware to $groupby2"
                set groupby1 "mname"
                set groupby2 "dstendpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Sandbox,Malware,Risky"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "risk"
                        set value "Malicious"
                        set oper equal
                    next
                    edit 2
                        set key "dstip"
                        set value "0.0.0.0"
                        set oper not-equal
                    next
                end
            next
            edit 3
                set name "FortiSandbox Detected Malware from JSON API request"
                set devtype FortiSandbox
                set severity medium
                set logtype "malware"
                set extrainfo "Malware: ${mname} with severity: ${risk} found in file: ${fname}, Checksum: ${md5} from JSON API request"
                set extrainfo-type custom
                set subject "FortiSandbox Detected Malware from JSON API request"
                set groupby1 "mname"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Sandbox,Malware,Risky"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "risk"
                        set value "Malicious"
                        set oper equal
                    next
                    edit 2
                        set key "srcip"
                        set value "0.0.0.0"
                        set oper equal
                    next
                    edit 3
                        set key "dstip"
                        set value "0.0.0.0"
                        set oper equal
                    next
                end
            next
            edit 4
                set name "FortiSandbox Detected Risky File group by endpoint"
                set devtype FortiSandbox
                set severity medium
                set logtype "malware"
                set extrainfo "Malware: ${mname} with severity: ${risk} found in file: ${fname}, Checksum: ${md5} from ${groupby2}"
                set extrainfo-type custom
                set subject "FortiSandbox Detected Risky File from $groupby2"
                set groupby1 "fname"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Sandbox,Malware,Risky"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "risk"
                        set value "high risk"
                        set oper equal
                    next
                    edit 2
                        set key "srcip"
                        set value "0.0.0.0"
                        set oper not-equal
                    next
                end
            next
            edit 5
                set name "FortiSandbox Detected Risky File group by dstendpoint"
                set devtype FortiSandbox
                set severity medium
                set logtype "malware"
                set extrainfo "Malware: ${mname} with severity: ${risk} found in file: ${fname}, Checksum: ${md5} to ${groupby2}"
                set extrainfo-type custom
                set subject "FortiSandbox Detected Risky File to $groupby2"
                set groupby1 "fname"
                set groupby2 "dstendpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Sandbox,Malware,Risky"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "risk"
                        set value "high risk"
                        set oper equal
                    next
                    edit 2
                        set key "dstip"
                        set value "0.0.0.0"
                        set oper not-equal
                    next
                end
            next
            edit 6
                set name "FortiSandbox Detected Risky File from JSON API request"
                set devtype FortiSandbox
                set severity medium
                set logtype "malware"
                set extrainfo "Malware: ${mname} with severity: ${risk} found in file: ${fname}, Checksum: ${md5} from JSON API request"
                set extrainfo-type custom
                set subject "FortiSandbox Detected Risky File from JSON API request"
                set groupby1 "fname"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Sandbox,Malware,Risky"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "risk"
                        set value "high risk"
                        set oper equal
                    next
                    edit 2
                        set key "srcip"
                        set value "0.0.0.0"
                        set oper equal
                    next
                    edit 3
                        set key "dstip"
                        set value "0.0.0.0"
                        set oper equal
                    next
                end
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fsa"
    next
end


config sql-report dataset
end



config sql-report chart
end


config sql-report layout
end

config sql-report layout-folder
	edit 99999
		set folder-name "Default Templates"
		set protected enable
	next
end

config alert basic-handler
    edit 28000
        set name "Default-NOC-Docker-Events"
        set description "Default handler for NoC docker events"
        config rule
            edit 1
                set name "Memory report detected"
                set devtype FortiManager
                set severity medium
                set logtype "event"
                set extrainfo "Device ${devname} with message ${msg}."
                set extrainfo-type custom
                set subject "$groupby1 $groupby2"
                set groupby1 "type"
                set groupby2 "subtype"
                set eventstatus "auto"
                set tags "Default,NOC,Docker"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "log_id=='0042010266' and msg~\"MEM\""
            next
            edit 2
                set name "CPU report detected"
                set devtype FortiManager
                set severity medium
                set logtype "event"
                set extrainfo "Device ${devname} with message ${msg}."
                set extrainfo-type custom
                set subject "$groupby1 $groupby2"
                set groupby1 "type"
                set groupby2 "subtype"
                set eventstatus "auto"
                set tags "Default,NOC,Docker"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "log_id=='0042010266' and msg~\"CPU\""
            next
            edit 3
                set name "Status changed to disable 1"
                set devtype FortiManager
                set severity medium
                set logtype "event"
                set extrainfo "Device ${devname} with changes ${changes}."
                set extrainfo-type custom
                set subject "$groupby1 $groupby2"
                set groupby1 "type"
                set groupby2 "subtype"
                set eventstatus "auto"
                set tags "Default,NOC,Docker"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "log_id=0001010026 and changes~\"status=disable\" "
            next
            edit 4
                set name "Status changed to disable 2"
                set devtype FortiManager
                set severity medium
                set logtype "event"
                set extrainfo "Device ${devname} with changes ${changes}."
                set extrainfo-type custom
                set subject "$groupby1 $groupby2"
                set groupby1 "type"
                set groupby2 "subtype"
                set eventstatus "auto"
                set tags "Default,NOC,Docker"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "log_id=0001010026 and changes~\"status=disable\" "
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fmg"
    next
end



config sql-report dataset

    edit "fdd-Attacks-Timeline"
        set description "All Attacks by Time Period"
        set log-type attack
        set dev-type FortiDDoS
        set query "select $flex_timescale(timestamp) as timescale, sum(total) as total, description from ###(select $flex_timestamp as timestamp, count(*) as total, description from $log where $filter and description is not null group by timestamp, description order by timestamp desc)### t group by timescale, description order by timescale desc"
        set protected enable
    next

    edit "fdd-Attackers-Timeline"
        set description "All Attackers by Time Period"
        set log-type attack
        set dev-type FortiDDoS
        set query "select $flex_timescale(timestamp) as timescale, sum(total) as total, sip from ###(select $flex_timestamp as timestamp, count(*) as total, sip from $log where $filter and ipstr(`sip`) is not null group by timestamp, sip order by timestamp desc)### t group by timescale, sip order by timescale desc"
        set protected enable
    next

    edit "fdd-Top-Attack-Types"
        set description "Top Attack Types List"
        set log-type attack
        set dev-type FortiDDoS
        set query "select type, description, count(*) as total from $log where $filter and description is not null group by type, description order by total desc"
        set protected enable
    next

    edit "fdd-Top-Attacks"
        set description "Top Attacks"
        set log-type attack
        set dev-type FortiDDoS
        set query "select sip, description, count(*) as total from $log where $filter and ipstr(`sip`) is not null group by sip, description order by total desc"
        set protected enable
    next

    edit "fdd-Top-Destinations-by-Type"
        set description "Top Attack Destination List"
        set log-type attack
        set dev-type FortiDDoS
        set query "select type, dip, count(*) as total from $log where $filter and description is not null and ipstr(`dip`) is not null group by type, dip order by total desc"
        set protected enable
    next

    edit "fdd-Top-Destinations"
        set description "Top Destination"
        set log-type attack
        set dev-type FortiDDoS
        set query "select dip, description, count(*) as total from $log where $filter and ipstr(`dip`) is not null group by dip, description order by total desc"
        set protected enable
    next

end


config sql-report chart

    edit "fdd-Attacks-Timeline"
        set disp-name "FortiDDoS-Attacks by Time Period"
        set category "FortiDDoS"
        set dev-type FortiDDoS
        set description "Attacks Timeline"
        set dataset "fdd-Attacks-Timeline"
        set chart-type bar
        set order-by "timescale"
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "timescale"
                set column-attr time
                set data-top 0
            next
            edit 2
                set header "Description"
                set data-type drilldown
                set data-binding "description"
                set data-top 10
            next
            edit 3
                set header "Total"
                set data-type aggregate
                set data-binding "total"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fdd-Attackers-Timeline"
        set disp-name "FortiDDoS-Attackers by Time Period"
        set category "FortiDDoS"
        set dev-type FortiDDoS
        set description "Attackers Timeline"
        set dataset "fdd-Attackers-Timeline"
        set chart-type bar
        set order-by "timescale"
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "timescale"
                set column-attr time
                set data-top 0
            next
            edit 2
                set header "Attacker"
                set data-type drilldown
                set data-binding "sip"
                set data-top 10
            next
            edit 3
                set header "Total"
                set data-type aggregate
                set data-binding "total"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fdd-Top20-Attacks"
        set disp-name "FortiDDoS-Top 20 Attacks"
        set category "FortiDDoS"
        set dev-type FortiDDoS
        set description "Top 20 Attacks"
        set dataset "fdd-Top-Attacks"
        set chart-type table
        config table-columns
            edit 1
                set header "Attack Source"
                set data-binding "sip"
                set data-top 20
            next
            edit 2
                set header "Description"
                set data-type drilldown
                set data-binding "description"
            next
            edit 3
                set header "Total"
                set data-type aggregate
                set data-binding "total"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fdd-Top20-Attack-Types"
        set disp-name "FortiDDoS-Top 20 Attack Types"
        set category "FortiDDoS"
        set dev-type FortiDDoS
        set description "Top 20 Attack Types"
        set dataset "fdd-Top-Attack-Types"
        set chart-type table
        config table-columns
            edit 1
                set header "Type"
                set data-binding "type"
                set data-top 20
            next
            edit 2
                set header "Description"
                set data-type drilldown
                set data-binding "description"
            next
            edit 3
                set header "Total"
                set data-type aggregate
                set data-binding "total"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fdd-Top20-Destinations"
        set disp-name "FortiDDoS-Top 20 Destinations"
        set category "FortiDDoS"
        set dev-type FortiDDoS
        set description "Top 20 Destinations"
        set dataset "fdd-Top-Destinations"
        set chart-type table
        config table-columns
            edit 1
                set header "Destination"
                set data-binding "dip"
                set data-top 20
            next
            edit 2
                set header "Description"
                set data-type drilldown
                set data-binding "description"
            next
            edit 3
                set header "Total"
                set data-type aggregate
                set data-binding "total"
            next
        end
        set protected enable
    next
    edit "fdd-Top20-Destinations-by-Type"
        set disp-name "FortiDDoS-Top 20 Destinations by Type"
        set category "FortiDDoS"
        set dev-type FortiDDoS
        set description "Top 20 Destinations by Type"
        set dataset "fdd-Top-Destinations-by-Type"
        set chart-type table
        config table-columns
            edit 1
                set header "Type"
                set data-binding "type"
                set data-top 20
            next
            edit 2
                set header "Destination"
                set data-type drilldown
                set data-binding "dip"
            next
            edit 3
                set header "Total"
                set data-type aggregate
                set data-binding "total"
                set column-attr count
            next
        end
        set protected enable
    next

end

config sql-report macro
    edit "Top-Attack-Source-IP"
        set disp-name "FortiDDoS-Source IP of top attack"
        set description "Source IP of top attack"
        set dataset "fdd-Top-Attacks"
        set data-binding "sip"
        set dev-type FortiDDoS
        set protected enable
    next

    edit "Top-Attack-Destination"
        set disp-name "FortiDDoS-Top attack destination"
        set description "Top attack destination"
        set dataset "fdd-Top-Destinations"
        set data-binding "dip"
        set dev-type FortiDDoS
        set protected enable
    next
end

config sql-report layout
    edit 1000080001
        set is-template enable
        set dev-type FortiDDoS
        set category "FortiDDoS"
        set title "Template - FortiDDos Default Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Attacks and attackers by time period. Top 20 attacks, attack types, destinations and destinations by type."
        set body "<fazchart mkey=\"fdd-Attacks-Timeline\" title=\"Attacks by Time Period\" width=\"100%\"></fazchart><fazchart mkey=\"fdd-Attackers-Timeline\" title=\"Attackers by Time Period\" width=\"100%\"></fazchart><fazchart mkey=\"fdd-Top20-Attacks\" title=\"Top 20 Attacks\" width=\"100%\"></fazchart><fazchart mkey=\"fdd-Top20-Attack-Types\" title=\"Top 20 Attack Types\" width=\"100%\"></fazchart><fazchart mkey=\"fdd-Top20-Destinations\" title=\"Top 20 Destinations\" width=\"100%\"></fazchart><fazchart mkey=\"fdd-Top20-Destinations-by-Type\" title=\"Top 20 Destinations by Type\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90111
                next
                edit 90203
                next
            end
        set protected enable
    next
end

config sql-report schedule
     edit "1000080001"
         set is-template enable
         set description "FortiDDoS Default Report"
         set schedule-type every-n-weeks
         set schedule-frequency 1
         set schedule-valid-start 00:00 2012/10/01
         set time-period last-7-days
         set display-table-contents enable
         set output-format pdf
         set dev-type FortiDDoS
         set schedule-color "#5484ED"
         config report-layout
             edit 1000080001
             next
         end
         config devices
            edit All_FortiDDoS
            next
         end
    next
end

config sql-report layout-folder
    edit 99999
        set folder-name "Default Templates"
        set protected enable
    next
    edit 90111
        set folder-name "FortiDDoS Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90203
        set folder-name "SOC Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90205
        set folder-name "Outbreak Alert Reports Templates"
        set parent-id 99999
        set protected enable
    next
end


config sql-report dataset
end



config sql-report chart
end


config sql-report layout
end


config sql-report layout-folder
	edit 99999
		set folder-name "Default Templates"
		set protected enable
	next
end


config sql-report dataset

    edit "fpx-Global-Traffic-Timeline"
        set description "Global traffic time line"
        set log-type traffic
        set dev-type FortiProxy
        set query "select $flex_timescale(timestamp) as hodex, sum(bandwidth) as bandwidth from ###(select $flex_timestamp as timestamp, sum(coalesce(resplength,0)) as bandwidth from $log where $filter and subtype='http-transaction' group by timestamp having sum(coalesce(resplength, 0))>0 order by timestamp desc)### t group by hodex order by hodex"
        set protected enable
    next

    edit "fpx-Global-Request-Timeline"
        set description "Global request time line"
        set log-type traffic
        set dev-type FortiProxy
        set query "select $flex_timescale(timestamp) as hodex, sum(request) as request from ###(select $flex_timestamp as timestamp, count(*) as request from $log where $filter and subtype='http-transaction' group by timestamp order by timestamp desc)### t group by hodex order by hodex"
        set protected enable
    next

    edit "fpx-Top-Websites-by-Bandwidth"
        set description "Top websites by bandwidth"
        set log-type traffic
        set dev-type FortiProxy
        set query "select root_domain(hostname) as host, sum(coalesce(resplength,0)) as bandwidth from $log where $filter and hostname is not null and subtype='http-transaction' group by host having sum(coalesce(resplength, 0))>0 order by bandwidth desc"
        set protected enable
    next

    edit "fpx-Global-Bandwidth-Savings"
        set description "Global bandwidth savings"
        set log-type traffic
        set dev-type FortiProxy
        set query "select sum(cache_len) as cache_len, sum(total_len) as total_len, cast(sum(cache_len)*100.0/sum(total_len) as decimal(18,2)) as savings from (###(select sum(case when resptype is not null then resplength else 0 end) as total_len, sum(case when resptype='cached' then resplength else 0 end) as cache_len from $log where $filter and subtype='http-transaction')###) t having sum(total_len)>0"
        set protected enable
    next

    edit "fpx-Top-Websites-by-Bandwidth-Savings"
        set description "Fetch the top websites by bandwidth savings"
        set log-type traffic
        set dev-type FortiProxy
        set query "select host, sum(cache_len) as cache_len, sum(cache_len+normal_len) as total_len, cast(sum(cache_len)*100.0/sum(cache_len+normal_len) as decimal(18,2)) as savings from (###(select root_domain(hostname) as host, sum(case when resptype='cached' then resplength else 0 end) as cache_len, sum(case when resptype in ('normal', 'generated') then resplength else 0 end) as normal_len from $log where $filter and hostname is not null and subtype='http-transaction' group by host)###) t where cache_len>0 and normal_len>0 group by host order by savings desc"
        set protected enable
    next

    edit "fpx-Global-Cache-Rate"
        set description "Global cache rate"
        set log-type traffic
        set dev-type FortiProxy
        set query "select sum(cache_objs) as cache_num, sum(total_objs) as total_num, cast(sum(cache_objs)*100.0/sum(total_objs) as decimal(18,2)) as cache_rate from (###(select sum(case when resptype='cached' then 1 else 0 end) as cache_objs, count(*) as total_objs from $log where $filter and subtype='http-transaction')###) t having sum(total_objs)>0"
        set protected enable
    next

    edit "fpx-Top-Websites-by-Cache-Rate"
        set description "Fetch the top websites by cache rate"
        set log-type traffic
        set dev-type FortiProxy
        set query "select host, cast(sum(cache_num)*100.0/sum(cache_num+normal_num) as decimal(18,2)) as cache_rate from (###(select root_domain(hostname) as host, sum(case when resptype='cached' then 1 else 0 end) as cache_num, sum(case when resptype in ('normal', 'generated') then 1 else 0 end) as normal_num from $log where $filter and hostname is not null and subtype='http-transaction' group by host)###) t where cache_num>0 and normal_num>0 group by host order by cache_rate desc"
        set protected enable
    next

    edit "fpx-Top-Websites-by-Response-Time-Improvement"
        set description "Fetch the top websites by response time improvement"
        set log-type traffic
        set dev-type FortiProxy
        set query "select host, cast(sum(normal_time - cache_time)*100.0/sum(normal_time) as decimal(18,2)) as improvement from (###(select root_domain(hostname) as host, sum(case when resptype='cached' then respfinishtime-reqtime else 0 end) as cache_time, sum(case when resptype in ('normal', 'generated') then respfinishtime-reqtime else 0 end) as normal_time from $log where $filter and hostname is not null and subtype='http-transaction' group by host)###) t where normal_time>0 and cache_time>0 and normal_time>cache_time group by host order by improvement desc"
        set protected enable
    next

    edit "fpx-Top-Web-Users-By-Bandwidth"
        set description "fk Top Web Users By Bandwidth"
        set log-type traffic
        set dev-type FortiProxy
        set query "select coalesce(nullifna(`user`),  ipstr(`srcip`)) as user_src, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out from $log where $filter group by user_src having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc"
        set protected enable
    next

    edit "fpx-traffic-bandwidth-timeline"
        set description "fk traffic bandwidth timeline"
        set log-type traffic
        set dev-type FortiProxy
        set query "select $flex_timescale(timestamp) as hodex, sum(traffic_out) as traffic_out, sum(traffic_in) as traffic_in from ###(select $flex_timestamp as timestamp, sum(coalesce(sentbyte, 0)) as traffic_out, sum(coalesce(rcvdbyte, 0)) as traffic_in from $log where $filter group by timestamp having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by timestamp desc)### t group by hodex order by hodex"
        set protected enable
    next

    edit "fpx-utm-Top-Virus"
        set description "fk utm Top Virus"
        set log-type traffic
        set dev-type FortiProxy
        set query "select virus, max(virusid) as virusid, (case when virus like 'Riskware%' then 'Spyware' when virus like 'Adware%' then 'Adware' else 'Virus' end) as malware_type, count(*) as totalnum from $log-virus where $filter and nullifna(virus) is not null group by virus order by totalnum desc"
        set protected enable
    next

    edit "fpx-webfilter-Categories-By-Bandwidth"
        set description "fk utm Top Virus"
        set log-type webfilter
        set dev-type FortiProxy
        set query "select catdesc, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log-webfilter where $filter and catdesc is not null group by catdesc order by bandwidth desc"
        set protected enable
    next

    edit "fpx-webfilter-Top-Allowed-Web-Categories"
        set description "fk webfilter Top Allowed Web Categories"
        set log-type webfilter
        set dev-type FortiProxy
        set query "select catdesc, count(*) as requests from $log where $filter  and catdesc is not null and action!='blocked' group by catdesc order by requests desc"
        set protected enable
    next

    edit "fpx-webfilter-Top-Allowed-Web-Sites-by-Bandwidth"
        set description "fk webfilter Top Allowed Web Sites by Bandwidth"
        set log-type webfilter
        set dev-type FortiProxy
        set query "select domain, string_agg(distinct catdesc, ', ') as agg_catdesc, sum(bandwidth) as bandwidth, sum(traffic_in) as traffic_in, sum(traffic_out) as traffic_out from ###(select coalesce(nullifna(hostname), ipstr(`srcip`)) as domain, catdesc, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out from $log where $filter and action!='blocked' group by domain, catdesc having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc)### t group by domain order by bandwidth desc"
        set protected enable
    next

    edit "fpx-webfilter-Top-Allowed-Web-Sites-By-Requests"
        set description "fk webfilter Top Allowed Web Sites By Requests"
        set log-type webfilter
        set dev-type FortiProxy
        set query "select domain, string_agg(distinct catdesc, ', ') as agg_catdesc, sum(requests) as requests from ###(select hostname as domain, catdesc, action, count(*) as requests from $log-webfilter where $filter and hostname is not null and catdesc is not null group by domain, catdesc, action order by requests desc)### t where action!='blocked' group by domain order by requests desc"
        set protected enable
    next

    edit "fpx-webfilter-Top-Blocked-Web-Categories"
        set description "fk webfilter Top Blocked Web Categories"
        set log-type webfilter
        set dev-type FortiProxy
        set query "select catdesc, count(*) as requests from $log where $filter and catdesc is not null and action='blocked' group by catdesc order by requests desc"
        set protected enable
    next

    edit "fpx-webfilter-Top-Blocked-Web-Sites-By-Requests"
        set description "fk webfilter Top Blocked Web Sites By Requests"
        set log-type webfilter
        set dev-type FortiProxy
        set query "select domain, catdesc, sum(requests) as requests from ###(select hostname as domain, catdesc, action, count(*) as requests from $log-webfilter where $filter and hostname is not null and catdesc is not null group by domain, catdesc, action order by requests desc)### t where action='blocked' group by domain, catdesc order by requests desc"
        set protected enable
    next

    edit "fpx-webfilter-Top-Web-Users-By-Allowed-Requests"
        set description "fk webfilter Top Web Users By Allowed Requests"
        set log-type webfilter
        set dev-type FortiProxy
        set query "select user_src, sum(requests) as requests from ###(select coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, action, count(*) as requests from $log-webfilter where $filter and coalesce(nullifna(`user`), ipstr(`srcip`)) is not null group by user_src, action /*SkipSTART*/order by requests desc/*SkipEND*/)### t where action!='blocked' group by user_src order by requests desc"
        set protected enable
    next

    edit "fpx-webfilter-Top-Web-Users-By-Blocked-Requests"
        set description "fk webfilter Top Web Users By Blocked Requests"
        set log-type webfilter
        set dev-type FortiProxy
        set query "select user_src, sum(requests) as requests from ###(select coalesce(nullifna(`user`), ipstr(`srcip`)) as user_src, action, count(*) as requests from $log-webfilter where $filter and coalesce(nullifna(`user`), ipstr(`srcip`)) is not null group by user_src, action /*SkipSTART*/order by requests desc/*SkipEND*/)### t where action='blocked' group by user_src order by requests desc"
        set protected enable
    next

    edit "fpx-webfilter-Web-Activity-Summary-By-Requests"
        set description "fk webfilter Top Web Activity Summary By Requests"
        set log-type webfilter
        set dev-type FortiProxy
        set query "select $flex_timescale(timestamp) as hodex, sum(allowed_request) as allowed_request, sum(blocked_request) as blocked_request from ###(select $flex_timestamp as timestamp, sum(case when action!='blocked' then 1 else 0 end) as allowed_request, sum(case when action='blocked' then 1 else 0 end) as blocked_request from $log-webfilter where $filter group by timestamp order by timestamp desc)### t group by hodex order by hodex"
        set protected enable
    next
end


config sql-report chart

    edit "fpx-Traffic-Timeline"
        set disp-name "FortiProxy-Traffic timeline"
        set category "FortiProxy"
        set dev-type FortiProxy
        set description "Traffic timeline"
        set dataset "fpx-Global-Traffic-Timeline"
        set chart-type area
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "bandwidth"
                set column-graph-type line-up
                set column-attr bandwidth
                set legend "Global Traffic"
            next
        end
        set protected enable
    next

    edit "fpx-Request-Timeline"
        set disp-name "FortiProxy-Request timeline"
        set category "FortiProxy"
        set dev-type FortiProxy
        set description "Request timeline"
        set dataset "fpx-Global-Request-Timeline"
        set chart-type area
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "request"
                set column-graph-type line-up
                set column-attr count
                set legend "Requests"
            next
        end
        set protected enable
    next

    edit "fpx-Top20-Websites-by-Bandwidth"
        set disp-name "FortiProxy-Top Websites by Bandwidth Pie Chart"
        set category "FortiProxy"
        set dev-type FortiProxy
        set description "Top 20 websites by bandwidth pie chart"
        set dataset "fpx-Top-Websites-by-Bandwidth"
        set chart-type pie
        config table-columns
            edit 1
                set header "Websites"
                set data-binding "host"
                set data-top 20
            next
            edit 2
                set header "Bytes"
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next

    edit "fpx-Global-Bandwidth-Savings"
        set disp-name "FortiProxy-Global Bandwidth Savings"
        set category "FortiProxy"
        set dev-type FortiProxy
        set description "Global bandwidth savings"
        set dataset "fpx-Global-Bandwidth-Savings"
        set chart-type table
        config table-columns
            edit 1
                set header "Cached Traffic"
                set data-binding "cache_len"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 2
                set data-binding "cache_len"
                set column-attr bandwidth
            next
            edit 3
                set header "Total Traffic"
                set data-binding "total_len"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 4
                set data-binding "total_len"
                set column-attr bandwidth
            next
            edit 5
                set header "Traffic Savings"
                set data-binding "savings"
                set column-attr percent
                set column-width 20
            next
        end
        set protected enable
    next

    edit "fpx-Top20-Websites-by-Bandwidth-Savings"
        set disp-name "FortiProxy-Top 20 Websites by Bandwidth Savings"
        set category "FortiProxy"
        set dev-type FortiProxy
        set description "Top 20 websites by bandwidth savings"
        set dataset "fpx-Top-Websites-by-Bandwidth-Savings"
        set chart-type table
        config table-columns
            edit 1
                set header "Hostname"
                set data-binding "host"
                set data-top 20
                set column-width 25
            next
            edit 2
                set header "Cached Traffic"
                set data-binding "cache_len"
                set column-span 2
                set column-graph-type bar
                set column-width 30
            next
            edit 3
                set data-binding "cache_len"
                set column-attr bandwidth
            next
            edit 4
                set header "Total Traffic"
                set data-binding "total_len"
                set column-span 2
                set column-graph-type bar
                set column-width 30
            next
            edit 5
                set data-binding "total_len"
                set column-attr bandwidth
            next
            edit 6
                set header "Traffic Savings"
                set data-binding "savings"
                set column-attr percent
                set column-width 15
            next
        end
        set protected enable
    next

    edit "fpx-Global-Cache-Rate"
        set disp-name "FortiProxy-Global Cache Rate"
        set category "FortiProxy"
        set dev-type FortiProxy
        set description "Global cache rate"
        set dataset "fpx-Global-Cache-Rate"
        set chart-type table
        config table-columns
            edit 1
                set header "Cached Number"
                set data-binding "cache_num"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 2
                set data-binding "cache_num"
                set column-attr count
            next
            edit 3
                set header "Total Number"
                set data-binding "total_num"
                set column-span 2
                set column-graph-type bar
                set column-width 40
            next
            edit 4
                set data-binding "total_num"
                set column-attr count
            next
            edit 5
                set header "Cached Rate"
                set data-binding "cache_rate"
                set column-attr percent
                set column-width 20
            next
        end
        set protected enable
    next

    edit "fpx-Top20-Websites-by-Cache-Rate"
        set disp-name "FortiProxy-Top 20 Websites by Cache Rate"
        set category "FortiProxy"
        set dev-type FortiProxy
        set description "Top 20 websites by cache rate"
        set dataset "fpx-Top-Websites-by-Cache-Rate"
        set chart-type table
        config table-columns
            edit 1
                set header "Hostname"
                set data-binding "host"
                set data-top 20
                set column-width 40
            next
            edit 2
                set header "Cached Rate"
                set data-binding "cache_rate"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "cache_rate"
                set column-attr percent
            next
        end
        set protected enable
    next

    edit "fpx-Top20-Websites-by-Response-Time-Improvement"
        set disp-name "FortiProxy-Top 20 Websites by Response Time Improvement"
        set category "FortiProxy"
        set dev-type FortiProxy
        set description "Top 20 websites by response time improvement"
        set dataset "fpx-Top-Websites-by-Response-Time-Improvement"
        set chart-type table
        config table-columns
            edit 1
                set header "Hostname"
                set data-binding "host"
                set data-top 20
                set column-width 40
            next
            edit 2
                set header "Improvement"
                set data-binding "improvement"
                set column-span 2
                set column-graph-type bar
                set column-width 60
            next
            edit 3
                set data-binding "improvement"
                set column-attr percent
            next
        end
        set protected enable
    next

    edit "fpx-Bandwidth-Summary"
        set disp-name "FortiProxy-Bandwidth Summary"
        set category "FortiProxy"
        set dev-type FortiProxy
        set description "Traffic bandwidth usage summary"
        set dataset "fpx-traffic-bandwidth-timeline"
        set chart-type area
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
            next
            edit 2
                set legend "Sent"
                set data-binding "traffic_out"
                set column-graph-type line-up
                set column-attr bandwidth
            next
            edit 3
                set legend "Received"
                set data-binding "traffic_in"
                set column-graph-type line-up
                set column-attr bandwidth
                
            next
        end
        set protected enable
    next

    edit "fpx-Top-20-Allowed-Web-Categories"
        set disp-name "FortiProxy-Top 20 Allowed Web Categories"
        set category "FortiProxy"
        set dev-type FortiProxy
        set description "Top 20 allowed web filtering categories"
        set dataset "fpx-webfilter-Top-Allowed-Web-Categories"
        set chart-type table
        config table-columns
            edit 1
                set header "Category"
                set data-binding "catdesc"
                set data-top 20
                set column-attr web-cat
            next
            edit 2
                set header "Requests"
                set data-binding "requests"
                set column-graph-type bar
                set column-span 2
            next
            edit 3
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fpx-Top-20-Application-Categories-by-Bandwidth"
        set disp-name "FortiProxy-Top 20 Application Categories by Bandwidth"
        set category "FortiProxy"
        set dev-type FortiProxy
        set description "Top 20 application categories by bandwidth usage"
        set dataset "fpx-webfilter-Categories-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Category"
                set data-binding "catdesc"
                set data-top 20
                set column-attr web-cat
            next
            edit 2
                set header "Bytes"
                set data-binding "bandwidth"
                set column-graph-type bar
                set column-span 2
            next
            edit 3
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next

    edit "fpx-Top-20-Web-Users-by-Bandwidth"
        set disp-name "FortiProxy-Top 20 Web Users by Bandwidth"
        set category "FortiProxy"
        set dev-type FortiProxy
        set description "Top 20 web users by bandwidth"
        set dataset "fpx-Top-Web-Users-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set data-top 10
                set column-attr user
            next
            edit 2
                set header "Bytes"
                set data-binding "bandwidth"
                set column-graph-type bar
                set column-span 2
            next
            edit 3
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
            edit 4
                set header "Bytes_in"
                set data-binding "traffic_in"
            next
            edit 5
                set header "Bytes_out"
                set data-binding "traffic_out"
            next
        end
        set protected enable
    next

    edit "fpx-Top-20-Blocked-Web-Categories"
        set disp-name "FortiProxy-Top 20 Blocked Web Categories"
        set category "FortiProxy"
        set dev-type FortiProxy
        set description "Top 20 blocked web filter categories"
        set dataset "fpx-webfilter-Top-Blocked-Web-Categories"
        set chart-type table
        config table-columns
            edit 1
                set header "Category"
                set data-binding "catdesc"
                set data-top 20
                set column-attr web-cat
            next
            edit 2
                set header "Requests"
                set data-binding "requests"
                set column-graph-type bar
                set column-span 2
            next
            edit 3
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fpx-Top-20-Blocked-Websites"
        set disp-name "FortiProxy-Top 20 Blocked Websites"
        set category "FortiProxy"
        set dev-type FortiProxy
        set description "Top 20 Blocked websites by number of requests"
        set dataset "fpx-webfilter-Top-Blocked-Web-Sites-By-Requests"
        set chart-type table
        config table-columns
            edit 1
                set header "Website"
                set data-binding "domain"
                set data-top 20
                set column-attr obf-url
            next
            edit 2
                set header "Category"
                set data-binding "catdesc"
                set column-attr web-cat
            next
            edit 3
                set header "Requests"
                set data-binding "requests"
                set column-graph-type bar
                set column-span 2
            next
            edit 4
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fpx-Top-20-Viruses"
        set disp-name "FortiProxy-Top 20 Viruses"
        set category "FortiProxy"
        set dev-type FortiProxy
        set description "Top 20 viruses detected"
        set dataset "fpx-utm-Top-Virus"
        set chart-type table
        config table-columns
            edit 1
                set header "Virus Name"
                set data-binding "virusid"
                set column-attr url
                set column-span 2
                set data-top 20
            next
            edit 2
                set data-binding "virus"
                set column-attr virus
            next
            edit 3
                set header "Malware Type"
                set data-binding "malware_type"
            next
            edit 4
                set header "Occurrences"
                set data-binding "totalnum"
                set column-graph-type bar
                set column-span 2
            next
            edit 5
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fpx-Top-50-Allowed-Websites"
        set disp-name "FortiProxy-Top 50 Allowed Websites"
        set category "FortiProxy"
        set dev-type FortiProxy
        set description "Top 50 allowed websites by number of requests"
        set dataset "fpx-webfilter-Top-Allowed-Web-Sites-By-Requests"
        set chart-type table
        config table-columns
            edit 1
                set header "Website"
                set data-binding "domain"
                set data-top 50
            next
            edit 2
                set header "Category"
                set data-binding "agg_catdesc"
                set column-attr web-cat
            next
            edit 3
                set header "Requests"
                set data-binding "requests"
                set column-graph-type bar
                set column-span 2
            next
            edit 4
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fpx-Top-50-Websites-and-Category-by-Bandwidth"
        set disp-name "FortiProxy-Top 50 Websites and Category by Bandwidth"
        set category "FortiProxy"
        set dev-type FortiProxy
        set description "Top 50 websites and web filtering categories by bandwidth usage"
        set dataset "fpx-webfilter-Top-Allowed-Web-Sites-by-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Website"
                set data-binding "domain"
                set data-top 50
            next
            edit 2
                set header "Category"
                set data-binding "agg_catdesc"
                set column-attr web-cat
            next
            edit 3
                set header "Bytes"
                set data-binding "bandwidth"
                set column-graph-type bar
                set column-span 2
            next
            edit 4
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
        end
        set protected enable
    next

   edit "fpx-Top-Blocked-Categories-by-Donut-Chart"
        set disp-name "FortiProxy-Top 10 Blocked Categories"
        set category "FortiProxy"
        set dev-type FortiProxy
        set description "Top 10 Blocked Categories by donut chart"
        set dataset "fpx-webfilter-Top-Blocked-Web-Categories"
        set chart-type donut
        config table-columns
            edit 1
                set header "Categories"
                set data-binding "catdesc"
                set data-top 10
            next
            edit 2
                set header "Requests"
                set data-type aggregate
                set data-binding "requests"
                set column-attr percent
            next
        end
        set protected enable
    next

    edit "fpx-Top-Blocked-Websites-and-Categories"
        set disp-name "FortiProxy-Top 50 Blocked Websites and Categories"
        set category "FortiProxy"
        set dev-type FortiProxy
        set description "Top 50 blocked web filtering websites and categories by number of requests"
        set dataset "fpx-webfilter-Top-Blocked-Web-Sites-By-Requests"
        set chart-type table
        config table-columns
            edit 1
                set header "Website"
                set data-binding "domain"
                set data-top 50
                set column-attr obf-url
            next
            edit 2
                set header "Category"
                set data-binding "catdesc"
                set column-attr web-cat
            next
            edit 3
                set header "Requests"
                set data-binding "requests"
                set column-graph-type bar
                set column-span 2
            next
            edit 4
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next

   edit "fpx-Top-Categories-by-request-Donut-Chart"
        set disp-name "FortiProxy-Top 10 Web Categories by request"
        set category "FortiProxy"
        set dev-type FortiProxy
        set description "Top 10 categories by request donut chart"
        set dataset "fpx-webfilter-Top-Allowed-Web-Categories"
        set chart-type donut
        config table-columns
            edit 1
                set header "Categories"
                set data-binding "catdesc"
                set data-top 10
            next
            edit 2
                set header "Requests"
                set data-type aggregate
                set data-binding "requests"
                set column-attr percent
            next
        end
        set protected enable
    next

    edit "fpx-Top-Web-Users-by-Allowed-Requests"
        set disp-name "FortiProxy-Top 20 Web Users by Allowed Requests"
        set category "FortiProxy"
        set dev-type FortiProxy
        set description "Top 20 web users by number of allowed requests"
        set dataset "fpx-webfilter-Top-Web-Users-By-Allowed-Requests"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set column-attr user
                set data-top 20
            next
            edit 2
                set header "Requests"
                set data-binding "requests"
                set column-graph-type bar
                set column-span 2
            next
            edit 3
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fpx-Top-Web-Users-by-Blocked-Requests"
        set disp-name "FortiProxy-Top 20 Web Users by Blocked Requests"
        set category "FortiProxy"
        set dev-type FortiProxy
        set description "Top 20 web users by number of blocked requests"
        set dataset "fpx-webfilter-Top-Web-Users-By-Blocked-Requests"
        set chart-type table
        config table-columns
            edit 1
                set header "User (or IP)"
                set data-binding "user_src"
                set column-attr user
                set data-top 20
            next
            edit 2
                set header "Requests"
                set data-binding "requests"
                set column-graph-type bar
                set column-span 2
            next
            edit 3
                set data-binding "requests"
                set column-attr count
            next
        end
        set protected enable
    next

   edit "fpx-Top-Websites-by-Bandwidth-Donut-Chart"
        set disp-name "FortiProxy-Top 10 Websites by Bandwidth"
        set category "FortiProxy"
        set dev-type FortiProxy
        set description "Top 10 Websites by Bandwidth Donut Chart"
        set dataset "fpx-webfilter-Top-Allowed-Web-Sites-by-Bandwidth"
        set chart-type donut
        config table-columns
            edit 1
                set header "Website"
                set data-binding "domain"
                set data-top 10
            next
            edit 2
                set header "Bytes"
                set data-type aggregate
                set data-binding "bandwidth"
                set column-attr percent
            next
        end
        set protected enable
    next

    edit "fpx-Web-Activity-Summary"
        set disp-name "FortiProxy-Web Activity Summary"
        set category "FortiProxy"
        set dev-type FortiProxy
        set description "Web activity summary by number of requests"
        set dataset "fpx-webfilter-Web-Activity-Summary-By-Requests"
        set chart-type line
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
            next
            edit 2
                set legend "Allowed Requests"
                set data-binding "allowed_request"
                set column-graph-type line-up
            next
            edit 3
                set legend "Blocked Requests"
                set data-binding "blocked_request"
                set column-graph-type line-up
                
            next
        end
        set protected enable
    next

end


config sql-report layout
    edit 1000084001
        set is-template enable
        set dev-type FortiProxy
        set category "FortiProxy"
        set title "Template - FortiProxy Default Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Global bandwidth savings, cache rate, traffic and request timeline. Top 20 websites by bandwidth, bandwidth savings, cache rate, response time improvement."
        set body "<fazchart mkey=\"fpx-Global-Bandwidth-Savings\" title=\"Global Bandwidth Savings\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fpx-Global-Cache-Rate\" title=\"Global Cache Rate\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fpx-Traffic-Timeline\" title=\"Traffic Timeline\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fpx-Request-Timeline\" title=\"Request Timeline\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fpx-Top20-Websites-by-Bandwidth\" title=\"Top 20 Websites by Bandwidth Pie Chart\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fpx-Top20-Websites-by-Bandwidth-Savings\" title=\"Top 20 Websites by Bandwidth Savings\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fpx-Top20-Websites-by-Cache-Rate\" title=\"Top 20 Websites by Cache Rate\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fpx-Top20-Websites-by-Response-Time-Improvement\" title=\"Top 20 Websites by Response Time Improvement\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90113
                next
            end
        set protected enable
    next

    edit 1000084002
        set is-template enable
        set dev-type FortiProxy
        set category "FortiProxy"
        set title "Template - FortiProxy Web Usage Report"
        set description "Web Usage Summary"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set body "<h1>Web Usage Summary</h1><fazchart mkey=\"fpx-Web-Activity-Summary\" title=\"Request Summary\" width=\"100%\"></fazchart><fazchart mkey=\"fpx-Bandwidth-Summary\" title=\"Bandwidth Summary\" width=\"100%\"></fazchart><hr /><h1>Web Activity</h1><fazchart mkey=\"fpx-Top-Web-Users-by-Allowed-Requests\" title=\"Top 20 Most Active Users\" width=\"100%\"></fazchart><fazchart mkey=\"fpx-Top-Categories-by-request-Donut-Chart\" title=\"Top Categories by Request\" width=\"100%\"></fazchart><fazchart mkey=\"fpx-Top-20-Allowed-Web-Categories\" title=\"Top 20 Allowed Web Categories\" width=\"100%\"></fazchart><fazchart mkey=\"fpx-Top-50-Allowed-Websites\" title=\"Top 50 Most Visited Websites\" width=\"100%\"></fazchart><hr /><h1>Internet Bandwidth Usage</h1><fazchart mkey=\"fpx-Top-20-Web-Users-by-Bandwidth\" title=\"Top 20 Bandwidth Users\" width=\"100%\"></fazchart><fazchart mkey=\"fpx-Top-20-Application-Categories-by-Bandwidth\" title=\"Top 20 Categories By Bandwidth\" width=\"100%\"></fazchart><fazchart mkey=\"fpx-Top-Websites-by-Bandwidth-Donut-Chart\" title=\"Top Websites by Bandwidth\" width=\"100%\"></fazchart><fazchart mkey=\"fpx-Top-50-Websites-and-Category-by-Bandwidth\" title=\"Top 50 Websites and Category by Bandwidth\" width=\"100%\"></fazchart><hr /><h1>Most Blocked</h1><fazchart mkey=\"fpx-Top-Web-Users-by-Blocked-Requests\" title=\"Top 20 Most Block Users\" width=\"100%\"></fazchart><fazchart mkey=\"fpx-Top-Blocked-Categories-by-Donut-Chart\" title=\"Top Blocked Categories\" width=\"100%\"></fazchart><fazchart mkey=\"fpx-Top-20-Blocked-Web-Categories\" title=\"Top 20 Blocked Web Categories\" width=\"100%\"></fazchart><fazchart mkey=\"fpx-Top-Blocked-Websites-and-Categories\" title=\"Top 50 Most Blocked Websites\" width=\"100%\"></fazchart><p>&nbsp;</p>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90113
                next
                edit 90200
                next
            end
        set protected enable
    next

    edit 1000084003
        set is-template enable
        set dev-type FortiProxy
        set category "FortiProxy"
        set title "Template - FortiProxy Security Analysis"
        set description "User Security Analysis"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set body "<h1>User Security Analysis</h1><fazchart mkey=\"fpx-Top-20-Blocked-Websites\" title=\"Top Blocked Web Sites\" width=\"100%\"></fazchart><fazchart mkey=\"fpx-Top-50-Allowed-Websites\" title=\"Top Allowed Web Sites\" width=\"100%\"></fazchart><fazchart mkey=\"fpx-Top-20-Blocked-Web-Categories\" title=\"Top Blocked Web Categories\" width=\"100%\"></fazchart><fazchart mkey=\"fpx-Top-20-Allowed-Web-Categories\" title=\"Top Allowed Web Categories\" width=\"100%\"></fazchart><fazchart mkey=\"fpx-Top-20-Viruses\" title=\"Top Detected Viruses\" width=\"100%\"></fazchart><p>&nbsp;</p>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90113
                next
                edit 90203
                next
            end
        set protected enable
    next
end


config sql-report layout-folder
    edit 99999
        set folder-name "Default Templates"
        set protected enable
    next
    edit 90113
        set folder-name "FortiProxy Reports Templates"
        set parent-id 99999
        set protected enable
    next

    edit 90200
        set folder-name "Application Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90203
        set folder-name "SOC Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90205
        set folder-name "Outbreak Alert Reports Templates"
        set parent-id 99999
        set protected enable
    next
end


config sql-report dataset
    edit "FortiNAC-Endpoint-By-Rogue-and-Registered"
        set description "FortiNAC Endpoint By Rogue and Registered"
        set dev-type FortiNAC
        set log-type asset
        set query "select count(*) as count, (case when endpointtype='Rogue' then 'Rogue' else 'Registered Host' end) as endpointtype from $ADOM_NACENDPOINT as ept where endpointtype is not null group by endpointtype order by count desc"
        set protected enable
    next
    edit "FortiNAC-Endpoint-By-Type"
        set description "FortiNAC Endpoint By Type"
        set dev-type FortiNAC
        set log-type asset
        set query "select count(*) as count, endpointtype as endpoint_type from $ADOM_NACENDPOINT as ept where endpointtype!='Rogue' group by endpoint_type order by count desc"
        set protected enable
    next
    edit "FortiNAC-Endpoint-OS"
        set description "FortiNAC Endpoint OS"
        set dev-type FortiNAC
        set log-type asset
        set query "SELECT count(*) as count, coalesce(os, 'Unknown') as os_type FROM $ADOM_NACENDPOINT WHERE hwtype is null GROUP BY os_type order by count desc"
        set protected enable
    next
    edit "FortiNAC-Endpoint-By-Vendor"
        set description "FortiNAC Endpoint By Vendor"
        set dev-type FortiNAC
        set log-type asset
        set query "select count(*) as count, coalesce(adp.vendorname, 'Unknown') as vendor_name from $ADOM_NACENDPOINT as ept, $ADOM_NACADAPTER as adp where adp.endpointid=ept.assetid AND adp.assetid NOT IN (select assetid from $ADOM_NACDEVICE) group by vendor_name order by count desc"
        set protected enable
    next
    edit "FortiNAC-Endpoint-Type-By-Location"
        set description "FortiNAC Endpoint Type By Location"
        set dev-type FortiNAC
        set log-type asset
        set query "select ctn.name as location, ept.endpointtype as type, count (*) as total from $ADOM_NACCONTAINER as ctn, $ADOM_NACENDPOINT as ept, $ADOM_NACADAPTER as apd where apd.endpointid = ept.assetid AND ctn.assetid = apd.containerid group by ctn.name, ept.endpointtype order by ctn.name, total desc"
        set protected enable
    next
    edit "FortiNAC-Endpoint-Inventory"
        set description "FortiNAC Endpoint Inventory"
        set dev-type FortiNAC
        set log-type asset
        set query "select ept.endpointtype, ept.connected, adp.ip , adp.mac, ctn.name as location, adp.vendorname, ept.hostname from $ADOM_NACENDPOINT as ept,$ADOM_NACADAPTER as adp left join $ADOM_NACCONTAINER as ctn on ctn.assetid = adp.containerid where ept.assetid = adp.endpointid AND ept.assetid NOT IN (select assetid from $ADOM_NACDEVICE) order by mac"
        set protected enable
    next
    edit "FortiNAC-Container-Inventory"
        set description "FortiNAC Container Inventory"
        set dev-type FortiNAC
        set log-type asset
        set query "Select dev.name as device, ctn.name as container from $ADOM_NACCONTAINER as ctn, $ADOM_NACDEVICE as dev WHERE dev.containerid=ctn.assetid order by device"
        set protected enable
    next
    edit "FortiNAC-Total-Number-of-Rogue"
        set description "FortiNAC Total Number of Rogue"
        set dev-type FortiNAC
        set log-type asset
        set query "SELECT COUNT(*) as total FROM $ADOM_NACENDPOINT as ept WHERE endpointtype='Rogue'"
        set protected enable
    next
    edit "FortiNAC-Network-Inventory"
        set description "FortiNAC Network Inventory"
        set dev-type FortiNAC
        set log-type asset
        set query "Select name, curvlan, label,connstate, (case when adminstatus =1 THEN 'On' ELSE 'Off' END) AS adminstatus, (case when operstatus =1 THEN 'Link Up' ELSE 'Link Down' END) AS operationalstatus FROM $ADOM_NACPORT as prt order by name,label"
        set protected enable
    next
    edit "FortiNAC-Total-Number-of-Registered-Host"
        set description "FortiNAC total Number of Registered Host"
        set dev-type FortiNAC
        set log-type asset
        set query "select count(*) as total from $ADOM_NACENDPOINT as ept where endpointtype!='Rogue'"
        set protected enable
    next
    edit "FortiNAC-Highest-Endpoint-By-Type-Name"
        set description "FortiNAC Highest Endpoint By Type Name"
        set dev-type FortiNAC
        set log-type asset
        set query "select endpointtype from (select count(*) as maxtype, endpointtype from $ADOM_NACENDPOINT as ept where endpointtype!='Rogue' group by endpointtype order by maxtype desc) t limit 1"
        set protected enable
    next
    edit "FortiNAC-Highest-Endpoint-By-Type-count"
        set description "FortiNAC Highest Endpoint By Type count"
        set dev-type FortiNAC
        set log-type asset
        set query "select maxtype as maxcount from (select count(*) as maxtype, endpointtype as endpoint_type from $ADOM_NACENDPOINT as ept where endpointtype!='Rogue' group by endpoint_type order by maxtype desc) t limit 1"
        set protected enable
    next
    edit "FortiNAC-Highest-Endpoint-By-OS-Type-Name-and-count"
        set description "FortiNAC Highest Endpoint By OS Type Name and count"
        set dev-type FortiNAC
        set log-type asset
        set query "select bilang, jenis from (select count(*) as bilang, coalesce(os, 'Unknown') as jenis from $ADOM_NACENDPOINT as ept where hwtype is null group by jenis order by bilang desc) as Bilangan limit 1"
        set protected enable
    next
    edit "FortiNAC-total-Number-of-Network-Devices"
        set description "FortiNAC total Number of Network Devices"
        set dev-type FortiNAC
        set log-type asset
        set query "select count(*) as total from $ADOM_NACDEVICE as dev, $ADOM_NACCONTAINER as ctn where dev.containerid=ctn.assetid AND ctn.assetid NOT IN (select assetid from $ADOM_NACENDPOINT)"
        set protected enable
    next
end

config sql-report chart
    edit "FortiNAC-Endpoint-By-Rogue-and-Registered"
        set disp-name "FortiNAC-Endpoint by Rogue And Registered-Pie Chart"
        set dev-type FortiNAC
        set category "FortiNAC"
        set description "Endpoint by Rogue And Registered-Pie Chart"
        set dataset "FortiNAC-Endpoint-By-Rogue-and-Registered"
        set chart-type pie
        config table-columns
            edit 1
                set header "Hosts Type"
                set data-binding "endpointtype"
                set data-top 5
            next
            edit 2
                set header ""
                set data-type aggregate
                set data-binding "count"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "FortiNAC-Endpoint-By-Type-Pie-Chart"
        set disp-name "FortiNAC-Endpoint By Type-Pie Chart"
        set dev-type FortiNAC
        set category "FortiNAC"
        set description "Endpoint By Type-Pie Chart"
        set dataset "FortiNAC-Endpoint-By-Type"
        set chart-type pie
        config table-columns
            edit 1
                set header "Hosts by Type"
                set data-binding "endpoint_type"
                set data-top 5
            next
            edit 2
                set header ""
                set data-type aggregate
                set data-binding "count"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "FortiNAC-Endpoint-By-Operating-System-Type-Pie-Chart"
        set disp-name "FortiNAC-Endpoint By Operating System Type - Pie Chart"
        set dev-type FortiNAC
        set category "FortiNAC"
        set description "Endpoint By Operating System Type - Pie Chart"
        set dataset "FortiNAC-Endpoint-OS"
        set chart-type pie
        config table-columns
            edit 1
                set header "OS Type"
                set data-binding "os_type"
                set data-top 5
            next
            edit 2
                set header ""
                set data-type aggregate
                set data-binding "count"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "FortiNAC-Endpoint-By-Vendor-Pie-Chart"
        set disp-name "FortiNAC-Endpoint By Vendor-Pie Chart"
        set dev-type FortiNAC
        set category "FortiNAC"
        set description "Endpoint By Vendor-Pie Chart"
        set dataset "FortiNAC-Endpoint-By-Vendor"
        set chart-type pie
        config table-columns
            edit 1
                set header "Host By Vendor"
                set data-binding "vendor_name"
                set data-top 5
            next
            edit 2
                set header ""
                set data-type aggregate
                set data-binding "count"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "FortiNAC-Endpoint-Type-By-Location-Bar"
        set disp-name "FortiNAC-Endpoint Type By Location-Bar"
        set dev-type FortiNAC
        set category "FortiNAC"
        set description "Endpoint Type By Location-Bar"
        set dataset "FortiNAC-Endpoint-Type-By-Location"
        set chart-type bar
        config table-columns
            edit 1
                set header "Hosts Type"
                set data-type raw
                set data-binding "type"
                set data-top 10
            next
            edit 2
                set header " "
                set data-type drilldown
                set data-binding "location"
            next
            edit 3
                set header "Count"
                set data-type aggregate
                set data-binding "total"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "FortiNAC-Endpoint-Type-By-Location-Table"
        set disp-name "FortiNAC-Endpoint Type By Location-Table"
        set dev-type FortiNAC
        set category "FortiNAC"
        set description "Endpoint Type By Location-Table"
        set dataset "FortiNAC-Endpoint-Type-By-Location"
        set chart-type table
        config table-columns
            edit 1
                set header "Location"
                set data-binding "location"
                set data-top 10
            next
            edit 2
                set header "Type"
                set data-binding "type"
            next
            edit 3
                set header "Total"
                set data-binding "total"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "FortiNAC-Endpoint-Inventory"
        set disp-name "FortiNAC-Endpoint Inventory"
        set dev-type FortiNAC
        set category "FortiNAC"
        set description "Endpoint Inventory"
        set dataset "FortiNAC-Endpoint-Inventory"
        set chart-type table
        config table-columns
            edit 1
                set header "IP Address"
                set data-binding "ip"
                set column-width 20
                set data-top 1000
            next
            edit 2
                set header "Hostname"
                set data-binding "hostname"
                set column-width 15
            next
            edit 3
                set header "Endpoint Type"
                set data-binding "endpointtype"
            next
            edit 4
                set header "MAC Address"
                set data-binding "mac"
                set column-width 20
            next
            edit 5
                set header "Vendor Name"
                set data-binding "vendorname"
                set column-width 15
            next
            edit 6
                set header "Connection Status"
                set data-binding "connected"
            next
            edit 7
                set header "Location"
                set data-binding "location"
                set column-width 10
            next
        end
        set protected enable
    next
    edit "FortiNAC-Container-Inventory"
        set disp-name "FortiNAC-Container Inventory"
        set dev-type FortiNAC
        set category "FortiNAC"
        set description "Container Inventory"
        set dataset "FortiNAC-Container-Inventory"
        set chart-type table
        config table-columns
            edit 1
                set header "Device"
                set data-binding "device"
                set data-top 1000
            next
            edit 2
                set header "Container (Location)"
                set data-binding "container"
                set column-width 30
            next
        end
        set protected enable
    next
    edit "FortiNAC-Network-Inventory"
        set disp-name "FortiNAC-Network Inventory"
        set dev-type FortiNAC
        set category "FortiNAC"
        set description "Network Inventory"
        set dataset "FortiNAC-Network-Inventory"
        set chart-type table
        config table-columns
            edit 1
                set header "Device"
                set data-binding "name"
                set data-top 5000
                set column-width 20
            next
            edit 2
                set header "Label"
                set data-binding "label"
                set column-width 10
            next
            edit 3
                set header "Current Vlan"
                set data-binding "curvlan"
            next
            edit 4
                set header "Connection State"
                set data-binding "connstate"
            next
            edit 5
                set header "Admin Status"
                set data-binding "adminstatus"
            next
            edit 6
                set header "Operational Status"
                set data-binding "operationalstatus"
            next
        end
        set protected enable
    next
end
config sql-report macro
    edit "FortiNAC-Total-Number-of-Rogue"
        set dev-type FortiNAC
        set disp-name "FortiNAC-Total Number of Rogue"
        set description "Total Number of Rogue"
        set dataset "FortiNAC-Total-Number-of-Rogue"
        set data-binding "total"
        set protected enable
    next
    edit "FortiNAC-Total-Number-of-Registered-Host"
        set dev-type FortiNAC
        set disp-name "FortiNAC-Total Number of Registered Host"
        set description "Total Number of Registered Host"
        set dataset "FortiNAC-Total-Number-of-Registered-Host"
        set data-binding "total"
        set protected enable
    next
    edit "FortiNAC-Highest-Endpoint-By-Type-Name"
        set dev-type FortiNAC
        set disp-name "FortiNAC-Highest Endpoint By Type Name"
        set description "Highest Endpoint By Type Name"
        set dataset "FortiNAC-Highest-Endpoint-By-Type-Name"
        set data-binding "endpointtype"
        set protected enable
    next
    edit "FortiNAC-Highest-Endpoint-By-Type-count"
        set dev-type FortiNAC
        set disp-name "FortiNAC-Highest Endpoint By Type Count"
        set description "Highest Endpoint By Type Count"
        set dataset "FortiNAC-Highest-Endpoint-By-Type-count"
        set data-binding "maxcount"
        set protected enable
    next
    edit "FortiNAC-Type-of-the-highest-endpoint-OS"
        set dev-type FortiNAC
        set disp-name "FortiNAC-The Type of the highest endpoint OS"
        set description "The Type of the highest endpoint OS"
        set dataset "FortiNAC-Highest-Endpoint-By-OS-Type-Name-and-count"
        set data-binding "jenis"
        set protected enable
    next
    edit "FortiNAC-Count-of-the-highest-endpoint-OS"
        set dev-type FortiNAC
        set disp-name "FortiNAC-Count of the highest endpoint OS"
        set description "Count of the highest endpoint OS"
        set dataset "FortiNAC-Highest-Endpoint-By-OS-Type-Name-and-count"
        set data-binding "bilang"
        set protected enable
    next
    edit "FortiNAC-Total-Number-of-Network-Devices"
        set dev-type FortiNAC
        set disp-name "FortiNAC-Total Number of Network Devices"
        set description "Total Number of Network Devices"
        set dataset "FortiNAC-total-Number-of-Network-Devices"
        set data-binding "total"
        set protected enable
    next
end

config sql-report layout
    edit 1000086001
        set is-template enable
        set category "FortiNAC"
        set dev-type FortiNAC
        set title "Template - FortiNAC Endpoints and Network Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "FortiNAC Endpoints and Network Report."
        set body "<h1><span style=\"font-size:26px\"><strong>Executive Summary</strong></span></h1><p style=\"text-align:justify\">Explosive device proliferation and continuously evolving sophisticated threats have kept endpoints a top target for cyberattacks. With the cost of an endpoint-based breach reaching into the millions of dollars per event, it is critical for an organization to understand and improve visibility into the network. This report provides summary and detail distrivution of endpoints and inventory of endpoints and the&nbsp;network devices connected in the environment.</p><p style=\"text-align:justify\">&nbsp;</p><h1 style=\"text-align:justify\"><span style=\"font-size:24px\"><strong>1.Endpoint</strong></span></h1><p style=\"text-align:justify\">The below chart illustrate the endpoint overview by the total number of rogue and total number of registered endpoints. A registered endpoint&nbsp;is a device requiring network services that is displayed in the FortiNAC host view and has an ID. Registered ednpoints have a record in the FortiNAC database and are known entities. Rogue endpoints do not have&nbsp;a record and are unknown entities. Rogue endpoints expose further risk to an organzition&nbsp;as these unidentified device are under the radar.</p><p style=\"text-align:justify\">The chart below summarize the total number of Rogue and Registered Endpoints:</p><table cellspacing=\"1\" cellpadding=\"1\" border=\"0\" style=\"width:600px\"><tbody><tr><td style=\"background-color:rgb(255, 153, 51); border-color:rgb(255, 153, 51); text-align:center; width:250px\"><span style=\"color:#FFFFFF\">Total number of Rogue Endpoints</span></td><td style=\"background-color:rgb(51, 153, 255); border-color:rgb(51, 153, 255); text-align:center; width:250px\"><span style=\"color:#FFFFFF\">Total number of Registered Endpoints</span></td></tr><tr><td style=\"background-color:rgb(255, 153, 51); border-color:rgb(255, 153, 51); text-align:center\"><strong><span style=\"color:#FFFFFF\"><fazmacro mkey=\"FortiNAC-Total-Number-of-Rogue\"></fazmacro></span></strong></td><td style=\"background-color:rgb(51, 153, 255); border-color:rgb(51, 153, 255); text-align:center\"><strong><span style=\"color:#FFFFFF\"><fazmacro mkey=\"FortiNAC-Total-Number-of-Registered-Host\"></fazmacro></span></strong></td></tr></tbody></table><p>&nbsp;</p><fazchart mkey=\"FortiNAC-Endpoint-By-Rogue-and-Registered\" title=\"\" width=\"700px\"></fazchart><h2><span style=\"font-size:24px\"><strong>1.1&nbsp;Endpoint Distribution</strong></span></h2><p style=\"text-align:justify\">With growth in both BYOD and IoT, protecting countless device types with different operating systems that aren&rsquo;t owned, managed, or updated by corporate IT has become a significant challenge for security team. Gaining visibility into the type of the endpoints connected to the enterprise network and their operating system vulnerabilities are fairly important to put on strategy in order to continuosly improve an organization security posture.&nbsp;</p><table cellspacing=\"1\" cellpadding=\"1\" border=\"0\" style=\"width:600px\"><tbody><tr><td style=\"background-color:rgb(255, 153, 51); border-color:rgb(255, 153, 51); text-align:center; width:300px\"><span style=\"color:#FFFFFF\">Top Endpoints Type</span></td><td style=\"background-color:rgb(51, 153, 255); border-color:rgb(51, 153, 255); text-align:center; width:250px\"><span style=\"color:#FFFFFF\">Top Endpoints Count</span></td></tr><tr><td style=\"background-color:rgb(255, 153, 51); border-color:rgb(255, 153, 51); text-align:center\"><strong><span style=\"color:#FFFFFF\"><fazmacro mkey=\"FortiNAC-Highest-Endpoint-By-Type-Name\"></fazmacro></span></strong></td><td style=\"background-color:rgb(51, 153, 255); border-color:rgb(51, 153, 255); text-align:center\"><strong><span style=\"color:#FFFFFF\"><fazmacro mkey=\"FortiNAC-Highest-Endpoint-By-Type-count\"></fazmacro></span></strong></td></tr></tbody></table><p>&nbsp;</p><fazchart mkey=\"FortiNAC-Endpoint-By-Type-Pie-Chart\" title=\"Endpoint Distribution By Type\" width=\"700px\"></fazchart><p>&nbsp;</p><table cellspacing=\"1\" cellpadding=\"1\" border=\"0\" style=\"width:600px\"><tbody><tr><td style=\"background-color:rgb(255, 153, 51); border-color:rgb(255, 153, 51); text-align:center; width:300px\"><span style=\"color:#FFFFFF\">Top Endpoints OS Type</span></td><td style=\"background-color:rgb(51, 153, 255); border-color:rgb(51, 153, 255); text-align:center; width:250px\"><span style=\"color:#FFFFFF\">Top Endpoints OS Type Count</span></td></tr><tr><td style=\"background-color:rgb(255, 153, 51); border-color:rgb(255, 153, 51); text-align:center\"><span style=\"color:#FFFFFF\"><fazmacro mkey=\"FortiNAC-Type-of-the-highest-endpoint-OS\"></fazmacro></span></td><td style=\"background-color:rgb(51, 153, 255); border-color:rgb(51, 153, 255); text-align:center\"><strong><span style=\"color:#FFFFFF\"><fazmacro mkey=\"FortiNAC-Count-of-the-highest-endpoint-OS\"></fazmacro></span></strong></td></tr></tbody></table><p>&nbsp;</p><p>&nbsp;</p><fazchart mkey=\"FortiNAC-Endpoint-By-Operating-System-Type-Pie-Chart\" title=\"Endpoint Distribution By Operating System\" width=\"700px\"></fazchart><p>&nbsp;</p><fazchart mkey=\"FortiNAC-Endpoint-By-Vendor-Pie-Chart\" title=\"Endpoint Distribution By Vendor\" width=\"700px\"></fazchart><p>&nbsp;</p><p style=\"text-align:justify\">The below chart illustrate the distribution of the endpoint by location and by the type of the endpoints. These provide an insight&nbsp;which location in the organization has the highest connected devices and the type of the endpoints at each location. In addition, the following table also&nbsp;provide the details counts of the type of the endpoints and its location.</p><p>&nbsp;</p><fazchart mkey=\"FortiNAC-Endpoint-Type-By-Location-Bar\" title=\"Endpoint Distribution By Location And Type\" width=\"700px\"></fazchart><p>&nbsp;</p><fazchart mkey=\"FortiNAC-Endpoint-Type-By-Location-Table\" title=\"Endpoint Distribution By Location And Type (Exact Count)\" width=\"700px\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h2><span style=\"font-size:24px\"><strong>1.2&nbsp;Endpoint Inventory Details</strong></span></h2><p>The table below illustrate the endpoints inventory in details.</p><fazchart mkey=\"FortiNAC-Endpoint-Inventory\" title=\"Endpoint Inventory\" width=\"700px\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><p>&nbsp;</p><h1 style=\"text-align:justify\"><span style=\"font-size:24px\"><strong>2. Network</strong></span></h1><p style=\"text-align:justify\">The charts&nbsp;below provides summary and detail inventory of the network devices connected in the environment:</p><table cellspacing=\"1\" cellpadding=\"1\" border=\"0\" style=\"width:600px\"><tbody><tr><td style=\"background-color:rgb(255, 153, 51); border-color:rgb(255, 153, 51); text-align:center; width:250px\"><span style=\"color:#FFFFFF\">Total number of Network Devices</span></td></tr><tr><td style=\"background-color:rgb(255, 153, 51); border-color:rgb(255, 153, 51); text-align:center\"><span style=\"color:#FFFFFF\"><fazmacro mkey=\"FortiNAC-Total-Number-of-Network-Devices\"></fazmacro></span></td></tr></tbody></table><p>&nbsp;</p><h2><strong>2.1 Network Inventory Summary</strong></h2><p>The table below illustrate the network devices inventory</p><fazchart mkey=\"FortiNAC-Container-Inventory\" title=\"Network Inventory\" width=\"700px\"></fazchart><p>&nbsp;</p><h2><strong>2.2&nbsp;Network Inventory Details</strong></h2><p>The table below illustrate the network inventory in details.</p><p>&nbsp;</p><fazchart mkey=\"FortiNAC-Network-Inventory\" title=\"{default}\" width=\"700px\"></fazchart><p>&nbsp;</p><p>&nbsp;</p>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90114
                next
                edit 90201
                next
                edit 90202
                next
            end
        set protected enable
    next
end

config sql-report layout-folder
    edit 99999
        set folder-name "Default Templates"
        set protected enable
    next
    edit 90114
        set folder-name "FortiNAC Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90201
        set folder-name "Network Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90202
        set folder-name "Asset and User Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90205
        set folder-name "Outbreak Alert Reports Templates"
        set parent-id 99999
        set protected enable
    next
end


config sql-report dataset

    edit "ffw-traffic-bandwidth-timeline"
        set description "Traffic bandwidth timeline"
        set log-type traffic
        set dev-type FortiFirewall
        set query "select $flex_timescale(timestamp) as hodex, sum(traffic_out) as traffic_out, sum(traffic_in) as traffic_in from ###(select timestamp, sum(bandwidth) as bandwidth, sum(traffic_out) as traffic_out, sum(traffic_in) as traffic_in from ###base(/*tag:rpt_base_ffw_t_bndwdth_sess*/select $flex_timestamp as timestamp, devid, vd, csf, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, count(*) as sessions, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(sentbyte, 0)) as traffic_out, sum(coalesce(rcvdbyte, 0)) as traffic_in from $log where $filter group by timestamp, devid, vd, csf, user_src, service /*SkipSTART*/order by timestamp desc/*SkipEND*/)base### base_query group by timestamp order by bandwidth desc)### t group by hodex having sum(traffic_out+traffic_in)>0 order by hodex"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "ffw-number-of-session-timeline"
        set description "Number of session timeline"
        set log-type traffic
        set dev-type FortiFirewall
        set query "select $flex_timescale(timestamp) as hodex, sum(sessions) as sessions from ###(select timestamp, sum(sessions) as sessions from ###base(/*tag:rpt_base_ffw_t_bndwdth_sess*/select $flex_timestamp as timestamp, devid, vd, csf, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, count(*) as sessions, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(sentbyte, 0)) as traffic_out, sum(coalesce(rcvdbyte, 0)) as traffic_in from $log where $filter group by timestamp, devid, vd, csf, user_src, service /*SkipSTART*/order by timestamp desc/*SkipEND*/)base### base_query group by timestamp order by sessions desc)### t group by hodex order by hodex"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "ffw-bandwidth-app-Traffic-Statistics"
        set description "Bandwidth application traffic statistics"
        set log-type traffic
        set dev-type FortiFirewall
        set query "drop table if exists rpt_tmptbl_1; create temporary table rpt_tmptbl_1(total_sessions varchar(255), total_bandwidth varchar(255), ave_session varchar(255), ave_bandwidth varchar(255), active_date varchar(255), total_users varchar(255), total_app varchar(255), total_dest varchar(255)); insert into rpt_tmptbl_1 (total_sessions, total_bandwidth, ave_session, ave_bandwidth) select format_numeric_no_decimal(sum(sessions)) as total_sessions, bandwidth_unit(sum(bandwidth)) as total_bandwidth, format_numeric_no_decimal(cast(sum(sessions)/$days_num as decimal(18, 0))) as ave_session, bandwidth_unit(cast(sum(bandwidth)/$days_num as decimal(18, 0))) as ave_bandwidth from ###(select count(*) as sessions, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter and (logflag&1>0))### t; update rpt_tmptbl_1 set active_date=t1.dom from (select dom, sum(sessions) as sessions from ###(select $DAY_OF_MONTH as dom, count(*) as sessions from $log where $filter group by dom order by sessions desc)### t group by dom order by sessions desc limit 1) as t1; update rpt_tmptbl_1 set total_users=t2.totalnum from (select format_numeric_no_decimal(count(distinct(user_src))) as totalnum from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, count(*) as count from $log where $filter group by user_src order by count desc)### t) as t2; update rpt_tmptbl_1 set total_app=t3.totalnum from (select format_numeric_no_decimal(count(distinct(app_grp))) as totalnum from ###(select app_group_name(app) as app_grp, count(*) as count from $log where $filter and nullifna(app) is not null group by app_grp order by count desc)### t) as t3; update rpt_tmptbl_1 set total_dest=t4.totalnum from (select format_numeric_no_decimal(count(distinct(dstip))) as totalnum from ###(select dstip, count(*) as count from $log where $filter and dstip is not null group by dstip order by count desc)### t ) as t4; select 'Total Sessions' as summary, total_sessions as stats from rpt_tmptbl_1 union all select 'Total Bytes Transferred' as summary, total_bandwidth as stats from rpt_tmptbl_1 union all select 'Most Active Date By Sessions' as summary, active_date as stats from rpt_tmptbl_1 union all select 'Total Users' as summary, total_users as stats from rpt_tmptbl_1 union all select 'Total Applications' as summary, total_app as stats from rpt_tmptbl_1 union all select 'Total Destinations' as summary, total_dest as stats from rpt_tmptbl_1 union all select 'Average Sessions Per Day' as summary, ave_session as stats from rpt_tmptbl_1 union all select 'Average Bytes Per Day' as summary, ave_bandwidth as stats from rpt_tmptbl_1"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "ffw-Top-App-By-Bandwidth"
        set description "Top applications by bandwidth usage"
        set log-type traffic
        set dev-type FortiFirewall
        set query "select app_group_name(app) as app_group, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out, count(*) as sessions from $log where $filter and nullifna(app) is not null group by app_group having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
                edit "appcat"
                    set var-name "appcat"
                next
            end
        set protected enable
    next
    edit "ffw-bandwidth-app-Top-Users-By-Bandwidth"
        set description "Bandwidth application top users by bandwidth usage"
        set log-type traffic
        set dev-type FortiFirewall
        set query "select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out, count(*) as sessions from $log where $filter group by user_src having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "ffw-bandwidth-app-Traffic-By-Active-User-Number"
        set description "Bandwidth application traffic by active user number"
        set log-type traffic
        set dev-type FortiFirewall
        set query "select $flex_timescale(timestamp) as hodex, count(distinct(user_src)) as total_user from ###(select $flex_timestamp as timestamp, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src from $log where $filter group by timestamp, user_src order by timestamp desc)### t group by hodex order by hodex"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "ffw-bandwidth-app-Top-Dest-By-Bandwidth-Sessions"
        set description "Bandwidth application top dest by bandwidth usage sessions"
        set log-type traffic
        set dev-type FortiFirewall
        set query "select coalesce(nullifna(root_domain(hostname)), ipstr(`dstip`)) as domain, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out, count(*) as sessions from $log where $filter group by domain order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
end



config sql-report chart
    edit "ffw-Traffic-Bandwidth-Summary-Day-Of-Month"
        set disp-name "FortiFirewall-Bandwidth Summary"
        set category "FortiFirewall"
        set dev-type FortiFirewall
        set description "Traffic bandwidth usage summary"
        set dataset "ffw-traffic-bandwidth-timeline"
        set chart-type area
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "traffic_out"
                set column-graph-type line-up
                set column-attr bandwidth
                set legend "Sent"
            next
            edit 3
                set data-binding "traffic_in"
                set column-graph-type line-down
                set column-attr bandwidth
                set legend "Received"
            next
        end
        set protected enable
    next
    edit "ffw-Session-Summary-Day-Of-Month"
        set disp-name "FortiFirewall-Session Summary"
        set category "FortiFirewall"
        set dev-type FortiFirewall
        set description "Session summary"
        set dataset "ffw-number-of-session-timeline"
        set chart-type area
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "sessions"
                set column-graph-type line-up
                set legend "Number of Sessions"
            next
        end
        set protected enable
    next
    edit "ffw-bandwidth-app-Traffic-Statistics"
        set disp-name "FortiFirewall-Traffic Statistics"
        set category "FortiFirewall"
        set dev-type FortiFirewall
        set description "Top 10 traffic statistics summary"
        set dataset "ffw-bandwidth-app-Traffic-Statistics"
        set chart-type table
        config table-columns
            edit 1
                set header "Summary"
                set data-binding "summary"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Statistics"
                set data-binding "stats"
                set column-width 60
            next
        end
        set protected enable
    next
    edit "ffw-bandwidth-app-Top-App-By-Bandwidth-Sessions"
        set disp-name "FortiFirewall-Top 30 Applications by Bandwidth and Sessions"
        set category "FortiFirewall"
        set dev-type FortiFirewall
        set description "Top 30 applications by bandwidth usage and session count"
        set dataset "ffw-Top-App-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Application"
                set data-binding "app_group"
                set data-top 30
                set column-width 30
            next
            edit 2
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 40
            next
            edit 3
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 4
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
            edit 5
                set header "Sessions"
                set data-binding "sessions"
                set column-span 2
                set column-graph-type bar
                set column-width 30
            next
            edit 6
                set data-binding "sessions"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "ffw-bandwidth-app-Top-Users-By-Bandwidth-Sessions"
        set disp-name "FortiFirewall-Top 30 Users by Bandwidth and Sessions"
        set category "FortiFirewall"
        set dev-type FortiFirewall
        set description "Top 30 users by bandwidth usage and session count"
        set dataset "ffw-bandwidth-app-Top-Users-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "User(or IP)"
                set data-binding "user_src"
                set column-attr user
                set data-top 30
                set column-width 30
            next
            edit 2
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 40
            next
            edit 3
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 4
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
            edit 5
                set header "Sessions"
                set data-binding "sessions"
                set column-span 2
                set column-graph-type bar
                set column-width 30
            next
            edit 6
                set data-binding "sessions"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "ffw-bandwidth-app-Traffic-By-Active-User-Number"
        set disp-name "FortiFirewall-Active Traffic Users"
        set category "FortiFirewall"
        set dev-type FortiFirewall
        set description "List of active traffic users"
        set dataset "ffw-bandwidth-app-Traffic-By-Active-User-Number"
        set chart-type area
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "total_user"
                set column-graph-type line-up
                set legend "Active Users"
            next
        end
        set protected enable
    next
    edit "ffw-bandwidth-app-Top-Dest-By-Bandwidth-Sessions"
        set disp-name "FortiFirewall-Top 30 Destinations by Bandwidth and Sessions"
        set category "FortiFirewall"
        set dev-type FortiFirewall
        set description "Top 30 destinations by bandwidth usage and session count"
        set dataset "ffw-bandwidth-app-Top-Dest-By-Bandwidth-Sessions"
        set chart-type table
        config table-columns
            edit 1
                set header "Hostname(or IP)"
                set data-binding "domain"
                set data-top 30
                set column-width 30
            next
            edit 2
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 40
            next
            edit 3
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 4
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
            edit 5
                set header "Sessions"
                set data-binding "sessions"
                set column-span 2
                set column-graph-type bar
                set column-width 30
            next
            edit 6
                set data-binding "sessions"
                set column-attr count
            next
        end
        set protected enable
    next
end


config sql-report layout
    edit 1000090001
        set is-template enable
        set dev-type FortiFirewall
        set category "FortiFirewall"
        set title "Template - FortiFirewall Bandwidth and Applications Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Traffic, Bandwidth, Sessions, Destinations summaries - by users and applications"
        set body "<h1>Traffic Summary</h1><fazchart mkey=\"ffw-Traffic-Bandwidth-Summary-Day-Of-Month\" title=\"Bandwidth Summary\" width=\"100%\"></fazchart><fazchart mkey=\"ffw-Session-Summary-Day-Of-Month\" title=\"Sessions Summary\" width=\"100%\"></fazchart><fazchart mkey=\"ffw-bandwidth-app-Traffic-Statistics\" title=\"Traffic Statistics\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Application Traffic</h1><fazchart mkey=\"ffw-bandwidth-app-Top-App-By-Bandwidth-Sessions\" title=\"Top 30 Applications by Bandwidth and Sessions\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Users</h1><fazchart mkey=\"ffw-bandwidth-app-Top-Users-By-Bandwidth-Sessions\" title=\"Top 30 Users by Bandwidth and Sessions\" width=\"100%\"></fazchart><fazchart mkey=\"ffw-bandwidth-app-Traffic-By-Active-User-Number\" title=\"Active Users\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Destinations</h1><fazchart mkey=\"ffw-bandwidth-app-Top-Dest-By-Bandwidth-Sessions\" title=\"Top 30 Destination by Bandwidth and Sessions\" width=\"100%\"></fazchart><p><span style=\"font-size:20px\">Notes</span></p><p><em>&#39;Not.Scanned&#39; and &#39;unscanned&#39; categories are for the sessions that are not scanned by the Application Control engine. Please enable Application Control to allow application traffic to be properly identified/secured on your network.</em></p>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90115
                next
                edit 90200
                next
                edit 90201
                next
            end
        set protected enable
    next
end

config sql-report layout-folder
    edit 99999
        set folder-name "Default Templates"
        set protected enable
    next
    edit 90115
        set folder-name "FortiFirewall Reports Templates"
        set parent-id 99999
        set protected enable
    next

    edit 90200
        set folder-name "Application Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90201
        set folder-name "Network Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90205
        set folder-name "Outbreak Alert Reports Templates"
        set parent-id 99999
        set protected enable
    next
end

config alert basic-handler
    edit 327680001
        set name "Default-FFW-Botnet-Communication-Detection-By-Endpoint"
        set description "Default FortiFirewall event handler to detect botnet communication in network grouped by endpoint"
        config rule
            edit 1
                set name "DNS traffic to Botnet CnC blocked"
                set devtype FortiFirewall
                set severity high
                set logtype "dns"
                set extrainfo "Traffic path: ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "DNS traffic to Botnet C&C $groupby2 blocked"
                set groupby1 "endpoint"
                set groupby2 "qname"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Botnet,Domain,C&C"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==1501054601 OR logid==1501054600"
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/ffw"
    next
    edit 327680002
        set name "Default-FFW-Compromised Host-Detection-IOC-By-Endpoint"
        set description "Default FortiFirewall event handler to detect compromised hosts by FortiAnalyzer IOC feature grouped by endpoint"
        config rule
            edit 1
                set name "Traffic to CnC detected"
                set devtype FortiFirewall
                set severity critical
                set logtype "traffic"
                set extrainfo "${tdtype}: ${dstip} :${dstport}, Traffic path: ${devname} (Policy ID:${policyid})\\${dstintf}"
                set extrainfo-type custom
                set subject "Compromised host detected"
                set groupby1 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Endpoint,C&C,IP,Ioc_Rescan"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "tdtype~infected"
            next
            edit 2
                set name "DNS traffic to CnC detected"
                set devtype FortiFirewall
                set severity critical
                set logtype "dns"
                set extrainfo "${tdtype}: ${qname}, Traffic path: ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "Compromised host detected"
                set groupby1 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Endpoint,C&C,Domain,Ioc_Rescan"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "tdtype~infected"
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/ffw"
    next
    edit 327680003
        set name "Default-FFW-Risky-Destination-Detection-By-Endpoint"
        set description "Default FortiFirewall event handler to detect network traffic to malicious or suspicious destinations grouped by endpoint"
        config rule
            edit 1
                set name "DNS request to malicious destination detected"
                set devtype FortiFirewall
                set severity high
                set logtype "dns"
                set extrainfo "Domain:${hostname}, Referrer:${referralurl}, ${devname} (Policy ID:${policyid})\\${dstintf}"
                set extrainfo-type custom
                set subject "DNS request to $groupby2 detected"
                set groupby1 "endpoint"
                set groupby2 "catdesc"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Risky,Domain"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==1501054802 and (catdesc=='Malicious Websites' or catdesc=='Phishing' or catdesc=='Spam URLs')"
            next
            edit 2
                set name "DNS request to suspicious destination detected"
                set devtype FortiFirewall
                set severity medium
                set logtype "dns"
                set extrainfo "Domain:${qname}, Resolved IP: ${ipaddr}, ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "DNS request to $groupby2 detected"
                set groupby1 "endpoint"
                set groupby2 "catdesc"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Risky,Domain"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==1501054802 and (catdesc=='Newly Observed Domain' or catdesc=='Newly Registered Domain' or catdesc~'Dynamic DNS' or catdesc=='Proxy Avoidance' or catdesc=='Unrated')"
            next
            edit 3
                set name "DNS request to malicious or suspicious destination detected"
                set devtype FortiFirewall
                set severity medium
                set logtype "dns"
                set extrainfo "Domain:${qname}, Resolved IP: ${ipaddr}, ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "DNS request to $groupby2 blocked"
                set groupby1 "endpoint"
                set groupby2 "catdesc"
                set eventstatus "mitigated"
                set tags "Default,By_Endpoint,Risky,Domain"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==1501054803 and (catdesc=='Malicious Websites' or catdesc=='Phishing' or catdesc=='Spam URLs' or catdesc=='Newly Observed Domain' or catdesc=='Newly Registered Domain' or catdesc~'Dynamic DNS' or catdesc=='Proxy Avoidance' or catdesc=='Unrated')"
            next
            edit 4
                set name "Insecure SSL connection detected"
                set devtype FortiFirewall
                set severity medium
                set logtype "ssl"
                set extrainfo "${msg} with reason: ${reason} from ${srcip} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Insecure SSL connection detected"
                set groupby1 "endpoint"
                set groupby2 "msg"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Risky,SSL"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssl-anomalies"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper equal
                    next
                end
            next
            edit 5
                set name "Insecure SSL connection blocked"
                set devtype FortiFirewall
                set severity low
                set logtype "ssl"
                set extrainfo "${msg} with reason: ${reason} from ${srcip} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Insecure SSL connection blocked"
                set groupby1 "endpoint"
                set groupby2 "msg"
                set eventstatus "mitigated"
                set tags "Default,By_Endpoint,Risky,SSL"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssl-anomalies"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper not-equal
                    next
                end
            next
            edit 6
                set name "SSL connection exempted"
                set devtype FortiFirewall
                set severity low
                set logtype "ssl"
                set extrainfo "SSL connection from ${srcip} to ${dstip}:${dstport} exempt with reason: ${reason}"
                set extrainfo-type custom
                set subject "$groupby2"
                set groupby1 "endpoint"
                set groupby2 "msg"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Risky,SSL"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssl-exempt"
                        set oper equal
                    next
                end
            next
            edit 7
                set name "SSH channel detected"
                set devtype FortiFirewall
                set severity medium
                set logtype "ssh"
                set extrainfo "SSH channel by user: ${login} from ${srcip} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "SSH channel detected"
                set groupby1 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Risky,SSH"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssh-channel"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper equal
                    next
                end
            next
            edit 8
                set name "SSH channel blocked"
                set devtype FortiFirewall
                set severity low
                set logtype "ssh"
                set extrainfo "SSH channel by user: ${login} from ${srcip} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "SSH channel blocked"
                set groupby1 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Endpoint,Risky,SSH"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssh-channel"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper not-equal
                    next
                end
            next
            edit 9
                set name "SSH command detected"
                set devtype FortiFirewall
                set severity medium
                set logtype "ssh"
                set extrainfo "SSH Command: ${command} by user: ${login} from ${srcip} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "SSH command detected"
                set groupby1 "endpoint"
                set tags "Default,By_Endpoint,Risky,SSH"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssh-command"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper equal
                    next
                end
            next
            edit 10
                set name "SSH command blocked"
                set devtype FortiFirewall
                set severity low
                set logtype "ssh"
                set extrainfo "SSH Command: ${command} by user: ${login} from ${srcip} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "SSH command blocked"
                set groupby1 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Endpoint,Risky,SSH"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssh-command"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper not-equal
                    next
                end
            next
            end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/ffw"
    next
    edit 327680004
        set name "Default-FFW-Risky-Destination-Detection-By-Threat"
        set description "Default FortiFirewall event handler to detect network traffic to malicious or suspicious destinations grouped by threat"
        config rule
            edit 1
                set name "DNS request to malicious destination detected"
                set devtype FortiFirewall
                set severity high
                set logtype "dns"
                set extrainfo "Domain:${qname} from category: ${catdesc}, Traffic path: PolicyID ${policyid}(Profile ${profile})\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "DNS request to malicious destination from $groupby2 detected"
                set groupby1 "qname"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Risky,Domain"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==1501054802 and (catdesc=='Malicious Websites' or catdesc=='Phishing' or catdesc=='Spam URLs')"
            next
            edit 2
                set name "DNS request to malicious destination blocked"
                set devtype FortiFirewall
                set severity medium
                set logtype "dns"
                set extrainfo "Domain:${qname} from category: ${catdesc}, Traffic path: PolicyID ${policyid}(Profile ${profile})\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "DNS request to malicious destination from $groupby2 blocked"
                set groupby1 "qname"
                set groupby2 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Threat,Risky,Domain"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==1501054803 and (catdesc=='Malicious Websites' or catdesc=='Phishing' or catdesc=='Spam URLs')"
            next
            edit 3
                set name "DNS request to suspicious destination detected"
                set devtype FortiFirewall
                set severity medium
                set logtype "dns"
                set extrainfo "Domain:${qname} from category: ${catdesc}, Traffic path: PolicyID ${policyid}(Profile ${profile})\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "DNS request to suspicious destination from $groupby2 detected"
                set groupby1 "qname"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Risky,Domain"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==1501054802 and (catdesc=='Newly Observed Domain' or catdesc=='Newly Registered Domain' or catdesc~'Dynamic DNS' or catdesc=='Proxy Avoidance' or catdesc=='Unrated')"
            next
            edit 4
                set name "DNS request to suspicious destination from blocked"
                set devtype FortiFirewall
                set severity low
                set logtype "dns"
                set extrainfo "Domain:${qname} from category: ${catdesc}, Traffic path: PolicyID ${policyid}(Profile ${profile})\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "DNS request to suspicious destination from $groupby2 blocked"
                set groupby1 "qname"
                set groupby2 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Threat,Risky,Domain"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==1501054803 and (catdesc=='Newly Observed Domain' or catdesc=='Newly Registered Domain' or catdesc~'Dynamic DNS' or catdesc=='Proxy Avoidance' or catdesc=='Unrated')"
            next
            edit 5
                set name "Insecure SSL Connection detected"
                set devtype FortiFirewall
                set severity medium
                set logtype "ssl"
                set extrainfo "${msg} with reason: ${reason} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Insecure SSL Connection detected from $groupby2"
                set groupby1 "dstip"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Risky,SSL"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssl-anomalies"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper equal
                    next
                end
            next
            edit 6
                set name "Insecure SSL Connection blocked"
                set devtype FortiFirewall
                set severity low
                set logtype "ssl"
                set extrainfo "${msg} with reason: ${reason} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Insecure SSL Connection blocked from $groupby2"
                set groupby1 "dstip"
                set groupby2 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Threat,Risky,SSL"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssl-anomalies"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper not-equal
                    next
                end
            next
            edit 7
                set name "SSH channel detected"
                set devtype FortiFirewall
                set severity medium
                set logtype "ssh"
                set extrainfo "SSH channel by user: ${login} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "SSH channel detected from $groupby2"
                set groupby1 "dstip"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Risky,SSH"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssh-channel"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper equal
                    next
                end
            next
            edit 8
                set name "SSH channel blocked"
                set devtype FortiFirewall
                set severity low
                set logtype "ssh"
                set extrainfo "SSH channel by user: ${login} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "SSH channel blocked from $groupby2"
                set groupby1 "dstip"
                set groupby2 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Threat,Risky,SSH"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssh-channel"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper not-equal
                    next
                end
            next
            edit 9
                set name "SSH command detected"
                set devtype FortiFirewall
                set severity medium
                set logtype "ssh"
                set extrainfo "SSH command: ${command} by user: ${login}  to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "SSH command detected from $groupby2"
                set groupby1 "dstip"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Risky,SSH"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssh-command"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper equal
                    next
                end
            next
            edit 10
                set name "SSH command blocked"
                set devtype FortiFirewall
                set severity low
                set logtype "ssh"
                set extrainfo "SSH command: ${command} by user: ${login} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "SSH command blocked from $groupby2"
                set groupby1 "dstip"
                set groupby2 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Threat,Risky,SSH"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssh-command"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper not-equal
                    next
                end
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/ffw"
    next
    edit 327680005
        set name "Default-FFW-Compromised Host-Detection-IOC-By-Threat"
        set description "Default FortiFirewall event handler to detect compromised hosts by FortiAnalyzer IOC feature grouped by threat"
        config rule
            edit 1
                set name "Traffic to CnC detected"
                set devtype FortiFirewall
                set severity critical
                set logtype "traffic"
                set extrainfo "Traffic to C&C:${dstip}, Traffic path: PolicyID ${policyid}\\${dstintf}\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Traffic to C&C from $groupby2 detected"
                set groupby1 "dstip"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,IP,C&C,Ioc_Rescan"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "tdtype~infected"
            next
            edit 2
                set name "Web traffic to CnC detected"
                set devtype FortiFirewall
                set severity critical
                set logtype "webfilter"
                set extrainfo "Traffic to C&C:${hostname}, Traffic path: PolicyID ${policyid}\\${dstintf}\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Web traffic to C&C from $groupby2 detected"
                set groupby1 "hostname"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,C&C,URL,Ioc_Rescan"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "tdtype~infected"
            next
            edit 3
                set name "DNS traffic to CnC detected"
                set devtype FortiFirewall
                set severity critical
                set logtype "dns"
                set extrainfo "Traffic to C&C:${qname}, Traffic path: PolicyID ${policyid}\\${dstintf}\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "DNS traffic to C&C from $groupby2 detected"
                set groupby1 "qname"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,C&C,Domain,Ioc_Rescan"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "tdtype~infected"
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/ffw"
    next
    edit 327680006
        set name "Default FFW System Events"
        set description "Default FortiFirewall event handler for selected FortiOS system event logs grouped by device"
        config rule
            edit 1
                set name "Important events"
                set devtype FortiFirewall
                set severity high
                set logtype "event"
                set utmevent "_any_"
                set subject "$groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,System"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "pri"
                        set value "4"
                        set oper equal
                    next
                    edit 2
                        set key "pri"
                        set value "3"
                        set oper equal
                    next
                end
            next
            edit 2
                set name "Critical events"
                set devtype FortiFirewall
                set severity critical
                set logtype "event"
                set utmevent "_any_"
                set subject "$groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,System"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "pri"
                        set value "2"
                        set oper great-or-equal
                    next
                end
            next
            edit 3
                set name "Wireless event log id matched"
                set devtype FortiFirewall
                set severity low
                set logtype "event"
                set utmevent "wireless"
                set subject "$groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,System"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0104043521 or logid==0104043530 or logid==0104043531 or logid==0104043532 or logid==0104043533 or logid==0104043534 or logid==0104043535 or logid==0104043542 or logid==0104043544 or logid==0104043546 or logid==0104043548 or logid==0104043552 or logid==0104043553 or logid==0104043555 or logid==0104043557 or logid==0104043558 or logid==0104043560 or logid==0104043563 or logid==0104043564 or logid==0104043565 or logid==0104043566 or logid==0104043571 or logid==0104043573 or logid==0104043575 or logid==0104043577 or logid==0104043613 or logid==0104043614 or logid==0104043615"
            next
            edit 4
                set name "Event log id matched 1"
                set devtype FortiFirewall
                set severity medium
                set logtype "event"
                set utmevent "_any_"
                set subject "$groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,System"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0109045152 or logid==0107045082 or logid==0107045110 or logid==0110052000 or logid==0100032044"
            next
            edit 5
                set name "Event log id matched 2"
                set devtype FortiFirewall
                set severity low
                set logtype "event"
                set utmevent "_any_"
                set subject "$groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,System"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0108037892 or logid==0100020117 or logid==0100020220 or logid==0100020221 or logid==0100022017 or logid==0100022018 or logid==0100022917 or logid==0100032023 or logid==0100032103 or logid==0100032140 or logid==0100032141 or logid==0100032142 or logid==0100032146 or logid==0100032149 or logid==0100032158 or logid==0100032159 or logid==0100032231 or logid==0100032232 or logid==0100032233 or logid==0100032238 or logid==0100032241 or logid==0100032564 or logid==0100032602 or logid==0100032603 or logid==0100032605 or logid==0101041989 or logid==0101041990 or logid==0105040960"
            next
            edit 6
                set name "Event log id matched 3"
                set devtype FortiFirewall
                set severity medium
                set logtype "event"
                set utmevent "_any_"
                set subject "$groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,System"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0100020005 or logid==0100020006 or logid==0100020090 or logid==0100022901 or logid==0100022902 or logid==0100022912 or logid==0100022913 or logid==0100022915 or logid==0101023101 or logid==0101023102 or logid==0101039424 or logid==0101039425 or logid==0101039940 or logid==0101039943 or logid==0101039947 or logid==0101039948 or logid==0101039952 or logid==0101039953 or logid==0101040001 or logid==0101040002 or logid==0101040019 or logid==0101040038 or logid==0101040039 or logid==0101040101 or logid==0101040102 or logid==0101040118 or logid==0101037139"
            next
            edit 7
                set name "Event log id matched 4"
                set devtype FortiFirewall
                set severity low
                set logtype "event"
                set utmevent "_any_"
                set subject "$groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,System"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0100022950 or logid==0100022951 or logid==0100029002 or logid==0100029003 or logid==0100032001 or logid==0100032003 or logid==0102038031 or logid==0102038032 or logid==0102043008 or logid==0102043009 or logid==0102043014 or logid==0102043015 or logid==0102043016 or logid==0102043017 or logid==0102043025 or logid==0102043026 or logid==0102043039 or logid==0102043040 or logid==0102043045 or logid==0102043046"
            next
            edit 8
                set name "Event log id matched 5"
                set devtype FortiFirewall
                set severity low
                set logtype "event"
                set utmevent "_any_"
                set subject "$groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,System"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0107045114 or logid==0107045115 or logid==0107045116 or logid==0100022850 or logid==0100022851 or logid==0100043776 or logid==0100043777 or logid==0100046600"
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/ffw"
    next
    edit 327680007
        set name "Default-FFW-Botnet-Communication-Detection"
        set description "Default FortiFirewall event handler to detect botnet communication and report to FortiFirewall"
        set automation-stitch enable
        config rule
            edit 1
                set name "DNS traffic to Botnet CnC blocked"
                set devtype FortiFirewall
                set severity high
                set logtype "dns"
                set extrainfo "Traffic path: ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "DNS traffic to Botnet C&C $groupby2 blocked"
                set groupby1 "endpoint"
                set groupby2 "qname"
                set eventstatus "open"
                set tags "Default,Botnet,Domain,C&C"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==1501054601 OR logid==1501054600"
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/ffw"
    next
end


config sql-report dataset
    edit "fdc-Top-Attacker-IP-By-Incident"
        set description "Top Attackers IPs by Incidents"
        set log-type event
        set dev-type FortiDeceptor
        set query "select distinct attackerip, sum(num_incidents) as num_incidents from ###(select attackerip, victimip, service, action, operation, victimport, count(*) as num_incidents from $log where $filter and incidentid is not null group by attackerip, victimip, service, action, operation, victimport order by num_incidents desc)### t where attackerip is not null and action='Incident_Detection' and operation != 'FortiGuard_Web_Filtering' group by attackerip order by num_incidents desc"
        set protected enable
    next
    edit "fdc-Top-Victim-IP-By-Incident"
        set description "Top Victim IPs by Incidents"
        set log-type event
        set dev-type FortiDeceptor
        set query "select victimip, sum(num_incidents) as num_incidents from ###(select attackerip, victimip, service, action, operation, victimport, count(*) as num_incidents from $log where $filter and incidentid is not null group by attackerip, victimip, service, action, operation, victimport order by num_incidents desc)### t where victimip is not null and action='Incident_Detection' and operation != 'FortiGuard_Web_Filtering' group by victimip order by num_incidents desc" 
        set protected enable
    next
    edit "fdc-Top-Services-By-Incidents"
        set description "Top Services by Incidents"
        set log-type event
        set dev-type FortiDeceptor
        set query "select service, sum(num_incidents) as num_incidents from ###(select attackerip, victimip, service, action, operation, victimport, count(*) as num_incidents from $log where $filter and incidentid is not null group by attackerip, victimip, service, action, operation, victimport order by num_incidents desc)### t where service is not null and victimport is not null and action='Incident_Detection' and operation != 'FortiGuard_Web_Filtering' group by service order by num_incidents desc"
        set protected enable
    next
    edit "fdc-Failed-Login-By-User"
        set description "Top Failed Login by Username"
        set log-type event
        set dev-type FortiDeceptor
        set query "select username, sum(total_num) as total_num from ###(select nethost, username, attackerip, operation, subtype, count(*) as total_num from $log where $filter group by nethost, username, attackerip, operation, subtype order by total_num desc)### t where operation in ('Authentication_Failure', 'Logon_Fail_via_net_share') group by username order by total_num desc"
        set protected enable
    next
    edit "fdc-Malicious-Files-By-Incident"
        set description "Top Malicious Files by Incidents"
        set log-type event
        set dev-type FortiDeceptor
        set query "select distinct regexp_replace(msg, ':Zone.Identifier','') as msg_short, sum(num_incidents) as num_incidents from ###(select msg, operation, count(*) as total_num, count(incidentid) as num_incidents from $log where $filter group by msg, operation order by total_num desc, num_incidents desc)### t where operation like '%file%' group by msg_short order by num_incidents desc"
        set protected enable
    next
    edit "fdc-Attack-Tool-Based-On-IPS-Alerts"
        set description "Top Attack Tool Based On IPS Alerts"
        set log-type event
        set dev-type FortiDeceptor
        set query "select distinct msg, sum(total_num) as total_num from ###(select msg, operation, count(*) as total_num, count(incidentid) as num_incidents from $log where $filter group by msg, operation order by total_num desc, num_incidents desc)### t where operation in ('IPS_attack', 'attack') group by msg order by total_num desc"
        set protected enable
    next
    edit "fdc-Attacker-IPs-Based-On-IPS-Alerts"
        set description "Top Attacker IPs Based on IPS Alerts"
        set log-type event
        set dev-type FortiDeceptor
        set query "select attackerip, sum(total_num) as total_num from ###(select nethost, username, attackerip, operation, subtype, count(*) as total_num from $log where $filter group by nethost, username, attackerip, operation, subtype order by total_num desc)### t where operation = 'IPS_attack' group by attackerip order by total_num desc"
        set protected enable
    next
    edit "fdc-Top-Malicious-URL-Access-Based-On-Web-Filter-Alerts"
        set description "Top Malicious URL Access Based on Web Filter Alerts"
        set log-type event
        set dev-type FortiDeceptor
        set query "select nethost, sum(total_num) as total_num from ###(select nethost, username, attackerip, operation, subtype, count(*) as total_num from $log where $filter group by nethost, username, attackerip, operation, subtype order by total_num desc)### t where operation = 'FortiGuard_Web_Filtering' and subtype = 'attack' group by nethost order by total_num desc"
        set protected enable
    next
end


config sql-report chart
    edit "fdc-Top-Attacker-IP-By-Incident"
        set disp-name "FortiDeceptor-FortiDeceptor-Top Attacker IPs By Incidents"
        set category "FortiDeceptor"
        set dev-type FortiDeceptor
        set description "Top 10 Attackers IPs by Incidents"
        set dataset "fdc-Top-Attacker-IP-By-Incident"
        set chart-type donut
        config table-columns
            edit 1
                set header "Attacker IP"
                set data-binding "attackerip"
                set data-top 10
            next
            edit 2
                set header "Incidents"
                set data-binding "num_incidents"
                set column-attr count
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "fdc-Top-Victim-IP-By-Incident"
        set disp-name "FortiDeceptor-FortiDeceptor-Top Victim IPs By Incident"
        set category "FortiDeceptor"
        set dev-type FortiDeceptor
        set description "Top 10 Victim IPs by Incidents"
        set dataset "fdc-Top-Victim-IP-By-Incident"
        set chart-type donut
        config table-columns
            edit 1
                set header "Top Victim IP"
                set data-binding "victimip"
                set data-top 10
            next
            edit 2
                set header "Incidents"
                set data-binding "num_incidents"
                set column-attr count
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "fdc-Top-Services-By-Incidents"
        set disp-name "FortiDeceptor-FortiDeceptor-Top Services By Incidents"
        set category "FortiDeceptor"
        set dev-type FortiDeceptor
        set description "Top 10 Services by Incidents"
        set dataset "fdc-Top-Services-By-Incidents"
        set chart-type bar
        config table-columns
            edit 1
                set header "Service"
                set data-binding "service"
                set data-top 10
            next
            edit 2
                set header "# of Incidents"
                set data-binding "num_incidents"
                set data-top 10
                set data-type aggregate
                set legend "Service"
            next
        end
        set protected enable
    next
    edit "fdc-Failed-Login-By-User"
        set disp-name "FortiDeceptor-FortiDeceptor-Top Failed Login By Username"
        set category "FortiDeceptor"
        set dev-type FortiDeceptor
        set description "Top 10 Failed Login by Username"
        set dataset "fdc-Failed-Login-By-User"
        set chart-type bar
        config table-columns
            edit 1
                set header ""
                set data-binding "username"
                set data-top 10
            next
            edit 2
                set header "Logins"
                set data-binding "total_num"
                set data-top 3
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "fdc-Malicious-Files-By-Incident"
        set disp-name "FortiDeceptor-FortiDeceptor-Top Malicious Files By Incidents"
        set category "FortiDeceptor"
        set dev-type FortiDeceptor
        set description "Top 10 Malicious Files by Incidents"
        set dataset "fdc-Malicious-Files-By-Incident"
        set chart-type donut
        config table-columns
            edit 1
                set header "Malicious File"
                set data-binding "msg_short"
                set data-top 10
            next
            edit 2
                set header "# of Incidents"
                set data-binding "num_incidents"
                set data-top 3
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "fdc-Attack-Tool-Based-On-IPS-Alerts"
        set disp-name "FortiDeceptor-FortiDeceptor-Top Attack Tools Based On IPS Alerts"
        set category "FortiDeceptor"
        set dev-type FortiDeceptor
        set description "Top 10 Attack Tools Based On IPS Alerts"
        set dataset "fdc-Attack-Tool-Based-On-IPS-Alerts"
        set chart-type bar
        config table-columns
            edit 1
                set header "IPS Method"
                set data-binding "msg"
                set data-top 10
            next
            edit 2
                set header "# of Alerts"
                set data-binding "total_num"
                set column-attr count
                set data-top 3
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "fdc-Attacker-IPs-Based-On-IPS-Alerts"
        set disp-name "FortiDeceptor-FortiDeceptor-Top Attacker IPs Based On IPS Alerts"
        set category "FortiDeceptor"
        set dev-type FortiDeceptor
        set description "Top 10 Attacker IPs Based on IPS Alerts"
        set dataset "fdc-Attacker-IPs-Based-On-IPS-Alerts"
        set chart-type bar
        config table-columns
            edit 1
                set header "Attacker IP"
                set data-binding "attackerip"
                set data-top 10
            next
            edit 2
                set header "# of IPS Attacks"
                set data-binding "total_num"
                set data-top 3
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "fdc-Top-Malicious-URL-Access-Based-On-Web-Filter-Alerts"
        set disp-name "FortiDeceptor-FortiDeceptor-Top Malicious URL Based On Web Filter Alerts"
        set category "FortiDeceptor"
        set dev-type FortiDeceptor
        set description "Top 10 Malicious URL Access Based on Web Filter Alerts"
        set dataset "fdc-Top-Malicious-URL-Access-Based-On-Web-Filter-Alerts"
        set chart-type donut
        config table-columns
            edit 1
                set header "Malicious URL"
                set data-binding "nethost"
                set data-top 10
            next
            edit 2
                set header "# of Alerts"
                set data-binding "total_num"
                set data-top 3
                set column-attr count
                set data-type aggregate
            next
        end
        set protected enable
    next
end


config sql-report layout
    edit 1000088001
        set is-template enable
        set dev-type FortiDeceptor
        set category "FortiDeceptor"
        set title "Template - FortiDeceptor Default Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Present a quick summary of incidents and alerts generated by FortiDeceptor"
        set body "<h2>Summary</h2><p>FortiDeceptor is based on deception technology that complements an organization&rsquo;s existing breach protection strategy, designed to deceive, expose and eliminate attacks originating from either external or internal sources before any real damage occurs.</p><p>This&nbsp;report&nbsp;provides a quick summary of&nbsp;incidents and alerts generated by FortiDeceptor.</p><p>&nbsp;</p><h2>Top 10 Attackers by Incidents</h2><p>FortiDeceptor provides early breach detection and block attackers before they can gain access to sensitive company assets, and assists security operations teams to identify those threats. Attacks can come in from many different sources and IP&#39;s, both external and internal.&nbsp;</p><p>The following chart provides the Top 10 Attackers IPs by count of number of Incidents</p><fazchart mkey=\"fdc-Top-Attacker-IP-By-Incident\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><h2>Top 10 Victim IP by Incidents</h2><p>Cyber&nbsp;criminals are constantly evolving their methods of&nbsp;attacking and gaining access to networks. It is important for security operations teams to have up to the minute information about attempted attacks on company assets and which devices should be quarantined, analyzed and disinfected as needed.&nbsp;&nbsp;</p><p>The following chart provides the Top 10 Victims&nbsp;IPs by count of number of Incidents</p><fazchart mkey=\"fdc-Top-Victim-IP-By-Incident\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><h2>Top 10 Services by Incidents</h2><p>Cyber attacks and breaches take advantage of many different services and protocols. Security teams need to be aware of the services being used so that they can analyze and understand attacker Tactics, Techniques and Procedures and can build improved policies and defenses.&nbsp;&nbsp;</p><p>The following chart provides the Top 10 Services by count of number of Incidents.</p><fazchart mkey=\"fdc-Top-Services-By-Incidents\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><h2>Top 10 Failed Login by Username</h2><p>A more effective way of catching attackers is to get them in and catch them in a trap when they are not using brute force to get in, instead using employee credentials as a more efficient way in.<br />Deception Lures provides fake Username &amp; Password to deceive attacker by using them and expose their malicious activities.</p><p>&nbsp;The following chart provides the Top 10 Failed Fake Login Attempts by Username</p><fazchart mkey=\"fdc-Failed-Login-By-User\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><h2>Top 10 Malicious Files by Incidents</h2><p>Deception deceive Threat actor to engage with a fake assets instead of real one. once a threat actor compromise a decoy, malicious tools &amp; binaries will get loaded into the decoy for lateral movement and more hacking activities.</p><p>The following chart provides a list of the Top 10 Malicious Files detected by the Deception Decoys</p><fazchart mkey=\"fdc-Malicious-Files-By-Incident\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><h2>Top 10 Attack Tool based on The Decoys &nbsp;IPS Alerts</h2><p>Intrusion prevention systems help to detect malicious attempts to exploit known vulnerabilities on networks. It is important for security teams to be up-to-date on IPS attacks so they can focus on implementing the latest security measures and patches for those threats.&nbsp;&nbsp;</p><p>The following chart provides a list of the Top 10 Attack Tools/Methods based on the Decoy IPS Alerts</p><fazchart mkey=\"fdc-Attack-Tool-Based-On-IPS-Alerts\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><h2>Top 10 Attacker IPs based on The Decoys IPS Alerts</h2><p>Hackers use attacks such as port scanning, DDoS and many other methods attempting to exploit known vulnerabilities and gain access to network&nbsp;and company assets. Security operations teams need to quickly identify the IP&#39;s of these attackers to identify and block their attempts to do harm.&nbsp;&nbsp;&nbsp;</p><p>The following chart provides a list of the Top 10 Attack IPs based on Decoy &nbsp;IPS Alerts</p><fazchart mkey=\"fdc-Attacker-IPs-Based-On-IPS-Alerts\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><h2>Top 10 Malicious URLs based on The Decoys Web Filter Alerts</h2><p>Deception deceive Threat actor to engage with a fake assets instead of real one. When a threat actor compromise a decoy, an Internet connection will be used to &nbsp;maintain back-door or download more hacking tools. Security operations teams need to be aware of what URL&#39;s and websites are being flagged by the Decoy so that they can adjust security policies and rules as needed&nbsp;</p><p>The following chart provides a list of the Top 10 Malicious URLs based on the Decoy Web Filter Alerts</p><fazchart mkey=\"fdc-Top-Malicious-URL-Access-Based-On-Web-Filter-Alerts\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90118
                next
            end
        set protected enable
    next
end

config sql-report layout-folder
    edit 99999
        set folder-name "Default Templates"
        set protected enable
    next
    edit 90118
        set folder-name "FortiDeceptor Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90205
        set folder-name "Outbreak Alert Reports Templates"
        set parent-id 99999
        set protected enable
    next
end

config alert basic-handler
    edit 70000
        set name "Default-FDC-Honey-Pot-Detection"
        set description "Default event handler for FortiDeceptor Honey Pot event detection"
        config rule
            edit 1
                set name "Attack detected by FDC"
                set devtype FortiDeceptor
                set severity medium
                set logtype "event"
                set extrainfo "IP ${attackerip} connected to deceptive IP ${victimip}, Service: ${service}, Message: ${msg}"
                set extrainfo-type custom
                set subject "Attack: $groupby1 detected by FDC"
                set groupby1 "attackerip"
                set groupby2 "operation"
                set eventstatus "open"
                set tags "Default,FortiDeceptor"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "subtype=\"attack\""
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fdc"
    next
end

config sql-report dataset
    edit "fai-Attack-Scenario-Count"
        set description "Attack Scenario Count"
        set log-type attack
        set dev-type FortiNDR
        set query "select scenariotype, count(*) as total_num from $log where $filter and subtype='Attack Chain' and scenariotype is not null group by scenariotype order by total_num desc"
        set protected enable
    next
    edit "fai-Files-Proccessed-Summary"
        set description "Files Proccessed Summary"
        set log-type event
        set dev-type FortiNDR
        set query "select sum(fileaccepted) as fileaccepted, sum(fileprocessed) as fileprocessed, sum(filedetected) as filedetected from $log where $filter and subtype='file-stats'"
        set protected enable
    next
    edit "fai-Host-quarantined-Summary"
        set description "Host quarantined Summary"
        set log-type event
        set dev-type FortiNDR
        set query "select targetip as host, max(modtime) as most_recent, string_agg(distinct profilename, ',') as profilename, sum(totalnum) as total_num from ###(select targetip, profilename, max(modtime) as modtime, count(*) as totalnum from $log where $filter and subtype='automation' and targetip is not null group by targetip, profilename)### t group by host order by total_num desc"
        set protected enable
    next
    edit "fai-Learnt-Customer-Features-Summary"
        set description "Learnt Customer Features Summary"
        set log-type event
        set dev-type FortiNDR
        set query "select feature, sum(featurecount::int) as total_num from (select unnest(string_to_array(featurelst, ',')) as feature, unnest(string_to_array(featurecounts, ',')) as featurecount from $log where $filter and subtype='malware') t group by feature order by total_num desc"
        set protected enable
    next
    edit "fai-System-Events-Summary"
        set description "System Events Summary"
        set log-type event
        set dev-type FortiNDR
        set query "select from_dtime(dtime) as timestamp, level as severity, user, action, msg from $log where $filter and subtype in ('system', 'user') and  level>'information' order by timestamp desc"
        set protected enable
    next
    edit "fai-Malicious-File-Summary"
        set description "Malicious File Summary"
        set log-type attack
        set dev-type FortiNDR
        set query "select url as file, max(md5) as md5, max(filetype) as filetype, victimip, from_dtime(min(dtime)) as first_seen, from_dtime(max(dtime)) as last_seen, count(*) as total_num from  $log where $filter and subtype='Malware' and url is not null group by file, victimip order by total_num desc"
        set protected enable
    next
    edit "fai-Detection-by-Device-Summary"
        set description "Detection by Device Summary"
        set log-type attack
        set dev-type FortiNDR
        set query "select fossn || ':' || fosvd as devvd, level as risk, sum(total_num) as total_num from  ###(select fossn, fosvd, level, devicetype, count(*) as total_num from $log where $filter and subtype='Malware' group by fossn, fosvd, level, devicetype order by total_num desc)### t where fossn is not null and level is not null group by devvd, risk order by total_num desc"
        set protected enable
    next
    edit "fai-Malware-Detection-Type-Summary"
        set description "Malware Detection Type Summary"
        set log-type attack
        set dev-type FortiNDR
        set query "select detype, count(*) as total_num from $log where $filter and subtype='Malware' and detype IS NOT NULL group by detype order by total_num desc"
        set protected enable
    next
    edit "fai-Hosts-Infection-Summary"
        set description "Hosts Infection Summary"
        set log-type attack
        set dev-type FortiNDR
        set query "select victimip, detype as detection_type, sum(detypecount::int) as total_num from (select victimip, trim(unnest(string_to_array(detypelst, ','))) as detype, unnest(string_to_array(detypecounts, ',')) as detypecount from $log where $filter and subtype='Malware') t group by victimip, detection_type order by total_num desc"
        set protected enable
    next
    edit "fai-CPU-Memory-Summary"
        set description "CPU Memory Summary"
        set log-type event
        set dev-type FortiNDR
        set query "select timestamp, cast(sum(cpu)/sum(total_num) as decimal(18,0)) as avg_cpu, cast(sum(mem)/sum(total_num) as decimal(18,0)) as avg_mem, max(max_cpu) as max_cpu, max(max_mem) as max_mem from ###(select $flex_timestamp as timestamp, sum(cpu) as cpu, sum(mem) as mem, sum(datadisk) as datadisk, max(cpu) as max_cpu, max(mem) as max_mem, max(datadisk) as max_datadisk, count(*) as total_num from $log where $filter and subtype='perf-stats' group by timestamp order by timestamp)### t group by timestamp order by timestamp"
        set protected enable
    next
    edit "fai-Detection-Summary-by-Device-Type"
        set description "Detection Summary by Device Type"
        set log-type attack
        set dev-type FortiNDR
        set query "select (CASE WHEN devicetype='fabric device' THEN (fossn || ':' || fosvd) ELSE devicetype END) as device_type, sum(total_num) as total_num from ###(select fossn, fosvd, level, devicetype, count(*) as total_num from $log where $filter and subtype='Malware' group by fossn, fosvd, level, devicetype order by total_num desc)### t where devicetype is not null group by device_type order by total_num desc"
        set protected enable
    next

    edit "fndr-Anomaly-Count-by-Severity-Timeline"
        set description "Toal Number of Anomalies by Severity Timeline"
        set log-type ndr
        set dev-type FortiNDR
        set query "select $flex_timescale(timestamp) as hodex, sum(case when severity = 'critical' then totalnum else 0 end) as critical_num, sum(case when severity = 'high' then totalnum else 0 end) as high_num, sum(case when severity = 'medium' then totalnum else 0 end) as medium_num, sum(case when severity = 'low' then totalnum else 0 end) as low_num from ###(select $flex_timestamp as timestamp, severity, count(*) as totalnum from $log where $filter group by timestamp, severity order by totalnum desc)### t group by hodex order by hodex"
        set protected enable
    next
    edit "fndr-Anomaly-Count-by-Severity"
        set description "Total Number of Anomalies by Severity"
        set log-type ndr
        set dev-type FortiNDR
        set query "select sum(case when severity = 'critical' then totalnum else 0 end) as critical_num, sum(case when severity = 'high' then totalnum else 0 end) as high_num, sum(case when severity = 'medium' then totalnum else 0 end) as medium_num, sum(case when severity = 'low' then totalnum else 0 end) as low_num from ###(select $flex_timestamp as timestamp, severity, count(*) as totalnum from $log where $filter group by timestamp, severity order by totalnum desc)### t"
        set protected enable
    next
    edit "fndr-Anomaly-Type-and-Feature-by-Count"
        set description "Anomaly Types and Features by Count"
        set log-type ndr
        set dev-type FortiNDR
        set query "select type, feature, totalnum, sum(totalnum) over (partition by type) as sub_totalnum from (select type, feature, sum(totalnum) as totalnum from ((select subtype as type, botname as feature, sum(totalnum) as totalnum from ###(select subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername, count(*) as totalnum from $log where $filter and subtype in ('Botnet', 'Encrypted', 'IPS attack', 'Weak cipher') and severity != 'info' group by subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername order by totalnum desc)### t where subtype='Botnet' group by type, feature order by totalnum desc) union all (select subtype as type, campaign_name as feature, sum(totalnum) as totalnum from ###(select subtype, severity, srcip, unnest(string_to_array(campaign, ',')) as campaign_name, count(*) as totalnum from $log where $filter and subtype='IOC' and severity!='info' group by subtype, severity, srcip, campaign_name order by totalnum desc)### t group by type, feature order by totalnum desc) union all (select subtype as type, md5 as feature, sum(totalnum) as totalnum from ###(select subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername, count(*) as totalnum from $log where $filter and subtype in ('Botnet', 'Encrypted', 'IPS attack', 'Weak cipher') and severity != 'info' group by subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername order by totalnum desc)### t where subtype='Encrypted' group by type, feature order by totalnum desc) union all (select subtype as type, vname as feature, sum(totalnum) as totalnum from ###(select subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername, count(*) as totalnum from $log where $filter and subtype in ('Botnet', 'Encrypted', 'IPS attack', 'Weak cipher') and severity != 'info' group by subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername order by totalnum desc)### t where subtype='IPS attack' group by type, feature order by totalnum desc) union all (select subtype as type, reason as feature, sum(totalnum) as totalnum from ###(select subtype, severity, srcip, unnest(string_to_array(reasons, ',')) as reason, count(*) as totalnum from $log where $filter and subtype='ML' and severity!='info' group by subtype, severity, srcip, reason order by totalnum desc)### t group by type, feature order by totalnum desc) union all (select subtype as type, ciphername as feature, sum(totalnum) as totalnum from ###(select subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername, count(*) as totalnum from $log where $filter and subtype in ('Botnet', 'Encrypted', 'IPS attack', 'Weak cipher') and severity != 'info' group by subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername order by totalnum desc)### t where subtype='Weak cipher' group by type, feature order by totalnum desc)) t group by type, feature order by totalnum desc) t order by sub_totalnum desc, type"
        set protected enable
    next
    edit "fndr-Botnet-Name-by-Count"
        set description "Botnet Name by Count"
        set log-type ndr
        set dev-type FortiNDR
        set query "select botname, sum(totalnum) as totalnum from ###(select subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername, count(*) as totalnum from $log where $filter and subtype in ('Botnet', 'Encrypted', 'IPS attack', 'Weak cipher') and severity != 'info' group by subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername order by totalnum desc)### t where subtype='Botnet' group by botname order by totalnum desc"
        set protected enable
    next
    edit "fndr-Botnet-Severity-by-Count"
        set description "Botnet Severity by Count"
        set log-type ndr
        set dev-type FortiNDR
        set query "select severity, sum(totalnum) as totalnum from ###(select subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername, count(*) as totalnum from $log where $filter and subtype in ('Botnet', 'Encrypted', 'IPS attack', 'Weak cipher') and severity != 'info' group by subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername order by totalnum desc)### t where subtype='Botnet' group by severity order by totalnum desc"
        set protected enable
    next
    edit "fndr-Botnet-Traffic-Summary"
        set description "Botnet Traffic Summary"
        set log-type ndr
        set dev-type FortiNDR
        set query "select severity, srcip, dstip, botname, sum(totalnum) as totalnum from ###(select subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername, count(*) as totalnum from $log where $filter and subtype in ('Botnet', 'Encrypted', 'IPS attack', 'Weak cipher') and severity != 'info' group by subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername order by totalnum desc)### t where subtype='Botnet' group by severity, srcip, dstip, botname order by severity desc, totalnum desc"
        set protected enable
    next
    edit "fndr-IOC-Campaign-by-Count"
        set description "IOC Campaign by Count"
        set log-type ndr
        set dev-type FortiNDR
        set query "select campaign_name, sum(totalnum) as totalnum from ###(select subtype, severity, srcip, unnest(string_to_array(campaign, ',')) as campaign_name, count(*) as totalnum from $log where $filter and subtype='IOC' and severity!='info' group by subtype, severity, srcip, campaign_name order by totalnum desc)### t group by campaign_name order by totalnum desc"
        set protected enable
    next
    edit "fndr-IOC-Severity-by-Count"
        set description "IOC Severity by Count"
        set log-type ndr
        set dev-type FortiNDR
        set query "select severity, sum(totalnum) as totalnum from ###(select subtype, severity, srcip, unnest(string_to_array(campaign, ',')) as campaign_name, count(*) as totalnum from $log where $filter and subtype='IOC' and severity!='info' group by subtype, severity, srcip, campaign_name order by totalnum desc)### t group by severity order by totalnum desc"
        set protected enable
    next
    edit "fndr-IOC-Campaign-Summary"
        set description "IOC Campaign Summary"
        set log-type ndr
        set dev-type FortiNDR
        set query "select severity, srcip, campaign_name, sum(totalnum) as totalnum from ###(select subtype, severity, srcip, unnest(string_to_array(campaign, ',')) as campaign_name, count(*) as totalnum from $log where $filter and subtype='IOC' and severity!='info' group by subtype, severity, srcip, campaign_name order by totalnum desc)### t group by severity, srcip, campaign_name order by severity desc, totalnum desc"
        set protected enable
    next
    edit "fndr-Encrypted-Severity-by-Count"
        set description "Encrypted Attack Severity by Count"
        set log-type ndr
        set dev-type FortiNDR
        set query "select severity, sum(totalnum) as totalnum from ###(select subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername, count(*) as totalnum from $log where $filter and subtype in ('Botnet', 'Encrypted', 'IPS attack', 'Weak cipher') and severity != 'info' group by subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername order by totalnum desc)### t where subtype='Encrypted' group by severity order by totalnum desc"
        set protected enable
    next
    edit "fndr-Encrypted-Attack-Summary"
        set description "Encrypted Attack Summary"
        set log-type ndr
        set dev-type FortiNDR
        set query "select severity, md5, srcip, dstip, sum(totalnum) as totalnum from ###(select subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername, count(*) as totalnum from $log where $filter and subtype in ('Botnet', 'Encrypted', 'IPS attack', 'Weak cipher') and severity != 'info' group by subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername order by totalnum desc)### t where subtype='Encrypted' group by severity, md5, srcip, dstip order by severity desc, totalnum desc"
        set protected enable
    next
    edit "fndr-IPS-Attack-Name-by-Count"
        set description "IPS Attack Name by Count"
        set log-type ndr
        set dev-type FortiNDR
        set query "select vname, sum(totalnum) as totalnum from ###(select subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername, count(*) as totalnum from $log where $filter and subtype in ('Botnet', 'Encrypted', 'IPS attack', 'Weak cipher') and severity != 'info' group by subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername order by totalnum desc)### t where subtype='IPS attack' group by vname order by totalnum desc"
        set protected enable
    next
    edit "fndr-IPS-Severity-by-Count"
        set description "IPS Attack Severity by Count"
        set log-type ndr
        set dev-type FortiNDR
        set query "select severity, sum(totalnum) as totalnum from ###(select subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername, count(*) as totalnum from $log where $filter and subtype in ('Botnet', 'Encrypted', 'IPS attack', 'Weak cipher') and severity != 'info' group by subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername order by totalnum desc)### t where subtype='IPS attack' group by severity order by totalnum desc"
        set protected enable
    next
    edit "fndr-IPS-Attack-Summary"
        set description "IPS Attack Summary"
        set log-type ndr
        set dev-type FortiNDR
        set query "select severity, srcip, dstip, vname, sum(totalnum) as totalnum from ###(select subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername, count(*) as totalnum from $log where $filter and subtype in ('Botnet', 'Encrypted', 'IPS attack', 'Weak cipher') and severity != 'info' group by subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername order by totalnum desc)### t where subtype='IPS attack' group by severity, srcip, dstip, vname order by severity desc, totalnum desc"
        set protected enable
    next
    edit "fndr-ML-Anomaly-Feature-by-Count"
        set description "Machine Learning Anomaly Feature by Count"
        set log-type ndr
        set dev-type FortiNDR
        set query "select reason as feature, sum(totalnum) as totalnum from ###(select subtype, severity, srcip, unnest(string_to_array(reasons, ',')) as reason, count(*) as totalnum from $log where $filter and subtype='ML' and severity!='info' group by subtype, severity, srcip, reason order by totalnum desc)### t group by feature order by totalnum desc"
        set protected enable
    next
    edit "fndr-ML-Severity-by-Count"
        set description "Machine Learning Anomaly Severity by Count"
        set log-type ndr
        set dev-type FortiNDR
        set query "select severity, sum(totalnum) as totalnum from ###(select subtype, severity, srcip, unnest(string_to_array(reasons, ',')) as reason, count(*) as totalnum from $log where $filter and subtype='ML' and severity!='info' group by subtype, severity, srcip, reason order by totalnum desc)### t group by severity order by totalnum desc"
        set protected enable
    next
    edit "fndr-ML-Anomaly-Summary"
        set description "Machine Learning Anomaly Summary"
        set log-type ndr
        set dev-type FortiNDR
        set query "select severity, string_agg(distinct reason, ',') as reasons, srcip, sum(totalnum) as totalnum from ###(select subtype, severity, srcip, unnest(string_to_array(reasons, ',')) as reason, count(*) as totalnum from $log where $filter and subtype='ML' and severity!='info' group by subtype, severity, srcip, reason order by totalnum desc)### t group by severity, srcip order by severity desc, totalnum desc"
        set protected enable
    next
    edit "fndr-Weak-Cipher-Protocol-by-Percentage"
        set description "Weak Cipher Protocol by CouPercentagent"
        set log-type ndr
        set dev-type FortiNDR
        set query "select alproto, round(sum(totalnum)*100/sum(sum(totalnum)) over (), 2) as percentage from ###(select subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername, count(*) as totalnum from $log where $filter and subtype in ('Botnet', 'Encrypted', 'IPS attack', 'Weak cipher') and severity != 'info' group by subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername order by totalnum desc)### t where subtype='Weak cipher' group by alproto order by percentage desc"
        set protected enable
    next
    edit "fndr-Weak-Cipher-Severity-by-Count"
        set description "Weak Cipher Severity by Count"
        set log-type ndr
        set dev-type FortiNDR
        set query "select severity, sum(totalnum) as totalnum from ###(select subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername, count(*) as totalnum from $log where $filter and subtype in ('Botnet', 'Encrypted', 'IPS attack', 'Weak cipher') and severity != 'info' group by subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername order by totalnum desc)### t where subtype='Weak cipher' group by severity order by totalnum desc"
        set protected enable
    next
    edit "fndr-Weak-Cipher-Type-by-Percentage"
        set description "Weak Cipher Type by Percentage"
        set log-type ndr
        set dev-type FortiNDR
        set query "select ciphername, round(sum(totalnum)*100/sum(sum(totalnum)) over (), 2) as percentage from ###(select subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername, count(*) as totalnum from $log where $filter and subtype in ('Botnet', 'Encrypted', 'IPS attack', 'Weak cipher') and severity != 'info' group by subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername order by totalnum desc)### t where subtype='Weak cipher' group by ciphername order by percentage desc"
        set protected enable
    next
    edit "fndr-Weak-Cipher-Summary"
        set description "Weak Cipher Summary"
        set log-type ndr
        set dev-type FortiNDR
        set query "select severity, alproto, ciphername, srcip, dstip, sum(totalnum) as totalnum from ###(select subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername, count(*) as totalnum from $log where $filter and subtype in ('Botnet', 'Encrypted', 'IPS attack', 'Weak cipher') and severity != 'info' group by subtype, severity, srcip, dstip, botname, md5, vname, alproto, ciphername order by totalnum desc)### t where subtype='Weak cipher' group by severity, alproto, ciphername, srcip, dstip order by severity desc, totalnum desc"
        set protected enable
    next
end

config sql-report chart
    edit "fai-Attack-Scenario-Count"
        set disp-name "FortiNDR-Attack Scenario Count"
        set description "Attack Scenario Count"
        set category "FortiNDR"
        set dev-type FortiNDR
        set dataset "fai-Attack-Scenario-Count"
        set chart-type donut
        set chart-style "{\"legend-font\": \"size:9px;\", \"legend-position\": \"right\", \"inner-content\": \"summary-value\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set header ""
                set data-binding "scenariotype"
                set data-top 10
            next
            edit 2
                set header ""
                set data-binding "total_num"
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "fai-Files-Proccessed-Summary"
        set disp-name "FortiNDR-Files Proccessed Summary"
        set description "Files Proccessed Summary"
        set category "FortiNDR"
        set dev-type FortiNDR
        set dataset "fai-Files-Proccessed-Summary"
        set chart-type table
        config table-columns
            edit 1
                set header "Accepted"
                set data-binding "fileaccepted"
                set column-attr count
            next
            edit 2
                set header "Processed"
                set data-binding "fileprocessed"
                set column-attr count
            next
            edit 3
                set header "Detected(Malcious)"
                set data-binding "filedetected"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fai-Host-quarantined-Summary"
        set disp-name "FortiNDR-Host quarantined Summary"
        set description "Host quarantined Summary"
        set category "FortiNDR"
        set dev-type FortiNDR
        set dataset "fai-Host-quarantined-Summary"
        set chart-type table
        config table-columns
            edit 1
                set header "Host"
                set data-binding "host"
                set data-top 50
                set column-width 15
            next
            edit 2
                set header "Most Recent Action Time"
                set data-binding "most_recent"
                set column-width 20
            next
            edit 3
                set header "Automation Profile Name"
                set data-binding "profilename"
            next
            edit 4
                set header "Count"
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fai-Learnt-Customer-Features-Summary"
        set disp-name "FortiNDR-Learnt Customer Features Summary"
        set description "Learnt Customer Features Summary"
        set category "FortiNDR"
        set dev-type FortiNDR
        set dataset "fai-Learnt-Customer-Features-Summary"
        set chart-type donut
        set chart-style "{\"legend-position\": \"right\", \"inner-content\": \"summary-value\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set header ""
                set data-binding "feature"
            next
            edit 2
                set header ""
                set data-binding "total_num"
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "fai-System-Events-Summary"
        set disp-name "FortiNDR-System Events Summary"
        set description "System Events Summary"
        set category "FortiNDR"
        set dev-type FortiNDR
        set dataset "fai-System-Events-Summary"
        set chart-type table
        config table-columns
            edit 1
                set header "Date\/Time"
                set data-binding "timestamp"
                set data-top 200
            next
            edit 2
                set header "Level"
                set data-binding "severity"
            next
            edit 3
                set header "User"
                set data-binding "user"
            next
            edit 4
                set header "User Action"
                set data-binding "action"
            next
            edit 5
                set header "Message"
                set data-binding "msg"
            next
        end
        set protected enable
    next
    edit "fai-Malicious-File-Summary"
        set disp-name "FortiNDR-Malicious File Summary"
        set description "Malicious File Summary"
        set category "FortiNDR"
        set dev-type FortiNDR
        set dataset "fai-Malicious-File-Summary"
        set chart-type table
        config table-columns
            edit 1
                set header "File or URL"
                set data-binding "file"
                set data-top 100
                set column-attr obf-url2
                set column-width 20
            next
            edit 2
                set header "MD5"
                set data-binding "md5"
                set column-width 16
            next
            edit 3
                set header "Type"
                set data-binding "filetype"
                set column-width 5
            next
            edit 4
                set header "Victim IP"
                set data-binding "victimip"
                set data-type drilldown
                set data-top 5
                set column-width 15
            next
            edit 5
                set header "First Seen"
                set data-type drilldown
                set data-binding "first_seen"
                set column-width 10
            next
            edit 6
                set header "Last Seen"
                set data-type drilldown
                set data-binding "last_seen"
                set column-width 10
            next
            edit 7
                set header "Count"
                set data-type aggregate
                set data-binding "total_num"
                set column-width 5
            next
        end
        set protected enable
    next
    edit "fai-Detection-by-Device-Summary"
        set disp-name "FortiNDR-Detection by Device Summary"
        set description "Detection by Device Summary"
        set category "FortiNDR"
        set dev-type FortiNDR
        set dataset "fai-Detection-by-Device-Summary"
        set chart-type bar
        config table-columns
            edit 1
                set header "Device Name\/VDOM"
                set data-type raw
                set data-binding "devvd"
                set data-top 50
            next
            edit 2
                set header "Risk"
                set data-type drilldown
                set data-binding "risk"
                set data-top 0
            next
            edit 3
                set header "Count"
                set data-type aggregate
                set data-binding "total_num"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fai-Malware-Detection-Type-Summary"
        set disp-name "FortiNDR-Malware Detection Type Summary"
        set description "Malware Detection Type Summary"
        set category "FortiNDR"
        set dev-type FortiNDR
        set dataset "fai-Malware-Detection-Type-Summary"
        set chart-type donut
        set chart-style "{\"legend-position\": \"right\", \"inner-content\": \"summary-value\", \"show-value\": \"enable\"}"
        config table-columns
            edit 1
                set header ""
                set data-binding "detype"
            next
            edit 2
                set header ""
                set data-binding "total_num"
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "fai-Hosts-Infection-Summary"
        set disp-name "FortiNDR-Hosts Infection Summary"
        set category "FortiNDR"
        set dev-type FortiNDR
        set description "Hosts Infection Summary"
        set dataset "fai-Hosts-Infection-Summary"
        set chart-type table
        config table-columns
            edit 1
                set header "Host"
                set data-binding "victimip"
                set data-top 50
                set column-width 14
            next
            edit 2
                set header "Attack Scenario"
                set data-binding "detection_type"
                set data-type drilldown
                set column-attr detection-type
                set data-top 0
                set column-width 50
            next
            edit 3
                set header "Count"
                set data-binding "total_num"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fai-CPU-Memory-Summary"
        set disp-name "FortiNDR-CPU Memory Summary"
        set category "FortiNDR"
        set dev-type FortiNDR
        set description "CPU Memory Summary"
        set dataset "fai-CPU-Memory-Summary"
        set chart-type line
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "timestamp"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "avg_cpu"
                set column-graph-type line-up
                set legend "CPU"
            next
            edit 3
                set data-binding "avg_mem"
                set column-graph-type line-up
                set legend "MEM"
            next
            edit 4
                set data-binding "max_cpu"
                set column-graph-type line-up
                set legend "Max CPU"
            next
            edit 5
                set data-binding "max_mem"
                set column-graph-type line-up
                set legend "Max MEM"
            next
        end
        set protected enable
    next
    edit "fai-Detection-Summary-by-Device-Type"
        set disp-name "FortiNDR-Detection Summary by Device Type"
        set category "FortiNDR"
        set dev-type FortiNDR
        set description "Detection Summary by Device Type"
        set dataset "fai-Detection-Summary-by-Device-Type"
        set chart-type table
        config table-columns
            edit 1
                set header "Device Type"
                set data-binding "device_type"
                set data-top 50
            next
            edit 2
                set header "Count"
                set data-binding "total_num"
                set data-type aggregate
                set legend "Count"
                set column-attr count
            next
        end
        set protected enable
    next

    edit "fndr-Anomaly-Count-by-Severity-Timeline"
        set disp-name "FortiNDR-Toal Number of Anomalies by Severity Timeline"
        set category "FortiNDR"
        set dev-type FortiNDR
        set description "Toal Number of Anomalies by Severity Timeline"
        set dataset "fndr-Anomaly-Count-by-Severity-Timeline"
        set chart-type line
        set chart-style "{\"legend-position\":\"top\", \"y-title\": \"Counts\"}"
        config table-columns
            edit 1
                set header "Time"
                set data-binding "hodex"
                set column-attr time
                set data-top 0
            next
            edit 2
                set data-binding "critical_num"
                set column-graph-type line-up
                set legend "Critical"
            next
            edit 3
                set data-binding "high_num"
                set column-graph-type line-up
                set legend "High"
            next
            edit 4
                set data-binding "medium_num"
                set column-graph-type line-up
                set legend "Medium"
            next
            edit 5
                set data-binding "low_num"
                set column-graph-type line-up
                set legend "Low"
            next
        end
        set protected enable
    next
    edit "fndr-Anomaly-Type-and-Feature-by-Count"
        set disp-name "FortiNDR-Anomalies Types and Features by Count"
        set category "FortiNDR"
        set dev-type FortiNDR
        set description "Anomalies Types and Features by Count"
        set dataset "fndr-Anomaly-Type-and-Feature-by-Count"
        set chart-type bubble-ring
        set chart-style "{\"show-value\":\"enable\" }"
        set include-other disable
        config table-columns
            edit 1
                set header "Type"
                set data-binding "type"
                set data-top 10
            next
            edit 2
                set header "Feature"
                set data-type drilldown
                set data-binding "feature"
                set data-top 5
            next
            edit 3
                set data-binding "totalnum"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fndr-Botnet-Name-by-Count"
        set disp-name "FortiNDR-Botnet Name by Count"
        set description "Botnet Name by Count"
        set category "FortiNDR"
        set dev-type FortiNDR
        set dataset "fndr-Botnet-Name-by-Count"
        set chart-type donut
        set chart-style "{\"legend-position\":\"right\", \"inner-content\":\"summary\", \"show-header\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "botname"
                set data-top 10
            next
            edit 2
                set header "Counts"
                set data-binding "totalnum"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fndr-Botnet-Severity-by-Count"
        set disp-name "FortiNDR-Botnet Severity by Count"
        set description "Botnet Severity by Count"
        set category "FortiNDR"
        set dev-type FortiNDR
        set dataset "fndr-Botnet-Severity-by-Count"
        set chart-type donut
        set chart-style "{\"legend-position\":\"right\", \"inner-content\":\"summary\", \"show-header\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "severity"
                set data-top 10
            next
            edit 2
                set header "Counts"
                set data-binding "totalnum"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fndr-Botnet-Traffic-Summary"
        set disp-name "FortiNDR-Botnet Traffic Summary"
        set description "Botnet Traffic Summary"
        set category "FortiNDR"
        set dev-type FortiNDR
        set dataset "fndr-Botnet-Traffic-Summary"
        set chart-type table
        set chart-style "{\"table-scheme\":\"dark\"}"
        config table-columns
            edit 1
                set header "Severity"
                set data-binding "severity"
                set data-top 10
                set column-attr severity
                set column-span 2
            next
            edit 2
                set data-binding "severity"
            next
            edit 3
                set header "Source Address"
                set data-binding "srcip"
            next
            edit 4
                set header "Destination Address"
                set data-binding "dstip"
            next
            edit 5
                set header "Botnet Name"
                set data-binding "botname"
            next
            edit 6
                set header "Count"
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fndr-IOC-Campaign-by-Count"
        set disp-name "FortiNDR-IOC Campaign by Count"
        set description "IOC Campaign by Count"
        set category "FortiNDR"
        set dev-type FortiNDR
        set dataset "fndr-IOC-Campaign-by-Count"
        set chart-type donut
        set chart-style "{\"legend-position\":\"right\", \"inner-content\":\"summary\", \"show-header\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "campaign_name"
                set data-top 10
            next
            edit 2
                set header "Counts"
                set data-binding "totalnum"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fndr-IOC-Severity-by-Count"
        set disp-name "FortiNDR-IOC Severity by Count"
        set description "IOC Severity by Count"
        set category "FortiNDR"
        set dev-type FortiNDR
        set dataset "fndr-IOC-Severity-by-Count"
        set chart-type donut
        set chart-style "{\"legend-position\":\"right\", \"inner-content\":\"summary\", \"show-header\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "severity"
                set data-top 10
            next
            edit 2
                set header "Counts"
                set data-binding "totalnum"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fndr-IOC-Campaign-Summary"
        set disp-name "FortiNDR-IOC Campaign Summary"
        set description "IOC Campaign Summary"
        set category "FortiNDR"
        set dev-type FortiNDR
        set dataset "fndr-IOC-Campaign-Summary"
        set chart-type table
        set chart-style "{\"table-scheme\": \"dark\", \"show-total\": \"disable\", \"show-others\": \"disable\", \"show-percent\": \"disable\"}"
        config table-columns
            edit 1
                set header "Severity"
                set data-binding "severity"
                set data-top 10
                set column-attr severity
                set column-span 2
            next
            edit 2
                set data-binding "severity"
            next
            edit 3
                set header "Source Address"
                set data-binding "srcip"
            next
            edit 4
                set header "Campaign Name"
                set data-binding "campaign_name"
                set data-type drilldown
                set data-top 5
            next
            edit 5
                set header "Count"
                set data-binding "totalnum"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fndr-Encrypted-Severity-by-Count"
        set disp-name "FortiNDR-Encrypted Attack Severity by Count"
        set description "Encrypted Attack Severity by Count"
        set category "FortiNDR"
        set dev-type FortiNDR
        set dataset "fndr-Encrypted-Severity-by-Count"
        set chart-type donut
        set chart-style "{\"legend-position\":\"right\", \"inner-content\":\"summary\", \"show-header\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "severity"
                set data-top 10
            next
            edit 2
                set header "Counts"
                set data-binding "totalnum"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fndr-Encrypted-Attack-Summary"
        set disp-name "FortiNDR-Encrypted Attack Summary"
        set description "Encrypted Attack Summary"
        set category "FortiNDR"
        set dev-type FortiNDR
        set dataset "fndr-Encrypted-Attack-Summary"
        set chart-type table
        set chart-style "{\"table-scheme\":\"dark\"}"
        config table-columns
            edit 1
                set header "Severity"
                set data-binding "severity"
                set data-top 10
                set column-attr severity
                set column-span 2
            next
            edit 2
                set data-binding "severity"
            next
            edit 3
                set header "IOC Hash"
                set data-binding "md5"
            next
            edit 4
                set header "Source Address"
                set data-binding "srcip"
            next
            edit 5
                set header "Destination Address"
                set data-binding "dstip"
            next
            edit 6
                set header "Count"
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fndr-IPS-Attack-Name-by-Count"
        set disp-name "FortiNDR-IPS Attack Name by Count"
        set description "IPS Attack Name by Count"
        set category "FortiNDR"
        set dev-type FortiNDR
        set dataset "fndr-IPS-Attack-Name-by-Count"
        set chart-type donut
        set chart-style "{\"legend-position\":\"right\", \"inner-content\":\"summary\", \"show-header\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "vname"
                set data-top 10
            next
            edit 2
                set header "Counts"
                set data-binding "totalnum"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fndr-IPS-Severity-by-Count"
        set disp-name "FortiNDR-IPS Attack Severity by Count"
        set description "IPS Attack Severity by Count"
        set category "FortiNDR"
        set dev-type FortiNDR
        set dataset "fndr-IPS-Severity-by-Count"
        set chart-type donut
        set chart-style "{\"legend-position\":\"right\", \"inner-content\":\"summary\", \"show-header\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "severity"
                set data-top 10
            next
            edit 2
                set header "Counts"
                set data-binding "totalnum"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fndr-IPS-Attack-Summary"
        set disp-name "FortiNDR-IPS Attack Summary"
        set description "IPS Attack Summary"
        set category "FortiNDR"
        set dev-type FortiNDR
        set dataset "fndr-IPS-Attack-Summary"
        set chart-type table
        set chart-style "{\"table-scheme\":\"dark\"}"
        config table-columns
            edit 1
                set header "Severity"
                set data-binding "severity"
                set data-top 10
                set column-attr severity
                set column-span 2
            next
            edit 2
                set data-binding "severity"
            next
            edit 3
                set header "Attack Name"
                set data-binding "vname"
            next
            edit 4
                set header "Source Address"
                set data-binding "srcip"
            next
            edit 5
                set header "Destination Address"
                set data-binding "dstip"
            next
            edit 6
                set header "Count"
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fndr-ML-Anomaly-Feature-by-Count"
        set disp-name "FortiNDR-Machine Learning Anomaly Feature by Count"
        set description "Machine Learning Anomaly Feature by Count"
        set category "FortiNDR"
        set dev-type FortiNDR
        set dataset "fndr-ML-Anomaly-Feature-by-Count"
        set chart-type donut
        set chart-style "{\"legend-position\":\"right\", \"inner-content\":\"summary\", \"show-header\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "feature"
                set data-top 10
            next
            edit 2
                set header "Counts"
                set data-binding "totalnum"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fndr-ML-Severity-by-Count"
        set disp-name "FortiNDR-Machine Learning Anomaly Severity by Count"
        set description "Machine Learning Anomaly Severity by Count"
        set category "FortiNDR"
        set dev-type FortiNDR
        set dataset "fndr-ML-Severity-by-Count"
        set chart-type donut
        set chart-style "{\"legend-position\":\"right\", \"inner-content\":\"summary\", \"show-header\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "severity"
                set data-top 10
            next
            edit 2
                set header "Counts"
                set data-binding "totalnum"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fndr-ML-Anomaly-Summary"
        set disp-name "FortiNDR-Machine Learning Anomaly Summary"
        set description "Machine Learning Anomaly Summary"
        set category "FortiNDR"
        set dev-type FortiNDR
        set dataset "fndr-ML-Anomaly-Summary"
        set chart-type table
        set chart-style "{\"table-scheme\":\"dark\"}"
        config table-columns
            edit 1
                set header "Severity"
                set data-binding "severity"
                set data-top 10
                set column-attr severity
                set column-span 2
                set column-width 10
            next
            edit 2
                set data-binding "severity"
            next
            edit 3
                set header "Anomaly Feature(s)"
                set data-binding "reasons"
            next
            edit 4
                set header "Source Address"
                set data-binding "srcip"
                set column-width 15
            next
            edit 5
                set header "Count"
                set data-binding "totalnum"
                set column-attr count
                set column-width 10
            next
        end
        set protected enable
    next
    edit "fndr-Weak-Cipher-Protocol-by-Percentage"
        set disp-name "FortiNDR-Weak Cipher Protocol by Percentage"
        set category "FortiNDR"
        set dev-type FortiNDR
        set description "Weak Cipher Protocol by Percentage"
        set dataset "fndr-Weak-Cipher-Protocol-by-Percentage"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\", \"y-label\": \"flat\", \"fixed-bar-width\": \"3\", \"bar-color\": \"bubble-ring\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "Protocol"
                set data-binding "alproto"
                set data-top 5
            next
            edit 2
                set header "Percentage"
                set data-type aggregate
                set column-attr percent
                set data-binding "percentage"
            next
        end
        set protected enable
    next
    edit "fndr-Weak-Cipher-Severity-by-Count"
        set disp-name "FortiNDR-Weak Cipher Severity by Count"
        set description "Weak Cipher Severity by Count"
        set category "FortiNDR"
        set dev-type FortiNDR
        set dataset "fndr-Weak-Cipher-Severity-by-Count"
        set chart-type donut
        set chart-style "{\"legend-position\":\"right\", \"inner-content\":\"summary\", \"show-header\": \"enable\"}"
        config table-columns
            edit 1
                set data-binding "severity"
                set data-top 10
            next
            edit 2
                set header "Counts"
                set data-binding "totalnum"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fndr-Weak-Cipher-Type-by-Percentage"
        set disp-name "FortiNDR-Weak Cipher Type by Percentage"
        set category "FortiNDR"
        set dev-type FortiNDR
        set description "Weak Cipher Type by Percentage"
        set dataset "fndr-Weak-Cipher-Type-by-Percentage"
        set chart-type bar
        set chart-style "{\"orientation\": \"horizontal\", \"show-value\": \"enable\", \"y-label\": \"flat\", \"fixed-bar-width\": \"3\", \"bar-color\": \"bubble-ring\"}"
        set include-other disable
        config table-columns
            edit 1
                set header "Type"
                set data-binding "ciphername"
                set data-top 5
            next
            edit 2
                set header "Percentage"
                set data-type aggregate
                set column-attr percent
                set data-binding "percentage"
            next
        end
        set protected enable
    next
    edit "fndr-Weak-Cipher-Summary"
        set disp-name "FortiNDR-Weak Cipher Summary"
        set description "Weak Cipher Summary"
        set category "FortiNDR"
        set dev-type FortiNDR
        set dataset "fndr-Weak-Cipher-Summary"
        set chart-type table
        set chart-style "{\"table-scheme\":\"dark\"}"
        config table-columns
            edit 1
                set header "Severity"
                set data-binding "severity"
                set data-top 10
                set column-attr severity
                set column-span 2
            next
            edit 2
                set data-binding "severity"
            next
            edit 3
                set header "Protocol"
                set data-binding "alproto"
            next
            edit 4
                set header "Type"
                set data-binding "ciphername"
            next
            edit 5
                set header "Source Address"
                set data-binding "srcip"
            next
            edit 6
                set header "Destination Address"
                set data-binding "dstip"
            next
            edit 7
                set header "Count"
                set data-binding "totalnum"
                set column-attr count
            next
        end
        set protected enable
    next
end
config sql-report macro
    edit "fai-Files-Proccessed-Fileaccepted"
        set dev-type FortiNDR
        set disp-name "FortiNDR-FortiSandbox Files Accepted"
        set description "FortiSandbox Files Accepted"
        set dataset "fai-Files-Proccessed-Summary"
        set data-binding "fileaccepted"
        set protected enable
    next
    edit "fai-Files-Proccessed-Fileprocessed"
        set dev-type FortiNDR
        set disp-name "FortiNDR-FortiSandbox Files Proccessed"
        set description "FortiSandbox Files Proccessed"
        set dataset "fai-Files-Proccessed-Summary"
        set data-binding "fileprocessed"
        set protected enable
    next
    edit "fai-Files-Proccessed-Filedetected"
        set dev-type FortiNDR
        set disp-name "FortiNDR-FortiSandbox Files Detected"
        set description "FortiSandbox Files Detected"
        set dataset "fai-Files-Proccessed-Summary"
        set data-binding "filedetected"
        set protected enable
    next

    edit "fndr-Total-Number-of-Critical-Anomaly"
        set dev-type FortiNDR
        set disp-name "FortiNDR-Total Number of Critical Anomalies"
        set description "FortiNDR Total Number of Critical Anomalies"
        set dataset "fndr-Anomaly-Count-by-Severity"
        set data-binding "critical_num"
        set data-attr count
        set protected enable
    next
    edit "fndr-Total-Number-of-High-Anomaly"
        set dev-type FortiNDR
        set disp-name "FortiNDR-Total Number of High Anomalies"
        set description "FortiNDR Total Number of High Anomalies"
        set dataset "fndr-Anomaly-Count-by-Severity"
        set data-binding "high_num"
        set data-attr count
        set protected enable
    next
    edit "fndr-Total-Number-of-Medium-Anomaly"
        set dev-type FortiNDR
        set disp-name "FortiNDR-Total Number of Medium Anomalies"
        set description "FortiNDR Total Number of Medium Anomalies"
        set dataset "fndr-Anomaly-Count-by-Severity"
        set data-binding "medium_num"
        set data-attr count
        set protected enable
    next
    edit "fndr-Total-Number-of-Low-Anomaly"
        set dev-type FortiNDR
        set disp-name "FortiNDR-Total Number of Low Anomalies"
        set description "FortiNDR Total Number of Low Anomalies"
        set dataset "fndr-Anomaly-Count-by-Severity"
        set data-binding "low_num"
        set data-attr count
        set protected enable
    next
end

config sql-report layout
    edit 1000091001
        set is-template enable
        set dev-type FortiNDR
        set category "FortiNDR"
        set title "Template - FortiNDR Breach Prevention Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_fai.jpg"
        set description "FortiNDR Breach Prevention Report."
        set body "<div style=\"background-image: url(/resource/images/fazrpt_external/fai_header_bg.jpg); background-repeat: no-repeat; background-size: 100% 120px;\"><br><br><br><h1><strong><span style=\"color:#F0FFF0; margin-left:5px;\">Introduction to FortiNDR</span></strong></h1></div><p>FortiNDR is the next generation of Fortinet&#39;s malware detection technology, using Artificial Neural Networks (ANN) which can deliver sub-second malware detection and verdict. ANN is able to mimic human behavior using the Virtual Security Analyst<span style=\"font-size:10px\"><sup>TM</sup></span>. VSA<span style=\"font-size:10px\"><sup>TM</sup></span>&nbsp;can assist security operations to perform the following functions:</p><ul><li><span style=\"text-align: justify; font-size: 10pt;\">Analyze malware scientifically by classifying malware based on its detected features, for example, ransomware, downloader, coin-miner, and so on.</span></li><li><span style=\"text-align: justify; font-size: 10pt;\">Trace the origins of the attack, for example, worm infection.</span></li><li><span style=\"text-align: justify; font-size: 10pt;\"> Outbreak search can use the similarity engine to search for malware outbreaks with hashes and similar variants in the network.</span></li><li><span style=\"text-align: justify; font-size: 10pt;\">Take advantage of Fortinet Security Fabric to integrate with different Fortinet and 3rd party solutions, such as FortiGates,&nbsp;FortiSandbox, FortiWeb, FortiAnalyzer and FortiSIEM.</span></li></ul><p>&nbsp;</p><p>The following report will provide a technical summary of FortiNDR solution in your environment.</p><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\" style=\"width:720px\"><tbody><tr><td style=\"background-color:rgb(0, 102, 102); width:10px; height: 60px;\">&nbsp;</td><td style=\"background-color:rgb(0, 102, 102); width:40px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/accepted.png\" style=\"height:40px; width:40px; margin-top: 3px;\" /></td><td style=\"background-color:rgb(0, 102, 102); width:100px\"><strong><span style=\"color:#F0FFF0; font-size:14px; margin-left:10px\">File</span><br/><span style=\"color:#F0FFF0; font-size:14px; margin-left:10px\">Accepted</span></strong></td><td style=\"background-color:rgb(0, 102, 102); width:10px;\">&nbsp;</td><td style=\"background-color:rgb(0, 102, 102); width:70px;\"><p><span style=\"color:#FFFFE0; font-size:20px\"><strong><fazmacro mkey=\"fai-Files-Proccessed-Fileaccepted\"></fazmacro></strong></span></p></td><td style=\"width:10px\">&nbsp;</td><td style=\"background-color:rgb(255, 153, 51); width:10px;\">&nbsp;</td><td style=\"background-color:rgb(255, 153, 51); width:40px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/processed.png\" style=\"height:40px; width:40px; margin-top: 3px;\" /></td><td style=\"background-color:rgb(255, 153, 51); width:100px\"><strong><span style=\"color:#F0FFF0; font-size:14px; margin-left:10px\">File</span><br/><span style=\"color:#F0FFF0; font-size:14px; margin-left:10px\">Processed</span></strong></td><td style=\"background-color:rgb(255, 153, 51); width:10px;\">&nbsp;</td><td style=\"background-color:rgb(255, 153, 51); width:70px;\"><span style=\"color:#FFFFE0; font-size:20px\"><strong><fazmacro mkey=\"fai-Files-Proccessed-Fileprocessed\"></fazmacro></strong></span></td><td style=\"width:10px\">&nbsp;</td><td style=\"background-color:rgb(204, 51, 0); width:10px;\">&nbsp;</td><td style=\"background-color:rgb(204, 51, 0); width:40px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/detected.png\" style=\"height:40px; width:40px; margin-top: 3px;\" /></td><td style=\"background-color:rgb(204, 51, 0); width:100px;\"><strong><span style=\"color:#F0FFF0; font-size:14px; margin-left:10px\">Malicious</span><br/><span style=\"color:#F0FFF0; font-size:14px; margin-left:10px\">Detected</span></strong></td><td style=\"background-color:rgb(204, 51, 0); width:10px;\">&nbsp;</td><td style=\"background-color:rgb(204, 51, 0); width:70px;\"><span style=\"color:#FFFFE0; font-size:20px\"><strong><fazmacro mkey=\"fai-Files-Proccessed-Filedetected\"></fazmacro></strong></span></td></tr></tbody></table><p>&nbsp;</p><h2><strong>Virtual Security Analyst &trade; of Attack Scenarios &amp; Malware Types on Network</strong></h2><p>Understanding malware types and intentions is important to investigating attacks. The following chart summarises attack scenarios detected on the network.</p><fazchart mkey=\"fai-Attack-Scenario-Count\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><h2><strong>Quarantined Host Summary</strong></h2><p>FortiNDR has the ability to quarantine hosts via FortiGate if required. Below is a list of infected hosts and successful quarantine by FortiNDR detection with FortiGate(s) for the reporting period.</p><fazchart mkey=\"fai-Host-quarantined-Summary\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><h2><strong>FortiNDR On-Premise Learning</strong></h2><p>FortiNDR Artificial Neural Network has ability to learn from local traffic to reduce false positive and increase detection rates, please find some of the features learnt below.</p><fazchart mkey=\"fai-Learnt-Customer-Features-Summary\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><h2><strong>FortiNDR Malicious Files Details</strong></h2><fazchart mkey=\"fai-Malicious-File-Summary\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><h2><strong>FortiNDR Detection by Device Type</strong></h2><p>The following shown detection is by device (e.g. Sniffer, ICAP and FortiGate VDOMs).</p><fazchart mkey=\"fai-Detection-Summary-by-Device-Type\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><h2><strong>FortiNDR Detection by Device</strong></h2><fazchart mkey=\"fai-Detection-by-Device-Summary\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><h2><strong>Malware Detection Type</strong></h2><p> Apart from concluded attack scenarios, malware can be made up of different techniques, e.g. A ransomware containing downloader features. FortiNDR call these detection types. The following shows an overall detection types of mwlare on network. Note: this is different to attack scenarios.</p><fazchart mkey=\"fai-Malware-Detection-Type-Summary\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><h2><strong>FortiNDR Host(s) Summary Page</strong></h2><p>The following focuses on hosts infection summary over the reporting period. This chart is particularly useful for forensic of particular hosts to determine the history of host infections over the reporting period. </p><fazchart mkey=\"fai-Hosts-Infection-Summary\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><h2><strong>FortiNDR System Usage Summary</strong></h2><p>The following shows CPU and memory usage of FortiNDR over the reporting period.</p><fazchart mkey=\"fai-CPU-Memory-Summary\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p><h2><strong>FortiNDR System Events</strong></h2><p>The following table details important system events for FortiNDR.</p><fazchart mkey=\"fai-System-Events-Summary\" title=\"\" width=\"100%\"></fazchart><p>&nbsp;</p>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90119
                next
                edit 90203
                next
            end
        set report-tag "fortiai"
        set protected enable
    next
    edit 1000091002
        set is-template enable
        set dev-type FortiNDR
        set category "FortiNDR"
        set title "Template - FortiNDR Network Anomalies Report"
        set description "Present a brief report of Network Anomalies detected by Fortinet Network Detection and Response product FortiNDR."
        set body "<div style=\"height:10px\"></div><table style=\"width:100%\" cellpadding=\"0\" cellspacing=\"0\"><tr><td style=\"vertical-align:middle; width:70px\"><p><img data-local=\"true\" src=\"/resource/images/fazrpt_external/fndr_intro.png\" style=\"height:55px; width:60px\" /></p></td><td style=\"vertical-align:middle\"><span style=\"font-size:16px\"> INTRODUCTION</span></td></tr></table><p>FortiNDR is the Fortinet Network Detection and Response product responsibe for detecting Network Anomalies with auto and manual mitigation techniques. </p><p>Apart from network anomalies and attack, FortiNDR also uses <b>Artificial Neural Networks (ANN)</b> to provide sub-second malware detection and verdict.</p><div style=\"height:15px\"></div><p><b>FortiNDR's ANN</b> is able to mimic human behavior using the Virtual Security Analyst (VSA) <sup>TM</sup>, which is capable of the following:</p><div style=\"height:10px\"></div><table style=\"width:100%\" align=\"center\" cellpadding=\"0\" cellspacing=\"5\"><tr><td style=\"width:300px; vertical-align:top\"><div style=\"width:260px; height:300px\"><div style=\"padding-top:10px; padding-left:110px; padding-right:5px\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/fndr_attack.png\" style=\"height:55px; width:55px\" /></div><div style=\"padding-top:2px; padding-left:8px; padding-right:5px\"><ul><li><span style=\"font-size:12px\">Detect encrypted attack (via JA3 hashs), look for presence of malicious web campaigns visited , weaker ciphers, vulnerable protocols, network- and botnet-based attacks.</span></li></ul></div><div style=\"padding-top:10px; padding-left:8px; padding-right:5px\"><ul><li><span style=\"font-size:12px\">Profile ML traffic and identify anomalies with user feedback mechanism.</span></li></ul></div></div></td><td style=\"width:300px; vertical-align:top\"><div style=\"width:260px; height:300px\"><div style=\"padding-top:10px; padding-left:110px; padding-right:5px\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/fndr_malicious.png\" style=\"height:55px; width:55px\" /></div><div style=\"padding-top:2px; padding-left:8px; padding-right:5px\"><ul><li><span style=\"font-size:12px\">Detect malicious files in sub-seconds through neural network analysis including NFS file scan shares.</span></li></ul></div><div style=\"padding-top:10px; padding-left:8px; padding-right:5px\"><ul><li><span style=\"font-size:12px\">Analyze malware scientifically by classifying malware based on its detected features, for example, Ransomware, Downloader, CoinMiner, and so on.</span></li></ul></div><div style=\"padding-top:10px; padding-left:8px; padding-right:5px\"><ul><li><span style=\"font-size:12px\">Trace the origins of the attack, for example, Worm infection.</span></li></ul></div></div></td><td style=\"width:300px; vertical-align:top\"><div style=\"width:260px; height:300px\"><div style=\"padding-top:10px; padding-left:110px; padding-right:5px\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/fndr_outbreak.png\" style=\"height:55px; width:55px\" /></div><div style=\"padding-top:2px; padding-left:8px; padding-right:5px\"><ul><li><span style=\"font-size:12px\">OutBreak search can use the similarity engine to search for malware outbreaks with hashes and similar variants in the network.</span></li></ul></div><div style=\"padding-top:10px; padding-left:8px; padding-right:5px\"><ul><li><span style=\"font-size:12px\">Take advantage of Fortinet's Security Fabric with FortiGate(s) and other Fortinet Security Fabric solutions, along with 3rd party API calls, to quarantine infected hosts.</span></li></ul></div></div></td></tr></table><p></p><div style=\"page-break-after: always\"></div><div style=\"height:10px\"></div><h2><span style=\"font-size:16px; font-family:Lato; color:black\">ANOMALIES</span></h2><h2><span style=\"font-size:16px; color:grey\">ANOMALY OVERVIEW</span></h2><div style=\"height:10px\"></div><table style=\"padding-top:5px; width:100%\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\"><tr><td style=\"vertical-align:bottom; width:28px\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/fndr_risk_critical.png\" style=\"height:24px; width:24px\" /></td><td style=\"vertical-align:bottom\"><b><span style=\"font-size:24px\"><fazmacro mkey=\"fndr-Total-Number-of-Critical-Anomaly\"></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato\"> Critical Risk</span></td><td style=\"vertical-align:bottom; width:28px\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/fndr_risk_high.png\" style=\"height:24px; width:24px\" /></td><td style=\"vertical-align:bottom\"><b><span style=\"font-size:24px\"><fazmacro mkey=\"fndr-Total-Number-of-High-Anomaly\"></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato\"> High Risk</span></td><td style=\"vertical-align:bottom; width:28px\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/fndr_risk_med.png\" style=\"height:24px; width:24px\" /></td><td style=\"vertical-align:bottom\"><b><span style=\"font-size:24px\"><fazmacro mkey=\"fndr-Total-Number-of-Medium-Anomaly\"></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato\"> Medium Risk</span></td><td style=\"vertical-align:bottom; width:27px\"><img data-local=\"true\" src=\"/resource/images/fazrpt_external/fndr_risk_low.png\" style=\"height:24px; width:24px\" /></td><td style=\"vertical-align:bottom\"><b><span style=\"font-size:24px\"><fazmacro mkey=\"fndr-Total-Number-of-Low-Anomaly\"></fazmacro></span></b><span style=\"font-size:16px; font-family:Lato\"> Low Risk</span></td></tr></table><div style=\"height:15px\"></div><div style=\"height:15px\"></div><h2><span style=\"font-size:16px; color:grey\">ANOMALIES FOR REPORTING PERIOD</span></h2><div style=\"height:10px\"></div><div><fazchart width=\"1000px\" title=\"\" mkey=\"fndr-Anomaly-Count-by-Severity-Timeline\"></fazchart></div><div style=\"page-break-after: always\"></div><div><fazchart width=\"1000px\" title=\"ANOMALIES TYPES\" mkey=\"fndr-Anomaly-Type-and-Feature-by-Count\"></fazchart></div><div style=\"page-break-after: always\"></div><div style=\"height:15px\"></div><h2><span style=\"font-size:16px; font-family:Lato; color:black\">TOP 10 BOTNET TRAFFIC</span></h2><table style=\"width:100%\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\"><tr><td style=\"vertical-align:top\"><fazchart width=\"490px\" title=\"Botnet Name\" mkey=\"fndr-Botnet-Name-by-Count\"></fazchart></td><td style=\"vertical-align:top\"><fazchart width=\"490px\" title=\"Severity\" mkey=\"fndr-Botnet-Severity-by-Count\"></fazchart></td></tr></table><div style=\"height:15px\"></div><div><fazchart width=\"1000px\" title=\"\" mkey=\"fndr-Botnet-Traffic-Summary\"></fazchart></div><div style=\"page-break-after: always\"></div><div style=\"height:15px\"></div><h2><span style=\"font-size:16px; font-family:Lato; color:black\">TOP 10 FORTIGUARD IOC (MALICIOUS WEB CAMPAIGNS)</span></h2><h2><span style=\"font-size:15px; color:grey\">(Below DONUT charts show number of infections per campaign and by severity.)</span></h2><table style=\"width:100%\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\"><tr><td style=\"vertical-align:top\"><fazchart width=\"490px\" title=\"Campaign Name\" mkey=\"fndr-IOC-Campaign-by-Count\"></fazchart></td><td style=\"vertical-align:top\"><fazchart width=\"490px\" title=\"Severity\" mkey=\"fndr-IOC-Severity-by-Count\"></fazchart></td></tr></table><div style=\"height:15px\"></div><div><fazchart width=\"1000px\" title=\"\" mkey=\"fndr-IOC-Campaign-Summary\"></fazchart></div><div style=\"page-break-after: always\"></div><div style=\"height:15px\"></div><h2><span style=\"font-size:16px; font-family:Lato; color:black\">TOP 10 ENCRYPTED ATTACKS</span></h2><table style=\"width:100%\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\"><tr><td style=\"vertical-align:top\"><fazchart width=\"490px\" title=\"Severity\" mkey=\"fndr-Encrypted-Severity-by-Count\"></fazchart></td></tr></table><div style=\"height:15px\"></div><div><fazchart width=\"1000px\" title=\"\" mkey=\"fndr-Encrypted-Attack-Summary\"></fazchart></div><div style=\"page-break-after: always\"></div><div style=\"height:15px\"></div><h2><span style=\"font-size:16px; font-family:Lato; color:black\">TOP 10 NETWORK ATTACKS</span></h2><h2><span style=\"font-size:15px; color:grey\">(BY SEVERITY AND COUNT)</span></h2><table style=\"width:100%\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\"><tr><td style=\"vertical-align:top\"><fazchart width=\"490px\" title=\"Attack Name\" mkey=\"fndr-IPS-Attack-Name-by-Count\"></fazchart></td><td style=\"vertical-align:top\"><fazchart width=\"490px\" title=\"Severity\" mkey=\"fndr-IPS-Severity-by-Count\"></fazchart></td></tr></table><div style=\"height:15px\"></div><div><fazchart width=\"1000px\" title=\"\" mkey=\"fndr-IPS-Attack-Summary\"></fazchart></div><div style=\"page-break-after: always\"></div><div style=\"height:15px\"></div><h2><span style=\"font-size:16px; font-family:Lato; color:black\">TOP 10 MACHINE LEARNING NETWORK ANOMALIES</span></h2><table style=\"width:100%\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\"><tr><td style=\"vertical-align:top\"><fazchart width=\"490px\" title=\"Anomaly Feature(s)\" mkey=\"fndr-ML-Anomaly-Feature-by-Count\"></fazchart></td><td style=\"vertical-align:top\"><fazchart width=\"490px\" title=\"Severity\" mkey=\"fndr-ML-Severity-by-Count\"></fazchart></td></tr></table><div style=\"height:15px\"></div><div><fazchart width=\"1000px\" title=\"\" mkey=\"fndr-ML-Anomaly-Summary\"></fazchart></div><div style=\"page-break-after: always\"></div><div style=\"height:15px\"></div><h2><span style=\"font-size:16px; font-family:Lato; color:black\">TOP 10 WEAK CIPHER & VULNERABLE PROTOCOLS</span></h2><table style=\"width:100%\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\"><tr><td style=\"vertical-align:top\"><fazchart width=\"490px\" title=\"\" mkey=\"fndr-Weak-Cipher-Protocol-by-Percentage\"></fazchart></td><td style=\"vertical-align:top\"><fazchart width=\"390px\" title=\"Severity\" mkey=\"fndr-Weak-Cipher-Severity-by-Count\"></fazchart></td></tr></table><div style=\"height:15px\"></div><div style=\"height:15px\"></div><div style=\"height:15px\"></div><table style=\"width:100%\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\"><tr><td style=\"vertical-align:top\"><fazchart width=\"490px\" title=\"\" mkey=\"fndr-Weak-Cipher-Type-by-Percentage\"></fazchart></td></tr></table><div style=\"page-break-after: always\"></div><div style=\"height:15px\"></div><h2><span style=\"font-size:16px; font-family:Lato; color:black\">TOP 10 WEAK CIPHER & VULNERABLE PROTOCOLS</span></h2><div><fazchart width=\"1000px\" title=\"\" mkey=\"fndr-Weak-Cipher-Summary\"></fazchart></div>"
            config header
                edit 1
                    set type graphic
                    set graphic "header_webusage_bg.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90119
                next
            end
        set report-tag "concise"
        set protected enable
    next
end

config sql-report schedule
     edit "1000091001"
         set is-template enable
         set description "FortiNDR Breach Prevention Report"
         set schedule-type every-n-weeks
         set schedule-frequency 1
         set schedule-valid-start 00:00 2012/10/01
         set time-period last-7-days
         set display-table-contents enable
         set output-format pdf
         set dev-type FortiNDR
         set schedule-color "#5484ED"
         config report-layout
             edit 1000091001
             next
         end
         config devices
            edit All_FortiNDR
            next
         end
    next
    edit "1000091002"
         set is-template enable
         set description "FortiNDR Network Anomalies Report"
         set status disable
         set include-coverpage disable
         set display-table-contents disable
         set output-format pdf
         set dev-type FortiNDR
         set schedule-color "#5484ED"
         set resolve-hostname disable
         set device-list-type none
         set orientation landscape
         config report-layout
             edit 1000091002
             next
         end
         config devices
            edit All_FortiNDR
            next
         end
    next
end

config sql-report layout-folder
    edit 99999
        set folder-name "Default Templates"
        set protected enable
    next
    edit 90119
        set folder-name "FortiNDR Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90203
        set folder-name "SOC Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90205
        set folder-name "Outbreak Alert Reports Templates"
        set parent-id 99999
        set protected enable
    next
end

config alert basic-handler
    edit 90001
        set name "Default-FAI-Malware-Detection-By-FAI"
        set description "Default FortiNDR event handler to detect malware"
        config rule
            edit 1
                set name "Malware deteted"
                set devtype FortiAI
                set severity high
                set logtype "attack"
                set utmevent "Malware"
                set extrainfo ""
                set extrainfo-type default
                set subject "Malware: $groupby2 detected"
                set groupby1 "victimip"
                set groupby2 "detype"
                set eventstatus "open"
                set tags "Default,Malware,Detection"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr ""
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fai"
    next
end


config sql-report dataset
end


config sql-report chart
end
config sql-report macro
end

config sql-report layout
    edit 1000090001
        set dev-type Fabric
        set category "Fabric"
        set is-template enable
        set title "Template - Fortinet Email Risk Assessment"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Email remains a critical tool for business, as well as a successful delivery vehicle for cybercriminals. To assess your organization's exposure, we added Fortinet's secure email gateway - FortiMail Cloud (including various advanced threat defense capabilities) in bcc mode in order to receive a copy of all email traffic being delivered by your current in-built security to both your end users' inboxes and external recipients."
        set body "<p style=\"text-align:center\"><span style=\"font-size:36px\"><span style=\"color:rgb(192, 0, 0); font-family:calibri,sans-serif; line-height:107%\">Fortinet Email Risk Assessment</span></span></p><p><span style=\"font-size:16px\"><strong>Introduction</strong></span></p><p><span style=\"font-size:14px\"><span style=\"font-family:open sans\">Email remains a critical tool for business, as well as a successful delivery vehicle for cybercriminals.&nbsp; &nbsp;According to industry sources,</span></span></p><ul><li><span style=\"font-size:14px\"><span style=\"font-family:open sans\">49% of (non-PoS) malware was installed by malicious email</span></span></li><li><span style=\"font-size:14px\"><span style=\"font-family:open sans\">15,690 complaints of business email compromise cost an estimated $675m</span></span></li><li><span style=\"font-size:14px\"><span style=\"font-family:open sans\">One successful spear phishing campaign stole 31 TB of data that cost almost $3.4bn to procure</span></span></li></ul><p><span style=\"font-size:14px\"><span style=\"font-family:open sans\">It makes perfect sense to outsource key productivity tools like Office 365 and Exchange Online to the vendor, Microsoft, to manage and maintain.&nbsp; They are the experts who created them after all.&nbsp; Securing them however is another matter.&nbsp;</span></span></p><p><span style=\"font-size:14px\"><span style=\"font-family:open sans\"><span style=\"line-height:107%\">To assess your organization&rsquo;s exposure, we added Fortinet&rsquo;s secure email gateway- FortiMail Cloud (including various advanced threat defense capabilities) in bcc mode in order to receive a copy of all email traffic being delivered by your current in-built security to both your end users&rsquo; inboxes and external recipients.&nbsp; Over </span> a the past month we analyzed&nbsp;</span><fazmacro mkey=\"fml-Total-Counts-Inbound\"></fazmacro><span style=\"font-family:open sans\"> </span>messages that were delivered after being inspected by your current solution.&nbsp; The analysis does have one notable exception, any sender based anti-spoofing analysis was skipped as all the BCC messages were sourced the IP of your current mail solution<span style=\"font-family:calibri,sans-serif; line-height:107%\">.</span></span></p><h1><strong><span style=\"font-size:16px\">Executive&nbsp;Summary</span></strong></h1><p><span style=\"font-size:14px\">Of the email delivered to inboxes<span style=\"font-family:open sans\">, it appears that:</span></span></p><ol><li><span style=\"color:#000000\"><span style=\"font-size:14px\"> We identified&nbsp;<fazmacro mkey=\"fml-Total-Classified-Inbound\"></fazmacro> &nbsp;messages as unwanted/bulk/spam or malware infected,&nbsp;<fazmacro mkey=\"fml-Percentage-of-Unwanted-Mails\"></fazmacro> % of the total mail volume.</span></span></li><li><span style=\"color:#000000\"><span style=\"font-size:14px\"> We identified&nbsp;<fazmacro mkey=\"fml-Total-Malware-Inbound\"></fazmacro> messages as containing known malware/viruses or malicious links as identified by AntiVirus,&nbsp;<fazmacro mkey=\"fml-Percentage-of-Known-Malware\"></fazmacro> % of the total mail volume.</span></span><span style=\"color:#000000\"><span style=\"font-size:14px\"> </span></span></li><li><span style=\"color:#000000\"><span style=\"font-size:14px\"> We identified&nbsp;<fazmacro mkey=\"fsa-Total-New-Email-Malware\"></fazmacro></span> &nbsp;messages as containing new/unknown malware by Sandboxing Analysis.</span></li><li><span style=\"color:#000000\"><span style=\"font-size:14px\"> In&nbsp;addition,&nbsp;<fazmacro mkey=\"fml-Impersonation-Analysis-Total-Count\"></fazmacro> impersonation emails were identified.</span></span></li></ol><p><span style=\"font-size:14px\">Here is a break down of your total inbound messages counts, as classified by FortiMail</span></p><div><fazchart mkey=\"fml-Top-Disposition-Classifiers-Pie\" title=\"{default}\" width=\"100%\"></fazchart><p><span style=\"font-size:14px\">Here is a breakdown of inbound messages containing some type of Mailicous Threat, as identified by the AV Engine or Sandboxing&nbsp;Services</span></p><fazchart mkey=\"fml-Messages-Malware-Inbound\" title=\"Count by Anti-Malware Tools\" width=\"100%\"></fazchart></div><p>&nbsp;</p><p><span style=\"font-size:14px\">More details follow, but consider that the average cost of a data breach can range from $25,425 per 100 record lost to much more.&nbsp;</span></p><div><div><p><span style=\"font-size:14px\">Verizon. 2016 DBIR.</span></p><p style=\"text-align:center\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/breach-costs.png\" style=\"height:244px; width:600px\" /></p><div><p><span style=\"font-size:14px\">Further, according to the FBI, email fraud (impersonation) cost an average of $52,000 per incident.&nbsp; And ransoms vary- $51,000 in the case of one city government this year, with no guarantee of getting your data/systems unlocked.</span></p></div><div><div><p><span style=\"font-size:14px\">FBI.&nbsp; 2017 Internet Crime Report.</span></p></div><div><p><span style=\"font-size:14px\">Security Week. Atlanta Says Further $9.5 Million Needed for Ransomware Recovery.</span></p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1><strong><span style=\"font-size:16px\">Threat Details</span></strong></h1></div></div></div></div><div><h2><strong><span style=\"font-size:14px\">Unwanted Bulk Email</span></strong></h2><p><span style=\"font-size:14px\"> For the reported period we inspected a total of&nbsp;<fazmacro mkey=\"fml-Total-Counts-Inbound\"></fazmacro> inbound messages.&nbsp;</span></p><p><span style=\"font-size:14px\"> Of them, more than&nbsp;<fazmacro mkey=\"fml-Total-Classified-Inbound\"></fazmacro> spam messages and newsletters were delivered to your end users.&nbsp;</span></p><p><span style=\"font-size:14px\">The top&nbsp;10 spam senders by volume to the customer domain were:</span></p><fazchart mkey=\"fml-History-Top10-Sender\" title=\"{default}\" width=\"100%\"></fazchart><p><span style=\"font-size:14px\">The top 10 spam recipients on the customer domain were:</span></p><fazchart mkey=\"fml-Top-Spammed-Users\" title=\"Top Spammed Users\" width=\"100%\"></fazchart><p><span style=\"font-size:14px\">In some cases, organizations choose to send marketing and other broad communications from their primary domain.&nbsp; If that is the case for you, it is recommended to ensure proper rate limiting and other outbound controls to ensure that your domain does not end up on a volume-based blacklist.&nbsp; As many have experienced this impacts the entire organization and can take months and many dollars to resolve.</span></p><p><span style=\"font-size:14px\">In other cases, this volume comes from compromised hosts or mail servers which should definitely be investigated and remediated.</span></p><h2><span style=\"font-size:14px\"><strong>Known Malware</strong></span></h2><p><span style=\"font-size:14px\"> By applying the existing intelligence of our FortiGuard Labs to your email traffic, we&rsquo;ve<fazmacro mkey=\"fml-Total-Malware-Inbound\"></fazmacro> &nbsp;identified known viruses on their way to your end user inboxes.&nbsp; Below you can see the top malware identified by volume.</span></p><fazchart mkey=\"fml-Messages-AntiVirus-Inbound-with-Details\" title=\"Identified Known Viruses\" width=\"100%\"></fazchart><p><span style=\"font-size:14px\">Organizations should immediately check endpoint logs, directly or via a SIEM or other tool, to ensure the known viruses that bypassed your email security solution were not installed by recipients.</span></p><p><span style=\"font-size:14px\">You can also see the top sources of that malware, are shown above, due to BCC collection method.&nbsp; Reports can include recipients and other elements, which could help identify users in need of additional malware knowledge&nbsp;training.&nbsp;&nbsp;</span></p><p><span style=\"font-size:14px\">Depending on the type of malware, costs of successful compromise can range from an expected cost of $25,425 in the case of a small (100 record) data breach (Verizon, 2016) to much more.&nbsp; Further credentials, intellectual property and other sensitive data can be lost.&nbsp; While top data types lost in 2017 were personal, payment and medical information, credentials, internal information and secrets were also routinely stolen.</span></p><h2><span style=\"font-size:14px\"><strong>Previously Unknown Malware</strong></span></h2><p><span style=\"font-size:14px\">In addition to analysis against known threat intelligence, objects and URLs were also sent for dynamic sandbox assessment.&nbsp; As a secure instrumented virtual environment that simulates end user interaction with files and links, we are able to automatically assess runtime behavior of not only the initial but also full lifecycle of components and communications to identify heretofore unknown attacks.</span></p><p><span style=\"font-size:14px\">While not 100% certain in all cases, sandbox identification is accompanied by a risk rating that ranges from malicious to clean, with low, medium and high designations in between.</span></p><p><span style=\"font-size:14px\">You can see that the majority of ratings were malicious detections made by the sandbox- above and beyond the known malware discussed in the prior section- in addtion to a small, but still significant portion of high risk files.</span></p><fazchart mkey=\"fsa-Top-Email-Risk-Files\" title=\"Top 10 - FortiSandbox Risk files found\" width=\"100%\"></fazchart><p>&nbsp;</p><fazchart mkey=\"fsa-Email-Risk-Rating-by-File\" title=\"Top10 - FortiSandbox risk rating by file\" width=\"100%\"></fazchart><p>&nbsp;</p><fazchart mkey=\"fml-Messages-FSA-Inbound-Only-URI\" title=\"Top 10 - FortiSandbox scanned URI\" width=\"100%\"></fazchart><p>&nbsp;</p><fazchart mkey=\"fsa-Email-Risk-Rating-by-URL\" title=\"Top10 - FortiSandbox risk rating by URL\" width=\"100%\"></fazchart><p><span style=\"font-size:14px\">While file type mix will vary by organization, a growing practice among cybercriminals is the embedding of active code within legitimate file types.&nbsp; Especially if you are seeing a significant number of java or other scripts, Flash files or other non-traditional executables, consider using content disarm and reconstruction (at least for external-originated email to the broad population) to remove all active embedded code while preserving the original file type and initial email.&nbsp;&nbsp;</span></p><h2><span style=\"font-size:14px\"><strong>Email Fraud/Business Email Compromise</strong></span></h2><p><span style=\"font-size:14px\">While malicious code and URIs typically constitute the majority of attacks and risks today, there is a growing class of attacks that use neither, making detection by traditional means challenging.&nbsp; Instead social engineering is used to establish, fraudulently, a position of authority and/or trust in order to ultimately convince the end user to take an action they otherwise wouldn&rsquo;t.&nbsp; Such actions could include wiring money, purchasing and sending something of monetary value or otherwise sending information that can be turned into money.</span></p><p><span style=\"font-size:14px\"> Of note, we identified<fazmacro mkey=\"fml-Impersonation-Analysis-Total-Count\"></fazmacro> emails that triggered our impersonation analysis, above and beyond those that may have been flagged by sender authentication checks had we deployed inline in front of your current email security solution.</span></p><fazchart mkey=\"fml-Impersonation-Analysis-Senders\" title=\"{default}\" width=\"100%\"></fazchart><h2><strong><span style=\"font-size:14px\">General Email Statistics</span></strong></h2><p><span style=\"font-size:14px\">The total number of emails processed over the test period is shown below:</span></p><fazchart mkey=\"fml-Number-of-Mails\" title=\"Number of Mails\" width=\"100%\"></fazchart><p>&nbsp;</p><p><span style=\"font-size:14px\"><strong>Advanced Protection with Fortinet Email Security</strong></span></p></div><p><span style=\"font-size:14px\">As you can see from this assessment, Fortinet Email Security can help address the latest email threats and reduce the time required for security administration, incident investigation, and response.</span></p><p><span style=\"font-size:14px\">Given the average (conservative cost) of just one incident- breach, business email compromise, ransomware or otherwise- making at least a modest investment in FortiMail as a supplement to the in-built email security of Microsoft Office 365 typically makes sense both security and financial sense.&nbsp;</span></p><p style=\"text-align:center\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/FortiGuard-Services.jpg\" style=\"height:350px; width:715px\" /></p><p>&nbsp;</p><p><span style=\"font-size:14px\">A range of easy-to-use form factors allows any organization to implement Fortinet Email Security, and their own Fortinet Security Fabric, to secure and even free up resources to enable their digital business.&nbsp; FortiMail can supplement or replace the current email security solution.</span></p><p><span style=\"font-size:14px\">More information on Fortinet FortiMail can be found <a href=\"https://www.fortinet.com/products/email-security.html\">online</a> and via the trusted partner who conducted this assessment for you.</span></p><p>&nbsp;</p><p style=\"text-align:center\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/FortiGuard-Wheel.png\" style=\"height:614px; width:715px\" /></p>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90100
                next
                edit 90203
                next
            end
        set protected enable
    next
    edit 1000090002
        set dev-type Fabric
        set category "Fabric"
        set is-template enable
        set title "Template - FortiPortal User Summary Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "FortiPortal User Summary Report."
        set body "<h1>1. Bandwidth and Application</h1><fazchart mkey=\"Top-Web-Sites-by-Bandwidth\" title=\"{default}\" width=\"100%\"></fazchart><table cellspacing=\"1\" cellpadding=\"1\" border=\"0\" style=\"width:100%\"><tbody><tr><td style=\"vertical-align:top; width:50%\"><fazchart mkey=\"Top-App-Category-by-Session\" title=\"{default}\" width=\"100%\"></fazchart><p>&nbsp;</p></td><td style=\"vertical-align:top\"><fazchart mkey=\"Top-Region-Name-by-Traffic\" title=\"{default}\" width=\"100%\"></fazchart><p>&nbsp;</p></td></tr></tbody></table><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><table cellspacing=\"1\" cellpadding=\"1\" border=\"0\" style=\"width:100%\"><tbody><tr><td style=\"vertical-align:top; width:50%\"><fazchart mkey=\"Top-App-By-Bandwidth-Chart\" title=\"{default}\" width=\"100%\"></fazchart><p>&nbsp;</p></td><td style=\"vertical-align:top\"><fazchart mkey=\"Top-Protocols-By-Traffic\" title=\"{default}\" width=\"100%\"></fazchart><p>&nbsp;</p></td></tr></tbody></table><fazchart mkey=\"Traffic-Bandwidth-Summary-Day-Of-Month\" title=\"{default}\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>2. Web Usage</h1><fazchart mkey=\"Top-Web-Sites-by-Sessions\" title=\"{default}\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>3. Threats</h1><fazchart mkey=\"Top-Attacks-by-Count\" title=\"{default}\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><table cellspacing=\"1\" cellpadding=\"1\" border=\"0\" style=\"width:100%\"><tbody><tr><td style=\"vertical-align:top; width:50%\"><fazchart mkey=\"Top-Spams-by-Count\" title=\"{default}\" width=\"100%\"></fazchart><p>&nbsp;</p></td><td style=\"vertical-align:top\"><fazchart mkey=\"utm-Top-Virus-Count\" title=\"{default}\" width=\"100%\"></fazchart><p>&nbsp;</p></td></tr><tr><td style=\"vertical-align:top\"><fazchart mkey=\"security-Antivirus-Inspections\" title=\"{default}\" width=\"100%\"></fazchart><p>&nbsp;</p></td><td>&nbsp;</td></tr></tbody></table><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>4. DLP</h1><fazchart mkey=\"Top-DLP-by-Count\" title=\"{default}\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>5. Wireless</h1><table cellspacing=\"1\" cellpadding=\"1\" border=\"0\" style=\"width:100%\"><tbody><tr><td style=\"vertical-align:top; width:50%\"><fazchart mkey=\"wifi-Top-AP-By-Client\" title=\"{default}\" width=\"100%\"></fazchart><p>&nbsp;</p></td><td style=\"vertical-align:top\"><fazchart mkey=\"wifi-Top-AP-By-Bandwidth\" title=\"{default}\" width=\"100%\"></fazchart><p>&nbsp;</p></td></tr><tr><td style=\"vertical-align:top\"><fazchart mkey=\"wifi-Top-SSID-By-Bandwidth\" title=\"{default}\" width=\"100%\"></fazchart><p>&nbsp;</p></td><td>&nbsp;</td></tr></tbody></table><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>6. Sandbox</h1><table cellspacing=\"1\" cellpadding=\"1\" border=\"0\" style=\"width:100%\"><tbody><tr><td style=\"vertical-align:top; width:50%\"><fazchart mkey=\"fsa-Top-Threat-Rating-Distribution\" title=\"{default}\" width=\"100%\"></fazchart><p>&nbsp;</p></td><td style=\"vertical-align:top\"><fazchart mkey=\"fsa-Top-Targeted-Hosts\" title=\"{default}\" width=\"100%\"></fazchart><p>&nbsp;</p></td></tr><tr><td style=\"vertical-align:top\"><fazchart mkey=\"fsa-Scan-Stats-of-Malware-by-Name\" title=\"{default}\" width=\"100%\"></fazchart><p>&nbsp;</p></td><td>&nbsp;</td></tr></tbody></table><p>&nbsp;</p>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90100
                next
            end
        set protected enable
    next

    edit 1000090003
        set dev-type Fabric
        set category "Security"
        set is-template enable
        set title "Template - Security Events and Incidents Summary"
        set description "Present a brief summary of the events/Incidents collected."
        set body "<div style=\"height:40px;\"></div><h2 style=\"font-family: Lato; font-size: 18px; color: black;\"> QUICK INSIGHT</h2><div style=\"height:30px;\"></div><table border=\"0\" cellspacing=\"5px\" cellpadding=\"0\" align=\"center\" style=\"font-family: Lato; padding-top:5px; width:100%\"><tbody><tr><td style=\"vertical-align: bottom; width: 28px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/logs.png\" style=\"height:24px; width:24px;\"/></td><td style=\"vertical-align: bottom;\"><strong><span style=\"font-size:24px;\"><span>N/A</span></span></strong><span style=\"font-size:16px;\"> Logs</span></td><td style=\"vertical-align: bottom; width: 28px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/events.png\" style=\"height:24px; width:24px;\"/></td><td style=\"vertical-align: bottom;\"><strong><span style=\"font-size:24px;\"><fazmacro mkey=\"soc-summary-Event-Count\"></fazmacro></span></strong><span style=\"font-size:16px;\"> Events</span></td><td style=\"vertical-align: bottom; width: 28px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/analyzed_events.png\" style=\"height:24px; width:24px;\"/></td><td style=\"vertical-align: bottom;\"><strong><span style=\"font-size:24px;\"><fazmacro mkey=\"soc-summary-Analyzed-Event-Count\"></fazmacro></span></strong><span style=\"font-size:16px;\"> Analyzed Events</span></td><td style=\"vertical-align: bottom; width: 28px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/web_incidents.png\" style=\"height:24px; width:24px;\"/></td><td style=\"vertical-align: bottom;\"><strong><span style=\"font-size:24px;\"><fazmacro mkey=\"soc-summary-Incident-Count\"></fazmacro></span></strong><span style=\"font-size:16px;\"> Incidents</span></td><td style=\"vertical-align: bottom; width: 28px;\"><img alt=\"\" data-local=\"true\" src=\"/resource/images/fazrpt_external/web_endpoints.png\" style=\"height:24px; width:24px;\"/></td><td style=\"vertical-align: bottom;\"><strong><span style=\"font-size:24px;\"><fazmacro mkey=\"soc-summary-Affected-Endpoint-Count\"></fazmacro></span></strong><span style=\"font-size:16px;\"> Affected Endpoints</span></td></tr></tbody></table><div style=\"height:70px;\"></div><h2 style=\"font-family: Lato; font-size: 18px; color: black;\"> OVERALL SEVERITY</h2><div style=\"height:40px;\"></div><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\" style=\"font-family: Lato; width:100%\"><tbody><tr><td style=\"vertical-align:top\"><fazchart mkey=\"soc-Total-Event-by-Severity\" title=\"Total Events by Severity\" width=\"500px\"></fazchart></td><td style=\"vertical-align:top\"><fazchart mkey=\"soc-Incident-by-Severity\" title=\"Total Incidents by Severity\" width=\"500px\"></fazchart></td></tr></tbody></table><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"font-family: Lato;\"><fazchart mkey=\"soc-summary-Total-Event-by-Severity-Category\" title=\"TOTAL EVENTS COUNT BY SEVERITY AND CATEGORY\" width=\"1000px\"></fazchart></div><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><div style=\"height:15px;\"></div><h2 style=\"font-family: Lato; font-size: 18px; color: black;\"> LIST OF INCIDENTS</h2><table border=\"0\" cellspacing=\"5px\" cellpadding=\"0\" align=\"center\" style=\"font-family: Lato; width:100%\"><tbody><tr><td style=\"vertical-align:top\"><fazchart mkey=\"soc-summary-Affected-Endpoint-by-HWOS\" title=\"\" width=\"330px\"></fazchart></td><td style=\"vertical-align:top\"><fazchart mkey=\"soc-summary-Incident-by-Category\" title=\"\" width=\"330px\"></fazchart></td><td style=\"vertical-align:top\"><fazchart mkey=\"soc-summary-Incident-by-Status\" title=\"\" width=\"330px\"></fazchart></td></tr></tbody></table><div style=\"font-family: Lato;\"><fazchart mkey=\"soc-Incident-List\" title=\" \" width=\"1000px\"></fazchart></div>"
            config header
                edit 1
                    set type graphic
                    set graphic "header_webusage_bg.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90100
                next
                edit 90203
                next
            end
        set report-tag "concise"
        set protected enable
    next

end

config sql-report layout-folder
    edit 99999
        set folder-name "Default Templates"
        set protected enable
    next
    edit 90100
        set folder-name "Fabric Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90203
        set folder-name "SOC Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90205
        set folder-name "Outbreak Alert Reports Templates"
        set parent-id 99999
        set protected enable
    next
end

config sql-report schedule

    edit "1000090003"
         set is-template enable
         set description "Security Events and Incidents Summary"
         set status disable
         set include-coverpage disable
         set display-table-contents disable
         set output-format pdf
         set schedule-color "#5484ED"
         set resolve-hostname disable
         set device-list-type none
         set orientation landscape
         config report-layout
             edit 1000090003
             next
         end
         config devices
            edit All_FortiGate
            next
         end
    next
end


config system connectors
    edit 1
        set uuid "5979abf1-a807-47fd-8aca-c03d3b27c124"
        set name "Local Connector"
        set description "Local Connector"
        set status enable
        set type LOCALHOST 
        set auth-type none
        config action
            edit 1
                set name "UPDATE_ASSET_AND_IDENTITY"
                set description "update asset and identity"
                set parameters "{}"
                set status enable
            next
            edit 2
                set name "GET_EVENTS"
                set description "get events"
                set parameters "{}"
                set status enable
            next
            edit 3
                set name "ATTACH_DATA_TO_INCIDENT"
                set description "attach data to incident"
                set parameters "{}"
                set status enable
            next
            edit 4
                set name "RUN_REPORT"
                set description "run report"
                set parameters "{}"
                set status enable
            next
            edit 5
                set name "GET_ENDPOINT_VULNERABILITIES"
                set description "get endpoint vulnerabilities"
                set parameters "{}"
                set status enable
            next
            edit 6
                set name "CREATE_INCIDENT"
                set description "create incident"
                set parameters "{}"
                set status enable
            next
            edit 7
                set name "UPDATE_INCIDENT"
                set description "update incident"
                set parameters "{}"
                set status enable
            next
        end
    next
    edit 2
        set uuid "d0f89488-b270-11ea-b3de-0242ac130004"
        set name "FortiGuard Connector"
        set description "FortiGuard Connector"
        set status enable
        set type FGD
        set auth-type none
        config action
            edit 1
                set name "GET_IOC_INFO"
                set description "get FortiGuard data for associated IOC"
                set parameters "{\"addr\":null}"
                set status enable
            next
            edit 2
                set name "GET_THREAT_INFO"
                set description "Lookup Fortiguard encyclopedia entry"
                set parameters "{\"threat-type\":null,\"threatID\":null}"
                set status enable
            next
            edit 3
                set name "INDICATOR_LOOKUP"
                set description "Indicator Lookup"
                set parameters "{\"indicator_type\":null,\"indicator_value\":null}"
                set status enable
            next
        end
    next
end
