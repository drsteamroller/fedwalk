
config sql-report dataset

    edit "ffw-traffic-bandwidth-timeline"
        set description "Traffic bandwidth timeline"
        set log-type traffic
        set dev-type FortiFirewall
        set query "select $flex_timescale(timestamp) as hodex, sum(traffic_out) as traffic_out, sum(traffic_in) as traffic_in from ###(select timestamp, sum(bandwidth) as bandwidth, sum(traffic_out) as traffic_out, sum(traffic_in) as traffic_in from ###base(/*tag:rpt_base_ffw_t_bndwdth_sess*/select $flex_timestamp as timestamp, devid, vd, csf, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, count(*) as sessions, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(sentbyte, 0)) as traffic_out, sum(coalesce(rcvdbyte, 0)) as traffic_in from $log where $filter group by timestamp, devid, vd, csf, user_src, service /*SkipSTART*/order by timestamp desc/*SkipEND*/)base### base_query group by timestamp order by bandwidth desc)### t group by hodex having sum(traffic_out+traffic_in)>0 order by hodex"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "ffw-number-of-session-timeline"
        set description "Number of session timeline"
        set log-type traffic
        set dev-type FortiFirewall
        set query "select $flex_timescale(timestamp) as hodex, sum(sessions) as sessions from ###(select timestamp, sum(sessions) as sessions from ###base(/*tag:rpt_base_ffw_t_bndwdth_sess*/select $flex_timestamp as timestamp, devid, vd, csf, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, service, count(*) as sessions, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(sentbyte, 0)) as traffic_out, sum(coalesce(rcvdbyte, 0)) as traffic_in from $log where $filter group by timestamp, devid, vd, csf, user_src, service /*SkipSTART*/order by timestamp desc/*SkipEND*/)base### base_query group by timestamp order by sessions desc)### t group by hodex order by hodex"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "ffw-bandwidth-app-Traffic-Statistics"
        set description "Bandwidth application traffic statistics"
        set log-type traffic
        set dev-type FortiFirewall
        set query "drop table if exists rpt_tmptbl_1; create temporary table rpt_tmptbl_1(total_sessions varchar(255), total_bandwidth varchar(255), ave_session varchar(255), ave_bandwidth varchar(255), active_date varchar(255), total_users varchar(255), total_app varchar(255), total_dest varchar(255)); insert into rpt_tmptbl_1 (total_sessions, total_bandwidth, ave_session, ave_bandwidth) select format_numeric_no_decimal(sum(sessions)) as total_sessions, bandwidth_unit(sum(bandwidth)) as total_bandwidth, format_numeric_no_decimal(cast(sum(sessions)/$days_num as decimal(18, 0))) as ave_session, bandwidth_unit(cast(sum(bandwidth)/$days_num as decimal(18, 0))) as ave_bandwidth from ###(select count(*) as sessions, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth from $log where $filter and (logflag&1>0))### t; update rpt_tmptbl_1 set active_date=t1.dom from (select dom, sum(sessions) as sessions from ###(select $DAY_OF_MONTH as dom, count(*) as sessions from $log where $filter group by dom order by sessions desc)### t group by dom order by sessions desc limit 1) as t1; update rpt_tmptbl_1 set total_users=t2.totalnum from (select format_numeric_no_decimal(count(distinct(user_src))) as totalnum from ###(select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, count(*) as count from $log where $filter group by user_src order by count desc)### t) as t2; update rpt_tmptbl_1 set total_app=t3.totalnum from (select format_numeric_no_decimal(count(distinct(app_grp))) as totalnum from ###(select app_group_name(app) as app_grp, count(*) as count from $log where $filter and nullifna(app) is not null group by app_grp order by count desc)### t) as t3; update rpt_tmptbl_1 set total_dest=t4.totalnum from (select format_numeric_no_decimal(count(distinct(dstip))) as totalnum from ###(select dstip, count(*) as count from $log where $filter and dstip is not null group by dstip order by count desc)### t ) as t4; select 'Total Sessions' as summary, total_sessions as stats from rpt_tmptbl_1 union all select 'Total Bytes Transferred' as summary, total_bandwidth as stats from rpt_tmptbl_1 union all select 'Most Active Date By Sessions' as summary, active_date as stats from rpt_tmptbl_1 union all select 'Total Users' as summary, total_users as stats from rpt_tmptbl_1 union all select 'Total Applications' as summary, total_app as stats from rpt_tmptbl_1 union all select 'Total Destinations' as summary, total_dest as stats from rpt_tmptbl_1 union all select 'Average Sessions Per Day' as summary, ave_session as stats from rpt_tmptbl_1 union all select 'Average Bytes Per Day' as summary, ave_bandwidth as stats from rpt_tmptbl_1"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "ffw-Top-App-By-Bandwidth"
        set description "Top applications by bandwidth usage"
        set log-type traffic
        set dev-type FortiFirewall
        set query "select app_group_name(app) as app_group, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out, count(*) as sessions from $log where $filter and nullifna(app) is not null group by app_group having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
                edit "appcat"
                    set var-name "appcat"
                next
            end
        set protected enable
    next
    edit "ffw-bandwidth-app-Top-Users-By-Bandwidth"
        set description "Bandwidth application top users by bandwidth usage"
        set log-type traffic
        set dev-type FortiFirewall
        set query "select coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out, count(*) as sessions from $log where $filter group by user_src having sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0))>0 order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "ffw-bandwidth-app-Traffic-By-Active-User-Number"
        set description "Bandwidth application traffic by active user number"
        set log-type traffic
        set dev-type FortiFirewall
        set query "select $flex_timescale(timestamp) as hodex, count(distinct(user_src)) as total_user from ###(select $flex_timestamp as timestamp, coalesce(nullifna(`user`), nullifna(`unauthuser`), ipstr(`srcip`)) as user_src from $log where $filter group by timestamp, user_src order by timestamp desc)### t group by hodex order by hodex"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
    edit "ffw-bandwidth-app-Top-Dest-By-Bandwidth-Sessions"
        set description "Bandwidth application top dest by bandwidth usage sessions"
        set log-type traffic
        set dev-type FortiFirewall
        set query "select coalesce(nullifna(root_domain(hostname)), ipstr(`dstip`)) as domain, sum(coalesce(sentbyte, 0)+coalesce(rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvdbyte, 0)) as traffic_in, sum(coalesce(sentbyte, 0)) as traffic_out, count(*) as sessions from $log where $filter group by domain order by bandwidth desc"
            config variable
                edit "user_src"
                    set var-name "User (or Source IP)"
                    set var-expression "coalesce(nullifna(`user`), ipstr(`srcip`))"
                    set var-type string
                next
                edit "group"
                    set var-name "group"
                next
            end
        set protected enable
    next
end



config sql-report chart
    edit "ffw-Traffic-Bandwidth-Summary-Day-Of-Month"
        set disp-name "Bandwidth Summary"
        set category "FortiFirewall"
        set dev-type FortiFirewall
        set description "Traffic bandwidth usage summary"
        set dataset "ffw-traffic-bandwidth-timeline"
        set chart-type area
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "traffic_out"
                set column-graph-type line-up
                set column-attr bandwidth
                set legend "Sent"
            next
            edit 3
                set data-binding "traffic_in"
                set column-graph-type line-down
                set column-attr bandwidth
                set legend "Received"
            next
        end
        set protected enable
    next
    edit "ffw-Session-Summary-Day-Of-Month"
        set disp-name "Session Summary"
        set category "FortiFirewall"
        set dev-type FortiFirewall
        set description "Session summary"
        set dataset "ffw-number-of-session-timeline"
        set chart-type area
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "sessions"
                set column-graph-type line-up
                set legend "Number of Sessions"
            next
        end
        set protected enable
    next
    edit "ffw-bandwidth-app-Traffic-Statistics"
        set disp-name "Traffic Statistics"
        set category "FortiFirewall"
        set dev-type FortiFirewall
        set description "Top 10 traffic statistics summary"
        set dataset "ffw-bandwidth-app-Traffic-Statistics"
        set chart-type table
        config table-columns
            edit 1
                set header "Summary"
                set data-binding "summary"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Statistics"
                set data-binding "stats"
                set column-width 60
            next
        end
        set protected enable
    next
    edit "ffw-bandwidth-app-Top-App-By-Bandwidth-Sessions"
        set disp-name "Top 30 Applications by Bandwidth and Sessions"
        set category "FortiFirewall"
        set dev-type FortiFirewall
        set description "Top 30 applications by bandwidth usage and session count"
        set dataset "ffw-Top-App-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "Application"
                set data-binding "app_group"
                set data-top 30
                set column-width 30
            next
            edit 2
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 40
            next
            edit 3
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 4
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
            edit 5
                set header "Sessions"
                set data-binding "sessions"
                set column-span 2
                set column-graph-type bar
                set column-width 30
            next
            edit 6
                set data-binding "sessions"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "ffw-bandwidth-app-Top-Users-By-Bandwidth-Sessions"
        set disp-name "Top 30 Users by Bandwidth and Sessions"
        set category "FortiFirewall"
        set dev-type FortiFirewall
        set description "Top 30 users by bandwidth usage and session count"
        set dataset "ffw-bandwidth-app-Top-Users-By-Bandwidth"
        set chart-type table
        config table-columns
            edit 1
                set header "User(or IP)"
                set data-binding "user_src"
                set column-attr user
                set data-top 30
                set column-width 30
            next
            edit 2
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 40
            next
            edit 3
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 4
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
            edit 5
                set header "Sessions"
                set data-binding "sessions"
                set column-span 2
                set column-graph-type bar
                set column-width 30
            next
            edit 6
                set data-binding "sessions"
                set column-attr count
            next
        end
        set protected enable
    next
    edit "ffw-bandwidth-app-Traffic-By-Active-User-Number"
        set disp-name "Active Traffic Users"
        set category "FortiFirewall"
        set dev-type FortiFirewall
        set description "List of active traffic users"
        set dataset "ffw-bandwidth-app-Traffic-By-Active-User-Number"
        set chart-type area
        config table-columns
            edit 1
                set header "Time Stamp"
                set data-binding "hodex"
                set column-attr time
                set data-top 168
            next
            edit 2
                set data-binding "total_user"
                set column-graph-type line-up
                set legend "Active Users"
            next
        end
        set protected enable
    next
    edit "ffw-bandwidth-app-Top-Dest-By-Bandwidth-Sessions"
        set disp-name "Top 30 Destinations by Bandwidth and Sessions"
        set category "FortiFirewall"
        set dev-type FortiFirewall
        set description "Top 30 destinations by bandwidth usage and session count"
        set dataset "ffw-bandwidth-app-Top-Dest-By-Bandwidth-Sessions"
        set chart-type table
        config table-columns
            edit 1
                set header "Hostname(or IP)"
                set data-binding "domain"
                set data-top 30
                set column-width 30
            next
            edit 2
                set header "Bytes"
                set data-binding "traffic_out"
                set column-span 3
                set column-graph-type bar
                set legend "Sent"
                set column-width 40
            next
            edit 3
                set data-binding "traffic_in"
                set column-graph-type bar
                set legend "Received"
            next
            edit 4
                set data-binding "bandwidth"
                set column-attr bandwidth
            next
            edit 5
                set header "Sessions"
                set data-binding "sessions"
                set column-span 2
                set column-graph-type bar
                set column-width 30
            next
            edit 6
                set data-binding "sessions"
                set column-attr count
            next
        end
        set protected enable
    next
end


config sql-report layout
    edit 1000050001
        set is-template enable
        set dev-type FortiFirewall
        set category "FortiFirewall"
        set title "Template - FortiFirewall Bandwidth and Applications Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Traffic, Bandwidth, Sessions, Destinations summaries - by users and applications"
        set body "<h1>Traffic Summary</h1><fazchart mkey=\"ffw-Traffic-Bandwidth-Summary-Day-Of-Month\" title=\"Bandwidth Summary\" width=\"100%\"></fazchart><fazchart mkey=\"ffw-Session-Summary-Day-Of-Month\" title=\"Sessions Summary\" width=\"100%\"></fazchart><fazchart mkey=\"ffw-bandwidth-app-Traffic-Statistics\" title=\"Traffic Statistics\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Application Traffic</h1><fazchart mkey=\"ffw-bandwidth-app-Top-App-By-Bandwidth-Sessions\" title=\"Top 30 Applications by Bandwidth and Sessions\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Users</h1><fazchart mkey=\"ffw-bandwidth-app-Top-Users-By-Bandwidth-Sessions\" title=\"Top 30 Users by Bandwidth and Sessions\" width=\"100%\"></fazchart><fazchart mkey=\"ffw-bandwidth-app-Traffic-By-Active-User-Number\" title=\"Active Users\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Destinations</h1><fazchart mkey=\"ffw-bandwidth-app-Top-Dest-By-Bandwidth-Sessions\" title=\"Top 30 Destination by Bandwidth and Sessions\" width=\"100%\"></fazchart><p><span style=\"font-size:20px\">Notes</span></p><p><em>&#39;Not.Scanned&#39; and &#39;unscanned&#39; categories are for the sessions that are not scanned by the Application Control engine. Please enable Application Control to allow application traffic to be properly identified/secured on your network.</em></p>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90115
                next
                edit 90200
                next
                edit 90201
                next
            end
        set protected enable
    next
end

config sql-report layout-folder
    edit 99999
        set folder-name "Default Templates"
        set protected enable
    next
    edit 90115
        set folder-name "FortiFirewall Reports Templates"
        set parent-id 99999
        set protected enable
    next

    edit 90200
        set folder-name "Application Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90201
        set folder-name "Network Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90205
        set folder-name "Outbreak Alert Reports Templates"
        set parent-id 99999
        set protected enable
    next
end

config alert basic-handler
    edit 327680001
        set name "Default-FFW-Botnet-Communication-Detection-By-Endpoint"
        set description "Default FortiFirewall event handler to detect botnet communication in network grouped by endpoint"
        config rule
            edit 1
                set name "DNS traffic to Botnet CnC blocked"
                set devtype FortiFirewall
                set severity high
                set logtype "dns"
                set extrainfo "Traffic path: ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "DNS traffic to Botnet C&C $groupby2 blocked"
                set groupby1 "endpoint"
                set groupby2 "qname"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Botnet,Domain,C&C"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==1501054601 OR logid==1501054600"
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/ffw"
    next
    edit 327680002
        set name "Default-FFW-Compromised Host-Detection-IOC-By-Endpoint"
        set description "Default FortiFirewall event handler to detect compromised hosts by FortiAnalyzer IOC feature grouped by endpoint"
        config rule
            edit 1
                set name "Traffic to CnC detected"
                set devtype FortiFirewall
                set severity critical
                set logtype "traffic"
                set extrainfo "${tdtype}: ${dstip} :${dstport}, Traffic path: ${devname} (Policy ID:${policyid})\\${dstintf}"
                set extrainfo-type custom
                set subject "Compromised host detected"
                set groupby1 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Endpoint,C&C,IP,Ioc_Rescan"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "tdtype~infected"
            next
            edit 2
                set name "DNS traffic to CnC detected"
                set devtype FortiFirewall
                set severity critical
                set logtype "dns"
                set extrainfo "${tdtype}: ${qname}, Traffic path: ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "Compromised host detected"
                set groupby1 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Endpoint,C&C,Domain,Ioc_Rescan"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "tdtype~infected"
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/ffw"
    next
    edit 327680003
        set name "Default-FFW-Risky-Destination-Detection-By-Endpoint"
        set description "Default FortiFirewall event handler to detect network traffic to malicious or suspicious destinations grouped by endpoint"
        config rule
            edit 1
                set name "DNS request to malicious destination detected"
                set devtype FortiFirewall
                set severity high
                set logtype "dns"
                set extrainfo "Domain:${hostname}, Referrer:${referralurl}, ${devname} (Policy ID:${policyid})\\${dstintf}"
                set extrainfo-type custom
                set subject "DNS request to $groupby2 detected"
                set groupby1 "endpoint"
                set groupby2 "catdesc"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Risky,Domain"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==1501054802 and (catdesc=='Malicious Websites' or catdesc=='Phishing' or catdesc=='Spam URLs')"
            next
            edit 2
                set name "DNS request to suspicious destination detected"
                set devtype FortiFirewall
                set severity medium
                set logtype "dns"
                set extrainfo "Domain:${qname}, Resolved IP: ${ipaddr}, ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "DNS request to $groupby2 detected"
                set groupby1 "endpoint"
                set groupby2 "catdesc"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Risky,Domain"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==1501054802 and (catdesc=='Newly Observed Domain' or catdesc=='Newly Registered Domain' or catdesc~'Dynamic DNS' or catdesc=='Proxy Avoidance' or catdesc=='Unrated')"
            next
            edit 3
                set name "DNS request to malicious or suspicious destination detected"
                set devtype FortiFirewall
                set severity medium
                set logtype "dns"
                set extrainfo "Domain:${qname}, Resolved IP: ${ipaddr}, ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "DNS request to $groupby2 blocked"
                set groupby1 "endpoint"
                set groupby2 "catdesc"
                set eventstatus "mitigated"
                set tags "Default,By_Endpoint,Risky,Domain"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==1501054803 and (catdesc=='Malicious Websites' or catdesc=='Phishing' or catdesc=='Spam URLs' or catdesc=='Newly Observed Domain' or catdesc=='Newly Registered Domain' or catdesc~'Dynamic DNS' or catdesc=='Proxy Avoidance' or catdesc=='Unrated')"
            next
            edit 4
                set name "Insecure SSL connection detected"
                set devtype FortiFirewall
                set severity medium
                set logtype "ssl"
                set extrainfo "${msg} with reason: ${reason} from ${srcip} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Insecure SSL connection detected"
                set groupby1 "endpoint"
                set groupby2 "msg"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Risky,SSL"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssl-anomalies"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper equal
                    next
                end
            next
            edit 5
                set name "Insecure SSL connection blocked"
                set devtype FortiFirewall
                set severity low
                set logtype "ssl"
                set extrainfo "${msg} with reason: ${reason} from ${srcip} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Insecure SSL connection blocked"
                set groupby1 "endpoint"
                set groupby2 "msg"
                set eventstatus "mitigated"
                set tags "Default,By_Endpoint,Risky,SSL"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssl-anomalies"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper not-equal
                    next
                end
            next
            edit 6
                set name "SSL connection exempted"
                set devtype FortiFirewall
                set severity low
                set logtype "ssl"
                set extrainfo "SSL connection from ${srcip} to ${dstip}:${dstport} exempt with reason: ${reason}"
                set extrainfo-type custom
                set subject "$groupby2"
                set groupby1 "endpoint"
                set groupby2 "msg"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Risky,SSL"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssl-exempt"
                        set oper equal
                    next
                end
            next
            edit 7
                set name "SSH channel detected"
                set devtype FortiFirewall
                set severity medium
                set logtype "ssh"
                set extrainfo "SSH channel by user: ${login} from ${srcip} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "SSH channel detected"
                set groupby1 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Endpoint,Risky,SSH"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssh-channel"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper equal
                    next
                end
            next
            edit 8
                set name "SSH channel blocked"
                set devtype FortiFirewall
                set severity low
                set logtype "ssh"
                set extrainfo "SSH channel by user: ${login} from ${srcip} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "SSH channel blocked"
                set groupby1 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Endpoint,Risky,SSH"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssh-channel"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper not-equal
                    next
                end
            next
            edit 9
                set name "SSH command detected"
                set devtype FortiFirewall
                set severity medium
                set logtype "ssh"
                set extrainfo "SSH Command: ${command} by user: ${login} from ${srcip} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "SSH command detected"
                set groupby1 "endpoint"
                set tags "Default,By_Endpoint,Risky,SSH"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssh-command"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper equal
                    next
                end
            next
            edit 10
                set name "SSH command blocked"
                set devtype FortiFirewall
                set severity low
                set logtype "ssh"
                set extrainfo "SSH Command: ${command} by user: ${login} from ${srcip} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "SSH command blocked"
                set groupby1 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Endpoint,Risky,SSH"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssh-command"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper not-equal
                    next
                end
            next
            end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/ffw"
    next
    edit 327680004
        set name "Default-FFW-Risky-Destination-Detection-By-Threat"
        set description "Default FortiFirewall event handler to detect network traffic to malicious or suspicious destinations grouped by threat"
        config rule
            edit 1
                set name "DNS request to malicious destination detected"
                set devtype FortiFirewall
                set severity high
                set logtype "dns"
                set extrainfo "Domain:${qname} from category: ${catdesc}, Traffic path: PolicyID ${policyid}(Profile ${profile})\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "DNS request to malicious destination from $groupby2 detected"
                set groupby1 "qname"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Risky,Domain"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==1501054802 and (catdesc=='Malicious Websites' or catdesc=='Phishing' or catdesc=='Spam URLs')"
            next
            edit 2
                set name "DNS request to malicious destination blocked"
                set devtype FortiFirewall
                set severity medium
                set logtype "dns"
                set extrainfo "Domain:${qname} from category: ${catdesc}, Traffic path: PolicyID ${policyid}(Profile ${profile})\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "DNS request to malicious destination from $groupby2 blocked"
                set groupby1 "qname"
                set groupby2 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Threat,Risky,Domain"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==1501054803 and (catdesc=='Malicious Websites' or catdesc=='Phishing' or catdesc=='Spam URLs')"
            next
            edit 3
                set name "DNS request to suspicious destination detected"
                set devtype FortiFirewall
                set severity medium
                set logtype "dns"
                set extrainfo "Domain:${qname} from category: ${catdesc}, Traffic path: PolicyID ${policyid}(Profile ${profile})\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "DNS request to suspicious destination from $groupby2 detected"
                set groupby1 "qname"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Risky,Domain"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==1501054802 and (catdesc=='Newly Observed Domain' or catdesc=='Newly Registered Domain' or catdesc~'Dynamic DNS' or catdesc=='Proxy Avoidance' or catdesc=='Unrated')"
            next
            edit 4
                set name "DNS request to suspicious destination from blocked"
                set devtype FortiFirewall
                set severity low
                set logtype "dns"
                set extrainfo "Domain:${qname} from category: ${catdesc}, Traffic path: PolicyID ${policyid}(Profile ${profile})\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "DNS request to suspicious destination from $groupby2 blocked"
                set groupby1 "qname"
                set groupby2 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Threat,Risky,Domain"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==1501054803 and (catdesc=='Newly Observed Domain' or catdesc=='Newly Registered Domain' or catdesc~'Dynamic DNS' or catdesc=='Proxy Avoidance' or catdesc=='Unrated')"
            next
            edit 5
                set name "Insecure SSL Connection detected"
                set devtype FortiFirewall
                set severity medium
                set logtype "ssl"
                set extrainfo "${msg} with reason: ${reason} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Insecure SSL Connection detected from $groupby2"
                set groupby1 "dstip"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Risky,SSL"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssl-anomalies"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper equal
                    next
                end
            next
            edit 6
                set name "Insecure SSL Connection blocked"
                set devtype FortiFirewall
                set severity low
                set logtype "ssl"
                set extrainfo "${msg} with reason: ${reason} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Insecure SSL Connection blocked from $groupby2"
                set groupby1 "dstip"
                set groupby2 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Threat,Risky,SSL"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssl-anomalies"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper not-equal
                    next
                end
            next
            edit 7
                set name "SSH channel detected"
                set devtype FortiFirewall
                set severity medium
                set logtype "ssh"
                set extrainfo "SSH channel by user: ${login} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "SSH channel detected from $groupby2"
                set groupby1 "dstip"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Risky,SSH"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssh-channel"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper equal
                    next
                end
            next
            edit 8
                set name "SSH channel blocked"
                set devtype FortiFirewall
                set severity low
                set logtype "ssh"
                set extrainfo "SSH channel by user: ${login} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "SSH channel blocked from $groupby2"
                set groupby1 "dstip"
                set groupby2 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Threat,Risky,SSH"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssh-channel"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper not-equal
                    next
                end
            next
            edit 9
                set name "SSH command detected"
                set devtype FortiFirewall
                set severity medium
                set logtype "ssh"
                set extrainfo "SSH command: ${command} by user: ${login}  to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "SSH command detected from $groupby2"
                set groupby1 "dstip"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,Risky,SSH"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssh-command"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper equal
                    next
                end
            next
            edit 10
                set name "SSH command blocked"
                set devtype FortiFirewall
                set severity low
                set logtype "ssh"
                set extrainfo "SSH command: ${command} by user: ${login} to ${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "SSH command blocked from $groupby2"
                set groupby1 "dstip"
                set groupby2 "endpoint"
                set eventstatus "mitigated"
                set tags "Default,By_Threat,Risky,SSH"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "eventtype"
                        set value "ssh-command"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "passthrough"
                        set oper not-equal
                    next
                end
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/ffw"
    next
    edit 327680005
        set name "Default-FFW-Compromised Host-Detection-IOC-By-Threat"
        set description "Default FortiFirewall event handler to detect compromised hosts by FortiAnalyzer IOC feature grouped by threat"
        config rule
            edit 1
                set name "Traffic to CnC detected"
                set devtype FortiFirewall
                set severity critical
                set logtype "traffic"
                set extrainfo "Traffic to C&C:${dstip}, Traffic path: PolicyID ${policyid}\\${dstintf}\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Traffic to C&C from $groupby2 detected"
                set groupby1 "dstip"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,IP,C&C,Ioc_Rescan"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "tdtype~infected"
            next
            edit 2
                set name "Web traffic to CnC detected"
                set devtype FortiFirewall
                set severity critical
                set logtype "webfilter"
                set extrainfo "Traffic to C&C:${hostname}, Traffic path: PolicyID ${policyid}\\${dstintf}\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "Web traffic to C&C from $groupby2 detected"
                set groupby1 "hostname"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,C&C,URL,Ioc_Rescan"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "tdtype~infected"
            next
            edit 3
                set name "DNS traffic to CnC detected"
                set devtype FortiFirewall
                set severity critical
                set logtype "dns"
                set extrainfo "Traffic to C&C:${qname}, Traffic path: PolicyID ${policyid}\\${dstintf}\\${dstip}:${dstport}"
                set extrainfo-type custom
                set subject "DNS traffic to C&C from $groupby2 detected"
                set groupby1 "qname"
                set groupby2 "endpoint"
                set eventstatus "open"
                set tags "Default,By_Threat,C&C,Domain,Ioc_Rescan"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "tdtype~infected"
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/ffw"
    next
    edit 327680006
        set name "Default FFW System Events"
        set description "Default FortiFirewall event handler for selected FortiOS system event logs grouped by device"
        config rule
            edit 1
                set name "Important events"
                set devtype FortiFirewall
                set severity high
                set logtype "event"
                set utmevent "_any_"
                set subject "$groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,System"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "pri"
                        set value "4"
                        set oper equal
                    next
                    edit 2
                        set key "pri"
                        set value "3"
                        set oper equal
                    next
                end
            next
            edit 2
                set name "Critical events"
                set devtype FortiFirewall
                set severity critical
                set logtype "event"
                set utmevent "_any_"
                set subject "$groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,System"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "pri"
                        set value "2"
                        set oper great-or-equal
                    next
                end
            next
            edit 3
                set name "Wireless event log id matched"
                set devtype FortiFirewall
                set severity low
                set logtype "event"
                set utmevent "wireless"
                set subject "$groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,System"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0104043521 or logid==0104043530 or logid==0104043531 or logid==0104043532 or logid==0104043533 or logid==0104043534 or logid==0104043535 or logid==0104043542 or logid==0104043544 or logid==0104043546 or logid==0104043548 or logid==0104043552 or logid==0104043553 or logid==0104043555 or logid==0104043557 or logid==0104043558 or logid==0104043560 or logid==0104043563 or logid==0104043564 or logid==0104043565 or logid==0104043566 or logid==0104043571 or logid==0104043573 or logid==0104043575 or logid==0104043577 or logid==0104043613 or logid==0104043614 or logid==0104043615"
            next
            edit 4
                set name "Event log id matched 1"
                set devtype FortiFirewall
                set severity medium
                set logtype "event"
                set utmevent "_any_"
                set subject "$groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,System"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0109045152 or logid==0107045082 or logid==0107045110 or logid==0110052000 or logid==0100032044"
            next
            edit 5
                set name "Event log id matched 2"
                set devtype FortiFirewall
                set severity low
                set logtype "event"
                set utmevent "_any_"
                set subject "$groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,System"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0108037892 or logid==0100020117 or logid==0100020220 or logid==0100020221 or logid==0100022017 or logid==0100022018 or logid==0100022917 or logid==0100032023 or logid==0100032103 or logid==0100032140 or logid==0100032141 or logid==0100032142 or logid==0100032146 or logid==0100032149 or logid==0100032158 or logid==0100032159 or logid==0100032231 or logid==0100032232 or logid==0100032233 or logid==0100032238 or logid==0100032241 or logid==0100032564 or logid==0100032602 or logid==0100032603 or logid==0100032605 or logid==0101041989 or logid==0101041990 or logid==0105040960"
            next
            edit 6
                set name "Event log id matched 3"
                set devtype FortiFirewall
                set severity medium
                set logtype "event"
                set utmevent "_any_"
                set subject "$groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,System"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0100020005 or logid==0100020006 or logid==0100020090 or logid==0100022901 or logid==0100022902 or logid==0100022912 or logid==0100022913 or logid==0100022915 or logid==0101023101 or logid==0101023102 or logid==0101039424 or logid==0101039425 or logid==0101039940 or logid==0101039943 or logid==0101039947 or logid==0101039948 or logid==0101039952 or logid==0101039953 or logid==0101040001 or logid==0101040002 or logid==0101040019 or logid==0101040038 or logid==0101040039 or logid==0101040101 or logid==0101040102 or logid==0101040118 or logid==0101037139"
            next
            edit 7
                set name "Event log id matched 4"
                set devtype FortiFirewall
                set severity low
                set logtype "event"
                set utmevent "_any_"
                set subject "$groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,System"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0100022950 or logid==0100022951 or logid==0100029002 or logid==0100029003 or logid==0100032001 or logid==0100032003 or logid==0102038031 or logid==0102038032 or logid==0102043008 or logid==0102043009 or logid==0102043014 or logid==0102043015 or logid==0102043016 or logid==0102043017 or logid==0102043025 or logid==0102043026 or logid==0102043039 or logid==0102043040 or logid==0102043045 or logid==0102043046"
            next
            edit 8
                set name "Event log id matched 5"
                set devtype FortiFirewall
                set severity low
                set logtype "event"
                set utmevent "_any_"
                set subject "$groupby2"
                set groupby1 "devname"
                set groupby2 "logdesc"
                set eventstatus "auto"
                set tags "Default,System"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==0107045114 or logid==0107045115 or logid==0107045116 or logid==0100022850 or logid==0100022851 or logid==0100043776 or logid==0100043777 or logid==0100046600"
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/ffw"
    next
    edit 327680007
        set name "Default-FFW-Botnet-Communication-Detection"
        set description "Default FortiFirewall event handler to detect botnet communication and report to FortiFirewall"
        set automation-stitch enable
        config rule
            edit 1
                set name "DNS traffic to Botnet CnC blocked"
                set devtype FortiFirewall
                set severity high
                set logtype "dns"
                set extrainfo "Traffic path: ${devname} (Policy ID:${policyid})\\${dstintf}\\${dstip}"
                set extrainfo-type custom
                set subject "DNS traffic to Botnet C&C $groupby2 blocked"
                set groupby1 "endpoint"
                set groupby2 "qname"
                set eventstatus "open"
                set tags "Default,Botnet,Domain,C&C"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                set filter-expr "logid==1501054601 OR logid==1501054600"
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/ffw"
    next
end

config system connectors
    edit 1
        set uuid "5979abf1-a807-47fd-8aca-c03d3b27c124"
        set name "Local Connector"
        set description "Local Connector"
        set status enable
        set type LOCALHOST 
        set auth-type none
        config action
            edit 1
                set name "UPDATE_ASSET_AND_IDENTITY"
                set description "update asset and identity"
                set parameters "{}"
                set status enable
            next
            edit 2
                set name "GET_EVENTS"
                set description "get events"
                set parameters "{}"
                set status enable
            next
            edit 3
                set name "ATTACH_DATA_TO_INCIDENT"
                set description "attach data to incident"
                set parameters "{}"
                set status enable
            next
            edit 4
                set name "RUN_REPORT"
                set description "run report"
                set parameters "{}"
                set status enable
            next
            edit 5
                set name "GET_ENDPOINT_VULNERABILITIES"
                set description "get endpoint vulnerabilities"
                set parameters "{}"
                set status enable
            next
            edit 6
                set name "CREATE_INCIDENT"
                set description "create incident"
                set parameters "{}"
                set status enable
            next
            edit 7
                set name "UPDATE_INCIDENT"
                set description "update incident"
                set parameters "{}"
                set status enable
            next
        end
    next
    edit 2
        set uuid "d0f89488-b270-11ea-b3de-0242ac130004"
        set name "FortiGuard Connector"
        set description "FortiGuard Connector"
        set status enable
        set type FGD
        set auth-type none
        config action
            edit 1
                set name "GET_IOC_INFO"
                set description "get FortiGuard data for associated IOC"
                set parameters "{\"addr\":null}"
                set status enable
            next
            edit 2
                set name "GET_THREAT_INFO"
                set description "Lookup Fortiguard encyclopedia entry"
                set parameters "{\"threat-type\":null,\"threatID\":null}"
                set status enable
            next
            edit 3
                set name "INDICATOR_LOOKUP"
                set description "Indicator Lookup"
                set parameters "{\"indicator_type\":null,\"indicator_value\":null}"
                set status enable
            next
        end
    next
end

config sql-report layout
    edit 1
        set  is-template disable
        set dev-type FortiFirewall
        set category "FortiFirewall"
        set title "FortiFirewall Bandwidth and Applications Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Traffic, Bandwidth, Sessions, Destinations summaries - by users and applications"
        set body "<h1>Traffic Summary</h1><fazchart mkey=\"ffw-Traffic-Bandwidth-Summary-Day-Of-Month\" title=\"Bandwidth Summary\" width=\"100%\"></fazchart><fazchart mkey=\"ffw-Session-Summary-Day-Of-Month\" title=\"Sessions Summary\" width=\"100%\"></fazchart><fazchart mkey=\"ffw-bandwidth-app-Traffic-Statistics\" title=\"Traffic Statistics\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Application Traffic</h1><fazchart mkey=\"ffw-bandwidth-app-Top-App-By-Bandwidth-Sessions\" title=\"Top 30 Applications by Bandwidth and Sessions\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Users</h1><fazchart mkey=\"ffw-bandwidth-app-Top-Users-By-Bandwidth-Sessions\" title=\"Top 30 Users by Bandwidth and Sessions\" width=\"100%\"></fazchart><fazchart mkey=\"ffw-bandwidth-app-Traffic-By-Active-User-Number\" title=\"Active Users\" width=\"100%\"></fazchart><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><h1>Destinations</h1><fazchart mkey=\"ffw-bandwidth-app-Top-Dest-By-Bandwidth-Sessions\" title=\"Top 30 Destination by Bandwidth and Sessions\" width=\"100%\"></fazchart><p><span style=\"font-size:20px\">Notes</span></p><p><em>&#39;Not.Scanned&#39; and &#39;unscanned&#39; categories are for the sessions that are not scanned by the Application Control engine. Please enable Application Control to allow application traffic to be properly identified/secured on your network.</em></p>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 115
                next
                edit 200
                next
                edit 201
                next
            end
        set  protected disable
    next
end

config sql-report layout-folder
    edit 99999
        set folder-name "Default"
        set protected disable
    next
    edit 115
        set folder-name "FortiFirewall Reports"
        set parent-id 99999
        set protected disable
    next

    edit 200
        set folder-name "Application Reports"
        set parent-id 99999
        set protected disable
    next
    edit 201
        set folder-name "Network Reports"
        set parent-id 99999
        set protected disable
    next
    edit 205
        set folder-name "Outbreak Alert Reports"
        set parent-id 99999
        set protected disable
    next
end
config sql-report schedule
    edit 1
        set dev-type FortiFirewall
        set description "Default Schedule Config"
        config report-layout
            edit 1
            next
        end
        config devices
            edit All_Device
            next
        end
    next
end
