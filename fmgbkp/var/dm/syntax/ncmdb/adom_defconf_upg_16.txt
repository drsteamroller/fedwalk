
config sql-report dataset
    edit "fwb-attack-Top-Attack-Sources"
        set description "FortiWeb attack top attack sources"
        set log-type attack
        set dev-type FortiWeb
        set query "select src as srcip, count(*) as totalnum from $log where $filter and src is not null group by srcip order by totalnum desc"
        set protected enable
    next
    edit "fwb-attack-Top-Attack-Types"
        set description "FortiWeb attack top attack types"
        set log-type attack
        set dev-type FortiWeb
        set query "select subtype, count(*) as totalnum from $log where $filter and subtype is not null group by subtype order by totalnum desc"
        set protected enable
    next
    edit "fwb-attack-Top-Attack-URLs"
        set description "FortiWeb attack top attack URLs"
        set log-type attack
        set dev-type FortiWeb
        set query "select http_host, http_url, count(*) as totalnum from $log where $filter and http_host is not null and http_url is not null group by http_host, http_url order by totalnum desc"
        set protected enable
    next
    edit "fwb-attack-Top-Attack-Severities-By-Action"
        set description "FortiWeb attack top attack severities by action"
        set log-type attack
        set dev-type FortiWeb
        set query "select action, pri, count(*) as totalnum from $log where $filter and action is not null and pri is not null group by action, pri order by totalnum desc"
        set protected enable
    next
    edit "fwb-attack-Top-Attack-Destinations-By-Type" 
        set description "FortiWeb attack top attack destinations by type"
        set log-type attack
        set dev-type FortiWeb
        set query "select subtype, dst as dstip, count(*) as totalnum from $log where $filter and subtype is not null and dst is not null group by subtype, dstip order by totalnum desc"
        set protected enable
    next
    edit "fwb-attack-Top-Attack-Destinations-By-Source"
        set description "FortiWeb attack top attack destinations by source"
        set log-type attack
        set dev-type FortiWeb
        set query "select src as srcip, dst as dstip, count(*) as totalnum from $log where $filter and src is not null and dst is not null group by srcip, dstip order by totalnum desc"
        set protected enable
    next
    edit "fwb-attack-Top-Attack-Types-By-Source"
        set description "FortiWeb attack top attack types by source"
        set log-type attack
        set dev-type FortiWeb
        set query "select src as srcip, subtype, count(*) as totalnum from $log where $filter and src is not null group by srcip, subtype order by totalnum desc"
        set protected enable
    next
    edit "fwb-attack-Top-Attacked-Http-Methods-By-Type"
        set description "FortiWeb attack top attacked HTTP methods by type"
        set log-type attack
        set dev-type FortiWeb
        set query "select subtype, http_method, count(*) as totalnum from $log where $filter and subtype is not null and http_method is not null group by subtype, http_method order by totalnum desc"
        set protected enable
    next
    edit "fwb-attack-Top-Attacks-By-Policy"
        set description "FortiWeb attack top attacks by policy"
        set log-type attack
        set dev-type FortiWeb
        set query "select policy, count(*) as totalnum from $log where $filter and policy is not null group by policy order by totalnum desc"
        set protected enable
    next
    edit "fwb-attack-Top-Attacked-Destinations"
        set description "FortiWeb attack top attacked destinations"
        set log-type attack
        set dev-type FortiWeb
        set query "select dst as dstip, count(*) as totalnum from $log where $filter and dst is not null group by dstip order by totalnum desc"
        set protected enable
    next
    edit "fwb-attack-Top-Attack-Protocols-By-Type"
        set description "FortiWeb attack top attack protocols by type"
        set log-type attack
        set dev-type FortiWeb
        set query "select subtype, service as f_service, count(*) as totalnum from $log where $filter and subtype is not null and service is not null group by subtype, f_service order by totalnum desc"
        set protected enable
    next
    edit "fwb-attack-Top-Attacked-User-Identifications"
        set description "FortiWeb attack top attacked user identifications"
        set log-type attack
        set dev-type FortiWeb
        set query "select http_session_id, count(*) as totalnum from $log where $filter and http_session_id is not null group by http_session_id order by totalnum desc"
        set protected enable
    next
    edit "fwb-traffic-Top-Policies"
        set description "FortiWeb traffic top policies"
        set log-type traffic
        set dev-type FortiWeb
        set query "select policy, count(*) as totalnum from $log where $filter and policy is not null group by policy order by totalnum desc"
        set protected enable
    next
    edit "fwb-traffic-Top-Services"
        set description "FortiWeb traffic top services"
        set log-type traffic
        set dev-type FortiWeb
        set query "select service as f_service, count(*) as totalnum from $log where $filter and service is not null group by f_service order by totalnum desc"
        set protected enable
    next
    edit "fwb-traffic-Top-Sources"
        set description "FortiWeb traffic top sources"
        set log-type traffic
        set dev-type FortiWeb
        set query "select src as srcip, count(*) as totalnum from $log where $filter and src is not null group by srcip order by totalnum desc"
        set protected enable
    next
    edit "fwb-traffic-Top-Destinations"
        set description "FortiWeb traffic top destinations"
        set log-type traffic
        set dev-type FortiWeb
        set query "select dst as dstip, count(*) as totalnum from $log where $filter and dst is not null group by dstip order by totalnum desc"
        set protected enable
    next
    edit "fwb-event-Top-event-categories"
        set description "FortiWeb event top event categories"
        set log-type event
        set dev-type FortiWeb
        set query "select pri, count(*) as totalnum from $log where $filter and pri is not null group by pri order by totalnum desc"
        set protected enable
    next
    edit "fwb-event-Top-event-types"
        set description "FortiWeb event top event types"
        set log-type event
        set dev-type FortiWeb
        set query "select subtype, count(*) as totalnum from $log where $filter and subtype is not null group by subtype order by totalnum desc"
        set protected enable
    next
    edit "fwb-event-Top-Event-Categories-By-Status"
        set description "FortiWeb event top event categories by status"
        set log-type event
        set dev-type FortiWeb
        set query "select pri, status, count(*) as totalnum from $log where $filter and pri is not null and status is not null group by pri, status order by totalnum desc"
        set protected enable
    next
    edit "fwb-event-Top-login-by-user"
        set description "FortiWeb event top login by user"
        set log-type event
        set dev-type FortiWeb
        set query "select `user`as f_user, msg, count(*) as totalnum from $log where $filter and `user` is not null and msg is not null group by f_user, msg order by totalnum desc"
        set protected enable
    next
    edit "fwb-traffic-bw-over-time"
        set description "Bandwidth Over Time"
        set log-type traffic
        set dev-type FortiWeb
        set query "select $flex_timescale(timestamp) as hodex, sum(req_in) as req_in, sum(resp_out) as resp_out from ###(select $flex_timestamp as timestamp, sum(http_request_bytes) as req_in, sum(http_response_bytes) as resp_out from $log where $filter and http_host!='none' and nullifna(http_host) is not null group by timestamp order by timestamp desc)### t group by hodex order by hodex"
        set protected enable
    next
    edit "fwb-traffic-top-resp-bytes"
        set description "Top Hosts per Response Bytes"
        set log-type traffic
        set dev-type FortiWeb
        set query "select http_host ,sum(http_request_bytes) as req_in, sum(http_response_bytes) as resp_out from $log where $filter and http_host!='none' and nullifna(http_host) is not null group by http_host order by resp_out desc"
        set protected enable
    next
    edit "fwb-traffic-top-bw-per-domain-over-time"
        set description "Bandwidth per Domain over Time"
        set log-type traffic
        set dev-type FortiWeb
        set query "select $flex_timescale(timestamp) as hodex, http_host, sum(req_in) as req_in, sum(resp_out) as resp_out from ###(select $flex_timestamp as timestamp, http_host, sum(http_request_bytes) as req_in, sum(http_response_bytes) as resp_out from $log where $filter and http_host!='none' and nullifna(http_host) is not null group by timestamp, http_host order by timestamp desc)### t group by http_host, hodex order by hodex"
        set protected enable
    next
    edit "fwb-attack-top-hosts"
        set description "Intrusion Prevention"
        set log-type traffic
        set dev-type FortiWeb
        set query "select http_host,  count(*) as hits from $log where $filter and http_host!='none' and nullifna(http_host) is not null group by http_host order by hits desc"
        set protected enable
    next
    edit "fwb-traffic-top-hosts"
        set description "All Hosts by Hits"
        set log-type traffic
        set dev-type FortiWeb
        set query "select http_host, count(*) as hits from $log where $filter and http_host!='none' and nullifna(http_host) is not null group by http_host order by hits desc"
        set protected enable
    next
    edit "fwb-traffic-top-hits-per-domain-over-time"
        set description "Top Hits per Domain over Time"
        set log-type traffic
        set dev-type FortiWeb
        set query "select $flex_timescale(timestamp) as hodex, http_host, sum(hits) as hits from ###(select $flex_timestamp as timestamp, http_host, count(*) as hits from $log where $filter and http_host!='none' and nullifna(http_host) is not null group by timestamp, http_host order by timestamp desc)### t group by hodex, http_host order by hodex"
        set protected enable
    next
    edit "fwb-traffic-top-hits-uniq-src-per-domain-over-time"
        set description "Top Hits per Unique Src per Domain over Time"
        set log-type traffic
        set dev-type FortiWeb
        set query "select $flex_timescale(timestamp) as hodex, http_host, count(distinct src) as hits from ###(select $flex_timestamp as timestamp, http_host, src from $log where $filter and http_host!='none' and nullifna(http_host) is not null group by timestamp, http_host, src order by timestamp desc)### t group by hodex, http_host order by hodex"
        set protected enable
    next
    edit "fwb-traffic-http-methods-over-time"
        set description "HTTP Methods over Time"
        set log-type traffic
        set dev-type FortiWeb
        set query "select $flex_timescale(timestamp) as hodex, http_method, sum(hits) as hits from ###(select $flex_timestamp as timestamp, http_method, count(*) as hits from $log where $filter and http_method!='none' and nullifna(http_method) is not null group by timestamp, http_method order by timestamp desc)### t group by http_method, hodex order by hodex"
        set protected enable
    next
    edit "fwb-traffic-retcode"
        set description "Top HTTP Response Status Codes"
        set log-type traffic
        set dev-type FortiWeb
        set query "select http_retcode, count(*) as hits from $log where $filter and http_retcode!='0' and nullifna(http_retcode::text) is not null group by http_retcode order by hits desc"
        set protected enable
    next
    edit "fwb-traffic-retcode-400-per-url"
        set description "Top 400 Response Status Codes per URL"
        set log-type traffic
        set dev-type FortiWeb
        set query "select http_retcode, url, sum(hits) as hits from ###(select http_retcode, http_host::text || http_url::text as url, count(*) as hits from $log where $filter group by http_retcode, url order by hits desc)### t where http_retcode::text like '40%' group by http_retcode, url order by hits desc"
        set protected enable
    next
    edit "fwb-traffic-retcode-500-per-url"
        set description "Top 500 Response Status Codes per URL"
        set log-type traffic
        set dev-type FortiWeb
        set query "select http_retcode, url, sum(hits) as hits from ###(select http_retcode, http_host::text || http_url::text as url, count(*) as hits from $log where $filter group by http_retcode, url order by hits desc)### t where http_retcode::text like '50%' group by http_retcode, url order by hits desc"
        set protected enable
    next
    edit "fwb-traffic-retcode-per-domain"
        set description "Top HTTP Response Status Codes per Domain"
        set log-type traffic
        set dev-type FortiWeb
        set query "select http_retcode, http_host, count(*) as hits from $log where $filter and http_retcode!='0' and nullifna(http_retcode::text) is not null group by http_retcode, http_host order by hits desc"
        set protected enable
    next
    edit "fwb-traffic-top-user-agent"
        set description "Top User Agent"
        set log-type traffic
        set dev-type FortiWeb
        set query "select http_agent, count(*) as hits from $log where $filter and http_agent!='none' and nullifna(http_agent) is not null group by http_agent order by hits desc"
        set protected enable
    next

end

config sql-report chart
    edit "fwb-attack-Top-Attack-Sources"
        set disp-name "Top Attack Sources"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 sources of attacks"
        set dataset "fwb-attack-Top-Attack-Sources"
        set chart-type pie
        config table-columns
            edit 1
                set header "Source IP"
                set data-binding "srcip"
                set data-top 10
            next
            edit 2
                set header "Events"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
        set protected enable
    next
    edit "fwb-attack-Top-Attack-Types"
        set disp-name "Top Attack Types"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 detected attack types"
        set dataset "fwb-attack-Top-Attack-Types"
        set chart-type pie
        config table-columns
            edit 1
                set header "Subtype"
                set data-binding "subtype"
                set data-top 10
            next
            edit 2
                set header "Events"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
	    set protected enable
    next
    edit "fwb-attack-Top-Attack-URLs"
        set disp-name "Top Attack URLs"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 detected attack URLs"
        set dataset "fwb-attack-Top-Attack-URLs"
        set chart-type table
        config table-columns
            edit 1
                set header "Host"
                set data-binding "http_host"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "URL"
                set data-binding "http_url"
                set column-width 40
            next
            edit 3
                set header "Events"
                set data-binding "totalnum"
                set column-attr count
                set column-width 20
            next
        end
	set protected enable
    next
    edit "fwb-attack-Top-Attack-Severity-By-Action"
        set disp-name "Top Attack Severity by Action"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 detected attack severities by action"
        set dataset "fwb-attack-Top-Attack-Severities-By-Action"
        set chart-type table
        config table-columns
            edit 1
                set header "Action"
                set data-binding "action"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Categories"
                set data-binding "pri"
                set column-width 40
            next
            edit 3
                set header "Events"
                set data-binding "totalnum"
                set column-attr count
                set column-width 20
            next
        end
	set protected enable
    next
    edit "fwb-attack-Top-Attack-Destinations-By-Type"
        set disp-name "Top Attack Destinations by Type"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 attacked destinations by type"
        set dataset "fwb-attack-Top-Attack-Destinations-By-Type"
        set chart-type table
        config table-columns
            edit 1
                set header "SubType"
                set data-binding "subtype"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Destination"
                set data-binding "dstip"
                set column-width 40
            next
            edit 3
                set header "Events"
                set data-binding "totalnum"
                set column-attr count
                set column-width 20
            next
        end
	set protected enable
    next
    edit "fwb-attack-Top-Attack-Destinations-By-Source"
        set disp-name "Top Attack Destinations by Source"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 attacked destinations by source"
        set dataset "fwb-attack-Top-Attack-Destinations-By-Source"
        set chart-type table
        config table-columns
            edit 1
                set header "Source"
                set data-binding "srcip"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Destination"
                set data-binding "dstip"
                set column-width 40
            next
            edit 3
                set header "Events"
                set data-binding "totalnum"
                set column-attr count
                set column-width 20
            next
        end
	set protected enable
    next
    edit "fwb-attack-Top-Attack-Types-By-Source"
        set disp-name "Top Attack Types by Source"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 detected attack types by source"
        set dataset "fwb-attack-Top-Attack-Types-By-Source"
        set chart-type table
        config table-columns
            edit 1
                set header "Source"
                set data-binding "srcip"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "SubType"
                set data-binding "subtype"
                set column-width 40
            next
            edit 3
                set header "Events"
                set data-binding "totalnum"
                set column-attr count
                set column-width 20
            next
        end
	set protected enable
    next
    edit "fwb-attack-Top-Attacked-Http-Methods-By-Type"
        set disp-name "Top Attacked HTTP Methods by Type"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 attacked HTTP methods by attack type"
        set dataset "fwb-attack-Top-Attacked-Http-Methods-By-Type"
        set chart-type table
        config table-columns
            edit 1
                set header "SubType"
                set data-binding "subtype"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Method"
                set data-binding "http_method"
                set column-width 40
            next
            edit 3
                set header "Events"
                set data-binding "totalnum"
                set column-attr count
                set column-width 20
            next
        end
	set protected enable
    next
    edit "fwb-attack-Top-Attacks-By-Policy"
        set disp-name "Top Attacks by Policy"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 attacks used by policies"
        set dataset "fwb-attack-Top-Attacks-By-Policy"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "Policy"
                set data-binding "policy"
                set data-top 10
            next
            edit 2
                set header "Events"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
	set protected enable
    next
    edit "fwb-attack-Top-Attacked-Destinations"
        set disp-name "Top Attacked Destinations"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 attacked destinations"
        set dataset "fwb-attack-Top-Attacked-Destinations"
        set chart-type pie
        config table-columns
            edit 1
                set header "Destination"
                set data-binding "dstip"
                set data-top 10
            next
            edit 2
                set header "Events"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
	set protected enable
    next
    edit "fwb-attack-Top-Attack-Protocols-By-Type"
        set disp-name "Top Attack Protocols by Type"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 attack protocols by type"
        set dataset "fwb-attack-Top-Attack-Protocols-By-Type"
        set chart-type table
        config table-columns
            edit 1
                set header "SubType"
                set data-binding "subtype"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Service"
                set data-binding "f_service"
                set column-width 40
            next
            edit 3
                set header "Events"
                set data-binding "totalnum"
                set column-attr count
                set column-width 20
            next
        end
	set protected enable
    next
    edit "fwb-attack-Top-Attacked-User-Identifications"
        set disp-name "Top Attacked User Identifications"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 Attacked User identifications"
        set dataset "fwb-attack-Top-Attacked-User-Identifications"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "Session ID"
                set data-binding "http_session_id"
                set data-top 10
            next
            edit 2
                set header "Events"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
	set protected enable
    next
    edit "fwb-traffic-Top-Policies"
        set disp-name "Top Traffic Policies"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 policies in FortiWeb traffic"
        set dataset "fwb-traffic-Top-Policies"
        set chart-type pie
        config table-columns
            edit 1
                set header "Policy"
                set data-binding "policy"
                set data-top 10
            next
            edit 2
                set header "Events"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
	set protected enable
    next
    edit "fwb-traffic-Top-Services"
        set disp-name "Top Traffic Services"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 services in FortiWeb traffic"
        set dataset "fwb-traffic-Top-Services"
        set chart-type pie
        config table-columns
            edit 1
                set header "Service"
                set data-binding "f_service"
                set data-top 10
            next
            edit 2
                set header "Events"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
	    set protected enable
    next
    edit "fwb-traffic-Top-Sources"
        set disp-name "Top Traffic Sources"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 sources in FortiWeb traffic"
        set dataset "fwb-traffic-Top-Sources"
        set chart-type pie
        config table-columns
            edit 1
                set header "Source IP"
                set data-binding "srcip"
                set data-top 10
            next
            edit 2
                set header "Events"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
	    set protected enable
    next
    edit "fwb-traffic-Top-Destinations"
        set disp-name "Top Traffic Destinations"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 destinations in FortiWeb traffic"
        set dataset "fwb-traffic-Top-Destinations"
        set chart-type pie
        config table-columns
            edit 1
                set header "Destination"
                set data-binding "dstip"
                set data-top 10
            next
            edit 2
                set header "Events"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
	    set protected enable
    next
    edit "fwb-event-Top-Event-Categories"
        set disp-name "Top Event Categories"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 event categories"
        set dataset "fwb-event-Top-event-categories"
        set chart-type pie
        config table-columns
            edit 1
                set header "Category"
                set data-binding "pri"
                set data-top 10
            next
            edit 2
                set header "Events"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
	    set protected enable
    next
    edit "fwb-event-Top-Event-Types"
        set disp-name "Top Event Types"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 event types"
        set dataset "fwb-event-Top-event-types"
        set chart-type pie
        config table-columns
            edit 1
                set header "Subtype"
                set data-binding "subtype"
                set data-top 10
            next
            edit 2
                set header "Events"
                set data-type aggregate
                set data-binding "totalnum"
            next
        end
	    set protected enable
    next
    edit "fwb-event-Top-Event-Categories-By-Status"
        set disp-name "Top Event Categories by Status"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 event categories by status"
        set dataset "fwb-event-Top-Event-Categories-By-Status"
        set chart-type table
        config table-columns
            edit 1
                set header "Categories"
                set data-binding "pri"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Status"
                set data-binding "status"
                set column-width 40
            next
            edit 3
                set header "Events"
                set data-binding "totalnum"
                set column-attr count
                set column-width 20
            next
        end
	set protected enable
    next
    edit "fwb-event-Top-Login-By-User"
        set disp-name "Top Event Login by User"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 10 login events by user"
        set dataset "fwb-event-Top-login-by-user"
        set chart-type table
        config table-columns
            edit 1
                set header "User"
                set data-binding "f_user"
                set data-top 10
                set column-width 40
            next
            edit 2
                set header "Message"
                set data-binding "msg"
                set column-width 40
            next
            edit 3
                set header "Events"
                set data-binding "totalnum"
                set column-attr count
                set column-width 20
            next
        end
	set protected enable
    next
    edit "fwb-bandwithd-over-time"
        set disp-name "Bandwidth Over Time"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Bandwidth Over Time"
        set dataset "fwb-traffic-bw-over-time"
        set chart-type area
        config table-columns
            edit 1
                set data-binding "hodex"
                set column-attr time
            next
            edit 2
                set data-binding "req_in"
                set column-graph-type line-up
                set column-attr bandwidth
                set legend "HTTP Request Bytes"
            next
            edit 3
                set data-binding "resp_out"
                set column-graph-type line-up
                set column-attr bandwidth
                set legend "HTTP Response Bytes"
            next

        end
        set protected enable
    next
    edit "fwb-top-hosts-per-response"
        set disp-name "Top Hosts per Response Bytes"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top Hosts per Response Bytes"
        set dataset "fwb-traffic-top-resp-bytes"
        set resolve-hostname disable
        set chart-type table
        config table-columns
            edit 1
                set header "HTTP Host"
                set data-binding "http_host"
                set data-top 10
                set column-width 0
            next
            edit 2
                set header "HTTP Request Bytes"
                set data-binding "req_in"
                set column-attr bandwidth
                set column-width 0
            next
            edit 3
                set header "HTTP Response Bytes"
                set data-binding "resp_out"
                set column-attr bandwidth
                set column-width 0
                set data-top 10
            next
        end
        set protected enable
    next
    edit "fwb-bandwidth-per-domain"
        set disp-name "Bandwidth per Domain over Time"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Bandwidth per Domain over Time"
        set dataset "fwb-traffic-top-bw-per-domain-over-time"
        set chart-type bar
        set order-by "hodex"
        set include-other enable
        config table-columns
            edit 1
                set header ""
                set data-binding "hodex"
                set column-attr time
                set data-top 744
            next
            edit 2
                set header "Host"
                set data-type drilldown
                set data-binding "http_host"
                set data-top 3
            next
            edit 3
                set header ""
                set data-binding "resp_out"
                set data-type aggregate
                set column-attr bandwidth
            next
        end
        set protected enable
    next
    edit "fwb-top-hosts-by-hits"
        set disp-name "Top Hosts"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top Hosts by Hits"
        set dataset "fwb-attack-top-hosts"
        set chart-type bar
        set include-other enable
        config table-columns
            edit 1
                set header "HTTP Host"
                set data-binding "http_host"
                set data-top 10
            next
            edit 2
                set header "Hits"
                set data-binding "hits"
                set column-attr count
                set data-type aggregate
                set data-top 3
            next
        end
        set protected enable
    next
    edit "fwb-all-hosts-by-hits"
        set disp-name "All Hosts"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "All Hosts by Hits"
        set dataset "fwb-traffic-top-hosts"
        set resolve-hostname disable
        set chart-type table
        set include-other enable
        config table-columns
            edit 1
                set header "HTTP Host"
                set data-binding "http_host"
                set data-top 50
                set column-width 0
            next
            edit 2
                set header "Hits"
                set data-binding "hits"
                set column-attr count
                set data-type aggregate
                set column-width 0
            next
        end
        set protected enable
    next
    edit "fwb-top-hits-per-domain-over-time"
        set disp-name "Top Hits per Domain over Time"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top Hits per Domain over Time"
        set dataset "fwb-traffic-top-hits-per-domain-over-time"
        set chart-type bar
        set order-by "hodex"
        set include-other disable
        config table-columns
            edit 1
                set header ""
                set data-binding "hodex"
                set column-attr time
                set data-top 744
            next
            edit 2
                set header ""
                set data-type drilldown
                set data-binding "http_host"
                set data-top 3
            next
            edit 3
                set header ""
                set data-binding "hits"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fwb-top-hits-per-src-per-domain"
        set disp-name "Top Hits per Unique Src per Domain over Time"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top Hits per Unique Src per Domain over Time"
        set dataset "fwb-traffic-top-hits-uniq-src-per-domain-over-time"
        set chart-type bar
        set order-by "hodex"
        set include-other disable
        config table-columns
            edit 1
                set header ""
                set data-binding "hodex"
                set column-attr time
                set data-top 744
            next
            edit 2
                set header ""
                set data-type drilldown
                set data-binding "http_host"
                set data-top 3
            next
            edit 3
                set header ""
                set data-binding "hits"
                set data-type aggregate
                set column-attr count
            next
        end
        set protected enable
    next
    edit "fwb-http-methods-over-time"
        set disp-name "HTTP Methods over Time"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "HTTP Methods over Time"
        set dataset "fwb-traffic-http-methods-over-time"
        set chart-type bar
        set order-by "hodex"
        set include-other disable
        config table-columns
            edit 1
                set header ""
                set data-binding "hodex"
                set column-attr time
                set data-top 744
            next
            edit 2
                set header ""
                set data-type drilldown
                set data-binding "http_method"
                set data-top 3
            next
            edit 3
                set header "Hits"
                set data-binding "hits"
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "fwb-top-http-response-status-codes"
        set disp-name "Top HTTP Response Status Codes"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top HTTP Response Status Codes"
        set dataset "fwb-traffic-retcode"
        set chart-type bar
        set include-other enable
        config table-columns
            edit 1
                set header "HTTP RetCode"
                set data-binding "http_retcode"
                set data-top 10
            next
            edit 2
                set header "Hits"
                set data-binding "hits"
                set column-attr count
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "fwb-top-400-response-status-code-per-url"
        set disp-name "Top 400 Response Status Codes per URL"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 400 Response Status Codes per URL"
        set dataset "fwb-traffic-retcode-400-per-url"
        set resolve-hostname disable
        set chart-type table
        config table-columns
            edit 1
                set header "HTTP Retcode"
                set data-binding "http_retcode"
                set data-top 10
                set column-width 15
            next
            edit 2
                set header "URL"
                set data-binding "url"
                set column-width 70
            next
            edit 3
                set header "Hits"
                set data-binding "hits"
                set column-attr count
                set column-width 15
            next
        end
        set protected enable
    next
    edit "fwb-top-500-response-status-codes-per-url"
        set disp-name "Top 500 Response Status Codes per URL"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top 500 Response Status Codes per URL"
        set dataset "fwb-traffic-retcode-500-per-url"
        set resolve-hostname disable
        set chart-type table
        config table-columns
            edit 1
                set header "HTTP Retcode"
                set data-binding "http_retcode"
                set data-top 10
                set column-width 15
            next
            edit 2
                set header "URL"
                set data-binding "url"
                set column-width 70
            next
            edit 3
                set header "Hits"
                set data-binding "hits"
                set column-attr count
                set column-width 15
            next
        end
        set protected enable
    next
    edit "fwb-top-http-response-status-codes-per-domain"
        set disp-name "Top HTTP Response Status Codes per Domain"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top HTTP Response Status Codes per Domain"
        set dataset "fwb-traffic-retcode-per-domain"
        set chart-type bar
        set include-other disable
        config table-columns
            edit 1
                set header "HTTP Host"
                set data-binding "http_host"
                set data-top 10
            next
            edit 2
                set header ""
                set data-type drilldown
                set data-binding "http_retcode"
                set data-top 3
            next
            edit 3
                set header "Hits"
                set data-binding "hits"
                set column-attr count
                set data-type aggregate
            next
        end
        set protected enable
    next
    edit "fwb-top-user-agent"
        set disp-name "Top User Agent"
        set category "FortiWeb"
        set dev-type FortiWeb
        set description "Top User Agent"
        set dataset "fwb-traffic-top-user-agent"
        set chart-type pie
        set include-other enable
        config table-columns
            edit 1
                set header "HTTP Agent"
                set data-binding "http_agent"
                set data-top 10
            next
            edit 2
                set header "Hits"
                set data-type aggregate
                set column-attr count
                set data-binding "hits"
            next
        end
        set protected enable
    next
end


config sql-report layout
    edit 1000050001
        set is-template enable
        set dev-type FortiWeb
        set category "FortiWeb"
        set title "Template - FortiWeb Default Report"
        set coverpage-background-image "{sys_img_path}/def_cover_bgimg_ver1.png"
        set description "Top sources, sources of attacks, event categories, login events by user, top destinations, attack destinations and event types"
        set body "<fazchart mkey=\"fwb-attack-Top-Attack-Sources\" title=\"Top Sources of Attacks\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fwb-traffic-Top-Sources\" title=\"Top Sources\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fwb-event-Top-Event-Categories\" title=\"Top Event Categories\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fwb-event-Top-Login-By-User\" title=\"Top Login Events by User\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fwb-attack-Top-Attacked-Destinations\" title=\"Top Attack Destinations\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fwb-traffic-Top-Destinations\" title=\"Top Destinations\" width=\"100%\"></fazchart><p></p><fazchart mkey=\"fwb-event-Top-Event-Types\" title=\"Top Event Types\" width=\"100%\"></fazchart>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90104
                next
                edit 90203
                next
            end
        set protected enable
    next


    edit 1000050002
        set is-template enable
        set dev-type FortiWeb
        set category "FortiWeb"
        set title "Template - FortiWeb Web Application Analysis Report"
        set description "It includes web application trends, behavior and consolidated views in a multi-FortiWeb environment."
        set body "<h1>1. Objectives</h1><p>The following reports provide&nbsp; insight into web application trends, behavior and consolidated view in a multi-FortiWeb environment.</p><h1>2.Reports</h1><fazchart mkey=\"fwb-bandwithd-over-time\" title=\"2.1.Bandwidth over Time\" width=\"100%\"></fazchart><p>Provides high level view web app usage with overall bandwidth overtime.</p><fazchart mkey=\"fwb-top-hosts-per-response\" title=\"2.2.Top Hosts per Response Bytes\" width=\"100%\"></fazchart><p>Detailed info regarding bandwidth use per host.</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><fazchart mkey=\"fwb-bandwidth-per-domain\" title=\"2.3.Bandwidth per Domain over Time\" width=\"100%\"></fazchart><p>Breakdown of bandwidth used for each website, helps with identification of utilization patterns during the day.</p><fazchart mkey=\"fwb-top-hosts-by-hits\" title=\"2.4.Top Hosts\" width=\"100%\"></fazchart><p>Top hosts per number of hits.</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><fazchart mkey=\"fwb-all-hosts-by-hits\" title=\"2.5.All Hosts\" width=\"100%\"></fazchart><p>Detailed info regarding requested hosts and as a percentage of overall hits.</p><fazchart mkey=\"fwb-top-hits-per-domain-over-time\" title=\"2.6.Top Hosts per Domain over Time\" width=\"100%\"></fazchart><p>This can help to identify which sites are more active for each period of the day, which can help in capacity planning and eventually creating a dynamic resource distribution in their server farm (moving resources from one website to another during specific dates/times). Just like other trend graphs this can help security admins identify deviations in a glimpse.</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><fazchart mkey=\"fwb-top-hits-per-src-per-domain\" title=\"2.7.Top Hits per Unique Src per Domain over Time\" width=\"100%\"></fazchart><p>This is an attempt to give the administrator a rough idea of &quot;unique visitors&quot;. Given this is based on source IP, depending on the architecture could be more valuable to some customers than others.</p><fazchart mkey=\"fwb-http-methods-over-time\" title=\"2.8.HTTP Methods over Time\" width=\"100%\"></fazchart><p>This chart gives insight into how&nbsp; HTTP methods are used overtime and can hint to orchestrated attacks when large amount of requests using methods not seen previously,&nbsp; suddenly occur which may need to be closely reviewed by the security team.</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><fazchart mkey=\"fwb-top-http-response-status-codes\" title=\"2.9.Top HTTP Response Status Codes\" width=\"100%\"></fazchart><p>This graph can help administrators to visualize errors in the application behavior (cyclical loops, excessive server-side errors or broken pages), and attempts to circumvent the access controls employed by the website (e.g. too many Unauthorized/Forbidden codes).</p><fazchart mkey=\"fwb-top-400-response-status-code-per-url\" title=\"2.10.Top 400 Response Status Codes per URL\" width=\"100%\"></fazchart><p>This table enable an administrator to identify failures in the website code (like broken references) and specific pages that are more problematic for developer&#39;s review.</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><fazchart mkey=\"fwb-top-500-response-status-codes-per-url\" title=\"2.11.Top 500 Response Status Codes per URL\" width=\"100%\"></fazchart><p>This table allow an administrator to identify errors in the server-side, too many 500 errors may indicate some problems in the web server or the application.</p><fazchart mkey=\"fwb-top-http-response-status-codes-per-domain\" title=\"2.12.Top HTTP Response Status Codes per Domain\" width=\"100%\"></fazchart><p>Similar to the &quot;HTTP Response Status Codes&quot; but with a breakdown per domain to ease the identification of abnormal behaviour in specific websites.</p><div style=\"page-break-after: always\"><span style=\"display:none\">&nbsp;</span></div><fazchart mkey=\"fwb-top-user-agent\" title=\"2.13.Top User Agent\" width=\"100%\"></fazchart><p>The information obtained by this chart can steer the development of the website towards compatibility with a specific user-base (e.g. lots of mobile users) and also help in the security-side by allowing administrators to enforce a more rigid SSL/TLS policy knowing that they&#39;ll not break compatibility to most of their visitors.</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p>"
            config header
                edit 1
                    set type graphic
                    set graphic "fortinet_grey.png"
                next
            end
            config footer
                edit 1
                    set type minicover
                next
            end
            config folders
                edit 90104
                next
                edit 90200
                next
            end
        set protected enable
    next
end

config sql-report layout-folder
    edit 99999
        set folder-name "Default Templates"
        set protected enable
    next
    edit 90104
        set folder-name "FortiWeb Reports Templates"
        set parent-id 99999
        set protected enable
    next

    edit 90200
        set folder-name "Application Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90203
        set folder-name "SOC Reports Templates"
        set parent-id 99999
        set protected enable
    next
    edit 90205
        set folder-name "Outbreak Alert Reports Templates"
        set parent-id 99999
        set protected enable
    next
end

config alert basic-handler
    edit 160000
        set name "Default-FWB-Threat-Detection-By-Hostname"
        set description "Default FortiWeb Handler to detect malicious and suspicious activities grouped by web server's host name"
        config rule
            edit 1
                set name "Malicious activity detected"
                set devtype FortiWeb
                set severity high
                set logtype "attack"
                set extrainfo "Malicious activity: ${main_type}, ${subtype}, ${msg}, Traffic path: from ${src} to ${dst} (${policy})"
                set extrainfo-type custom
                set subject "Malicious activity: $groupby2 detected"
                set groupby1 "http_host"
                set groupby2 "signature_subclass"
                set eventstatus "open"
                set tags "By_Endpoint,Intrusion,Signature"
                set filter-relation 0
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "action"
                        set value "Alert_Deny"
                        set oper not-equal
                    next
                    edit 2
                        set key "action"
                        set value "Period_Block"
                        set oper not-equal
                    next
                end
            next
            edit 2
                set name "Malicious activity blocked"
                set devtype FortiWeb
                set severity medium
                set logtype "attack"
                set extrainfo "Malicious activity: ${main_type}, ${subtype}, ${msg}, Traffic path: from ${src} to ${dst} (${policy})"
                set extrainfo-type custom
                set subject "Malicious activity: $groupby2 blocked"
                set groupby1 "http_host"
                set groupby2 "signature_subclass"
                set eventstatus "mitigated"
                set tags "By_Endpoint,Intrusion,Signature"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "action"
                        set value "Alert_Deny"
                        set oper equal
                    next
                    edit 2
                        set key "action"
                        set value "Period_Block"
                        set oper equal
                    next
                end
            next
            edit 3
                set name "Encrypted traffic bypassed FortiWeb scan"
                set devtype FortiWeb
                set severity low
                set logtype "traffic"
                set extrainfo "Destination: ${dst}, ${msg}"
                set extrainfo-type custom
                set subject "Encrypted traffic bypassed FortiWeb scan"
                set groupby1 "http_host"
                set eventstatus "open"
                set tags "By_Endpoint,Risky,Bypassed"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "msg"
                        set value "No server certificate for SSL connection"
                        set oper contain
                    next
                    edit 2
                        set key "msg"
                        set value "SSL certificate key mismatch"
                        set oper contain
                    next
                    edit 3
                        set key "msg"
                        set value "Ephemeral keys cannot be decrypted"
                        set oper contain
                    next
                    edit 4
                        set key "msg"
                        set value "Unsupported cipher for SSL connection"
                        set oper contain
                    next
                    edit 5
                        set key "msg"
                        set value "Unmonitored SSL connection"
                        set oper contain
                    next
                end
            next
            edit 4
                set name "HTTP response time above threshold"
                set devtype FortiWeb
                set severity low
                set logtype "traffic"
                set extrainfo "Destination: ${dst}, ${msg}"
                set extrainfo-type custom
                set subject "HTTP response time above threshold"
                set groupby1 "http_host"
                set tags "By_Endpoint,Risky,Response_Time"
                set filter-relation 1
                set aggregate-expr "COUNT(*) >= 1"
                set thres-duration 1440
                config filter
                    edit 1
                        set key "http_response_time"
                        set value "10000"
                        set oper great-or-equal
                    next
                end
            next
        end
        set enable disable
        set protected enable
        set template-url "/fazcfg-template/basic-handler/fwb"
    next
end

config system connectors
    edit 1
        set uuid "5979abf1-a807-47fd-8aca-c03d3b27c124"
        set name "Local Connector"
        set description "Local Connector"
        set status enable
        set type LOCALHOST 
        set auth-type none
        config action
            edit 1
                set name "UPDATE_ASSET_AND_IDENTITY"
                set description "update asset and identity"
                set parameters "{}"
                set status enable
            next
            edit 2
                set name "GET_EVENTS"
                set description "get events"
                set parameters "{}"
                set status enable
            next
            edit 3
                set name "ATTACH_DATA_TO_INCIDENT"
                set description "attach data to incident"
                set parameters "{}"
                set status enable
            next
            edit 4
                set name "RUN_REPORT"
                set description "run report"
                set parameters "{}"
                set status enable
            next
            edit 5
                set name "GET_ENDPOINT_VULNERABILITIES"
                set description "get endpoint vulnerabilities"
                set parameters "{}"
                set status enable
            next
            edit 6
                set name "CREATE_INCIDENT"
                set description "create incident"
                set parameters "{}"
                set status enable
            next
            edit 7
                set name "UPDATE_INCIDENT"
                set description "update incident"
                set parameters "{}"
                set status enable
            next
        end
    next
    edit 2
        set uuid "d0f89488-b270-11ea-b3de-0242ac130004"
        set name "FortiGuard Connector"
        set description "FortiGuard Connector"
        set status enable
        set type FGD
        set auth-type none
        config action
            edit 1
                set name "GET_IOC_INFO"
                set description "get FortiGuard data for associated IOC"
                set parameters "{\"addr\":null}"
                set status enable
            next
            edit 2
                set name "GET_THREAT_INFO"
                set description "Lookup Fortiguard encyclopedia entry"
                set parameters "{\"threat-type\":null,\"threatID\":null}"
                set status enable
            next
            edit 3
                set name "INDICATOR_LOOKUP"
                set description "Indicator Lookup"
                set parameters "{\"indicator_type\":null,\"indicator_value\":null}"
                set status enable
            next
        end
    next
end
